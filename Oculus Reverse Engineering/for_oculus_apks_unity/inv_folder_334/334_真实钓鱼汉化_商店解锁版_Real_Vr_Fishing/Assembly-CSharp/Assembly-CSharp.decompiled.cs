#define DEBUG_LOCOMOTION_PANEL
using System;
using System.Collections;
using System.Collections.Generic;
using System.ComponentModel;
using System.Diagnostics;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Net;
using System.Net.NetworkInformation;
using System.Net.Sockets;
using System.Reflection;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;
using System.Security.Cryptography;
using System.Text;
using System.Text.RegularExpressions;
using System.Threading;
using System.Threading.Tasks;
using System.Timers;
using AOT;
using Crosstales.DJ;
using Crosstales.DJ.Model;
using Crosstales.OnlineCheck;
using DG.Tweening;
using DG.Tweening.Core;
using DG.Tweening.Core.Enums;
using DG.Tweening.Plugins;
using DG.Tweening.Plugins.Core.PathCore;
using DG.Tweening.Plugins.Options;
using ExitGames.Client.Photon;
using HtmlAgilityPack;
using Miragesoft;
using Miragesoft.Localization;
using Miragesoft.Utils.Json;
using Miragesoft.Utils.Web;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;
using Obi;
using Oculus.Avatar;
using Oculus.Platform;
using Oculus.Platform.Models;
using Oculus.Spatializer.Propagation;
using Photon.Chat;
using Photon.Pun;
using Photon.Pun.UtilityScripts;
using Photon.Realtime;
using TMPro;
using UnityEngine;
using UnityEngine.AI;
using UnityEngine.Analytics;
using UnityEngine.Android;
using UnityEngine.Audio;
using UnityEngine.EventSystems;
using UnityEngine.Events;
using UnityEngine.Networking;
using UnityEngine.Rendering;
using UnityEngine.SceneManagement;
using UnityEngine.Scripting;
using UnityEngine.UI;
using UnityEngine.Video;
using UnityEngine.XR;
using Vuplex.WebView;

[assembly: CompilationRelaxations(8)]
[assembly: RuntimeCompatibility(WrapNonExceptionThrows = true)]
[assembly: Debuggable(DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints)]
[assembly: InternalsVisibleTo("Assembly-CSharp-Editor")]
[assembly: AssemblyVersion("0.0.0.0")]
public class LetterProperties : MonoBehaviour
{
	public Text content;

	public Image likeButton;

	public Image dislikeButton;

	public int idx = -1;

	public bool isLike;

	public bool isDislike;

	public Color normalColor;

	public Color selectedColor;

	private void Awake()
	{
		likeButton.color = normalColor;
		dislikeButton.color = normalColor;
	}

	public void Like()
	{
		isLike = !isLike;
		if (isLike)
		{
			likeButton.color = selectedColor;
			dislikeButton.color = normalColor;
		}
		else
		{
			likeButton.color = normalColor;
		}
	}

	public void Dislike()
	{
		isDislike = !isDislike;
		if (isDislike)
		{
			dislikeButton.color = selectedColor;
			likeButton.color = normalColor;
		}
		else
		{
			dislikeButton.color = normalColor;
		}
	}
}
public class MirrorCamera : MonoBehaviour
{
	public Transform MirrorCam;

	public Transform PlayerCam;

	public Transform position1;

	public Transform position2;

	public RenderTexture renderTexture;

	private float fov;

	public Camera mirrorCam;

	private void Start()
	{
	}

	private void LateUpdate()
	{
		MirrorCam.position = new Vector3(base.transform.position.x + (base.transform.position.x - PlayerCam.position.x), PlayerCam.position.y, PlayerCam.position.z);
		cal();
	}

	public void cal()
	{
		Quaternion localRotation = Quaternion.LookRotation(base.transform.position - MirrorCam.position);
		MirrorCam.localRotation = localRotation;
		Vector3 from = new Vector3(position1.position.x, MirrorCam.position.y, position1.position.z) - MirrorCam.position;
		Vector3 to = new Vector3(position2.position.x, MirrorCam.position.y, position2.position.z) - MirrorCam.position;
		fov = Vector3.Angle(from, to);
		mirrorCam.fieldOfView = fov;
	}
}
[ExecuteInEditMode]
public class MirrorReflection : MonoBehaviour
{
	public bool m_DisablePixelLights = true;

	public int m_TextureSize = 256;

	public float m_ClipPlaneOffset = 0.07f;

	public int m_framesNeededToUpdate;

	public LayerMask m_ReflectLayers = -1;

	private Dictionary<Camera, Camera> m_ReflectionCameras = new Dictionary<Camera, Camera>();

	private RenderTexture m_ReflectionTextureLeft;

	private RenderTexture m_ReflectionTextureRight;

	private int m_OldReflectionTextureSize;

	private int m_frameCounter;

	private static bool s_InsideRendering;

	public void OnWillRenderObject()
	{
		if (m_frameCounter > 0)
		{
			m_frameCounter--;
			return;
		}
		Renderer component = GetComponent<Renderer>();
		if (!base.enabled || !component || !component.sharedMaterial || !component.enabled)
		{
			return;
		}
		Camera current = Camera.current;
		if ((bool)current && !s_InsideRendering)
		{
			s_InsideRendering = true;
			m_frameCounter = m_framesNeededToUpdate;
			RenderCamera(current, component, Camera.StereoscopicEye.Left, ref m_ReflectionTextureLeft);
			if (current.stereoEnabled)
			{
				RenderCamera(current, component, Camera.StereoscopicEye.Right, ref m_ReflectionTextureRight);
			}
		}
	}

	private void RenderCamera(Camera cam, Renderer rend, Camera.StereoscopicEye eye, ref RenderTexture reflectionTexture)
	{
		CreateMirrorObjects(cam, eye, out var reflectionCamera, ref reflectionTexture);
		Vector3 position = base.transform.position;
		Vector3 up = base.transform.up;
		int pixelLightCount = QualitySettings.pixelLightCount;
		if (m_DisablePixelLights)
		{
			QualitySettings.pixelLightCount = 0;
		}
		CopyCameraProperties(cam, reflectionCamera);
		float w = 0f - Vector3.Dot(up, position) - m_ClipPlaneOffset;
		Vector4 plane = new Vector4(up.x, up.y, up.z, w);
		Matrix4x4 reflectionMat = Matrix4x4.zero;
		CalculateReflectionMatrix(ref reflectionMat, plane);
		Matrix4x4 worldToCameraMatrix;
		Vector3 point;
		if (cam.stereoEnabled)
		{
			worldToCameraMatrix = cam.GetStereoViewMatrix(eye) * reflectionMat;
			Vector3 vector = ((eye != 0) ? InputTracking.GetLocalPosition(XRNode.RightEye) : InputTracking.GetLocalPosition(XRNode.LeftEye));
			vector.z = 0f;
			point = cam.transform.position + cam.transform.TransformVector(vector);
		}
		else
		{
			worldToCameraMatrix = cam.worldToCameraMatrix * reflectionMat;
			point = cam.transform.position;
		}
		Vector3 position2 = reflectionMat.MultiplyPoint(point);
		reflectionCamera.transform.position = position2;
		reflectionCamera.worldToCameraMatrix = worldToCameraMatrix;
		Vector4 clipPlane = CameraSpacePlane(worldToCameraMatrix, position, up, 1f);
		Matrix4x4 matrix = ((!cam.stereoEnabled) ? cam.projectionMatrix : cam.GetStereoProjectionMatrix(eye));
		MakeProjectionMatrixOblique(ref matrix, clipPlane);
		reflectionCamera.projectionMatrix = matrix;
		reflectionCamera.cullingMask = m_ReflectLayers.value;
		reflectionCamera.targetTexture = reflectionTexture;
		GL.invertCulling = true;
		reflectionCamera.transform.rotation = cam.transform.rotation;
		reflectionCamera.Render();
		GL.invertCulling = false;
		Material[] sharedMaterials = rend.sharedMaterials;
		string text = "_ReflectionTex" + eye;
		Material[] array = sharedMaterials;
		foreach (Material material in array)
		{
			if (material.HasProperty(text))
			{
				material.SetTexture(text, reflectionTexture);
			}
		}
		if (m_DisablePixelLights)
		{
			QualitySettings.pixelLightCount = pixelLightCount;
		}
		s_InsideRendering = false;
	}

	private void OnDisable()
	{
		if ((bool)m_ReflectionTextureLeft)
		{
			UnityEngine.Object.DestroyImmediate(m_ReflectionTextureLeft);
			m_ReflectionTextureLeft = null;
		}
		if ((bool)m_ReflectionTextureRight)
		{
			UnityEngine.Object.DestroyImmediate(m_ReflectionTextureRight);
			m_ReflectionTextureRight = null;
		}
		foreach (KeyValuePair<Camera, Camera> reflectionCamera in m_ReflectionCameras)
		{
			UnityEngine.Object.DestroyImmediate(reflectionCamera.Value.gameObject);
		}
		m_ReflectionCameras.Clear();
	}

	private void CopyCameraProperties(Camera src, Camera dest)
	{
		if (dest == null)
		{
			return;
		}
		dest.clearFlags = src.clearFlags;
		dest.backgroundColor = src.backgroundColor;
		if (src.clearFlags == CameraClearFlags.Skybox)
		{
			Skybox skybox = src.GetComponent(typeof(Skybox)) as Skybox;
			Skybox skybox2 = dest.GetComponent(typeof(Skybox)) as Skybox;
			if (!skybox || !skybox.material)
			{
				skybox2.enabled = false;
			}
			else
			{
				skybox2.enabled = true;
				skybox2.material = skybox.material;
			}
		}
		dest.farClipPlane = src.farClipPlane;
		dest.nearClipPlane = src.nearClipPlane;
		dest.orthographic = src.orthographic;
		dest.fieldOfView = src.fieldOfView;
		dest.aspect = src.aspect;
		dest.orthographicSize = src.orthographicSize;
	}

	private void CreateMirrorObjects(Camera currentCamera, Camera.StereoscopicEye eye, out Camera reflectionCamera, ref RenderTexture reflectionTexture)
	{
		reflectionCamera = null;
		if (!reflectionTexture || m_OldReflectionTextureSize != m_TextureSize)
		{
			if ((bool)reflectionTexture)
			{
				UnityEngine.Object.DestroyImmediate(reflectionTexture);
			}
			reflectionTexture = new RenderTexture(m_TextureSize, m_TextureSize, 16);
			reflectionTexture.name = "__MirrorReflection" + eye.ToString() + GetInstanceID();
			reflectionTexture.isPowerOfTwo = true;
			reflectionTexture.hideFlags = HideFlags.DontSave;
			m_OldReflectionTextureSize = m_TextureSize;
		}
		if (!m_ReflectionCameras.TryGetValue(currentCamera, out reflectionCamera))
		{
			GameObject gameObject = new GameObject("Mirror Reflection Camera id" + GetInstanceID() + " for " + currentCamera.GetInstanceID(), typeof(Camera), typeof(Skybox));
			reflectionCamera = gameObject.GetComponent<Camera>();
			reflectionCamera.enabled = false;
			reflectionCamera.transform.position = base.transform.position;
			reflectionCamera.transform.rotation = base.transform.rotation;
			reflectionCamera.gameObject.AddComponent<FlareLayer>();
			gameObject.hideFlags = HideFlags.DontSave;
			m_ReflectionCameras.Add(currentCamera, reflectionCamera);
		}
	}

	private static float sgn(float a)
	{
		if (a > 0f)
		{
			return 1f;
		}
		if (a < 0f)
		{
			return -1f;
		}
		return 0f;
	}

	private Vector4 CameraSpacePlane(Matrix4x4 worldToCameraMatrix, Vector3 pos, Vector3 normal, float sideSign)
	{
		Vector3 point = pos + normal * m_ClipPlaneOffset;
		Vector3 lhs = worldToCameraMatrix.MultiplyPoint(point);
		Vector3 rhs = worldToCameraMatrix.MultiplyVector(normal).normalized * sideSign;
		return new Vector4(rhs.x, rhs.y, rhs.z, 0f - Vector3.Dot(lhs, rhs));
	}

	private static void CalculateReflectionMatrix(ref Matrix4x4 reflectionMat, Vector4 plane)
	{
		reflectionMat.m00 = 1f - 2f * plane[0] * plane[0];
		reflectionMat.m01 = -2f * plane[0] * plane[1];
		reflectionMat.m02 = -2f * plane[0] * plane[2];
		reflectionMat.m03 = -2f * plane[3] * plane[0];
		reflectionMat.m10 = -2f * plane[1] * plane[0];
		reflectionMat.m11 = 1f - 2f * plane[1] * plane[1];
		reflectionMat.m12 = -2f * plane[1] * plane[2];
		reflectionMat.m13 = -2f * plane[3] * plane[1];
		reflectionMat.m20 = -2f * plane[2] * plane[0];
		reflectionMat.m21 = -2f * plane[2] * plane[1];
		reflectionMat.m22 = 1f - 2f * plane[2] * plane[2];
		reflectionMat.m23 = -2f * plane[3] * plane[2];
		reflectionMat.m30 = 0f;
		reflectionMat.m31 = 0f;
		reflectionMat.m32 = 0f;
		reflectionMat.m33 = 1f;
	}

	private static void MakeProjectionMatrixOblique(ref Matrix4x4 matrix, Vector4 clipPlane)
	{
		Vector4 vector = default(Vector4);
		vector.x = (sgn(clipPlane.x) + matrix[8]) / matrix[0];
		vector.y = (sgn(clipPlane.y) + matrix[9]) / matrix[5];
		vector.z = -1f;
		vector.w = (1f + matrix[10]) / matrix[14];
		Vector4 vector2 = clipPlane * (2f / Vector3.Dot(clipPlane, vector));
		matrix[2] = vector2.x;
		matrix[6] = vector2.y;
		matrix[10] = vector2.z + 1f;
		matrix[14] = vector2.w;
	}
}
public class TestFollowRotate : MonoBehaviour
{
	public Transform camPos;

	public Transform head;

	public Transform follower;

	public float speed = 0.5f;

	public float angle = 90f;

	private void Start()
	{
	}

	private void LateUpdate()
	{
		head.position = camPos.position;
		head.rotation = camPos.rotation;
		Vector3 forward = head.forward;
		float maxRadiansDelta = speed * Time.deltaTime;
		Vector3 vector = Vector3.RotateTowards(base.transform.forward, forward, maxRadiansDelta, 0f);
		UnityEngine.Debug.DrawRay(base.transform.position, vector, Color.red);
		base.transform.rotation = Quaternion.LookRotation(vector);
	}
}
public class CanCoca : MonoBehaviour
{
	private void Start()
	{
	}

	private void Update()
	{
	}
}
public class FastList<T>
{
	public delegate int CompareFunc(T left, T right);

	public T[] array;

	public int size;

	public int Count
	{
		get
		{
			return size;
		}
		set
		{
		}
	}

	public T this[int i]
	{
		get
		{
			return array[i];
		}
		set
		{
			array[i] = value;
		}
	}

	public FastList()
	{
	}

	public FastList(int size)
	{
		if (size > 0)
		{
			this.size = 0;
			array = new T[size];
		}
		else
		{
			this.size = 0;
		}
	}

	public void Add(T item)
	{
		if (array == null || size == array.Length)
		{
			Allocate();
		}
		array[size] = item;
		size++;
	}

	public void AddUnique(T item)
	{
		if (array == null || size == array.Length)
		{
			Allocate();
		}
		if (!Contains(item))
		{
			array[size] = item;
			size++;
		}
	}

	public void AddRange(IEnumerable<T> items)
	{
		foreach (T item in items)
		{
			Add(item);
		}
	}

	public void Insert(int index, T item)
	{
		if (array == null || size == array.Length)
		{
			Allocate();
		}
		if (index < size)
		{
			for (int num = size; num > index; num--)
			{
				array[num] = array[num - 1];
			}
			array[index] = item;
			size++;
		}
		else
		{
			Add(item);
		}
	}

	public bool Remove(T item)
	{
		if (array != null)
		{
			for (int i = 0; i < size; i++)
			{
				if (item.Equals(array[i]))
				{
					size--;
					for (int j = i; j < size; j++)
					{
						array[j] = array[j + 1];
					}
					array[size] = default(T);
					return true;
				}
			}
		}
		return false;
	}

	public void RemoveAt(int index)
	{
		if (array != null && size > 0 && index < size)
		{
			size--;
			for (int i = index; i < size; i++)
			{
				array[i] = array[i + 1];
			}
			array[size] = default(T);
		}
	}

	public bool RemoveFast(T item)
	{
		if (array != null)
		{
			for (int i = 0; i < size; i++)
			{
				if (item.Equals(array[i]))
				{
					if (i < size - 1)
					{
						T val = array[size - 1];
						array[size - 1] = default(T);
						array[i] = val;
					}
					else
					{
						array[i] = default(T);
					}
					size--;
					return true;
				}
			}
		}
		return false;
	}

	public void RemoveAtFast(int index)
	{
		if (array != null && index < size && index >= 0)
		{
			if (index == size - 1)
			{
				array[index] = default(T);
			}
			else
			{
				T val = array[size - 1];
				array[index] = val;
				array[size - 1] = default(T);
			}
			size--;
		}
	}

	public bool Contains(T item)
	{
		if (array == null || size <= 0)
		{
			return false;
		}
		for (int i = 0; i < size; i++)
		{
			if (array[i].Equals(item))
			{
				return true;
			}
		}
		return false;
	}

	public int IndexOf(T item)
	{
		if (size <= 0 || array == null)
		{
			return -1;
		}
		for (int i = 0; i < size; i++)
		{
			if (item.Equals(array[i]))
			{
				return i;
			}
		}
		return -1;
	}

	public T Pop()
	{
		if (array != null && size > 0)
		{
			T result = array[size - 1];
			array[size - 1] = default(T);
			size--;
			return result;
		}
		return default(T);
	}

	public T[] ToArray()
	{
		Trim();
		return array;
	}

	public void Sort(CompareFunc comparer)
	{
		int num = 0;
		int num2 = size - 1;
		bool flag = true;
		while (flag)
		{
			flag = false;
			for (int i = num; i < num2; i++)
			{
				if (comparer(array[i], array[i + 1]) > 0)
				{
					T val = array[i];
					array[i] = array[i + 1];
					array[i + 1] = val;
					flag = true;
				}
				else if (!flag)
				{
					num = ((i != 0) ? (i - 1) : 0);
				}
			}
		}
	}

	public void InsertionSort(CompareFunc comparer)
	{
		for (int i = 1; i < size; i++)
		{
			T val = array[i];
			int num = i;
			while (num > 0 && comparer(array[num - 1], val) > 0)
			{
				array[num] = array[num - 1];
				num--;
			}
			array[num] = val;
		}
	}

	public IEnumerator<T> GetEnumerator()
	{
		if (array != null)
		{
			for (int i = 0; i < size; i++)
			{
				yield return array[i];
			}
		}
	}

	public T Find(Predicate<T> match)
	{
		if (match != null && array != null)
		{
			for (int i = 0; i < size; i++)
			{
				if (match(array[i]))
				{
					return array[i];
				}
			}
		}
		return default(T);
	}

	private void Allocate()
	{
		T[] array = ((this.array != null) ? new T[Mathf.Max(this.array.Length << 1, 32)] : new T[32]);
		if (this.array != null && size > 0)
		{
			this.array.CopyTo(array, 0);
		}
		this.array = array;
	}

	private void Trim()
	{
		if (size > 0)
		{
			T[] array = new T[size];
			for (int i = 0; i < size; i++)
			{
				array[i] = this.array[i];
			}
			this.array = array;
		}
		else
		{
			this.array = null;
		}
	}

	public void Clear()
	{
		size = 0;
	}

	public void Release()
	{
		Clear();
		array = null;
	}
}
public class InspectorNoteAttribute : PropertyAttribute
{
	public readonly string header;

	public readonly string message;

	public InspectorNoteAttribute(string header, string message = "")
	{
		this.header = header;
		this.message = message;
	}
}
public class InspectorCommentAttribute : PropertyAttribute
{
	public readonly string message;

	public InspectorCommentAttribute(string message = "")
	{
		this.message = message;
	}
}
public class OvrAvatarTestDriver : OvrAvatarDriver
{
	private Vector3 headPos = new Vector3(0f, 1.6f, 0f);

	private Quaternion headRot = Quaternion.identity;

	private float voiceAmplitude;

	private ControllerPose GetMalibuControllerPose(OVRInput.Controller controller)
	{
		ovrAvatarButton ovrAvatarButton2 = (ovrAvatarButton)0;
		if (OVRInput.Get(OVRInput.Button.PrimaryIndexTrigger, controller))
		{
			ovrAvatarButton2 |= ovrAvatarButton.One;
		}
		ControllerPose result = default(ControllerPose);
		result.buttons = ovrAvatarButton2;
		result.touches = (OVRInput.Get(OVRInput.Touch.PrimaryTouchpad) ? ovrAvatarTouch.One : ((ovrAvatarTouch)0));
		result.joystickPosition = OVRInput.Get(OVRInput.Axis2D.PrimaryTouchpad, controller);
		result.indexTrigger = 0f;
		result.handTrigger = 0f;
		result.isActive = (OVRInput.GetActiveController() & controller) != 0;
		return result;
	}

	private ControllerPose GetControllerPose(OVRInput.Controller controller)
	{
		ovrAvatarButton ovrAvatarButton2 = (ovrAvatarButton)0;
		if (OVRInput.Get(OVRInput.Button.One, controller))
		{
			ovrAvatarButton2 |= ovrAvatarButton.One;
		}
		if (OVRInput.Get(OVRInput.Button.Two, controller))
		{
			ovrAvatarButton2 |= ovrAvatarButton.Two;
		}
		if (OVRInput.Get(OVRInput.Button.Start, controller))
		{
			ovrAvatarButton2 |= ovrAvatarButton.Three;
		}
		if (OVRInput.Get(OVRInput.Button.PrimaryThumbstick, controller))
		{
			ovrAvatarButton2 |= ovrAvatarButton.Joystick;
		}
		ovrAvatarTouch ovrAvatarTouch2 = (ovrAvatarTouch)0;
		if (OVRInput.Get(OVRInput.Touch.One, controller))
		{
			ovrAvatarTouch2 |= ovrAvatarTouch.One;
		}
		if (OVRInput.Get(OVRInput.Touch.Two, controller))
		{
			ovrAvatarTouch2 |= ovrAvatarTouch.Two;
		}
		if (OVRInput.Get(OVRInput.Touch.PrimaryThumbstick, controller))
		{
			ovrAvatarTouch2 |= ovrAvatarTouch.Joystick;
		}
		if (OVRInput.Get(OVRInput.Touch.PrimaryThumbRest, controller))
		{
			ovrAvatarTouch2 |= ovrAvatarTouch.ThumbRest;
		}
		if (OVRInput.Get(OVRInput.Touch.PrimaryIndexTrigger, controller))
		{
			ovrAvatarTouch2 |= ovrAvatarTouch.Index;
		}
		if (!OVRInput.Get(OVRInput.NearTouch.PrimaryIndexTrigger, controller))
		{
			ovrAvatarTouch2 |= ovrAvatarTouch.Pointing;
		}
		if (!OVRInput.Get(OVRInput.NearTouch.PrimaryThumbButtons, controller))
		{
			ovrAvatarTouch2 |= ovrAvatarTouch.ThumbUp;
		}
		ControllerPose result = default(ControllerPose);
		result.buttons = ovrAvatarButton2;
		result.touches = ovrAvatarTouch2;
		result.joystickPosition = OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, controller);
		result.indexTrigger = OVRInput.Get(OVRInput.Axis1D.PrimaryIndexTrigger, controller);
		result.handTrigger = OVRInput.Get(OVRInput.Axis1D.PrimaryHandTrigger, controller);
		result.isActive = (OVRInput.GetActiveController() & controller) != 0;
		return result;
	}

	private void CalculateCurrentPose()
	{
		if (OvrAvatarDriver.GetIsTrackedRemote())
		{
			CurrentPose = new PoseFrame
			{
				voiceAmplitude = voiceAmplitude,
				headPosition = headPos,
				headRotation = headRot,
				handLeftPosition = OVRInput.GetLocalControllerPosition(OVRInput.Controller.LTrackedRemote),
				handLeftRotation = OVRInput.GetLocalControllerRotation(OVRInput.Controller.LTrackedRemote),
				handRightPosition = OVRInput.GetLocalControllerPosition(OVRInput.Controller.RTrackedRemote),
				handRightRotation = OVRInput.GetLocalControllerRotation(OVRInput.Controller.RTrackedRemote),
				controllerLeftPose = GetMalibuControllerPose(OVRInput.Controller.LTrackedRemote),
				controllerRightPose = GetMalibuControllerPose(OVRInput.Controller.RTrackedRemote)
			};
		}
		else
		{
			CurrentPose = new PoseFrame
			{
				voiceAmplitude = voiceAmplitude,
				headPosition = headPos,
				headRotation = headRot,
				handLeftPosition = OVRInput.GetLocalControllerPosition(OVRInput.Controller.LTouch),
				handLeftRotation = OVRInput.GetLocalControllerRotation(OVRInput.Controller.LTouch),
				handRightPosition = OVRInput.GetLocalControllerPosition(OVRInput.Controller.RTouch),
				handRightRotation = OVRInput.GetLocalControllerRotation(OVRInput.Controller.RTouch),
				controllerLeftPose = GetControllerPose(OVRInput.Controller.LTouch),
				controllerRightPose = GetControllerPose(OVRInput.Controller.RTouch)
			};
		}
	}

	public override void UpdateTransforms(IntPtr sdkAvatar)
	{
		CalculateCurrentPose();
		UpdateTransformsFromPose(sdkAvatar);
	}
}
public class PoseEditHelper : MonoBehaviour
{
	public Transform poseRoot;

	private void OnDrawGizmos()
	{
		if (poseRoot != null)
		{
			DrawJoints(poseRoot);
		}
	}

	private void DrawJoints(Transform joint)
	{
		Gizmos.DrawWireSphere(joint.position, 0.005f);
		for (int i = 0; i < joint.childCount; i++)
		{
			Transform child = joint.GetChild(i);
			if (!child.name.EndsWith("_grip") && !child.name.EndsWith("hand_ignore"))
			{
				Gizmos.DrawLine(joint.position, child.position);
				DrawJoints(child);
			}
		}
	}
}
public class GazeTargetSpawner : MonoBehaviour
{
	public GameObject GazeTargetPrefab;

	public int NumberOfDummyTargets = 100;

	public int RadiusMultiplier = 3;

	[SerializeField]
	private bool isVisible;

	public bool IsVisible
	{
		get
		{
			return isVisible;
		}
		set
		{
			isVisible = value;
			GazeTarget[] componentsInChildren = base.gameObject.GetComponentsInChildren<GazeTarget>();
			for (int i = 0; i < componentsInChildren.Length; i++)
			{
				MeshRenderer component = componentsInChildren[i].GetComponent<MeshRenderer>();
				if (component != null)
				{
					component.enabled = isVisible;
				}
			}
		}
	}

	private void Start()
	{
		for (int i = 0; i < NumberOfDummyTargets; i++)
		{
			GameObject obj = UnityEngine.Object.Instantiate(GazeTargetPrefab, base.transform);
			obj.name = obj.name + "_" + i;
			obj.transform.localPosition = UnityEngine.Random.insideUnitSphere * RadiusMultiplier;
			obj.transform.rotation = Quaternion.identity;
			obj.GetComponent<MeshRenderer>().enabled = IsVisible;
		}
	}

	private void OnValidate()
	{
		IsVisible = isVisible;
	}
}
public class RemoteLoopbackManager : MonoBehaviour
{
	private class PacketLatencyPair
	{
		public byte[] PacketData;

		public float FakeLatency;
	}

	[Serializable]
	public class SimulatedLatencySettings
	{
		[Range(0f, 0.5f)]
		public float FakeLatencyMax = 0.25f;

		[Range(0f, 0.5f)]
		public float FakeLatencyMin = 0.002f;

		[Range(0f, 1f)]
		public float LatencyWeight = 0.25f;

		[Range(0f, 10f)]
		public int MaxSamples = 4;

		internal float AverageWindow;

		internal float LatencySum;

		internal LinkedList<float> LatencyValues = new LinkedList<float>();

		public float NextValue()
		{
			AverageWindow = LatencySum / (float)LatencyValues.Count;
			float num = UnityEngine.Random.Range(FakeLatencyMin, FakeLatencyMax);
			float num2 = AverageWindow * (1f - LatencyWeight) + LatencyWeight * num;
			if (LatencyValues.Count >= MaxSamples)
			{
				LatencySum -= LatencyValues.First.Value;
				LatencyValues.RemoveFirst();
			}
			LatencySum += num2;
			LatencyValues.AddLast(num2);
			return num2;
		}
	}

	public OvrAvatar LocalAvatar;

	public OvrAvatar LoopbackAvatar;

	public SimulatedLatencySettings LatencySettings = new SimulatedLatencySettings();

	private int PacketSequence;

	private LinkedList<PacketLatencyPair> packetQueue = new LinkedList<PacketLatencyPair>();

	private void Start()
	{
		LocalAvatar.RecordPackets = true;
		OvrAvatar localAvatar = LocalAvatar;
		localAvatar.PacketRecorded = (EventHandler<OvrAvatar.PacketEventArgs>)Delegate.Combine(localAvatar.PacketRecorded, new EventHandler<OvrAvatar.PacketEventArgs>(OnLocalAvatarPacketRecorded));
		float num = UnityEngine.Random.Range(LatencySettings.FakeLatencyMin, LatencySettings.FakeLatencyMax);
		LatencySettings.LatencyValues.AddFirst(num);
		LatencySettings.LatencySum += num;
	}

	private void OnLocalAvatarPacketRecorded(object sender, OvrAvatar.PacketEventArgs args)
	{
		using MemoryStream memoryStream = new MemoryStream();
		BinaryWriter binaryWriter = new BinaryWriter(memoryStream);
		if (LocalAvatar.UseSDKPackets)
		{
			uint num = Oculus.Avatar.CAPI.ovrAvatarPacket_GetSize(args.Packet.ovrNativePacket);
			byte[] buffer = new byte[num];
			Oculus.Avatar.CAPI.ovrAvatarPacket_Write(args.Packet.ovrNativePacket, num, buffer);
			binaryWriter.Write(PacketSequence++);
			binaryWriter.Write(num);
			binaryWriter.Write(buffer);
		}
		else
		{
			binaryWriter.Write(PacketSequence++);
			args.Packet.Write(memoryStream);
		}
		SendPacketData(memoryStream.ToArray());
	}

	private void Update()
	{
		if (packetQueue.Count <= 0)
		{
			return;
		}
		List<PacketLatencyPair> list = new List<PacketLatencyPair>();
		foreach (PacketLatencyPair item in packetQueue)
		{
			item.FakeLatency -= Time.deltaTime;
			if (item.FakeLatency < 0f)
			{
				ReceivePacketData(item.PacketData);
				list.Add(item);
			}
		}
		foreach (PacketLatencyPair item2 in list)
		{
			packetQueue.Remove(item2);
		}
	}

	private void SendPacketData(byte[] data)
	{
		PacketLatencyPair packetLatencyPair = new PacketLatencyPair();
		packetLatencyPair.PacketData = data;
		packetLatencyPair.FakeLatency = LatencySettings.NextValue();
		packetQueue.AddLast(packetLatencyPair);
	}

	private void ReceivePacketData(byte[] data)
	{
		using MemoryStream memoryStream = new MemoryStream(data);
		BinaryReader binaryReader = new BinaryReader(memoryStream);
		int sequence = binaryReader.ReadInt32();
		OvrAvatarPacket packet;
		if (LoopbackAvatar.UseSDKPackets)
		{
			int count = binaryReader.ReadInt32();
			byte[] buffer = binaryReader.ReadBytes(count);
			IntPtr ovrNativePacket = Oculus.Avatar.CAPI.ovrAvatarPacket_Read((uint)data.Length, buffer);
			packet = new OvrAvatarPacket
			{
				ovrNativePacket = ovrNativePacket
			};
		}
		else
		{
			packet = OvrAvatarPacket.Read(memoryStream);
		}
		LoopbackAvatar.GetComponent<OvrAvatarRemoteDriver>().QueuePacket(sequence, packet);
	}
}
public class P2PManager
{
	private enum MessageType : byte
	{
		Update = 1
	}

	public P2PManager()
	{
		Net.SetPeerConnectRequestCallback(PeerConnectRequestCallback);
		Net.SetConnectionStateChangedCallback(ConnectionStateChangedCallback);
	}

	public void ConnectTo(ulong userID)
	{
		if (SocialPlatformManager.MyID < userID)
		{
			Net.Connect(userID);
			SocialPlatformManager.LogOutput("P2P connect to " + userID);
		}
	}

	public void Disconnect(ulong userID)
	{
		if (userID != 0L)
		{
			Net.Close(userID);
			RemotePlayer remoteUser = SocialPlatformManager.GetRemoteUser(userID);
			if (remoteUser != null)
			{
				remoteUser.p2pConnectionState = PeerConnectionState.Unknown;
			}
		}
	}

	private void PeerConnectRequestCallback(Message<NetworkingPeer> msg)
	{
		SocialPlatformManager.LogOutput("P2P request from " + msg.Data.ID);
		if (SocialPlatformManager.GetRemoteUser(msg.Data.ID) != null)
		{
			SocialPlatformManager.LogOutput("P2P request accepted from " + msg.Data.ID);
			Net.Accept(msg.Data.ID);
		}
	}

	private void ConnectionStateChangedCallback(Message<NetworkingPeer> msg)
	{
		SocialPlatformManager.LogOutput("P2P state to " + msg.Data.ID + " changed to  " + msg.Data.State);
		RemotePlayer remoteUser = SocialPlatformManager.GetRemoteUser(msg.Data.ID);
		if (remoteUser != null)
		{
			remoteUser.p2pConnectionState = msg.Data.State;
			if (msg.Data.State == PeerConnectionState.Timeout && SocialPlatformManager.MyID < msg.Data.ID)
			{
				Net.Connect(msg.Data.ID);
				SocialPlatformManager.LogOutput("P2P re-connect to " + msg.Data.ID);
			}
		}
	}

	public void SendAvatarUpdate(ulong userID, Transform rootTransform, uint sequence, byte[] avatarPacket)
	{
		byte[] array = new byte[avatarPacket.Length + 41];
		int offset = 0;
		PackByte(1, array, ref offset);
		PackULong(SocialPlatformManager.MyID, array, ref offset);
		PackFloat(rootTransform.position.x, array, ref offset);
		PackFloat(0f, array, ref offset);
		PackFloat(rootTransform.position.z, array, ref offset);
		PackFloat(rootTransform.rotation.x, array, ref offset);
		PackFloat(rootTransform.rotation.y, array, ref offset);
		PackFloat(rootTransform.rotation.z, array, ref offset);
		PackFloat(rootTransform.rotation.w, array, ref offset);
		PackUInt32(sequence, array, ref offset);
		Buffer.BlockCopy(avatarPacket, 0, array, offset, avatarPacket.Length);
		Net.SendPacket(userID, array, SendPolicy.Unreliable);
	}

	public void GetRemotePackets()
	{
		Packet packet;
		while ((packet = Net.ReadPacket()) != null)
		{
			byte[] packet2 = new byte[packet.Size];
			packet.ReadBytes(packet2);
			int offset = 0;
			MessageType messageType = (MessageType)ReadByte(packet2, ref offset);
			ulong num = ReadULong(packet2, ref offset);
			RemotePlayer remoteUser = SocialPlatformManager.GetRemoteUser(num);
			if (remoteUser == null)
			{
				SocialPlatformManager.LogOutput("Unknown remote player: " + num);
			}
			else if (messageType == MessageType.Update)
			{
				processAvatarPacket(remoteUser, ref packet2, ref offset);
			}
			else
			{
				SocialPlatformManager.LogOutput("Invalid packet type: " + packet.Size);
			}
		}
	}

	public void processAvatarPacket(RemotePlayer remote, ref byte[] packet, ref int offset)
	{
		if (remote != null)
		{
			remote.receivedRootPositionPrior = remote.receivedRootPosition;
			remote.receivedRootPosition.x = ReadFloat(packet, ref offset);
			remote.receivedRootPosition.y = ReadFloat(packet, ref offset);
			remote.receivedRootPosition.z = ReadFloat(packet, ref offset);
			remote.receivedRootRotationPrior = remote.receivedRootRotation;
			remote.receivedRootRotation.x = ReadFloat(packet, ref offset);
			remote.receivedRootRotation.y = ReadFloat(packet, ref offset);
			remote.receivedRootRotation.z = ReadFloat(packet, ref offset);
			remote.receivedRootRotation.w = ReadFloat(packet, ref offset);
			remote.RemoteAvatar.transform.position = remote.receivedRootPosition;
			remote.RemoteAvatar.transform.rotation = remote.receivedRootRotation;
			int sequence = (int)ReadUInt32(packet, ref offset);
			byte[] array = new byte[packet.Length - offset];
			Buffer.BlockCopy(packet, offset, array, 0, array.Length);
			IntPtr ovrNativePacket = Oculus.Avatar.CAPI.ovrAvatarPacket_Read((uint)array.Length, array);
			OvrAvatarPacket packet2 = new OvrAvatarPacket
			{
				ovrNativePacket = ovrNativePacket
			};
			remote.RemoteAvatar.GetComponent<OvrAvatarRemoteDriver>().QueuePacket(sequence, packet2);
		}
	}

	private void PackByte(byte b, byte[] buf, ref int offset)
	{
		buf[offset] = b;
		offset++;
	}

	private byte ReadByte(byte[] buf, ref int offset)
	{
		byte result = buf[offset];
		offset++;
		return result;
	}

	private void PackFloat(float f, byte[] buf, ref int offset)
	{
		Buffer.BlockCopy(BitConverter.GetBytes(f), 0, buf, offset, 4);
		offset += 4;
	}

	private float ReadFloat(byte[] buf, ref int offset)
	{
		float result = BitConverter.ToSingle(buf, offset);
		offset += 4;
		return result;
	}

	private void PackULong(ulong u, byte[] buf, ref int offset)
	{
		Buffer.BlockCopy(BitConverter.GetBytes(u), 0, buf, offset, 8);
		offset += 8;
	}

	private ulong ReadULong(byte[] buf, ref int offset)
	{
		ulong result = BitConverter.ToUInt64(buf, offset);
		offset += 8;
		return result;
	}

	private void PackUInt32(uint u, byte[] buf, ref int offset)
	{
		Buffer.BlockCopy(BitConverter.GetBytes(u), 0, buf, offset, 4);
		offset += 4;
	}

	private uint ReadUInt32(byte[] buf, ref int offset)
	{
		uint result = BitConverter.ToUInt32(buf, offset);
		offset += 4;
		return result;
	}
}
public class PlayerController : SocialPlatformManager
{
	public Camera spyCamera;

	private GameObject cameraRig;

	private bool showUI = true;

	public override void Awake()
	{
		base.Awake();
		cameraRig = localPlayerHead.gameObject;
	}

	public override void Start()
	{
		base.Start();
		spyCamera.enabled = false;
	}

	public override void Update()
	{
		base.Update();
		checkInput();
	}

	private void checkInput()
	{
		if (UnityEngine.Application.platform == RuntimePlatform.Android)
		{
			if (OVRInput.GetDown(OVRInput.Button.Back))
			{
				Rooms.LaunchInvitableUserFlow(roomManager.roomID);
			}
			if (OVRInput.GetDown(OVRInput.Button.PrimaryTouchpad))
			{
				ToggleCamera();
			}
			if (OVRInput.GetDown(OVRInput.Button.PrimaryIndexTrigger))
			{
				ToggleUI();
			}
		}
		else
		{
			if (OVRInput.GetDown(OVRInput.Button.Three))
			{
				Rooms.LaunchInvitableUserFlow(roomManager.roomID);
			}
			if (OVRInput.GetDown(OVRInput.Button.Four))
			{
				ToggleCamera();
			}
			if (OVRInput.GetDown(OVRInput.Button.PrimaryThumbstick))
			{
				ToggleUI();
			}
		}
	}

	private void ToggleCamera()
	{
		spyCamera.enabled = !spyCamera.enabled;
		localAvatar.ShowThirdPerson = !localAvatar.ShowThirdPerson;
		cameraRig.SetActive(!cameraRig.activeSelf);
	}

	private void ToggleUI()
	{
		showUI = !showUI;
		helpPanel.SetActive(showUI);
		localAvatar.ShowLeftController(showUI);
	}
}
public class RemotePlayer
{
	public ulong remoteUserID;

	public bool stillInRoom;

	public PeerConnectionState p2pConnectionState;

	public PeerConnectionState voipConnectionState;

	public OvrAvatar RemoteAvatar;

	public Vector3 receivedRootPosition;

	public Vector3 receivedRootPositionPrior;

	public Quaternion receivedRootRotation;

	public Quaternion receivedRootRotationPrior;

	public VoipAudioSourceHiLevel voipSource;
}
public class RoomManager
{
	public ulong roomID;

	private ulong invitedRoomID;

	private bool amIServer;

	private bool startupDone;

	public RoomManager()
	{
		amIServer = false;
		startupDone = false;
		Rooms.SetRoomInviteAcceptedNotificationCallback(AcceptingInviteCallback);
		Rooms.SetUpdateNotificationCallback(RoomUpdateCallback);
	}

	private void AcceptingInviteCallback(Message<string> msg)
	{
		if (msg.IsError)
		{
			SocialPlatformManager.TerminateWithError(msg);
			return;
		}
		SocialPlatformManager.LogOutput("Launched Invite to join Room: " + msg.Data);
		invitedRoomID = Convert.ToUInt64(msg.GetString());
		if (startupDone)
		{
			CheckForInvite();
		}
	}

	public bool CheckForInvite()
	{
		startupDone = true;
		if (invitedRoomID != 0L)
		{
			JoinExistingRoom(invitedRoomID);
			return true;
		}
		return false;
	}

	public void CreateRoom()
	{
		Rooms.CreateAndJoinPrivate(RoomJoinPolicy.FriendsOfOwner, 4u, subscribeToUpdates: true).OnComplete(CreateAndJoinPrivateRoomCallback);
	}

	private void CreateAndJoinPrivateRoomCallback(Message<Oculus.Platform.Models.Room> msg)
	{
		if (msg.IsError)
		{
			SocialPlatformManager.TerminateWithError(msg);
			return;
		}
		roomID = msg.Data.ID;
		if (msg.Data.OwnerOptional != null && msg.Data.OwnerOptional.ID == SocialPlatformManager.MyID)
		{
			amIServer = true;
		}
		else
		{
			amIServer = false;
		}
		SocialPlatformManager.TransitionToState(SocialPlatformManager.State.WAITING_IN_A_ROOM);
		SocialPlatformManager.SetFloorColorForState(amIServer);
	}

	private void OnLaunchInviteWorkflowComplete(Message msg)
	{
		if (msg.IsError)
		{
			SocialPlatformManager.TerminateWithError(msg);
		}
	}

	public void JoinExistingRoom(ulong roomID)
	{
		SocialPlatformManager.TransitionToState(SocialPlatformManager.State.JOINING_A_ROOM);
		Rooms.Join(roomID, subscribeToUpdates: true).OnComplete(JoinRoomCallback);
	}

	private void JoinRoomCallback(Message<Oculus.Platform.Models.Room> msg)
	{
		if (!msg.IsError)
		{
			string text = ((msg.Data.OwnerOptional != null) ? msg.Data.OwnerOptional.OculusID : "null");
			int num = ((msg.Data.UsersOptional != null) ? msg.Data.UsersOptional.Count : 0);
			SocialPlatformManager.LogOutput("Joined Room " + msg.Data.ID + " owner: " + text + " count: " + num);
			roomID = msg.Data.ID;
			ProcessRoomData(msg);
		}
	}

	private void RoomUpdateCallback(Message<Oculus.Platform.Models.Room> msg)
	{
		if (msg.IsError)
		{
			SocialPlatformManager.TerminateWithError(msg);
			return;
		}
		string text = ((msg.Data.OwnerOptional != null) ? msg.Data.OwnerOptional.OculusID : "null");
		int num = ((msg.Data.UsersOptional != null) ? msg.Data.UsersOptional.Count : 0);
		SocialPlatformManager.LogOutput("Room Update " + msg.Data.ID + " owner: " + text + " count: " + num);
		ProcessRoomData(msg);
	}

	public void LeaveCurrentRoom()
	{
		if (roomID != 0L)
		{
			Rooms.Leave(roomID);
			roomID = 0uL;
		}
		SocialPlatformManager.TransitionToState(SocialPlatformManager.State.LEAVING_A_ROOM);
	}

	private void ProcessRoomData(Message<Oculus.Platform.Models.Room> msg)
	{
		if (msg.Data.OwnerOptional != null && msg.Data.OwnerOptional.ID == SocialPlatformManager.MyID)
		{
			amIServer = true;
		}
		else
		{
			amIServer = false;
		}
		if (msg.Data.UsersOptional != null && msg.Data.UsersOptional.Count == 1)
		{
			SocialPlatformManager.TransitionToState(SocialPlatformManager.State.WAITING_IN_A_ROOM);
		}
		else
		{
			SocialPlatformManager.TransitionToState(SocialPlatformManager.State.CONNECTED_IN_A_ROOM);
		}
		SocialPlatformManager.MarkAllRemoteUsersAsNotInRoom();
		if (msg.Data.UsersOptional != null)
		{
			foreach (User item in msg.Data.UsersOptional)
			{
				if (item.ID != SocialPlatformManager.MyID)
				{
					if (!SocialPlatformManager.IsUserInRoom(item.ID))
					{
						SocialPlatformManager.AddRemoteUser(item.ID);
					}
					else
					{
						SocialPlatformManager.MarkRemoteUserInRoom(item.ID);
					}
				}
			}
		}
		SocialPlatformManager.ForgetRemoteUsersNotInRoom();
		SocialPlatformManager.SetFloorColorForState(amIServer);
	}
}
public class SocialPlatformManager : MonoBehaviour
{
	public enum State
	{
		INITIALIZING,
		CHECKING_LAUNCH_STATE,
		CREATING_A_ROOM,
		WAITING_IN_A_ROOM,
		JOINING_A_ROOM,
		CONNECTED_IN_A_ROOM,
		LEAVING_A_ROOM,
		SHUTDOWN
	}

	private static readonly Vector3 START_ROTATION_ONE = new Vector3(0f, 180f, 0f);

	private static readonly Vector3 START_POSITION_ONE = new Vector3(0f, 4f, 5f);

	private static readonly Vector3 START_ROTATION_TWO = new Vector3(0f, 0f, 0f);

	private static readonly Vector3 START_POSITION_TWO = new Vector3(0f, 4f, -5f);

	private static readonly Vector3 START_ROTATION_THREE = new Vector3(0f, 270f, 0f);

	private static readonly Vector3 START_POSITION_THREE = new Vector3(5f, 4f, 0f);

	private static readonly Vector3 START_ROTATION_FOUR = new Vector3(0f, 90f, 0f);

	private static readonly Vector3 START_POSITION_FOUR = new Vector3(-5f, 4f, 0f);

	private static readonly Color BLACK = new Color(0f, 0f, 0f);

	private static readonly Color WHITE = new Color(1f, 1f, 1f);

	private static readonly Color CYAN = new Color(0f, 1f, 1f);

	private static readonly Color BLUE = new Color(0f, 0f, 1f);

	private static readonly Color GREEN = new Color(0f, 1f, 0f);

	private float voiceCurrent;

	private uint packetSequence;

	public OvrAvatar localAvatarPrefab;

	public OvrAvatar remoteAvatarPrefab;

	public GameObject helpPanel;

	protected MeshRenderer helpMesh;

	public Material riftMaterial;

	public Material gearMaterial;

	protected OvrAvatar localAvatar;

	protected GameObject localTrackingSpace;

	protected GameObject localPlayerHead;

	protected Dictionary<ulong, RemotePlayer> remoteUsers = new Dictionary<ulong, RemotePlayer>();

	public GameObject roomSphere;

	protected MeshRenderer sphereMesh;

	public GameObject roomFloor;

	protected MeshRenderer floorMesh;

	protected State currentState;

	protected static SocialPlatformManager s_instance = null;

	protected RoomManager roomManager;

	protected P2PManager p2pManager;

	protected VoipManager voipManager;

	protected ulong myID;

	protected string myOculusID;

	public static readonly float VOIP_SCALE = 2f;

	public static State CurrentState => s_instance.currentState;

	public static ulong MyID
	{
		get
		{
			if (s_instance != null)
			{
				return s_instance.myID;
			}
			return 0uL;
		}
	}

	public static string MyOculusID
	{
		get
		{
			if (s_instance != null && s_instance.myOculusID != null)
			{
				return s_instance.myOculusID;
			}
			return string.Empty;
		}
	}

	public virtual void Update()
	{
		p2pManager.GetRemotePackets();
		foreach (KeyValuePair<ulong, RemotePlayer> remoteUser in remoteUsers)
		{
			if (remoteUser.Value.voipSource == null && remoteUser.Value.RemoteAvatar.MouthAnchor != null)
			{
				remoteUser.Value.voipSource = remoteUser.Value.RemoteAvatar.MouthAnchor.AddComponent<VoipAudioSourceHiLevel>();
				remoteUser.Value.voipSource.senderID = remoteUser.Value.remoteUserID;
			}
			if (remoteUser.Value.voipSource != null)
			{
				float voiceAmplitude = Mathf.Clamp(remoteUser.Value.voipSource.peakAmplitude * VOIP_SCALE, 0f, 1f);
				remoteUser.Value.RemoteAvatar.VoiceAmplitude = voiceAmplitude;
			}
		}
		if (localAvatar != null)
		{
			localAvatar.VoiceAmplitude = Mathf.Clamp(voiceCurrent * VOIP_SCALE, 0f, 1f);
		}
		Request.RunCallbacks();
	}

	public virtual void Awake()
	{
		LogOutputLine("Start Log.");
		helpMesh = helpPanel.GetComponent<MeshRenderer>();
		sphereMesh = roomSphere.GetComponent<MeshRenderer>();
		floorMesh = roomFloor.GetComponent<MeshRenderer>();
		localTrackingSpace = base.transform.Find("OVRCameraRig/TrackingSpace").gameObject;
		localPlayerHead = base.transform.Find("OVRCameraRig/TrackingSpace/CenterEyeAnchor").gameObject;
		if (s_instance != null)
		{
			UnityEngine.Object.Destroy(base.gameObject);
			return;
		}
		s_instance = this;
		UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
		TransitionToState(State.INITIALIZING);
		Core.AsyncInitialize().OnComplete(InitCallback);
		roomManager = new RoomManager();
		p2pManager = new P2PManager();
		voipManager = new VoipManager();
	}

	private void InitCallback(Message<PlatformInitialize> msg)
	{
		if (msg.IsError)
		{
			TerminateWithError(msg);
			return;
		}
		LaunchDetails launchDetails = ApplicationLifecycle.GetLaunchDetails();
		LogOutput("App launched with LaunchType " + launchDetails.LaunchType);
		Entitlements.IsUserEntitledToApplication().OnComplete(IsEntitledCallback);
	}

	public virtual void Start()
	{
	}

	private void IsEntitledCallback(Message msg)
	{
		if (msg.IsError)
		{
			TerminateWithError(msg);
		}
		else
		{
			Users.GetLoggedInUser().OnComplete(GetLoggedInUserCallback);
		}
	}

	private void GetLoggedInUserCallback(Message<User> msg)
	{
		if (msg.IsError)
		{
			TerminateWithError(msg);
			return;
		}
		myID = msg.Data.ID;
		myOculusID = msg.Data.OculusID;
		localAvatar = UnityEngine.Object.Instantiate(localAvatarPrefab);
		localAvatar.CanOwnMicrophone = false;
		localTrackingSpace = base.transform.Find("OVRCameraRig/TrackingSpace").gameObject;
		localAvatar.transform.SetParent(localTrackingSpace.transform, worldPositionStays: false);
		localAvatar.transform.localPosition = new Vector3(0f, 0f, 0f);
		localAvatar.transform.localRotation = Quaternion.identity;
		if (UnityEngine.Application.platform == RuntimePlatform.Android)
		{
			helpPanel.transform.SetParent(localAvatar.transform.Find("body"), worldPositionStays: false);
			helpPanel.transform.localPosition = new Vector3(0f, 1f, 1f);
			helpMesh.material = gearMaterial;
		}
		else
		{
			helpPanel.transform.SetParent(localAvatar.transform.Find("hand_left"), worldPositionStays: false);
			helpPanel.transform.localPosition = new Vector3(0f, 0.2f, 0.2f);
			helpMesh.material = riftMaterial;
		}
		localAvatar.oculusUserID = myID.ToString();
		localAvatar.RecordPackets = true;
		OvrAvatar ovrAvatar = localAvatar;
		ovrAvatar.PacketRecorded = (EventHandler<OvrAvatar.PacketEventArgs>)Delegate.Combine(ovrAvatar.PacketRecorded, new EventHandler<OvrAvatar.PacketEventArgs>(OnLocalAvatarPacketRecorded));
		localAvatar.EnableMouthVertexAnimation = true;
		Quaternion identity = Quaternion.identity;
		switch (UnityEngine.Random.Range(0, 4))
		{
		case 0:
			identity.eulerAngles = START_ROTATION_ONE;
			base.transform.localPosition = START_POSITION_ONE;
			base.transform.localRotation = identity;
			break;
		case 1:
			identity.eulerAngles = START_ROTATION_TWO;
			base.transform.localPosition = START_POSITION_TWO;
			base.transform.localRotation = identity;
			break;
		case 2:
			identity.eulerAngles = START_ROTATION_THREE;
			base.transform.localPosition = START_POSITION_THREE;
			base.transform.localRotation = identity;
			break;
		default:
			identity.eulerAngles = START_ROTATION_FOUR;
			base.transform.localPosition = START_POSITION_FOUR;
			base.transform.localRotation = identity;
			break;
		}
		TransitionToState(State.CHECKING_LAUNCH_STATE);
		if (!roomManager.CheckForInvite())
		{
			LogOutput("No invite on launch, looking for a friend to join.");
			Users.GetLoggedInUserFriendsAndRooms().OnComplete(GetLoggedInUserFriendsAndRoomsCallback);
		}
		Voip.SetMicrophoneFilterCallback(MicFilter);
	}

	private void GetLoggedInUserFriendsAndRoomsCallback(Message<UserAndRoomList> msg)
	{
		if (msg.IsError)
		{
			return;
		}
		foreach (UserAndRoom datum in msg.Data)
		{
			if (datum.User != null && datum.RoomOptional != null && !datum.RoomOptional.IsMembershipLocked && datum.RoomOptional.Joinability == RoomJoinability.CanJoin && datum.RoomOptional.JoinPolicy != 0)
			{
				LogOutput("Trying to join room " + datum.RoomOptional.ID + ", friend " + datum.User.OculusID);
				roomManager.JoinExistingRoom(datum.RoomOptional.ID);
				return;
			}
		}
		LogOutput("No friend to join. Creating my own room.");
		roomManager.CreateRoom();
		TransitionToState(State.CREATING_A_ROOM);
	}

	public void OnLocalAvatarPacketRecorded(object sender, OvrAvatar.PacketEventArgs args)
	{
		uint num = Oculus.Avatar.CAPI.ovrAvatarPacket_GetSize(args.Packet.ovrNativePacket);
		byte[] array = new byte[num];
		Oculus.Avatar.CAPI.ovrAvatarPacket_Write(args.Packet.ovrNativePacket, num, array);
		foreach (KeyValuePair<ulong, RemotePlayer> remoteUser in remoteUsers)
		{
			p2pManager.SendAvatarUpdate(remoteUser.Key, localTrackingSpace.transform, packetSequence, array);
		}
		packetSequence++;
	}

	public void OnApplicationQuit()
	{
		roomManager.LeaveCurrentRoom();
		foreach (KeyValuePair<ulong, RemotePlayer> remoteUser in remoteUsers)
		{
			p2pManager.Disconnect(remoteUser.Key);
			voipManager.Disconnect(remoteUser.Key);
		}
		LogOutputLine("End Log.");
	}

	public void AddUser(ulong userID, ref RemotePlayer remoteUser)
	{
		remoteUsers.Add(userID, remoteUser);
	}

	public void LogOutputLine(string line)
	{
		UnityEngine.Debug.Log(Time.time + ": " + line);
	}

	public static void TerminateWithError(Message msg)
	{
		s_instance.LogOutputLine("Error: " + msg.GetError().Message);
		UnityEngine.Application.Quit();
	}

	public static void TransitionToState(State newState)
	{
		if ((bool)s_instance)
		{
			s_instance.LogOutputLine(string.Concat("State ", s_instance.currentState, " -> ", newState));
		}
		if ((bool)s_instance && s_instance.currentState != newState)
		{
			s_instance.currentState = newState;
			if (newState == State.SHUTDOWN)
			{
				s_instance.OnApplicationQuit();
			}
		}
		SetSphereColorForState();
	}

	private static void SetSphereColorForState()
	{
		switch (s_instance.currentState)
		{
		case State.INITIALIZING:
		case State.SHUTDOWN:
			s_instance.sphereMesh.material.color = BLACK;
			break;
		case State.WAITING_IN_A_ROOM:
			s_instance.sphereMesh.material.color = WHITE;
			break;
		case State.CONNECTED_IN_A_ROOM:
			s_instance.sphereMesh.material.color = CYAN;
			break;
		}
	}

	public static void SetFloorColorForState(bool host)
	{
		if (host)
		{
			s_instance.floorMesh.material.color = BLUE;
		}
		else
		{
			s_instance.floorMesh.material.color = GREEN;
		}
	}

	public static void MarkAllRemoteUsersAsNotInRoom()
	{
		foreach (KeyValuePair<ulong, RemotePlayer> remoteUser in s_instance.remoteUsers)
		{
			remoteUser.Value.stillInRoom = false;
		}
	}

	public static void MarkRemoteUserInRoom(ulong userID)
	{
		RemotePlayer value = new RemotePlayer();
		if (s_instance.remoteUsers.TryGetValue(userID, out value))
		{
			value.stillInRoom = true;
		}
	}

	public static void ForgetRemoteUsersNotInRoom()
	{
		List<ulong> list = new List<ulong>();
		foreach (KeyValuePair<ulong, RemotePlayer> remoteUser in s_instance.remoteUsers)
		{
			if (!remoteUser.Value.stillInRoom)
			{
				list.Add(remoteUser.Key);
			}
		}
		foreach (ulong item in list)
		{
			RemoveRemoteUser(item);
		}
	}

	public static void LogOutput(string line)
	{
		s_instance.LogOutputLine(Time.time + ": " + line);
	}

	public static bool IsUserInRoom(ulong userID)
	{
		return s_instance.remoteUsers.ContainsKey(userID);
	}

	public static void AddRemoteUser(ulong userID)
	{
		RemotePlayer remoteUser = new RemotePlayer();
		remoteUser.RemoteAvatar = UnityEngine.Object.Instantiate(s_instance.remoteAvatarPrefab);
		remoteUser.RemoteAvatar.oculusUserID = userID.ToString();
		remoteUser.RemoteAvatar.ShowThirdPerson = true;
		remoteUser.RemoteAvatar.EnableMouthVertexAnimation = true;
		remoteUser.p2pConnectionState = PeerConnectionState.Unknown;
		remoteUser.voipConnectionState = PeerConnectionState.Unknown;
		remoteUser.stillInRoom = true;
		remoteUser.remoteUserID = userID;
		s_instance.AddUser(userID, ref remoteUser);
		s_instance.p2pManager.ConnectTo(userID);
		s_instance.voipManager.ConnectTo(userID);
		s_instance.LogOutputLine("Adding User " + userID);
	}

	public static void RemoveRemoteUser(ulong userID)
	{
		RemotePlayer value = new RemotePlayer();
		if (s_instance.remoteUsers.TryGetValue(userID, out value))
		{
			UnityEngine.Object.Destroy(value.RemoteAvatar.MouthAnchor.GetComponent<VoipAudioSourceHiLevel>(), 0f);
			UnityEngine.Object.Destroy(value.RemoteAvatar.gameObject, 0f);
			s_instance.remoteUsers.Remove(userID);
			s_instance.LogOutputLine("Removing User " + userID);
		}
	}

	public void UpdateVoiceData(short[] pcmData, int numChannels)
	{
		if (localAvatar != null)
		{
			localAvatar.UpdateVoiceData(pcmData, numChannels);
		}
		float num = 0f;
		float[] array = new float[pcmData.Length];
		for (int i = 0; i < pcmData.Length; i++)
		{
			float num2 = (array[i] = (float)pcmData[i] / 32767f);
			if (num2 > num)
			{
				num = num2;
			}
		}
		voiceCurrent = num;
	}

	[MonoPInvokeCallback(typeof(Oculus.Platform.CAPI.FilterCallback))]
	public static void MicFilter(short[] pcmData, UIntPtr pcmDataLength, int frequency, int numChannels)
	{
		s_instance.UpdateVoiceData(pcmData, numChannels);
	}

	public static RemotePlayer GetRemoteUser(ulong userID)
	{
		RemotePlayer value = new RemotePlayer();
		if (s_instance.remoteUsers.TryGetValue(userID, out value))
		{
			return value;
		}
		return null;
	}
}
public class VoipManager
{
	public VoipManager()
	{
		Voip.SetVoipConnectRequestCallback(VoipConnectRequestCallback);
		Voip.SetVoipStateChangeCallback(VoipStateChangedCallback);
	}

	public void ConnectTo(ulong userID)
	{
		if (SocialPlatformManager.MyID < userID)
		{
			Voip.Start(userID);
			SocialPlatformManager.LogOutput("Voip connect to " + userID);
		}
	}

	public void Disconnect(ulong userID)
	{
		if (userID != 0L)
		{
			Voip.Stop(userID);
			RemotePlayer remoteUser = SocialPlatformManager.GetRemoteUser(userID);
			if (remoteUser != null)
			{
				remoteUser.voipConnectionState = PeerConnectionState.Unknown;
			}
		}
	}

	private void VoipConnectRequestCallback(Message<NetworkingPeer> msg)
	{
		SocialPlatformManager.LogOutput("Voip request from " + msg.Data.ID);
		if (SocialPlatformManager.GetRemoteUser(msg.Data.ID) != null)
		{
			SocialPlatformManager.LogOutput("Voip request accepted from " + msg.Data.ID);
			Voip.Accept(msg.Data.ID);
		}
	}

	private void VoipStateChangedCallback(Message<NetworkingPeer> msg)
	{
		SocialPlatformManager.LogOutput("Voip state to " + msg.Data.ID + " changed to  " + msg.Data.State);
		RemotePlayer remoteUser = SocialPlatformManager.GetRemoteUser(msg.Data.ID);
		if (remoteUser != null)
		{
			remoteUser.voipConnectionState = msg.Data.State;
			if (msg.Data.State == PeerConnectionState.Timeout && SocialPlatformManager.MyID < msg.Data.ID)
			{
				Voip.Start(msg.Data.ID);
				SocialPlatformManager.LogOutput("Voip re-connect to " + msg.Data.ID);
			}
		}
	}
}
public class GazeTarget : MonoBehaviour
{
	public ovrAvatarGazeTargetType Type;

	private static ovrAvatarGazeTargets RuntimeTargetList;

	static GazeTarget()
	{
		RuntimeTargetList.targets = new ovrAvatarGazeTarget[128];
		RuntimeTargetList.targetCount = 1u;
	}

	private void Start()
	{
		UpdateGazeTarget();
		base.transform.hasChanged = false;
	}

	private void Update()
	{
		if (base.transform.hasChanged)
		{
			base.transform.hasChanged = false;
			UpdateGazeTarget();
		}
	}

	private void OnDestroy()
	{
		Oculus.Avatar.CAPI.ovrAvatar_RemoveGazeTargets(1u, new uint[1] { (uint)base.transform.GetInstanceID() });
	}

	private void UpdateGazeTarget()
	{
		ovrAvatarGazeTarget ovrAvatarGazeTarget2 = CreateOvrGazeTarget((uint)base.transform.GetInstanceID(), base.transform.position, Type);
		RuntimeTargetList.targets[0] = ovrAvatarGazeTarget2;
		Oculus.Avatar.CAPI.ovrAvatar_UpdateGazeTargets(RuntimeTargetList);
	}

	private ovrAvatarGazeTarget CreateOvrGazeTarget(uint targetId, Vector3 targetPosition, ovrAvatarGazeTargetType targetType)
	{
		ovrAvatarGazeTarget result = default(ovrAvatarGazeTarget);
		result.id = targetId;
		result.worldPosition = new Vector3(targetPosition.x, targetPosition.y, 0f - targetPosition.z);
		result.type = targetType;
		return result;
	}
}
[Serializable]
public class AvatarLayer
{
	public int layerIndex;
}
[Serializable]
public class PacketRecordSettings
{
	internal bool RecordingFrames;

	public float UpdateRate = 1f / 30f;

	internal float AccumulatedTime;
}
public class OvrAvatar : MonoBehaviour
{
	public class PacketEventArgs : EventArgs
	{
		public readonly OvrAvatarPacket Packet;

		public PacketEventArgs(OvrAvatarPacket packet)
		{
			Packet = packet;
		}
	}

	public enum HandType
	{
		Right,
		Left,
		Max
	}

	public enum HandJoint
	{
		HandBase,
		IndexBase,
		IndexTip,
		ThumbBase,
		ThumbTip,
		Max
	}

	[Header("Avatar")]
	public IntPtr sdkAvatar = IntPtr.Zero;

	public string oculusUserID;

	public OvrAvatarDriver Driver;

	[Header("Capabilities")]
	public bool EnableBody = true;

	public bool EnableHands = true;

	public bool EnableBase = true;

	public bool EnableExpressive;

	[Header("Network")]
	public bool RecordPackets;

	public bool UseSDKPackets = true;

	public PacketRecordSettings PacketSettings = new PacketRecordSettings();

	[Header("Visibility")]
	public bool StartWithControllers;

	public AvatarLayer FirstPersonLayer;

	public AvatarLayer ThirdPersonLayer;

	public bool ShowFirstPerson = true;

	public bool ShowThirdPerson;

	internal ovrAvatarCapabilities Capabilities = ovrAvatarCapabilities.Body;

	[Header("Performance")]
	[Tooltip("LOD mesh complexity and texture resolution. Highest LOD recommended on PC and simple mobile apps. Medium LOD recommended on mobile devices or for background characters on PC. Lowest LOD recommended for background characters on mobile.")]
	[SerializeField]
	internal ovrAvatarAssetLevelOfDetail LevelOfDetail = ovrAvatarAssetLevelOfDetail.Medium;

	[Tooltip("Enable to use combined meshes to reduce draw calls. Currently only available on mobile devices. Will be forced to false on PC.")]
	private bool CombineMeshes = true;

	[Tooltip("Enable to use transparent queue, disable to use geometry queue. Requires restart to take effect.")]
	public bool UseTransparentRenderQueue = true;

	[Header("Shaders")]
	public Shader Monochrome_SurfaceShader;

	public Shader Monochrome_SurfaceShader_SelfOccluding;

	public Shader Monochrome_SurfaceShader_PBS;

	public Shader Skinshaded_SurfaceShader_SingleComponent;

	public Shader Skinshaded_VertFrag_SingleComponent;

	public Shader Skinshaded_VertFrag_CombinedMesh;

	public Shader Skinshaded_Expressive_SurfaceShader_SingleComponent;

	public Shader Skinshaded_Expressive_VertFrag_SingleComponent;

	public Shader Skinshaded_Expressive_VertFrag_CombinedMesh;

	public Shader Loader_VertFrag_CombinedMesh;

	public Shader EyeLens;

	public Shader ControllerShader;

	[Header("Other")]
	public bool CanOwnMicrophone = true;

	[Tooltip("Enable laughter detection and animation as part of OVRLipSync.")]
	public bool EnableLaughter = true;

	public GameObject MouthAnchor;

	public Transform LeftHandCustomPose;

	public Transform RightHandCustomPose;

	private HashSet<ulong> assetLoadingIds = new HashSet<ulong>();

	private bool assetsFinishedLoading;

	private int renderPartCount;

	private OvrAvatarMaterialManager materialManager;

	private bool waitingForCombinedMesh;

	private static bool doneExpressiveGlobalInit;

	private Vector4 clothingAlphaOffset = new Vector4(0f, 0f, 0f, 1f);

	private ulong clothingAlphaTexture;

	private OVRLipSyncMicInput micInput;

	private OVRLipSyncContext lipsyncContext;

	private OVRLipSync.Frame currentFrame = new OVRLipSync.Frame();

	private float[] visemes = new float[16];

	private AudioSource audioSource;

	private ONSPAudioSource spatializedSource;

	private List<float[]> voiceUpdates = new List<float[]>();

	private static ovrAvatarVisemes RuntimeVisemes;

	private Transform cachedLeftHandCustomPose;

	private Transform[] cachedCustomLeftHandJoints;

	private ovrAvatarTransform[] cachedLeftHandTransforms;

	private Transform cachedRightHandCustomPose;

	private Transform[] cachedCustomRightHandJoints;

	private ovrAvatarTransform[] cachedRightHandTransforms;

	private bool showLeftController;

	private bool showRightController;

	private const bool USE_MOBILE_TEXTURE_FORMAT = true;

	private static readonly Vector3 MOUTH_HEAD_OFFSET;

	private const string MOUTH_HELPER_NAME = "MouthAnchor";

	private const int VISEME_COUNT = 16;

	private const float ACTION_UNIT_ONSET_SPEED = 30f;

	private const float ACTION_UNIT_FALLOFF_SPEED = 20f;

	private const float VISEME_LEVEL_MULTIPLIER = 1.5f;

	internal ulong oculusUserIDInternal;

	internal OvrAvatarBase Base;

	internal OvrAvatarTouchController ControllerLeft;

	internal OvrAvatarTouchController ControllerRight;

	internal OvrAvatarBody Body;

	internal OvrAvatarHand HandLeft;

	internal OvrAvatarHand HandRight;

	internal ovrAvatarLookAndFeelVersion LookAndFeelVersion = ovrAvatarLookAndFeelVersion.Two;

	internal ovrAvatarLookAndFeelVersion FallbackLookAndFeelVersion = ovrAvatarLookAndFeelVersion.Two;

	private OvrAvatarPacket CurrentUnityPacket;

	public EventHandler<PacketEventArgs> PacketRecorded;

	private static string[,] HandJoints;

	private static Vector3 MOUTH_POSITION_OFFSET;

	private static string VOICE_PROPERTY;

	private static string MOUTH_POSITION_PROPERTY;

	private static string MOUTH_DIRECTION_PROPERTY;

	private static string MOUTH_SCALE_PROPERTY;

	private static float MOUTH_SCALE_GLOBAL;

	private static float MOUTH_MAX_GLOBAL;

	private static string NECK_JONT;

	public float VoiceAmplitude;

	public bool EnableMouthVertexAnimation;

	private static ovrAvatarLights ovrLights;

	static OvrAvatar()
	{
		doneExpressiveGlobalInit = false;
		MOUTH_HEAD_OFFSET = new Vector3(0f, -0.085f, 0.09f);
		HandJoints = new string[2, 5]
		{
			{ "hands:r_hand_world", "hands:r_hand_world/hands:b_r_hand/hands:b_r_index1", "hands:r_hand_world/hands:b_r_hand/hands:b_r_index1/hands:b_r_index2/hands:b_r_index3/hands:b_r_index_ignore", "hands:r_hand_world/hands:b_r_hand/hands:b_r_thumb1/hands:b_r_thumb2", "hands:r_hand_world/hands:b_r_hand/hands:b_r_thumb1/hands:b_r_thumb2/hands:b_r_thumb3/hands:b_r_thumb_ignore" },
			{ "hands:l_hand_world", "hands:l_hand_world/hands:b_l_hand/hands:b_l_index1", "hands:l_hand_world/hands:b_l_hand/hands:b_l_index1/hands:b_l_index2/hands:b_l_index3/hands:b_l_index_ignore", "hands:l_hand_world/hands:b_l_hand/hands:b_l_thumb1/hands:b_l_thumb2", "hands:l_hand_world/hands:b_l_hand/hands:b_l_thumb1/hands:b_l_thumb2/hands:b_l_thumb3/hands:b_l_thumb_ignore" }
		};
		MOUTH_POSITION_OFFSET = new Vector3(0f, -0.018f, 0.1051f);
		VOICE_PROPERTY = "_Voice";
		MOUTH_POSITION_PROPERTY = "_MouthPosition";
		MOUTH_DIRECTION_PROPERTY = "_MouthDirection";
		MOUTH_SCALE_PROPERTY = "_MouthEffectScale";
		MOUTH_SCALE_GLOBAL = 0.007f;
		MOUTH_MAX_GLOBAL = 0.007f;
		NECK_JONT = "root_JNT/body_JNT/chest_JNT/neckBase_JNT/neck_JNT";
		ovrLights = default(ovrAvatarLights);
		RuntimeVisemes.visemeParams = new float[32];
		RuntimeVisemes.visemeParamCount = 16u;
	}

	private void OnDestroy()
	{
		if (sdkAvatar != IntPtr.Zero)
		{
			Oculus.Avatar.CAPI.ovrAvatar_Destroy(sdkAvatar);
		}
	}

	public void AssetLoadedCallback(OvrAvatarAsset asset)
	{
		assetLoadingIds.Remove(asset.assetID);
	}

	public void CombinedMeshLoadedCallback(IntPtr assetPtr)
	{
		if (waitingForCombinedMesh)
		{
			ulong[] array = Oculus.Avatar.CAPI.ovrAvatarAsset_GetCombinedMeshIDs(assetPtr);
			foreach (ulong item in array)
			{
				assetLoadingIds.Remove(item);
			}
			Oculus.Avatar.CAPI.ovrAvatar_GetCombinedMeshAlphaData(sdkAvatar, ref clothingAlphaTexture, ref clothingAlphaOffset);
			waitingForCombinedMesh = false;
		}
	}

	private OvrAvatarSkinnedMeshRenderComponent AddSkinnedMeshRenderComponent(GameObject gameObject, ovrAvatarRenderPart_SkinnedMeshRender skinnedMeshRender)
	{
		OvrAvatarSkinnedMeshRenderComponent ovrAvatarSkinnedMeshRenderComponent = gameObject.AddComponent<OvrAvatarSkinnedMeshRenderComponent>();
		ovrAvatarSkinnedMeshRenderComponent.Initialize(skinnedMeshRender, Monochrome_SurfaceShader, Monochrome_SurfaceShader_SelfOccluding, ThirdPersonLayer.layerIndex, FirstPersonLayer.layerIndex);
		return ovrAvatarSkinnedMeshRenderComponent;
	}

	private OvrAvatarSkinnedMeshRenderPBSComponent AddSkinnedMeshRenderPBSComponent(GameObject gameObject, ovrAvatarRenderPart_SkinnedMeshRenderPBS skinnedMeshRenderPBS)
	{
		OvrAvatarSkinnedMeshRenderPBSComponent ovrAvatarSkinnedMeshRenderPBSComponent = gameObject.AddComponent<OvrAvatarSkinnedMeshRenderPBSComponent>();
		ovrAvatarSkinnedMeshRenderPBSComponent.Initialize(skinnedMeshRenderPBS, Monochrome_SurfaceShader_PBS, ThirdPersonLayer.layerIndex, FirstPersonLayer.layerIndex);
		return ovrAvatarSkinnedMeshRenderPBSComponent;
	}

	private OvrAvatarSkinnedMeshPBSV2RenderComponent AddSkinnedMeshRenderPBSV2Component(IntPtr renderPart, GameObject go, ovrAvatarRenderPart_SkinnedMeshRenderPBS_V2 skinnedMeshRenderPBSV2, bool isBodyPartZero, bool isControllerModel)
	{
		OvrAvatarSkinnedMeshPBSV2RenderComponent ovrAvatarSkinnedMeshPBSV2RenderComponent = go.AddComponent<OvrAvatarSkinnedMeshPBSV2RenderComponent>();
		ovrAvatarSkinnedMeshPBSV2RenderComponent.Initialize(renderPart, skinnedMeshRenderPBSV2, materialManager, ThirdPersonLayer.layerIndex, FirstPersonLayer.layerIndex, isBodyPartZero && CombineMeshes, LevelOfDetail, isBodyPartZero && EnableExpressive, this, isControllerModel);
		return ovrAvatarSkinnedMeshPBSV2RenderComponent;
	}

	public static IntPtr GetRenderPart(ovrAvatarComponent component, uint renderPartIndex)
	{
		return Marshal.ReadIntPtr(component.renderParts, Marshal.SizeOf(typeof(IntPtr)) * (int)renderPartIndex);
	}

	private static string GetRenderPartName(ovrAvatarComponent component, uint renderPartIndex)
	{
		return component.name + "_renderPart_" + (int)renderPartIndex;
	}

	internal static void ConvertTransform(float[] transform, ref ovrAvatarTransform target)
	{
		target.position.x = transform[0];
		target.position.y = transform[1];
		target.position.z = transform[2];
		target.orientation.x = transform[3];
		target.orientation.y = transform[4];
		target.orientation.z = transform[5];
		target.orientation.w = transform[6];
		target.scale.x = transform[7];
		target.scale.y = transform[8];
		target.scale.z = transform[9];
	}

	internal static void ConvertTransform(ovrAvatarTransform transform, Transform target)
	{
		Vector3 position = transform.position;
		position.z = 0f - position.z;
		Quaternion orientation = transform.orientation;
		orientation.x = 0f - orientation.x;
		orientation.y = 0f - orientation.y;
		target.localPosition = position;
		target.localRotation = orientation;
		target.localScale = transform.scale;
	}

	public static ovrAvatarTransform CreateOvrAvatarTransform(Vector3 position, Quaternion orientation)
	{
		ovrAvatarTransform result = default(ovrAvatarTransform);
		result.position = new Vector3(position.x, position.y, 0f - position.z);
		result.orientation = new Quaternion(0f - orientation.x, 0f - orientation.y, orientation.z, orientation.w);
		result.scale = Vector3.one;
		return result;
	}

	private static ovrAvatarGazeTarget CreateOvrGazeTarget(uint targetId, Vector3 targetPosition, ovrAvatarGazeTargetType targetType)
	{
		ovrAvatarGazeTarget result = default(ovrAvatarGazeTarget);
		result.id = targetId;
		result.worldPosition = new Vector3(targetPosition.x, targetPosition.y, 0f - targetPosition.z);
		result.type = targetType;
		return result;
	}

	private void BuildRenderComponents()
	{
		ovrAvatarBaseComponent component = default(ovrAvatarBaseComponent);
		ovrAvatarHandComponent component2 = default(ovrAvatarHandComponent);
		ovrAvatarHandComponent component3 = default(ovrAvatarHandComponent);
		ovrAvatarControllerComponent component4 = default(ovrAvatarControllerComponent);
		ovrAvatarControllerComponent component5 = default(ovrAvatarControllerComponent);
		ovrAvatarBodyComponent component6 = default(ovrAvatarBodyComponent);
		ovrAvatarComponent component7 = default(ovrAvatarComponent);
		if (Oculus.Avatar.CAPI.ovrAvatarPose_GetLeftHandComponent(sdkAvatar, ref component2))
		{
			Oculus.Avatar.CAPI.ovrAvatarComponent_Get(component2.renderComponent, includeName: true, ref component7);
			AddAvatarComponent(ref HandLeft, component7);
			HandLeft.isLeftHand = true;
		}
		if (Oculus.Avatar.CAPI.ovrAvatarPose_GetRightHandComponent(sdkAvatar, ref component3))
		{
			Oculus.Avatar.CAPI.ovrAvatarComponent_Get(component3.renderComponent, includeName: true, ref component7);
			AddAvatarComponent(ref HandRight, component7);
			HandRight.isLeftHand = false;
		}
		if (Oculus.Avatar.CAPI.ovrAvatarPose_GetBodyComponent(sdkAvatar, ref component6))
		{
			Oculus.Avatar.CAPI.ovrAvatarComponent_Get(component6.renderComponent, includeName: true, ref component7);
			AddAvatarComponent(ref Body, component7);
		}
		if (Oculus.Avatar.CAPI.ovrAvatarPose_GetLeftControllerComponent(sdkAvatar, ref component4))
		{
			Oculus.Avatar.CAPI.ovrAvatarComponent_Get(component4.renderComponent, includeName: true, ref component7);
			AddAvatarComponent(ref ControllerLeft, component7);
			ControllerLeft.isLeftHand = true;
		}
		if (Oculus.Avatar.CAPI.ovrAvatarPose_GetRightControllerComponent(sdkAvatar, ref component5))
		{
			Oculus.Avatar.CAPI.ovrAvatarComponent_Get(component5.renderComponent, includeName: true, ref component7);
			AddAvatarComponent(ref ControllerRight, component7);
			ControllerRight.isLeftHand = false;
		}
		if (Oculus.Avatar.CAPI.ovrAvatarPose_GetBaseComponent(sdkAvatar, ref component))
		{
			Oculus.Avatar.CAPI.ovrAvatarComponent_Get(component.renderComponent, includeName: true, ref component7);
			AddAvatarComponent(ref Base, component7);
		}
	}

	private void AddAvatarComponent<T>(ref T root, ovrAvatarComponent nativeComponent) where T : OvrAvatarComponent
	{
		GameObject gameObject = new GameObject();
		gameObject.name = nativeComponent.name;
		gameObject.transform.SetParent(base.transform);
		root = gameObject.AddComponent<T>();
		root.SetOvrAvatarOwner(this);
		AddRenderParts(root, nativeComponent, gameObject.transform);
	}

	private void UpdateCustomPoses()
	{
		if (UpdatePoseRoot(LeftHandCustomPose, ref cachedLeftHandCustomPose, ref cachedCustomLeftHandJoints, ref cachedLeftHandTransforms) && cachedLeftHandCustomPose == null && sdkAvatar != IntPtr.Zero)
		{
			Oculus.Avatar.CAPI.ovrAvatar_SetLeftHandGesture(sdkAvatar, ovrAvatarHandGesture.Default);
		}
		if (UpdatePoseRoot(RightHandCustomPose, ref cachedRightHandCustomPose, ref cachedCustomRightHandJoints, ref cachedRightHandTransforms) && cachedRightHandCustomPose == null && sdkAvatar != IntPtr.Zero)
		{
			Oculus.Avatar.CAPI.ovrAvatar_SetRightHandGesture(sdkAvatar, ovrAvatarHandGesture.Default);
		}
		if (sdkAvatar != IntPtr.Zero)
		{
			if (cachedLeftHandCustomPose != null && UpdateTransforms(cachedCustomLeftHandJoints, cachedLeftHandTransforms))
			{
				Oculus.Avatar.CAPI.ovrAvatar_SetLeftHandCustomGesture(sdkAvatar, (uint)cachedLeftHandTransforms.Length, cachedLeftHandTransforms);
			}
			if (cachedRightHandCustomPose != null && UpdateTransforms(cachedCustomRightHandJoints, cachedRightHandTransforms))
			{
				Oculus.Avatar.CAPI.ovrAvatar_SetRightHandCustomGesture(sdkAvatar, (uint)cachedRightHandTransforms.Length, cachedRightHandTransforms);
			}
		}
	}

	private static bool UpdatePoseRoot(Transform poseRoot, ref Transform cachedPoseRoot, ref Transform[] cachedPoseJoints, ref ovrAvatarTransform[] transforms)
	{
		if (poseRoot == cachedPoseRoot)
		{
			return false;
		}
		if (!poseRoot)
		{
			cachedPoseRoot = null;
			cachedPoseJoints = null;
			transforms = null;
		}
		else
		{
			List<Transform> list = new List<Transform>();
			OrderJoints(poseRoot, list);
			cachedPoseRoot = poseRoot;
			cachedPoseJoints = list.ToArray();
			transforms = new ovrAvatarTransform[list.Count];
		}
		return true;
	}

	private static bool UpdateTransforms(Transform[] joints, ovrAvatarTransform[] transforms)
	{
		bool result = false;
		for (int i = 0; i < joints.Length; i++)
		{
			Transform transform = joints[i];
			ovrAvatarTransform ovrAvatarTransform2 = CreateOvrAvatarTransform(transform.localPosition, transform.localRotation);
			if (ovrAvatarTransform2.position != transforms[i].position || ovrAvatarTransform2.orientation != transforms[i].orientation)
			{
				transforms[i] = ovrAvatarTransform2;
				result = true;
			}
		}
		return result;
	}

	private static void OrderJoints(Transform transform, List<Transform> joints)
	{
		joints.Add(transform);
		for (int i = 0; i < transform.childCount; i++)
		{
			OrderJoints(transform.GetChild(i), joints);
		}
	}

	private void AvatarSpecificationCallback(IntPtr avatarSpecification)
	{
		sdkAvatar = Oculus.Avatar.CAPI.ovrAvatar_Create(avatarSpecification, Capabilities);
		ShowLeftController(showLeftController);
		ShowRightController(showRightController);
		if (Driver != null)
		{
			Driver.UpdateTransformsFromPose(sdkAvatar);
		}
		uint num = Oculus.Avatar.CAPI.ovrAvatar_GetReferencedAssetCount(sdkAvatar);
		for (uint num2 = 0u; num2 < num; num2++)
		{
			ulong num3 = Oculus.Avatar.CAPI.ovrAvatar_GetReferencedAsset(sdkAvatar, num2);
			if (OvrAvatarSDKManager.Instance.GetAsset(num3) == null)
			{
				OvrAvatarSDKManager.Instance.BeginLoadingAsset(num3, LevelOfDetail, AssetLoadedCallback);
				assetLoadingIds.Add(num3);
			}
		}
		if (CombineMeshes)
		{
			OvrAvatarSDKManager.Instance.RegisterCombinedMeshCallback(sdkAvatar, CombinedMeshLoadedCallback);
		}
	}

	private void Start()
	{
		if (!(OvrAvatarSDKManager.Instance == null))
		{
			materialManager = base.gameObject.AddComponent<OvrAvatarMaterialManager>();
			try
			{
				oculusUserIDInternal = ulong.Parse(oculusUserID);
			}
			catch (Exception)
			{
				oculusUserIDInternal = 0uL;
			}
			if (oculusUserIDInternal == 0L)
			{
				CombineMeshes = false;
			}
			Capabilities = (ovrAvatarCapabilities)0;
			bool flag = false;
			switch (OVRPlugin.GetSystemHeadsetType())
			{
			case OVRPlugin.SystemHeadset.GearVR_R320:
			case OVRPlugin.SystemHeadset.GearVR_R321:
			case OVRPlugin.SystemHeadset.GearVR_R322:
			case OVRPlugin.SystemHeadset.GearVR_R323:
			case OVRPlugin.SystemHeadset.GearVR_R324:
			case OVRPlugin.SystemHeadset.GearVR_R325:
			case OVRPlugin.SystemHeadset.Oculus_Go:
				flag = true;
				break;
			}
			if (flag && !EnableBody)
			{
				EnableBody = true;
				ShowFirstPerson = true;
				ShowThirdPerson = false;
			}
			if (EnableBody)
			{
				Capabilities |= ovrAvatarCapabilities.Body;
			}
			if (EnableHands)
			{
				Capabilities |= ovrAvatarCapabilities.Hands;
			}
			if (EnableBase && EnableBody)
			{
				Capabilities |= ovrAvatarCapabilities.Base;
			}
			if (EnableExpressive)
			{
				Capabilities |= ovrAvatarCapabilities.Expressive;
			}
			if (OVRPlugin.positionSupported)
			{
				Capabilities |= ovrAvatarCapabilities.BodyTilt;
			}
			ShowLeftController(StartWithControllers);
			ShowRightController(StartWithControllers);
			OvrAvatarSDKManager.AvatarSpecRequestParams avatarSpecRequest = new OvrAvatarSDKManager.AvatarSpecRequestParams(oculusUserIDInternal, AvatarSpecificationCallback, CombineMeshes, LevelOfDetail, forceMobileTextureFormat: true, LookAndFeelVersion, FallbackLookAndFeelVersion, EnableExpressive);
			OvrAvatarSDKManager.Instance.RequestAvatarSpecification(avatarSpecRequest);
			OvrAvatarSDKManager.Instance.AddLoadingAvatar(GetInstanceID());
			waitingForCombinedMesh = CombineMeshes;
			if (Driver != null)
			{
				Driver.Mode = ((!UseSDKPackets) ? OvrAvatarDriver.PacketMode.Unity : OvrAvatarDriver.PacketMode.SDK);
			}
		}
	}

	private void Update()
	{
		if (!OvrAvatarSDKManager.Instance || sdkAvatar == IntPtr.Zero || materialManager == null)
		{
			return;
		}
		if (Driver != null)
		{
			Driver.UpdateTransforms(sdkAvatar);
			foreach (float[] voiceUpdate in voiceUpdates)
			{
				Oculus.Avatar.CAPI.ovrAvatarPose_UpdateVoiceVisualization(sdkAvatar, voiceUpdate);
			}
			voiceUpdates.Clear();
			Oculus.Avatar.CAPI.ovrAvatarPose_Finalize(sdkAvatar, Time.deltaTime);
		}
		if (RecordPackets)
		{
			RecordFrame();
		}
		if (assetLoadingIds.Count != 0)
		{
			return;
		}
		if (!assetsFinishedLoading)
		{
			try
			{
				BuildRenderComponents();
			}
			catch (Exception)
			{
				assetsFinishedLoading = true;
				throw;
			}
			InitPostLoad();
			assetsFinishedLoading = true;
			OvrAvatarSDKManager.Instance.RemoveLoadingAvatar(GetInstanceID());
		}
		UpdateVoiceBehavior();
		UpdateCustomPoses();
		if (EnableExpressive)
		{
			UpdateExpressive();
		}
	}

	public static ovrAvatarHandInputState CreateInputState(ovrAvatarTransform transform, OvrAvatarDriver.ControllerPose pose)
	{
		ovrAvatarHandInputState result = default(ovrAvatarHandInputState);
		result.transform = transform;
		result.buttonMask = pose.buttons;
		result.touchMask = pose.touches;
		result.joystickX = pose.joystickPosition.x;
		result.joystickY = pose.joystickPosition.y;
		result.indexTrigger = pose.indexTrigger;
		result.handTrigger = pose.handTrigger;
		result.isActive = pose.isActive;
		return result;
	}

	public void ShowControllers(bool show)
	{
		ShowLeftController(show);
		ShowRightController(show);
	}

	public void ShowLeftController(bool show)
	{
		if (sdkAvatar != IntPtr.Zero)
		{
			Oculus.Avatar.CAPI.ovrAvatar_SetLeftControllerVisibility(sdkAvatar, show);
		}
		showLeftController = show;
	}

	public void ShowRightController(bool show)
	{
		if (sdkAvatar != IntPtr.Zero)
		{
			Oculus.Avatar.CAPI.ovrAvatar_SetRightControllerVisibility(sdkAvatar, show);
		}
		showRightController = show;
	}

	public void UpdateVoiceVisualization(float[] voiceSamples)
	{
		voiceUpdates.Add(voiceSamples);
	}

	private void RecordFrame()
	{
		if (UseSDKPackets)
		{
			RecordSDKFrame();
		}
		else
		{
			RecordUnityFrame();
		}
	}

	private void RecordUnityFrame()
	{
		float num = Time.deltaTime;
		OvrAvatarDriver.PoseFrame currentPose = Driver.GetCurrentPose();
		if (CurrentUnityPacket == null)
		{
			CurrentUnityPacket = new OvrAvatarPacket(currentPose);
			num = 0f;
		}
		float num2 = 0f;
		while (num2 < num)
		{
			float num3 = num - num2;
			float num4 = PacketSettings.UpdateRate - CurrentUnityPacket.Duration;
			if (num3 < num4)
			{
				CurrentUnityPacket.AddFrame(currentPose, num3);
				num2 += num3;
				continue;
			}
			OvrAvatarDriver.PoseFrame finalFrame = CurrentUnityPacket.FinalFrame;
			OvrAvatarDriver.PoseFrame b = currentPose;
			float t = num4 / num3;
			OvrAvatarDriver.PoseFrame poseFrame = OvrAvatarDriver.PoseFrame.Interpolate(finalFrame, b, t);
			CurrentUnityPacket.AddFrame(poseFrame, num4);
			num2 += num4;
			if (PacketRecorded != null)
			{
				PacketRecorded(this, new PacketEventArgs(CurrentUnityPacket));
			}
			CurrentUnityPacket = new OvrAvatarPacket(poseFrame);
		}
	}

	private void RecordSDKFrame()
	{
		if (sdkAvatar == IntPtr.Zero)
		{
			return;
		}
		if (!PacketSettings.RecordingFrames)
		{
			Oculus.Avatar.CAPI.ovrAvatarPacket_BeginRecording(sdkAvatar);
			PacketSettings.AccumulatedTime = 0f;
			PacketSettings.RecordingFrames = true;
		}
		PacketSettings.AccumulatedTime += Time.deltaTime;
		if (PacketSettings.AccumulatedTime >= PacketSettings.UpdateRate)
		{
			PacketSettings.AccumulatedTime = 0f;
			IntPtr intPtr = Oculus.Avatar.CAPI.ovrAvatarPacket_EndRecording(sdkAvatar);
			Oculus.Avatar.CAPI.ovrAvatarPacket_BeginRecording(sdkAvatar);
			if (PacketRecorded != null)
			{
				PacketRecorded(this, new PacketEventArgs(new OvrAvatarPacket
				{
					ovrNativePacket = intPtr
				}));
			}
			Oculus.Avatar.CAPI.ovrAvatarPacket_Free(intPtr);
		}
	}

	private void AddRenderParts(OvrAvatarComponent ovrComponent, ovrAvatarComponent component, Transform parent)
	{
		bool flag = ovrComponent.name == "body";
		bool flag2 = ovrComponent.name == "controller_left";
		bool flag3 = ovrComponent.name == "controller_right";
		for (uint num = 0u; num < component.renderPartCount; num++)
		{
			GameObject gameObject = new GameObject();
			gameObject.name = GetRenderPartName(component, num);
			gameObject.transform.SetParent(parent);
			IntPtr renderPart = GetRenderPart(component, num);
			ovrAvatarRenderPartType ovrAvatarRenderPartType2 = Oculus.Avatar.CAPI.ovrAvatarRenderPart_GetType(renderPart);
			OvrAvatarRenderComponent ovrAvatarRenderComponent = null;
			switch (ovrAvatarRenderPartType2)
			{
			case ovrAvatarRenderPartType.SkinnedMeshRender:
				ovrAvatarRenderComponent = AddSkinnedMeshRenderComponent(gameObject, Oculus.Avatar.CAPI.ovrAvatarRenderPart_GetSkinnedMeshRender(renderPart));
				break;
			case ovrAvatarRenderPartType.SkinnedMeshRenderPBS:
				ovrAvatarRenderComponent = AddSkinnedMeshRenderPBSComponent(gameObject, Oculus.Avatar.CAPI.ovrAvatarRenderPart_GetSkinnedMeshRenderPBS(renderPart));
				break;
			case ovrAvatarRenderPartType.SkinnedMeshRenderPBS_V2:
				ovrAvatarRenderComponent = AddSkinnedMeshRenderPBSV2Component(renderPart, gameObject, Oculus.Avatar.CAPI.ovrAvatarRenderPart_GetSkinnedMeshRenderPBSV2(renderPart), flag && num == 0, flag2 || flag3);
				break;
			}
			if (ovrAvatarRenderComponent != null)
			{
				ovrComponent.RenderParts.Add(ovrAvatarRenderComponent);
			}
		}
	}

	public void RefreshBodyParts()
	{
		if (!(Body != null))
		{
			return;
		}
		foreach (OvrAvatarRenderComponent renderPart in Body.RenderParts)
		{
			UnityEngine.Object.Destroy(renderPart.gameObject);
		}
		Body.RenderParts.Clear();
		ovrAvatarComponent? nativeAvatarComponent = Body.GetNativeAvatarComponent();
		if (nativeAvatarComponent.HasValue)
		{
			AddRenderParts(Body, nativeAvatarComponent.Value, Body.gameObject.transform);
		}
	}

	public ovrAvatarBodyComponent? GetBodyComponent()
	{
		if (Body != null)
		{
			Oculus.Avatar.CAPI.ovrAvatarPose_GetBodyComponent(sdkAvatar, ref Body.component);
			return Body.component;
		}
		return null;
	}

	public Transform GetHandTransform(HandType hand, HandJoint joint)
	{
		if (hand >= HandType.Max || joint >= HandJoint.Max)
		{
			return null;
		}
		OvrAvatarHand ovrAvatarHand = ((hand == HandType.Left) ? HandLeft : HandRight);
		if (ovrAvatarHand != null)
		{
			OvrAvatarComponent component = ovrAvatarHand.GetComponent<OvrAvatarComponent>();
			if (component != null && component.RenderParts.Count > 0)
			{
				return component.RenderParts[0].transform.Find(HandJoints[(int)hand, (int)joint]);
			}
		}
		return null;
	}

	public void GetPointingDirection(HandType hand, ref Vector3 forward, ref Vector3 up)
	{
		Transform handTransform = GetHandTransform(hand, HandJoint.HandBase);
		if (handTransform != null)
		{
			forward = handTransform.forward;
			up = handTransform.up;
		}
	}

	private void UpdateVoiceBehavior()
	{
		if (EnableMouthVertexAnimation && Body != null)
		{
			OvrAvatarComponent component = Body.GetComponent<OvrAvatarComponent>();
			VoiceAmplitude = Mathf.Clamp(VoiceAmplitude, 0f, 1f);
			if (component.RenderParts.Count > 0)
			{
				Material sharedMaterial = component.RenderParts[0].mesh.sharedMaterial;
				Transform transform = component.RenderParts[0].mesh.transform.Find(NECK_JONT);
				Vector3 vector = transform.TransformPoint(Vector3.up) - transform.position;
				sharedMaterial.SetFloat(MOUTH_SCALE_PROPERTY, vector.magnitude);
				sharedMaterial.SetFloat(VOICE_PROPERTY, Mathf.Min(vector.magnitude * MOUTH_MAX_GLOBAL, vector.magnitude * VoiceAmplitude * MOUTH_SCALE_GLOBAL));
				sharedMaterial.SetVector(MOUTH_POSITION_PROPERTY, transform.TransformPoint(MOUTH_POSITION_OFFSET));
				sharedMaterial.SetVector(MOUTH_DIRECTION_PROPERTY, transform.up);
			}
		}
	}

	private bool IsValidMic()
	{
		string[] devices = Microphone.devices;
		if (devices.Length < 1)
		{
			return false;
		}
		int num = 0;
		string deviceName = devices[num];
		Microphone.GetDeviceCaps(deviceName, out var _, out var maxFreq);
		if (maxFreq == 0)
		{
			maxFreq = 44100;
		}
		if (Microphone.Start(deviceName, loop: true, 1, maxFreq) == null)
		{
			return false;
		}
		Microphone.End(deviceName);
		return true;
	}

	private void InitPostLoad()
	{
		ExpressiveGlobalInit();
		ConfigureHelpers();
		if (GetComponent<OvrAvatarLocalDriver>() != null)
		{
			lipsyncContext.audioLoopback = false;
			if (CanOwnMicrophone && IsValidMic())
			{
				micInput = MouthAnchor.gameObject.AddComponent<OVRLipSyncMicInput>();
				micInput.enableMicSelectionGUI = false;
				micInput.MicFrequency = 44100f;
				micInput.micControl = OVRLipSyncMicInput.micActivation.ConstantSpeak;
			}
			Oculus.Avatar.CAPI.ovrAvatar_SetActionUnitOnsetSpeed(sdkAvatar, 30f);
			Oculus.Avatar.CAPI.ovrAvatar_SetActionUnitFalloffSpeed(sdkAvatar, 20f);
			Oculus.Avatar.CAPI.ovrAvatar_SetVisemeMultiplier(sdkAvatar, 1.5f);
		}
	}

	private static void ExpressiveGlobalInit()
	{
		if (!doneExpressiveGlobalInit)
		{
			doneExpressiveGlobalInit = true;
			ovrLights.lights = new ovrAvatarLight[16];
			InitializeLights();
		}
	}

	private static void InitializeLights()
	{
		ovrLights.ambientIntensity = RenderSettings.ambientLight.grayscale * 0.5f;
		Light[] array = UnityEngine.Object.FindObjectsOfType(typeof(Light)) as Light[];
		int num = 0;
		for (num = 0; num < array.Length && num < ovrLights.lights.Length; num++)
		{
			Light light = array[num];
			if ((bool)light && light.enabled)
			{
				uint instanceID = (uint)light.transform.GetInstanceID();
				switch (light.type)
				{
				case LightType.Directional:
					CreateLightDirectional(instanceID, light.transform.forward, light.intensity, ref ovrLights.lights[num]);
					break;
				case LightType.Point:
					CreateLightPoint(instanceID, light.transform.position, light.range, light.intensity, ref ovrLights.lights[num]);
					break;
				case LightType.Spot:
					CreateLightSpot(instanceID, light.transform.position, light.transform.forward, light.spotAngle, light.range, light.intensity, ref ovrLights.lights[num]);
					break;
				}
			}
		}
		ovrLights.lightCount = (uint)num;
		Oculus.Avatar.CAPI.ovrAvatar_UpdateLights(ovrLights);
	}

	private static ovrAvatarLight CreateLightDirectional(uint id, Vector3 direction, float intensity, ref ovrAvatarLight light)
	{
		light.id = id;
		light.type = ovrAvatarLightType.Direction;
		light.worldDirection = new Vector3(direction.x, direction.y, 0f - direction.z);
		light.intensity = intensity;
		return light;
	}

	private static ovrAvatarLight CreateLightPoint(uint id, Vector3 position, float range, float intensity, ref ovrAvatarLight light)
	{
		light.id = id;
		light.type = ovrAvatarLightType.Point;
		light.worldPosition = new Vector3(position.x, position.y, 0f - position.z);
		light.range = range;
		light.intensity = intensity;
		return light;
	}

	private static ovrAvatarLight CreateLightSpot(uint id, Vector3 position, Vector3 direction, float spotAngleDeg, float range, float intensity, ref ovrAvatarLight light)
	{
		light.id = id;
		light.type = ovrAvatarLightType.Spot;
		light.worldPosition = new Vector3(position.x, position.y, 0f - position.z);
		light.worldDirection = new Vector3(direction.x, direction.y, 0f - direction.z);
		light.spotAngleDeg = spotAngleDeg;
		light.range = range;
		light.intensity = intensity;
		return light;
	}

	private void UpdateExpressive()
	{
		ovrAvatarTransform ovrAvatarTransform2 = CreateOvrAvatarTransform(base.transform.position, base.transform.rotation);
		Oculus.Avatar.CAPI.ovrAvatar_UpdateWorldTransform(sdkAvatar, ovrAvatarTransform2);
		UpdateFacewave();
	}

	private void ConfigureHelpers()
	{
		Transform transform = base.transform.Find("body/body_renderPart_0/root_JNT/body_JNT/chest_JNT/neckBase_JNT/neck_JNT/head_JNT");
		if (transform == null)
		{
			transform = base.transform;
		}
		if (MouthAnchor == null)
		{
			MouthAnchor = CreateHelperObject(transform, MOUTH_HEAD_OFFSET, "MouthAnchor");
		}
		if (GetComponent<OvrAvatarLocalDriver>() != null)
		{
			if (audioSource == null)
			{
				audioSource = MouthAnchor.gameObject.AddComponent<AudioSource>();
			}
			spatializedSource = MouthAnchor.GetComponent<ONSPAudioSource>();
			if (spatializedSource == null)
			{
				spatializedSource = MouthAnchor.gameObject.AddComponent<ONSPAudioSource>();
			}
			spatializedSource.UseInvSqr = true;
			spatializedSource.EnableRfl = false;
			spatializedSource.EnableSpatialization = true;
			spatializedSource.Far = 100f;
			spatializedSource.Near = 0.1f;
			lipsyncContext = MouthAnchor.GetComponent<OVRLipSyncContext>();
			if (lipsyncContext == null)
			{
				lipsyncContext = MouthAnchor.gameObject.AddComponent<OVRLipSyncContext>();
			}
			lipsyncContext.provider = ((!EnableLaughter) ? OVRLipSync.ContextProviders.Enhanced : OVRLipSync.ContextProviders.Enhanced_with_Laughter);
			lipsyncContext.skipAudioSource = !CanOwnMicrophone;
			StartCoroutine(WaitForMouthAudioSource());
		}
		if (GetComponent<OvrAvatarRemoteDriver>() != null)
		{
			transform.gameObject.AddComponent<GazeTarget>().Type = ovrAvatarGazeTargetType.AvatarHead;
			Transform transform2 = base.transform.Find("hand_left");
			if (!(transform2 == null))
			{
				transform2.gameObject.AddComponent<GazeTarget>().Type = ovrAvatarGazeTargetType.AvatarHand;
			}
			transform2 = base.transform.Find("hand_right");
			if (!(transform2 == null))
			{
				transform2.gameObject.AddComponent<GazeTarget>().Type = ovrAvatarGazeTargetType.AvatarHand;
			}
		}
	}

	private IEnumerator WaitForMouthAudioSource()
	{
		while (MouthAnchor.GetComponent<AudioSource>() == null)
		{
			yield return new WaitForSeconds(0.1f);
		}
		AudioSource component = MouthAnchor.GetComponent<AudioSource>();
		component.minDistance = 0.3f;
		component.maxDistance = 4f;
		component.rolloffMode = AudioRolloffMode.Logarithmic;
		component.loop = true;
		component.playOnAwake = true;
		component.spatialBlend = 1f;
		component.spatialize = true;
		component.spatializePostEffects = true;
	}

	public void DestroyHelperObjects()
	{
		if ((bool)MouthAnchor)
		{
			UnityEngine.Object.DestroyImmediate(MouthAnchor.gameObject);
		}
	}

	public GameObject CreateHelperObject(Transform parent, Vector3 localPositionOffset, string helperName, string helperTag = "")
	{
		GameObject gameObject = new GameObject();
		gameObject.name = helperName;
		if (helperTag != "")
		{
			gameObject.tag = helperTag;
		}
		gameObject.transform.SetParent(parent);
		gameObject.transform.localRotation = Quaternion.identity;
		gameObject.transform.localPosition = localPositionOffset;
		return gameObject;
	}

	public void UpdateVoiceData(short[] pcmData, int numChannels)
	{
		if (lipsyncContext != null && micInput == null)
		{
			lipsyncContext.ProcessAudioSamplesRaw(pcmData, numChannels);
		}
	}

	public void UpdateVoiceData(float[] pcmData, int numChannels)
	{
		if (lipsyncContext != null && micInput == null)
		{
			lipsyncContext.ProcessAudioSamplesRaw(pcmData, numChannels);
		}
	}

	private void UpdateFacewave()
	{
		if (!(lipsyncContext != null) || (!(micInput != null) && CanOwnMicrophone))
		{
			return;
		}
		currentFrame = lipsyncContext.GetCurrentPhonemeFrame();
		if (currentFrame.Visemes.Length != 15)
		{
			UnityEngine.Debug.LogError("Unexpected number of visemes " + currentFrame.Visemes);
			return;
		}
		currentFrame.Visemes.CopyTo(visemes, 0);
		visemes[15] = (EnableLaughter ? currentFrame.laughterScore : 0f);
		for (int i = 0; i < 16; i++)
		{
			RuntimeVisemes.visemeParams[i] = visemes[i];
		}
		Oculus.Avatar.CAPI.ovrAvatar_SetVisemes(sdkAvatar, RuntimeVisemes);
	}
}
public class OvrAvatarAsset
{
	public ulong assetID;
}
public class OvrAvatarAssetMesh : OvrAvatarAsset
{
	public Mesh mesh;

	private ovrAvatarSkinnedMeshPose skinnedBindPose;

	public string[] jointNames;

	public OvrAvatarAssetMesh(ulong _assetId, IntPtr asset, ovrAvatarAssetType meshType)
	{
		assetID = _assetId;
		mesh = new Mesh();
		mesh.name = "Procedural Geometry for asset " + _assetId;
		SetSkinnedBindPose(asset, meshType);
		long vertexCount = 0L;
		IntPtr vertexBuffer = IntPtr.Zero;
		uint indexCount = 0u;
		IntPtr indexBuffer = IntPtr.Zero;
		GetVertexAndIndexData(asset, meshType, out vertexCount, out vertexBuffer, out indexCount, out indexBuffer);
		Vector3[] array = new Vector3[vertexCount];
		Vector3[] array2 = new Vector3[vertexCount];
		Vector4[] array3 = new Vector4[vertexCount];
		Vector2[] array4 = new Vector2[vertexCount];
		Color[] array5 = new Color[vertexCount];
		BoneWeight[] array6 = new BoneWeight[vertexCount];
		long num = vertexBuffer.ToInt64();
		switch (meshType)
		{
		case ovrAvatarAssetType.Mesh:
		{
			long num5 = Marshal.SizeOf(typeof(ovrAvatarMeshVertex));
			for (long num6 = 0L; num6 < vertexCount; num6++)
			{
				long num7 = num5 * num6;
				ovrAvatarMeshVertex ovrAvatarMeshVertex2 = (ovrAvatarMeshVertex)Marshal.PtrToStructure(new IntPtr(num + num7), typeof(ovrAvatarMeshVertex));
				array[num6] = new Vector3(ovrAvatarMeshVertex2.x, ovrAvatarMeshVertex2.y, 0f - ovrAvatarMeshVertex2.z);
				array2[num6] = new Vector3(ovrAvatarMeshVertex2.nx, ovrAvatarMeshVertex2.ny, 0f - ovrAvatarMeshVertex2.nz);
				array3[num6] = new Vector4(ovrAvatarMeshVertex2.tx, ovrAvatarMeshVertex2.ty, 0f - ovrAvatarMeshVertex2.tz, ovrAvatarMeshVertex2.tw);
				array4[num6] = new Vector2(ovrAvatarMeshVertex2.u, ovrAvatarMeshVertex2.v);
				array5[num6] = new Color(0f, 0f, 0f, 1f);
				array6[num6].boneIndex0 = ovrAvatarMeshVertex2.blendIndices[0];
				array6[num6].boneIndex1 = ovrAvatarMeshVertex2.blendIndices[1];
				array6[num6].boneIndex2 = ovrAvatarMeshVertex2.blendIndices[2];
				array6[num6].boneIndex3 = ovrAvatarMeshVertex2.blendIndices[3];
				array6[num6].weight0 = ovrAvatarMeshVertex2.blendWeights[0];
				array6[num6].weight1 = ovrAvatarMeshVertex2.blendWeights[1];
				array6[num6].weight2 = ovrAvatarMeshVertex2.blendWeights[2];
				array6[num6].weight3 = ovrAvatarMeshVertex2.blendWeights[3];
			}
			break;
		}
		case ovrAvatarAssetType.CombinedMesh:
		{
			long num2 = Marshal.SizeOf(typeof(ovrAvatarMeshVertexV2));
			for (long num3 = 0L; num3 < vertexCount; num3++)
			{
				long num4 = num2 * num3;
				ovrAvatarMeshVertexV2 ovrAvatarMeshVertexV3 = (ovrAvatarMeshVertexV2)Marshal.PtrToStructure(new IntPtr(num + num4), typeof(ovrAvatarMeshVertexV2));
				array[num3] = new Vector3(ovrAvatarMeshVertexV3.x, ovrAvatarMeshVertexV3.y, 0f - ovrAvatarMeshVertexV3.z);
				array2[num3] = new Vector3(ovrAvatarMeshVertexV3.nx, ovrAvatarMeshVertexV3.ny, 0f - ovrAvatarMeshVertexV3.nz);
				array3[num3] = new Vector4(ovrAvatarMeshVertexV3.tx, ovrAvatarMeshVertexV3.ty, 0f - ovrAvatarMeshVertexV3.tz, ovrAvatarMeshVertexV3.tw);
				array4[num3] = new Vector2(ovrAvatarMeshVertexV3.u, ovrAvatarMeshVertexV3.v);
				array5[num3] = new Color(ovrAvatarMeshVertexV3.r, ovrAvatarMeshVertexV3.g, ovrAvatarMeshVertexV3.b, ovrAvatarMeshVertexV3.a);
				array6[num3].boneIndex0 = ovrAvatarMeshVertexV3.blendIndices[0];
				array6[num3].boneIndex1 = ovrAvatarMeshVertexV3.blendIndices[1];
				array6[num3].boneIndex2 = ovrAvatarMeshVertexV3.blendIndices[2];
				array6[num3].boneIndex3 = ovrAvatarMeshVertexV3.blendIndices[3];
				array6[num3].weight0 = ovrAvatarMeshVertexV3.blendWeights[0];
				array6[num3].weight1 = ovrAvatarMeshVertexV3.blendWeights[1];
				array6[num3].weight2 = ovrAvatarMeshVertexV3.blendWeights[2];
				array6[num3].weight3 = ovrAvatarMeshVertexV3.blendWeights[3];
			}
			break;
		}
		default:
			throw new Exception("Bad Mesh Asset Type");
		}
		mesh.vertices = array;
		mesh.normals = array2;
		mesh.uv = array4;
		mesh.tangents = array3;
		mesh.boneWeights = array6;
		mesh.colors = array5;
		LoadBlendShapes(asset, vertexCount);
		LoadSubmeshes(asset, indexBuffer, indexCount);
		uint jointCount = skinnedBindPose.jointCount;
		jointNames = new string[jointCount];
		for (uint num8 = 0u; num8 < jointCount; num8++)
		{
			jointNames[num8] = Marshal.PtrToStringAnsi(skinnedBindPose.jointNames[num8]);
		}
	}

	private void LoadSubmeshes(IntPtr asset, IntPtr indexBufferPtr, ulong indexCount)
	{
		uint num = Oculus.Avatar.CAPI.ovrAvatarAsset_GetSubmeshCount(asset);
		short[] array = new short[indexCount];
		Marshal.Copy(indexBufferPtr, array, 0, (int)indexCount);
		mesh.subMeshCount = (int)num;
		uint num2 = 0u;
		for (uint num3 = 0u; num3 < num; num3++)
		{
			uint num4 = Oculus.Avatar.CAPI.ovrAvatarAsset_GetSubmeshLastIndex(asset, num3);
			uint num5 = num4 - num2;
			int[] array2 = new int[num5];
			int num6 = 0;
			for (ulong num7 = num2; num7 < num4; num7 += 3)
			{
				array2[num6 + 2] = array[num7];
				array2[num6 + 1] = array[num7 + 1];
				array2[num6] = array[num7 + 2];
				num6 += 3;
			}
			num2 += num5;
			mesh.SetIndices(array2, MeshTopology.Triangles, (int)num3);
		}
	}

	private void LoadBlendShapes(IntPtr asset, long vertexCount)
	{
		uint num = Oculus.Avatar.CAPI.ovrAvatarAsset_GetMeshBlendShapeCount(asset);
		IntPtr intPtr = Oculus.Avatar.CAPI.ovrAvatarAsset_GetMeshBlendShapeVertices(asset);
		if (!(intPtr != IntPtr.Zero))
		{
			return;
		}
		long num2 = 0L;
		long num3 = Marshal.SizeOf(typeof(ovrAvatarBlendVertex));
		long num4 = intPtr.ToInt64();
		for (uint num5 = 0u; num5 < num; num5++)
		{
			Vector3[] array = new Vector3[vertexCount];
			Vector3[] array2 = new Vector3[vertexCount];
			Vector3[] array3 = new Vector3[vertexCount];
			for (long num6 = 0L; num6 < vertexCount; num6++)
			{
				ovrAvatarBlendVertex ovrAvatarBlendVertex2 = (ovrAvatarBlendVertex)Marshal.PtrToStructure(new IntPtr(num4 + num2), typeof(ovrAvatarBlendVertex));
				array[num6] = new Vector3(ovrAvatarBlendVertex2.x, ovrAvatarBlendVertex2.y, 0f - ovrAvatarBlendVertex2.z);
				array2[num6] = new Vector3(ovrAvatarBlendVertex2.nx, ovrAvatarBlendVertex2.ny, 0f - ovrAvatarBlendVertex2.nz);
				array3[num6] = new Vector4(ovrAvatarBlendVertex2.tx, ovrAvatarBlendVertex2.ty, 0f - ovrAvatarBlendVertex2.tz);
				num2 += num3;
			}
			string shapeName = Marshal.PtrToStringAnsi(Oculus.Avatar.CAPI.ovrAvatarAsset_GetMeshBlendShapeName(asset, num5));
			mesh.AddBlendShapeFrame(shapeName, 100f, array, array2, array3);
		}
	}

	private void SetSkinnedBindPose(IntPtr asset, ovrAvatarAssetType meshType)
	{
		switch (meshType)
		{
		case ovrAvatarAssetType.Mesh:
			skinnedBindPose = Oculus.Avatar.CAPI.ovrAvatarAsset_GetMeshData(asset).skinnedBindPose;
			break;
		case ovrAvatarAssetType.CombinedMesh:
			skinnedBindPose = Oculus.Avatar.CAPI.ovrAvatarAsset_GetCombinedMeshData(asset).skinnedBindPose;
			break;
		}
	}

	private void GetVertexAndIndexData(IntPtr asset, ovrAvatarAssetType meshType, out long vertexCount, out IntPtr vertexBuffer, out uint indexCount, out IntPtr indexBuffer)
	{
		vertexCount = 0L;
		vertexBuffer = IntPtr.Zero;
		indexCount = 0u;
		indexBuffer = IntPtr.Zero;
		switch (meshType)
		{
		case ovrAvatarAssetType.Mesh:
			vertexCount = Oculus.Avatar.CAPI.ovrAvatarAsset_GetMeshData(asset).vertexCount;
			vertexBuffer = Oculus.Avatar.CAPI.ovrAvatarAsset_GetMeshData(asset).vertexBuffer;
			indexCount = Oculus.Avatar.CAPI.ovrAvatarAsset_GetMeshData(asset).indexCount;
			indexBuffer = Oculus.Avatar.CAPI.ovrAvatarAsset_GetMeshData(asset).indexBuffer;
			break;
		case ovrAvatarAssetType.CombinedMesh:
			vertexCount = Oculus.Avatar.CAPI.ovrAvatarAsset_GetCombinedMeshData(asset).vertexCount;
			vertexBuffer = Oculus.Avatar.CAPI.ovrAvatarAsset_GetCombinedMeshData(asset).vertexBuffer;
			indexCount = Oculus.Avatar.CAPI.ovrAvatarAsset_GetCombinedMeshData(asset).indexCount;
			indexBuffer = Oculus.Avatar.CAPI.ovrAvatarAsset_GetCombinedMeshData(asset).indexBuffer;
			break;
		}
	}

	public SkinnedMeshRenderer CreateSkinnedMeshRendererOnObject(GameObject target)
	{
		SkinnedMeshRenderer skinnedMeshRenderer = target.AddComponent<SkinnedMeshRenderer>();
		skinnedMeshRenderer.sharedMesh = mesh;
		mesh.name = "AvatarMesh_" + assetID;
		uint jointCount = skinnedBindPose.jointCount;
		GameObject[] array = new GameObject[jointCount];
		Transform[] array2 = new Transform[jointCount];
		Matrix4x4[] array3 = new Matrix4x4[jointCount];
		for (uint num = 0u; num < jointCount; num++)
		{
			array[num] = new GameObject();
			array2[num] = array[num].transform;
			array[num].name = jointNames[num];
			int num2 = skinnedBindPose.jointParents[num];
			if (num2 == -1)
			{
				array[num].transform.parent = skinnedMeshRenderer.transform;
				skinnedMeshRenderer.rootBone = array[num].transform;
			}
			else
			{
				array[num].transform.parent = array[num2].transform;
			}
			Vector3 position = skinnedBindPose.jointTransform[num].position;
			position.z = 0f - position.z;
			array[num].transform.localPosition = position;
			Quaternion orientation = skinnedBindPose.jointTransform[num].orientation;
			orientation.x = 0f - orientation.x;
			orientation.y = 0f - orientation.y;
			array[num].transform.localRotation = orientation;
			array[num].transform.localScale = skinnedBindPose.jointTransform[num].scale;
			array3[num] = array[num].transform.worldToLocalMatrix * skinnedMeshRenderer.transform.localToWorldMatrix;
		}
		skinnedMeshRenderer.bones = array2;
		mesh.bindposes = array3;
		return skinnedMeshRenderer;
	}
}
public class OvrAvatarAssetTexture : OvrAvatarAsset
{
	public Texture2D texture;

	private const int ASTCHeaderSize = 16;

	public OvrAvatarAssetTexture(ulong _assetId, IntPtr asset)
	{
		assetID = _assetId;
		ovrAvatarTextureAssetData ovrAvatarTextureAssetData2 = Oculus.Avatar.CAPI.ovrAvatarAsset_GetTextureData(asset);
		IntPtr data = ovrAvatarTextureAssetData2.textureData;
		int num = (int)ovrAvatarTextureAssetData2.textureDataSize;
		TextureFormat textureFormat;
		switch (ovrAvatarTextureAssetData2.format)
		{
		case ovrAvatarTextureFormat.RGB24:
			textureFormat = TextureFormat.RGB24;
			break;
		case ovrAvatarTextureFormat.DXT1:
			textureFormat = TextureFormat.DXT1;
			break;
		case ovrAvatarTextureFormat.DXT5:
			textureFormat = TextureFormat.DXT5;
			break;
		case ovrAvatarTextureFormat.ASTC_RGB_6x6:
			textureFormat = TextureFormat.ASTC_RGB_6x6;
			data = new IntPtr(data.ToInt64() + 16);
			num -= 16;
			break;
		case ovrAvatarTextureFormat.ASTC_RGB_6x6_MIPMAPS:
			textureFormat = TextureFormat.ASTC_RGB_6x6;
			break;
		default:
			throw new NotImplementedException($"Unsupported texture format {ovrAvatarTextureAssetData2.format.ToString()}");
		}
		texture = new Texture2D((int)ovrAvatarTextureAssetData2.sizeX, (int)ovrAvatarTextureAssetData2.sizeY, textureFormat, ovrAvatarTextureAssetData2.mipCount > 1, (QualitySettings.activeColorSpace != 0) ? true : false)
		{
			filterMode = FilterMode.Trilinear,
			anisoLevel = 4
		};
		texture.LoadRawTextureData(data, num);
		texture.Apply(updateMipmaps: true, makeNoLongerReadable: false);
	}
}
public class OvrAvatarBase : OvrAvatarComponent
{
	private ovrAvatarBaseComponent component;

	private void Update()
	{
		if (!(owner == null))
		{
			if (Oculus.Avatar.CAPI.ovrAvatarPose_GetBaseComponent(owner.sdkAvatar, ref component))
			{
				UpdateAvatar(component.renderComponent);
				return;
			}
			owner.Base = null;
			UnityEngine.Object.Destroy(this);
		}
	}
}
public class OvrAvatarBody : OvrAvatarComponent
{
	public ovrAvatarBodyComponent component;

	public ovrAvatarComponent? GetNativeAvatarComponent()
	{
		if (owner == null)
		{
			return null;
		}
		if (Oculus.Avatar.CAPI.ovrAvatarPose_GetBodyComponent(owner.sdkAvatar, ref component))
		{
			Oculus.Avatar.CAPI.ovrAvatarComponent_Get(component.renderComponent, includeName: true, ref nativeAvatarComponent);
			return nativeAvatarComponent;
		}
		return null;
	}

	private void Update()
	{
		if (!(owner == null))
		{
			if (Oculus.Avatar.CAPI.ovrAvatarPose_GetBodyComponent(owner.sdkAvatar, ref component))
			{
				UpdateAvatar(component.renderComponent);
				return;
			}
			owner.Body = null;
			UnityEngine.Object.Destroy(this);
		}
	}
}
public class OvrAvatarComponent : MonoBehaviour
{
	public static readonly string[] LayerKeywords = new string[9] { "LAYERS_0", "LAYERS_1", "LAYERS_2", "LAYERS_3", "LAYERS_4", "LAYERS_5", "LAYERS_6", "LAYERS_7", "LAYERS_8" };

	public static readonly string[] LayerSampleModeParameters = new string[8] { "_LayerSampleMode0", "_LayerSampleMode1", "_LayerSampleMode2", "_LayerSampleMode3", "_LayerSampleMode4", "_LayerSampleMode5", "_LayerSampleMode6", "_LayerSampleMode7" };

	public static readonly string[] LayerBlendModeParameters = new string[8] { "_LayerBlendMode0", "_LayerBlendMode1", "_LayerBlendMode2", "_LayerBlendMode3", "_LayerBlendMode4", "_LayerBlendMode5", "_LayerBlendMode6", "_LayerBlendMode7" };

	public static readonly string[] LayerMaskTypeParameters = new string[8] { "_LayerMaskType0", "_LayerMaskType1", "_LayerMaskType2", "_LayerMaskType3", "_LayerMaskType4", "_LayerMaskType5", "_LayerMaskType6", "_LayerMaskType7" };

	public static readonly string[] LayerColorParameters = new string[8] { "_LayerColor0", "_LayerColor1", "_LayerColor2", "_LayerColor3", "_LayerColor4", "_LayerColor5", "_LayerColor6", "_LayerColor7" };

	public static readonly string[] LayerSurfaceParameters = new string[8] { "_LayerSurface0", "_LayerSurface1", "_LayerSurface2", "_LayerSurface3", "_LayerSurface4", "_LayerSurface5", "_LayerSurface6", "_LayerSurface7" };

	public static readonly string[] LayerSampleParametersParameters = new string[8] { "_LayerSampleParameters0", "_LayerSampleParameters1", "_LayerSampleParameters2", "_LayerSampleParameters3", "_LayerSampleParameters4", "_LayerSampleParameters5", "_LayerSampleParameters6", "_LayerSampleParameters7" };

	public static readonly string[] LayerMaskParametersParameters = new string[8] { "_LayerMaskParameters0", "_LayerMaskParameters1", "_LayerMaskParameters2", "_LayerMaskParameters3", "_LayerMaskParameters4", "_LayerMaskParameters5", "_LayerMaskParameters6", "_LayerMaskParameters7" };

	public static readonly string[] LayerMaskAxisParameters = new string[8] { "_LayerMaskAxis0", "_LayerMaskAxis1", "_LayerMaskAxis2", "_LayerMaskAxis3", "_LayerMaskAxis4", "_LayerMaskAxis5", "_LayerMaskAxis6", "_LayerMaskAxis7" };

	private Dictionary<Material, ovrAvatarMaterialState> materialStates = new Dictionary<Material, ovrAvatarMaterialState>();

	public List<OvrAvatarRenderComponent> RenderParts = new List<OvrAvatarRenderComponent>();

	protected OvrAvatar owner;

	protected ovrAvatarComponent nativeAvatarComponent;

	public void SetOvrAvatarOwner(OvrAvatar ovrAvatarOwner)
	{
		owner = ovrAvatarOwner;
	}

	public void UpdateAvatar(IntPtr nativeComponent)
	{
		Oculus.Avatar.CAPI.ovrAvatarComponent_Get(nativeComponent, includeName: false, ref nativeAvatarComponent);
		OvrAvatar.ConvertTransform(nativeAvatarComponent.transform, base.transform);
		for (uint num = 0u; num < nativeAvatarComponent.renderPartCount && RenderParts.Count > num; num++)
		{
			OvrAvatarRenderComponent ovrAvatarRenderComponent = RenderParts[(int)num];
			IntPtr renderPart = OvrAvatar.GetRenderPart(nativeAvatarComponent, num);
			switch (Oculus.Avatar.CAPI.ovrAvatarRenderPart_GetType(renderPart))
			{
			case ovrAvatarRenderPartType.SkinnedMeshRender:
				((OvrAvatarSkinnedMeshRenderComponent)ovrAvatarRenderComponent).UpdateSkinnedMeshRender(this, owner, renderPart);
				break;
			case ovrAvatarRenderPartType.SkinnedMeshRenderPBS:
				((OvrAvatarSkinnedMeshRenderPBSComponent)ovrAvatarRenderComponent).UpdateSkinnedMeshRenderPBS(owner, renderPart, ovrAvatarRenderComponent.mesh.sharedMaterial);
				break;
			case ovrAvatarRenderPartType.SkinnedMeshRenderPBS_V2:
				((OvrAvatarSkinnedMeshPBSV2RenderComponent)ovrAvatarRenderComponent).UpdateSkinnedMeshRender(this, owner, renderPart);
				break;
			}
		}
	}

	protected void UpdateActive(OvrAvatar avatar, ovrAvatarVisibilityFlags mask)
	{
		bool flag = avatar.ShowFirstPerson && (mask & ovrAvatarVisibilityFlags.FirstPerson) != 0;
		flag |= avatar.ShowThirdPerson && (mask & ovrAvatarVisibilityFlags.ThirdPerson) != 0;
		base.gameObject.SetActive(flag);
	}

	public void UpdateAvatarMaterial(Material mat, ovrAvatarMaterialState matState)
	{
		mat.SetColor("_BaseColor", matState.baseColor);
		mat.SetInt("_BaseMaskType", (int)matState.baseMaskType);
		mat.SetVector("_BaseMaskParameters", matState.baseMaskParameters);
		mat.SetVector("_BaseMaskAxis", matState.baseMaskAxis);
		if (matState.alphaMaskTextureID != 0L)
		{
			mat.SetTexture("_AlphaMask", GetLoadedTexture(matState.alphaMaskTextureID));
			mat.SetTextureScale("_AlphaMask", new Vector2(matState.alphaMaskScaleOffset.x, matState.alphaMaskScaleOffset.y));
			mat.SetTextureOffset("_AlphaMask", new Vector2(matState.alphaMaskScaleOffset.z, matState.alphaMaskScaleOffset.w));
		}
		if (matState.normalMapTextureID != 0L)
		{
			mat.EnableKeyword("NORMAL_MAP_ON");
			mat.SetTexture("_NormalMap", GetLoadedTexture(matState.normalMapTextureID));
			mat.SetTextureScale("_NormalMap", new Vector2(matState.normalMapScaleOffset.x, matState.normalMapScaleOffset.y));
			mat.SetTextureOffset("_NormalMap", new Vector2(matState.normalMapScaleOffset.z, matState.normalMapScaleOffset.w));
		}
		if (matState.parallaxMapTextureID != 0L)
		{
			mat.SetTexture("_ParallaxMap", GetLoadedTexture(matState.parallaxMapTextureID));
			mat.SetTextureScale("_ParallaxMap", new Vector2(matState.parallaxMapScaleOffset.x, matState.parallaxMapScaleOffset.y));
			mat.SetTextureOffset("_ParallaxMap", new Vector2(matState.parallaxMapScaleOffset.z, matState.parallaxMapScaleOffset.w));
		}
		if (matState.roughnessMapTextureID != 0L)
		{
			mat.EnableKeyword("ROUGHNESS_ON");
			mat.SetTexture("_RoughnessMap", GetLoadedTexture(matState.roughnessMapTextureID));
			mat.SetTextureScale("_RoughnessMap", new Vector2(matState.roughnessMapScaleOffset.x, matState.roughnessMapScaleOffset.y));
			mat.SetTextureOffset("_RoughnessMap", new Vector2(matState.roughnessMapScaleOffset.z, matState.roughnessMapScaleOffset.w));
		}
		mat.EnableKeyword(LayerKeywords[matState.layerCount]);
		for (ulong num = 0uL; num < matState.layerCount; num++)
		{
			ovrAvatarMaterialLayerState ovrAvatarMaterialLayerState2 = matState.layers[num];
			mat.SetInt(LayerSampleModeParameters[num], (int)ovrAvatarMaterialLayerState2.sampleMode);
			mat.SetInt(LayerBlendModeParameters[num], (int)ovrAvatarMaterialLayerState2.blendMode);
			mat.SetInt(LayerMaskTypeParameters[num], (int)ovrAvatarMaterialLayerState2.maskType);
			mat.SetColor(LayerColorParameters[num], ovrAvatarMaterialLayerState2.layerColor);
			if (ovrAvatarMaterialLayerState2.sampleMode != 0)
			{
				string text = LayerSurfaceParameters[num];
				mat.SetTexture(text, GetLoadedTexture(ovrAvatarMaterialLayerState2.sampleTexture));
				mat.SetTextureScale(text, new Vector2(ovrAvatarMaterialLayerState2.sampleScaleOffset.x, ovrAvatarMaterialLayerState2.sampleScaleOffset.y));
				mat.SetTextureOffset(text, new Vector2(ovrAvatarMaterialLayerState2.sampleScaleOffset.z, ovrAvatarMaterialLayerState2.sampleScaleOffset.w));
			}
			if (ovrAvatarMaterialLayerState2.sampleMode == ovrAvatarMaterialLayerSampleMode.Parallax)
			{
				mat.EnableKeyword("PARALLAX_ON");
			}
			mat.SetColor(LayerSampleParametersParameters[num], ovrAvatarMaterialLayerState2.sampleParameters);
			mat.SetColor(LayerMaskParametersParameters[num], ovrAvatarMaterialLayerState2.maskParameters);
			mat.SetColor(LayerMaskAxisParameters[num], ovrAvatarMaterialLayerState2.maskAxis);
		}
		materialStates[mat] = matState;
	}

	public static Texture2D GetLoadedTexture(ulong assetId)
	{
		return ((OvrAvatarAssetTexture)OvrAvatarSDKManager.Instance.GetAsset(assetId))?.texture;
	}
}
public abstract class OvrAvatarDriver : MonoBehaviour
{
	public enum PacketMode
	{
		SDK,
		Unity
	}

	public struct ControllerPose
	{
		public ovrAvatarButton buttons;

		public ovrAvatarTouch touches;

		public Vector2 joystickPosition;

		public float indexTrigger;

		public float handTrigger;

		public bool isActive;

		public static ControllerPose Interpolate(ControllerPose a, ControllerPose b, float t)
		{
			ControllerPose result = default(ControllerPose);
			result.buttons = ((t < 0.5f) ? a.buttons : b.buttons);
			result.touches = ((t < 0.5f) ? a.touches : b.touches);
			result.joystickPosition = Vector2.Lerp(a.joystickPosition, b.joystickPosition, t);
			result.indexTrigger = Mathf.Lerp(a.indexTrigger, b.indexTrigger, t);
			result.handTrigger = Mathf.Lerp(a.handTrigger, b.handTrigger, t);
			result.isActive = ((t < 0.5f) ? a.isActive : b.isActive);
			return result;
		}
	}

	public struct PoseFrame
	{
		public Vector3 headPosition;

		public Quaternion headRotation;

		public Vector3 handLeftPosition;

		public Quaternion handLeftRotation;

		public Vector3 handRightPosition;

		public Quaternion handRightRotation;

		public float voiceAmplitude;

		public ControllerPose controllerLeftPose;

		public ControllerPose controllerRightPose;

		public static PoseFrame Interpolate(PoseFrame a, PoseFrame b, float t)
		{
			PoseFrame result = default(PoseFrame);
			result.headPosition = Vector3.Lerp(a.headPosition, b.headPosition, t);
			result.headRotation = Quaternion.Slerp(a.headRotation, b.headRotation, t);
			result.handLeftPosition = Vector3.Lerp(a.handLeftPosition, b.handLeftPosition, t);
			result.handLeftRotation = Quaternion.Slerp(a.handLeftRotation, b.handLeftRotation, t);
			result.handRightPosition = Vector3.Lerp(a.handRightPosition, b.handRightPosition, t);
			result.handRightRotation = Quaternion.Slerp(a.handRightRotation, b.handRightRotation, t);
			result.voiceAmplitude = Mathf.Lerp(a.voiceAmplitude, b.voiceAmplitude, t);
			result.controllerLeftPose = ControllerPose.Interpolate(a.controllerLeftPose, b.controllerLeftPose, t);
			result.controllerRightPose = ControllerPose.Interpolate(a.controllerRightPose, b.controllerRightPose, t);
			return result;
		}
	}

	public PacketMode Mode;

	protected PoseFrame CurrentPose;

	private ovrAvatarControllerType ControllerType = ovrAvatarControllerType.Quest;

	public PoseFrame GetCurrentPose()
	{
		return CurrentPose;
	}

	public abstract void UpdateTransforms(IntPtr sdkAvatar);

	private void Start()
	{
		switch (OVRPlugin.GetSystemHeadsetType())
		{
		case OVRPlugin.SystemHeadset.GearVR_R320:
		case OVRPlugin.SystemHeadset.GearVR_R321:
		case OVRPlugin.SystemHeadset.GearVR_R322:
		case OVRPlugin.SystemHeadset.GearVR_R323:
		case OVRPlugin.SystemHeadset.GearVR_R324:
		case OVRPlugin.SystemHeadset.GearVR_R325:
			ControllerType = ovrAvatarControllerType.Malibu;
			break;
		case OVRPlugin.SystemHeadset.Oculus_Go:
			ControllerType = ovrAvatarControllerType.Go;
			break;
		case OVRPlugin.SystemHeadset.Oculus_Quest:
		case OVRPlugin.SystemHeadset.Rift_S:
			ControllerType = ovrAvatarControllerType.Quest;
			break;
		default:
			ControllerType = ovrAvatarControllerType.Touch;
			break;
		}
	}

	public void UpdateTransformsFromPose(IntPtr sdkAvatar)
	{
		if (sdkAvatar != IntPtr.Zero)
		{
			ovrAvatarTransform headPose = OvrAvatar.CreateOvrAvatarTransform(CurrentPose.headPosition, CurrentPose.headRotation);
			ovrAvatarHandInputState inputStateLeft = OvrAvatar.CreateInputState(OvrAvatar.CreateOvrAvatarTransform(CurrentPose.handLeftPosition, CurrentPose.handLeftRotation), CurrentPose.controllerLeftPose);
			ovrAvatarHandInputState inputStateRight = OvrAvatar.CreateInputState(OvrAvatar.CreateOvrAvatarTransform(CurrentPose.handRightPosition, CurrentPose.handRightRotation), CurrentPose.controllerRightPose);
			Oculus.Avatar.CAPI.ovrAvatarPose_UpdateBody(sdkAvatar, headPose);
			Oculus.Avatar.CAPI.ovrAvatarPose_UpdateHandsWithType(sdkAvatar, inputStateLeft, inputStateRight, ControllerType);
		}
	}

	public static bool GetIsTrackedRemote()
	{
		if (!OVRInput.IsControllerConnected(OVRInput.Controller.RTrackedRemote))
		{
			return OVRInput.IsControllerConnected(OVRInput.Controller.LTrackedRemote);
		}
		return true;
	}
}
public class OvrAvatarHand : OvrAvatarComponent
{
	public bool isLeftHand = true;

	private ovrAvatarHandComponent component;

	private void Update()
	{
		if (owner == null)
		{
			return;
		}
		bool flag = false;
		if ((!isLeftHand) ? Oculus.Avatar.CAPI.ovrAvatarPose_GetRightHandComponent(owner.sdkAvatar, ref component) : Oculus.Avatar.CAPI.ovrAvatarPose_GetLeftHandComponent(owner.sdkAvatar, ref component))
		{
			UpdateAvatar(component.renderComponent);
			return;
		}
		if (isLeftHand)
		{
			owner.HandLeft = null;
		}
		else
		{
			owner.HandRight = null;
		}
		UnityEngine.Object.Destroy(this);
	}
}
public class OvrAvatarLocalDriver : OvrAvatarDriver
{
	private Vector3 centerEyePosition = Vector3.zero;

	private Quaternion centerEyeRotation = Quaternion.identity;

	private float voiceAmplitude;

	private ControllerPose GetMalibuControllerPose(OVRInput.Controller controller)
	{
		ovrAvatarButton ovrAvatarButton2 = (ovrAvatarButton)0;
		if (OVRInput.Get(OVRInput.Button.PrimaryIndexTrigger, controller))
		{
			ovrAvatarButton2 |= ovrAvatarButton.One;
		}
		ControllerPose result = default(ControllerPose);
		result.buttons = ovrAvatarButton2;
		result.touches = (OVRInput.Get(OVRInput.Touch.PrimaryTouchpad) ? ovrAvatarTouch.One : ((ovrAvatarTouch)0));
		result.joystickPosition = OVRInput.Get(OVRInput.Axis2D.PrimaryTouchpad, controller);
		result.indexTrigger = 0f;
		result.handTrigger = 0f;
		result.isActive = (OVRInput.GetActiveController() & controller) != 0;
		return result;
	}

	private ControllerPose GetControllerPose(OVRInput.Controller controller)
	{
		ovrAvatarButton ovrAvatarButton2 = (ovrAvatarButton)0;
		if (OVRInput.Get(OVRInput.Button.One, controller))
		{
			ovrAvatarButton2 |= ovrAvatarButton.One;
		}
		if (OVRInput.Get(OVRInput.Button.Two, controller))
		{
			ovrAvatarButton2 |= ovrAvatarButton.Two;
		}
		if (OVRInput.Get(OVRInput.Button.Start, controller))
		{
			ovrAvatarButton2 |= ovrAvatarButton.Three;
		}
		if (OVRInput.Get(OVRInput.Button.PrimaryThumbstick, controller))
		{
			ovrAvatarButton2 |= ovrAvatarButton.Joystick;
		}
		ovrAvatarTouch ovrAvatarTouch2 = (ovrAvatarTouch)0;
		if (OVRInput.Get(OVRInput.Touch.One, controller))
		{
			ovrAvatarTouch2 |= ovrAvatarTouch.One;
		}
		if (OVRInput.Get(OVRInput.Touch.Two, controller))
		{
			ovrAvatarTouch2 |= ovrAvatarTouch.Two;
		}
		if (OVRInput.Get(OVRInput.Touch.PrimaryThumbstick, controller))
		{
			ovrAvatarTouch2 |= ovrAvatarTouch.Joystick;
		}
		if (OVRInput.Get(OVRInput.Touch.PrimaryThumbRest, controller))
		{
			ovrAvatarTouch2 |= ovrAvatarTouch.ThumbRest;
		}
		if (OVRInput.Get(OVRInput.Touch.PrimaryIndexTrigger, controller))
		{
			ovrAvatarTouch2 |= ovrAvatarTouch.Index;
		}
		if (!OVRInput.Get(OVRInput.NearTouch.PrimaryIndexTrigger, controller))
		{
			ovrAvatarTouch2 |= ovrAvatarTouch.Pointing;
		}
		if (!OVRInput.Get(OVRInput.NearTouch.PrimaryThumbButtons, controller))
		{
			ovrAvatarTouch2 |= ovrAvatarTouch.ThumbUp;
		}
		ControllerPose result = default(ControllerPose);
		result.buttons = ovrAvatarButton2;
		result.touches = ovrAvatarTouch2;
		result.joystickPosition = OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, controller);
		result.indexTrigger = OVRInput.Get(OVRInput.Axis1D.PrimaryIndexTrigger, controller);
		result.handTrigger = OVRInput.Get(OVRInput.Axis1D.PrimaryHandTrigger, controller);
		result.isActive = (OVRInput.GetActiveController() & controller) != 0;
		return result;
	}

	private void CalculateCurrentPose()
	{
		OVRNodeStateProperties.GetNodeStatePropertyVector3(XRNode.CenterEye, NodeStatePropertyType.Position, OVRPlugin.Node.EyeCenter, OVRPlugin.Step.Render, out centerEyePosition);
		OVRNodeStateProperties.GetNodeStatePropertyQuaternion(XRNode.CenterEye, NodeStatePropertyType.Orientation, OVRPlugin.Node.EyeCenter, OVRPlugin.Step.Render, out centerEyeRotation);
		if (OvrAvatarDriver.GetIsTrackedRemote())
		{
			CurrentPose = new PoseFrame
			{
				voiceAmplitude = voiceAmplitude,
				headPosition = centerEyePosition,
				headRotation = centerEyeRotation,
				handLeftPosition = OVRInput.GetLocalControllerPosition(OVRInput.Controller.LTrackedRemote),
				handLeftRotation = OVRInput.GetLocalControllerRotation(OVRInput.Controller.LTrackedRemote),
				handRightPosition = OVRInput.GetLocalControllerPosition(OVRInput.Controller.RTrackedRemote),
				handRightRotation = OVRInput.GetLocalControllerRotation(OVRInput.Controller.RTrackedRemote),
				controllerLeftPose = GetMalibuControllerPose(OVRInput.Controller.LTrackedRemote),
				controllerRightPose = GetMalibuControllerPose(OVRInput.Controller.RTrackedRemote)
			};
		}
		else
		{
			CurrentPose = new PoseFrame
			{
				voiceAmplitude = voiceAmplitude,
				headPosition = centerEyePosition,
				headRotation = centerEyeRotation,
				handLeftPosition = OVRInput.GetLocalControllerPosition(OVRInput.Controller.LTouch),
				handLeftRotation = OVRInput.GetLocalControllerRotation(OVRInput.Controller.LTouch),
				handRightPosition = OVRInput.GetLocalControllerPosition(OVRInput.Controller.RTouch),
				handRightRotation = OVRInput.GetLocalControllerRotation(OVRInput.Controller.RTouch),
				controllerLeftPose = GetControllerPose(OVRInput.Controller.LTouch),
				controllerRightPose = GetControllerPose(OVRInput.Controller.RTouch)
			};
		}
	}

	public override void UpdateTransforms(IntPtr sdkAvatar)
	{
		CalculateCurrentPose();
		UpdateTransformsFromPose(sdkAvatar);
	}
}
public class OvrAvatarMaterialManager : MonoBehaviour
{
	public enum TextureType
	{
		DiffuseTextures,
		NormalMaps,
		RoughnessMaps,
		Count
	}

	public struct AvatarComponentMaterialProperties
	{
		public ovrAvatarBodyPartType TypeIndex;

		public Color Color;

		public Texture2D[] Textures;

		public float DiffuseIntensity;

		public float RimIntensity;

		public float ReflectionIntensity;
	}

	public struct AvatarTextureArrayProperties
	{
		public Texture2D[] Textures;

		public Texture2DArray TextureArray;
	}

	public struct AvatarMaterialPropertyBlock
	{
		public Vector4[] Colors;

		public float[] DiffuseIntensities;

		public float[] RimIntensities;

		public float[] ReflectionIntensities;
	}

	[Serializable]
	public class AvatarMaterialConfig
	{
		public AvatarComponentMaterialProperties[] ComponentMaterialProperties;

		public AvatarMaterialPropertyBlock MaterialPropertyBlock;
	}

	private Renderer TargetRenderer;

	private AvatarTextureArrayProperties[] TextureArrays;

	private readonly string[] TextureTypeToShaderProperties = new string[3] { "_MainTex", "_NormalMap", "_RoughnessMap" };

	public AvatarMaterialConfig LocalAvatarConfig = new AvatarMaterialConfig();

	public List<ReflectionProbeBlendInfo> ReflectionProbes = new List<ReflectionProbeBlendInfo>();

	private Shader CombinedShader;

	public static string AVATAR_SHADER_LOADER = "OvrAvatar/Avatar_Mobile_Loader";

	public static string AVATAR_SHADER_MAINTEX = "_MainTex";

	public static string AVATAR_SHADER_NORMALMAP = "_NormalMap";

	public static string AVATAR_SHADER_ROUGHNESSMAP = "_RoughnessMap";

	public static string AVATAR_SHADER_COLOR = "_BaseColor";

	public static string AVATAR_SHADER_DIFFUSEINTENSITY = "_DiffuseIntensity";

	public static string AVATAR_SHADER_RIMINTENSITY = "_RimIntensity";

	public static string AVATAR_SHADER_REFLECTIONINTENSITY = "_ReflectionIntensity";

	public static string AVATAR_SHADER_CUBEMAP = "_Cubemap";

	public static string AVATAR_SHADER_ALPHA = "_Alpha";

	public static string AVATAR_SHADER_LOADING_DIMMER = "_LoadingDimmer";

	public static string AVATAR_SHADER_IRIS_COLOR = "_MaskColorIris";

	public static string AVATAR_SHADER_LIP_COLOR = "_MaskColorLips";

	public static string AVATAR_SHADER_BROW_COLOR = "_MaskColorBrows";

	public static string AVATAR_SHADER_LASH_COLOR = "_MaskColorLashes";

	public static string AVATAR_SHADER_SCLERA_COLOR = "_MaskColorSclera";

	public static string AVATAR_SHADER_GUM_COLOR = "_MaskColorGums";

	public static string AVATAR_SHADER_TEETH_COLOR = "_MaskColorTeeth";

	public static string AVATAR_SHADER_LIP_SMOOTHNESS = "_LipSmoothness";

	public static float[] DiffuseIntensities = new float[5] { 0.3f, 0.1f, 0f, 0.15f, 0.15f };

	public static float[] RimIntensities = new float[5] { 5f, 2f, 2.84f, 4f, 4f };

	public static float[] ReflectionIntensities = new float[5] { 0f, 0.3f, 0.4f, 0f, 0f };

	private const float LOADING_ANIMATION_AMPLITUDE = 0.5f;

	private const float LOADING_ANIMATION_PERIOD = 0.35f;

	private const float LOADING_ANIMATION_CURVE_SCALE = 0.25f;

	private const float LOADING_ANIMATION_DIMMER_MIN = 0.3f;

	public void CreateTextureArrays()
	{
		LocalAvatarConfig.ComponentMaterialProperties = new AvatarComponentMaterialProperties[5];
		LocalAvatarConfig.MaterialPropertyBlock.Colors = new Vector4[5];
		LocalAvatarConfig.MaterialPropertyBlock.DiffuseIntensities = new float[5];
		LocalAvatarConfig.MaterialPropertyBlock.RimIntensities = new float[5];
		LocalAvatarConfig.MaterialPropertyBlock.ReflectionIntensities = new float[5];
		for (int i = 0; i < LocalAvatarConfig.ComponentMaterialProperties.Length; i++)
		{
			LocalAvatarConfig.ComponentMaterialProperties[i].Textures = new Texture2D[3];
		}
		TextureArrays = new AvatarTextureArrayProperties[3];
	}

	public void SetRenderer(Renderer renderer)
	{
		TargetRenderer = renderer;
		TargetRenderer.GetClosestReflectionProbes(ReflectionProbes);
	}

	public void OnCombinedMeshReady()
	{
		InitTextureArrays();
		SetMaterialPropertyBlock();
		StartCoroutine(RunLoadingAnimation(DeleteTextureSet));
	}

	public void AddTextureIDToTextureManager(ulong assetID, bool isSingleComponent)
	{
		OvrAvatarSDKManager.Instance.GetTextureCopyManager().AddTextureIDToTextureSet(GetInstanceID(), assetID, isSingleComponent);
	}

	private void DeleteTextureSet()
	{
		OvrAvatarSDKManager.Instance.GetTextureCopyManager().DeleteTextureSet(GetInstanceID());
	}

	public void InitTextureArrays()
	{
		AvatarComponentMaterialProperties avatarComponentMaterialProperties = LocalAvatarConfig.ComponentMaterialProperties[0];
		for (int i = 0; i < TextureArrays.Length && i < avatarComponentMaterialProperties.Textures.Length; i++)
		{
			TextureArrays[i].TextureArray = new Texture2DArray(avatarComponentMaterialProperties.Textures[0].height, avatarComponentMaterialProperties.Textures[0].width, LocalAvatarConfig.ComponentMaterialProperties.Length, avatarComponentMaterialProperties.Textures[0].format, mipChain: true, (QualitySettings.activeColorSpace != 0) ? true : false)
			{
				filterMode = FilterMode.Trilinear,
				anisoLevel = ((i == 2) ? 16 : 4)
			};
			TextureArrays[i].TextureArray.name = $"Texture Array Type: {(TextureType)i}";
			TextureArrays[i].Textures = new Texture2D[LocalAvatarConfig.ComponentMaterialProperties.Length];
			for (int j = 0; j < LocalAvatarConfig.ComponentMaterialProperties.Length; j++)
			{
				TextureArrays[i].Textures[j] = LocalAvatarConfig.ComponentMaterialProperties[j].Textures[i];
				TextureArrays[i].Textures[j].name = $"Texture Type: {(TextureType)i} Component: {j}";
			}
			ProcessTexturesWithMips(TextureArrays[i].Textures, avatarComponentMaterialProperties.Textures[i].height, TextureArrays[i].TextureArray);
		}
	}

	private void ProcessTexturesWithMips(Texture2D[] textures, int texArrayResolution, Texture2DArray texArray)
	{
		for (int i = 0; i < textures.Length; i++)
		{
			int num = texArrayResolution;
			for (int num2 = textures[i].mipmapCount - 1; num2 >= 0; num2--)
			{
				int mipSize = texArrayResolution / num;
				OvrAvatarSDKManager.Instance.GetTextureCopyManager().CopyTexture(textures[i], texArray, num2, mipSize, i, useQueue: false);
				num /= 2;
			}
		}
	}

	private void SetMaterialPropertyBlock()
	{
		if (TargetRenderer != null)
		{
			for (int i = 0; i < LocalAvatarConfig.ComponentMaterialProperties.Length; i++)
			{
				LocalAvatarConfig.MaterialPropertyBlock.Colors[i] = LocalAvatarConfig.ComponentMaterialProperties[i].Color;
				LocalAvatarConfig.MaterialPropertyBlock.DiffuseIntensities[i] = DiffuseIntensities[i];
				LocalAvatarConfig.MaterialPropertyBlock.RimIntensities[i] = RimIntensities[i];
				LocalAvatarConfig.MaterialPropertyBlock.ReflectionIntensities[i] = ReflectionIntensities[i];
			}
		}
	}

	private void ApplyMaterialPropertyBlock()
	{
		MaterialPropertyBlock materialPropertyBlock = new MaterialPropertyBlock();
		materialPropertyBlock.SetVectorArray(AVATAR_SHADER_COLOR, LocalAvatarConfig.MaterialPropertyBlock.Colors);
		materialPropertyBlock.SetFloatArray(AVATAR_SHADER_DIFFUSEINTENSITY, LocalAvatarConfig.MaterialPropertyBlock.DiffuseIntensities);
		materialPropertyBlock.SetFloatArray(AVATAR_SHADER_RIMINTENSITY, LocalAvatarConfig.MaterialPropertyBlock.RimIntensities);
		materialPropertyBlock.SetFloatArray(AVATAR_SHADER_REFLECTIONINTENSITY, LocalAvatarConfig.MaterialPropertyBlock.ReflectionIntensities);
		TargetRenderer.GetClosestReflectionProbes(ReflectionProbes);
		if (ReflectionProbes != null && ReflectionProbes.Count > 0 && ReflectionProbes[0].probe.texture != null)
		{
			materialPropertyBlock.SetTexture(AVATAR_SHADER_CUBEMAP, ReflectionProbes[0].probe.texture);
		}
		for (int i = 0; i < TextureArrays.Length; i++)
		{
			materialPropertyBlock.SetTexture(TextureTypeToShaderProperties[i], TextureArrays[i].TextureArray);
		}
		TargetRenderer.SetPropertyBlock(materialPropertyBlock);
	}

	public static ovrAvatarBodyPartType GetComponentType(string objectName)
	{
		if (objectName.Contains("0"))
		{
			return ovrAvatarBodyPartType.Body;
		}
		if (objectName.Contains("1"))
		{
			return ovrAvatarBodyPartType.Clothing;
		}
		if (objectName.Contains("2"))
		{
			return ovrAvatarBodyPartType.Eyewear;
		}
		if (objectName.Contains("3"))
		{
			return ovrAvatarBodyPartType.Hair;
		}
		if (objectName.Contains("4"))
		{
			return ovrAvatarBodyPartType.Beard;
		}
		return ovrAvatarBodyPartType.Count;
	}

	private ulong GetTextureIDForType(ovrAvatarPBSMaterialState materialState, TextureType type)
	{
		return type switch
		{
			TextureType.DiffuseTextures => materialState.albedoTextureID, 
			TextureType.NormalMaps => materialState.normalTextureID, 
			TextureType.RoughnessMaps => materialState.metallicnessTextureID, 
			_ => 0uL, 
		};
	}

	public void ValidateTextures(ovrAvatarPBSMaterialState[] materialStates)
	{
		AvatarComponentMaterialProperties[] componentMaterialProperties = LocalAvatarConfig.ComponentMaterialProperties;
		int[] array = new int[3];
		TextureFormat[] array2 = new TextureFormat[3];
		for (int i = 0; i < componentMaterialProperties.Length; i++)
		{
			for (int j = 0; j < componentMaterialProperties[i].Textures.Length; j++)
			{
				if (componentMaterialProperties[i].Textures[j] == null)
				{
					string text = componentMaterialProperties[i].TypeIndex.ToString();
					TextureType textureType = (TextureType)j;
					throw new Exception(text + "Invalid: " + textureType);
				}
				array[j] = componentMaterialProperties[i].Textures[j].height;
				array2[j] = componentMaterialProperties[i].Textures[j].format;
			}
		}
		for (int k = 0; k < 3; k++)
		{
			for (int l = 1; l < componentMaterialProperties.Length; l++)
			{
				if (componentMaterialProperties[l - 1].Textures[k].height != componentMaterialProperties[l].Textures[k].height)
				{
					object[] obj = new object[12]
					{
						componentMaterialProperties[l].TypeIndex.ToString(),
						" Mismatching Resolutions: ",
						null,
						null,
						null,
						null,
						null,
						null,
						null,
						null,
						null,
						null
					};
					TextureType textureType = (TextureType)k;
					obj[2] = textureType.ToString();
					obj[3] = " ";
					obj[4] = componentMaterialProperties[l - 1].Textures[k].height;
					obj[5] = " (ID: ";
					obj[6] = GetTextureIDForType(materialStates[l - 1], (TextureType)k);
					obj[7] = ") vs ";
					obj[8] = componentMaterialProperties[l].Textures[k].height;
					obj[9] = " (ID: ";
					obj[10] = GetTextureIDForType(materialStates[l], (TextureType)k);
					obj[11] = ") Ensure you are using ASTC texture compression on Android or turn off CombineMeshes";
					throw new Exception(string.Concat(obj));
				}
				if (componentMaterialProperties[l - 1].Textures[k].format != componentMaterialProperties[l].Textures[k].format)
				{
					object[] obj2 = new object[12]
					{
						componentMaterialProperties[l].TypeIndex.ToString(),
						" Mismatching Formats: ",
						null,
						null,
						null,
						null,
						null,
						null,
						null,
						null,
						null,
						null
					};
					TextureType textureType = (TextureType)k;
					obj2[2] = textureType.ToString();
					obj2[3] = " ";
					obj2[4] = componentMaterialProperties[l - 1].Textures[k].format;
					obj2[5] = " (ID: ";
					obj2[6] = GetTextureIDForType(materialStates[l - 1], (TextureType)k);
					obj2[7] = ") vs ";
					obj2[8] = componentMaterialProperties[l].Textures[k].format;
					obj2[9] = " (ID: ";
					obj2[10] = GetTextureIDForType(materialStates[l], (TextureType)k);
					obj2[11] = ") Ensure you are using ASTC texture compression on Android or turn off CombineMeshes";
					throw new Exception(string.Concat(obj2));
				}
			}
		}
	}

	private IEnumerator RunLoadingAnimation(Action callBack)
	{
		CombinedShader = TargetRenderer.sharedMaterial.shader;
		int srcBlend = TargetRenderer.sharedMaterial.GetInt("_SrcBlend");
		int dstBlend = TargetRenderer.sharedMaterial.GetInt("_DstBlend");
		string lightModeTag = TargetRenderer.sharedMaterial.GetTag("LightMode", searchFallbacks: false);
		string renderTypeTag = TargetRenderer.sharedMaterial.GetTag("RenderType", searchFallbacks: false);
		string renderQueueTag = TargetRenderer.sharedMaterial.GetTag("Queue", searchFallbacks: false);
		string ignoreProjectorTag = TargetRenderer.sharedMaterial.GetTag("IgnoreProjector", searchFallbacks: false);
		int renderQueue = TargetRenderer.sharedMaterial.renderQueue;
		bool transparentQueue = TargetRenderer.sharedMaterial.IsKeywordEnabled("_ALPHATEST_ON");
		TargetRenderer.sharedMaterial.shader = Shader.Find(AVATAR_SHADER_LOADER);
		TargetRenderer.sharedMaterial.SetColor(AVATAR_SHADER_COLOR, Color.white);
		while (OvrAvatarSDKManager.Instance.GetTextureCopyManager().GetTextureCount() > 0)
		{
			float value = (0.5f * Mathf.Sin(Time.timeSinceLevelLoad / 0.35f) + 0.5f) * 0.25f + 0.3f;
			TargetRenderer.sharedMaterial.SetFloat(AVATAR_SHADER_LOADING_DIMMER, value);
			yield return null;
		}
		TargetRenderer.sharedMaterial.SetFloat(AVATAR_SHADER_LOADING_DIMMER, 1f);
		TargetRenderer.sharedMaterial.shader = CombinedShader;
		TargetRenderer.sharedMaterial.SetInt("_SrcBlend", srcBlend);
		TargetRenderer.sharedMaterial.SetInt("_DstBlend", dstBlend);
		TargetRenderer.sharedMaterial.SetOverrideTag("LightMode", lightModeTag);
		TargetRenderer.sharedMaterial.SetOverrideTag("RenderType", renderTypeTag);
		TargetRenderer.sharedMaterial.SetOverrideTag("Queue", renderQueueTag);
		TargetRenderer.sharedMaterial.SetOverrideTag("IgnoreProjector", ignoreProjectorTag);
		if (transparentQueue)
		{
			TargetRenderer.sharedMaterial.EnableKeyword("_ALPHATEST_ON");
			TargetRenderer.sharedMaterial.EnableKeyword("_ALPHABLEND_ON");
			TargetRenderer.sharedMaterial.EnableKeyword("_ALPHAPREMULTIPLY_ON");
		}
		else
		{
			TargetRenderer.sharedMaterial.DisableKeyword("_ALPHATEST_ON");
			TargetRenderer.sharedMaterial.DisableKeyword("_ALPHABLEND_ON");
			TargetRenderer.sharedMaterial.DisableKeyword("_ALPHAPREMULTIPLY_ON");
		}
		TargetRenderer.sharedMaterial.renderQueue = renderQueue;
		ApplyMaterialPropertyBlock();
		callBack?.Invoke();
	}
}
public class OvrAvatarPacket
{
	public IntPtr ovrNativePacket = IntPtr.Zero;

	private List<float> frameTimes = new List<float>();

	private List<OvrAvatarDriver.PoseFrame> frames = new List<OvrAvatarDriver.PoseFrame>();

	private List<byte[]> encodedAudioPackets = new List<byte[]>();

	public float Duration => frameTimes[frameTimes.Count - 1];

	public OvrAvatarDriver.PoseFrame FinalFrame => frames[frames.Count - 1];

	public OvrAvatarPacket()
	{
	}

	public OvrAvatarPacket(OvrAvatarDriver.PoseFrame initialPose)
	{
		frameTimes.Add(0f);
		frames.Add(initialPose);
	}

	private OvrAvatarPacket(List<float> frameTimes, List<OvrAvatarDriver.PoseFrame> frames, List<byte[]> audioPackets)
	{
		this.frameTimes = frameTimes;
		this.frames = frames;
	}

	public void AddFrame(OvrAvatarDriver.PoseFrame frame, float deltaSeconds)
	{
		frameTimes.Add(Duration + deltaSeconds);
		frames.Add(frame);
	}

	public OvrAvatarDriver.PoseFrame GetPoseFrame(float seconds)
	{
		if (frames.Count == 1)
		{
			return frames[0];
		}
		int i;
		for (i = 1; i < frameTimes.Count && frameTimes[i] < seconds; i++)
		{
		}
		OvrAvatarDriver.PoseFrame a = frames[i - 1];
		OvrAvatarDriver.PoseFrame b = frames[i];
		float num = frameTimes[i - 1];
		float num2 = frameTimes[i];
		float t = (seconds - num) / (num2 - num);
		return OvrAvatarDriver.PoseFrame.Interpolate(a, b, t);
	}

	public static OvrAvatarPacket Read(Stream stream)
	{
		BinaryReader binaryReader = new BinaryReader(stream);
		int num = binaryReader.ReadInt32();
		List<float> list = new List<float>(num);
		for (int i = 0; i < num; i++)
		{
			list.Add(binaryReader.ReadSingle());
		}
		List<OvrAvatarDriver.PoseFrame> list2 = new List<OvrAvatarDriver.PoseFrame>(num);
		for (int j = 0; j < num; j++)
		{
			list2.Add(binaryReader.ReadPoseFrame());
		}
		int num2 = binaryReader.ReadInt32();
		List<byte[]> list3 = new List<byte[]>(num2);
		for (int k = 0; k < num2; k++)
		{
			int count = binaryReader.ReadInt32();
			byte[] item = binaryReader.ReadBytes(count);
			list3.Add(item);
		}
		return new OvrAvatarPacket(list, list2, list3);
	}

	public void Write(Stream stream)
	{
		BinaryWriter binaryWriter = new BinaryWriter(stream);
		int count = frameTimes.Count;
		binaryWriter.Write(count);
		for (int i = 0; i < count; i++)
		{
			binaryWriter.Write(frameTimes[i]);
		}
		for (int j = 0; j < count; j++)
		{
			OvrAvatarDriver.PoseFrame frame = frames[j];
			binaryWriter.Write(frame);
		}
		int count2 = encodedAudioPackets.Count;
		binaryWriter.Write(count2);
		for (int k = 0; k < count2; k++)
		{
			byte[] array = encodedAudioPackets[k];
			binaryWriter.Write(array.Length);
			binaryWriter.Write(array);
		}
	}
}
internal static class BinaryWriterExtensions
{
	public static void Write(this BinaryWriter writer, OvrAvatarDriver.PoseFrame frame)
	{
		writer.Write(frame.headPosition);
		writer.Write(frame.headRotation);
		writer.Write(frame.handLeftPosition);
		writer.Write(frame.handLeftRotation);
		writer.Write(frame.handRightPosition);
		writer.Write(frame.handRightRotation);
		writer.Write(frame.voiceAmplitude);
		writer.Write(frame.controllerLeftPose);
		writer.Write(frame.controllerRightPose);
	}

	public static void Write(this BinaryWriter writer, Vector3 vec3)
	{
		writer.Write(vec3.x);
		writer.Write(vec3.y);
		writer.Write(vec3.z);
	}

	public static void Write(this BinaryWriter writer, Vector2 vec2)
	{
		writer.Write(vec2.x);
		writer.Write(vec2.y);
	}

	public static void Write(this BinaryWriter writer, Quaternion quat)
	{
		writer.Write(quat.x);
		writer.Write(quat.y);
		writer.Write(quat.z);
		writer.Write(quat.w);
	}

	public static void Write(this BinaryWriter writer, OvrAvatarDriver.ControllerPose pose)
	{
		writer.Write((uint)pose.buttons);
		writer.Write((uint)pose.touches);
		writer.Write(pose.joystickPosition);
		writer.Write(pose.indexTrigger);
		writer.Write(pose.handTrigger);
		writer.Write(pose.isActive);
	}
}
internal static class BinaryReaderExtensions
{
	public static OvrAvatarDriver.PoseFrame ReadPoseFrame(this BinaryReader reader)
	{
		OvrAvatarDriver.PoseFrame result = default(OvrAvatarDriver.PoseFrame);
		result.headPosition = reader.ReadVector3();
		result.headRotation = reader.ReadQuaternion();
		result.handLeftPosition = reader.ReadVector3();
		result.handLeftRotation = reader.ReadQuaternion();
		result.handRightPosition = reader.ReadVector3();
		result.handRightRotation = reader.ReadQuaternion();
		result.voiceAmplitude = reader.ReadSingle();
		result.controllerLeftPose = reader.ReadControllerPose();
		result.controllerRightPose = reader.ReadControllerPose();
		return result;
	}

	public static Vector2 ReadVector2(this BinaryReader reader)
	{
		Vector2 result = default(Vector2);
		result.x = reader.ReadSingle();
		result.y = reader.ReadSingle();
		return result;
	}

	public static Vector3 ReadVector3(this BinaryReader reader)
	{
		Vector3 result = default(Vector3);
		result.x = reader.ReadSingle();
		result.y = reader.ReadSingle();
		result.z = reader.ReadSingle();
		return result;
	}

	public static Quaternion ReadQuaternion(this BinaryReader reader)
	{
		Quaternion result = default(Quaternion);
		result.x = reader.ReadSingle();
		result.y = reader.ReadSingle();
		result.z = reader.ReadSingle();
		result.w = reader.ReadSingle();
		return result;
	}

	public static OvrAvatarDriver.ControllerPose ReadControllerPose(this BinaryReader reader)
	{
		OvrAvatarDriver.ControllerPose result = default(OvrAvatarDriver.ControllerPose);
		result.buttons = (ovrAvatarButton)reader.ReadUInt32();
		result.touches = (ovrAvatarTouch)reader.ReadUInt32();
		result.joystickPosition = reader.ReadVector2();
		result.indexTrigger = reader.ReadSingle();
		result.handTrigger = reader.ReadSingle();
		result.isActive = reader.ReadBoolean();
		return result;
	}
}
public class OvrAvatarRemoteDriver : OvrAvatarDriver
{
	private Queue<OvrAvatarPacket> packetQueue = new Queue<OvrAvatarPacket>();

	private IntPtr CurrentSDKPacket = IntPtr.Zero;

	private float CurrentPacketTime;

	private const int MinPacketQueue = 1;

	private const int MaxPacketQueue = 4;

	private int CurrentSequence = -1;

	private bool isStreaming;

	private OvrAvatarPacket currentPacket;

	public void QueuePacket(int sequence, OvrAvatarPacket packet)
	{
		if (sequence > CurrentSequence)
		{
			CurrentSequence = sequence;
			packetQueue.Enqueue(packet);
		}
	}

	public override void UpdateTransforms(IntPtr sdkAvatar)
	{
		switch (Mode)
		{
		case PacketMode.SDK:
			UpdateFromSDKPacket(sdkAvatar);
			break;
		case PacketMode.Unity:
			UpdateFromUnityPacket(sdkAvatar);
			break;
		}
	}

	private void UpdateFromSDKPacket(IntPtr sdkAvatar)
	{
		if (CurrentSDKPacket == IntPtr.Zero && packetQueue.Count >= 1)
		{
			CurrentSDKPacket = packetQueue.Dequeue().ovrNativePacket;
		}
		if (!(CurrentSDKPacket != IntPtr.Zero))
		{
			return;
		}
		float num = Oculus.Avatar.CAPI.ovrAvatarPacket_GetDurationSeconds(CurrentSDKPacket);
		Oculus.Avatar.CAPI.ovrAvatar_UpdatePoseFromPacket(sdkAvatar, CurrentSDKPacket, Mathf.Min(num, CurrentPacketTime));
		CurrentPacketTime += Time.deltaTime;
		if (CurrentPacketTime > num)
		{
			Oculus.Avatar.CAPI.ovrAvatarPacket_Free(CurrentSDKPacket);
			CurrentSDKPacket = IntPtr.Zero;
			CurrentPacketTime -= num;
			while (packetQueue.Count > 4)
			{
				packetQueue.Dequeue();
			}
		}
	}

	private void UpdateFromUnityPacket(IntPtr sdkAvatar)
	{
		if (!isStreaming && packetQueue.Count > 1)
		{
			currentPacket = packetQueue.Dequeue();
			isStreaming = true;
		}
		if (!isStreaming)
		{
			return;
		}
		CurrentPacketTime += Time.deltaTime;
		while (CurrentPacketTime > currentPacket.Duration)
		{
			if (packetQueue.Count == 0)
			{
				CurrentPose = currentPacket.FinalFrame;
				CurrentPacketTime = 0f;
				currentPacket = null;
				isStreaming = false;
				return;
			}
			while (packetQueue.Count > 4)
			{
				packetQueue.Dequeue();
			}
			CurrentPacketTime -= currentPacket.Duration;
			currentPacket = packetQueue.Dequeue();
		}
		CurrentPose = currentPacket.GetPoseFrame(CurrentPacketTime);
		UpdateTransformsFromPose(sdkAvatar);
	}
}
public class OvrAvatarRenderComponent : MonoBehaviour
{
	private bool firstSkinnedUpdate = true;

	public SkinnedMeshRenderer mesh;

	public Transform[] bones;

	private bool isBodyComponent;

	protected void UpdateActive(OvrAvatar avatar, ovrAvatarVisibilityFlags mask)
	{
		if (isBodyComponent && avatar.EnableExpressive && avatar.ShowFirstPerson && !avatar.ShowThirdPerson)
		{
			bool num = (mask & ovrAvatarVisibilityFlags.FirstPerson) != 0;
			bool flag = (mask & ovrAvatarVisibilityFlags.ThirdPerson) != 0;
			base.gameObject.SetActive(flag || flag);
			if (!num)
			{
				mesh.enabled = false;
			}
		}
		else
		{
			bool flag2 = avatar.ShowFirstPerson && (mask & ovrAvatarVisibilityFlags.FirstPerson) != 0;
			flag2 |= avatar.ShowThirdPerson && (mask & ovrAvatarVisibilityFlags.ThirdPerson) != 0;
			base.gameObject.SetActive(flag2);
			mesh.enabled = flag2;
		}
	}

	protected SkinnedMeshRenderer CreateSkinnedMesh(ulong assetID, ovrAvatarVisibilityFlags visibilityMask, int thirdPersonLayer, int firstPersonLayer)
	{
		isBodyComponent = base.name.Contains("body");
		OvrAvatarAssetMesh obj = ((OvrAvatarAssetMesh)OvrAvatarSDKManager.Instance.GetAsset(assetID)) ?? throw new Exception("Couldn't find mesh for asset " + assetID);
		if ((visibilityMask & ovrAvatarVisibilityFlags.ThirdPerson) != 0)
		{
			base.gameObject.layer = thirdPersonLayer;
		}
		else
		{
			base.gameObject.layer = firstPersonLayer;
		}
		SkinnedMeshRenderer skinnedMeshRenderer = obj.CreateSkinnedMeshRendererOnObject(base.gameObject);
		skinnedMeshRenderer.quality = SkinQuality.Bone2;
		skinnedMeshRenderer.updateWhenOffscreen = true;
		if ((visibilityMask & ovrAvatarVisibilityFlags.SelfOccluding) == 0)
		{
			skinnedMeshRenderer.shadowCastingMode = ShadowCastingMode.Off;
		}
		base.gameObject.SetActive(value: false);
		return skinnedMeshRenderer;
	}

	protected void UpdateSkinnedMesh(OvrAvatar avatar, Transform[] bones, ovrAvatarTransform localTransform, ovrAvatarVisibilityFlags visibilityMask, IntPtr renderPart)
	{
		UpdateActive(avatar, visibilityMask);
		OvrAvatar.ConvertTransform(localTransform, base.transform);
		ovrAvatarRenderPartType ovrAvatarRenderPartType2 = Oculus.Avatar.CAPI.ovrAvatarRenderPart_GetType(renderPart);
		ulong num = ovrAvatarRenderPartType2 switch
		{
			ovrAvatarRenderPartType.SkinnedMeshRender => Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRender_GetDirtyJoints(renderPart), 
			ovrAvatarRenderPartType.SkinnedMeshRenderPBS => Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRenderPBS_GetDirtyJoints(renderPart), 
			ovrAvatarRenderPartType.SkinnedMeshRenderPBS_V2 => Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRenderPBSV2_GetDirtyJoints(renderPart), 
			_ => throw new Exception("Unhandled render part type: " + ovrAvatarRenderPartType2), 
		};
		for (uint num2 = 0u; num2 < 64; num2++)
		{
			ulong num3 = (ulong)(1L << (int)num2);
			if ((firstSkinnedUpdate && num2 < bones.Length) || (num3 & num) != 0L)
			{
				Transform target = bones[num2];
				OvrAvatar.ConvertTransform(ovrAvatarRenderPartType2 switch
				{
					ovrAvatarRenderPartType.SkinnedMeshRender => Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRender_GetJointTransform(renderPart, num2), 
					ovrAvatarRenderPartType.SkinnedMeshRenderPBS => Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRenderPBS_GetJointTransform(renderPart, num2), 
					ovrAvatarRenderPartType.SkinnedMeshRenderPBS_V2 => Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRenderPBSV2_GetJointTransform(renderPart, num2), 
					_ => throw new Exception("Unhandled render part type: " + ovrAvatarRenderPartType2), 
				}, target);
			}
		}
		firstSkinnedUpdate = false;
	}

	protected Material CreateAvatarMaterial(string name, Shader shader)
	{
		if (shader == null)
		{
			throw new Exception("No shader provided for avatar material.");
		}
		return new Material(shader)
		{
			name = name
		};
	}
}
[Flags]
public enum ovrAvatarCapabilities
{
	Body = 1,
	Hands = 2,
	Base = 4,
	BodyTilt = 0x10,
	Expressive = 0x20,
	All = -1
}
public enum ovrAvatarMessageType
{
	AvatarSpecification,
	AssetLoaded,
	Count
}
public struct ovrAvatarMessage_AvatarSpecification
{
	public IntPtr avatarSpec;

	public ulong oculusUserID;
}
public struct ovrAvatarMessage_AssetLoaded
{
	public ulong assetID;

	public IntPtr asset;
}
public enum ovrAvatarAssetType
{
	Mesh,
	Texture,
	Pose,
	Material,
	CombinedMesh,
	PBSMaterial,
	FailedLoad,
	Count
}
public struct ovrAvatarMeshVertex
{
	public float x;

	public float y;

	public float z;

	public float nx;

	public float ny;

	public float nz;

	public float tx;

	public float ty;

	public float tz;

	public float tw;

	public float u;

	public float v;

	[MarshalAs(UnmanagedType.ByValArray, SizeConst = 4)]
	public byte[] blendIndices;

	[MarshalAs(UnmanagedType.ByValArray, SizeConst = 4)]
	public float[] blendWeights;
}
public struct ovrAvatarMeshVertexV2
{
	public float x;

	public float y;

	public float z;

	public float nx;

	public float ny;

	public float nz;

	public float tx;

	public float ty;

	public float tz;

	public float tw;

	public float u;

	public float v;

	public float r;

	public float g;

	public float b;

	public float a;

	[MarshalAs(UnmanagedType.ByValArray, SizeConst = 4)]
	public byte[] blendIndices;

	[MarshalAs(UnmanagedType.ByValArray, SizeConst = 4)]
	public float[] blendWeights;
}
public struct ovrAvatarBlendVertex
{
	public float x;

	public float y;

	public float z;

	public float nx;

	public float ny;

	public float nz;

	public float tx;

	public float ty;

	public float tz;
}
public struct ovrAvatarMeshAssetData
{
	public uint vertexCount;

	public IntPtr vertexBuffer;

	public uint indexCount;

	public IntPtr indexBuffer;

	public ovrAvatarSkinnedMeshPose skinnedBindPose;
}
public struct ovrAvatarMeshAssetDataV2
{
	public uint vertexCount;

	public IntPtr vertexBuffer;

	public uint indexCount;

	public IntPtr indexBuffer;

	public ovrAvatarSkinnedMeshPose skinnedBindPose;
}
public enum ovrAvatarTextureFormat
{
	RGB24,
	DXT1,
	DXT5,
	ASTC_RGB_6x6,
	ASTC_RGB_6x6_MIPMAPS,
	Count
}
public struct ovrAvatarTextureAssetData
{
	public ovrAvatarTextureFormat format;

	public uint sizeX;

	public uint sizeY;

	public uint mipCount;

	public ulong textureDataSize;

	public IntPtr textureData;
}
public enum ovrAvatarRenderPartType
{
	SkinnedMeshRender,
	SkinnedMeshRenderPBS,
	ProjectorRender,
	SkinnedMeshRenderPBS_V2,
	Count
}
public enum ovrAvatarLogLevel
{
	Unknown,
	Default,
	Verbose,
	Debug,
	Info,
	Warn,
	Error,
	Fatal,
	Silent
}
public struct ovrAvatarTransform
{
	public Vector3 position;

	public Quaternion orientation;

	public Vector3 scale;
}
[Flags]
public enum ovrAvatarButton
{
	One = 1,
	Two = 2,
	Three = 4,
	Joystick = 8
}
[Flags]
public enum ovrAvatarTouch
{
	One = 1,
	Two = 2,
	Joystick = 4,
	ThumbRest = 8,
	Index = 0x10,
	Pointing = 0x40,
	ThumbUp = 0x80
}
public struct ovrAvatarHandInputState
{
	public ovrAvatarTransform transform;

	public ovrAvatarButton buttonMask;

	public ovrAvatarTouch touchMask;

	public float joystickX;

	public float joystickY;

	public float indexTrigger;

	public float handTrigger;

	[MarshalAs(UnmanagedType.I1)]
	public bool isActive;
}
public struct ovrAvatarComponent
{
	public ovrAvatarTransform transform;

	public uint renderPartCount;

	public IntPtr renderParts;

	[MarshalAs(UnmanagedType.LPStr)]
	public string name;
}
[StructLayout(LayoutKind.Sequential, Size = 1)]
internal struct ovrAvatarComponent_Offsets
{
	public static long transform = Marshal.OffsetOf(typeof(ovrAvatarComponent), "transform").ToInt64();

	public static int renderPartCount = Marshal.OffsetOf(typeof(ovrAvatarComponent), "renderPartCount").ToInt32();

	public static int renderParts = Marshal.OffsetOf(typeof(ovrAvatarComponent), "renderParts").ToInt32();

	public static int name = Marshal.OffsetOf(typeof(ovrAvatarComponent), "name").ToInt32();
}
public struct ovrAvatarBaseComponent
{
	public Vector3 basePosition;

	public IntPtr renderComponent;
}
public struct ovrAvatarBodyComponent
{
	public ovrAvatarTransform leftEyeTransform;

	public ovrAvatarTransform rightEyeTransform;

	public ovrAvatarTransform centerEyeTransform;

	public IntPtr renderComponent;
}
[StructLayout(LayoutKind.Sequential, Size = 1)]
public struct ovrAvatarBodyComponent_Offsets
{
	public static long leftEyeTransform = Marshal.OffsetOf(typeof(ovrAvatarBodyComponent), "leftEyeTransform").ToInt64();

	public static long rightEyeTransform = Marshal.OffsetOf(typeof(ovrAvatarBodyComponent), "rightEyeTransform").ToInt64();

	public static long centerEyeTransform = Marshal.OffsetOf(typeof(ovrAvatarBodyComponent), "centerEyeTransform").ToInt64();

	public static long renderComponent = Marshal.OffsetOf(typeof(ovrAvatarBodyComponent), "renderComponent").ToInt64();
}
public struct ovrAvatarControllerComponent
{
	public ovrAvatarHandInputState inputState;

	public IntPtr renderComponent;
}
public struct ovrAvatarHandComponent
{
	public ovrAvatarHandInputState inputState;

	public IntPtr renderComponent;
}
public enum ovrAvatarMaterialLayerBlendMode
{
	Add,
	Multiply,
	Count
}
public enum ovrAvatarMaterialLayerSampleMode
{
	Color,
	Texture,
	TextureSingleChannel,
	Parallax,
	Count
}
public enum ovrAvatarMaterialMaskType
{
	None,
	Positional,
	ViewReflection,
	Fresnel,
	Pulse,
	Count
}
public enum ovrAvatarControllerType
{
	Touch,
	Malibu,
	Go,
	Quest,
	Count
}
public enum ovrAvatarAssetLevelOfDetail
{
	Lowest = 1,
	Medium = 3,
	Highest = 5
}
public enum ovrAvatarLookAndFeelVersion
{
	Unknown = -1,
	One,
	Two
}
public struct ovrAvatarMaterialLayerState
{
	public ovrAvatarMaterialLayerBlendMode blendMode;

	public ovrAvatarMaterialLayerSampleMode sampleMode;

	public ovrAvatarMaterialMaskType maskType;

	public Vector4 layerColor;

	public Vector4 sampleParameters;

	public ulong sampleTexture;

	public Vector4 sampleScaleOffset;

	public Vector4 maskParameters;

	public Vector4 maskAxis;

	private static bool VectorEquals(Vector4 a, Vector4 b)
	{
		if (a.x == b.x && a.y == b.y && a.z == b.z)
		{
			return a.w == b.w;
		}
		return false;
	}

	public override bool Equals(object obj)
	{
		if (!(obj is ovrAvatarMaterialLayerState ovrAvatarMaterialLayerState2))
		{
			return false;
		}
		if (blendMode != ovrAvatarMaterialLayerState2.blendMode)
		{
			return false;
		}
		if (sampleMode != ovrAvatarMaterialLayerState2.sampleMode)
		{
			return false;
		}
		if (maskType != ovrAvatarMaterialLayerState2.maskType)
		{
			return false;
		}
		if (!VectorEquals(layerColor, ovrAvatarMaterialLayerState2.layerColor))
		{
			return false;
		}
		if (!VectorEquals(sampleParameters, ovrAvatarMaterialLayerState2.sampleParameters))
		{
			return false;
		}
		if (sampleTexture != ovrAvatarMaterialLayerState2.sampleTexture)
		{
			return false;
		}
		if (!VectorEquals(sampleScaleOffset, ovrAvatarMaterialLayerState2.sampleScaleOffset))
		{
			return false;
		}
		if (!VectorEquals(maskParameters, ovrAvatarMaterialLayerState2.maskParameters))
		{
			return false;
		}
		if (!VectorEquals(maskAxis, ovrAvatarMaterialLayerState2.maskAxis))
		{
			return false;
		}
		return true;
	}

	public override int GetHashCode()
	{
		return blendMode.GetHashCode() ^ sampleMode.GetHashCode() ^ maskType.GetHashCode() ^ layerColor.GetHashCode() ^ sampleParameters.GetHashCode() ^ sampleTexture.GetHashCode() ^ sampleScaleOffset.GetHashCode() ^ maskParameters.GetHashCode() ^ maskAxis.GetHashCode();
	}
}
public struct ovrAvatarMaterialState
{
	public Vector4 baseColor;

	public ovrAvatarMaterialMaskType baseMaskType;

	public Vector4 baseMaskParameters;

	public Vector4 baseMaskAxis;

	public ovrAvatarMaterialLayerSampleMode sampleMode;

	public ulong alphaMaskTextureID;

	public Vector4 alphaMaskScaleOffset;

	public ulong normalMapTextureID;

	public Vector4 normalMapScaleOffset;

	public ulong parallaxMapTextureID;

	public Vector4 parallaxMapScaleOffset;

	public ulong roughnessMapTextureID;

	public Vector4 roughnessMapScaleOffset;

	public uint layerCount;

	[MarshalAs(UnmanagedType.ByValArray, SizeConst = 8)]
	public ovrAvatarMaterialLayerState[] layers;

	private static bool VectorEquals(Vector4 a, Vector4 b)
	{
		if (a.x == b.x && a.y == b.y && a.z == b.z)
		{
			return a.w == b.w;
		}
		return false;
	}

	public override bool Equals(object obj)
	{
		if (!(obj is ovrAvatarMaterialState ovrAvatarMaterialState2))
		{
			return false;
		}
		if (!VectorEquals(baseColor, ovrAvatarMaterialState2.baseColor))
		{
			return false;
		}
		if (baseMaskType != ovrAvatarMaterialState2.baseMaskType)
		{
			return false;
		}
		if (!VectorEquals(baseMaskParameters, ovrAvatarMaterialState2.baseMaskParameters))
		{
			return false;
		}
		if (!VectorEquals(baseMaskAxis, ovrAvatarMaterialState2.baseMaskAxis))
		{
			return false;
		}
		if (sampleMode != ovrAvatarMaterialState2.sampleMode)
		{
			return false;
		}
		if (alphaMaskTextureID != ovrAvatarMaterialState2.alphaMaskTextureID)
		{
			return false;
		}
		if (!VectorEquals(alphaMaskScaleOffset, ovrAvatarMaterialState2.alphaMaskScaleOffset))
		{
			return false;
		}
		if (normalMapTextureID != ovrAvatarMaterialState2.normalMapTextureID)
		{
			return false;
		}
		if (!VectorEquals(normalMapScaleOffset, ovrAvatarMaterialState2.normalMapScaleOffset))
		{
			return false;
		}
		if (parallaxMapTextureID != ovrAvatarMaterialState2.parallaxMapTextureID)
		{
			return false;
		}
		if (!VectorEquals(parallaxMapScaleOffset, ovrAvatarMaterialState2.parallaxMapScaleOffset))
		{
			return false;
		}
		if (roughnessMapTextureID != ovrAvatarMaterialState2.roughnessMapTextureID)
		{
			return false;
		}
		if (!VectorEquals(roughnessMapScaleOffset, ovrAvatarMaterialState2.roughnessMapScaleOffset))
		{
			return false;
		}
		if (layerCount != ovrAvatarMaterialState2.layerCount)
		{
			return false;
		}
		for (int i = 0; i < layerCount; i++)
		{
			if (!layers[i].Equals(ovrAvatarMaterialState2.layers[i]))
			{
				return false;
			}
		}
		return true;
	}

	public override int GetHashCode()
	{
		int num = 0;
		num ^= baseColor.GetHashCode();
		num ^= baseMaskType.GetHashCode();
		num ^= baseMaskParameters.GetHashCode();
		num ^= baseMaskAxis.GetHashCode();
		num ^= sampleMode.GetHashCode();
		num ^= alphaMaskTextureID.GetHashCode();
		num ^= alphaMaskScaleOffset.GetHashCode();
		num ^= normalMapTextureID.GetHashCode();
		num ^= normalMapScaleOffset.GetHashCode();
		num ^= parallaxMapTextureID.GetHashCode();
		num ^= parallaxMapScaleOffset.GetHashCode();
		num ^= roughnessMapTextureID.GetHashCode();
		num ^= roughnessMapScaleOffset.GetHashCode();
		num ^= layerCount.GetHashCode();
		for (int i = 0; i < layerCount; i++)
		{
			num ^= layers[i].GetHashCode();
		}
		return num;
	}
}
public struct ovrAvatarExpressiveParameters
{
	public Vector4 irisColor;

	public Vector4 scleraColor;

	public Vector4 lashColor;

	public Vector4 browColor;

	public Vector4 lipColor;

	public Vector4 teethColor;

	public Vector4 gumColor;

	public float browLashIntensity;

	public float lipSmoothness;

	private static bool VectorEquals(Vector4 a, Vector4 b)
	{
		if (a.x == b.x && a.y == b.y && a.z == b.z)
		{
			return a.w == b.w;
		}
		return false;
	}

	public override bool Equals(object obj)
	{
		if (!(obj is ovrAvatarExpressiveParameters ovrAvatarExpressiveParameters2))
		{
			return false;
		}
		if (!VectorEquals(irisColor, ovrAvatarExpressiveParameters2.irisColor))
		{
			return false;
		}
		if (!VectorEquals(scleraColor, ovrAvatarExpressiveParameters2.scleraColor))
		{
			return false;
		}
		if (!VectorEquals(lashColor, ovrAvatarExpressiveParameters2.lashColor))
		{
			return false;
		}
		if (!VectorEquals(browColor, ovrAvatarExpressiveParameters2.browColor))
		{
			return false;
		}
		if (!VectorEquals(lipColor, ovrAvatarExpressiveParameters2.lipColor))
		{
			return false;
		}
		if (!VectorEquals(teethColor, ovrAvatarExpressiveParameters2.teethColor))
		{
			return false;
		}
		if (!VectorEquals(gumColor, ovrAvatarExpressiveParameters2.gumColor))
		{
			return false;
		}
		if (browLashIntensity != ovrAvatarExpressiveParameters2.browLashIntensity)
		{
			return false;
		}
		if (lipSmoothness != ovrAvatarExpressiveParameters2.lipSmoothness)
		{
			return false;
		}
		return true;
	}

	public override int GetHashCode()
	{
		return irisColor.GetHashCode() ^ scleraColor.GetHashCode() ^ lashColor.GetHashCode() ^ browColor.GetHashCode() ^ lipColor.GetHashCode() ^ teethColor.GetHashCode() ^ gumColor.GetHashCode() ^ browLashIntensity.GetHashCode() ^ lipSmoothness.GetHashCode();
	}
}
public struct ovrAvatarPBSMaterialState
{
	public Vector4 baseColor;

	public ulong albedoTextureID;

	public Vector4 albedoMultiplier;

	public ulong metallicnessTextureID;

	public float glossinessScale;

	public ulong normalTextureID;

	public ulong heightTextureID;

	public ulong occlusionTextureID;

	public ulong emissionTextureID;

	public Vector4 emissionMultiplier;

	public ulong detailMaskTextureID;

	public ulong detailAlbedoTextureID;

	public ulong detailNormalTextureID;

	private static bool VectorEquals(Vector4 a, Vector4 b)
	{
		if (a.x == b.x && a.y == b.y && a.z == b.z)
		{
			return a.w == b.w;
		}
		return false;
	}

	public override bool Equals(object obj)
	{
		if (!(obj is ovrAvatarPBSMaterialState ovrAvatarPBSMaterialState2))
		{
			return false;
		}
		if (!VectorEquals(baseColor, ovrAvatarPBSMaterialState2.baseColor))
		{
			return false;
		}
		if (albedoTextureID != ovrAvatarPBSMaterialState2.albedoTextureID)
		{
			return false;
		}
		if (!VectorEquals(albedoMultiplier, ovrAvatarPBSMaterialState2.albedoMultiplier))
		{
			return false;
		}
		if (metallicnessTextureID != ovrAvatarPBSMaterialState2.metallicnessTextureID)
		{
			return false;
		}
		if (glossinessScale != ovrAvatarPBSMaterialState2.glossinessScale)
		{
			return false;
		}
		if (normalTextureID != ovrAvatarPBSMaterialState2.normalTextureID)
		{
			return false;
		}
		if (heightTextureID != ovrAvatarPBSMaterialState2.heightTextureID)
		{
			return false;
		}
		if (occlusionTextureID != ovrAvatarPBSMaterialState2.occlusionTextureID)
		{
			return false;
		}
		if (emissionTextureID != ovrAvatarPBSMaterialState2.emissionTextureID)
		{
			return false;
		}
		if (!VectorEquals(emissionMultiplier, ovrAvatarPBSMaterialState2.emissionMultiplier))
		{
			return false;
		}
		if (detailMaskTextureID != ovrAvatarPBSMaterialState2.detailMaskTextureID)
		{
			return false;
		}
		if (detailAlbedoTextureID != ovrAvatarPBSMaterialState2.detailAlbedoTextureID)
		{
			return false;
		}
		if (detailNormalTextureID != ovrAvatarPBSMaterialState2.detailNormalTextureID)
		{
			return false;
		}
		return true;
	}

	public override int GetHashCode()
	{
		return baseColor.GetHashCode() ^ albedoTextureID.GetHashCode() ^ albedoMultiplier.GetHashCode() ^ metallicnessTextureID.GetHashCode() ^ glossinessScale.GetHashCode() ^ normalTextureID.GetHashCode() ^ heightTextureID.GetHashCode() ^ occlusionTextureID.GetHashCode() ^ emissionTextureID.GetHashCode() ^ emissionMultiplier.GetHashCode() ^ detailMaskTextureID.GetHashCode() ^ detailAlbedoTextureID.GetHashCode() ^ detailNormalTextureID.GetHashCode();
	}
}
public class OvrAvatarAssetMaterial : OvrAvatarAsset
{
	public ovrAvatarMaterialState material;

	public OvrAvatarAssetMaterial(ulong id, IntPtr mat)
	{
		assetID = id;
		material = Oculus.Avatar.CAPI.ovrAvatarAsset_GetMaterialState(mat);
	}
}
public struct ovrAvatarSkinnedMeshPose
{
	public uint jointCount;

	[MarshalAs(UnmanagedType.ByValArray, SizeConst = 64)]
	public ovrAvatarTransform[] jointTransform;

	[MarshalAs(UnmanagedType.ByValArray, SizeConst = 64)]
	public int[] jointParents;

	[MarshalAs(UnmanagedType.ByValArray, SizeConst = 64)]
	public IntPtr[] jointNames;
}
[Flags]
public enum ovrAvatarVisibilityFlags
{
	FirstPerson = 1,
	ThirdPerson = 2,
	SelfOccluding = 4
}
public struct ovrAvatarRenderPart_SkinnedMeshRender
{
	public ovrAvatarTransform localTransform;

	public ovrAvatarVisibilityFlags visibilityMask;

	public ulong meshAssetID;

	public ovrAvatarMaterialState materialState;

	public ovrAvatarSkinnedMeshPose skinnedPose;
}
public struct ovrAvatarRenderPart_SkinnedMeshRenderPBS
{
	public ovrAvatarTransform localTransform;

	public ovrAvatarVisibilityFlags visibilityMask;

	public ulong meshAssetID;

	public ulong albedoTextureAssetID;

	public ulong surfaceTextureAssetID;

	public ovrAvatarSkinnedMeshPose skinnedPose;
}
public struct ovrAvatarRenderPart_ProjectorRender
{
	public ovrAvatarTransform localTransform;

	public uint componentIndex;

	public uint renderPartIndex;

	public ovrAvatarMaterialState materialState;
}
public struct ovrAvatarRenderPart_SkinnedMeshRenderPBS_V2
{
	public ovrAvatarTransform localTransform;

	public ovrAvatarVisibilityFlags visibilityMask;

	public ulong meshAssetID;

	public ovrAvatarPBSMaterialState materialState;

	public ovrAvatarSkinnedMeshPose skinnedPose;
}
public enum ovrAvatarHandGesture
{
	Default,
	GripSphere,
	GripCube,
	Count
}
public enum ovrAvatarBodyPartType
{
	Body,
	Clothing,
	Eyewear,
	Hair,
	Beard,
	Count
}
public struct ovrAvatarBlendShapeParams
{
	public uint blendShapeParamCount;

	[MarshalAs(UnmanagedType.ByValArray, SizeConst = 64)]
	public float[] blendShapeParams;
}
[StructLayout(LayoutKind.Sequential, Size = 1)]
internal struct ovrAvatarBlendShapeParams_Offsets
{
	public static int blendShapeParamCount = Marshal.OffsetOf(typeof(ovrAvatarBlendShapeParams), "blendShapeParamCount").ToInt32();

	public static long blendShapeParams = Marshal.SizeOf(typeof(uint));
}
public struct ovrAvatarVisemes
{
	public uint visemeParamCount;

	[MarshalAs(UnmanagedType.ByValArray, SizeConst = 32)]
	public float[] visemeParams;
}
[StructLayout(LayoutKind.Sequential, Size = 1)]
internal struct ovrAvatarVisemes_Offsets
{
	public static int visemeParamCount = Marshal.OffsetOf(typeof(ovrAvatarVisemes), "visemeParamCount").ToInt32();

	public static long visemeParams = Marshal.SizeOf(typeof(uint));
}
public enum ovrAvatarGazeTargetType
{
	AvatarHead,
	AvatarHand,
	Object,
	ObjectStatic,
	Count
}
public struct ovrAvatarGazeTarget
{
	public uint id;

	public Vector3 worldPosition;

	public ovrAvatarGazeTargetType type;
}
[StructLayout(LayoutKind.Sequential, Size = 1)]
internal struct ovrAvatarGazeTarget_Offsets
{
	public static int id = Marshal.OffsetOf(typeof(ovrAvatarGazeTarget), "id").ToInt32();

	public static long worldPosition = Marshal.OffsetOf(typeof(ovrAvatarGazeTarget), "worldPosition").ToInt64();

	public static long type = Marshal.OffsetOf(typeof(ovrAvatarGazeTarget), "type").ToInt32();
}
public struct ovrAvatarGazeTargets
{
	public uint targetCount;

	[MarshalAs(UnmanagedType.ByValArray, SizeConst = 128)]
	public ovrAvatarGazeTarget[] targets;
}
[StructLayout(LayoutKind.Sequential, Size = 1)]
internal struct ovrAvatarGazeTargets_Offsets
{
	public static int targetCount = Marshal.OffsetOf(typeof(ovrAvatarGazeTargets), "targetCount").ToInt32();

	public static long targets = Marshal.OffsetOf(typeof(ovrAvatarGazeTargets), "targets").ToInt64();
}
public enum ovrAvatarLightType
{
	Point,
	Direction,
	Spot,
	Count
}
public struct ovrAvatarLight
{
	public uint id;

	public ovrAvatarLightType type;

	public float intensity;

	public Vector3 worldDirection;

	public Vector3 worldPosition;

	public float range;

	public float spotAngleDeg;
}
[StructLayout(LayoutKind.Sequential, Size = 1)]
internal struct ovrAvatarLight_Offsets
{
	public static long id = Marshal.OffsetOf(typeof(ovrAvatarLight), "id").ToInt64();

	public static long type = Marshal.OffsetOf(typeof(ovrAvatarLight), "type").ToInt64();

	public static long intensity = Marshal.OffsetOf(typeof(ovrAvatarLight), "intensity").ToInt64();

	public static long worldDirection = Marshal.OffsetOf(typeof(ovrAvatarLight), "worldDirection").ToInt64();

	public static long worldPosition = Marshal.OffsetOf(typeof(ovrAvatarLight), "worldPosition").ToInt64();

	public static long range = Marshal.OffsetOf(typeof(ovrAvatarLight), "range").ToInt64();

	public static long spotAngleDeg = Marshal.OffsetOf(typeof(ovrAvatarLight), "spotAngleDeg").ToInt64();
}
public struct ovrAvatarLights
{
	public float ambientIntensity;

	public uint lightCount;

	[MarshalAs(UnmanagedType.ByValArray, SizeConst = 16)]
	public ovrAvatarLight[] lights;
}
[StructLayout(LayoutKind.Sequential, Size = 1)]
internal struct ovrAvatarLights_Offsets
{
	public static long ambientIntensity = Marshal.OffsetOf(typeof(ovrAvatarLights), "ambientIntensity").ToInt64();

	public static long lightCount = Marshal.OffsetOf(typeof(ovrAvatarLights), "lightCount").ToInt64();

	public static long lights = Marshal.OffsetOf(typeof(ovrAvatarLights), "lights").ToInt64();
}
[Flags]
public enum ovrAvatarDebugContext : uint
{
	None = 0u,
	GazeTarget = 1u,
	Any = uint.MaxValue
}
public struct ovrAvatarDebugLine
{
	public Vector3 startPoint;

	public Vector3 endPoint;

	public Vector3 color;

	public ovrAvatarDebugContext context;

	public IntPtr text;
}
public struct ovrAvatarDebugTransform
{
	public ovrAvatarTransform transform;

	public ovrAvatarDebugContext context;

	public IntPtr text;
}
public delegate void specificationCallback(IntPtr specification);
public delegate void assetLoadedCallback(OvrAvatarAsset asset);
public delegate void combinedMeshLoadedCallback(IntPtr asset);
public class OvrAvatarSDKManager : MonoBehaviour
{
	public struct AvatarSpecRequestParams
	{
		public ulong _userId;

		public specificationCallback _callback;

		public bool _useCombinedMesh;

		public ovrAvatarAssetLevelOfDetail _lod;

		public bool _forceMobileTextureFormat;

		public ovrAvatarLookAndFeelVersion _lookVersion;

		public ovrAvatarLookAndFeelVersion _fallbackVersion;

		public bool _enableExpressive;

		public AvatarSpecRequestParams(ulong userId, specificationCallback callback, bool useCombinedMesh, ovrAvatarAssetLevelOfDetail lod, bool forceMobileTextureFormat, ovrAvatarLookAndFeelVersion lookVersion, ovrAvatarLookAndFeelVersion fallbackVersion, bool enableExpressive)
		{
			_userId = userId;
			_callback = callback;
			_useCombinedMesh = useCombinedMesh;
			_lod = lod;
			_forceMobileTextureFormat = forceMobileTextureFormat;
			_lookVersion = lookVersion;
			_fallbackVersion = fallbackVersion;
			_enableExpressive = enableExpressive;
		}
	}

	private static OvrAvatarSDKManager _instance;

	private bool initialized;

	private Dictionary<ulong, HashSet<specificationCallback>> specificationCallbacks;

	private Dictionary<ulong, HashSet<assetLoadedCallback>> assetLoadedCallbacks;

	private Dictionary<IntPtr, combinedMeshLoadedCallback> combinedMeshLoadedCallbacks;

	private Dictionary<ulong, OvrAvatarAsset> assetCache;

	private OvrAvatarTextureCopyManager textureCopyManager;

	public ovrAvatarLogLevel LoggingLevel = ovrAvatarLogLevel.Info;

	private Queue<AvatarSpecRequestParams> avatarSpecificationQueue;

	private List<int> loadingAvatars;

	private bool avatarSpecRequestAvailable = true;

	private float lastDispatchedAvatarSpecRequestTime;

	private const float AVATAR_SPEC_REQUEST_TIMEOUT = 5f;

	private ovrAvatarDebugContext debugContext;

	public static OvrAvatarSDKManager Instance
	{
		get
		{
			if (_instance == null)
			{
				_instance = UnityEngine.Object.FindObjectOfType<OvrAvatarSDKManager>();
				if (_instance == null)
				{
					GameObject gameObject = new GameObject("OvrAvatarSDKManager");
					_instance = gameObject.AddComponent<OvrAvatarSDKManager>();
					_instance.textureCopyManager = gameObject.AddComponent<OvrAvatarTextureCopyManager>();
					_instance.initialized = _instance.Initialize();
				}
			}
			if (!_instance.initialized)
			{
				return null;
			}
			return _instance;
		}
	}

	private bool Initialize()
	{
		Oculus.Avatar.CAPI.Initialize();
		string appId = GetAppId();
		if (appId == "")
		{
			appId = "0";
			return false;
		}
		Oculus.Avatar.CAPI.ovrAvatar_InitializeAndroidUnity(appId);
		specificationCallbacks = new Dictionary<ulong, HashSet<specificationCallback>>();
		assetLoadedCallbacks = new Dictionary<ulong, HashSet<assetLoadedCallback>>();
		combinedMeshLoadedCallbacks = new Dictionary<IntPtr, combinedMeshLoadedCallback>();
		assetCache = new Dictionary<ulong, OvrAvatarAsset>();
		avatarSpecificationQueue = new Queue<AvatarSpecRequestParams>();
		loadingAvatars = new List<int>();
		Oculus.Avatar.CAPI.ovrAvatar_SetLoggingLevel(LoggingLevel);
		Oculus.Avatar.CAPI.ovrAvatar_RegisterLoggingCallback(Oculus.Avatar.CAPI.LoggingCallback);
		return true;
	}

	private void OnDestroy()
	{
		Oculus.Avatar.CAPI.Shutdown();
		Oculus.Avatar.CAPI.ovrAvatar_RegisterLoggingCallback(null);
		Oculus.Avatar.CAPI.ovrAvatar_Shutdown();
	}

	private void Update()
	{
		if (Instance == null)
		{
			return;
		}
		if (avatarSpecificationQueue.Count > 0 && (avatarSpecRequestAvailable || Time.time - lastDispatchedAvatarSpecRequestTime >= 5f))
		{
			avatarSpecRequestAvailable = false;
			AvatarSpecRequestParams avatarSpecRequest = avatarSpecificationQueue.Dequeue();
			DispatchAvatarSpecificationRequest(avatarSpecRequest);
			lastDispatchedAvatarSpecRequestTime = Time.time;
		}
		IntPtr intPtr = Oculus.Avatar.CAPI.ovrAvatarMessage_Pop();
		if (intPtr == IntPtr.Zero)
		{
			return;
		}
		ovrAvatarMessageType ovrAvatarMessageType2 = Oculus.Avatar.CAPI.ovrAvatarMessage_GetType(intPtr);
		switch (ovrAvatarMessageType2)
		{
		case ovrAvatarMessageType.AssetLoaded:
		{
			ovrAvatarMessage_AssetLoaded ovrAvatarMessage_AssetLoaded2 = Oculus.Avatar.CAPI.ovrAvatarMessage_GetAssetLoaded(intPtr);
			IntPtr asset = ovrAvatarMessage_AssetLoaded2.asset;
			ulong assetID = ovrAvatarMessage_AssetLoaded2.assetID;
			ovrAvatarAssetType ovrAvatarAssetType2 = Oculus.Avatar.CAPI.ovrAvatarAsset_GetType(asset);
			OvrAvatarAsset ovrAvatarAsset = null;
			IntPtr key = IntPtr.Zero;
			switch (ovrAvatarAssetType2)
			{
			case ovrAvatarAssetType.Mesh:
				ovrAvatarAsset = new OvrAvatarAssetMesh(assetID, asset, ovrAvatarAssetType.Mesh);
				break;
			case ovrAvatarAssetType.Texture:
				ovrAvatarAsset = new OvrAvatarAssetTexture(assetID, asset);
				break;
			case ovrAvatarAssetType.Material:
				ovrAvatarAsset = new OvrAvatarAssetMaterial(assetID, asset);
				break;
			case ovrAvatarAssetType.CombinedMesh:
				key = Oculus.Avatar.CAPI.ovrAvatarAsset_GetAvatar(asset);
				ovrAvatarAsset = new OvrAvatarAssetMesh(assetID, asset, ovrAvatarAssetType.CombinedMesh);
				break;
			default:
				throw new NotImplementedException($"Unsupported asset type format {ovrAvatarAssetType2.ToString()}");
			case ovrAvatarAssetType.FailedLoad:
				break;
			}
			if (ovrAvatarAssetType2 == ovrAvatarAssetType.CombinedMesh)
			{
				if (!assetCache.ContainsKey(assetID))
				{
					assetCache.Add(assetID, ovrAvatarAsset);
				}
				if (combinedMeshLoadedCallbacks.TryGetValue(key, out var value2))
				{
					value2(asset);
					combinedMeshLoadedCallbacks.Remove(key);
				}
			}
			else
			{
				if (ovrAvatarAsset == null || !assetLoadedCallbacks.TryGetValue(ovrAvatarMessage_AssetLoaded2.assetID, out var value3))
				{
					break;
				}
				assetCache.Add(assetID, ovrAvatarAsset);
				foreach (assetLoadedCallback item in value3)
				{
					item(ovrAvatarAsset);
				}
				assetLoadedCallbacks.Remove(ovrAvatarMessage_AssetLoaded2.assetID);
			}
			break;
		}
		case ovrAvatarMessageType.AvatarSpecification:
		{
			avatarSpecRequestAvailable = true;
			ovrAvatarMessage_AvatarSpecification ovrAvatarMessage_AvatarSpecification2 = Oculus.Avatar.CAPI.ovrAvatarMessage_GetAvatarSpecification(intPtr);
			if (!specificationCallbacks.TryGetValue(ovrAvatarMessage_AvatarSpecification2.oculusUserID, out var value))
			{
				break;
			}
			foreach (specificationCallback item2 in value)
			{
				item2(ovrAvatarMessage_AvatarSpecification2.avatarSpec);
			}
			specificationCallbacks.Remove(ovrAvatarMessage_AvatarSpecification2.oculusUserID);
			break;
		}
		default:
			throw new NotImplementedException("Unhandled ovrAvatarMessageType: " + ovrAvatarMessageType2);
		}
		Oculus.Avatar.CAPI.ovrAvatarMessage_Free(intPtr);
	}

	public bool IsAvatarSpecWaiting()
	{
		return avatarSpecificationQueue.Count > 0;
	}

	public bool IsAvatarLoading()
	{
		return loadingAvatars.Count > 0;
	}

	public void AddLoadingAvatar(int gameobjectID)
	{
		loadingAvatars.Add(gameobjectID);
	}

	public void RemoveLoadingAvatar(int gameobjectID)
	{
		loadingAvatars.Remove(gameobjectID);
	}

	public void RequestAvatarSpecification(AvatarSpecRequestParams avatarSpecRequest)
	{
		avatarSpecificationQueue.Enqueue(avatarSpecRequest);
	}

	private void DispatchAvatarSpecificationRequest(AvatarSpecRequestParams avatarSpecRequest)
	{
		textureCopyManager.CheckFallbackTextureSet(avatarSpecRequest._lod);
		Oculus.Avatar.CAPI.ovrAvatar_SetForceASTCTextures(avatarSpecRequest._forceMobileTextureFormat);
		if (!specificationCallbacks.TryGetValue(avatarSpecRequest._userId, out var value))
		{
			value = new HashSet<specificationCallback>();
			specificationCallbacks.Add(avatarSpecRequest._userId, value);
			IntPtr specificationRequest = Oculus.Avatar.CAPI.ovrAvatarSpecificationRequest_Create(avatarSpecRequest._userId);
			Oculus.Avatar.CAPI.ovrAvatarSpecificationRequest_SetLookAndFeelVersion(specificationRequest, avatarSpecRequest._lookVersion);
			Oculus.Avatar.CAPI.ovrAvatarSpecificationRequest_SetFallbackLookAndFeelVersion(specificationRequest, avatarSpecRequest._fallbackVersion);
			Oculus.Avatar.CAPI.ovrAvatarSpecificationRequest_SetLevelOfDetail(specificationRequest, avatarSpecRequest._lod);
			Oculus.Avatar.CAPI.ovrAvatarSpecificationRequest_SetCombineMeshes(specificationRequest, avatarSpecRequest._useCombinedMesh);
			Oculus.Avatar.CAPI.ovrAvatarSpecificationRequest_SetExpressiveFlag(specificationRequest, avatarSpecRequest._enableExpressive);
			Oculus.Avatar.CAPI.ovrAvatar_RequestAvatarSpecificationFromSpecRequest(specificationRequest);
			Oculus.Avatar.CAPI.ovrAvatarSpecificationRequest_Destroy(specificationRequest);
		}
		value.Add(avatarSpecRequest._callback);
	}

	public void BeginLoadingAsset(ulong assetId, ovrAvatarAssetLevelOfDetail lod, assetLoadedCallback callback)
	{
		if (!assetLoadedCallbacks.TryGetValue(assetId, out var value))
		{
			value = new HashSet<assetLoadedCallback>();
			assetLoadedCallbacks.Add(assetId, value);
		}
		Oculus.Avatar.CAPI.ovrAvatarAsset_BeginLoadingLOD(assetId, lod);
		value.Add(callback);
	}

	public void RegisterCombinedMeshCallback(IntPtr sdkAvatar, combinedMeshLoadedCallback callback)
	{
		if (!combinedMeshLoadedCallbacks.TryGetValue(sdkAvatar, out var _))
		{
			combinedMeshLoadedCallbacks.Add(sdkAvatar, callback);
			return;
		}
		throw new Exception("Adding second combind mesh callback for same avatar");
	}

	public OvrAvatarAsset GetAsset(ulong assetId)
	{
		if (assetCache.TryGetValue(assetId, out var value))
		{
			return value;
		}
		return null;
	}

	public void DeleteAssetFromCache(ulong assetId)
	{
		if (assetCache.ContainsKey(assetId))
		{
			assetCache.Remove(assetId);
		}
	}

	public string GetAppId()
	{
		if (UnityEngine.Application.platform != RuntimePlatform.Android)
		{
			return OvrAvatarSettings.AppID;
		}
		return OvrAvatarSettings.MobileAppID;
	}

	public OvrAvatarTextureCopyManager GetTextureCopyManager()
	{
		if (textureCopyManager != null)
		{
			return textureCopyManager;
		}
		return null;
	}
}
public sealed class OvrAvatarSettings : ScriptableObject
{
	private static OvrAvatarSettings instance;

	[SerializeField]
	private string ovrAppID = "";

	[SerializeField]
	private string ovrGearAppID = "";

	public static string AppID
	{
		get
		{
			return Instance.ovrAppID;
		}
		set
		{
			Instance.ovrAppID = value;
		}
	}

	public static string MobileAppID
	{
		get
		{
			return Instance.ovrGearAppID;
		}
		set
		{
			Instance.ovrGearAppID = value;
		}
	}

	public static OvrAvatarSettings Instance
	{
		get
		{
			if (instance == null)
			{
				instance = Resources.Load<OvrAvatarSettings>("OvrAvatarSettings");
				if (instance == null)
				{
					instance = ScriptableObject.CreateInstance<OvrAvatarSettings>();
				}
			}
			return instance;
		}
		set
		{
			instance = value;
		}
	}
}
public class OvrAvatarSkinnedMeshRenderComponent : OvrAvatarRenderComponent
{
	private Shader surface;

	private Shader surfaceSelfOccluding;

	private bool previouslyActive;

	internal void Initialize(ovrAvatarRenderPart_SkinnedMeshRender skinnedMeshRender, Shader surface, Shader surfaceSelfOccluding, int thirdPersonLayer, int firstPersonLayer)
	{
		this.surfaceSelfOccluding = ((surfaceSelfOccluding != null) ? surfaceSelfOccluding : Shader.Find("OvrAvatar/AvatarSurfaceShaderSelfOccluding"));
		this.surface = ((surface != null) ? surface : Shader.Find("OvrAvatar/AvatarSurfaceShader"));
		mesh = CreateSkinnedMesh(skinnedMeshRender.meshAssetID, skinnedMeshRender.visibilityMask, thirdPersonLayer, firstPersonLayer);
		bones = mesh.bones;
		UpdateMeshMaterial(skinnedMeshRender.visibilityMask, mesh);
	}

	public void UpdateSkinnedMeshRender(OvrAvatarComponent component, OvrAvatar avatar, IntPtr renderPart)
	{
		ovrAvatarVisibilityFlags visibilityMask = Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRender_GetVisibilityMask(renderPart);
		ovrAvatarTransform localTransform = Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRender_GetTransform(renderPart);
		UpdateSkinnedMesh(avatar, bones, localTransform, visibilityMask, renderPart);
		UpdateMeshMaterial(visibilityMask, mesh);
		bool activeSelf = base.gameObject.activeSelf;
		if (mesh != null && (Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRender_MaterialStateChanged(renderPart) || (!previouslyActive && activeSelf)))
		{
			ovrAvatarMaterialState matState = Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRender_GetMaterialState(renderPart);
			component.UpdateAvatarMaterial(mesh.sharedMaterial, matState);
		}
		previouslyActive = activeSelf;
	}

	private void UpdateMeshMaterial(ovrAvatarVisibilityFlags visibilityMask, SkinnedMeshRenderer rootMesh)
	{
		Shader shader = (((visibilityMask & ovrAvatarVisibilityFlags.SelfOccluding) != 0) ? surfaceSelfOccluding : surface);
		if (rootMesh.sharedMaterial == null || rootMesh.sharedMaterial.shader != shader)
		{
			rootMesh.sharedMaterial = CreateAvatarMaterial(base.gameObject.name + "_material", shader);
		}
	}
}
public class OvrAvatarSkinnedMeshRenderPBSComponent : OvrAvatarRenderComponent
{
	private bool isMaterialInitilized;

	internal void Initialize(ovrAvatarRenderPart_SkinnedMeshRenderPBS skinnedMeshRenderPBS, Shader shader, int thirdPersonLayer, int firstPersonLayer)
	{
		if (shader == null)
		{
			shader = Shader.Find("OvrAvatar/AvatarSurfaceShaderPBS");
		}
		mesh = CreateSkinnedMesh(skinnedMeshRenderPBS.meshAssetID, skinnedMeshRenderPBS.visibilityMask, thirdPersonLayer, firstPersonLayer);
		mesh.sharedMaterial = CreateAvatarMaterial(base.gameObject.name + "_material", shader);
		bones = mesh.bones;
	}

	internal void UpdateSkinnedMeshRenderPBS(OvrAvatar avatar, IntPtr renderPart, Material mat)
	{
		if (!isMaterialInitilized)
		{
			isMaterialInitilized = true;
			ulong assetId = Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRenderPBS_GetAlbedoTextureAssetID(renderPart);
			ulong assetId2 = Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRenderPBS_GetSurfaceTextureAssetID(renderPart);
			mat.SetTexture("_Albedo", OvrAvatarComponent.GetLoadedTexture(assetId));
			mat.SetTexture("_Surface", OvrAvatarComponent.GetLoadedTexture(assetId2));
		}
		ovrAvatarVisibilityFlags visibilityMask = Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRenderPBS_GetVisibilityMask(renderPart);
		ovrAvatarTransform localTransform = Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRenderPBS_GetTransform(renderPart);
		UpdateSkinnedMesh(avatar, bones, localTransform, visibilityMask, renderPart);
	}
}
public class OvrAvatarSkinnedMeshPBSV2RenderComponent : OvrAvatarRenderComponent
{
	private OvrAvatarMaterialManager avatarMaterialManager;

	private bool previouslyActive;

	private bool isCombinedMaterial;

	private ovrAvatarExpressiveParameters ExpressiveParameters;

	private bool EnableExpressive;

	private int blendShapeCount;

	private ovrAvatarBlendShapeParams blendShapeParams;

	private const string MAIN_MATERIAL_NAME = "main_material";

	private const string EYE_MATERIAL_NAME = "eye_material";

	private const string DEFAULT_MATERIAL_NAME = "_material";

	internal void Initialize(IntPtr renderPart, ovrAvatarRenderPart_SkinnedMeshRenderPBS_V2 skinnedMeshRender, OvrAvatarMaterialManager materialManager, int thirdPersonLayer, int firstPersonLayer, bool combinedMesh, ovrAvatarAssetLevelOfDetail lod, bool assignExpressiveParams, OvrAvatar avatar, bool isControllerModel)
	{
		avatarMaterialManager = materialManager;
		isCombinedMaterial = combinedMesh;
		mesh = CreateSkinnedMesh(skinnedMeshRender.meshAssetID, skinnedMeshRender.visibilityMask, thirdPersonLayer, firstPersonLayer);
		EnableExpressive = assignExpressiveParams;
		Shader shader = (EnableExpressive ? avatar.Skinshaded_Expressive_VertFrag_SingleComponent : avatar.Skinshaded_VertFrag_SingleComponent);
		Shader shader2 = (EnableExpressive ? avatar.Skinshaded_Expressive_VertFrag_CombinedMesh : avatar.Skinshaded_VertFrag_CombinedMesh);
		Shader shader3 = (isCombinedMaterial ? shader2 : shader);
		if (isControllerModel)
		{
			shader3 = avatar.ControllerShader;
		}
		if (EnableExpressive)
		{
			ExpressiveParameters = Oculus.Avatar.CAPI.ovrAvatar_GetExpressiveParameters(avatar.sdkAvatar);
			Shader eyeLens = avatar.EyeLens;
			Material[] array = new Material[2]
			{
				CreateAvatarMaterial(base.gameObject.name + "main_material", shader3),
				CreateAvatarMaterial(base.gameObject.name + "eye_material", eyeLens)
			};
			if (avatar.UseTransparentRenderQueue)
			{
				SetMaterialTransparent(array[0]);
			}
			else
			{
				SetMaterialOpaque(array[0]);
			}
			array[1].renderQueue = -1;
			mesh.materials = array;
		}
		else
		{
			mesh.sharedMaterial = CreateAvatarMaterial(base.gameObject.name + "_material", shader3);
			if (avatar.UseTransparentRenderQueue && !isControllerModel)
			{
				SetMaterialTransparent(mesh.sharedMaterial);
			}
			else
			{
				SetMaterialOpaque(mesh.sharedMaterial);
			}
		}
		bones = mesh.bones;
		if (isCombinedMaterial)
		{
			avatarMaterialManager.SetRenderer(mesh);
			InitializeCombinedMaterial(renderPart, (int)lod);
			avatarMaterialManager.OnCombinedMeshReady();
		}
		blendShapeParams = default(ovrAvatarBlendShapeParams);
		blendShapeParams.blendShapeParamCount = 0u;
		blendShapeParams.blendShapeParams = new float[64];
		blendShapeCount = mesh.sharedMesh.blendShapeCount;
	}

	public void UpdateSkinnedMeshRender(OvrAvatarComponent component, OvrAvatar avatar, IntPtr renderPart)
	{
		ovrAvatarVisibilityFlags visibilityMask = Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRenderPBSV2_GetVisibilityMask(renderPart);
		ovrAvatarTransform localTransform = Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRenderPBSV2_GetTransform(renderPart);
		UpdateSkinnedMesh(avatar, bones, localTransform, visibilityMask, renderPart);
		bool activeSelf = base.gameObject.activeSelf;
		if (mesh != null && !previouslyActive && activeSelf && !isCombinedMaterial)
		{
			InitializeSingleComponentMaterial(renderPart, (int)(avatar.LevelOfDetail - 1));
		}
		if (blendShapeCount > 0)
		{
			Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRender_GetBlendShapeParams(renderPart, ref blendShapeParams);
			for (uint num = 0u; num < blendShapeParams.blendShapeParamCount && num < blendShapeCount; num++)
			{
				float num2 = blendShapeParams.blendShapeParams[num];
				mesh.SetBlendShapeWeight((int)num, num2 * 100f);
			}
		}
		previouslyActive = activeSelf;
	}

	private void InitializeSingleComponentMaterial(IntPtr renderPart, int lodIndex)
	{
		ovrAvatarPBSMaterialState ovrAvatarPBSMaterialState2 = Oculus.Avatar.CAPI.ovrAvatarSkinnedMeshRenderPBSV2_GetPBSMaterialState(renderPart);
		int componentType = (int)OvrAvatarMaterialManager.GetComponentType(base.gameObject.name);
		Texture2D texture2D = OvrAvatarComponent.GetLoadedTexture(ovrAvatarPBSMaterialState2.albedoTextureID);
		Texture2D texture2D2 = OvrAvatarComponent.GetLoadedTexture(ovrAvatarPBSMaterialState2.normalTextureID);
		Texture2D texture2D3 = OvrAvatarComponent.GetLoadedTexture(ovrAvatarPBSMaterialState2.metallicnessTextureID);
		if (texture2D != null)
		{
			avatarMaterialManager.AddTextureIDToTextureManager(ovrAvatarPBSMaterialState2.albedoTextureID, isSingleComponent: true);
		}
		else
		{
			texture2D = OvrAvatarSDKManager.Instance.GetTextureCopyManager().FallbackTextureSets[lodIndex].DiffuseRoughness;
		}
		texture2D.anisoLevel = 4;
		if (texture2D2 != null)
		{
			avatarMaterialManager.AddTextureIDToTextureManager(ovrAvatarPBSMaterialState2.normalTextureID, isSingleComponent: true);
		}
		else
		{
			texture2D2 = OvrAvatarSDKManager.Instance.GetTextureCopyManager().FallbackTextureSets[lodIndex].Normal;
		}
		texture2D2.anisoLevel = 4;
		if (texture2D3 != null)
		{
			avatarMaterialManager.AddTextureIDToTextureManager(ovrAvatarPBSMaterialState2.metallicnessTextureID, isSingleComponent: true);
		}
		else
		{
			texture2D3 = OvrAvatarSDKManager.Instance.GetTextureCopyManager().FallbackTextureSets[lodIndex].DiffuseRoughness;
		}
		texture2D3.anisoLevel = 16;
		mesh.materials[0].SetTexture(OvrAvatarMaterialManager.AVATAR_SHADER_MAINTEX, texture2D);
		mesh.materials[0].SetTexture(OvrAvatarMaterialManager.AVATAR_SHADER_NORMALMAP, texture2D2);
		mesh.materials[0].SetTexture(OvrAvatarMaterialManager.AVATAR_SHADER_ROUGHNESSMAP, texture2D3);
		mesh.materials[0].SetVector(OvrAvatarMaterialManager.AVATAR_SHADER_COLOR, ovrAvatarPBSMaterialState2.albedoMultiplier);
		mesh.materials[0].SetFloat(OvrAvatarMaterialManager.AVATAR_SHADER_DIFFUSEINTENSITY, OvrAvatarMaterialManager.DiffuseIntensities[componentType]);
		mesh.materials[0].SetFloat(OvrAvatarMaterialManager.AVATAR_SHADER_RIMINTENSITY, OvrAvatarMaterialManager.RimIntensities[componentType]);
		mesh.materials[0].SetFloat(OvrAvatarMaterialManager.AVATAR_SHADER_REFLECTIONINTENSITY, OvrAvatarMaterialManager.ReflectionIntensities[componentType]);
		mesh.GetClosestReflectionProbes(avatarMaterialManager.ReflectionProbes);
		if (avatarMaterialManager.ReflectionProbes != null && avatarMaterialManager.ReflectionProbes.Count > 0)
		{
			mesh.materials[0].SetTexture(OvrAvatarMaterialManager.AVATAR_SHADER_CUBEMAP, avatarMaterialManager.ReflectionProbes[0].probe.texture);
		}
		if (EnableExpressive)
		{
			mesh.materials[0].SetVector(OvrAvatarMaterialManager.AVATAR_SHADER_IRIS_COLOR, ExpressiveParameters.irisColor);
			mesh.materials[0].SetVector(OvrAvatarMaterialManager.AVATAR_SHADER_LIP_COLOR, ExpressiveParameters.lipColor);
			mesh.materials[0].SetVector(OvrAvatarMaterialManager.AVATAR_SHADER_BROW_COLOR, ExpressiveParameters.browColor);
			mesh.materials[0].SetVector(OvrAvatarMaterialManager.AVATAR_SHADER_LASH_COLOR, ExpressiveParameters.lashColor);
			mesh.materials[0].SetVector(OvrAvatarMaterialManager.AVATAR_SHADER_SCLERA_COLOR, ExpressiveParameters.scleraColor);
			mesh.materials[0].SetVector(OvrAvatarMaterialManager.AVATAR_SHADER_GUM_COLOR, ExpressiveParameters.gumColor);
			mesh.materials[0].SetVector(OvrAvatarMaterialManager.AVATAR_SHADER_TEETH_COLOR, ExpressiveParameters.teethColor);
			mesh.materials[0].SetFloat(OvrAvatarMaterialManager.AVATAR_SHADER_LIP_SMOOTHNESS, ExpressiveParameters.lipSmoothness);
		}
	}

	private void InitializeCombinedMaterial(IntPtr renderPart, int lodIndex)
	{
		ovrAvatarPBSMaterialState[] array = Oculus.Avatar.CAPI.ovrAvatar_GetBodyPBSMaterialStates(renderPart);
		if (array.Length != 5)
		{
			return;
		}
		avatarMaterialManager.CreateTextureArrays();
		OvrAvatarMaterialManager.AvatarComponentMaterialProperties[] componentMaterialProperties = avatarMaterialManager.LocalAvatarConfig.ComponentMaterialProperties;
		for (int i = 0; i < array.Length; i++)
		{
			componentMaterialProperties[i].TypeIndex = (ovrAvatarBodyPartType)i;
			componentMaterialProperties[i].Color = array[i].albedoMultiplier;
			componentMaterialProperties[i].DiffuseIntensity = OvrAvatarMaterialManager.DiffuseIntensities[i];
			componentMaterialProperties[i].RimIntensity = OvrAvatarMaterialManager.RimIntensities[i];
			componentMaterialProperties[i].ReflectionIntensity = OvrAvatarMaterialManager.ReflectionIntensities[i];
			Texture2D loadedTexture = OvrAvatarComponent.GetLoadedTexture(array[i].albedoTextureID);
			Texture2D loadedTexture2 = OvrAvatarComponent.GetLoadedTexture(array[i].normalTextureID);
			Texture2D loadedTexture3 = OvrAvatarComponent.GetLoadedTexture(array[i].metallicnessTextureID);
			if (loadedTexture != null)
			{
				componentMaterialProperties[i].Textures[0] = loadedTexture;
				avatarMaterialManager.AddTextureIDToTextureManager(array[i].albedoTextureID, isSingleComponent: false);
			}
			else
			{
				componentMaterialProperties[i].Textures[0] = OvrAvatarSDKManager.Instance.GetTextureCopyManager().FallbackTextureSets[lodIndex].DiffuseRoughness;
			}
			componentMaterialProperties[i].Textures[0].anisoLevel = 4;
			if (loadedTexture2 != null)
			{
				componentMaterialProperties[i].Textures[1] = loadedTexture2;
				avatarMaterialManager.AddTextureIDToTextureManager(array[i].normalTextureID, isSingleComponent: false);
			}
			else
			{
				componentMaterialProperties[i].Textures[1] = OvrAvatarSDKManager.Instance.GetTextureCopyManager().FallbackTextureSets[lodIndex].Normal;
			}
			componentMaterialProperties[i].Textures[1].anisoLevel = 4;
			if (loadedTexture3 != null)
			{
				componentMaterialProperties[i].Textures[2] = loadedTexture3;
				avatarMaterialManager.AddTextureIDToTextureManager(array[i].metallicnessTextureID, isSingleComponent: false);
			}
			else
			{
				componentMaterialProperties[i].Textures[2] = OvrAvatarSDKManager.Instance.GetTextureCopyManager().FallbackTextureSets[lodIndex].DiffuseRoughness;
			}
			componentMaterialProperties[i].Textures[2].anisoLevel = 16;
		}
		if (EnableExpressive)
		{
			mesh.materials[0].SetVector(OvrAvatarMaterialManager.AVATAR_SHADER_IRIS_COLOR, ExpressiveParameters.irisColor);
			mesh.materials[0].SetVector(OvrAvatarMaterialManager.AVATAR_SHADER_LIP_COLOR, ExpressiveParameters.lipColor);
			mesh.materials[0].SetVector(OvrAvatarMaterialManager.AVATAR_SHADER_BROW_COLOR, ExpressiveParameters.browColor);
			mesh.materials[0].SetVector(OvrAvatarMaterialManager.AVATAR_SHADER_LASH_COLOR, ExpressiveParameters.lashColor);
			mesh.materials[0].SetVector(OvrAvatarMaterialManager.AVATAR_SHADER_SCLERA_COLOR, ExpressiveParameters.scleraColor);
			mesh.materials[0].SetVector(OvrAvatarMaterialManager.AVATAR_SHADER_GUM_COLOR, ExpressiveParameters.gumColor);
			mesh.materials[0].SetVector(OvrAvatarMaterialManager.AVATAR_SHADER_TEETH_COLOR, ExpressiveParameters.teethColor);
			mesh.materials[0].SetFloat(OvrAvatarMaterialManager.AVATAR_SHADER_LIP_SMOOTHNESS, ExpressiveParameters.lipSmoothness);
		}
		avatarMaterialManager.ValidateTextures(array);
	}

	private void SetMaterialTransparent(Material mat)
	{
		mat.SetOverrideTag("Queue", "Transparent");
		mat.SetOverrideTag("RenderType", "Transparent");
		mat.SetInt("_SrcBlend", 5);
		mat.SetInt("_DstBlend", 10);
		mat.EnableKeyword("_ALPHATEST_ON");
		mat.EnableKeyword("_ALPHABLEND_ON");
		mat.EnableKeyword("_ALPHAPREMULTIPLY_ON");
		mat.renderQueue = 3000;
	}

	private void SetMaterialOpaque(Material mat)
	{
		mat.SetOverrideTag("Queue", "Geometry");
		mat.SetOverrideTag("RenderType", "Opaque");
		mat.SetInt("_SrcBlend", 1);
		mat.SetInt("_DstBlend", 0);
		mat.DisableKeyword("_ALPHATEST_ON");
		mat.DisableKeyword("_ALPHABLEND_ON");
		mat.DisableKeyword("_ALPHAPREMULTIPLY_ON");
		mat.renderQueue = 2000;
	}
}
public class OvrAvatarTextureCopyManager : MonoBehaviour
{
	[Serializable]
	public struct FallbackTextureSet
	{
		public bool Initialized;

		public Texture2D DiffuseRoughness;

		public Texture2D Normal;
	}

	private struct CopyTextureParams
	{
		public Texture Src;

		public Texture Dst;

		public int Mip;

		public int SrcSize;

		public int DstElement;

		public CopyTextureParams(Texture src, Texture dst, int mip, int srcSize, int dstElement)
		{
			Src = src;
			Dst = dst;
			Mip = mip;
			SrcSize = srcSize;
			DstElement = dstElement;
		}
	}

	public struct TextureSet
	{
		public Dictionary<ulong, bool> TextureIDSingleMeshPair;

		public bool IsProcessed;

		public TextureSet(Dictionary<ulong, bool> textureIDSingleMeshPair, bool isProcessed)
		{
			TextureIDSingleMeshPair = textureIDSingleMeshPair;
			IsProcessed = isProcessed;
		}
	}

	public FallbackTextureSet[] FallbackTextureSets = new FallbackTextureSet[6];

	private Queue<CopyTextureParams> texturesToCopy;

	private Dictionary<int, TextureSet> textureSets;

	private const int TEXTURES_TO_COPY_QUEUE_CAPACITY = 256;

	private const int COPIES_PER_FRAME = 8;

	private readonly string[] FALLBACK_TEXTURE_PATHS_DIFFUSE_ROUGHNESS = new string[6] { "null", "FallbackTextures/fallback_diffuse_roughness_256", "null", "FallbackTextures/fallback_diffuse_roughness_1024", "null", "FallbackTextures/fallback_diffuse_roughness_2048" };

	private readonly string[] FALLBACK_TEXTURE_PATHS_NORMAL = new string[6] { "null", "FallbackTextures/fallback_normal_256", "null", "FallbackTextures/fallback_normal_1024", "null", "FallbackTextures/fallback_normal_2048" };

	private const string PATH_HIGHEST_DIFFUSE_ROUGHNESS = "FallbackTextures/fallback_diffuse_roughness_2048";

	private const string PATH_MEDIUM_DIFFUSE_ROUGHNESS = "FallbackTextures/fallback_diffuse_roughness_1024";

	private const string PATH_LOWEST_DIFFUSE_ROUGHNESS = "FallbackTextures/fallback_diffuse_roughness_256";

	private const string PATH_HIGHEST_NORMAL = "FallbackTextures/fallback_normal_2048";

	private const string PATH_MEDIUM_NORMAL = "FallbackTextures/fallback_normal_1024";

	private const string PATH_LOWEST_NORMAL = "FallbackTextures/fallback_normal_256";

	private const int GPU_TEXTURE_COPY_WAIT_TIME = 10;

	public OvrAvatarTextureCopyManager()
	{
		texturesToCopy = new Queue<CopyTextureParams>(256);
		textureSets = new Dictionary<int, TextureSet>();
	}

	public void Update()
	{
		if (texturesToCopy.Count == 0)
		{
			return;
		}
		lock (texturesToCopy)
		{
			for (int i = 0; i < Mathf.Min(8, texturesToCopy.Count); i++)
			{
				CopyTexture(texturesToCopy.Dequeue());
			}
		}
	}

	public int GetTextureCount()
	{
		return texturesToCopy.Count;
	}

	public void CopyTexture(Texture src, Texture dst, int mipLevel, int mipSize, int dstElement, bool useQueue = true)
	{
		CopyTextureParams copyTextureParams = new CopyTextureParams(src, dst, mipLevel, mipSize, dstElement);
		if (useQueue)
		{
			lock (texturesToCopy)
			{
				if (texturesToCopy.Count < 256)
				{
					texturesToCopy.Enqueue(copyTextureParams);
				}
				else
				{
					CopyTexture(copyTextureParams);
				}
				return;
			}
		}
		CopyTexture(copyTextureParams);
	}

	private void CopyTexture(CopyTextureParams copyTextureParams)
	{
		Graphics.CopyTexture(copyTextureParams.Src, 0, copyTextureParams.Mip, copyTextureParams.Dst, copyTextureParams.DstElement, copyTextureParams.Mip);
	}

	public void AddTextureIDToTextureSet(int gameobjectID, ulong textureID, bool isSingleMesh)
	{
		bool value2;
		if (!textureSets.ContainsKey(gameobjectID))
		{
			TextureSet value = new TextureSet(new Dictionary<ulong, bool>(), isProcessed: false);
			value.TextureIDSingleMeshPair.Add(textureID, isSingleMesh);
			textureSets.Add(gameobjectID, value);
		}
		else if (textureSets[gameobjectID].TextureIDSingleMeshPair.TryGetValue(textureID, out value2))
		{
			if (!value2 && isSingleMesh)
			{
				textureSets[gameobjectID].TextureIDSingleMeshPair[textureID] = true;
			}
		}
		else
		{
			textureSets[gameobjectID].TextureIDSingleMeshPair.Add(textureID, isSingleMesh);
		}
	}

	public void DeleteTextureSet(int gameobjectID)
	{
		if (textureSets.TryGetValue(gameobjectID, out var value) && !value.IsProcessed)
		{
			StartCoroutine(DeleteTextureSetCoroutine(value, gameobjectID));
		}
	}

	private IEnumerator DeleteTextureSetCoroutine(TextureSet textureSetToDelete, int gameobjectID)
	{
		yield return new WaitForSeconds(10f);
		while (OvrAvatarSDKManager.Instance.IsAvatarLoading())
		{
			yield return null;
		}
		foreach (KeyValuePair<ulong, bool> item in textureSetToDelete.TextureIDSingleMeshPair)
		{
			bool flag = !item.Value;
			if (flag)
			{
				foreach (KeyValuePair<int, TextureSet> textureSet in textureSets)
				{
					if (textureSet.Key == gameobjectID)
					{
						continue;
					}
					foreach (KeyValuePair<ulong, bool> item2 in textureSet.Value.TextureIDSingleMeshPair)
					{
						if (item2.Key == item.Key && (!textureSet.Value.IsProcessed || item2.Value))
						{
							flag = false;
							break;
						}
					}
					if (!flag)
					{
						break;
					}
				}
			}
			if (flag)
			{
				Texture2D loadedTexture = OvrAvatarComponent.GetLoadedTexture(item.Key);
				if (loadedTexture != null)
				{
					OvrAvatarSDKManager.Instance.DeleteAssetFromCache(item.Key);
					UnityEngine.Object.Destroy(loadedTexture);
				}
			}
		}
		textureSetToDelete.IsProcessed = true;
		textureSets.Remove(gameobjectID);
	}

	public void CheckFallbackTextureSet(ovrAvatarAssetLevelOfDetail lod)
	{
		if (!FallbackTextureSets[(int)lod].Initialized)
		{
			InitFallbackTextureSet(lod);
		}
	}

	private void InitFallbackTextureSet(ovrAvatarAssetLevelOfDetail lod)
	{
		FallbackTextureSets[(int)lod].DiffuseRoughness = (FallbackTextureSets[(int)lod].DiffuseRoughness = Resources.Load<Texture2D>(FALLBACK_TEXTURE_PATHS_DIFFUSE_ROUGHNESS[(int)lod]));
		FallbackTextureSets[(int)lod].Normal = (FallbackTextureSets[(int)lod].Normal = Resources.Load<Texture2D>(FALLBACK_TEXTURE_PATHS_NORMAL[(int)lod]));
		FallbackTextureSets[(int)lod].Initialized = true;
	}
}
public class OvrAvatarTouchController : OvrAvatarComponent
{
	public bool isLeftHand = true;

	private ovrAvatarControllerComponent component;

	private void Update()
	{
		if (owner == null)
		{
			return;
		}
		bool flag = false;
		if ((!isLeftHand) ? Oculus.Avatar.CAPI.ovrAvatarPose_GetRightControllerComponent(owner.sdkAvatar, ref component) : Oculus.Avatar.CAPI.ovrAvatarPose_GetLeftControllerComponent(owner.sdkAvatar, ref component))
		{
			UpdateAvatar(component.renderComponent);
			return;
		}
		if (isLeftHand)
		{
			owner.ControllerLeft = null;
		}
		else
		{
			owner.ControllerRight = null;
		}
		UnityEngine.Object.Destroy(this);
	}
}
public class EnableSwitch : MonoBehaviour
{
	public GameObject[] SwitchTargets;

	public bool SetActive<T>(int target) where T : MonoBehaviour
	{
		if (target < 0 || target >= SwitchTargets.Length)
		{
			return false;
		}
		for (int i = 0; i < SwitchTargets.Length; i++)
		{
			SwitchTargets[i].SetActive(value: false);
			OVRLipSyncContextMorphTarget component = SwitchTargets[i].GetComponent<OVRLipSyncContextMorphTarget>();
			if ((bool)component)
			{
				component.enabled = false;
			}
			OVRLipSyncContextTextureFlip component2 = SwitchTargets[i].GetComponent<OVRLipSyncContextTextureFlip>();
			if ((bool)component2)
			{
				component2.enabled = false;
			}
		}
		SwitchTargets[target].SetActive(value: true);
		MonoBehaviour component3 = SwitchTargets[target].GetComponent<T>();
		if (component3 != null)
		{
			component3.enabled = true;
		}
		return true;
	}
}
public class LipSyncDemo_Control : MonoBehaviour
{
	[Tooltip("Key used to rotate the demo object up to 45 degrees to the left.")]
	public KeyCode rotateLeftKey = KeyCode.LeftArrow;

	[Tooltip("Key used to rotate the demo object up to 45 degrees to the right.")]
	public KeyCode rotateRightKey = KeyCode.RightArrow;

	[Tooltip("Key used to reset demo object rotation.")]
	public KeyCode resetRotationKey = KeyCode.DownArrow;

	private float resetRotation = 180f;

	private float rotationAmount = 20f;

	private float rotationMax = 45f;

	private void Start()
	{
	}

	private void Update()
	{
		if (Input.GetKey(rotateLeftKey))
		{
			RotateObject(rotationAmount);
		}
		else if (Input.GetKey(rotateRightKey))
		{
			RotateObject(0f - rotationAmount);
		}
		else if (Input.GetKey(resetRotationKey))
		{
			RotateObject(resetRotation, absolute: true);
		}
	}

	private void RotateObject(float amountDegrees, bool absolute = false)
	{
		GameObject gameObject = GameObject.Find("LipSyncMorphTarget_Female");
		if (gameObject == null)
		{
			gameObject = GameObject.Find("RobotHead_TextureFlip");
		}
		if (!gameObject)
		{
			return;
		}
		if (absolute)
		{
			float num = amountDegrees - gameObject.transform.eulerAngles.y;
			gameObject.transform.Rotate(Vector3.up * num);
			return;
		}
		float num2 = Time.deltaTime * amountDegrees;
		if (num2 + gameObject.transform.eulerAngles.y >= resetRotation - rotationMax && num2 + gameObject.transform.eulerAngles.y <= resetRotation + rotationMax)
		{
			gameObject.transform.Rotate(Vector3.up * num2);
		}
	}
}
public class LipSyncDemo_SetCurrentTarget : MonoBehaviour
{
	public EnableSwitch[] SwitchTargets;

	private int targetSet;

	private int maxTarget = 6;

	private void Start()
	{
		OVRTouchpad.AddListener(LocalTouchEventCallback);
		targetSet = 0;
		SwitchTargets[0].SetActive<OVRLipSyncContextMorphTarget>(0);
		SwitchTargets[1].SetActive<OVRLipSyncContextMorphTarget>(0);
	}

	private void Update()
	{
		if (Input.GetKeyDown(KeyCode.Alpha1))
		{
			targetSet = 0;
			SetCurrentTarget();
		}
		else if (Input.GetKeyDown(KeyCode.Alpha2))
		{
			targetSet = 1;
			SetCurrentTarget();
		}
		else if (Input.GetKeyDown(KeyCode.Alpha3))
		{
			targetSet = 2;
			SetCurrentTarget();
		}
		else if (Input.GetKeyDown(KeyCode.Alpha4))
		{
			targetSet = 3;
			SetCurrentTarget();
		}
		else if (Input.GetKeyDown(KeyCode.Alpha5))
		{
			targetSet = 4;
			SetCurrentTarget();
		}
		else if (Input.GetKeyDown(KeyCode.Alpha6))
		{
			targetSet = 5;
			SetCurrentTarget();
		}
		if (Input.GetKeyDown(KeyCode.Escape))
		{
			UnityEngine.Application.Quit();
		}
	}

	private void SetCurrentTarget()
	{
		switch (targetSet)
		{
		case 0:
			SwitchTargets[0].SetActive<OVRLipSyncContextMorphTarget>(0);
			SwitchTargets[1].SetActive<OVRLipSyncContextMorphTarget>(0);
			break;
		case 1:
			SwitchTargets[0].SetActive<OVRLipSyncContextTextureFlip>(0);
			SwitchTargets[1].SetActive<OVRLipSyncContextTextureFlip>(1);
			break;
		case 2:
			SwitchTargets[0].SetActive<OVRLipSyncContextMorphTarget>(1);
			SwitchTargets[1].SetActive<OVRLipSyncContextMorphTarget>(2);
			break;
		case 3:
			SwitchTargets[0].SetActive<OVRLipSyncContextTextureFlip>(1);
			SwitchTargets[1].SetActive<OVRLipSyncContextTextureFlip>(3);
			break;
		case 4:
			SwitchTargets[0].SetActive<OVRLipSyncContextMorphTarget>(2);
			SwitchTargets[1].SetActive<OVRLipSyncContextMorphTarget>(4);
			break;
		case 5:
			SwitchTargets[0].SetActive<OVRLipSyncContextTextureFlip>(2);
			SwitchTargets[1].SetActive<OVRLipSyncContextTextureFlip>(5);
			break;
		}
		OVRLipSyncDebugConsole.Clear();
	}

	private void LocalTouchEventCallback(OVRTouchpad.TouchEvent touchEvent)
	{
		switch (touchEvent)
		{
		case OVRTouchpad.TouchEvent.Left:
			targetSet--;
			if (targetSet < 0)
			{
				targetSet = maxTarget - 1;
			}
			SetCurrentTarget();
			break;
		case OVRTouchpad.TouchEvent.Right:
			targetSet++;
			if (targetSet >= maxTarget)
			{
				targetSet = 0;
			}
			SetCurrentTarget();
			break;
		}
	}
}
public class OVRLipSyncDebugConsole : MonoBehaviour
{
	public ArrayList messages = new ArrayList();

	public int maxMessages = 15;

	public Text textMsg;

	private static OVRLipSyncDebugConsole s_Instance;

	private bool clearTimeoutOn;

	private float clearTimeout;

	public static OVRLipSyncDebugConsole instance
	{
		get
		{
			if (s_Instance == null)
			{
				s_Instance = UnityEngine.Object.FindObjectOfType(typeof(OVRLipSyncDebugConsole)) as OVRLipSyncDebugConsole;
				if (s_Instance == null)
				{
					GameObject obj = new GameObject();
					obj.AddComponent<OVRLipSyncDebugConsole>();
					obj.name = "OVRLipSyncDebugConsole";
					s_Instance = UnityEngine.Object.FindObjectOfType(typeof(OVRLipSyncDebugConsole)) as OVRLipSyncDebugConsole;
				}
			}
			return s_Instance;
		}
	}

	private void Awake()
	{
		s_Instance = this;
		Init();
	}

	private void Update()
	{
		if (clearTimeoutOn)
		{
			clearTimeout -= Time.deltaTime;
			if (clearTimeout < 0f)
			{
				Clear();
				clearTimeout = 0f;
				clearTimeoutOn = false;
			}
		}
	}

	public void Init()
	{
		if (textMsg == null)
		{
			UnityEngine.Debug.LogWarning("DebugConsole Init WARNING::UI text not set. Will not be able to display anything.");
		}
		Clear();
	}

	public static void Log(string message)
	{
		instance.AddMessage(message, Color.white);
	}

	public static void Log(string message, Color color)
	{
		instance.AddMessage(message, color);
	}

	public static void Clear()
	{
		instance.ClearMessages();
	}

	public static void ClearTimeout(float timeToClear)
	{
		instance.SetClearTimeout(timeToClear);
	}

	public void AddMessage(string message, Color color)
	{
		messages.Add(message);
		if (textMsg != null)
		{
			textMsg.color = color;
		}
		Display();
	}

	public void ClearMessages()
	{
		messages.Clear();
		Display();
	}

	public void SetClearTimeout(float timeout)
	{
		clearTimeout = timeout;
		clearTimeoutOn = true;
	}

	private void Prune()
	{
		if (messages.Count > maxMessages)
		{
			int count = ((messages.Count > 0) ? (messages.Count - maxMessages) : 0);
			messages.RemoveRange(0, count);
		}
	}

	private void Display()
	{
		if (messages.Count > maxMessages)
		{
			Prune();
		}
		if (textMsg != null)
		{
			textMsg.text = "";
			for (int i = 0; i < messages.Count; i++)
			{
				textMsg.text += (string)messages[i];
				textMsg.text += "\n";
			}
		}
	}
}
public class OVRNamedArrayAttribute : PropertyAttribute
{
	public readonly string[] names;

	public OVRNamedArrayAttribute(string[] names)
	{
		this.names = names;
	}
}
public static class OVRTouchpad
{
	public enum TouchEvent
	{
		SingleTap,
		DoubleTap,
		Left,
		Right,
		Up,
		Down
	}

	public delegate void OVRTouchpadCallback<TouchEvent>(TouchEvent arg);

	private static Vector3 moveAmountMouse;

	private static float minMovMagnitudeMouse = 25f;

	public static Delegate touchPadCallbacks = null;

	private static OVRTouchpadHelper touchpadHelper = new GameObject("OVRTouchpadHelper").AddComponent<OVRTouchpadHelper>();

	public static void Create()
	{
	}

	public static void Update()
	{
		if (Input.GetMouseButtonDown(0))
		{
			moveAmountMouse = Input.mousePosition;
		}
		else if (Input.GetMouseButtonUp(0))
		{
			moveAmountMouse -= Input.mousePosition;
			HandleInputMouse(ref moveAmountMouse);
		}
	}

	public static void OnDisable()
	{
	}

	private static void HandleInputMouse(ref Vector3 move)
	{
		if ((object)touchPadCallbacks == null)
		{
			return;
		}
		OVRTouchpadCallback<TouchEvent> oVRTouchpadCallback = touchPadCallbacks as OVRTouchpadCallback<TouchEvent>;
		if (move.magnitude < minMovMagnitudeMouse)
		{
			oVRTouchpadCallback(TouchEvent.SingleTap);
			return;
		}
		move.Normalize();
		if (Mathf.Abs(move.x) > Mathf.Abs(move.y))
		{
			if (move.x > 0f)
			{
				oVRTouchpadCallback(TouchEvent.Left);
			}
			else
			{
				oVRTouchpadCallback(TouchEvent.Right);
			}
		}
		else if (move.y > 0f)
		{
			oVRTouchpadCallback(TouchEvent.Down);
		}
		else
		{
			oVRTouchpadCallback(TouchEvent.Up);
		}
	}

	public static void AddListener(OVRTouchpadCallback<TouchEvent> handler)
	{
		touchPadCallbacks = (OVRTouchpadCallback<TouchEvent>)Delegate.Combine((OVRTouchpadCallback<TouchEvent>)touchPadCallbacks, handler);
	}
}
public sealed class OVRTouchpadHelper : MonoBehaviour
{
	private void Awake()
	{
		UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
	}

	private void Start()
	{
		OVRTouchpad.AddListener(LocalTouchEventCallback);
	}

	private void Update()
	{
		OVRTouchpad.Update();
	}

	public void OnDisable()
	{
		OVRTouchpad.OnDisable();
	}

	private void LocalTouchEventCallback(OVRTouchpad.TouchEvent touchEvent)
	{
		switch (touchEvent)
		{
		}
	}
}
public class OVRLipSync : MonoBehaviour
{
	public enum Result
	{
		Success = 0,
		Unknown = -2200,
		CannotCreateContext = -2201,
		InvalidParam = -2202,
		BadSampleRate = -2203,
		MissingDLL = -2204,
		BadVersion = -2205,
		UndefinedFunction = -2206
	}

	public enum AudioDataType
	{
		S16_Mono,
		S16_Stereo,
		F32_Mono,
		F32_Stereo
	}

	public enum Viseme
	{
		sil,
		PP,
		FF,
		TH,
		DD,
		kk,
		CH,
		SS,
		nn,
		RR,
		aa,
		E,
		ih,
		oh,
		ou
	}

	public enum Signals
	{
		VisemeOn,
		VisemeOff,
		VisemeAmount,
		VisemeSmoothing,
		LaughterAmount
	}

	public enum ContextProviders
	{
		Original,
		Enhanced,
		Enhanced_with_Laughter
	}

	[Serializable]
	public class Frame
	{
		public int frameNumber;

		public int frameDelay;

		public float[] Visemes = new float[VisemeCount];

		public float laughterScore;

		public void CopyInput(Frame input)
		{
			frameNumber = input.frameNumber;
			frameDelay = input.frameDelay;
			input.Visemes.CopyTo(Visemes, 0);
			laughterScore = input.laughterScore;
		}

		public void Reset()
		{
			frameNumber = 0;
			frameDelay = 0;
			Array.Clear(Visemes, 0, VisemeCount);
			laughterScore = 0f;
		}
	}

	public static readonly int VisemeCount = Enum.GetNames(typeof(Viseme)).Length;

	public static readonly int SignalCount = Enum.GetNames(typeof(Signals)).Length;

	public const string strOVRLS = "OVRLipSync";

	private static Result sInitialized = Result.Unknown;

	public static OVRLipSync sInstance = null;

	[DllImport("OVRLipSync")]
	private static extern int ovrLipSyncDll_Initialize(int samplerate, int buffersize);

	[DllImport("OVRLipSync")]
	private static extern void ovrLipSyncDll_Shutdown();

	[DllImport("OVRLipSync")]
	private static extern IntPtr ovrLipSyncDll_GetVersion(ref int Major, ref int Minor, ref int Patch);

	[DllImport("OVRLipSync")]
	private static extern int ovrLipSyncDll_CreateContextEx(ref uint context, ContextProviders provider, int sampleRate, bool enableAcceleration);

	[DllImport("OVRLipSync")]
	private static extern int ovrLipSyncDll_CreateContextWithModelFile(ref uint context, ContextProviders provider, string modelPath, int sampleRate, bool enableAcceleration);

	[DllImport("OVRLipSync")]
	private static extern int ovrLipSyncDll_DestroyContext(uint context);

	[DllImport("OVRLipSync")]
	private static extern int ovrLipSyncDll_ResetContext(uint context);

	[DllImport("OVRLipSync")]
	private static extern int ovrLipSyncDll_SendSignal(uint context, Signals signal, int arg1, int arg2);

	[DllImport("OVRLipSync")]
	private static extern int ovrLipSyncDll_ProcessFrameEx(uint context, IntPtr audioBuffer, uint bufferSize, AudioDataType dataType, ref int frameNumber, ref int frameDelay, float[] visemes, int visemeCount, ref float laughterScore, float[] laughterCategories, int laughterCategoriesLength);

	private void Awake()
	{
		if (sInstance == null)
		{
			sInstance = this;
			if (IsInitialized() != 0)
			{
				sInitialized = Initialize();
				if (sInitialized != 0)
				{
					UnityEngine.Debug.LogWarning($"OvrLipSync Awake: Failed to init Speech Rec library");
				}
			}
			OVRTouchpad.Create();
		}
		else
		{
			UnityEngine.Debug.LogWarning($"OVRLipSync Awake: Only one instance of OVRPLipSync can exist in the scene.");
		}
	}

	private void OnDestroy()
	{
		if (sInstance != this)
		{
			UnityEngine.Debug.LogWarning("OVRLipSync OnDestroy: This is not the correct OVRLipSync instance.");
		}
	}

	public static Result Initialize()
	{
		int outputSampleRate = AudioSettings.outputSampleRate;
		AudioSettings.GetDSPBufferSize(out var bufferLength, out var _);
		UnityEngine.Debug.LogWarning($"OvrLipSync Awake: Queried SampleRate: {outputSampleRate:F0} BufferSize: {bufferLength:F0}");
		sInitialized = (Result)ovrLipSyncDll_Initialize(outputSampleRate, bufferLength);
		return sInitialized;
	}

	public static Result Initialize(int sampleRate, int bufferSize)
	{
		UnityEngine.Debug.LogWarning($"OvrLipSync Awake: Queried SampleRate: {sampleRate:F0} BufferSize: {bufferSize:F0}");
		sInitialized = (Result)ovrLipSyncDll_Initialize(sampleRate, bufferSize);
		return sInitialized;
	}

	public static void Shutdown()
	{
		ovrLipSyncDll_Shutdown();
		sInitialized = Result.Unknown;
	}

	public static Result IsInitialized()
	{
		return sInitialized;
	}

	public static Result CreateContext(ref uint context, ContextProviders provider, int sampleRate = 0, bool enableAcceleration = false)
	{
		if (IsInitialized() != 0 && Initialize() != 0)
		{
			return Result.CannotCreateContext;
		}
		return (Result)ovrLipSyncDll_CreateContextEx(ref context, provider, sampleRate, enableAcceleration);
	}

	public static Result CreateContextWithModelFile(ref uint context, ContextProviders provider, string modelPath, int sampleRate = 0, bool enableAcceleration = false)
	{
		if (IsInitialized() != 0 && Initialize() != 0)
		{
			return Result.CannotCreateContext;
		}
		return (Result)ovrLipSyncDll_CreateContextWithModelFile(ref context, provider, modelPath, sampleRate, enableAcceleration);
	}

	public static Result DestroyContext(uint context)
	{
		if (IsInitialized() != 0)
		{
			return Result.Unknown;
		}
		return (Result)ovrLipSyncDll_DestroyContext(context);
	}

	public static Result ResetContext(uint context)
	{
		if (IsInitialized() != 0)
		{
			return Result.Unknown;
		}
		return (Result)ovrLipSyncDll_ResetContext(context);
	}

	public static Result SendSignal(uint context, Signals signal, int arg1, int arg2)
	{
		if (IsInitialized() != 0)
		{
			return Result.Unknown;
		}
		return (Result)ovrLipSyncDll_SendSignal(context, signal, arg1, arg2);
	}

	public static Result ProcessFrame(uint context, float[] audioBuffer, Frame frame, bool stereo = true)
	{
		if (IsInitialized() != 0)
		{
			return Result.Unknown;
		}
		AudioDataType dataType = (stereo ? AudioDataType.F32_Stereo : AudioDataType.F32_Mono);
		uint bufferSize = (uint)(stereo ? (audioBuffer.Length / 2) : audioBuffer.Length);
		GCHandle gCHandle = GCHandle.Alloc(audioBuffer, GCHandleType.Pinned);
		int result = ovrLipSyncDll_ProcessFrameEx(context, gCHandle.AddrOfPinnedObject(), bufferSize, dataType, ref frame.frameNumber, ref frame.frameDelay, frame.Visemes, frame.Visemes.Length, ref frame.laughterScore, null, 0);
		gCHandle.Free();
		return (Result)result;
	}

	public static Result ProcessFrame(uint context, short[] audioBuffer, Frame frame, bool stereo = true)
	{
		if (IsInitialized() != 0)
		{
			return Result.Unknown;
		}
		AudioDataType dataType = (stereo ? AudioDataType.S16_Stereo : AudioDataType.S16_Mono);
		uint bufferSize = (uint)(stereo ? (audioBuffer.Length / 2) : audioBuffer.Length);
		GCHandle gCHandle = GCHandle.Alloc(audioBuffer, GCHandleType.Pinned);
		int result = ovrLipSyncDll_ProcessFrameEx(context, gCHandle.AddrOfPinnedObject(), bufferSize, dataType, ref frame.frameNumber, ref frame.frameDelay, frame.Visemes, frame.Visemes.Length, ref frame.laughterScore, null, 0);
		gCHandle.Free();
		return (Result)result;
	}
}
[RequireComponent(typeof(AudioSource))]
public class OVRLipSyncContext : OVRLipSyncContextBase
{
	[Tooltip("Allow capturing of keyboard input to control operation.")]
	public bool enableKeyboardInput;

	[Tooltip("Register a mouse/touch callback to control loopback and gain (requires script restart).")]
	public bool enableTouchInput;

	[Tooltip("Play input audio back through audio output.")]
	public bool audioLoopback;

	[Tooltip("Key to toggle audio loopback.")]
	public KeyCode loopbackKey = KeyCode.L;

	[Tooltip("Show viseme scores in an OVRLipSyncDebugConsole display.")]
	public bool showVisemes;

	[Tooltip("Key to toggle viseme score display.")]
	public KeyCode debugVisemesKey = KeyCode.D;

	[Tooltip("Skip data from the Audio Source. Use if you intend to pass audio data in manually.")]
	public bool skipAudioSource;

	[Tooltip("Adjust the linear audio gain multiplier before processing lipsync")]
	public float gain = 1f;

	private bool hasDebugConsole;

	public KeyCode debugLaughterKey = KeyCode.H;

	public bool showLaughter;

	public float laughterScore;

	private void Start()
	{
		if (enableTouchInput)
		{
			OVRTouchpad.AddListener(LocalTouchEventCallback);
		}
		OVRLipSyncDebugConsole[] array = UnityEngine.Object.FindObjectsOfType<OVRLipSyncDebugConsole>();
		if (array.Length != 0)
		{
			hasDebugConsole = array[0];
		}
	}

	private void HandleKeyboard()
	{
		if (Input.GetKeyDown(loopbackKey))
		{
			ToggleAudioLoopback();
		}
		else if (Input.GetKeyDown(debugVisemesKey))
		{
			showVisemes = !showVisemes;
			if (showVisemes)
			{
				if (hasDebugConsole)
				{
					UnityEngine.Debug.Log("DEBUG SHOW VISEMES: ENABLED");
					return;
				}
				UnityEngine.Debug.LogWarning("Warning: No OVRLipSyncDebugConsole in the scene!");
				showVisemes = false;
			}
			else
			{
				if (hasDebugConsole)
				{
					OVRLipSyncDebugConsole.Clear();
				}
				UnityEngine.Debug.Log("DEBUG SHOW VISEMES: DISABLED");
			}
		}
		else if (Input.GetKeyDown(debugLaughterKey))
		{
			showLaughter = !showLaughter;
			if (showLaughter)
			{
				if (hasDebugConsole)
				{
					UnityEngine.Debug.Log("DEBUG SHOW LAUGHTER: ENABLED");
					return;
				}
				UnityEngine.Debug.LogWarning("Warning: No OVRLipSyncDebugConsole in the scene!");
				showLaughter = false;
			}
			else
			{
				if (hasDebugConsole)
				{
					OVRLipSyncDebugConsole.Clear();
				}
				UnityEngine.Debug.Log("DEBUG SHOW LAUGHTER: DISABLED");
			}
		}
		else if (Input.GetKeyDown(KeyCode.LeftArrow))
		{
			gain -= 1f;
			if (gain < 1f)
			{
				gain = 1f;
			}
			string text = "LINEAR GAIN: ";
			text += gain;
			if (hasDebugConsole)
			{
				OVRLipSyncDebugConsole.Clear();
				OVRLipSyncDebugConsole.Log(text);
				OVRLipSyncDebugConsole.ClearTimeout(1.5f);
			}
		}
		else if (Input.GetKeyDown(KeyCode.RightArrow))
		{
			gain += 1f;
			if (gain > 15f)
			{
				gain = 15f;
			}
			string text2 = "LINEAR GAIN: ";
			text2 += gain;
			if (hasDebugConsole)
			{
				OVRLipSyncDebugConsole.Clear();
				OVRLipSyncDebugConsole.Log(text2);
				OVRLipSyncDebugConsole.ClearTimeout(1.5f);
			}
		}
	}

	private void Update()
	{
		if (enableKeyboardInput)
		{
			HandleKeyboard();
		}
		laughterScore = base.Frame.laughterScore;
		DebugShowVisemesAndLaughter();
	}

	public void PreprocessAudioSamples(float[] data, int channels)
	{
		for (int i = 0; i < data.Length; i++)
		{
			data[i] *= gain;
		}
	}

	public void PostprocessAudioSamples(float[] data, int channels)
	{
		if (!audioLoopback)
		{
			for (int i = 0; i < data.Length; i++)
			{
				data[i] *= 0f;
			}
		}
	}

	public void ProcessAudioSamplesRaw(float[] data, int channels)
	{
		lock (this)
		{
			if (base.Context != 0 && OVRLipSync.IsInitialized() == OVRLipSync.Result.Success)
			{
				OVRLipSync.Frame frame = base.Frame;
				OVRLipSync.ProcessFrame(base.Context, data, frame, channels == 2);
			}
		}
	}

	public void ProcessAudioSamplesRaw(short[] data, int channels)
	{
		lock (this)
		{
			if (base.Context != 0 && OVRLipSync.IsInitialized() == OVRLipSync.Result.Success)
			{
				OVRLipSync.Frame frame = base.Frame;
				OVRLipSync.ProcessFrame(base.Context, data, frame, channels == 2);
			}
		}
	}

	public void ProcessAudioSamples(float[] data, int channels)
	{
		if (OVRLipSync.IsInitialized() == OVRLipSync.Result.Success && !(audioSource == null))
		{
			PreprocessAudioSamples(data, channels);
			ProcessAudioSamplesRaw(data, channels);
			PostprocessAudioSamples(data, channels);
		}
	}

	private void OnAudioFilterRead(float[] data, int channels)
	{
		if (!skipAudioSource)
		{
			ProcessAudioSamples(data, channels);
		}
	}

	private void DebugShowVisemesAndLaughter()
	{
		if (!hasDebugConsole)
		{
			return;
		}
		string text = "";
		if (showLaughter)
		{
			text += "Laughter:";
			int num = (int)(50f * base.Frame.laughterScore);
			for (int i = 0; i < num; i++)
			{
				text += "*";
			}
			text += "\n";
		}
		if (showVisemes)
		{
			for (int j = 0; j < base.Frame.Visemes.Length; j++)
			{
				string text2 = text;
				OVRLipSync.Viseme viseme = (OVRLipSync.Viseme)j;
				text = text2 + viseme;
				text += ":";
				int num2 = (int)(50f * base.Frame.Visemes[j]);
				for (int k = 0; k < num2; k++)
				{
					text += "*";
				}
				text += "\n";
			}
		}
		OVRLipSyncDebugConsole.Clear();
		if (text != "")
		{
			OVRLipSyncDebugConsole.Log(text);
		}
	}

	private void ToggleAudioLoopback()
	{
		audioLoopback = !audioLoopback;
		if (hasDebugConsole)
		{
			OVRLipSyncDebugConsole.Clear();
			OVRLipSyncDebugConsole.ClearTimeout(1.5f);
			if (audioLoopback)
			{
				OVRLipSyncDebugConsole.Log("LOOPBACK MODE: ENABLED");
			}
			else
			{
				OVRLipSyncDebugConsole.Log("LOOPBACK MODE: DISABLED");
			}
		}
	}

	private void LocalTouchEventCallback(OVRTouchpad.TouchEvent touchEvent)
	{
		string text = "LINEAR GAIN: ";
		switch (touchEvent)
		{
		case OVRTouchpad.TouchEvent.SingleTap:
			ToggleAudioLoopback();
			break;
		case OVRTouchpad.TouchEvent.Up:
			gain += 1f;
			if (gain > 15f)
			{
				gain = 15f;
			}
			text += gain;
			if (hasDebugConsole)
			{
				OVRLipSyncDebugConsole.Clear();
				OVRLipSyncDebugConsole.Log(text);
				OVRLipSyncDebugConsole.ClearTimeout(1.5f);
			}
			break;
		case OVRTouchpad.TouchEvent.Down:
			gain -= 1f;
			if (gain < 1f)
			{
				gain = 1f;
			}
			text += gain;
			if (hasDebugConsole)
			{
				OVRLipSyncDebugConsole.Clear();
				OVRLipSyncDebugConsole.Log(text);
				OVRLipSyncDebugConsole.ClearTimeout(1.5f);
			}
			break;
		}
	}
}
[RequireComponent(typeof(AudioSource))]
public class OVRLipSyncContextBase : MonoBehaviour
{
	public AudioSource audioSource;

	[Tooltip("Which lip sync provider to use for viseme computation.")]
	public OVRLipSync.ContextProviders provider = OVRLipSync.ContextProviders.Enhanced;

	[Tooltip("Enable DSP offload on supported Android devices.")]
	public bool enableAcceleration = true;

	private OVRLipSync.Frame frame = new OVRLipSync.Frame();

	private uint context;

	private int _smoothing;

	public int Smoothing
	{
		get
		{
			return _smoothing;
		}
		set
		{
			switch (OVRLipSync.SendSignal(context, OVRLipSync.Signals.VisemeSmoothing, value, 0))
			{
			case OVRLipSync.Result.InvalidParam:
				UnityEngine.Debug.LogError("OVRLipSyncContextBase.SetSmoothing: A viseme smoothing parameter is invalid, it should be between 1 and 100!");
				break;
			default:
				UnityEngine.Debug.LogError("OVRLipSyncContextBase.SetSmoothing: An unexpected error occured.");
				break;
			case OVRLipSync.Result.Success:
				break;
			}
			_smoothing = value;
		}
	}

	public uint Context => context;

	protected OVRLipSync.Frame Frame => frame;

	private void Awake()
	{
		if (!audioSource)
		{
			audioSource = GetComponent<AudioSource>();
		}
		lock (this)
		{
			if (context == 0 && OVRLipSync.CreateContext(ref context, provider, 0, enableAcceleration) != 0)
			{
				UnityEngine.Debug.LogError("OVRLipSyncContextBase.Start ERROR: Could not create Phoneme context.");
			}
		}
	}

	private void OnDestroy()
	{
		lock (this)
		{
			if (context != 0 && OVRLipSync.DestroyContext(context) != 0)
			{
				UnityEngine.Debug.LogError("OVRLipSyncContextBase.OnDestroy ERROR: Could not delete Phoneme context.");
			}
		}
	}

	public OVRLipSync.Frame GetCurrentPhonemeFrame()
	{
		return frame;
	}

	public void SetVisemeBlend(int viseme, int amount)
	{
		switch (OVRLipSync.SendSignal(context, OVRLipSync.Signals.VisemeAmount, viseme, amount))
		{
		case OVRLipSync.Result.InvalidParam:
			UnityEngine.Debug.LogError("OVRLipSyncContextBase.SetVisemeBlend: Viseme ID is invalid.");
			break;
		default:
			UnityEngine.Debug.LogError("OVRLipSyncContextBase.SetVisemeBlend: An unexpected error occured.");
			break;
		case OVRLipSync.Result.Success:
			break;
		}
	}

	public void SetLaughterBlend(int amount)
	{
		if (OVRLipSync.SendSignal(context, OVRLipSync.Signals.LaughterAmount, amount, 0) != 0)
		{
			UnityEngine.Debug.LogError("OVRLipSyncContextBase.SetLaughterBlend: An unexpected error occured.");
		}
	}

	public OVRLipSync.Result ResetContext()
	{
		frame.Reset();
		return OVRLipSync.ResetContext(context);
	}
}
[RequireComponent(typeof(AudioSource))]
public class OVRLipSyncContextCanned : OVRLipSyncContextBase
{
	[Tooltip("Pre-computed viseme sequence asset. Compute from audio in Unity with Tools -> Oculus -> Generate Lip Sync Assets.")]
	public OVRLipSyncSequence currentSequence;

	private void Update()
	{
		if (audioSource.isPlaying && currentSequence != null)
		{
			OVRLipSync.Frame frameAtTime = currentSequence.GetFrameAtTime(audioSource.time);
			base.Frame.CopyInput(frameAtTime);
		}
	}
}
public class OVRLipSyncContextMorphTarget : MonoBehaviour
{
	[Tooltip("Skinned Mesh Rendered target to be driven by Oculus Lipsync")]
	public SkinnedMeshRenderer skinnedMeshRenderer;

	[Tooltip("Blendshape index to trigger for each viseme.")]
	public int[] visemeToBlendTargets = Enumerable.Range(0, OVRLipSync.VisemeCount).ToArray();

	[Tooltip("Enable using the test keys defined below to manually trigger each viseme.")]
	public bool enableVisemeTestKeys;

	[Tooltip("Test keys used to manually trigger an individual viseme - by default the QWERTY row of a US keyboard.")]
	public KeyCode[] visemeTestKeys = new KeyCode[15]
	{
		KeyCode.BackQuote,
		KeyCode.Tab,
		KeyCode.Q,
		KeyCode.W,
		KeyCode.E,
		KeyCode.R,
		KeyCode.T,
		KeyCode.Y,
		KeyCode.U,
		KeyCode.I,
		KeyCode.O,
		KeyCode.P,
		KeyCode.LeftBracket,
		KeyCode.RightBracket,
		KeyCode.Backslash
	};

	[Tooltip("Test key used to manually trigger laughter and visualise the results")]
	public KeyCode laughterKey = KeyCode.CapsLock;

	[Tooltip("Blendshape index to trigger for laughter")]
	public int laughterBlendTarget = OVRLipSync.VisemeCount;

	[Range(0f, 1f)]
	[Tooltip("Laughter probability threshold above which the laughter blendshape will be activated")]
	public float laughterThreshold = 0.5f;

	[Range(0f, 3f)]
	[Tooltip("Laughter animation linear multiplier, the final output will be clamped to 1.0")]
	public float laughterMultiplier = 1.5f;

	[Range(1f, 100f)]
	[Tooltip("Smoothing of 1 will yield only the current predicted viseme, 100 will yield an extremely smooth viseme response.")]
	public int smoothAmount = 70;

	private OVRLipSyncContextBase lipsyncContext;

	private void Start()
	{
		if (skinnedMeshRenderer == null)
		{
			UnityEngine.Debug.LogError("LipSyncContextMorphTarget.Start Error: Please set the target Skinned Mesh Renderer to be controlled!");
			return;
		}
		lipsyncContext = GetComponent<OVRLipSyncContextBase>();
		if (lipsyncContext == null)
		{
			UnityEngine.Debug.LogError("LipSyncContextMorphTarget.Start Error: No OVRLipSyncContext component on this object!");
		}
		else
		{
			lipsyncContext.Smoothing = smoothAmount;
		}
	}

	private void Update()
	{
		if (lipsyncContext != null && skinnedMeshRenderer != null)
		{
			OVRLipSync.Frame currentPhonemeFrame = lipsyncContext.GetCurrentPhonemeFrame();
			if (currentPhonemeFrame != null)
			{
				SetVisemeToMorphTarget(currentPhonemeFrame);
				SetLaughterToMorphTarget(currentPhonemeFrame);
			}
			CheckForKeys();
			if (smoothAmount != lipsyncContext.Smoothing)
			{
				lipsyncContext.Smoothing = smoothAmount;
			}
		}
	}

	private void CheckForKeys()
	{
		if (enableVisemeTestKeys)
		{
			for (int i = 0; i < OVRLipSync.VisemeCount; i++)
			{
				CheckVisemeKey(visemeTestKeys[i], i, 100);
			}
		}
		CheckLaughterKey();
	}

	private void SetVisemeToMorphTarget(OVRLipSync.Frame frame)
	{
		for (int i = 0; i < visemeToBlendTargets.Length; i++)
		{
			if (visemeToBlendTargets[i] != -1)
			{
				skinnedMeshRenderer.SetBlendShapeWeight(visemeToBlendTargets[i], frame.Visemes[i] * 100f);
			}
		}
	}

	private void SetLaughterToMorphTarget(OVRLipSync.Frame frame)
	{
		if (laughterBlendTarget != -1)
		{
			float laughterScore = frame.laughterScore;
			laughterScore = ((laughterScore < laughterThreshold) ? 0f : (laughterScore - laughterThreshold));
			laughterScore = Mathf.Min(laughterScore * laughterMultiplier, 1f);
			laughterScore *= 1f / laughterThreshold;
			skinnedMeshRenderer.SetBlendShapeWeight(laughterBlendTarget, laughterScore * 100f);
		}
	}

	private void CheckVisemeKey(KeyCode key, int viseme, int amount)
	{
		if (Input.GetKeyDown(key))
		{
			lipsyncContext.SetVisemeBlend(visemeToBlendTargets[viseme], amount);
		}
		if (Input.GetKeyUp(key))
		{
			lipsyncContext.SetVisemeBlend(visemeToBlendTargets[viseme], 0);
		}
	}

	private void CheckLaughterKey()
	{
		if (Input.GetKeyDown(laughterKey))
		{
			lipsyncContext.SetLaughterBlend(100);
		}
		if (Input.GetKeyUp(laughterKey))
		{
			lipsyncContext.SetLaughterBlend(0);
		}
	}
}
public class OVRLipSyncContextTextureFlip : MonoBehaviour
{
	public Material material;

	[Tooltip("The texture used for each viseme.")]
	[OVRNamedArray(new string[]
	{
		"sil", "PP", "FF", "TH", "DD", "kk", "CH", "SS", "nn", "RR",
		"aa", "E", "ih", "oh", "ou"
	})]
	public Texture[] Textures = new Texture[OVRLipSync.VisemeCount];

	[Range(1f, 100f)]
	[Tooltip("Smoothing of 1 will yield only the current predicted viseme,100 will yield an extremely smooth viseme response.")]
	public int smoothAmount = 70;

	private OVRLipSyncContextBase lipsyncContext;

	private OVRLipSync.Frame oldFrame = new OVRLipSync.Frame();

	private void Start()
	{
		lipsyncContext = GetComponent<OVRLipSyncContextBase>();
		if (lipsyncContext == null)
		{
			UnityEngine.Debug.LogWarning("LipSyncContextTextureFlip.Start WARNING: No lip sync context component set to object");
		}
		else
		{
			lipsyncContext.Smoothing = smoothAmount;
		}
		if (material == null)
		{
			UnityEngine.Debug.LogWarning("LipSyncContextTextureFlip.Start WARNING: Lip sync context texture flip has no material target to control!");
		}
	}

	private void Update()
	{
		if (lipsyncContext != null && material != null)
		{
			OVRLipSync.Frame currentPhonemeFrame = lipsyncContext.GetCurrentPhonemeFrame();
			if (currentPhonemeFrame != null)
			{
				if (lipsyncContext.provider == OVRLipSync.ContextProviders.Original)
				{
					for (int i = 0; i < currentPhonemeFrame.Visemes.Length; i++)
					{
						float num = (float)(smoothAmount - 1) / 100f;
						oldFrame.Visemes[i] = oldFrame.Visemes[i] * num + currentPhonemeFrame.Visemes[i] * (1f - num);
					}
				}
				else
				{
					oldFrame.Visemes = currentPhonemeFrame.Visemes;
				}
				SetVisemeToTexture();
			}
		}
		if (smoothAmount != lipsyncContext.Smoothing)
		{
			lipsyncContext.Smoothing = smoothAmount;
		}
	}

	private void SetVisemeToTexture()
	{
		int num = -1;
		float num2 = 0f;
		for (int i = 0; i < oldFrame.Visemes.Length; i++)
		{
			if (oldFrame.Visemes[i] > num2)
			{
				num = i;
				num2 = oldFrame.Visemes[i];
			}
		}
		if (num != -1 && num < Textures.Length)
		{
			Texture texture = Textures[num];
			if (texture != null)
			{
				material.SetTexture("_MainTex", texture);
			}
		}
	}
}
[RequireComponent(typeof(AudioSource))]
public class OVRLipSyncMicInput : MonoBehaviour
{
	public enum micActivation
	{
		HoldToSpeak,
		PushToSpeak,
		ConstantSpeak
	}

	[Tooltip("Manual specification of Audio Source - by default will use any attached to the same object.")]
	public AudioSource audioSource;

	[Tooltip("Enable a keypress to toggle the microphone device selection GUI.")]
	public bool enableMicSelectionGUI;

	[Tooltip("Key to toggle the microphone selection GUI if enabled.")]
	public KeyCode micSelectionGUIKey = KeyCode.M;

	[SerializeField]
	[Range(0f, 100f)]
	[Tooltip("Microphone input volume control.")]
	private float micInputVolume = 100f;

	[SerializeField]
	[Tooltip("Requested microphone input frequency")]
	private int micFrequency = 48000;

	[Tooltip("Microphone input control method. Hold To Speak and Push To Speak are driven with the Mic Activation Key.")]
	public micActivation micControl = micActivation.ConstantSpeak;

	[Tooltip("Key used to drive Hold To Speak and Push To Speak methods of microphone input control.")]
	public KeyCode micActivationKey = KeyCode.Space;

	[Tooltip("Will contain the string name of the selected microphone device - read only.")]
	public string selectedDevice;

	private bool micSelected;

	private int minFreq;

	private int maxFreq;

	private bool focused = true;

	private bool initialized;

	public float MicFrequency
	{
		get
		{
			return micFrequency;
		}
		set
		{
			micFrequency = (int)Mathf.Clamp(value, 0f, 96000f);
		}
	}

	private void Awake()
	{
		if (!audioSource)
		{
			audioSource = GetComponent<AudioSource>();
		}
		_ = (bool)audioSource;
	}

	private void Start()
	{
		audioSource.loop = true;
		audioSource.mute = false;
		InitializeMicrophone();
	}

	private void InitializeMicrophone()
	{
		if (!initialized && Microphone.devices.Length != 0)
		{
			selectedDevice = Microphone.devices[0].ToString();
			micSelected = true;
			GetMicCaps();
			initialized = true;
		}
	}

	private void Update()
	{
		if (!focused)
		{
			if (Microphone.IsRecording(selectedDevice))
			{
				StopMicrophone();
			}
			return;
		}
		if (!UnityEngine.Application.isPlaying)
		{
			StopMicrophone();
			return;
		}
		if (!initialized)
		{
			InitializeMicrophone();
		}
		audioSource.volume = micInputVolume / 100f;
		if (micControl == micActivation.HoldToSpeak)
		{
			if (Input.GetKey(micActivationKey))
			{
				if (!Microphone.IsRecording(selectedDevice))
				{
					StartMicrophone();
				}
			}
			else if (Microphone.IsRecording(selectedDevice))
			{
				StopMicrophone();
			}
		}
		if (micControl == micActivation.PushToSpeak && Input.GetKeyDown(micActivationKey))
		{
			if (Microphone.IsRecording(selectedDevice))
			{
				StopMicrophone();
			}
			else if (!Microphone.IsRecording(selectedDevice))
			{
				StartMicrophone();
			}
		}
		if (micControl == micActivation.ConstantSpeak && !Microphone.IsRecording(selectedDevice))
		{
			StartMicrophone();
		}
		if (enableMicSelectionGUI && Input.GetKeyDown(micSelectionGUIKey))
		{
			micSelected = false;
		}
	}

	private void OnApplicationFocus(bool focus)
	{
		focused = focus;
		if (!focused)
		{
			StopMicrophone();
		}
	}

	private void OnApplicationPause(bool pauseStatus)
	{
		focused = !pauseStatus;
		if (!focused)
		{
			StopMicrophone();
		}
	}

	private void OnDisable()
	{
		StopMicrophone();
	}

	private void OnGUI()
	{
		if (!micSelected)
		{
			MicDeviceGUI(Screen.width / 2 - 150, Screen.height / 2 - 75, 300f, 50f, 10f, -300f);
		}
	}

	public void MicDeviceGUI(float left, float top, float width, float height, float buttonSpaceTop, float buttonSpaceLeft)
	{
		if (Microphone.devices.Length < 1 || !enableMicSelectionGUI)
		{
			return;
		}
		for (int i = 0; i < Microphone.devices.Length; i++)
		{
			if (GUI.Button(new Rect(left + (width + buttonSpaceLeft) * (float)i, top + (height + buttonSpaceTop) * (float)i, width, height), Microphone.devices[i].ToString()))
			{
				StopMicrophone();
				selectedDevice = Microphone.devices[i].ToString();
				micSelected = true;
				GetMicCaps();
				StartMicrophone();
			}
		}
	}

	public void GetMicCaps()
	{
		if (micSelected)
		{
			Microphone.GetDeviceCaps(selectedDevice, out minFreq, out maxFreq);
			if (minFreq == 0 && maxFreq == 0)
			{
				UnityEngine.Debug.LogWarning("GetMicCaps warning:: min and max frequencies are 0");
				minFreq = 44100;
				maxFreq = 44100;
			}
			if (micFrequency > maxFreq)
			{
				micFrequency = maxFreq;
			}
		}
	}

	public void StartMicrophone()
	{
		if (micSelected)
		{
			audioSource.clip = Microphone.Start(selectedDevice, loop: true, 1, micFrequency);
			Stopwatch stopwatch = Stopwatch.StartNew();
			while (Microphone.GetPosition(selectedDevice) <= 0 && stopwatch.Elapsed.TotalMilliseconds < 1000.0)
			{
				Thread.Sleep(50);
			}
			if (Microphone.GetPosition(selectedDevice) <= 0)
			{
				throw new Exception("Timeout initializing microphone " + selectedDevice);
			}
			audioSource.Play();
		}
	}

	public void StopMicrophone()
	{
		if (micSelected)
		{
			if (audioSource != null && audioSource.clip != null && audioSource.clip.name == "Microphone")
			{
				audioSource.Stop();
			}
			GetComponent<OVRLipSyncContext>().ResetContext();
			Microphone.End(selectedDevice);
		}
	}

	private float GetAveragedVolume()
	{
		return 0f;
	}
}
[Serializable]
public class OVRLipSyncSequence : ScriptableObject
{
	public List<OVRLipSync.Frame> entries = new List<OVRLipSync.Frame>();

	public float length;

	public OVRLipSync.Frame GetFrameAtTime(float time)
	{
		OVRLipSync.Frame result = null;
		if (time < length && entries.Count > 0)
		{
			float num = time / length;
			result = entries[(int)((float)entries.Count * num)];
		}
		return result;
	}
}
public class BufferedAudioStream
{
	private const bool VerboseLogging = false;

	private AudioSource audio;

	private float[] audioBuffer;

	private int writePos;

	private const float bufferLengthSeconds = 0.25f;

	private const int sampleRate = 48000;

	private const int bufferSize = 12000;

	private const float playbackDelayTimeSeconds = 0.05f;

	private float playbackDelayRemaining;

	private float remainingBufferTime;

	public BufferedAudioStream(AudioSource audio)
	{
		audioBuffer = new float[12000];
		this.audio = audio;
		audio.loop = true;
		audio.clip = AudioClip.Create("", 12000, 1, 48000, stream: false);
		Stop();
	}

	public void Update()
	{
		if (remainingBufferTime > 0f)
		{
			if (!audio.isPlaying && remainingBufferTime > 0.05f)
			{
				playbackDelayRemaining -= Time.deltaTime;
				if (playbackDelayRemaining <= 0f)
				{
					audio.Play();
				}
			}
			if (audio.isPlaying)
			{
				remainingBufferTime -= Time.deltaTime;
				if (remainingBufferTime < 0f)
				{
					remainingBufferTime = 0f;
				}
			}
		}
		if (remainingBufferTime <= 0f)
		{
			if (audio.isPlaying)
			{
				UnityEngine.Debug.Log("Buffer empty, stopping " + DateTime.Now);
				Stop();
			}
			else if (writePos != 0)
			{
				UnityEngine.Debug.LogError("writePos non zero while not playing, how did this happen?");
			}
		}
	}

	private void Stop()
	{
		audio.Stop();
		audio.time = 0f;
		writePos = 0;
		playbackDelayRemaining = 0.05f;
	}

	public void AddData(float[] samples)
	{
		int num = samples.Length;
		if (writePos > audioBuffer.Length)
		{
			throw new Exception();
		}
		do
		{
			int num2 = num;
			int num3 = audioBuffer.Length - writePos;
			if (num2 > num3)
			{
				num2 = num3;
			}
			Array.Copy(samples, 0, audioBuffer, writePos, num2);
			num -= num2;
			writePos += num2;
			if (writePos > audioBuffer.Length)
			{
				throw new Exception();
			}
			if (writePos == audioBuffer.Length)
			{
				writePos = 0;
			}
		}
		while (num > 0);
		remainingBufferTime += (float)samples.Length / 48000f;
		audio.clip.SetData(audioBuffer, 0);
	}
}
public class DebugUIBuilder : MonoBehaviour
{
	public delegate void OnClick();

	public delegate void OnToggleValueChange(Toggle t);

	public delegate void OnSlider(float f);

	public delegate bool ActiveUpdate();

	public const int DEBUG_PANE_CENTER = 0;

	public const int DEBUG_PANE_RIGHT = 1;

	public const int DEBUG_PANE_LEFT = 2;

	[SerializeField]
	private RectTransform buttonPrefab;

	[SerializeField]
	private RectTransform labelPrefab;

	[SerializeField]
	private RectTransform sliderPrefab;

	[SerializeField]
	private RectTransform dividerPrefab;

	[SerializeField]
	private RectTransform togglePrefab;

	[SerializeField]
	private RectTransform radioPrefab;

	[SerializeField]
	private GameObject uiHelpersToInstantiate;

	[SerializeField]
	private Transform[] targetContentPanels;

	[SerializeField]
	private bool manuallyResizeContentPanels;

	private bool[] reEnable;

	[SerializeField]
	private List<GameObject> toEnable;

	[SerializeField]
	private List<GameObject> toDisable;

	public static DebugUIBuilder instance;

	private const float elementSpacing = 16f;

	private const float marginH = 16f;

	private const float marginV = 16f;

	private Vector2[] insertPositions;

	private List<RectTransform>[] insertedElements;

	private Vector3 menuOffset;

	private OVRCameraRig rig;

	private Dictionary<string, ToggleGroup> radioGroups = new Dictionary<string, ToggleGroup>();

	private LaserPointer lp;

	private LineRenderer lr;

	public LaserPointer.LaserBeamBehavior laserBeamBehavior;

	public void Awake()
	{
		instance = this;
		menuOffset = base.transform.position;
		base.gameObject.SetActive(value: false);
		rig = UnityEngine.Object.FindObjectOfType<OVRCameraRig>();
		for (int i = 0; i < toEnable.Count; i++)
		{
			toEnable[i].SetActive(value: false);
		}
		insertPositions = new Vector2[targetContentPanels.Length];
		for (int j = 0; j < insertPositions.Length; j++)
		{
			insertPositions[j].x = 16f;
			insertPositions[j].y = -16f;
		}
		insertedElements = new List<RectTransform>[targetContentPanels.Length];
		for (int k = 0; k < insertedElements.Length; k++)
		{
			insertedElements[k] = new List<RectTransform>();
		}
		if ((bool)uiHelpersToInstantiate)
		{
			UnityEngine.Object.Instantiate(uiHelpersToInstantiate);
		}
		lp = UnityEngine.Object.FindObjectOfType<LaserPointer>();
		if (!lp)
		{
			UnityEngine.Debug.LogError("Debug UI requires use of a LaserPointer and will not function without it. Add one to your scene, or assign the UIHelpers prefab to the DebugUIBuilder in the inspector.");
			return;
		}
		lp.laserBeamBehavior = laserBeamBehavior;
		if (!toEnable.Contains(lp.gameObject))
		{
			toEnable.Add(lp.gameObject);
		}
		GetComponent<OVRRaycaster>().pointer = lp.gameObject;
		lp.gameObject.SetActive(value: false);
	}

	public void Show()
	{
		Relayout();
		base.gameObject.SetActive(value: true);
		base.transform.position = rig.transform.TransformPoint(menuOffset);
		Vector3 eulerAngles = rig.transform.rotation.eulerAngles;
		eulerAngles.x = 0f;
		eulerAngles.z = 0f;
		base.transform.eulerAngles = eulerAngles;
		if (reEnable == null || reEnable.Length < toDisable.Count)
		{
			reEnable = new bool[toDisable.Count];
		}
		reEnable.Initialize();
		int count = toDisable.Count;
		for (int i = 0; i < count; i++)
		{
			if ((bool)toDisable[i])
			{
				reEnable[i] = toDisable[i].activeSelf;
				toDisable[i].SetActive(value: false);
			}
		}
		count = toEnable.Count;
		for (int j = 0; j < count; j++)
		{
			toEnable[j].SetActive(value: true);
		}
		int num = targetContentPanels.Length;
		for (int k = 0; k < num; k++)
		{
			targetContentPanels[k].gameObject.SetActive(insertedElements[k].Count > 0);
		}
	}

	public void Hide()
	{
		base.gameObject.SetActive(value: false);
		for (int i = 0; i < reEnable.Length; i++)
		{
			if ((bool)toDisable[i] && reEnable[i])
			{
				toDisable[i].SetActive(value: true);
			}
		}
		int count = toEnable.Count;
		for (int j = 0; j < count; j++)
		{
			toEnable[j].SetActive(value: false);
		}
	}

	private void Relayout()
	{
		for (int i = 0; i < targetContentPanels.Length; i++)
		{
			RectTransform component = targetContentPanels[i].GetComponent<RectTransform>();
			List<RectTransform> list = insertedElements[i];
			int count = list.Count;
			float x = 16f;
			float num = -16f;
			float num2 = 0f;
			for (int j = 0; j < count; j++)
			{
				RectTransform rectTransform = list[j];
				rectTransform.anchoredPosition = new Vector2(x, num);
				num -= rectTransform.rect.height + 16f;
				num2 = Mathf.Max(rectTransform.rect.width + 32f, num2);
			}
			component.SetSizeWithCurrentAnchors(RectTransform.Axis.Horizontal, num2);
			component.SetSizeWithCurrentAnchors(RectTransform.Axis.Vertical, 0f - num + 16f);
		}
	}

	private void AddRect(RectTransform r, int targetCanvas)
	{
		if (targetCanvas > targetContentPanels.Length)
		{
			UnityEngine.Debug.LogError("Attempted to add debug panel to canvas " + targetCanvas + ", but only " + targetContentPanels.Length + " panels were provided. Fix in the inspector or pass a lower value for target canvas.");
		}
		else
		{
			r.transform.SetParent(targetContentPanels[targetCanvas], worldPositionStays: false);
			insertedElements[targetCanvas].Add(r);
			if (base.gameObject.activeInHierarchy)
			{
				Relayout();
			}
		}
	}

	public RectTransform AddButton(string label, OnClick handler, int targetCanvas = 0)
	{
		RectTransform component = UnityEngine.Object.Instantiate(buttonPrefab).GetComponent<RectTransform>();
		component.GetComponentInChildren<Button>().onClick.AddListener(delegate
		{
			handler();
		});
		((Text)component.GetComponentsInChildren(typeof(Text), includeInactive: true)[0]).text = label;
		AddRect(component, targetCanvas);
		return component;
	}

	public RectTransform AddLabel(string label, int targetCanvas = 0)
	{
		RectTransform component = UnityEngine.Object.Instantiate(labelPrefab).GetComponent<RectTransform>();
		component.GetComponent<Text>().text = label;
		AddRect(component, targetCanvas);
		return component;
	}

	public RectTransform AddSlider(string label, float min, float max, OnSlider onValueChanged, bool wholeNumbersOnly = false, int targetCanvas = 0)
	{
		RectTransform rectTransform = UnityEngine.Object.Instantiate(sliderPrefab);
		Slider componentInChildren = rectTransform.GetComponentInChildren<Slider>();
		componentInChildren.minValue = min;
		componentInChildren.maxValue = max;
		componentInChildren.onValueChanged.AddListener(delegate(float f)
		{
			onValueChanged(f);
		});
		componentInChildren.wholeNumbers = wholeNumbersOnly;
		AddRect(rectTransform, targetCanvas);
		return rectTransform;
	}

	public RectTransform AddDivider(int targetCanvas = 0)
	{
		RectTransform rectTransform = UnityEngine.Object.Instantiate(dividerPrefab);
		AddRect(rectTransform, targetCanvas);
		return rectTransform;
	}

	public RectTransform AddToggle(string label, OnToggleValueChange onValueChanged, int targetCanvas = 0)
	{
		RectTransform rectTransform = UnityEngine.Object.Instantiate(togglePrefab);
		AddRect(rectTransform, targetCanvas);
		rectTransform.GetComponentInChildren<Text>().text = label;
		Toggle t = rectTransform.GetComponentInChildren<Toggle>();
		t.onValueChanged.AddListener(delegate
		{
			onValueChanged(t);
		});
		return rectTransform;
	}

	public RectTransform AddToggle(string label, OnToggleValueChange onValueChanged, bool defaultValue, int targetCanvas = 0)
	{
		RectTransform rectTransform = UnityEngine.Object.Instantiate(togglePrefab);
		AddRect(rectTransform, targetCanvas);
		rectTransform.GetComponentInChildren<Text>().text = label;
		Toggle t = rectTransform.GetComponentInChildren<Toggle>();
		t.isOn = defaultValue;
		t.onValueChanged.AddListener(delegate
		{
			onValueChanged(t);
		});
		return rectTransform;
	}

	public RectTransform AddRadio(string label, string group, OnToggleValueChange handler, int targetCanvas = 0)
	{
		RectTransform rectTransform = UnityEngine.Object.Instantiate(radioPrefab);
		AddRect(rectTransform, targetCanvas);
		rectTransform.GetComponentInChildren<Text>().text = label;
		Toggle tb = rectTransform.GetComponentInChildren<Toggle>();
		if (group == null)
		{
			group = "default";
		}
		ToggleGroup toggleGroup = null;
		bool isOn = false;
		if (!radioGroups.ContainsKey(group))
		{
			toggleGroup = tb.gameObject.AddComponent<ToggleGroup>();
			radioGroups[group] = toggleGroup;
			isOn = true;
		}
		else
		{
			toggleGroup = radioGroups[group];
		}
		tb.group = toggleGroup;
		tb.isOn = isOn;
		tb.onValueChanged.AddListener(delegate
		{
			handler(tb);
		});
		return rectTransform;
	}

	public void ToggleLaserPointer(bool isOn)
	{
		if ((bool)lp)
		{
			if (isOn)
			{
				lp.enabled = true;
			}
			else
			{
				lp.enabled = false;
			}
		}
	}
}
public class HandedInputSelector : MonoBehaviour
{
	private OVRCameraRig m_CameraRig;

	private OVRInputModule m_InputModule;

	private void Start()
	{
		m_CameraRig = UnityEngine.Object.FindObjectOfType<OVRCameraRig>();
		m_InputModule = UnityEngine.Object.FindObjectOfType<OVRInputModule>();
	}

	private void Update()
	{
		if (OVRInput.GetActiveController() == OVRInput.Controller.LTouch)
		{
			SetActiveController(OVRInput.Controller.LTouch);
		}
		else
		{
			SetActiveController(OVRInput.Controller.RTouch);
		}
	}

	private void SetActiveController(OVRInput.Controller c)
	{
		Transform rayTransform = ((c != OVRInput.Controller.LTouch) ? m_CameraRig.rightHandAnchor : m_CameraRig.leftHandAnchor);
		m_InputModule.rayTransform = rayTransform;
	}
}
public class LaserPointer : OVRCursor
{
	public enum LaserBeamBehavior
	{
		On,
		Off,
		OnWhenHitTarget
	}

	public GameObject cursorVisual;

	public float maxLength = 10f;

	private LaserBeamBehavior _laserBeamBehavior;

	private Vector3 _startPoint;

	private Vector3 _forward;

	private Vector3 _endPoint;

	private bool _hitTarget;

	private LineRenderer lineRenderer;

	public LaserBeamBehavior laserBeamBehavior
	{
		get
		{
			return _laserBeamBehavior;
		}
		set
		{
			_laserBeamBehavior = value;
			if (laserBeamBehavior == LaserBeamBehavior.Off || laserBeamBehavior == LaserBeamBehavior.OnWhenHitTarget)
			{
				lineRenderer.enabled = false;
			}
			else
			{
				lineRenderer.enabled = true;
			}
		}
	}

	private void Awake()
	{
		lineRenderer = GetComponent<LineRenderer>();
	}

	private void Start()
	{
		if ((bool)cursorVisual)
		{
			cursorVisual.SetActive(value: false);
		}
	}

	public override void SetCursorStartDest(Vector3 start, Vector3 dest, Vector3 normal)
	{
		_startPoint = start;
		_endPoint = dest;
		_hitTarget = true;
	}

	public override void SetCursorRay(Transform t)
	{
		_startPoint = t.position;
		_forward = t.forward;
		_hitTarget = false;
	}

	private void LateUpdate()
	{
		lineRenderer.SetPosition(0, _startPoint);
		if (_hitTarget)
		{
			lineRenderer.SetPosition(1, _endPoint);
			UpdateLaserBeam(_startPoint, _endPoint);
			if ((bool)cursorVisual)
			{
				cursorVisual.transform.position = _endPoint;
				cursorVisual.SetActive(value: true);
			}
		}
		else
		{
			UpdateLaserBeam(_startPoint, _startPoint + maxLength * _forward);
			lineRenderer.SetPosition(1, _startPoint + maxLength * _forward);
			if ((bool)cursorVisual)
			{
				cursorVisual.SetActive(value: false);
			}
		}
	}

	private void UpdateLaserBeam(Vector3 start, Vector3 end)
	{
		if (laserBeamBehavior == LaserBeamBehavior.Off)
		{
			return;
		}
		if (laserBeamBehavior == LaserBeamBehavior.On)
		{
			lineRenderer.SetPosition(0, start);
			lineRenderer.SetPosition(1, end);
		}
		else
		{
			if (laserBeamBehavior != LaserBeamBehavior.OnWhenHitTarget)
			{
				return;
			}
			if (_hitTarget)
			{
				if (!lineRenderer.enabled)
				{
					lineRenderer.enabled = true;
					lineRenderer.SetPosition(0, start);
					lineRenderer.SetPosition(1, end);
				}
			}
			else if (lineRenderer.enabled)
			{
				lineRenderer.enabled = false;
			}
		}
	}

	private void OnDisable()
	{
		if ((bool)cursorVisual)
		{
			cursorVisual.SetActive(value: false);
		}
	}
}
public class BoundsLockedObject : MonoBehaviour
{
	private Vector3 m_initialOffset;

	public OVRCameraRig m_playerOrigin;

	public GuardianBoundaryEnforcer m_enforcer;

	private Bounds? m_bounds;

	private void Start()
	{
		m_enforcer.TrackingChanged += RefreshDisplay;
		m_initialOffset = base.gameObject.transform.position - m_playerOrigin.transform.position;
		Renderer component = base.gameObject.GetComponent<Renderer>();
		if (component != null)
		{
			m_bounds = component.bounds;
		}
		RefreshDisplay();
	}

	private void RefreshDisplay()
	{
		if (OVRManager.boundary.GetConfigured())
		{
			Vector3[] geometry = OVRManager.boundary.GetGeometry(OVRBoundary.BoundaryType.PlayArea);
			float num = 10000f;
			float num2 = 10000f;
			float num3 = -10000f;
			float num4 = -10000f;
			for (int i = 0; i < geometry.Length; i++)
			{
				geometry[i] = m_enforcer.OrientToOriginalForward * geometry[i];
				num = Mathf.Min(num, geometry[i].x);
				num2 = Mathf.Min(num2, geometry[i].z);
				num3 = Mathf.Max(num3, geometry[i].x);
				num4 = Mathf.Max(num4, geometry[i].z);
			}
			if (m_bounds.HasValue)
			{
				float num5 = m_bounds.Value.size.x * 0.5f;
				float num6 = m_bounds.Value.size.z * 0.5f;
				num += num5;
				num3 -= num5;
				num2 += num6;
				num4 -= num6;
			}
			Vector3 vector = m_initialOffset;
			vector.x = Mathf.Max(Mathf.Min(num3, m_initialOffset.x), num);
			vector.z = Mathf.Max(Mathf.Min(num4, m_initialOffset.z), num2);
			vector.y = base.gameObject.transform.position.y;
			if (m_enforcer.m_AllowRecenter)
			{
				vector = Quaternion.Inverse(m_enforcer.OrientToOriginalForward) * vector;
			}
			base.gameObject.transform.position = vector;
		}
	}
}
public class GuardianBoundaryDisplay : MonoBehaviour
{
	public GuardianBoundaryEnforcer m_enforcer;

	public OVRBoundary.BoundaryType m_boundaryType;

	public GameObject m_errorDisplay;

	private void Start()
	{
		m_enforcer.TrackingChanged += RefreshDisplay;
		RefreshDisplay();
	}

	private void RefreshDisplay()
	{
		bool configured = OVRManager.boundary.GetConfigured();
		if (configured)
		{
			LineRenderer component = GetComponent<LineRenderer>();
			component.positionCount = 0;
			Vector3[] geometry = OVRManager.boundary.GetGeometry(m_boundaryType);
			component.positionCount = geometry.Length + 1;
			Vector3 position;
			for (int i = 0; i < geometry.Length; i++)
			{
				position = geometry[i];
				position.y = 0f;
				component.SetPosition(i, position);
			}
			position = geometry[0];
			position.y = 0f;
			component.SetPosition(geometry.Length, position);
		}
		if ((bool)m_errorDisplay)
		{
			m_errorDisplay.SetActive(!configured);
		}
	}
}
public class GuardianBoundaryEnforcer : MonoBehaviour
{
	public bool m_AllowRecenter = true;

	public OVRCameraRig m_mainCamera;

	private Quaternion m_originalTrackerOrientation;

	private int m_framecount;

	private Quaternion m_orientToOriginalForward;

	public Quaternion OrientToOriginalForward => m_orientToOriginalForward;

	public event Action TrackingChanged;

	private void Start()
	{
		OVRManager.display.RecenteredPose += Recentered;
		m_originalTrackerOrientation = OVRPlugin.GetNodePose(OVRPlugin.Node.TrackerZero, OVRPlugin.Step.Render).ToOVRPose().orientation;
	}

	private void Update()
	{
		if (m_framecount < 0)
		{
			return;
		}
		m_framecount++;
		if (m_framecount > 2)
		{
			float num = OVRPlugin.GetNodePose(OVRPlugin.Node.TrackerZero, OVRPlugin.Step.Render).ToOVRPose().orientation.eulerAngles.y - m_originalTrackerOrientation.eulerAngles.y;
			m_orientToOriginalForward = Quaternion.Euler(0f, 0f - num, 0f);
			if (!m_AllowRecenter)
			{
				m_mainCamera.trackingSpace.transform.rotation = m_orientToOriginalForward;
			}
			m_framecount = -1;
			if (this.TrackingChanged != null)
			{
				this.TrackingChanged();
			}
		}
	}

	private void Recentered()
	{
		m_framecount = 0;
	}
}
[RequireComponent(typeof(CharacterController))]
[RequireComponent(typeof(OVRPlayerController))]
public class CharacterCameraConstraint : MonoBehaviour
{
	[Tooltip("This should be a reference to the OVRCameraRig that is usually a child of the PlayerController.")]
	public OVRCameraRig CameraRig;

	[Tooltip("This value represents the character capsule's distance from the HMD's position. When the player is moving in legal space without collisions, this will be zero.")]
	public float CurrentDistance;

	[Tooltip("When true, the camera will fade to black when the HMD is moved into collidable geometry.")]
	public bool EnableFadeout;

	[Tooltip("When true, the camera will be prevented from passing through collidable geometry. This is usually considered uncomfortable for users.")]
	public bool EnableCollision;

	[Tooltip("When true, adjust the character controller height on the fly to match the HMD's offset from the ground which will allow ducking to go through smaller spaces.")]
	public bool DynamicHeight;

	[Tooltip("This should be set to 1 to make the screen completely fade out when the HMD is inside world geometry. Lesser values can be useful for testing.")]
	public float MaxFade = 1f;

	[Tooltip("This value is used to control how far from the character capsule the HMD must be before the fade to black begins.")]
	public float FadeMinDistance = 0.25f;

	[Tooltip("This value is used to control how far from the character capsule the HMD must be before the fade to black is complete. This should be tuned so that it is fully faded in before the camera will clip geometry that the player should not be able see beyond.")]
	public float FadeMaxDistance = 0.35f;

	private readonly Action _cameraUpdateAction;

	private readonly Action _preCharacterMovementAction;

	private CharacterController _character;

	private OVRPlayerController _playerController;

	private CharacterCameraConstraint()
	{
		_cameraUpdateAction = CameraUpdate;
		_preCharacterMovementAction = PreCharacterMovement;
	}

	private void Awake()
	{
		_character = GetComponent<CharacterController>();
		_playerController = GetComponent<OVRPlayerController>();
	}

	private void OnEnable()
	{
		_playerController.CameraUpdated += _cameraUpdateAction;
		_playerController.PreCharacterMove += _preCharacterMovementAction;
	}

	private void OnDisable()
	{
		_playerController.PreCharacterMove -= _preCharacterMovementAction;
		_playerController.CameraUpdated -= _cameraUpdateAction;
	}

	private void CameraUpdate()
	{
		if (!DynamicHeight)
		{
			return;
		}
		float cameraHeight = _playerController.CameraHeight;
		if (cameraHeight <= _character.height)
		{
			_character.height = cameraHeight - _character.skinWidth;
			return;
		}
		Vector3 position = _character.transform.position;
		position += _character.center;
		position.y -= _character.height / 2f + _character.radius;
		float num = _character.radius - _character.skinWidth;
		if (EnableCollision && Physics.SphereCast(position, _character.radius, Vector3.up, out var hitInfo, cameraHeight + num, _character.gameObject.layer, QueryTriggerInteraction.Ignore))
		{
			_character.height = hitInfo.distance - _character.radius - _character.skinWidth;
			Transform obj = _character.transform;
			Vector3 position2 = obj.position;
			position2.y -= cameraHeight - hitInfo.distance + num;
			obj.position = position2;
		}
		else
		{
			_character.height = cameraHeight - _character.skinWidth;
		}
	}

	private void PreCharacterMovement()
	{
		if (_playerController.Teleported)
		{
			return;
		}
		Vector3 position = CameraRig.transform.position;
		Vector3 position2 = CameraRig.centerEyeAnchor.position;
		Vector3 vector = position2 - base.transform.position;
		vector.y = 0f;
		if (vector.magnitude > 0f)
		{
			_character.Move(vector);
			Vector3 vector2 = base.transform.position - position2;
			vector2.y = 0f;
			CurrentDistance = vector2.magnitude;
			CameraRig.transform.position = position;
			if (EnableCollision)
			{
				if (CurrentDistance > 0f)
				{
					CameraRig.transform.position = position - vector;
				}
				return;
			}
		}
		else
		{
			CurrentDistance = 0f;
		}
		Vector3 position3 = base.transform.position;
		position3 += _character.center;
		position3.y -= _character.height / 2f;
		float cameraHeight = _playerController.CameraHeight;
		if (Physics.SphereCast(position3, _character.radius, Vector3.up, out var hitInfo, cameraHeight, base.gameObject.layer, QueryTriggerInteraction.Ignore))
		{
			float distance = hitInfo.distance;
			distance = cameraHeight - distance;
			if (distance > CurrentDistance)
			{
				CurrentDistance = distance;
			}
		}
	}
}
public class LocomotionController : MonoBehaviour
{
	public OVRCameraRig CameraRig;

	public CharacterController CharacterController;

	public OVRPlayerController PlayerController;

	private void Start()
	{
		if (CharacterController == null)
		{
			CharacterController = GetComponentInParent<CharacterController>();
		}
		if (PlayerController == null)
		{
			PlayerController = GetComponentInParent<OVRPlayerController>();
		}
		if (CameraRig == null)
		{
			CameraRig = UnityEngine.Object.FindObjectOfType<OVRCameraRig>();
		}
	}
}
public class LocomotionTeleport : MonoBehaviour
{
	public enum States
	{
		Ready,
		Aim,
		CancelAim,
		PreTeleport,
		CancelTeleport,
		Teleporting,
		PostTeleport
	}

	public enum TeleportIntentions
	{
		None,
		Aim,
		PreTeleport,
		Teleport
	}

	public enum AimCollisionTypes
	{
		Point,
		Sphere,
		Capsule
	}

	public class AimData
	{
		public RaycastHit TargetHitInfo;

		public bool TargetValid;

		public Vector3? Destination;

		public float Radius;

		public List<Vector3> Points { get; private set; }

		public AimData()
		{
			Points = new List<Vector3>();
		}

		public void Reset()
		{
			Points.Clear();
			TargetValid = false;
			Destination = null;
		}
	}

	[Tooltip("Allow linear movement prior to the teleport system being activated.")]
	public bool EnableMovementDuringReady = true;

	[Tooltip("Allow linear movement while the teleport system is in the process of aiming for a teleport target.")]
	public bool EnableMovementDuringAim = true;

	[Tooltip("Allow linear movement while the teleport system is in the process of configuring the landing orientation.")]
	public bool EnableMovementDuringPreTeleport = true;

	[Tooltip("Allow linear movement after the teleport has occurred but before the system has returned to the ready state.")]
	public bool EnableMovementDuringPostTeleport = true;

	[Tooltip("Allow rotation prior to the teleport system being activated.")]
	public bool EnableRotationDuringReady = true;

	[Tooltip("Allow rotation while the teleport system is in the process of aiming for a teleport target.")]
	public bool EnableRotationDuringAim = true;

	[Tooltip("Allow rotation while the teleport system is in the process of configuring the landing orientation.")]
	public bool EnableRotationDuringPreTeleport = true;

	[Tooltip("Allow rotation after the teleport has occurred but before the system has returned to the ready state.")]
	public bool EnableRotationDuringPostTeleport = true;

	[NonSerialized]
	public TeleportAimHandler AimHandler;

	[Tooltip("This prefab will be instantiated as needed and updated to match the current aim target.")]
	public TeleportDestination TeleportDestinationPrefab;

	[NonSerialized]
	public TeleportInputHandler InputHandler;

	[NonSerialized]
	public TeleportIntentions CurrentIntention;

	[NonSerialized]
	public bool IsPreTeleportRequested;

	[NonSerialized]
	public bool IsTransitioning;

	[NonSerialized]
	public bool IsPostTeleportRequested;

	private TeleportDestination _teleportDestination;

	[Tooltip("When aiming at possible destinations, the aim collision type determines which shape to use for collision tests.")]
	public AimCollisionTypes AimCollisionType;

	[Tooltip("Use the character collision radius/height/skinwidth for sphere/capsule collision tests.")]
	public bool UseCharacterCollisionData;

	[Tooltip("Radius of the sphere or capsule used for collision testing when aiming to possible teleport destinations. Ignored if UseCharacterCollisionData is true.")]
	public float AimCollisionRadius;

	[Tooltip("Height of the capsule used for collision testing when aiming to possible teleport destinations. Ignored if UseCharacterCollisionData is true.")]
	public float AimCollisionHeight;

	public States CurrentState { get; private set; }

	public Quaternion DestinationRotation => _teleportDestination.OrientationIndicator.rotation;

	public LocomotionController LocomotionController { get; private set; }

	public event Action<bool, Vector3?, Quaternion?, Quaternion?> UpdateTeleportDestination;

	public event Action EnterStateReady;

	public event Action EnterStateAim;

	public event Action<AimData> UpdateAimData;

	public event Action ExitStateAim;

	public event Action EnterStateCancelAim;

	public event Action EnterStatePreTeleport;

	public event Action EnterStateCancelTeleport;

	public event Action EnterStateTeleporting;

	public event Action EnterStatePostTeleport;

	public event Action<Transform, Vector3, Quaternion> Teleported;

	public void EnableMovement(bool ready, bool aim, bool pre, bool post)
	{
		EnableMovementDuringReady = ready;
		EnableMovementDuringAim = aim;
		EnableMovementDuringPreTeleport = pre;
		EnableMovementDuringPostTeleport = post;
	}

	public void EnableRotation(bool ready, bool aim, bool pre, bool post)
	{
		EnableRotationDuringReady = ready;
		EnableRotationDuringAim = aim;
		EnableRotationDuringPreTeleport = pre;
		EnableRotationDuringPostTeleport = post;
	}

	public void OnUpdateTeleportDestination(bool isValidDestination, Vector3? position, Quaternion? rotation, Quaternion? landingRotation)
	{
		if (this.UpdateTeleportDestination != null)
		{
			this.UpdateTeleportDestination(isValidDestination, position, rotation, landingRotation);
		}
	}

	public bool AimCollisionTest(Vector3 start, Vector3 end, LayerMask aimCollisionLayerMask, out RaycastHit hitInfo)
	{
		Vector3 vector = end - start;
		float magnitude = vector.magnitude;
		Vector3 direction = vector / magnitude;
		switch (AimCollisionType)
		{
		case AimCollisionTypes.Capsule:
		{
			float num;
			float num2;
			if (UseCharacterCollisionData)
			{
				CharacterController characterController2 = LocomotionController.CharacterController;
				num = characterController2.height;
				num2 = characterController2.radius;
			}
			else
			{
				num = AimCollisionHeight;
				num2 = AimCollisionRadius;
			}
			return Physics.CapsuleCast(start + new Vector3(0f, num2, 0f), start + new Vector3(0f, num + num2, 0f), num2, direction, out hitInfo, magnitude, aimCollisionLayerMask, QueryTriggerInteraction.Ignore);
		}
		case AimCollisionTypes.Point:
			return Physics.Raycast(start, direction, out hitInfo, magnitude, aimCollisionLayerMask, QueryTriggerInteraction.Ignore);
		case AimCollisionTypes.Sphere:
		{
			float radius;
			if (UseCharacterCollisionData)
			{
				CharacterController characterController = LocomotionController.CharacterController;
				radius = characterController.radius - characterController.skinWidth;
			}
			else
			{
				radius = AimCollisionRadius;
			}
			return Physics.SphereCast(start, radius, direction, out hitInfo, magnitude, aimCollisionLayerMask, QueryTriggerInteraction.Ignore);
		}
		default:
			throw new Exception();
		}
	}

	[Conditional("DEBUG_TELEPORT_STATES")]
	protected void LogState(string msg)
	{
		UnityEngine.Debug.Log(Time.frameCount + ": " + msg);
	}

	protected void CreateNewTeleportDestination()
	{
		TeleportDestinationPrefab.gameObject.SetActive(value: false);
		TeleportDestination teleportDestination = UnityEngine.Object.Instantiate(TeleportDestinationPrefab);
		teleportDestination.LocomotionTeleport = this;
		_teleportDestination = teleportDestination;
		_teleportDestination.LocomotionTeleport = this;
	}

	private void DeactivateDestination()
	{
		_teleportDestination.OnDeactivated();
	}

	public void RecycleTeleportDestination(TeleportDestination oldDestination)
	{
		if (oldDestination == _teleportDestination)
		{
			CreateNewTeleportDestination();
		}
		UnityEngine.Object.Destroy(oldDestination.gameObject);
	}

	private void EnableMotion(bool enableLinear, bool enableRotation)
	{
		LocomotionController.PlayerController.EnableLinearMovement = enableLinear;
		LocomotionController.PlayerController.EnableRotation = enableRotation;
	}

	private void Awake()
	{
		LocomotionController = GetComponent<LocomotionController>();
		CreateNewTeleportDestination();
	}

	public virtual void OnEnable()
	{
		CurrentState = States.Ready;
		StartCoroutine(ReadyStateCoroutine());
	}

	protected IEnumerator ReadyStateCoroutine()
	{
		yield return null;
		CurrentState = States.Ready;
		EnableMotion(EnableMovementDuringReady, EnableRotationDuringReady);
		if (this.EnterStateReady != null)
		{
			this.EnterStateReady();
		}
		while (CurrentIntention != TeleportIntentions.Aim)
		{
			yield return null;
		}
		yield return null;
		StartCoroutine(AimStateCoroutine());
	}

	public void OnUpdateAimData(AimData aimData)
	{
		if (this.UpdateAimData != null)
		{
			this.UpdateAimData(aimData);
		}
	}

	protected IEnumerator AimStateCoroutine()
	{
		CurrentState = States.Aim;
		EnableMotion(EnableMovementDuringAim, EnableRotationDuringAim);
		if (this.EnterStateAim != null)
		{
			this.EnterStateAim();
		}
		_teleportDestination.gameObject.SetActive(value: true);
		while (CurrentIntention == TeleportIntentions.Aim)
		{
			yield return null;
		}
		if (this.ExitStateAim != null)
		{
			this.ExitStateAim();
		}
		yield return null;
		if ((CurrentIntention == TeleportIntentions.PreTeleport || CurrentIntention == TeleportIntentions.Teleport) && _teleportDestination.IsValidDestination)
		{
			StartCoroutine(PreTeleportStateCoroutine());
		}
		else
		{
			StartCoroutine(CancelAimStateCoroutine());
		}
	}

	protected IEnumerator CancelAimStateCoroutine()
	{
		CurrentState = States.CancelAim;
		if (this.EnterStateCancelAim != null)
		{
			this.EnterStateCancelAim();
		}
		DeactivateDestination();
		yield return null;
		StartCoroutine(ReadyStateCoroutine());
	}

	protected IEnumerator PreTeleportStateCoroutine()
	{
		CurrentState = States.PreTeleport;
		EnableMotion(EnableMovementDuringPreTeleport, EnableRotationDuringPreTeleport);
		if (this.EnterStatePreTeleport != null)
		{
			this.EnterStatePreTeleport();
		}
		while (CurrentIntention == TeleportIntentions.PreTeleport || IsPreTeleportRequested)
		{
			yield return null;
		}
		if (_teleportDestination.IsValidDestination)
		{
			StartCoroutine(TeleportingStateCoroutine());
		}
		else
		{
			StartCoroutine(CancelTeleportStateCoroutine());
		}
	}

	protected IEnumerator CancelTeleportStateCoroutine()
	{
		CurrentState = States.CancelTeleport;
		if (this.EnterStateCancelTeleport != null)
		{
			this.EnterStateCancelTeleport();
		}
		DeactivateDestination();
		yield return null;
		StartCoroutine(ReadyStateCoroutine());
	}

	protected IEnumerator TeleportingStateCoroutine()
	{
		CurrentState = States.Teleporting;
		EnableMotion(enableLinear: false, enableRotation: false);
		if (this.EnterStateTeleporting != null)
		{
			this.EnterStateTeleporting();
		}
		while (IsTransitioning)
		{
			yield return null;
		}
		yield return null;
		StartCoroutine(PostTeleportStateCoroutine());
	}

	protected IEnumerator PostTeleportStateCoroutine()
	{
		CurrentState = States.PostTeleport;
		EnableMotion(EnableMovementDuringPostTeleport, EnableRotationDuringPostTeleport);
		if (this.EnterStatePostTeleport != null)
		{
			this.EnterStatePostTeleport();
		}
		while (IsPostTeleportRequested)
		{
			yield return null;
		}
		DeactivateDestination();
		yield return null;
		StartCoroutine(ReadyStateCoroutine());
	}

	public void DoTeleport()
	{
		CharacterController characterController = LocomotionController.CharacterController;
		Transform transform = characterController.transform;
		Vector3 position = _teleportDestination.OrientationIndicator.position;
		position.y += characterController.height * 0.5f;
		Quaternion landingRotation = _teleportDestination.LandingRotation;
		if (this.Teleported != null)
		{
			this.Teleported(transform, position, landingRotation);
		}
		transform.position = position;
		transform.rotation = landingRotation;
		LocomotionController.PlayerController.Teleported = true;
	}

	public Vector3 GetCharacterPosition()
	{
		return LocomotionController.CharacterController.transform.position;
	}

	public Quaternion GetHeadRotationY()
	{
		Quaternion rotation = Quaternion.identity;
		List<XRNodeState> list = new List<XRNodeState>();
		InputTracking.GetNodeStates(list);
		foreach (XRNodeState item in list)
		{
			if (item.nodeType == XRNode.Head)
			{
				item.TryGetRotation(out rotation);
				break;
			}
		}
		Vector3 eulerAngles = rotation.eulerAngles;
		eulerAngles.x = 0f;
		eulerAngles.z = 0f;
		return Quaternion.Euler(eulerAngles);
	}

	public void DoWarp(Vector3 startPos, float positionPercent)
	{
		Vector3 position = _teleportDestination.OrientationIndicator.position;
		position.y += LocomotionController.CharacterController.height / 2f;
		Transform obj = LocomotionController.CharacterController.transform;
		Vector3 position2 = Vector3.Lerp(startPos, position, positionPercent);
		obj.position = position2;
		LocomotionController.PlayerController.Teleported = true;
	}
}
public abstract class TeleportAimHandler : TeleportSupport
{
	protected override void OnEnable()
	{
		base.OnEnable();
		base.LocomotionTeleport.AimHandler = this;
	}

	protected override void OnDisable()
	{
		if (base.LocomotionTeleport.AimHandler == this)
		{
			base.LocomotionTeleport.AimHandler = null;
		}
		base.OnDisable();
	}

	public abstract void GetPoints(List<Vector3> points);
}
public class TeleportAimHandlerLaser : TeleportAimHandler
{
	[Tooltip("Maximum range for aiming.")]
	public float Range = 100f;

	public override void GetPoints(List<Vector3> points)
	{
		base.LocomotionTeleport.InputHandler.GetAimData(out var aimRay);
		points.Add(aimRay.origin);
		points.Add(aimRay.origin + aimRay.direction * Range);
	}
}
public class TeleportAimHandlerParabolic : TeleportAimHandler
{
	[Tooltip("Maximum range for aiming.")]
	public float Range;

	[Tooltip("The MinimumElevation is relative to the AimPosition.")]
	public float MinimumElevation = -100f;

	[Tooltip("The Gravity is used in conjunction with AimVelocity and the aim direction to simulate a projectile.")]
	public float Gravity = -9.8f;

	[Tooltip("The AimVelocity is the initial speed of the faked projectile.")]
	[Range(0.001f, 50f)]
	public float AimVelocity = 1f;

	[Tooltip("The AimStep is the how much to subdivide the iteration.")]
	[Range(0.001f, 1f)]
	public float AimStep = 1f;

	public override void GetPoints(List<Vector3> points)
	{
		base.LocomotionTeleport.InputHandler.GetAimData(out var aimRay);
		Vector3 origin = aimRay.origin;
		Vector3 vector = aimRay.direction * AimVelocity;
		float num = Range * Range;
		do
		{
			points.Add(origin);
			Vector3 vector2 = vector;
			vector2.y += Gravity * (1f / 90f) * AimStep;
			vector = vector2;
			origin += vector2 * AimStep;
		}
		while (origin.y - aimRay.origin.y > MinimumElevation && (aimRay.origin - origin).sqrMagnitude <= num);
	}
}
public class TeleportAimVisualLaser : TeleportSupport
{
	[Tooltip("This prefab will be instantiated when the aim visual is awakened, and will be set active when the user is aiming, and deactivated when they are done aiming.")]
	public LineRenderer LaserPrefab;

	private readonly Action _enterAimStateAction;

	private readonly Action _exitAimStateAction;

	private readonly Action<LocomotionTeleport.AimData> _updateAimDataAction;

	private LineRenderer _lineRenderer;

	private Vector3[] _linePoints;

	public TeleportAimVisualLaser()
	{
		_enterAimStateAction = EnterAimState;
		_exitAimStateAction = ExitAimState;
		_updateAimDataAction = UpdateAimData;
	}

	private void EnterAimState()
	{
		_lineRenderer.gameObject.SetActive(value: true);
	}

	private void ExitAimState()
	{
		_lineRenderer.gameObject.SetActive(value: false);
	}

	private void Awake()
	{
		LaserPrefab.gameObject.SetActive(value: false);
		_lineRenderer = UnityEngine.Object.Instantiate(LaserPrefab);
	}

	protected override void AddEventHandlers()
	{
		base.AddEventHandlers();
		base.LocomotionTeleport.EnterStateAim += _enterAimStateAction;
		base.LocomotionTeleport.ExitStateAim += _exitAimStateAction;
		base.LocomotionTeleport.UpdateAimData += _updateAimDataAction;
	}

	protected override void RemoveEventHandlers()
	{
		base.LocomotionTeleport.EnterStateAim -= _enterAimStateAction;
		base.LocomotionTeleport.ExitStateAim -= _exitAimStateAction;
		base.LocomotionTeleport.UpdateAimData -= _updateAimDataAction;
		base.RemoveEventHandlers();
	}

	private void UpdateAimData(LocomotionTeleport.AimData obj)
	{
		_lineRenderer.sharedMaterial.color = (obj.TargetValid ? Color.green : Color.red);
		List<Vector3> points = obj.Points;
		_lineRenderer.positionCount = points.Count;
		for (int i = 0; i < points.Count; i++)
		{
			_lineRenderer.SetPosition(i, points[i]);
		}
	}
}
public class TeleportDestination : MonoBehaviour
{
	[Tooltip("If the target handler provides a target position, this transform will be moved to that position and it's game object enabled. A target position being provided does not mean the position is valid, only that the aim handler found something to test as a destination.")]
	public Transform PositionIndicator;

	[Tooltip("This transform will be rotated to match the rotation of the aiming target. Simple teleport destinations should assign this to the object containing this component. More complex teleport destinations might assign this to a sub-object that is used to indicate the landing orientation independently from the rest of the destination indicator, such as when world space effects are required. This will typically be a child of the PositionIndicator.")]
	public Transform OrientationIndicator;

	[Tooltip("After the player teleports, the character controller will have it's rotation set to this value. It is different from the OrientationIndicator transform.rotation in order to support both head-relative and forward-facing teleport modes (See TeleportOrientationHandlerThumbstick.cs).")]
	public Quaternion LandingRotation;

	[NonSerialized]
	public LocomotionTeleport LocomotionTeleport;

	[NonSerialized]
	public LocomotionTeleport.States TeleportState;

	private readonly Action<bool, Vector3?, Quaternion?, Quaternion?> _updateTeleportDestinationAction;

	private bool _eventsActive;

	public bool IsValidDestination { get; private set; }

	public event Action<TeleportDestination> Deactivated;

	private TeleportDestination()
	{
		_updateTeleportDestinationAction = UpdateTeleportDestination;
	}

	public void OnEnable()
	{
		PositionIndicator.gameObject.SetActive(value: false);
		if (OrientationIndicator != null)
		{
			OrientationIndicator.gameObject.SetActive(value: false);
		}
		LocomotionTeleport.UpdateTeleportDestination += _updateTeleportDestinationAction;
		_eventsActive = true;
	}

	private void TryDisableEventHandlers()
	{
		if (_eventsActive)
		{
			LocomotionTeleport.UpdateTeleportDestination -= _updateTeleportDestinationAction;
			_eventsActive = false;
		}
	}

	public void OnDisable()
	{
		TryDisableEventHandlers();
	}

	public void OnDeactivated()
	{
		if (this.Deactivated != null)
		{
			this.Deactivated(this);
		}
		else
		{
			Recycle();
		}
	}

	public void Recycle()
	{
		LocomotionTeleport.RecycleTeleportDestination(this);
	}

	public virtual void UpdateTeleportDestination(bool isValidDestination, Vector3? position, Quaternion? rotation, Quaternion? landingRotation)
	{
		IsValidDestination = isValidDestination;
		LandingRotation = landingRotation.GetValueOrDefault();
		GameObject gameObject = PositionIndicator.gameObject;
		bool activeInHierarchy = gameObject.activeInHierarchy;
		if (!position.HasValue)
		{
			if (activeInHierarchy)
			{
				gameObject.SetActive(value: false);
			}
			return;
		}
		if (!activeInHierarchy)
		{
			gameObject.SetActive(value: true);
		}
		base.transform.position = position.GetValueOrDefault();
		if (OrientationIndicator == null)
		{
			if (rotation.HasValue)
			{
				base.transform.rotation = rotation.GetValueOrDefault();
			}
			return;
		}
		GameObject gameObject2 = OrientationIndicator.gameObject;
		bool activeInHierarchy2 = gameObject2.activeInHierarchy;
		if (!rotation.HasValue)
		{
			if (activeInHierarchy2)
			{
				gameObject2.SetActive(value: false);
			}
			return;
		}
		OrientationIndicator.rotation = rotation.GetValueOrDefault();
		if (!activeInHierarchy2)
		{
			gameObject2.SetActive(value: true);
		}
	}
}
public abstract class TeleportInputHandler : TeleportSupport
{
	private readonly Action _startReadyAction;

	private readonly Action _startAimAction;

	protected TeleportInputHandler()
	{
		_startReadyAction = delegate
		{
			StartCoroutine(TeleportReadyCoroutine());
		};
		_startAimAction = delegate
		{
			StartCoroutine(TeleportAimCoroutine());
		};
	}

	protected override void AddEventHandlers()
	{
		base.LocomotionTeleport.InputHandler = this;
		base.AddEventHandlers();
		base.LocomotionTeleport.EnterStateReady += _startReadyAction;
		base.LocomotionTeleport.EnterStateAim += _startAimAction;
	}

	protected override void RemoveEventHandlers()
	{
		if (base.LocomotionTeleport.InputHandler == this)
		{
			base.LocomotionTeleport.InputHandler = null;
		}
		base.LocomotionTeleport.EnterStateReady -= _startReadyAction;
		base.LocomotionTeleport.EnterStateAim -= _startAimAction;
		base.RemoveEventHandlers();
	}

	private IEnumerator TeleportReadyCoroutine()
	{
		while (GetIntention() != LocomotionTeleport.TeleportIntentions.Aim)
		{
			yield return null;
		}
		base.LocomotionTeleport.CurrentIntention = LocomotionTeleport.TeleportIntentions.Aim;
	}

	private IEnumerator TeleportAimCoroutine()
	{
		LocomotionTeleport.TeleportIntentions intention = GetIntention();
		while (intention == LocomotionTeleport.TeleportIntentions.Aim || intention == LocomotionTeleport.TeleportIntentions.PreTeleport)
		{
			base.LocomotionTeleport.CurrentIntention = intention;
			yield return null;
			intention = GetIntention();
		}
		base.LocomotionTeleport.CurrentIntention = intention;
	}

	public abstract LocomotionTeleport.TeleportIntentions GetIntention();

	public abstract void GetAimData(out Ray aimRay);
}
public class TeleportInputHandlerAvatarTouch : TeleportInputHandlerHMD
{
	public enum InputModes
	{
		CapacitiveButtonForAimAndTeleport,
		SeparateButtonsForAimAndTeleport,
		ThumbstickTeleport,
		ThumbstickTeleportForwardBackOnly
	}

	public enum AimCapTouchButtons
	{
		A,
		B,
		LeftTrigger,
		LeftThumbstick,
		RightTrigger,
		RightThumbstick,
		X,
		Y
	}

	[Tooltip("This needs to be assigned a reference to the OvrAvatar for the local player. The code will search for an avatar if this is null, but it's suggested to assign it in the editor.")]
	public OvrAvatar Avatar;

	[Tooltip("CapacitiveButtonForAimAndTeleport=Activate aiming via cap touch detection, press the same button to teleport.\nSeparateButtonsForAimAndTeleport=Use one button to begin aiming, and another to trigger the teleport.\nThumbstickTeleport=Push a thumbstick to begin aiming, release to teleport.")]
	public InputModes InputMode;

	private readonly OVRInput.RawButton[] _rawButtons = new OVRInput.RawButton[8]
	{
		OVRInput.RawButton.A,
		OVRInput.RawButton.B,
		OVRInput.RawButton.LIndexTrigger,
		OVRInput.RawButton.LThumbstick,
		OVRInput.RawButton.RIndexTrigger,
		OVRInput.RawButton.RThumbstick,
		OVRInput.RawButton.X,
		OVRInput.RawButton.Y
	};

	private readonly OVRInput.RawTouch[] _rawTouch = new OVRInput.RawTouch[8]
	{
		OVRInput.RawTouch.A,
		OVRInput.RawTouch.B,
		OVRInput.RawTouch.LIndexTrigger,
		OVRInput.RawTouch.LThumbstick,
		OVRInput.RawTouch.RIndexTrigger,
		OVRInput.RawTouch.RThumbstick,
		OVRInput.RawTouch.X,
		OVRInput.RawTouch.Y
	};

	[Tooltip("Select the controller to be used for aiming. Supports LTouch, RTouch, or Touch for either.")]
	public OVRInput.Controller AimingController;

	private OVRInput.Controller InitiatingController;

	[Tooltip("Select the button to use for triggering aim and teleport when InputMode==CapacitiveButtonForAimAndTeleport")]
	public AimCapTouchButtons CapacitiveAimAndTeleportButton;

	[Tooltip("The thumbstick magnitude required to trigger aiming and teleports when InputMode==InputModes.ThumbstickTeleport")]
	public float ThumbstickTeleportThreshold = 0.5f;

	private void Start()
	{
		if (Avatar == null)
		{
			UnityEngine.Debug.LogWarning("Avatar not assigned. Searching hierarchy. Please configure the Avatar before running to improve performance.");
			Avatar = UnityEngine.Object.FindObjectOfType<OvrAvatar>();
		}
	}

	public override LocomotionTeleport.TeleportIntentions GetIntention()
	{
		if (!base.isActiveAndEnabled)
		{
			return LocomotionTeleport.TeleportIntentions.None;
		}
		if (InputMode == InputModes.SeparateButtonsForAimAndTeleport)
		{
			return base.GetIntention();
		}
		if (InputMode == InputModes.ThumbstickTeleport || InputMode == InputModes.ThumbstickTeleportForwardBackOnly)
		{
			Vector2 lhs = OVRInput.Get(OVRInput.RawAxis2D.LThumbstick);
			Vector2 lhs2 = OVRInput.Get(OVRInput.RawAxis2D.RThumbstick);
			float num = 0f;
			float num2 = 0f;
			float num3 = 0f;
			OVRInput.Controller controller = OVRInput.Controller.Touch;
			bool flag = OVRInput.Get(OVRInput.RawTouch.LThumbstick);
			bool flag2 = OVRInput.Get(OVRInput.RawTouch.RThumbstick);
			if (InputMode == InputModes.ThumbstickTeleportForwardBackOnly && base.LocomotionTeleport.CurrentIntention != LocomotionTeleport.TeleportIntentions.Aim)
			{
				num = Mathf.Abs(Vector2.Dot(lhs, Vector2.up));
				num2 = Mathf.Abs(Vector2.Dot(lhs2, Vector2.up));
			}
			else
			{
				num = lhs.magnitude;
				num2 = lhs2.magnitude;
			}
			if (AimingController == OVRInput.Controller.LTouch)
			{
				num3 = num;
				controller = OVRInput.Controller.LTouch;
			}
			else if (AimingController == OVRInput.Controller.RTouch)
			{
				num3 = num2;
				controller = OVRInput.Controller.RTouch;
			}
			else if (num > num2)
			{
				num3 = num;
				controller = OVRInput.Controller.LTouch;
			}
			else
			{
				num3 = num2;
				controller = OVRInput.Controller.RTouch;
			}
			if (!(num3 > ThumbstickTeleportThreshold) && (AimingController != OVRInput.Controller.Touch || !(flag || flag2)) && !(AimingController == OVRInput.Controller.LTouch && flag) && !(AimingController == OVRInput.Controller.RTouch && flag2))
			{
				if (base.LocomotionTeleport.CurrentIntention == LocomotionTeleport.TeleportIntentions.Aim)
				{
					if (!FastTeleport)
					{
						return LocomotionTeleport.TeleportIntentions.PreTeleport;
					}
					return LocomotionTeleport.TeleportIntentions.Teleport;
				}
				if (base.LocomotionTeleport.CurrentIntention == LocomotionTeleport.TeleportIntentions.PreTeleport)
				{
					return LocomotionTeleport.TeleportIntentions.Teleport;
				}
			}
			else if (base.LocomotionTeleport.CurrentIntention == LocomotionTeleport.TeleportIntentions.Aim)
			{
				return LocomotionTeleport.TeleportIntentions.Aim;
			}
			if (num3 > ThumbstickTeleportThreshold)
			{
				InitiatingController = controller;
				return LocomotionTeleport.TeleportIntentions.Aim;
			}
			return LocomotionTeleport.TeleportIntentions.None;
		}
		OVRInput.RawButton rawMask = _rawButtons[(int)CapacitiveAimAndTeleportButton];
		if (base.LocomotionTeleport.CurrentIntention == LocomotionTeleport.TeleportIntentions.Aim && OVRInput.GetDown(rawMask))
		{
			if (!FastTeleport)
			{
				return LocomotionTeleport.TeleportIntentions.PreTeleport;
			}
			return LocomotionTeleport.TeleportIntentions.Teleport;
		}
		if (base.LocomotionTeleport.CurrentIntention == LocomotionTeleport.TeleportIntentions.PreTeleport)
		{
			if (FastTeleport || OVRInput.GetUp(rawMask))
			{
				return LocomotionTeleport.TeleportIntentions.Teleport;
			}
			return LocomotionTeleport.TeleportIntentions.PreTeleport;
		}
		if (OVRInput.GetDown(_rawTouch[(int)CapacitiveAimAndTeleportButton]))
		{
			return LocomotionTeleport.TeleportIntentions.Aim;
		}
		if (base.LocomotionTeleport.CurrentIntention == LocomotionTeleport.TeleportIntentions.Aim && !OVRInput.GetUp(_rawTouch[(int)CapacitiveAimAndTeleportButton]))
		{
			return LocomotionTeleport.TeleportIntentions.Aim;
		}
		return LocomotionTeleport.TeleportIntentions.None;
	}

	public override void GetAimData(out Ray aimRay)
	{
		OVRInput.Controller controller = AimingController;
		if (controller == OVRInput.Controller.Touch)
		{
			controller = InitiatingController;
		}
		Transform transform = ((controller == OVRInput.Controller.LTouch) ? Avatar.ControllerLeft.transform : Avatar.ControllerRight.transform);
		aimRay = new Ray(transform.position, transform.forward);
	}
}
public class TeleportInputHandlerHMD : TeleportInputHandler
{
	[Tooltip("The button used to begin aiming for a teleport.")]
	public OVRInput.RawButton AimButton;

	[Tooltip("The button used to trigger the teleport after aiming. It can be the same button as the AimButton, however you cannot abort a teleport if it is.")]
	public OVRInput.RawButton TeleportButton;

	[Tooltip("When true, the system will not use the PreTeleport intention which will allow a teleport to occur on a button downpress. When false, the button downpress will trigger the PreTeleport intention and the Teleport intention when the button is released.")]
	public bool FastTeleport;

	public Transform Pointer { get; private set; }

	public override LocomotionTeleport.TeleportIntentions GetIntention()
	{
		if (!base.isActiveAndEnabled)
		{
			return LocomotionTeleport.TeleportIntentions.None;
		}
		if (base.LocomotionTeleport.CurrentIntention == LocomotionTeleport.TeleportIntentions.Aim && OVRInput.GetDown(TeleportButton))
		{
			if (!FastTeleport)
			{
				return LocomotionTeleport.TeleportIntentions.PreTeleport;
			}
			return LocomotionTeleport.TeleportIntentions.Teleport;
		}
		if (base.LocomotionTeleport.CurrentIntention == LocomotionTeleport.TeleportIntentions.PreTeleport)
		{
			if (OVRInput.GetUp(TeleportButton))
			{
				return LocomotionTeleport.TeleportIntentions.Teleport;
			}
			return LocomotionTeleport.TeleportIntentions.PreTeleport;
		}
		if (OVRInput.Get(AimButton))
		{
			return LocomotionTeleport.TeleportIntentions.Aim;
		}
		if (AimButton == TeleportButton)
		{
			return LocomotionTeleport.TeleportIntentions.Teleport;
		}
		return LocomotionTeleport.TeleportIntentions.None;
	}

	public override void GetAimData(out Ray aimRay)
	{
		Transform centerEyeAnchor = base.LocomotionTeleport.LocomotionController.CameraRig.centerEyeAnchor;
		aimRay = new Ray(centerEyeAnchor.position, centerEyeAnchor.forward);
	}
}
public abstract class TeleportOrientationHandler : TeleportSupport
{
	public enum OrientationModes
	{
		HeadRelative,
		ForwardFacing
	}

	private readonly Action _updateOrientationAction;

	private readonly Action<LocomotionTeleport.AimData> _updateAimDataAction;

	protected LocomotionTeleport.AimData AimData;

	protected TeleportOrientationHandler()
	{
		_updateOrientationAction = delegate
		{
			StartCoroutine(UpdateOrientationCoroutine());
		};
		_updateAimDataAction = UpdateAimData;
	}

	private void UpdateAimData(LocomotionTeleport.AimData aimData)
	{
		AimData = aimData;
	}

	protected override void AddEventHandlers()
	{
		base.AddEventHandlers();
		base.LocomotionTeleport.EnterStateAim += _updateOrientationAction;
		base.LocomotionTeleport.UpdateAimData += _updateAimDataAction;
	}

	protected override void RemoveEventHandlers()
	{
		base.RemoveEventHandlers();
		base.LocomotionTeleport.EnterStateAim -= _updateOrientationAction;
		base.LocomotionTeleport.UpdateAimData -= _updateAimDataAction;
	}

	private IEnumerator UpdateOrientationCoroutine()
	{
		InitializeTeleportDestination();
		while (base.LocomotionTeleport.CurrentState == LocomotionTeleport.States.Aim || base.LocomotionTeleport.CurrentState == LocomotionTeleport.States.PreTeleport)
		{
			if (AimData != null)
			{
				UpdateTeleportDestination();
			}
			yield return null;
		}
	}

	protected abstract void InitializeTeleportDestination();

	protected abstract void UpdateTeleportDestination();

	protected Quaternion GetLandingOrientation(OrientationModes mode, Quaternion rotation)
	{
		if (mode != 0)
		{
			return rotation * Quaternion.Euler(0f, 0f - base.LocomotionTeleport.LocomotionController.CameraRig.trackingSpace.localEulerAngles.y, 0f);
		}
		return rotation;
	}
}
public class TeleportOrientationHandler360 : TeleportOrientationHandler
{
	protected override void InitializeTeleportDestination()
	{
	}

	protected override void UpdateTeleportDestination()
	{
		base.LocomotionTeleport.OnUpdateTeleportDestination(AimData.TargetValid, AimData.Destination, null, null);
	}
}
public class TeleportOrientationHandlerHMD : TeleportOrientationHandler
{
	[Tooltip("HeadRelative=Character will orient to match the arrow. ForwardFacing=When user orients to match the arrow, they will be facing the sensors.")]
	public OrientationModes OrientationMode;

	[Tooltip("Should the destination orientation be updated during the aim state in addition to the PreTeleport state?")]
	public bool UpdateOrientationDuringAim;

	[Tooltip("How far from the destination must the HMD be pointing before using it for orientation")]
	public float AimDistanceThreshold;

	[Tooltip("How far from the destination must the HMD be pointing before rejecting the teleport")]
	public float AimDistanceMaxRange;

	private Quaternion _initialRotation;

	protected override void InitializeTeleportDestination()
	{
		_initialRotation = Quaternion.identity;
	}

	protected override void UpdateTeleportDestination()
	{
		if (AimData.Destination.HasValue && (UpdateOrientationDuringAim || base.LocomotionTeleport.CurrentState == LocomotionTeleport.States.PreTeleport))
		{
			Transform centerEyeAnchor = base.LocomotionTeleport.LocomotionController.CameraRig.centerEyeAnchor;
			Vector3 valueOrDefault = AimData.Destination.GetValueOrDefault();
			if (new Plane(Vector3.up, valueOrDefault).Raycast(new Ray(centerEyeAnchor.position, centerEyeAnchor.forward), out var enter))
			{
				Vector3 vector = centerEyeAnchor.position + centerEyeAnchor.forward * enter - valueOrDefault;
				vector.y = 0f;
				float magnitude = vector.magnitude;
				if (magnitude > AimDistanceThreshold)
				{
					vector.Normalize();
					Quaternion quaternion = (_initialRotation = Quaternion.LookRotation(new Vector3(vector.x, 0f, vector.z), Vector3.up));
					if (AimDistanceMaxRange > 0f && magnitude > AimDistanceMaxRange)
					{
						AimData.TargetValid = false;
					}
					base.LocomotionTeleport.OnUpdateTeleportDestination(AimData.TargetValid, AimData.Destination, quaternion, GetLandingOrientation(OrientationMode, quaternion));
					return;
				}
			}
		}
		base.LocomotionTeleport.OnUpdateTeleportDestination(AimData.TargetValid, AimData.Destination, _initialRotation, GetLandingOrientation(OrientationMode, _initialRotation));
	}
}
public class TeleportOrientationHandlerThumbstick : TeleportOrientationHandler
{
	[Tooltip("HeadRelative=Character will orient to match the arrow. ForwardFacing=When user orients to match the arrow, they will be facing the sensors.")]
	public OrientationModes OrientationMode;

	[Tooltip("Which thumbstick is to be used for adjusting the teleport orientation. Supports LTouch, RTouch, or Touch for either.")]
	public OVRInput.Controller Thumbstick;

	[Tooltip("The orientation will only change if the thumbstick magnitude is above this value. This will usually be larger than the TeleportInputHandlerAvatarTouch.ThumbstickTeleportThreshold.")]
	public float RotateStickThreshold = 0.8f;

	private Quaternion _initialRotation;

	private Quaternion _currentRotation;

	private Vector2 _lastValidDirection;

	protected override void InitializeTeleportDestination()
	{
		_initialRotation = base.LocomotionTeleport.GetHeadRotationY();
		_currentRotation = _initialRotation;
		_lastValidDirection = default(Vector2);
	}

	protected override void UpdateTeleportDestination()
	{
		float num;
		Vector2 lastValidDirection;
		if (Thumbstick == OVRInput.Controller.Touch)
		{
			Vector2 vector = OVRInput.Get(OVRInput.RawAxis2D.LThumbstick);
			Vector2 vector2 = OVRInput.Get(OVRInput.RawAxis2D.RThumbstick);
			float magnitude = vector.magnitude;
			float magnitude2 = vector2.magnitude;
			if (magnitude > magnitude2)
			{
				num = magnitude;
				lastValidDirection = vector;
			}
			else
			{
				num = magnitude2;
				lastValidDirection = vector2;
			}
		}
		else
		{
			lastValidDirection = ((Thumbstick != OVRInput.Controller.LTouch) ? OVRInput.Get(OVRInput.RawAxis2D.RThumbstick) : OVRInput.Get(OVRInput.RawAxis2D.LThumbstick));
			num = lastValidDirection.magnitude;
		}
		if (!AimData.TargetValid)
		{
			_lastValidDirection = default(Vector2);
		}
		if (num < RotateStickThreshold)
		{
			lastValidDirection = _lastValidDirection;
			num = lastValidDirection.magnitude;
			if (num < RotateStickThreshold)
			{
				_initialRotation = base.LocomotionTeleport.GetHeadRotationY();
				lastValidDirection.x = 0f;
				lastValidDirection.y = 1f;
			}
		}
		else
		{
			_lastValidDirection = lastValidDirection;
		}
		Quaternion rotation = base.LocomotionTeleport.LocomotionController.CameraRig.trackingSpace.rotation;
		if (num > RotateStickThreshold)
		{
			lastValidDirection /= num;
			Quaternion quaternion = _initialRotation * Quaternion.LookRotation(new Vector3(lastValidDirection.x, 0f, lastValidDirection.y), Vector3.up);
			_currentRotation = rotation * quaternion;
		}
		else
		{
			_currentRotation = rotation * base.LocomotionTeleport.GetHeadRotationY();
		}
		base.LocomotionTeleport.OnUpdateTeleportDestination(AimData.TargetValid, AimData.Destination, _currentRotation, GetLandingOrientation(OrientationMode, _currentRotation));
	}
}
public class TeleportPoint : MonoBehaviour
{
	public float dimmingSpeed = 1f;

	public float fullIntensity = 1f;

	public float lowIntensity = 0.5f;

	public Transform destTransform;

	private float lastLookAtTime;

	private void Start()
	{
	}

	public Transform GetDestTransform()
	{
		return destTransform;
	}

	private void Update()
	{
		float value = Mathf.SmoothStep(fullIntensity, lowIntensity, (Time.time - lastLookAtTime) * dimmingSpeed);
		GetComponent<MeshRenderer>().material.SetFloat("_Intensity", value);
	}

	public void OnLookAt()
	{
		lastLookAtTime = Time.time;
	}
}
public abstract class TeleportSupport : MonoBehaviour
{
	private bool _eventsActive;

	protected LocomotionTeleport LocomotionTeleport { get; private set; }

	protected virtual void OnEnable()
	{
		LocomotionTeleport = GetComponent<LocomotionTeleport>();
		AddEventHandlers();
	}

	protected virtual void OnDisable()
	{
		RemoveEventHandlers();
		LocomotionTeleport = null;
	}

	[Conditional("DEBUG_TELEPORT_EVENT_HANDLERS")]
	private void LogEventHandler(string msg)
	{
		UnityEngine.Debug.Log("EventHandler: " + GetType().Name + ": " + msg);
	}

	protected virtual void AddEventHandlers()
	{
		_eventsActive = true;
	}

	protected virtual void RemoveEventHandlers()
	{
		_eventsActive = false;
	}
}
public abstract class TeleportTargetHandler : TeleportSupport
{
	[Tooltip("This bitmask controls which game object layers will be included in the targeting collision tests.")]
	public LayerMask AimCollisionLayerMask;

	protected readonly LocomotionTeleport.AimData AimData = new LocomotionTeleport.AimData();

	private readonly Action _startAimAction;

	private readonly List<Vector3> _aimPoints = new List<Vector3>();

	protected TeleportTargetHandler()
	{
		_startAimAction = delegate
		{
			StartCoroutine(TargetAimCoroutine());
		};
	}

	protected override void AddEventHandlers()
	{
		base.AddEventHandlers();
		base.LocomotionTeleport.EnterStateAim += _startAimAction;
	}

	protected override void RemoveEventHandlers()
	{
		base.RemoveEventHandlers();
		base.LocomotionTeleport.EnterStateAim -= _startAimAction;
	}

	private IEnumerator TargetAimCoroutine()
	{
		while (base.LocomotionTeleport.CurrentState == LocomotionTeleport.States.Aim)
		{
			ResetAimData();
			Vector3 start = base.LocomotionTeleport.transform.position;
			_aimPoints.Clear();
			base.LocomotionTeleport.AimHandler.GetPoints(_aimPoints);
			for (int i = 0; i < _aimPoints.Count; i++)
			{
				Vector3 end = _aimPoints[i];
				AimData.TargetValid = ConsiderTeleport(start, ref end);
				AimData.Points.Add(end);
				if (AimData.TargetValid)
				{
					AimData.Destination = ConsiderDestination(end);
					AimData.TargetValid = AimData.Destination.HasValue;
					break;
				}
				start = _aimPoints[i];
			}
			base.LocomotionTeleport.OnUpdateAimData(AimData);
			yield return null;
		}
	}

	protected virtual void ResetAimData()
	{
		AimData.Reset();
	}

	protected abstract bool ConsiderTeleport(Vector3 start, ref Vector3 end);

	public virtual Vector3? ConsiderDestination(Vector3 location)
	{
		CharacterController characterController = base.LocomotionTeleport.LocomotionController.CharacterController;
		float num = characterController.radius - characterController.skinWidth;
		float skinWidth = characterController.skinWidth;
		Vector3 vector = location;
		vector.y += num + skinWidth;
		Vector3 end = vector;
		end.y += characterController.height - skinWidth;
		if (Physics.CheckCapsule(vector, end, num, AimCollisionLayerMask, QueryTriggerInteraction.Ignore))
		{
			return null;
		}
		return location;
	}
}
public class TeleportTargetHandlerNavMesh : TeleportTargetHandler
{
	public int NavMeshAreaMask = -1;

	private NavMeshPath _path;

	private void Awake()
	{
		_path = new NavMeshPath();
	}

	protected override bool ConsiderTeleport(Vector3 start, ref Vector3 end)
	{
		if (base.LocomotionTeleport.AimCollisionTest(start, end, AimCollisionLayerMask, out AimData.TargetHitInfo))
		{
			Vector3 normalized = (end - start).normalized;
			end = start + normalized * AimData.TargetHitInfo.distance;
			return true;
		}
		return false;
	}

	public override Vector3? ConsiderDestination(Vector3 location)
	{
		Vector3? result = base.ConsiderDestination(location);
		if (result.HasValue)
		{
			Vector3 characterPosition = base.LocomotionTeleport.GetCharacterPosition();
			Vector3 valueOrDefault = result.GetValueOrDefault();
			NavMesh.CalculatePath(characterPosition, valueOrDefault, NavMeshAreaMask, _path);
			if (_path.status == NavMeshPathStatus.PathComplete)
			{
				return result;
			}
		}
		return null;
	}

	[Conditional("SHOW_PATH_RESULT")]
	private void OnDrawGizmos()
	{
	}
}
public class TeleportTargetHandlerNode : TeleportTargetHandler
{
	[Tooltip("When checking line of sight to the destination, add this value to the vertical offset for targeting collision checks.")]
	public float LOSOffset = 1f;

	[Tooltip("Teleport logic will only work with TeleportPoint components that exist in the layers specified by this mask.")]
	public LayerMask TeleportLayerMask;

	protected override bool ConsiderTeleport(Vector3 start, ref Vector3 end)
	{
		if (!base.LocomotionTeleport.AimCollisionTest(start, end, (int)AimCollisionLayerMask | (int)TeleportLayerMask, out AimData.TargetHitInfo))
		{
			return false;
		}
		TeleportPoint component = AimData.TargetHitInfo.collider.gameObject.GetComponent<TeleportPoint>();
		if (component == null)
		{
			return false;
		}
		Vector3 position = component.destTransform.position;
		Vector3 end2 = new Vector3(position.x, position.y + LOSOffset, position.z);
		if (base.LocomotionTeleport.AimCollisionTest(start, end2, (int)AimCollisionLayerMask & ~(int)TeleportLayerMask, out AimData.TargetHitInfo))
		{
			return false;
		}
		end = position;
		return true;
	}
}
public class TeleportTargetHandlerPhysical : TeleportTargetHandler
{
	protected override bool ConsiderTeleport(Vector3 start, ref Vector3 end)
	{
		if (base.LocomotionTeleport.AimCollisionTest(start, end, AimCollisionLayerMask, out AimData.TargetHitInfo))
		{
			Vector3 normalized = (end - start).normalized;
			end = start + normalized * AimData.TargetHitInfo.distance;
			return true;
		}
		return false;
	}
}
public abstract class TeleportTransition : TeleportSupport
{
	protected override void AddEventHandlers()
	{
		base.LocomotionTeleport.EnterStateTeleporting += LocomotionTeleportOnEnterStateTeleporting;
		base.AddEventHandlers();
	}

	protected override void RemoveEventHandlers()
	{
		base.LocomotionTeleport.EnterStateTeleporting -= LocomotionTeleportOnEnterStateTeleporting;
		base.RemoveEventHandlers();
	}

	protected abstract void LocomotionTeleportOnEnterStateTeleporting();
}
public class TeleportTransitionBlink : TeleportTransition
{
	[Tooltip("How long the transition takes. Usually this is greater than Teleport Delay.")]
	[Range(0.01f, 2f)]
	public float TransitionDuration = 0.5f;

	[Tooltip("At what percentage of the elapsed transition time does the teleport occur?")]
	[Range(0f, 1f)]
	public float TeleportDelay = 0.5f;

	[Tooltip("Fade to black over the duration of the transition")]
	public AnimationCurve FadeLevels = new AnimationCurve(new Keyframe(0f, 0f), new Keyframe(0.5f, 1f), new Keyframe(1f, 0f));

	protected override void LocomotionTeleportOnEnterStateTeleporting()
	{
		StartCoroutine(BlinkCoroutine());
	}

	protected IEnumerator BlinkCoroutine()
	{
		base.LocomotionTeleport.IsTransitioning = true;
		float elapsedTime = 0f;
		float teleportTime = TransitionDuration * TeleportDelay;
		bool teleported = false;
		while (elapsedTime < TransitionDuration)
		{
			yield return null;
			elapsedTime += Time.deltaTime;
			if (!teleported && elapsedTime >= teleportTime)
			{
				teleported = true;
				base.LocomotionTeleport.DoTeleport();
			}
		}
		base.LocomotionTeleport.IsTransitioning = false;
	}
}
public class TeleportTransitionInstant : TeleportTransition
{
	protected override void LocomotionTeleportOnEnterStateTeleporting()
	{
		base.LocomotionTeleport.DoTeleport();
	}
}
public class TeleportTransitionWarp : TeleportTransition
{
	[Tooltip("How much time the warp transition takes to complete.")]
	[Range(0.01f, 1f)]
	public float TransitionDuration = 0.5f;

	[HideInInspector]
	public AnimationCurve PositionLerp = AnimationCurve.Linear(0f, 0f, 1f, 1f);

	protected override void LocomotionTeleportOnEnterStateTeleporting()
	{
		StartCoroutine(DoWarp());
	}

	private IEnumerator DoWarp()
	{
		base.LocomotionTeleport.IsTransitioning = true;
		Vector3 startPosition = base.LocomotionTeleport.GetCharacterPosition();
		float elapsedTime = 0f;
		while (elapsedTime < TransitionDuration)
		{
			elapsedTime += Time.deltaTime;
			float time = elapsedTime / TransitionDuration;
			float positionPercent = PositionLerp.Evaluate(time);
			base.LocomotionTeleport.DoWarp(startPosition, positionPercent);
			yield return null;
		}
		base.LocomotionTeleport.DoWarp(startPosition, 1f);
		base.LocomotionTeleport.IsTransitioning = false;
	}
}
public static class NativeVideoPlayer
{
	private static IntPtr? _Activity;

	private static IntPtr? _VideoPlayerClass;

	private static IntPtr playVideoMethodId;

	private static IntPtr stopMethodId;

	private static IntPtr resumeMethodId;

	private static IntPtr pauseMethodId;

	private static IntPtr setPlaybackSpeedMethodId;

	private static IntPtr setLoopingMethodId;

	private static IntPtr VideoPlayerClass
	{
		get
		{
			if (!_VideoPlayerClass.HasValue)
			{
				try
				{
					IntPtr intPtr = AndroidJNI.FindClass("com/oculus/videoplayer/NativeVideoPlayer");
					if (intPtr != IntPtr.Zero)
					{
						_VideoPlayerClass = AndroidJNI.NewGlobalRef(intPtr);
						AndroidJNI.DeleteLocalRef(intPtr);
					}
					else
					{
						UnityEngine.Debug.LogError("Failed to find NativeVideoPlayer class");
						_VideoPlayerClass = IntPtr.Zero;
					}
				}
				catch (Exception exception)
				{
					UnityEngine.Debug.LogError("Failed to find NativeVideoPlayer class");
					UnityEngine.Debug.LogException(exception);
					_VideoPlayerClass = IntPtr.Zero;
				}
			}
			return _VideoPlayerClass.GetValueOrDefault();
		}
	}

	private static IntPtr Activity
	{
		get
		{
			if (!_Activity.HasValue)
			{
				try
				{
					IntPtr intPtr = AndroidJNI.FindClass("com/unity3d/player/UnityPlayer");
					IntPtr staticFieldID = AndroidJNI.GetStaticFieldID(intPtr, "currentActivity", "Landroid/app/Activity;");
					IntPtr staticObjectField = AndroidJNI.GetStaticObjectField(intPtr, staticFieldID);
					_Activity = AndroidJNI.NewGlobalRef(staticObjectField);
					AndroidJNI.DeleteLocalRef(staticObjectField);
					AndroidJNI.DeleteLocalRef(intPtr);
				}
				catch (Exception exception)
				{
					UnityEngine.Debug.LogException(exception);
					_Activity = IntPtr.Zero;
				}
			}
			return _Activity.GetValueOrDefault();
		}
	}

	public static bool IsAvailable => VideoPlayerClass != IntPtr.Zero;

	public static void PlayVideo(string path, string drmLicenseUrl, IntPtr surfaceObj)
	{
		if (playVideoMethodId == IntPtr.Zero)
		{
			playVideoMethodId = AndroidJNI.GetStaticMethodID(VideoPlayerClass, "playVideo", "(Landroid/content/Context;Ljava/lang/String;Ljava/lang/String;Landroid/view/Surface;)V");
		}
		IntPtr intPtr = AndroidJNI.NewStringUTF(path);
		IntPtr intPtr2 = AndroidJNI.NewStringUTF(drmLicenseUrl);
		AndroidJNI.CallStaticVoidMethod(VideoPlayerClass, playVideoMethodId, new jvalue[4]
		{
			new jvalue
			{
				l = Activity
			},
			new jvalue
			{
				l = intPtr
			},
			new jvalue
			{
				l = intPtr2
			},
			new jvalue
			{
				l = surfaceObj
			}
		});
		AndroidJNI.DeleteLocalRef(intPtr);
		AndroidJNI.DeleteLocalRef(intPtr2);
	}

	public static void Stop()
	{
		if (stopMethodId == IntPtr.Zero)
		{
			stopMethodId = AndroidJNI.GetStaticMethodID(VideoPlayerClass, "stop", "()V");
		}
		AndroidJNI.CallStaticVoidMethod(VideoPlayerClass, stopMethodId, new jvalue[0]);
	}

	public static void Play()
	{
		if (resumeMethodId == IntPtr.Zero)
		{
			resumeMethodId = AndroidJNI.GetStaticMethodID(VideoPlayerClass, "resume", "()V");
		}
		AndroidJNI.CallStaticVoidMethod(VideoPlayerClass, resumeMethodId, new jvalue[0]);
	}

	public static void Pause()
	{
		if (pauseMethodId == IntPtr.Zero)
		{
			pauseMethodId = AndroidJNI.GetStaticMethodID(VideoPlayerClass, "pause", "()V");
		}
		AndroidJNI.CallStaticVoidMethod(VideoPlayerClass, pauseMethodId, new jvalue[0]);
	}

	public static void SetPlaybackSpeed(float speed)
	{
		if (setPlaybackSpeedMethodId == IntPtr.Zero)
		{
			setPlaybackSpeedMethodId = AndroidJNI.GetStaticMethodID(VideoPlayerClass, "setPlaybackSpeed", "(f)V");
		}
		AndroidJNI.CallStaticVoidMethod(VideoPlayerClass, setPlaybackSpeedMethodId, new jvalue[1]
		{
			new jvalue
			{
				f = speed
			}
		});
	}

	public static void SetLooping(bool looping)
	{
		if (setLoopingMethodId == IntPtr.Zero)
		{
			setLoopingMethodId = AndroidJNI.GetStaticMethodID(VideoPlayerClass, "setLooping", "(Z)V");
		}
		AndroidJNI.CallStaticVoidMethod(VideoPlayerClass, setLoopingMethodId, new jvalue[1]
		{
			new jvalue
			{
				z = looping
			}
		});
	}
}
public class MoviePlayerSample : MonoBehaviour
{
	public enum VideoShape
	{
		_360,
		_180,
		Quad
	}

	public enum VideoStereo
	{
		Mono,
		TopBottom,
		LeftRight
	}

	private bool videoPausedBeforeAppPause;

	private VideoPlayer videoPlayer;

	private OVROverlay overlay;

	private Renderer mediaRenderer;

	private RenderTexture copyTexture;

	private Material externalTex2DMaterial;

	public string MovieName;

	public string DrmLicenseUrl;

	public bool LoopVideo;

	public VideoShape Shape;

	public VideoStereo Stereo;

	public bool isPlaying { get; private set; }

	private void Awake()
	{
		UnityEngine.Debug.Log("MovieSample Awake");
		mediaRenderer = GetComponent<Renderer>();
		videoPlayer = GetComponent<VideoPlayer>();
		if (videoPlayer == null)
		{
			videoPlayer = base.gameObject.AddComponent<VideoPlayer>();
		}
		videoPlayer.isLooping = LoopVideo;
		overlay = GetComponent<OVROverlay>();
		if (overlay == null)
		{
			overlay = base.gameObject.AddComponent<OVROverlay>();
		}
		Rect rect = new Rect(0f, 0f, 1f, 1f);
		switch (Shape)
		{
		case VideoShape._360:
			overlay.currentOverlayShape = OVROverlay.OverlayShape.Equirect;
			break;
		case VideoShape._180:
			overlay.currentOverlayShape = OVROverlay.OverlayShape.Equirect;
			rect = new Rect(0.25f, 0f, 0.5f, 1f);
			break;
		default:
			overlay.currentOverlayShape = OVROverlay.OverlayShape.Quad;
			break;
		}
		overlay.overrideTextureRectMatrix = true;
		Rect srcLeft = new Rect(0f, 0f, 1f, 1f);
		Rect srcRight = new Rect(0f, 0f, 1f, 1f);
		switch (Stereo)
		{
		case VideoStereo.LeftRight:
			srcLeft = new Rect(0f, 0f, 0.5f, 1f);
			srcRight = new Rect(0.5f, 0f, 0.5f, 1f);
			break;
		case VideoStereo.TopBottom:
			srcLeft = new Rect(0f, 0f, 1f, 0.5f);
			srcRight = new Rect(0f, 0.5f, 1f, 0.5f);
			break;
		}
		overlay.SetSrcDestRects(srcLeft, srcRight, rect, rect);
		overlay.enabled = false;
		overlay.isExternalSurface = NativeVideoPlayer.IsAvailable;
		overlay.enabled = overlay.currentOverlayShape != OVROverlay.OverlayShape.Equirect || UnityEngine.Application.platform == RuntimePlatform.Android;
	}

	private bool IsLocalVideo(string movieName)
	{
		return !movieName.Contains("://");
	}

	private IEnumerator Start()
	{
		if (mediaRenderer.material == null)
		{
			UnityEngine.Debug.LogError("No material for movie surface");
			yield break;
		}
		yield return new WaitForSeconds(1f);
		if (!string.IsNullOrEmpty(MovieName))
		{
			if (IsLocalVideo(MovieName))
			{
				Play(UnityEngine.Application.streamingAssetsPath + "/" + MovieName, null);
			}
			else
			{
				Play(MovieName, DrmLicenseUrl);
			}
		}
	}

	public void Play(string moviePath, string drmLicencesUrl)
	{
		if (moviePath != string.Empty)
		{
			UnityEngine.Debug.Log("Playing Video: " + moviePath);
			if (overlay.isExternalSurface)
			{
				OVROverlay.ExternalSurfaceObjectCreated externalSurfaceObjectCreated = delegate
				{
					UnityEngine.Debug.Log("Playing ExoPlayer with SurfaceObject");
					NativeVideoPlayer.PlayVideo(moviePath, drmLicencesUrl, overlay.externalSurfaceObject);
					NativeVideoPlayer.SetLooping(LoopVideo);
				};
				if (overlay.externalSurfaceObject == IntPtr.Zero)
				{
					overlay.externalSurfaceObjectCreated = externalSurfaceObjectCreated;
				}
				else
				{
					externalSurfaceObjectCreated();
				}
			}
			else
			{
				UnityEngine.Debug.Log("Playing Unity VideoPlayer");
				videoPlayer.url = moviePath;
				videoPlayer.Prepare();
				videoPlayer.Play();
			}
			UnityEngine.Debug.Log("MovieSample Start");
			isPlaying = true;
		}
		else
		{
			UnityEngine.Debug.LogError("No media file name provided");
		}
	}

	public void Play()
	{
		if (overlay.isExternalSurface)
		{
			NativeVideoPlayer.Play();
		}
		else
		{
			videoPlayer.Play();
		}
		isPlaying = true;
	}

	public void Pause()
	{
		if (overlay.isExternalSurface)
		{
			NativeVideoPlayer.Pause();
		}
		else
		{
			videoPlayer.Pause();
		}
		isPlaying = false;
	}

	private void Update()
	{
		if (overlay.isExternalSurface)
		{
			return;
		}
		Texture texture = ((videoPlayer.texture != null) ? videoPlayer.texture : Texture2D.blackTexture);
		if (overlay.enabled)
		{
			if (overlay.textures[0] != texture)
			{
				overlay.enabled = false;
				overlay.textures[0] = texture;
				overlay.enabled = true;
			}
		}
		else
		{
			mediaRenderer.material.mainTexture = texture;
			mediaRenderer.material.SetVector("_SrcRectLeft", overlay.srcRectLeft.ToVector());
			mediaRenderer.material.SetVector("_SrcRectRight", overlay.srcRectRight.ToVector());
		}
	}

	public void Rewind()
	{
		if (overlay.isExternalSurface)
		{
			NativeVideoPlayer.SetPlaybackSpeed(-1f);
		}
		else
		{
			videoPlayer.playbackSpeed = -1f;
		}
	}

	public void Stop()
	{
		if (overlay.isExternalSurface)
		{
			NativeVideoPlayer.Stop();
		}
		else
		{
			videoPlayer.Stop();
		}
		isPlaying = false;
	}

	private void OnApplicationPause(bool appWasPaused)
	{
		UnityEngine.Debug.Log("OnApplicationPause: " + appWasPaused);
		if (appWasPaused)
		{
			videoPausedBeforeAppPause = !isPlaying;
		}
		if (!videoPausedBeforeAppPause)
		{
			if (appWasPaused)
			{
				Pause();
			}
			else
			{
				Play();
			}
		}
	}
}
[ExecuteInEditMode]
[RequireComponent(typeof(OVROverlay))]
public class OVROverlayMeshGenerator : MonoBehaviour
{
	private enum CubeFace
	{
		Right,
		Left,
		Top,
		Bottom,
		Front,
		Back,
		COUNT
	}

	private Mesh _Mesh;

	private List<Vector3> _Verts = new List<Vector3>();

	private List<Vector2> _UV = new List<Vector2>();

	private List<int> _Tris = new List<int>();

	private OVROverlay _Overlay;

	private MeshFilter _MeshFilter;

	private MeshCollider _MeshCollider;

	private Transform _CameraRoot;

	private Transform _Transform;

	private OVROverlay.OverlayShape _LastShape;

	private Vector3 _LastPosition;

	private Quaternion _LastRotation;

	private Vector3 _LastScale;

	private Rect _LastRectLeft;

	private Rect _LastRectRight;

	private bool _Awake;

	private static readonly Vector3[] BottomLeft = new Vector3[6]
	{
		new Vector3(-0.5f, -0.5f, -0.5f),
		new Vector3(0.5f, -0.5f, 0.5f),
		new Vector3(0.5f, 0.5f, -0.5f),
		new Vector3(0.5f, -0.5f, 0.5f),
		new Vector3(0.5f, -0.5f, -0.5f),
		new Vector3(-0.5f, -0.5f, 0.5f)
	};

	private static readonly Vector3[] RightVector = new Vector3[6]
	{
		Vector3.forward,
		Vector3.back,
		Vector3.left,
		Vector3.left,
		Vector3.left,
		Vector3.right
	};

	private static readonly Vector3[] UpVector = new Vector3[6]
	{
		Vector3.up,
		Vector3.up,
		Vector3.forward,
		Vector3.back,
		Vector3.up,
		Vector3.up
	};

	protected void Awake()
	{
		_Overlay = GetComponent<OVROverlay>();
		_MeshFilter = GetComponent<MeshFilter>();
		_MeshCollider = GetComponent<MeshCollider>();
		_Transform = base.transform;
		if ((bool)Camera.main && (bool)Camera.main.transform.parent)
		{
			_CameraRoot = Camera.main.transform.parent;
		}
		_Awake = true;
	}

	private Rect GetBoundingRect(Rect a, Rect b)
	{
		float num = Mathf.Min(a.x, b.x);
		float num2 = Mathf.Max(a.x + a.width, b.x + b.width);
		float num3 = Mathf.Min(a.y, b.y);
		float num4 = Mathf.Max(a.y + a.height, b.y + b.height);
		return new Rect(num, num3, num2 - num, num4 - num3);
	}

	private void Update()
	{
		if (!_Awake)
		{
			Awake();
		}
		if ((bool)_Overlay)
		{
			OVROverlay.OverlayShape currentOverlayShape = _Overlay.currentOverlayShape;
			Vector3 vector = (_CameraRoot ? (_Transform.position - _CameraRoot.position) : _Transform.position);
			Quaternion rotation = _Transform.rotation;
			Vector3 lossyScale = _Transform.lossyScale;
			Rect rect = (_Overlay.overrideTextureRectMatrix ? _Overlay.destRectLeft : new Rect(0f, 0f, 1f, 1f));
			Rect rect2 = (_Overlay.overrideTextureRectMatrix ? _Overlay.destRectRight : new Rect(0f, 0f, 1f, 1f));
			if (_Mesh == null || _LastShape != currentOverlayShape || _LastPosition != vector || _LastRotation != rotation || _LastScale != lossyScale || _LastRectLeft != rect || _LastRectRight != rect2)
			{
				UpdateMesh(currentOverlayShape, vector, rotation, lossyScale, GetBoundingRect(rect, rect2));
				_LastShape = currentOverlayShape;
				_LastPosition = vector;
				_LastRotation = rotation;
				_LastScale = lossyScale;
				_LastRectLeft = rect;
				_LastRectRight = rect2;
			}
		}
	}

	private void UpdateMesh(OVROverlay.OverlayShape shape, Vector3 position, Quaternion rotation, Vector3 scale, Rect rect)
	{
		if ((bool)_MeshFilter)
		{
			if (_Mesh == null)
			{
				_Mesh = new Mesh
				{
					name = "Overlay"
				};
				_Mesh.hideFlags = HideFlags.DontSaveInEditor | HideFlags.DontSaveInBuild;
			}
			_Mesh.Clear();
			_Verts.Clear();
			_UV.Clear();
			_Tris.Clear();
			GenerateMesh(_Verts, _UV, _Tris, shape, position, rotation, scale, rect);
			_Mesh.SetVertices(_Verts);
			_Mesh.SetUVs(0, _UV);
			_Mesh.SetTriangles(_Tris, 0);
			_Mesh.UploadMeshData(markNoLongerReadable: false);
			_MeshFilter.sharedMesh = _Mesh;
			if ((bool)_MeshCollider)
			{
				_MeshCollider.sharedMesh = _Mesh;
			}
		}
	}

	public static void GenerateMesh(List<Vector3> verts, List<Vector2> uvs, List<int> tris, OVROverlay.OverlayShape shape, Vector3 position, Quaternion rotation, Vector3 scale, Rect rect)
	{
		switch (shape)
		{
		case OVROverlay.OverlayShape.Equirect:
			BuildSphere(verts, uvs, tris, position, rotation, scale, rect);
			break;
		case OVROverlay.OverlayShape.Cubemap:
		case OVROverlay.OverlayShape.OffcenterCubemap:
			BuildCube(verts, uvs, tris, position, rotation, scale);
			break;
		case OVROverlay.OverlayShape.Quad:
			BuildQuad(verts, uvs, tris, rect);
			break;
		case OVROverlay.OverlayShape.Cylinder:
			BuildHemicylinder(verts, uvs, tris, scale, rect);
			break;
		case (OVROverlay.OverlayShape)3:
			break;
		}
	}

	private static Vector2 GetSphereUV(float theta, float phi, float expand_coef)
	{
		float x = (theta / ((float)Math.PI * 2f) - 0.5f) / expand_coef + 0.5f;
		float y = phi / (float)Math.PI / expand_coef + 0.5f;
		return new Vector2(x, y);
	}

	private static Vector3 GetSphereVert(float theta, float phi)
	{
		return new Vector3((0f - Mathf.Sin(theta)) * Mathf.Cos(phi), Mathf.Sin(phi), (0f - Mathf.Cos(theta)) * Mathf.Cos(phi));
	}

	public static void BuildSphere(List<Vector3> verts, List<Vector2> uv, List<int> triangles, Vector3 position, Quaternion rotation, Vector3 scale, Rect rect, float worldScale = 800f, int latitudes = 128, int longitudes = 128, float expand_coef = 1f)
	{
		position = Quaternion.Inverse(rotation) * position;
		latitudes = Mathf.CeilToInt((float)latitudes * rect.height);
		longitudes = Mathf.CeilToInt((float)longitudes * rect.width);
		float num = (float)Math.PI * 2f * rect.x;
		float num2 = (float)Math.PI * (0.5f - rect.y - rect.height);
		float num3 = (float)Math.PI * 2f * rect.width / (float)longitudes;
		float num4 = (float)Math.PI * rect.height / (float)latitudes;
		for (int i = 0; i < latitudes + 1; i++)
		{
			for (int j = 0; j < longitudes + 1; j++)
			{
				float theta = num + (float)j * num3;
				float phi = num2 + (float)i * num4;
				Vector2 sphereUV = GetSphereUV(theta, phi, expand_coef);
				uv.Add(new Vector2((sphereUV.x - rect.x) / rect.width, (sphereUV.y - rect.y) / rect.height));
				Vector3 sphereVert = GetSphereVert(theta, phi);
				sphereVert.x = (worldScale * sphereVert.x - position.x) / scale.x;
				sphereVert.y = (worldScale * sphereVert.y - position.y) / scale.y;
				sphereVert.z = (worldScale * sphereVert.z - position.z) / scale.z;
				verts.Add(sphereVert);
			}
		}
		for (int k = 0; k < latitudes; k++)
		{
			for (int l = 0; l < longitudes; l++)
			{
				triangles.Add(k * (longitudes + 1) + l);
				triangles.Add((k + 1) * (longitudes + 1) + l);
				triangles.Add((k + 1) * (longitudes + 1) + l + 1);
				triangles.Add((k + 1) * (longitudes + 1) + l + 1);
				triangles.Add(k * (longitudes + 1) + l + 1);
				triangles.Add(k * (longitudes + 1) + l);
			}
		}
	}

	private static Vector2 GetCubeUV(CubeFace face, Vector2 sideUV, float expand_coef)
	{
		sideUV = (sideUV - 0.5f * Vector2.one) / expand_coef + 0.5f * Vector2.one;
		return face switch
		{
			CubeFace.Bottom => new Vector2(sideUV.x / 3f, sideUV.y / 2f), 
			CubeFace.Front => new Vector2((1f + sideUV.x) / 3f, sideUV.y / 2f), 
			CubeFace.Back => new Vector2((2f + sideUV.x) / 3f, sideUV.y / 2f), 
			CubeFace.Right => new Vector2(sideUV.x / 3f, (1f + sideUV.y) / 2f), 
			CubeFace.Left => new Vector2((1f + sideUV.x) / 3f, (1f + sideUV.y) / 2f), 
			CubeFace.Top => new Vector2((2f + sideUV.x) / 3f, (1f + sideUV.y) / 2f), 
			_ => Vector2.zero, 
		};
	}

	private static Vector3 GetCubeVert(CubeFace face, Vector2 sideUV, float expand_coef)
	{
		return BottomLeft[(int)face] + sideUV.x * RightVector[(int)face] + sideUV.y * UpVector[(int)face];
	}

	public static void BuildCube(List<Vector3> verts, List<Vector2> uv, List<int> triangles, Vector3 position, Quaternion rotation, Vector3 scale, float worldScale = 800f, int subQuads = 1, float expand_coef = 1.01f)
	{
		position = Quaternion.Inverse(rotation) * position;
		int num = (subQuads + 1) * (subQuads + 1);
		for (int i = 0; i < 6; i++)
		{
			for (int j = 0; j < subQuads + 1; j++)
			{
				for (int k = 0; k < subQuads + 1; k++)
				{
					float x = (float)j / (float)subQuads;
					float y = (float)k / (float)subQuads;
					uv.Add(GetCubeUV((CubeFace)i, new Vector2(x, y), expand_coef));
					Vector3 cubeVert = GetCubeVert((CubeFace)i, new Vector2(x, y), expand_coef);
					cubeVert.x = (worldScale * cubeVert.x - position.x) / scale.x;
					cubeVert.y = (worldScale * cubeVert.y - position.y) / scale.y;
					cubeVert.z = (worldScale * cubeVert.z - position.z) / scale.z;
					verts.Add(cubeVert);
				}
			}
			for (int l = 0; l < subQuads; l++)
			{
				for (int m = 0; m < subQuads; m++)
				{
					triangles.Add(num * i + (l + 1) * (subQuads + 1) + m);
					triangles.Add(num * i + l * (subQuads + 1) + m);
					triangles.Add(num * i + (l + 1) * (subQuads + 1) + m + 1);
					triangles.Add(num * i + (l + 1) * (subQuads + 1) + m + 1);
					triangles.Add(num * i + l * (subQuads + 1) + m);
					triangles.Add(num * i + l * (subQuads + 1) + m + 1);
				}
			}
		}
	}

	public static void BuildQuad(List<Vector3> verts, List<Vector2> uv, List<int> triangles, Rect rect)
	{
		verts.Add(new Vector3(rect.x - 0.5f, 1f - rect.y - rect.height - 0.5f, 0f));
		verts.Add(new Vector3(rect.x - 0.5f, 1f - rect.y - 0.5f, 0f));
		verts.Add(new Vector3(rect.x + rect.width - 0.5f, 1f - rect.y - 0.5f, 0f));
		verts.Add(new Vector3(rect.x + rect.width - 0.5f, 1f - rect.y - rect.height - 0.5f, 0f));
		uv.Add(new Vector2(0f, 0f));
		uv.Add(new Vector2(0f, 1f));
		uv.Add(new Vector2(1f, 1f));
		uv.Add(new Vector2(1f, 0f));
		triangles.Add(0);
		triangles.Add(1);
		triangles.Add(2);
		triangles.Add(2);
		triangles.Add(3);
		triangles.Add(0);
	}

	public static void BuildHemicylinder(List<Vector3> verts, List<Vector2> uv, List<int> triangles, Vector3 scale, Rect rect, int longitudes = 128)
	{
		float num = Mathf.Abs(scale.y) * rect.height;
		float z = scale.z;
		float num2 = scale.x * rect.width;
		float num3 = num2 / z;
		float num4 = scale.x * (-0.5f + rect.x) / z;
		int num5 = Mathf.CeilToInt((float)longitudes * num3 / ((float)Math.PI * 2f));
		float num6 = num2 / (float)num5;
		int num7 = Mathf.CeilToInt(num / num6 / 2f);
		for (int i = 0; i < num7 + 1; i++)
		{
			for (int j = 0; j < num5 + 1; j++)
			{
				uv.Add(new Vector2((float)j / (float)num5, 1f - (float)i / (float)num7));
				Vector3 zero = Vector3.zero;
				zero.x = Mathf.Sin(num4 + (float)j * num3 / (float)num5) * z / scale.x;
				zero.y = 0.5f - rect.y - rect.height + rect.height * (1f - (float)i / (float)num7);
				zero.z = Mathf.Cos(num4 + (float)j * num3 / (float)num5) * z / scale.z;
				verts.Add(zero);
			}
		}
		for (int k = 0; k < num7; k++)
		{
			for (int l = 0; l < num5; l++)
			{
				triangles.Add(k * (num5 + 1) + l);
				triangles.Add((k + 1) * (num5 + 1) + l + 1);
				triangles.Add((k + 1) * (num5 + 1) + l);
				triangles.Add((k + 1) * (num5 + 1) + l + 1);
				triangles.Add(k * (num5 + 1) + l);
				triangles.Add(k * (num5 + 1) + l + 1);
			}
		}
	}
}
public static class VectorUtil
{
	public static Vector4 ToVector(this Rect rect)
	{
		return new Vector4(rect.x, rect.y, rect.width, rect.height);
	}
}
public class DebugUISample : MonoBehaviour
{
	private bool inMenu;

	private Text sliderText;

	private void Start()
	{
		DebugUIBuilder.instance.AddButton("Button Pressed", LogButtonPressed);
		DebugUIBuilder.instance.AddLabel("Label");
		RectTransform rectTransform = DebugUIBuilder.instance.AddSlider("Slider", 1f, 10f, SliderPressed, wholeNumbersOnly: true);
		Text[] componentsInChildren = rectTransform.GetComponentsInChildren<Text>();
		sliderText = componentsInChildren[1];
		sliderText.text = rectTransform.GetComponentInChildren<Slider>().value.ToString();
		DebugUIBuilder.instance.AddDivider();
		DebugUIBuilder.instance.AddToggle("Toggle", TogglePressed);
		DebugUIBuilder.instance.AddRadio("Radio1", "group", delegate(Toggle t)
		{
			RadioPressed("Radio1", "group", t);
		});
		DebugUIBuilder.instance.AddRadio("Radio2", "group", delegate(Toggle t)
		{
			RadioPressed("Radio2", "group", t);
		});
		DebugUIBuilder.instance.AddLabel("Secondary Tab", 1);
		DebugUIBuilder.instance.AddDivider(1);
		DebugUIBuilder.instance.AddRadio("Side Radio 1", "group2", delegate(Toggle t)
		{
			RadioPressed("Side Radio 1", "group2", t);
		}, 1);
		DebugUIBuilder.instance.AddRadio("Side Radio 2", "group2", delegate(Toggle t)
		{
			RadioPressed("Side Radio 2", "group2", t);
		}, 1);
		DebugUIBuilder.instance.Show();
		inMenu = true;
	}

	public void TogglePressed(Toggle t)
	{
		UnityEngine.Debug.Log("Toggle pressed. Is on? " + t.isOn);
	}

	public void RadioPressed(string radioLabel, string group, Toggle t)
	{
		UnityEngine.Debug.Log("Radio value changed: " + radioLabel + ", from group " + group + ". New value: " + t.isOn);
	}

	public void SliderPressed(float f)
	{
		UnityEngine.Debug.Log("Slider: " + f);
		sliderText.text = f.ToString();
	}

	private void Update()
	{
		if (OVRInput.GetDown(OVRInput.Button.Two) || OVRInput.GetDown(OVRInput.Button.Start))
		{
			if (inMenu)
			{
				DebugUIBuilder.instance.Hide();
			}
			else
			{
				DebugUIBuilder.instance.Show();
			}
			inMenu = !inMenu;
		}
	}

	private void LogButtonPressed()
	{
		UnityEngine.Debug.Log("Button pressed");
	}
}
[ExecuteInEditMode]
public class CharacterCapsule : MonoBehaviour
{
	private CharacterController _character;

	private MeshFilter _meshFilter;

	private float _height;

	private float _radius;

	[Range(4f, 32f)]
	public int SubdivisionsU;

	[Range(4f, 32f)]
	public int SubdivisionsV;

	private int _subdivisionU;

	private int _subdivisionV;

	private Vector3[] _vertices;

	private int[] _triangles;

	private void Update()
	{
		if (_character == null)
		{
			_character = GetComponentInParent<CharacterController>();
			if (_character == null)
			{
				return;
			}
		}
		if (_height == _character.height && _radius == _character.radius && _subdivisionU == SubdivisionsU && _subdivisionV == SubdivisionsV)
		{
			return;
		}
		_height = _character.height;
		_radius = _character.radius;
		_subdivisionU = SubdivisionsU;
		_subdivisionV = SubdivisionsV;
		List<Vector3> list = new List<Vector3>();
		Vector3 vector = new Vector3(1f, 0f, 0f);
		Vector3 vector2 = new Vector3(0f, _height / 2f - _radius, 0f);
		Vector3 vector3 = new Vector3(0f, _radius - _height / 2f, 0f);
		list.Add(new Vector3(0f, _height / 2f, 0f));
		for (int num = SubdivisionsU - 1; num >= 0; num--)
		{
			float num2 = (float)num / (float)SubdivisionsU;
			for (int i = 0; i < SubdivisionsV; i++)
			{
				float num3 = (float)i / (float)SubdivisionsV;
				Vector3 item = Quaternion.Euler(0f, num3 * 360f, num2 * 90f) * vector * _radius + vector2;
				list.Add(item);
			}
		}
		for (int j = 0; j < SubdivisionsU; j++)
		{
			float num4 = (float)j / (float)SubdivisionsU;
			for (int k = 0; k < SubdivisionsV; k++)
			{
				float num5 = (float)k / (float)SubdivisionsV;
				Vector3 vector4 = Quaternion.Euler(0f, num5 * 360f + 180f, num4 * 90f) * vector;
				vector4 *= _radius;
				Vector3 item2 = vector3 - vector4;
				list.Add(item2);
			}
		}
		list.Add(new Vector3(0f, (0f - _height) / 2f, 0f));
		List<int> list2 = new List<int>();
		int item3;
		for (int l = 0; l < SubdivisionsV; l++)
		{
			item3 = 0;
			list2.Add(item3);
			list2.Add(l);
			list2.Add(l + 1);
		}
		list2.Add(0);
		list2.Add(SubdivisionsV);
		list2.Add(1);
		int num6;
		for (int m = 0; m < SubdivisionsU - 1; m++)
		{
			num6 = m * SubdivisionsV + 1;
			for (int n = 0; n < SubdivisionsV - 1; n++)
			{
				item3 = num6 + n;
				list2.Add(item3);
				list2.Add(item3 + SubdivisionsV);
				list2.Add(item3 + 1);
				list2.Add(item3 + 1);
				list2.Add(item3 + SubdivisionsV);
				list2.Add(item3 + SubdivisionsV + 1);
			}
			item3 = num6 + SubdivisionsV - 1;
			list2.Add(item3);
			list2.Add(item3 + SubdivisionsV);
			list2.Add(item3 + 1 - SubdivisionsV);
			list2.Add(item3 + 1 - SubdivisionsV);
			list2.Add(item3 + SubdivisionsV);
			list2.Add(item3 + 1);
		}
		num6 = (SubdivisionsU - 1) * SubdivisionsV + 1;
		for (int num7 = 0; num7 < SubdivisionsV - 1; num7++)
		{
			item3 = num6 + num7;
			list2.Add(item3);
			list2.Add(item3 + SubdivisionsV);
			list2.Add(item3 + 1);
			list2.Add(item3 + 1);
			list2.Add(item3 + SubdivisionsV);
			list2.Add(item3 + SubdivisionsV + 1);
		}
		item3 = num6 + SubdivisionsV - 1;
		list2.Add(item3);
		list2.Add(item3 + SubdivisionsV);
		list2.Add(item3 + 1 - SubdivisionsV);
		list2.Add(item3 + 1 - SubdivisionsV);
		list2.Add(item3 + SubdivisionsV);
		list2.Add(item3 + 1);
		for (int num8 = 0; num8 < SubdivisionsU - 1; num8++)
		{
			num6 = num8 * SubdivisionsV + SubdivisionsU * SubdivisionsV + 1;
			for (int num9 = 0; num9 < SubdivisionsV - 1; num9++)
			{
				item3 = num6 + num9;
				list2.Add(item3);
				list2.Add(item3 + SubdivisionsV);
				list2.Add(item3 + 1);
				list2.Add(item3 + 1);
				list2.Add(item3 + SubdivisionsV);
				list2.Add(item3 + SubdivisionsV + 1);
			}
			item3 = num6 + SubdivisionsV - 1;
			list2.Add(item3);
			list2.Add(item3 + SubdivisionsV);
			list2.Add(item3 + 1 - SubdivisionsV);
			list2.Add(item3 + 1 - SubdivisionsV);
			list2.Add(item3 + SubdivisionsV);
			list2.Add(item3 + 1);
		}
		int num10 = list.Count - 1;
		int num11 = num10 - SubdivisionsV;
		for (int num12 = 0; num12 < SubdivisionsV; num12++)
		{
			item3 = 0;
			list2.Add(num10);
			list2.Add(num11 + num12 + 1);
			list2.Add(num11 + num12);
		}
		list2.Add(num10);
		list2.Add(num11);
		list2.Add(num10 - 1);
		_vertices = list.ToArray();
		_triangles = list2.ToArray();
		_meshFilter = base.gameObject.GetComponent<MeshFilter>();
		_meshFilter.mesh = new Mesh();
		_meshFilter.sharedMesh.vertices = _vertices;
		_meshFilter.sharedMesh.triangles = _triangles;
		_meshFilter.sharedMesh.RecalculateNormals();
	}
}
public class LocomotionSampleSupport : MonoBehaviour
{
	private LocomotionController lc;

	private bool inMenu;

	private LocomotionTeleport TeleportController => lc.GetComponent<LocomotionTeleport>();

	public void Start()
	{
		lc = UnityEngine.Object.FindObjectOfType<LocomotionController>();
		DebugUIBuilder.instance.AddButton("Node Teleport w/ A", SetupNodeTeleport);
		DebugUIBuilder.instance.AddButton("Dual-stick teleport", SetupTwoStickTeleport);
		DebugUIBuilder.instance.AddButton("L Strafe R Teleport", SetupLeftStrafeRightTeleport);
		DebugUIBuilder.instance.AddButton("Walk Only", SetupWalkOnly);
		if (UnityEngine.Object.FindObjectOfType<EventSystem>() == null)
		{
			UnityEngine.Debug.LogError("Need EventSystem");
		}
		SetupTwoStickTeleport();
		Physics.IgnoreLayerCollision(0, 4);
	}

	public void Update()
	{
		if (OVRInput.GetDown(OVRInput.Button.Two) || OVRInput.GetDown(OVRInput.Button.Start))
		{
			if (inMenu)
			{
				DebugUIBuilder.instance.Hide();
			}
			else
			{
				DebugUIBuilder.instance.Show();
			}
			inMenu = !inMenu;
		}
	}

	[Conditional("DEBUG_LOCOMOTION_PANEL")]
	private static void Log(string msg)
	{
		UnityEngine.Debug.Log(msg);
	}

	public static TActivate ActivateCategory<TCategory, TActivate>(GameObject target) where TCategory : MonoBehaviour where TActivate : MonoBehaviour
	{
		TCategory[] components = target.GetComponents<TCategory>();
		Log(string.Concat("Activate ", typeof(TActivate), " derived from ", typeof(TCategory), "[", components.Length, "]"));
		TActivate result = null;
		foreach (MonoBehaviour monoBehaviour in components)
		{
			bool flag = monoBehaviour.GetType() == typeof(TActivate);
			Log(string.Concat(monoBehaviour.GetType(), " is ", typeof(TActivate), " = ", flag.ToString()));
			if (flag)
			{
				result = (TActivate)monoBehaviour;
			}
			if (monoBehaviour.enabled != flag)
			{
				monoBehaviour.enabled = flag;
			}
		}
		return result;
	}

	protected void ActivateHandlers<TInput, TAim, TTarget, TOrientation, TTransition>() where TInput : TeleportInputHandler where TAim : TeleportAimHandler where TTarget : TeleportTargetHandler where TOrientation : TeleportOrientationHandler where TTransition : TeleportTransition
	{
		ActivateInput<TInput>();
		ActivateAim<TAim>();
		ActivateTarget<TTarget>();
		ActivateOrientation<TOrientation>();
		ActivateTransition<TTransition>();
	}

	protected void ActivateInput<TActivate>() where TActivate : TeleportInputHandler
	{
		ActivateCategory<TeleportInputHandler, TActivate>();
	}

	protected void ActivateAim<TActivate>() where TActivate : TeleportAimHandler
	{
		ActivateCategory<TeleportAimHandler, TActivate>();
	}

	protected void ActivateTarget<TActivate>() where TActivate : TeleportTargetHandler
	{
		ActivateCategory<TeleportTargetHandler, TActivate>();
	}

	protected void ActivateOrientation<TActivate>() where TActivate : TeleportOrientationHandler
	{
		ActivateCategory<TeleportOrientationHandler, TActivate>();
	}

	protected void ActivateTransition<TActivate>() where TActivate : TeleportTransition
	{
		ActivateCategory<TeleportTransition, TActivate>();
	}

	protected TActivate ActivateCategory<TCategory, TActivate>() where TCategory : MonoBehaviour where TActivate : MonoBehaviour
	{
		return ActivateCategory<TCategory, TActivate>(lc.gameObject);
	}

	protected void UpdateToggle(Toggle toggle, bool enabled)
	{
		if (enabled != toggle.isOn)
		{
			toggle.isOn = enabled;
		}
	}

	private void SetupNonCap()
	{
		TeleportInputHandlerAvatarTouch component = TeleportController.GetComponent<TeleportInputHandlerAvatarTouch>();
		component.InputMode = TeleportInputHandlerAvatarTouch.InputModes.SeparateButtonsForAimAndTeleport;
		component.AimButton = OVRInput.RawButton.A;
		component.TeleportButton = OVRInput.RawButton.A;
	}

	private void SetupTeleportDefaults()
	{
		TeleportController.enabled = true;
		lc.PlayerController.SnapRotation = true;
		lc.PlayerController.RotationEitherThumbstick = false;
		lc.PlayerController.FixedSpeedSteps = 0;
		TeleportController.EnableMovement(ready: false, aim: false, pre: false, post: false);
		TeleportController.EnableRotation(ready: false, aim: false, pre: false, post: false);
		TeleportInputHandlerAvatarTouch component = TeleportController.GetComponent<TeleportInputHandlerAvatarTouch>();
		component.InputMode = TeleportInputHandlerAvatarTouch.InputModes.CapacitiveButtonForAimAndTeleport;
		component.AimButton = OVRInput.RawButton.A;
		component.TeleportButton = OVRInput.RawButton.A;
		component.CapacitiveAimAndTeleportButton = TeleportInputHandlerAvatarTouch.AimCapTouchButtons.A;
		component.FastTeleport = false;
		TeleportInputHandlerHMD component2 = TeleportController.GetComponent<TeleportInputHandlerHMD>();
		component2.AimButton = OVRInput.RawButton.A;
		component2.TeleportButton = OVRInput.RawButton.A;
		TeleportController.GetComponent<TeleportOrientationHandlerThumbstick>().Thumbstick = OVRInput.Controller.LTouch;
	}

	protected GameObject AddInstance(GameObject template, string label)
	{
		GameObject obj = UnityEngine.Object.Instantiate(template);
		obj.transform.SetParent(base.transform, worldPositionStays: false);
		obj.name = label;
		return obj;
	}

	private void SetupNodeTeleport()
	{
		SetupTeleportDefaults();
		SetupNonCap();
		lc.PlayerController.SnapRotation = true;
		lc.PlayerController.FixedSpeedSteps = 1;
		lc.PlayerController.RotationEitherThumbstick = true;
		TeleportController.EnableRotation(ready: true, aim: false, pre: false, post: true);
		ActivateHandlers<TeleportInputHandlerAvatarTouch, TeleportAimHandlerLaser, TeleportTargetHandlerNode, TeleportOrientationHandlerThumbstick, TeleportTransitionBlink>();
		TeleportController.GetComponent<TeleportInputHandlerAvatarTouch>().AimingController = OVRInput.Controller.RTouch;
	}

	private void SetupTwoStickTeleport()
	{
		SetupTeleportDefaults();
		TeleportController.EnableRotation(ready: true, aim: false, pre: false, post: true);
		TeleportController.EnableMovement(ready: false, aim: false, pre: false, post: false);
		lc.PlayerController.SnapRotation = true;
		lc.PlayerController.RotationEitherThumbstick = true;
		lc.PlayerController.FixedSpeedSteps = 1;
		TeleportInputHandlerAvatarTouch component = TeleportController.GetComponent<TeleportInputHandlerAvatarTouch>();
		component.InputMode = TeleportInputHandlerAvatarTouch.InputModes.ThumbstickTeleportForwardBackOnly;
		component.AimingController = OVRInput.Controller.Touch;
		ActivateHandlers<TeleportInputHandlerAvatarTouch, TeleportAimHandlerParabolic, TeleportTargetHandlerPhysical, TeleportOrientationHandlerThumbstick, TeleportTransitionBlink>();
		TeleportController.GetComponent<TeleportOrientationHandlerThumbstick>().Thumbstick = OVRInput.Controller.Touch;
	}

	private void SetupWalkOnly()
	{
		SetupTeleportDefaults();
		TeleportController.enabled = false;
		lc.PlayerController.EnableLinearMovement = true;
		lc.PlayerController.SnapRotation = true;
		lc.PlayerController.RotationEitherThumbstick = false;
		lc.PlayerController.FixedSpeedSteps = 1;
	}

	private void SetupLeftStrafeRightTeleport()
	{
		SetupTeleportDefaults();
		TeleportController.EnableRotation(ready: true, aim: false, pre: false, post: true);
		TeleportController.EnableMovement(ready: true, aim: false, pre: false, post: false);
		lc.PlayerController.SnapRotation = true;
		lc.PlayerController.FixedSpeedSteps = 1;
		TeleportInputHandlerAvatarTouch component = TeleportController.GetComponent<TeleportInputHandlerAvatarTouch>();
		component.InputMode = TeleportInputHandlerAvatarTouch.InputModes.ThumbstickTeleportForwardBackOnly;
		component.AimingController = OVRInput.Controller.RTouch;
		ActivateHandlers<TeleportInputHandlerAvatarTouch, TeleportAimHandlerParabolic, TeleportTargetHandlerPhysical, TeleportOrientationHandlerThumbstick, TeleportTransitionBlink>();
		TeleportController.GetComponent<TeleportOrientationHandlerThumbstick>().Thumbstick = OVRInput.Controller.RTouch;
	}
}
public class StartMenu : MonoBehaviour
{
	public OVROverlay overlay;

	public OVROverlay text;

	public OVRCameraRig vrRig;

	private void Start()
	{
		DebugUIBuilder.instance.AddLabel("Select Sample Scene");
		DebugUIBuilder.instance.AddButton("Avatar Grab", LoadAvatarGrab);
		DebugUIBuilder.instance.AddButton("Custom Controllers", LoadCustomControllers);
		DebugUIBuilder.instance.AddButton("Custom Hands", LoadCustomHands);
		DebugUIBuilder.instance.AddButton("Debug UI", LoadDebugUI);
		DebugUIBuilder.instance.AddButton("Distance Grab", LoadDistanceGrab);
		DebugUIBuilder.instance.AddButton("Guardian Boundary System", LoadGuardianBoundarySystem);
		DebugUIBuilder.instance.AddButton("Locomotion", LoadLocomotion);
		DebugUIBuilder.instance.AddButton("Mixed Reality Capture", LoadMixedRealityCapture);
		DebugUIBuilder.instance.AddButton("OVR Overlay", LoadOVROverlay);
		DebugUIBuilder.instance.Show();
	}

	private void LoadScene(string sceneName)
	{
		DebugUIBuilder.instance.Hide();
		StartCoroutine(ShowOverlayAndLoad(sceneName));
	}

	private IEnumerator ShowOverlayAndLoad(string sceneName)
	{
		text.transform.position = vrRig.centerEyeAnchor.position + Vector3.ProjectOnPlane(vrRig.centerEyeAnchor.forward, Vector3.up).normalized * 3f;
		overlay.enabled = true;
		text.enabled = true;
		yield return new WaitForSeconds(1f);
		UnityEngine.AsyncOperation asyncLoad = SceneManager.LoadSceneAsync(sceneName);
		while (!asyncLoad.isDone)
		{
			yield return null;
		}
		yield return null;
	}

	private void LoadAvatarGrab()
	{
		LoadScene("AvatarGrab");
	}

	private void LoadCustomControllers()
	{
		LoadScene("CustomControllers");
	}

	private void LoadCustomHands()
	{
		LoadScene("CustomHands");
	}

	private void LoadDebugUI()
	{
		LoadScene("DebugUI");
	}

	private void LoadDistanceGrab()
	{
		LoadScene("DistanceGrab");
	}

	private void LoadGuardianBoundarySystem()
	{
		LoadScene("GuardianBoundarySystem");
	}

	private void LoadLocomotion()
	{
		LoadScene("Locomotion");
	}

	private void LoadMixedRealityCapture()
	{
		LoadScene("MixedRealityCapture");
	}

	private void LoadOVROverlay()
	{
		LoadScene("OVROverlay");
	}
}
[AddComponentMenu("Camera-Control/Mouse Look")]
public class MouseLook : MonoBehaviour
{
	public enum RotationAxes
	{
		MouseXAndY,
		MouseX,
		MouseY
	}

	public RotationAxes axes;

	public float sensitivityX = 15f;

	public float sensitivityY = 15f;

	public float minimumX = -360f;

	public float maximumX = 360f;

	public float minimumY = -60f;

	public float maximumY = 60f;

	private float rotationY;

	private void Update()
	{
		if (axes == RotationAxes.MouseXAndY)
		{
			float y = base.transform.localEulerAngles.y + Input.GetAxis("Mouse X") * sensitivityX;
			rotationY += Input.GetAxis("Mouse Y") * sensitivityY;
			rotationY = Mathf.Clamp(rotationY, minimumY, maximumY);
			base.transform.localEulerAngles = new Vector3(0f - rotationY, y, 0f);
		}
		else if (axes == RotationAxes.MouseX)
		{
			base.transform.Rotate(0f, Input.GetAxis("Mouse X") * sensitivityX, 0f);
		}
		else
		{
			rotationY += Input.GetAxis("Mouse Y") * sensitivityY;
			rotationY = Mathf.Clamp(rotationY, minimumY, maximumY);
			base.transform.localEulerAngles = new Vector3(0f - rotationY, base.transform.localEulerAngles.y, 0f);
		}
	}

	private void Start()
	{
		if ((bool)GetComponent<Rigidbody>())
		{
			GetComponent<Rigidbody>().freezeRotation = true;
		}
	}
}
public struct ReflectionSnapshot
{
	public AudioMixerSnapshot mixerSnapshot;

	public float fadeTime;
}
public class ONSPReflectionZone : MonoBehaviour
{
	public AudioMixerSnapshot mixerSnapshot;

	public float fadeTime;

	private static Stack<ReflectionSnapshot> snapshotList = new Stack<ReflectionSnapshot>();

	private static ReflectionSnapshot currentSnapshot = default(ReflectionSnapshot);

	private void Start()
	{
	}

	private void Update()
	{
	}

	private void OnTriggerEnter(Collider other)
	{
		if (CheckForAudioListener(other.gameObject))
		{
			PushCurrentMixerShapshot();
		}
	}

	private void OnTriggerExit(Collider other)
	{
		if (CheckForAudioListener(other.gameObject))
		{
			PopCurrentMixerSnapshot();
		}
	}

	private bool CheckForAudioListener(GameObject gameObject)
	{
		if (gameObject.GetComponentInChildren<AudioListener>() != null)
		{
			return true;
		}
		return false;
	}

	private void PushCurrentMixerShapshot()
	{
		ReflectionSnapshot item = currentSnapshot;
		snapshotList.Push(item);
		SetReflectionValues();
	}

	private void PopCurrentMixerSnapshot()
	{
		ReflectionSnapshot mss = snapshotList.Pop();
		SetReflectionValues(ref mss);
	}

	private void SetReflectionValues()
	{
		if (mixerSnapshot != null)
		{
			UnityEngine.Debug.Log("Setting off snapshot " + mixerSnapshot.name);
			mixerSnapshot.TransitionTo(fadeTime);
			currentSnapshot.mixerSnapshot = mixerSnapshot;
			currentSnapshot.fadeTime = fadeTime;
		}
		else
		{
			UnityEngine.Debug.Log("Mixer snapshot not set - Please ensure play area has at least one encompassing snapshot.");
		}
	}

	private void SetReflectionValues(ref ReflectionSnapshot mss)
	{
		if (mss.mixerSnapshot != null)
		{
			UnityEngine.Debug.Log("Setting off snapshot " + mss.mixerSnapshot.name);
			mss.mixerSnapshot.TransitionTo(mss.fadeTime);
			currentSnapshot.mixerSnapshot = mss.mixerSnapshot;
			currentSnapshot.fadeTime = mss.fadeTime;
		}
		else
		{
			UnityEngine.Debug.Log("Mixer snapshot not set - Please ensure play area has at least one encompassing snapshot.");
		}
	}
}
public class OculusSpatializerUnity : MonoBehaviour
{
	public delegate void AudioRaycastCallback(Vector3 origin, Vector3 direction, out Vector3 point, out Vector3 normal, IntPtr data);

	public LayerMask layerMask = -1;

	public bool visualizeRoom = true;

	private bool roomVisualizationInitialized;

	public int raysPerSecond = 256;

	public float roomInterpSpeed = 0.9f;

	public float maxWallDistance = 50f;

	public int rayCacheSize = 512;

	public bool dynamicReflectionsEnabled = true;

	private AudioRaycastCallback _raycastCallback;

	private float particleSize = 0.2f;

	private float particleOffset = 0.1f;

	private GameObject room;

	private Renderer[] wallRenderer = new Renderer[6];

	private float[] dims = new float[3] { 1f, 1f, 1f };

	private float[] coefs = new float[6];

	private const int HIT_COUNT = 2048;

	private Vector3[] points = new Vector3[2048];

	private Vector3[] normals = new Vector3[2048];

	private ParticleSystem sys;

	private ParticleSystem.Particle[] particles = new ParticleSystem.Particle[2048];

	private static LayerMask gLayerMask = -1;

	private const string strOSP = "AudioPluginOculusSpatializer";

	private static Vector3 swapHandedness(Vector3 vec)
	{
		return new Vector3(vec.x, vec.y, 0f - vec.z);
	}

	private static void AudioRaycast(Vector3 origin, Vector3 direction, out Vector3 point, out Vector3 normal, IntPtr data)
	{
		point = Vector3.zero;
		normal = Vector3.zero;
		if (Physics.Raycast(swapHandedness(origin), swapHandedness(direction), out var hitInfo, 1000f, gLayerMask.value))
		{
			point = swapHandedness(hitInfo.point);
			normal = swapHandedness(hitInfo.normal);
		}
	}

	private void Start()
	{
		_raycastCallback = AudioRaycast;
		OSP_Unity_AssignRaycastCallback(_raycastCallback, IntPtr.Zero);
	}

	private void OnDestroy()
	{
		OSP_Unity_AssignRaycastCallback(IntPtr.Zero, IntPtr.Zero);
	}

	private void Update()
	{
		if (dynamicReflectionsEnabled)
		{
			OSP_Unity_AssignRaycastCallback(_raycastCallback, IntPtr.Zero);
		}
		else
		{
			OSP_Unity_AssignRaycastCallback(IntPtr.Zero, IntPtr.Zero);
		}
		OSP_Unity_SetDynamicRoomRaysPerSecond(raysPerSecond);
		OSP_Unity_SetDynamicRoomInterpSpeed(roomInterpSpeed);
		OSP_Unity_SetDynamicRoomMaxWallDistance(maxWallDistance);
		OSP_Unity_SetDynamicRoomRaysRayCacheSize(rayCacheSize);
		gLayerMask = layerMask;
		OSP_Unity_UpdateRoomModel(1f);
		if (!visualizeRoom)
		{
			return;
		}
		if (!roomVisualizationInitialized)
		{
			inititalizeRoomVisualization();
			roomVisualizationInitialized = true;
		}
		OSP_Unity_GetRoomDimensions(dims, coefs, out var position);
		position.z *= -1f;
		Vector3 vector = new Vector3(dims[0], dims[1], dims[2]);
		float sqrMagnitude = vector.sqrMagnitude;
		if (!float.IsNaN(sqrMagnitude) && 0f < sqrMagnitude && sqrMagnitude < 1000000f)
		{
			base.transform.localScale = vector * 0.999f;
		}
		base.transform.position = position;
		OSP_Unity_GetRaycastHits(points, normals, 2048);
		for (int i = 0; i < 2048; i++)
		{
			if (points[i] == Vector3.zero)
			{
				points[i].y = -10000f;
			}
			points[i].z *= -1f;
			normals[i].z *= -1f;
			particles[i].position = points[i] + normals[i] * particleOffset;
			if (normals[i] != Vector3.zero)
			{
				particles[i].rotation3D = Quaternion.LookRotation(normals[i]).eulerAngles;
			}
			particles[i].startSize = particleSize;
			particles[i].startColor = new Color(0.8156863f, 0.14901961f, 58f / 85f, 1f);
		}
		for (int j = 0; j < 6; j++)
		{
			Color value = Color.Lerp(Color.red, Color.green, coefs[j]);
			wallRenderer[j].material.SetColor("_TintColor", value);
		}
		sys.SetParticles(particles, particles.Length);
	}

	private void inititalizeRoomVisualization()
	{
		UnityEngine.Debug.Log("Oculus Audio dynamic room estimation visualization enabled");
		base.transform.position = Vector3.zero;
		GameObject gameObject = new GameObject("DecalManager");
		gameObject.transform.parent = base.transform;
		sys = gameObject.AddComponent<ParticleSystem>();
		ParticleSystem.MainModule main = sys.main;
		main.simulationSpace = ParticleSystemSimulationSpace.World;
		main.loop = false;
		main.playOnAwake = false;
		ParticleSystem.EmissionModule emission = sys.emission;
		emission.enabled = false;
		ParticleSystem.ShapeModule shape = sys.shape;
		shape.enabled = false;
		ParticleSystemRenderer component = sys.GetComponent<ParticleSystemRenderer>();
		component.renderMode = ParticleSystemRenderMode.Mesh;
		component.material.shader = Shader.Find("Particles/Additive");
		Texture2D texture2D = new Texture2D(64, 64);
		for (int i = 0; i < 32; i++)
		{
			for (int j = 0; j < 32; j++)
			{
				float num = 32 - i;
				float num2 = 32 - j;
				float num3 = Mathf.Sqrt(num * num + num2 * num2);
				float num4 = 2f * num3 / 32f;
				float a = ((num3 < 32f) ? Mathf.Clamp01(Mathf.Sin((float)Math.PI * 2f * num4)) : 0f);
				Color color = new Color(1f, 1f, 1f, a);
				texture2D.SetPixel(i, j, color);
				texture2D.SetPixel(64 - i, j, color);
				texture2D.SetPixel(i, 64 - j, color);
				texture2D.SetPixel(64 - i, 64 - j, color);
			}
		}
		texture2D.Apply();
		component.material.mainTexture = texture2D;
		Mesh mesh = new Mesh();
		mesh.name = "ParticleQuad";
		mesh.vertices = new Vector3[4]
		{
			new Vector3(-0.5f, -0.5f, 0f),
			new Vector3(0.5f, -0.5f, 0f),
			new Vector3(0.5f, 0.5f, 0f),
			new Vector3(-0.5f, 0.5f, 0f)
		};
		mesh.uv = new Vector2[4]
		{
			new Vector2(0f, 0f),
			new Vector2(0f, 1f),
			new Vector2(1f, 1f),
			new Vector2(1f, 0f)
		};
		mesh.triangles = new int[6] { 0, 1, 2, 0, 2, 3 };
		mesh.RecalculateNormals();
		component.mesh = mesh;
		sys.Emit(2048);
		room = new GameObject("RoomVisualizer");
		room.transform.parent = base.transform;
		room.transform.localPosition = Vector3.zero;
		Texture2D texture2D2 = new Texture2D(32, 32);
		Color color2 = new Color(0f, 0f, 0f, 0f);
		for (int k = 0; k < 32; k++)
		{
			for (int l = 0; l < 32; l++)
			{
				texture2D2.SetPixel(k, l, color2);
			}
		}
		for (int m = 0; m < 32; m++)
		{
			Color color3 = Color.white * 0.125f;
			texture2D2.SetPixel(8, m, color3);
			texture2D2.SetPixel(m, 8, color3);
			texture2D2.SetPixel(24, m, color3);
			texture2D2.SetPixel(m, 24, color3);
			color3 *= 2f;
			texture2D2.SetPixel(16, m, color3);
			texture2D2.SetPixel(m, 16, color3);
			color3 *= 2f;
			texture2D2.SetPixel(0, m, color3);
			texture2D2.SetPixel(m, 0, color3);
		}
		texture2D2.Apply();
		for (int n = 0; n < 6; n++)
		{
			Mesh mesh2 = new Mesh();
			mesh2.name = "Plane" + n;
			Vector3[] array = new Vector3[4];
			int num5 = n / 2;
			int num6 = ((n % 2 == 0) ? 1 : (-1));
			for (int num7 = 0; num7 < 4; num7++)
			{
				array[num7][num5] = (float)num6 * 0.5f;
				array[num7][(num5 + 1) % 3] = 0.5f * (float)((num7 == 1 || num7 == 2) ? 1 : (-1));
				array[num7][(num5 + 2) % 3] = 0.5f * (float)((num7 == 2 || num7 == 3) ? 1 : (-1));
			}
			mesh2.vertices = array;
			mesh2.uv = new Vector2[4]
			{
				new Vector2(0f, 0f),
				new Vector2(0f, 1f),
				new Vector2(1f, 1f),
				new Vector2(1f, 0f)
			};
			mesh2.triangles = new int[6] { 0, 1, 2, 0, 2, 3 };
			mesh2.RecalculateNormals();
			GameObject obj = new GameObject("Wall_" + n);
			obj.AddComponent<MeshFilter>().mesh = mesh2;
			MeshRenderer meshRenderer = obj.AddComponent<MeshRenderer>();
			wallRenderer[n] = meshRenderer;
			meshRenderer.material.shader = Shader.Find("Particles/Additive");
			meshRenderer.material.mainTexture = texture2D2;
			meshRenderer.material.mainTextureScale = new Vector2(8f, 8f);
			obj.transform.parent = room.transform;
			room.transform.localPosition = Vector3.zero;
		}
	}

	[DllImport("AudioPluginOculusSpatializer")]
	private static extern int OSP_Unity_AssignRaycastCallback(MulticastDelegate callback, IntPtr data);

	[DllImport("AudioPluginOculusSpatializer")]
	private static extern int OSP_Unity_AssignRaycastCallback(IntPtr callback, IntPtr data);

	[DllImport("AudioPluginOculusSpatializer")]
	private static extern int OSP_Unity_SetDynamicRoomRaysPerSecond(int RaysPerSecond);

	[DllImport("AudioPluginOculusSpatializer")]
	private static extern int OSP_Unity_SetDynamicRoomInterpSpeed(float InterpSpeed);

	[DllImport("AudioPluginOculusSpatializer")]
	private static extern int OSP_Unity_SetDynamicRoomMaxWallDistance(float MaxWallDistance);

	[DllImport("AudioPluginOculusSpatializer")]
	private static extern int OSP_Unity_SetDynamicRoomRaysRayCacheSize(int RayCacheSize);

	[DllImport("AudioPluginOculusSpatializer")]
	private static extern int OSP_Unity_UpdateRoomModel(float wetLevel);

	[DllImport("AudioPluginOculusSpatializer")]
	private static extern int OSP_Unity_GetRoomDimensions(float[] roomDimensions, float[] reflectionsCoefs, out Vector3 position);

	[DllImport("AudioPluginOculusSpatializer")]
	private static extern int OSP_Unity_GetRaycastHits(Vector3[] points, Vector3[] normals, int length);
}
public class ONSPAmbisonicsNative : MonoBehaviour
{
	public enum ovrAmbisonicsNativeStatus
	{
		Uninitialized = -1,
		NotEnabled,
		Success,
		StreamError,
		ProcessError,
		MaxStatValue
	}

	private static int numFOAChannels = 4;

	private static int paramVSpeakerMode = 6;

	private static int paramAmbiStat = 7;

	private ovrAmbisonicsNativeStatus currentStatus = ovrAmbisonicsNativeStatus.Uninitialized;

	[SerializeField]
	private bool useVirtualSpeakers;

	public bool UseVirtualSpeakers
	{
		get
		{
			return useVirtualSpeakers;
		}
		set
		{
			useVirtualSpeakers = value;
		}
	}

	private void OnEnable()
	{
		AudioSource component = GetComponent<AudioSource>();
		currentStatus = ovrAmbisonicsNativeStatus.Uninitialized;
		if (component == null)
		{
			UnityEngine.Debug.Log("Ambisonic ERROR: AudioSource does not exist.");
			return;
		}
		if (component.spatialize)
		{
			UnityEngine.Debug.Log("Ambisonic WARNING: Turning spatialize field off for Ambisonic sources.");
			component.spatialize = false;
		}
		if (component.clip == null)
		{
			UnityEngine.Debug.Log("Ambisonic ERROR: AudioSource does not contain an audio clip.");
		}
		else if (component.clip.channels != numFOAChannels)
		{
			UnityEngine.Debug.Log("Ambisonic ERROR: AudioSource clip does not have correct number of channels.");
		}
	}

	private void Update()
	{
		AudioSource component = GetComponent<AudioSource>();
		if (component == null)
		{
			return;
		}
		if (useVirtualSpeakers)
		{
			component.SetAmbisonicDecoderFloat(paramVSpeakerMode, 1f);
		}
		else
		{
			component.SetAmbisonicDecoderFloat(paramVSpeakerMode, 0f);
		}
		float value = 0f;
		component.GetAmbisonicDecoderFloat(paramAmbiStat, out value);
		ovrAmbisonicsNativeStatus ovrAmbisonicsNativeStatus = (ovrAmbisonicsNativeStatus)value;
		if (ovrAmbisonicsNativeStatus != currentStatus)
		{
			switch (ovrAmbisonicsNativeStatus)
			{
			case ovrAmbisonicsNativeStatus.NotEnabled:
				UnityEngine.Debug.Log("Ambisonic Native: Ambisonic not enabled on clip. Check clip field and turn it on");
				break;
			case ovrAmbisonicsNativeStatus.Uninitialized:
				UnityEngine.Debug.Log("Ambisonic Native: Stream uninitialized");
				break;
			case ovrAmbisonicsNativeStatus.Success:
				UnityEngine.Debug.Log("Ambisonic Native: Stream successfully initialized and playing/playable");
				break;
			case ovrAmbisonicsNativeStatus.StreamError:
				UnityEngine.Debug.Log("Ambisonic Native WARNING: Stream error (bad input format?)");
				break;
			case ovrAmbisonicsNativeStatus.ProcessError:
				UnityEngine.Debug.Log("Ambisonic Native WARNING: Stream process error (check default speaker setup)");
				break;
			}
		}
		currentStatus = ovrAmbisonicsNativeStatus;
	}
}
public class ONSPAudioSource : MonoBehaviour
{
	private enum Parameters
	{
		P_GAIN,
		P_USEINVSQR,
		P_NEAR,
		P_FAR,
		P_RADIUS,
		P_DISABLE_RFL,
		P_VSPEAKERMODE,
		P_AMBISTAT,
		P_READONLY_GLOBAL_RFL_ENABLED,
		P_READONLY_NUM_VOICES,
		P_SENDLEVEL,
		P_NUM
	}

	public const string strONSPS = "AudioPluginOculusSpatializer";

	[SerializeField]
	private bool enableSpatialization = true;

	[SerializeField]
	private float gain;

	[SerializeField]
	private bool useInvSqr;

	[SerializeField]
	private float near = 0.25f;

	[SerializeField]
	private float far = 250f;

	[SerializeField]
	private float volumetricRadius;

	[SerializeField]
	private float reverbSend;

	[SerializeField]
	private bool enableRfl;

	private static ONSPAudioSource RoomReflectionGizmoAS;

	public bool EnableSpatialization
	{
		get
		{
			return enableSpatialization;
		}
		set
		{
			enableSpatialization = value;
		}
	}

	public float Gain
	{
		get
		{
			return gain;
		}
		set
		{
			gain = Mathf.Clamp(value, 0f, 24f);
		}
	}

	public bool UseInvSqr
	{
		get
		{
			return useInvSqr;
		}
		set
		{
			useInvSqr = value;
		}
	}

	public float Near
	{
		get
		{
			return near;
		}
		set
		{
			near = Mathf.Clamp(value, 0f, 1000000f);
		}
	}

	public float Far
	{
		get
		{
			return far;
		}
		set
		{
			far = Mathf.Clamp(value, 0f, 1000000f);
		}
	}

	public float VolumetricRadius
	{
		get
		{
			return volumetricRadius;
		}
		set
		{
			volumetricRadius = Mathf.Clamp(value, 0f, 1000f);
		}
	}

	public float ReverbSend
	{
		get
		{
			return reverbSend;
		}
		set
		{
			reverbSend = Mathf.Clamp(value, -60f, 20f);
		}
	}

	public bool EnableRfl
	{
		get
		{
			return enableRfl;
		}
		set
		{
			enableRfl = value;
		}
	}

	[RuntimeInitializeOnLoadMethod(RuntimeInitializeLoadType.BeforeSceneLoad)]
	private static void OnBeforeSceneLoadRuntimeMethod()
	{
		OSP_SetGlobalVoiceLimit(ONSPSettings.Instance.voiceLimit);
	}

	[DllImport("AudioPluginOculusSpatializer")]
	private static extern void ONSP_GetGlobalRoomReflectionValues(ref bool reflOn, ref bool reverbOn, ref float width, ref float height, ref float length);

	private void Awake()
	{
		AudioSource source = GetComponent<AudioSource>();
		SetParameters(ref source);
	}

	private void Start()
	{
	}

	private void Update()
	{
		AudioSource source = GetComponent<AudioSource>();
		if (!UnityEngine.Application.isPlaying || AudioListener.pause || !source.isPlaying || !source.isActiveAndEnabled)
		{
			source.spatialize = false;
		}
		else
		{
			SetParameters(ref source);
		}
	}

	public void SetParameters(ref AudioSource source)
	{
		source.spatialize = enableSpatialization;
		source.SetSpatializerFloat(0, gain);
		if (useInvSqr)
		{
			source.SetSpatializerFloat(1, 1f);
		}
		else
		{
			source.SetSpatializerFloat(1, 0f);
		}
		source.SetSpatializerFloat(2, near);
		source.SetSpatializerFloat(3, far);
		source.SetSpatializerFloat(4, volumetricRadius);
		if (enableRfl)
		{
			source.SetSpatializerFloat(5, 0f);
		}
		else
		{
			source.SetSpatializerFloat(5, 1f);
		}
		source.SetSpatializerFloat(10, reverbSend);
	}

	private void OnDrawGizmos()
	{
		if (RoomReflectionGizmoAS == null)
		{
			RoomReflectionGizmoAS = this;
		}
		Color color = default(Color);
		color.r = 1f;
		color.g = 0.5f;
		color.b = 0f;
		color.a = 1f;
		Gizmos.color = color;
		Gizmos.DrawWireSphere(base.transform.position, Near);
		color.a = 0.1f;
		Gizmos.color = color;
		Gizmos.DrawSphere(base.transform.position, Near);
		color.r = 1f;
		color.g = 0f;
		color.b = 0f;
		color.a = 1f;
		Gizmos.color = Color.red;
		Gizmos.DrawWireSphere(base.transform.position, Far);
		color.a = 0.1f;
		Gizmos.color = color;
		Gizmos.DrawSphere(base.transform.position, Far);
		color.r = 1f;
		color.g = 0f;
		color.b = 1f;
		color.a = 1f;
		Gizmos.color = color;
		Gizmos.DrawWireSphere(base.transform.position, VolumetricRadius);
		color.a = 0.1f;
		Gizmos.color = color;
		Gizmos.DrawSphere(base.transform.position, VolumetricRadius);
		if (RoomReflectionGizmoAS == this)
		{
			bool reflOn = false;
			bool reverbOn = false;
			float width = 1f;
			float height = 1f;
			float length = 1f;
			ONSP_GetGlobalRoomReflectionValues(ref reflOn, ref reverbOn, ref width, ref height, ref length);
			if (Camera.main != null && reflOn)
			{
				color = (Gizmos.color = ((!reverbOn) ? Color.cyan : Color.white));
				Gizmos.DrawWireCube(Camera.main.transform.position, new Vector3(width, height, length));
				color.a = 0.1f;
				Gizmos.color = color;
				Gizmos.DrawCube(Camera.main.transform.position, new Vector3(width, height, length));
			}
		}
	}

	private void OnDestroy()
	{
		if (RoomReflectionGizmoAS == this)
		{
			RoomReflectionGizmoAS = null;
		}
	}

	[DllImport("AudioPluginOculusSpatializer")]
	private static extern int OSP_SetGlobalVoiceLimit(int VoiceLimit);
}
public class ONSPProfiler : MonoBehaviour
{
	public bool profilerEnabled;

	private const int DEFAULT_PORT = 2121;

	public int port = 2121;

	public const string strONSPS = "AudioPluginOculusSpatializer";

	private void Start()
	{
		UnityEngine.Application.runInBackground = true;
	}

	private void Update()
	{
		if (port < 0 || port > 65535)
		{
			port = 2121;
		}
		ONSP_SetProfilerPort(port);
		ONSP_SetProfilerEnabled(profilerEnabled);
	}

	[DllImport("AudioPluginOculusSpatializer")]
	private static extern int ONSP_SetProfilerEnabled(bool enabled);

	[DllImport("AudioPluginOculusSpatializer")]
	private static extern int ONSP_SetProfilerPort(int port);
}
public class ONSPPropagationGeometry : MonoBehaviour
{
	private struct MeshMaterial
	{
		public MeshFilter meshFilter;

		public ONSPPropagationMaterial[] materials;
	}

	private struct TerrainMaterial
	{
		public Terrain terrain;

		public ONSPPropagationMaterial[] materials;

		public Mesh[] treePrototypeMeshes;
	}

	public static string GeometryAssetDirectory = "AudioGeometry";

	public string filePathRelative = "";

	public bool fileEnabled;

	public bool includeChildMeshes = true;

	private IntPtr geometryHandle = IntPtr.Zero;

	public static int OSPSuccess = 0;

	public const string GEOMETRY_FILE_EXTENSION = "ovramesh";

	private static int terrainDecimation = 4;

	public static string GeometryAssetPath => UnityEngine.Application.streamingAssetsPath + "/" + GeometryAssetDirectory;

	public string filePath => GeometryAssetPath + "/" + filePathRelative;

	private static string GetPath(Transform current)
	{
		if (current.parent == null)
		{
			return current.gameObject.scene.name + "/" + current.name;
		}
		return GetPath(current.parent) + "-" + current.name;
	}

	private void Awake()
	{
		CreatePropagationGeometry();
	}

	private void CreatePropagationGeometry()
	{
		if (ONSPPropagation.Interface.CreateAudioGeometry(out geometryHandle) != OSPSuccess)
		{
			throw new Exception("Unable to create geometry handle");
		}
		if (filePath != null && filePath.Length != 0 && fileEnabled && UnityEngine.Application.isPlaying)
		{
			if (!ReadFile())
			{
				UnityEngine.Debug.LogError("Failed to read file, attempting to regenerate audio geometry");
				UploadGeometry();
			}
		}
		else
		{
			UploadGeometry();
		}
	}

	private void Update()
	{
		if (!(geometryHandle == IntPtr.Zero))
		{
			Matrix4x4 localToWorldMatrix = base.transform.localToWorldMatrix;
			float[] matrix4x = new float[16]
			{
				localToWorldMatrix[0, 0],
				localToWorldMatrix[1, 0],
				0f - localToWorldMatrix[2, 0],
				localToWorldMatrix[3, 0],
				localToWorldMatrix[0, 1],
				localToWorldMatrix[1, 1],
				0f - localToWorldMatrix[2, 1],
				localToWorldMatrix[3, 1],
				localToWorldMatrix[0, 2],
				localToWorldMatrix[1, 2],
				0f - localToWorldMatrix[2, 2],
				localToWorldMatrix[3, 2],
				localToWorldMatrix[0, 3],
				localToWorldMatrix[1, 3],
				0f - localToWorldMatrix[2, 3],
				localToWorldMatrix[3, 3]
			};
			ONSPPropagation.Interface.AudioGeometrySetTransform(geometryHandle, matrix4x);
		}
	}

	private void OnDestroy()
	{
		if (geometryHandle != IntPtr.Zero && ONSPPropagation.Interface.DestroyAudioGeometry(geometryHandle) != OSPSuccess)
		{
			throw new Exception("Unable to destroy geometry");
		}
		geometryHandle = IntPtr.Zero;
	}

	private static void traverseMeshHierarchy(GameObject obj, ONSPPropagationMaterial[] currentMaterials, bool includeChildren, List<MeshMaterial> meshMaterials, List<TerrainMaterial> terrainMaterials, bool ignoreStatic, ref int ignoredMeshCount)
	{
		if (!obj.activeInHierarchy)
		{
			return;
		}
		MeshFilter[] components = obj.GetComponents<MeshFilter>();
		Terrain[] components2 = obj.GetComponents<Terrain>();
		ONSPPropagationMaterial[] components3 = obj.GetComponents<ONSPPropagationMaterial>();
		if (components3 != null && components3.Length != 0)
		{
			int num = components3.Length;
			if (currentMaterials != null)
			{
				num = Math.Max(num, currentMaterials.Length);
			}
			ONSPPropagationMaterial[] array = new ONSPPropagationMaterial[num];
			if (currentMaterials != null)
			{
				for (int i = components3.Length; i < num; i++)
				{
					array[i] = currentMaterials[i];
				}
			}
			currentMaterials = array;
			for (int j = 0; j < components3.Length; j++)
			{
				currentMaterials[j] = components3[j];
			}
		}
		MeshFilter[] array2 = components;
		foreach (MeshFilter meshFilter in array2)
		{
			Mesh sharedMesh = meshFilter.sharedMesh;
			if (!(sharedMesh == null))
			{
				if (ignoreStatic && !sharedMesh.isReadable)
				{
					UnityEngine.Debug.LogWarning("Mesh: " + meshFilter.gameObject.name + " not readable, cannot be static.", meshFilter.gameObject);
					ignoredMeshCount++;
					continue;
				}
				MeshMaterial item = default(MeshMaterial);
				item.meshFilter = meshFilter;
				item.materials = currentMaterials;
				meshMaterials.Add(item);
			}
		}
		Terrain[] array3 = components2;
		foreach (Terrain terrain in array3)
		{
			TerrainMaterial item2 = default(TerrainMaterial);
			item2.terrain = terrain;
			item2.materials = currentMaterials;
			terrainMaterials.Add(item2);
		}
		if (!includeChildren)
		{
			return;
		}
		foreach (Transform item3 in obj.transform)
		{
			if (item3.GetComponent<ONSPPropagationGeometry>() == null)
			{
				traverseMeshHierarchy(item3.gameObject, currentMaterials, includeChildren, meshMaterials, terrainMaterials, ignoreStatic, ref ignoredMeshCount);
			}
		}
	}

	private int uploadMesh(IntPtr geometryHandle, GameObject meshObject, Matrix4x4 worldToLocal)
	{
		int ignoredMeshCount = 0;
		return uploadMesh(geometryHandle, meshObject, worldToLocal, ignoreStatic: false, ref ignoredMeshCount);
	}

	private int uploadMesh(IntPtr geometryHandle, GameObject meshObject, Matrix4x4 worldToLocal, bool ignoreStatic, ref int ignoredMeshCount)
	{
		List<MeshMaterial> list = new List<MeshMaterial>();
		List<TerrainMaterial> list2 = new List<TerrainMaterial>();
		traverseMeshHierarchy(meshObject, null, includeChildMeshes, list, list2, ignoreStatic, ref ignoredMeshCount);
		ONSPPropagationMaterial[] array = new ONSPPropagationMaterial[1] { base.gameObject.AddComponent<ONSPPropagationMaterial>() };
		array[0].SetPreset(ONSPPropagationMaterial.Preset.Foliage);
		int totalVertexCount = 0;
		uint totalIndexCount = 0u;
		int totalFaceCount = 0;
		int totalMaterialCount = 0;
		foreach (MeshMaterial item in list)
		{
			updateCountsForMesh(ref totalVertexCount, ref totalIndexCount, ref totalFaceCount, ref totalMaterialCount, item.meshFilter.sharedMesh);
		}
		for (int i = 0; i < list2.Count; i++)
		{
			TerrainMaterial value = list2[i];
			TerrainData terrainData = value.terrain.terrainData;
			int heightmapWidth = terrainData.heightmapWidth;
			int heightmapHeight = terrainData.heightmapHeight;
			int num = (heightmapWidth - 1) / terrainDecimation + 1;
			int num2 = (heightmapHeight - 1) / terrainDecimation + 1;
			int num3 = num * num2;
			int num4 = (num - 1) * (num2 - 1) * 6;
			totalMaterialCount++;
			totalVertexCount += num3;
			totalIndexCount += (uint)num4;
			totalFaceCount += num4 / 3;
			TreePrototype[] treePrototypes = terrainData.treePrototypes;
			value.treePrototypeMeshes = new Mesh[treePrototypes.Length];
			for (int j = 0; j < treePrototypes.Length; j++)
			{
				MeshFilter[] componentsInChildren = treePrototypes[j].prefab.GetComponentsInChildren<MeshFilter>();
				int num5 = int.MaxValue;
				int num6 = -1;
				for (int k = 0; k < componentsInChildren.Length; k++)
				{
					int vertexCount = componentsInChildren[k].sharedMesh.vertexCount;
					if (vertexCount < num5)
					{
						num5 = vertexCount;
						num6 = k;
					}
				}
				value.treePrototypeMeshes[j] = componentsInChildren[num6].sharedMesh;
			}
			TreeInstance[] treeInstances = terrainData.treeInstances;
			for (int l = 0; l < treeInstances.Length; l++)
			{
				TreeInstance treeInstance = treeInstances[l];
				updateCountsForMesh(ref totalVertexCount, ref totalIndexCount, ref totalFaceCount, ref totalMaterialCount, value.treePrototypeMeshes[treeInstance.prototypeIndex]);
			}
			list2[i] = value;
		}
		List<Vector3> tempVertices = new List<Vector3>();
		List<int> tempIndices = new List<int>();
		MeshGroup[] array2 = new MeshGroup[totalMaterialCount];
		float[] array3 = new float[totalVertexCount * 3];
		int[] array4 = new int[totalIndexCount];
		int vertexOffset = 0;
		int indexOffset = 0;
		int groupOffset = 0;
		foreach (MeshMaterial item2 in list)
		{
			MeshFilter meshFilter = item2.meshFilter;
			Matrix4x4 matrix = worldToLocal * meshFilter.gameObject.transform.localToWorldMatrix;
			uploadMeshFilter(tempVertices, tempIndices, array2, array3, array4, ref vertexOffset, ref indexOffset, ref groupOffset, meshFilter.sharedMesh, item2.materials, matrix);
		}
		foreach (TerrainMaterial item3 in list2)
		{
			TerrainData terrainData2 = item3.terrain.terrainData;
			Matrix4x4 matrix4x = worldToLocal * item3.terrain.gameObject.transform.localToWorldMatrix;
			int heightmapWidth2 = terrainData2.heightmapWidth;
			int heightmapHeight2 = terrainData2.heightmapHeight;
			float[,] heights = terrainData2.GetHeights(0, 0, heightmapWidth2, heightmapHeight2);
			Vector3 size = terrainData2.size;
			size = new Vector3(size.x / (float)(heightmapWidth2 - 1) * (float)terrainDecimation, size.y, size.z / (float)(heightmapHeight2 - 1) * (float)terrainDecimation);
			int num7 = (heightmapWidth2 - 1) / terrainDecimation + 1;
			int num8 = (heightmapHeight2 - 1) / terrainDecimation + 1;
			int num9 = num7 * num8;
			int num10 = (num7 - 1) * (num8 - 1) * 2;
			array2[groupOffset].faceType = FaceType.TRIANGLES;
			array2[groupOffset].faceCount = (UIntPtr)(ulong)num10;
			array2[groupOffset].indexOffset = (UIntPtr)(ulong)indexOffset;
			if (item3.materials != null && item3.materials.Length != 0)
			{
				item3.materials[0].StartInternal();
				array2[groupOffset].material = item3.materials[0].materialHandle;
			}
			else
			{
				array2[groupOffset].material = IntPtr.Zero;
			}
			for (int m = 0; m < num8; m++)
			{
				for (int n = 0; n < num7; n++)
				{
					int num11 = (vertexOffset + m * num7 + n) * 3;
					Vector3 vector = matrix4x.MultiplyPoint3x4(Vector3.Scale(size, new Vector3(m, heights[n * terrainDecimation, m * terrainDecimation], n)));
					array3[num11] = vector.x;
					array3[num11 + 1] = vector.y;
					array3[num11 + 2] = vector.z;
				}
			}
			for (int num12 = 0; num12 < num8 - 1; num12++)
			{
				for (int num13 = 0; num13 < num7 - 1; num13++)
				{
					array4[indexOffset] = vertexOffset + num12 * num7 + num13;
					array4[indexOffset + 1] = vertexOffset + (num12 + 1) * num7 + num13;
					array4[indexOffset + 2] = vertexOffset + num12 * num7 + num13 + 1;
					array4[indexOffset + 3] = vertexOffset + (num12 + 1) * num7 + num13;
					array4[indexOffset + 4] = vertexOffset + (num12 + 1) * num7 + num13 + 1;
					array4[indexOffset + 5] = vertexOffset + num12 * num7 + num13 + 1;
					indexOffset += 6;
				}
			}
			vertexOffset += num9;
			groupOffset++;
			TreeInstance[] treeInstances = terrainData2.treeInstances;
			for (int l = 0; l < treeInstances.Length; l++)
			{
				TreeInstance treeInstance2 = treeInstances[l];
				Vector3 vector2 = Vector3.Scale(treeInstance2.position, terrainData2.size);
				Matrix4x4 localToWorldMatrix = item3.terrain.gameObject.transform.localToWorldMatrix;
				localToWorldMatrix.SetColumn(3, localToWorldMatrix.GetColumn(3) + new Vector4(vector2.x, vector2.y, vector2.z, 0f));
				Matrix4x4 matrix2 = worldToLocal * localToWorldMatrix;
				uploadMeshFilter(tempVertices, tempIndices, array2, array3, array4, ref vertexOffset, ref indexOffset, ref groupOffset, item3.treePrototypeMeshes[treeInstance2.prototypeIndex], array, matrix2);
			}
		}
		return ONSPPropagation.Interface.AudioGeometryUploadMeshArrays(geometryHandle, array3, totalVertexCount, array4, array4.Length, array2, array2.Length);
	}

	private static void uploadMeshFilter(List<Vector3> tempVertices, List<int> tempIndices, MeshGroup[] groups, float[] vertices, int[] indices, ref int vertexOffset, ref int indexOffset, ref int groupOffset, Mesh mesh, ONSPPropagationMaterial[] materials, Matrix4x4 matrix)
	{
		tempVertices.Clear();
		mesh.GetVertices(tempVertices);
		int count = tempVertices.Count;
		for (int i = 0; i < count; i++)
		{
			Vector3 vector = matrix.MultiplyPoint3x4(tempVertices[i]);
			int num = (vertexOffset + i) * 3;
			vertices[num] = vector.x;
			vertices[num + 1] = vector.y;
			vertices[num + 2] = vector.z;
		}
		for (int j = 0; j < mesh.subMeshCount; j++)
		{
			MeshTopology topology = mesh.GetTopology(j);
			if (topology != 0 && topology != MeshTopology.Quads)
			{
				continue;
			}
			tempIndices.Clear();
			mesh.GetIndices(tempIndices, j);
			int count2 = tempIndices.Count;
			for (int k = 0; k < count2; k++)
			{
				indices[indexOffset + k] = tempIndices[k] + vertexOffset;
			}
			switch (topology)
			{
			case MeshTopology.Triangles:
				groups[groupOffset + j].faceType = FaceType.TRIANGLES;
				groups[groupOffset + j].faceCount = (UIntPtr)(ulong)(count2 / 3);
				break;
			case MeshTopology.Quads:
				groups[groupOffset + j].faceType = FaceType.QUADS;
				groups[groupOffset + j].faceCount = (UIntPtr)(ulong)(count2 / 4);
				break;
			}
			groups[groupOffset + j].indexOffset = (UIntPtr)(ulong)indexOffset;
			if (materials != null && materials.Length != 0)
			{
				int num2 = j;
				if (num2 >= materials.Length)
				{
					num2 = materials.Length - 1;
				}
				materials[num2].StartInternal();
				groups[groupOffset + j].material = materials[num2].materialHandle;
			}
			else
			{
				groups[groupOffset + j].material = IntPtr.Zero;
			}
			indexOffset += count2;
		}
		vertexOffset += count;
		groupOffset += mesh.subMeshCount;
	}

	private static void updateCountsForMesh(ref int totalVertexCount, ref uint totalIndexCount, ref int totalFaceCount, ref int totalMaterialCount, Mesh mesh)
	{
		totalMaterialCount += mesh.subMeshCount;
		totalVertexCount += mesh.vertexCount;
		for (int i = 0; i < mesh.subMeshCount; i++)
		{
			MeshTopology topology = mesh.GetTopology(i);
			if (topology == MeshTopology.Triangles || topology == MeshTopology.Quads)
			{
				uint indexCount = mesh.GetIndexCount(i);
				totalIndexCount += indexCount;
				switch (topology)
				{
				case MeshTopology.Triangles:
					totalFaceCount += (int)indexCount / 3;
					break;
				case MeshTopology.Quads:
					totalFaceCount += (int)indexCount / 4;
					break;
				}
			}
		}
	}

	public void UploadGeometry()
	{
		int ignoredMeshCount = 0;
		if (uploadMesh(geometryHandle, base.gameObject, base.gameObject.transform.worldToLocalMatrix, ignoreStatic: true, ref ignoredMeshCount) != OSPSuccess)
		{
			throw new Exception("Unable to upload audio mesh geometry");
		}
		if (ignoredMeshCount != 0)
		{
			UnityEngine.Debug.LogError("Failed to upload meshes, " + ignoredMeshCount + " static meshes ignored. Turn on \"File Enabled\" to process static meshes offline", base.gameObject);
		}
	}

	public bool ReadFile()
	{
		if (filePath == null || filePath.Length == 0)
		{
			UnityEngine.Debug.LogError("Invalid mesh file path");
			return false;
		}
		if (ONSPPropagation.Interface.AudioGeometryReadMeshFile(geometryHandle, filePath) != OSPSuccess)
		{
			UnityEngine.Debug.LogError("Error reading mesh file " + filePath);
			return false;
		}
		return true;
	}

	public bool WriteToObj()
	{
		IntPtr geometry = IntPtr.Zero;
		if (ONSPPropagation.Interface.CreateAudioGeometry(out geometry) != OSPSuccess)
		{
			throw new Exception("Failed to create temp geometry handle");
		}
		if (uploadMesh(geometry, base.gameObject, base.gameObject.transform.worldToLocalMatrix) != OSPSuccess)
		{
			UnityEngine.Debug.LogError("Error uploading mesh " + base.gameObject.name);
			return false;
		}
		if (ONSPPropagation.Interface.AudioGeometryWriteMeshFileObj(geometry, filePath + ".obj") != OSPSuccess)
		{
			UnityEngine.Debug.LogError("Error writing .obj file " + filePath + ".obj");
			return false;
		}
		if (ONSPPropagation.Interface.DestroyAudioGeometry(geometry) != OSPSuccess)
		{
			throw new Exception("Failed to destroy temp geometry handle");
		}
		return true;
	}
}
internal class ONSPPropagation
{
	public enum ovrAudioScalarType : uint
	{
		Int8,
		UInt8,
		Int16,
		UInt16,
		Int32,
		UInt32,
		Int64,
		UInt64,
		Float16,
		Float32,
		Float64
	}

	public class ClientType
	{
		public const uint OVRA_CLIENT_TYPE_NATIVE = 0u;

		public const uint OVRA_CLIENT_TYPE_WWISE_2016 = 1u;

		public const uint OVRA_CLIENT_TYPE_WWISE_2017_1 = 2u;

		public const uint OVRA_CLIENT_TYPE_WWISE_2017_2 = 3u;

		public const uint OVRA_CLIENT_TYPE_WWISE_2018_1 = 4u;

		public const uint OVRA_CLIENT_TYPE_FMOD = 5u;

		public const uint OVRA_CLIENT_TYPE_UNITY = 6u;

		public const uint OVRA_CLIENT_TYPE_UE4 = 7u;

		public const uint OVRA_CLIENT_TYPE_VST = 8u;

		public const uint OVRA_CLIENT_TYPE_AAX = 9u;

		public const uint OVRA_CLIENT_TYPE_TEST = 10u;

		public const uint OVRA_CLIENT_TYPE_OTHER = 11u;

		public const uint OVRA_CLIENT_TYPE_WWISE_UNKNOWN = 12u;
	}

	public interface PropagationInterface
	{
		int SetPropagationQuality(float quality);

		int SetPropagationThreadAffinity(ulong cpuMask);

		int CreateAudioGeometry(out IntPtr geometry);

		int DestroyAudioGeometry(IntPtr geometry);

		int AudioGeometryUploadMeshArrays(IntPtr geometry, float[] vertices, int vertexCount, int[] indices, int indexCount, MeshGroup[] groups, int groupCount);

		int AudioGeometrySetTransform(IntPtr geometry, float[] matrix4x4);

		int AudioGeometryGetTransform(IntPtr geometry, out float[] matrix4x4);

		int AudioGeometryWriteMeshFile(IntPtr geometry, string filePath);

		int AudioGeometryReadMeshFile(IntPtr geometry, string filePath);

		int AudioGeometryWriteMeshFileObj(IntPtr geometry, string filePath);

		int AudioMaterialGetFrequency(IntPtr material, MaterialProperty property, float frequency, out float value);

		int CreateAudioMaterial(out IntPtr material);

		int DestroyAudioMaterial(IntPtr material);

		int AudioMaterialSetFrequency(IntPtr material, MaterialProperty property, float frequency, float value);

		int AudioMaterialReset(IntPtr material, MaterialProperty property);
	}

	public class UnityNativeInterface : PropagationInterface
	{
		public const string strOSPS = "AudioPluginOculusSpatializer";

		private IntPtr context_ = IntPtr.Zero;

		private IntPtr context
		{
			get
			{
				if (context_ == IntPtr.Zero)
				{
					ovrAudio_GetPluginContext(out context_, 6u);
				}
				return context_;
			}
		}

		[DllImport("AudioPluginOculusSpatializer")]
		public static extern int ovrAudio_GetPluginContext(out IntPtr context, uint clientType);

		[DllImport("AudioPluginOculusSpatializer")]
		private static extern int ovrAudio_SetPropagationQuality(IntPtr context, float quality);

		public int SetPropagationQuality(float quality)
		{
			return ovrAudio_SetPropagationQuality(context, quality);
		}

		[DllImport("AudioPluginOculusSpatializer")]
		private static extern int ovrAudio_SetPropagationThreadAffinity(IntPtr context, ulong cpuMask);

		public int SetPropagationThreadAffinity(ulong cpuMask)
		{
			return ovrAudio_SetPropagationThreadAffinity(context, cpuMask);
		}

		[DllImport("AudioPluginOculusSpatializer")]
		private static extern int ovrAudio_CreateAudioGeometry(IntPtr context, out IntPtr geometry);

		public int CreateAudioGeometry(out IntPtr geometry)
		{
			return ovrAudio_CreateAudioGeometry(context, out geometry);
		}

		[DllImport("AudioPluginOculusSpatializer")]
		private static extern int ovrAudio_DestroyAudioGeometry(IntPtr geometry);

		public int DestroyAudioGeometry(IntPtr geometry)
		{
			return ovrAudio_DestroyAudioGeometry(geometry);
		}

		[DllImport("AudioPluginOculusSpatializer")]
		private static extern int ovrAudio_AudioGeometryUploadMeshArrays(IntPtr geometry, float[] vertices, UIntPtr verticesBytesOffset, UIntPtr vertexCount, UIntPtr vertexStride, ovrAudioScalarType vertexType, int[] indices, UIntPtr indicesByteOffset, UIntPtr indexCount, ovrAudioScalarType indexType, MeshGroup[] groups, UIntPtr groupCount);

		public int AudioGeometryUploadMeshArrays(IntPtr geometry, float[] vertices, int vertexCount, int[] indices, int indexCount, MeshGroup[] groups, int groupCount)
		{
			return ovrAudio_AudioGeometryUploadMeshArrays(geometry, vertices, UIntPtr.Zero, (UIntPtr)(ulong)vertexCount, UIntPtr.Zero, ovrAudioScalarType.Float32, indices, UIntPtr.Zero, (UIntPtr)(ulong)indexCount, ovrAudioScalarType.UInt32, groups, (UIntPtr)(ulong)groupCount);
		}

		[DllImport("AudioPluginOculusSpatializer")]
		private static extern int ovrAudio_AudioGeometrySetTransform(IntPtr geometry, float[] matrix4x4);

		public int AudioGeometrySetTransform(IntPtr geometry, float[] matrix4x4)
		{
			return ovrAudio_AudioGeometrySetTransform(geometry, matrix4x4);
		}

		[DllImport("AudioPluginOculusSpatializer")]
		private static extern int ovrAudio_AudioGeometryGetTransform(IntPtr geometry, out float[] matrix4x4);

		public int AudioGeometryGetTransform(IntPtr geometry, out float[] matrix4x4)
		{
			return ovrAudio_AudioGeometryGetTransform(geometry, out matrix4x4);
		}

		[DllImport("AudioPluginOculusSpatializer")]
		private static extern int ovrAudio_AudioGeometryWriteMeshFile(IntPtr geometry, string filePath);

		public int AudioGeometryWriteMeshFile(IntPtr geometry, string filePath)
		{
			return ovrAudio_AudioGeometryWriteMeshFile(geometry, filePath);
		}

		[DllImport("AudioPluginOculusSpatializer")]
		private static extern int ovrAudio_AudioGeometryReadMeshFile(IntPtr geometry, string filePath);

		public int AudioGeometryReadMeshFile(IntPtr geometry, string filePath)
		{
			return ovrAudio_AudioGeometryReadMeshFile(geometry, filePath);
		}

		[DllImport("AudioPluginOculusSpatializer")]
		private static extern int ovrAudio_AudioGeometryWriteMeshFileObj(IntPtr geometry, string filePath);

		public int AudioGeometryWriteMeshFileObj(IntPtr geometry, string filePath)
		{
			return ovrAudio_AudioGeometryWriteMeshFileObj(geometry, filePath);
		}

		[DllImport("AudioPluginOculusSpatializer")]
		private static extern int ovrAudio_CreateAudioMaterial(IntPtr context, out IntPtr material);

		public int CreateAudioMaterial(out IntPtr material)
		{
			return ovrAudio_CreateAudioMaterial(context, out material);
		}

		[DllImport("AudioPluginOculusSpatializer")]
		private static extern int ovrAudio_DestroyAudioMaterial(IntPtr material);

		public int DestroyAudioMaterial(IntPtr material)
		{
			return ovrAudio_DestroyAudioMaterial(material);
		}

		[DllImport("AudioPluginOculusSpatializer")]
		private static extern int ovrAudio_AudioMaterialSetFrequency(IntPtr material, MaterialProperty property, float frequency, float value);

		public int AudioMaterialSetFrequency(IntPtr material, MaterialProperty property, float frequency, float value)
		{
			return ovrAudio_AudioMaterialSetFrequency(material, property, frequency, value);
		}

		[DllImport("AudioPluginOculusSpatializer")]
		private static extern int ovrAudio_AudioMaterialGetFrequency(IntPtr material, MaterialProperty property, float frequency, out float value);

		public int AudioMaterialGetFrequency(IntPtr material, MaterialProperty property, float frequency, out float value)
		{
			return ovrAudio_AudioMaterialGetFrequency(material, property, frequency, out value);
		}

		[DllImport("AudioPluginOculusSpatializer")]
		private static extern int ovrAudio_AudioMaterialReset(IntPtr material, MaterialProperty property);

		public int AudioMaterialReset(IntPtr material, MaterialProperty property)
		{
			return ovrAudio_AudioMaterialReset(material, property);
		}
	}

	public class WwisePluginInterface : PropagationInterface
	{
		public const string strOSPS = "OculusSpatializerWwise";

		private IntPtr context_ = IntPtr.Zero;

		private IntPtr context
		{
			get
			{
				if (context_ == IntPtr.Zero)
				{
					ovrAudio_GetPluginContext(out context_, 12u);
				}
				return context_;
			}
		}

		[DllImport("OculusSpatializerWwise")]
		public static extern int ovrAudio_GetPluginContext(out IntPtr context, uint clientType);

		[DllImport("OculusSpatializerWwise")]
		private static extern int ovrAudio_SetPropagationQuality(IntPtr context, float quality);

		public int SetPropagationQuality(float quality)
		{
			return ovrAudio_SetPropagationQuality(context, quality);
		}

		[DllImport("OculusSpatializerWwise")]
		private static extern int ovrAudio_SetPropagationThreadAffinity(IntPtr context, ulong cpuMask);

		public int SetPropagationThreadAffinity(ulong cpuMask)
		{
			return ovrAudio_SetPropagationThreadAffinity(context, cpuMask);
		}

		[DllImport("OculusSpatializerWwise")]
		private static extern int ovrAudio_CreateAudioGeometry(IntPtr context, out IntPtr geometry);

		public int CreateAudioGeometry(out IntPtr geometry)
		{
			return ovrAudio_CreateAudioGeometry(context, out geometry);
		}

		[DllImport("OculusSpatializerWwise")]
		private static extern int ovrAudio_DestroyAudioGeometry(IntPtr geometry);

		public int DestroyAudioGeometry(IntPtr geometry)
		{
			return ovrAudio_DestroyAudioGeometry(geometry);
		}

		[DllImport("OculusSpatializerWwise")]
		private static extern int ovrAudio_AudioGeometryUploadMeshArrays(IntPtr geometry, float[] vertices, UIntPtr verticesBytesOffset, UIntPtr vertexCount, UIntPtr vertexStride, ovrAudioScalarType vertexType, int[] indices, UIntPtr indicesByteOffset, UIntPtr indexCount, ovrAudioScalarType indexType, MeshGroup[] groups, UIntPtr groupCount);

		public int AudioGeometryUploadMeshArrays(IntPtr geometry, float[] vertices, int vertexCount, int[] indices, int indexCount, MeshGroup[] groups, int groupCount)
		{
			return ovrAudio_AudioGeometryUploadMeshArrays(geometry, vertices, UIntPtr.Zero, (UIntPtr)(ulong)vertexCount, UIntPtr.Zero, ovrAudioScalarType.Float32, indices, UIntPtr.Zero, (UIntPtr)(ulong)indexCount, ovrAudioScalarType.UInt32, groups, (UIntPtr)(ulong)groupCount);
		}

		[DllImport("OculusSpatializerWwise")]
		private static extern int ovrAudio_AudioGeometrySetTransform(IntPtr geometry, float[] matrix4x4);

		public int AudioGeometrySetTransform(IntPtr geometry, float[] matrix4x4)
		{
			return ovrAudio_AudioGeometrySetTransform(geometry, matrix4x4);
		}

		[DllImport("OculusSpatializerWwise")]
		private static extern int ovrAudio_AudioGeometryGetTransform(IntPtr geometry, out float[] matrix4x4);

		public int AudioGeometryGetTransform(IntPtr geometry, out float[] matrix4x4)
		{
			return ovrAudio_AudioGeometryGetTransform(geometry, out matrix4x4);
		}

		[DllImport("OculusSpatializerWwise")]
		private static extern int ovrAudio_AudioGeometryWriteMeshFile(IntPtr geometry, string filePath);

		public int AudioGeometryWriteMeshFile(IntPtr geometry, string filePath)
		{
			return ovrAudio_AudioGeometryWriteMeshFile(geometry, filePath);
		}

		[DllImport("OculusSpatializerWwise")]
		private static extern int ovrAudio_AudioGeometryReadMeshFile(IntPtr geometry, string filePath);

		public int AudioGeometryReadMeshFile(IntPtr geometry, string filePath)
		{
			return ovrAudio_AudioGeometryReadMeshFile(geometry, filePath);
		}

		[DllImport("OculusSpatializerWwise")]
		private static extern int ovrAudio_AudioGeometryWriteMeshFileObj(IntPtr geometry, string filePath);

		public int AudioGeometryWriteMeshFileObj(IntPtr geometry, string filePath)
		{
			return ovrAudio_AudioGeometryWriteMeshFileObj(geometry, filePath);
		}

		[DllImport("OculusSpatializerWwise")]
		private static extern int ovrAudio_CreateAudioMaterial(IntPtr context, out IntPtr material);

		public int CreateAudioMaterial(out IntPtr material)
		{
			return ovrAudio_CreateAudioMaterial(context, out material);
		}

		[DllImport("OculusSpatializerWwise")]
		private static extern int ovrAudio_DestroyAudioMaterial(IntPtr material);

		public int DestroyAudioMaterial(IntPtr material)
		{
			return ovrAudio_DestroyAudioMaterial(material);
		}

		[DllImport("OculusSpatializerWwise")]
		private static extern int ovrAudio_AudioMaterialSetFrequency(IntPtr material, MaterialProperty property, float frequency, float value);

		public int AudioMaterialSetFrequency(IntPtr material, MaterialProperty property, float frequency, float value)
		{
			return ovrAudio_AudioMaterialSetFrequency(material, property, frequency, value);
		}

		[DllImport("OculusSpatializerWwise")]
		private static extern int ovrAudio_AudioMaterialGetFrequency(IntPtr material, MaterialProperty property, float frequency, out float value);

		public int AudioMaterialGetFrequency(IntPtr material, MaterialProperty property, float frequency, out float value)
		{
			return ovrAudio_AudioMaterialGetFrequency(material, property, frequency, out value);
		}

		[DllImport("OculusSpatializerWwise")]
		private static extern int ovrAudio_AudioMaterialReset(IntPtr material, MaterialProperty property);

		public int AudioMaterialReset(IntPtr material, MaterialProperty property)
		{
			return ovrAudio_AudioMaterialReset(material, property);
		}
	}

	public class FMODPluginInterface : PropagationInterface
	{
		public const string strOSPS = "OculusSpatializerFMOD";

		private IntPtr context_ = IntPtr.Zero;

		private IntPtr context
		{
			get
			{
				if (context_ == IntPtr.Zero)
				{
					ovrAudio_GetPluginContext(out context_, 5u);
				}
				return context_;
			}
		}

		[DllImport("OculusSpatializerFMOD")]
		public static extern int ovrAudio_GetPluginContext(out IntPtr context, uint clientType);

		[DllImport("OculusSpatializerFMOD")]
		private static extern int ovrAudio_SetPropagationQuality(IntPtr context, float quality);

		public int SetPropagationQuality(float quality)
		{
			return ovrAudio_SetPropagationQuality(context, quality);
		}

		[DllImport("OculusSpatializerFMOD")]
		private static extern int ovrAudio_SetPropagationThreadAffinity(IntPtr context, ulong cpuMask);

		public int SetPropagationThreadAffinity(ulong cpuMask)
		{
			return ovrAudio_SetPropagationThreadAffinity(context, cpuMask);
		}

		[DllImport("OculusSpatializerFMOD")]
		private static extern int ovrAudio_CreateAudioGeometry(IntPtr context, out IntPtr geometry);

		public int CreateAudioGeometry(out IntPtr geometry)
		{
			return ovrAudio_CreateAudioGeometry(context, out geometry);
		}

		[DllImport("OculusSpatializerFMOD")]
		private static extern int ovrAudio_DestroyAudioGeometry(IntPtr geometry);

		public int DestroyAudioGeometry(IntPtr geometry)
		{
			return ovrAudio_DestroyAudioGeometry(geometry);
		}

		[DllImport("OculusSpatializerFMOD")]
		private static extern int ovrAudio_AudioGeometryUploadMeshArrays(IntPtr geometry, float[] vertices, UIntPtr verticesBytesOffset, UIntPtr vertexCount, UIntPtr vertexStride, ovrAudioScalarType vertexType, int[] indices, UIntPtr indicesByteOffset, UIntPtr indexCount, ovrAudioScalarType indexType, MeshGroup[] groups, UIntPtr groupCount);

		public int AudioGeometryUploadMeshArrays(IntPtr geometry, float[] vertices, int vertexCount, int[] indices, int indexCount, MeshGroup[] groups, int groupCount)
		{
			return ovrAudio_AudioGeometryUploadMeshArrays(geometry, vertices, UIntPtr.Zero, (UIntPtr)(ulong)vertexCount, UIntPtr.Zero, ovrAudioScalarType.Float32, indices, UIntPtr.Zero, (UIntPtr)(ulong)indexCount, ovrAudioScalarType.UInt32, groups, (UIntPtr)(ulong)groupCount);
		}

		[DllImport("OculusSpatializerFMOD")]
		private static extern int ovrAudio_AudioGeometrySetTransform(IntPtr geometry, float[] matrix4x4);

		public int AudioGeometrySetTransform(IntPtr geometry, float[] matrix4x4)
		{
			return ovrAudio_AudioGeometrySetTransform(geometry, matrix4x4);
		}

		[DllImport("OculusSpatializerFMOD")]
		private static extern int ovrAudio_AudioGeometryGetTransform(IntPtr geometry, out float[] matrix4x4);

		public int AudioGeometryGetTransform(IntPtr geometry, out float[] matrix4x4)
		{
			return ovrAudio_AudioGeometryGetTransform(geometry, out matrix4x4);
		}

		[DllImport("OculusSpatializerFMOD")]
		private static extern int ovrAudio_AudioGeometryWriteMeshFile(IntPtr geometry, string filePath);

		public int AudioGeometryWriteMeshFile(IntPtr geometry, string filePath)
		{
			return ovrAudio_AudioGeometryWriteMeshFile(geometry, filePath);
		}

		[DllImport("OculusSpatializerFMOD")]
		private static extern int ovrAudio_AudioGeometryReadMeshFile(IntPtr geometry, string filePath);

		public int AudioGeometryReadMeshFile(IntPtr geometry, string filePath)
		{
			return ovrAudio_AudioGeometryReadMeshFile(geometry, filePath);
		}

		[DllImport("OculusSpatializerFMOD")]
		private static extern int ovrAudio_AudioGeometryWriteMeshFileObj(IntPtr geometry, string filePath);

		public int AudioGeometryWriteMeshFileObj(IntPtr geometry, string filePath)
		{
			return ovrAudio_AudioGeometryWriteMeshFileObj(geometry, filePath);
		}

		[DllImport("OculusSpatializerFMOD")]
		private static extern int ovrAudio_CreateAudioMaterial(IntPtr context, out IntPtr material);

		public int CreateAudioMaterial(out IntPtr material)
		{
			return ovrAudio_CreateAudioMaterial(context, out material);
		}

		[DllImport("OculusSpatializerFMOD")]
		private static extern int ovrAudio_DestroyAudioMaterial(IntPtr material);

		public int DestroyAudioMaterial(IntPtr material)
		{
			return ovrAudio_DestroyAudioMaterial(material);
		}

		[DllImport("OculusSpatializerFMOD")]
		private static extern int ovrAudio_AudioMaterialSetFrequency(IntPtr material, MaterialProperty property, float frequency, float value);

		public int AudioMaterialSetFrequency(IntPtr material, MaterialProperty property, float frequency, float value)
		{
			return ovrAudio_AudioMaterialSetFrequency(material, property, frequency, value);
		}

		[DllImport("OculusSpatializerFMOD")]
		private static extern int ovrAudio_AudioMaterialGetFrequency(IntPtr material, MaterialProperty property, float frequency, out float value);

		public int AudioMaterialGetFrequency(IntPtr material, MaterialProperty property, float frequency, out float value)
		{
			return ovrAudio_AudioMaterialGetFrequency(material, property, frequency, out value);
		}

		[DllImport("OculusSpatializerFMOD")]
		private static extern int ovrAudio_AudioMaterialReset(IntPtr material, MaterialProperty property);

		public int AudioMaterialReset(IntPtr material, MaterialProperty property)
		{
			return ovrAudio_AudioMaterialReset(material, property);
		}
	}

	private static PropagationInterface CachedInterface;

	public static PropagationInterface Interface
	{
		get
		{
			if (CachedInterface == null)
			{
				CachedInterface = FindInterface();
			}
			return CachedInterface;
		}
	}

	private static PropagationInterface FindInterface()
	{
		IntPtr context;
		try
		{
			WwisePluginInterface.ovrAudio_GetPluginContext(out context, 12u);
			UnityEngine.Debug.Log("Propagation initialized with Wwise Oculus Spatializer plugin");
			return new WwisePluginInterface();
		}
		catch (DllNotFoundException)
		{
		}
		try
		{
			FMODPluginInterface.ovrAudio_GetPluginContext(out context, 5u);
			UnityEngine.Debug.Log("Propagation initialized with FMOD Oculus Spatializer plugin");
			return new FMODPluginInterface();
		}
		catch (DllNotFoundException)
		{
		}
		UnityEngine.Debug.Log("Propagation initialized with Unity Oculus Spatializer plugin");
		return new UnityNativeInterface();
	}
}
public sealed class ONSPPropagationMaterial : MonoBehaviour
{
	public enum Preset
	{
		Custom,
		AcousticTile,
		Brick,
		BrickPainted,
		Carpet,
		CarpetHeavy,
		CarpetHeavyPadded,
		CeramicTile,
		Concrete,
		ConcreteRough,
		ConcreteBlock,
		ConcreteBlockPainted,
		Curtain,
		Foliage,
		Glass,
		GlassHeavy,
		Grass,
		Gravel,
		GypsumBoard,
		PlasterOnBrick,
		PlasterOnConcreteBlock,
		Soil,
		SoundProof,
		Snow,
		Steel,
		Water,
		WoodThin,
		WoodThick,
		WoodFloor,
		WoodOnConcrete
	}

	[Serializable]
	public sealed class Point
	{
		public float frequency;

		public float data;

		public Point(float frequency = 0f, float data = 0f)
		{
			this.frequency = frequency;
			this.data = data;
		}

		public static implicit operator Point(Vector2 v)
		{
			return new Point(v.x, v.y);
		}

		public static implicit operator Vector2(Point point)
		{
			return new Vector2(point.frequency, point.data);
		}
	}

	[Serializable]
	public sealed class Spectrum
	{
		public int selection = int.MaxValue;

		public List<Point> points = new List<Point>();

		public float this[float f]
		{
			get
			{
				if (points.Count > 0)
				{
					Point point = new Point(float.MinValue);
					Point point2 = new Point(float.MaxValue);
					foreach (Point point3 in points)
					{
						if (point3.frequency < f)
						{
							if (point3.frequency > point.frequency)
							{
								point = point3;
							}
						}
						else if (point3.frequency < point2.frequency)
						{
							point2 = point3;
						}
					}
					if (point.frequency == float.MinValue)
					{
						point.data = points.OrderBy((Point p) => p.frequency).First().data;
					}
					if (point2.frequency == float.MaxValue)
					{
						point2.data = points.OrderBy((Point p) => p.frequency).Last().data;
					}
					return point.data + (f - point.frequency) * (point2.data - point.data) / (point2.frequency - point.frequency);
				}
				return 0f;
			}
		}
	}

	public IntPtr materialHandle = IntPtr.Zero;

	[Tooltip("Absorption")]
	public Spectrum absorption = new Spectrum();

	[Tooltip("Transmission")]
	public Spectrum transmission = new Spectrum();

	[Tooltip("Scattering")]
	public Spectrum scattering = new Spectrum();

	[SerializeField]
	private Preset preset_;

	public Preset preset
	{
		get
		{
			return preset_;
		}
		set
		{
			SetPreset(value);
			preset_ = value;
		}
	}

	private void Start()
	{
		StartInternal();
	}

	public void StartInternal()
	{
		if (!(materialHandle != IntPtr.Zero))
		{
			if (ONSPPropagation.Interface.CreateAudioMaterial(out materialHandle) != ONSPPropagationGeometry.OSPSuccess)
			{
				throw new Exception("Unable to create internal audio material");
			}
			UploadMaterial();
		}
	}

	private void OnDestroy()
	{
		DestroyInternal();
	}

	public void DestroyInternal()
	{
		if (materialHandle != IntPtr.Zero)
		{
			ONSPPropagation.Interface.DestroyAudioMaterial(materialHandle);
			materialHandle = IntPtr.Zero;
		}
	}

	public void UploadMaterial()
	{
		if (materialHandle == IntPtr.Zero)
		{
			return;
		}
		ONSPPropagation.Interface.AudioMaterialReset(materialHandle, MaterialProperty.ABSORPTION);
		foreach (Point point in absorption.points)
		{
			ONSPPropagation.Interface.AudioMaterialSetFrequency(materialHandle, MaterialProperty.ABSORPTION, point.frequency, point.data);
		}
		ONSPPropagation.Interface.AudioMaterialReset(materialHandle, MaterialProperty.TRANSMISSION);
		foreach (Point point2 in transmission.points)
		{
			ONSPPropagation.Interface.AudioMaterialSetFrequency(materialHandle, MaterialProperty.TRANSMISSION, point2.frequency, point2.data);
		}
		ONSPPropagation.Interface.AudioMaterialReset(materialHandle, MaterialProperty.SCATTERING);
		foreach (Point point3 in scattering.points)
		{
			ONSPPropagation.Interface.AudioMaterialSetFrequency(materialHandle, MaterialProperty.SCATTERING, point3.frequency, point3.data);
		}
	}

	public void SetPreset(Preset preset)
	{
		ONSPPropagationMaterial material = this;
		switch (preset)
		{
		case Preset.AcousticTile:
			AcousticTile(ref material);
			break;
		case Preset.Brick:
			Brick(ref material);
			break;
		case Preset.BrickPainted:
			BrickPainted(ref material);
			break;
		case Preset.Carpet:
			Carpet(ref material);
			break;
		case Preset.CarpetHeavy:
			CarpetHeavy(ref material);
			break;
		case Preset.CarpetHeavyPadded:
			CarpetHeavyPadded(ref material);
			break;
		case Preset.CeramicTile:
			CeramicTile(ref material);
			break;
		case Preset.Concrete:
			Concrete(ref material);
			break;
		case Preset.ConcreteRough:
			ConcreteRough(ref material);
			break;
		case Preset.ConcreteBlock:
			ConcreteBlock(ref material);
			break;
		case Preset.ConcreteBlockPainted:
			ConcreteBlockPainted(ref material);
			break;
		case Preset.Curtain:
			Curtain(ref material);
			break;
		case Preset.Foliage:
			Foliage(ref material);
			break;
		case Preset.Glass:
			Glass(ref material);
			break;
		case Preset.GlassHeavy:
			GlassHeavy(ref material);
			break;
		case Preset.Grass:
			Grass(ref material);
			break;
		case Preset.Gravel:
			Gravel(ref material);
			break;
		case Preset.GypsumBoard:
			GypsumBoard(ref material);
			break;
		case Preset.PlasterOnBrick:
			PlasterOnBrick(ref material);
			break;
		case Preset.PlasterOnConcreteBlock:
			PlasterOnConcreteBlock(ref material);
			break;
		case Preset.Soil:
			Soil(ref material);
			break;
		case Preset.SoundProof:
			SoundProof(ref material);
			break;
		case Preset.Snow:
			Snow(ref material);
			break;
		case Preset.Steel:
			Steel(ref material);
			break;
		case Preset.Water:
			Water(ref material);
			break;
		case Preset.WoodThin:
			WoodThin(ref material);
			break;
		case Preset.WoodThick:
			WoodThick(ref material);
			break;
		case Preset.WoodFloor:
			WoodFloor(ref material);
			break;
		case Preset.WoodOnConcrete:
			WoodOnConcrete(ref material);
			break;
		case Preset.Custom:
			break;
		}
	}

	private static void AcousticTile(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.5f),
			new Point(250f, 0.7f),
			new Point(500f, 0.6f),
			new Point(1000f, 0.7f),
			new Point(2000f, 0.7f),
			new Point(4000f, 0.5f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.15f),
			new Point(500f, 0.2f),
			new Point(1000f, 0.2f),
			new Point(2000f, 0.25f),
			new Point(4000f, 0.3f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.05f),
			new Point(250f, 0.04f),
			new Point(500f, 0.03f),
			new Point(1000f, 0.02f),
			new Point(2000f, 0.005f),
			new Point(4000f, 0.002f)
		};
	}

	private static void Brick(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.02f),
			new Point(250f, 0.02f),
			new Point(500f, 0.03f),
			new Point(1000f, 0.04f),
			new Point(2000f, 0.05f),
			new Point(4000f, 0.07f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.2f),
			new Point(250f, 0.25f),
			new Point(500f, 0.3f),
			new Point(1000f, 0.35f),
			new Point(2000f, 0.4f),
			new Point(4000f, 0.45f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.025f),
			new Point(250f, 0.019f),
			new Point(500f, 0.01f),
			new Point(1000f, 0.0045f),
			new Point(2000f, 0.0018f),
			new Point(4000f, 0.00089f)
		};
	}

	private static void BrickPainted(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.01f),
			new Point(250f, 0.01f),
			new Point(500f, 0.02f),
			new Point(1000f, 0.02f),
			new Point(2000f, 0.02f),
			new Point(4000f, 0.03f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.15f),
			new Point(250f, 0.15f),
			new Point(500f, 0.2f),
			new Point(1000f, 0.2f),
			new Point(2000f, 0.2f),
			new Point(4000f, 0.25f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.025f),
			new Point(250f, 0.019f),
			new Point(500f, 0.01f),
			new Point(1000f, 0.0045f),
			new Point(2000f, 0.0018f),
			new Point(4000f, 0.00089f)
		};
	}

	private static void Carpet(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.01f),
			new Point(250f, 0.05f),
			new Point(500f, 0.1f),
			new Point(1000f, 0.2f),
			new Point(2000f, 0.45f),
			new Point(4000f, 0.65f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.1f),
			new Point(500f, 0.15f),
			new Point(1000f, 0.2f),
			new Point(2000f, 0.3f),
			new Point(4000f, 0.45f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.004f),
			new Point(250f, 0.0079f),
			new Point(500f, 0.0056f),
			new Point(1000f, 0.0016f),
			new Point(2000f, 0.0014f),
			new Point(4000f, 0.0005f)
		};
	}

	private static void CarpetHeavy(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.02f),
			new Point(250f, 0.06f),
			new Point(500f, 0.14f),
			new Point(1000f, 0.37f),
			new Point(2000f, 0.48f),
			new Point(4000f, 0.63f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.15f),
			new Point(500f, 0.2f),
			new Point(1000f, 0.25f),
			new Point(2000f, 0.35f),
			new Point(4000f, 0.5f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.004f),
			new Point(250f, 0.0079f),
			new Point(500f, 0.0056f),
			new Point(1000f, 0.0016f),
			new Point(2000f, 0.0014f),
			new Point(4000f, 0.0005f)
		};
	}

	private static void CarpetHeavyPadded(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.08f),
			new Point(250f, 0.24f),
			new Point(500f, 0.57f),
			new Point(1000f, 0.69f),
			new Point(2000f, 0.71f),
			new Point(4000f, 0.73f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.15f),
			new Point(500f, 0.2f),
			new Point(1000f, 0.25f),
			new Point(2000f, 0.35f),
			new Point(4000f, 0.5f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.004f),
			new Point(250f, 0.0079f),
			new Point(500f, 0.0056f),
			new Point(1000f, 0.0016f),
			new Point(2000f, 0.0014f),
			new Point(4000f, 0.0005f)
		};
	}

	private static void CeramicTile(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.01f),
			new Point(250f, 0.01f),
			new Point(500f, 0.01f),
			new Point(1000f, 0.01f),
			new Point(2000f, 0.02f),
			new Point(4000f, 0.02f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.12f),
			new Point(500f, 0.14f),
			new Point(1000f, 0.16f),
			new Point(2000f, 0.18f),
			new Point(4000f, 0.2f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.004f),
			new Point(250f, 0.0079f),
			new Point(500f, 0.0056f),
			new Point(1000f, 0.0016f),
			new Point(2000f, 0.0014f),
			new Point(4000f, 0.0005f)
		};
	}

	private static void Concrete(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.01f),
			new Point(250f, 0.01f),
			new Point(500f, 0.02f),
			new Point(1000f, 0.02f),
			new Point(2000f, 0.02f),
			new Point(4000f, 0.02f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.11f),
			new Point(500f, 0.12f),
			new Point(1000f, 0.13f),
			new Point(2000f, 0.14f),
			new Point(4000f, 0.15f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.004f),
			new Point(250f, 0.0079f),
			new Point(500f, 0.0056f),
			new Point(1000f, 0.0016f),
			new Point(2000f, 0.0014f),
			new Point(4000f, 0.0005f)
		};
	}

	private static void ConcreteRough(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.01f),
			new Point(250f, 0.02f),
			new Point(500f, 0.04f),
			new Point(1000f, 0.06f),
			new Point(2000f, 0.08f),
			new Point(4000f, 0.1f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.12f),
			new Point(500f, 0.15f),
			new Point(1000f, 0.2f),
			new Point(2000f, 0.25f),
			new Point(4000f, 0.3f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.004f),
			new Point(250f, 0.0079f),
			new Point(500f, 0.0056f),
			new Point(1000f, 0.0016f),
			new Point(2000f, 0.0014f),
			new Point(4000f, 0.0005f)
		};
	}

	private static void ConcreteBlock(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.36f),
			new Point(250f, 0.44f),
			new Point(500f, 0.31f),
			new Point(1000f, 0.29f),
			new Point(2000f, 0.39f),
			new Point(4000f, 0.21f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.12f),
			new Point(500f, 0.15f),
			new Point(1000f, 0.2f),
			new Point(2000f, 0.3f),
			new Point(4000f, 0.4f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.02f),
			new Point(250f, 0.01f),
			new Point(500f, 0.0063f),
			new Point(1000f, 0.0035f),
			new Point(2000f, 0.00011f),
			new Point(4000f, 0.00063f)
		};
	}

	private static void ConcreteBlockPainted(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.05f),
			new Point(500f, 0.06f),
			new Point(1000f, 0.07f),
			new Point(2000f, 0.09f),
			new Point(4000f, 0.08f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.11f),
			new Point(500f, 0.13f),
			new Point(1000f, 0.15f),
			new Point(2000f, 0.16f),
			new Point(4000f, 0.2f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.02f),
			new Point(250f, 0.01f),
			new Point(500f, 0.0063f),
			new Point(1000f, 0.0035f),
			new Point(2000f, 0.00011f),
			new Point(4000f, 0.00063f)
		};
	}

	private static void Curtain(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.07f),
			new Point(250f, 0.31f),
			new Point(500f, 0.49f),
			new Point(1000f, 0.75f),
			new Point(2000f, 0.7f),
			new Point(4000f, 0.6f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.15f),
			new Point(500f, 0.2f),
			new Point(1000f, 0.3f),
			new Point(2000f, 0.4f),
			new Point(4000f, 0.5f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.42f),
			new Point(250f, 0.39f),
			new Point(500f, 0.21f),
			new Point(1000f, 0.14f),
			new Point(2000f, 0.079f),
			new Point(4000f, 0.045f)
		};
	}

	private static void Foliage(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.03f),
			new Point(250f, 0.06f),
			new Point(500f, 0.11f),
			new Point(1000f, 0.17f),
			new Point(2000f, 0.27f),
			new Point(4000f, 0.31f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.2f),
			new Point(250f, 0.3f),
			new Point(500f, 0.4f),
			new Point(1000f, 0.5f),
			new Point(2000f, 0.7f),
			new Point(4000f, 0.8f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.9f),
			new Point(250f, 0.9f),
			new Point(500f, 0.9f),
			new Point(1000f, 0.8f),
			new Point(2000f, 0.5f),
			new Point(4000f, 0.3f)
		};
	}

	private static void Glass(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.35f),
			new Point(250f, 0.25f),
			new Point(500f, 0.18f),
			new Point(1000f, 0.12f),
			new Point(2000f, 0.07f),
			new Point(4000f, 0.05f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.05f),
			new Point(250f, 0.05f),
			new Point(500f, 0.05f),
			new Point(1000f, 0.05f),
			new Point(2000f, 0.05f),
			new Point(4000f, 0.05f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.125f),
			new Point(250f, 0.089f),
			new Point(500f, 0.05f),
			new Point(1000f, 0.028f),
			new Point(2000f, 0.022f),
			new Point(4000f, 0.079f)
		};
	}

	private static void GlassHeavy(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.18f),
			new Point(250f, 0.06f),
			new Point(500f, 0.04f),
			new Point(1000f, 0.03f),
			new Point(2000f, 0.02f),
			new Point(4000f, 0.02f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.05f),
			new Point(250f, 0.05f),
			new Point(500f, 0.05f),
			new Point(1000f, 0.05f),
			new Point(2000f, 0.05f),
			new Point(4000f, 0.05f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.056f),
			new Point(250f, 0.039f),
			new Point(500f, 0.028f),
			new Point(1000f, 0.02f),
			new Point(2000f, 0.032f),
			new Point(4000f, 0.014f)
		};
	}

	private static void Grass(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.11f),
			new Point(250f, 0.26f),
			new Point(500f, 0.6f),
			new Point(1000f, 0.69f),
			new Point(2000f, 0.92f),
			new Point(4000f, 0.99f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.3f),
			new Point(250f, 0.3f),
			new Point(500f, 0.4f),
			new Point(1000f, 0.5f),
			new Point(2000f, 0.6f),
			new Point(4000f, 0.7f)
		};
		material.transmission.points = new List<Point>();
	}

	private static void Gravel(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.25f),
			new Point(250f, 0.6f),
			new Point(500f, 0.65f),
			new Point(1000f, 0.7f),
			new Point(2000f, 0.75f),
			new Point(4000f, 0.8f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.2f),
			new Point(250f, 0.3f),
			new Point(500f, 0.4f),
			new Point(1000f, 0.5f),
			new Point(2000f, 0.6f),
			new Point(4000f, 0.7f)
		};
		material.transmission.points = new List<Point>();
	}

	private static void GypsumBoard(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.29f),
			new Point(250f, 0.1f),
			new Point(500f, 0.05f),
			new Point(1000f, 0.04f),
			new Point(2000f, 0.07f),
			new Point(4000f, 0.09f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.11f),
			new Point(500f, 0.12f),
			new Point(1000f, 0.13f),
			new Point(2000f, 0.14f),
			new Point(4000f, 0.15f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.035f),
			new Point(250f, 0.0125f),
			new Point(500f, 0.0056f),
			new Point(1000f, 0.0025f),
			new Point(2000f, 0.0013f),
			new Point(4000f, 0.0032f)
		};
	}

	private static void PlasterOnBrick(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.01f),
			new Point(250f, 0.02f),
			new Point(500f, 0.02f),
			new Point(1000f, 0.03f),
			new Point(2000f, 0.04f),
			new Point(4000f, 0.05f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.2f),
			new Point(250f, 0.25f),
			new Point(500f, 0.3f),
			new Point(1000f, 0.35f),
			new Point(2000f, 0.4f),
			new Point(4000f, 0.45f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.025f),
			new Point(250f, 0.019f),
			new Point(500f, 0.01f),
			new Point(1000f, 0.0045f),
			new Point(2000f, 0.0018f),
			new Point(4000f, 0.00089f)
		};
	}

	private static void PlasterOnConcreteBlock(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.12f),
			new Point(250f, 0.09f),
			new Point(500f, 0.07f),
			new Point(1000f, 0.05f),
			new Point(2000f, 0.05f),
			new Point(4000f, 0.04f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.2f),
			new Point(250f, 0.25f),
			new Point(500f, 0.3f),
			new Point(1000f, 0.35f),
			new Point(2000f, 0.4f),
			new Point(4000f, 0.45f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.02f),
			new Point(250f, 0.01f),
			new Point(500f, 0.0063f),
			new Point(1000f, 0.0035f),
			new Point(2000f, 0.00011f),
			new Point(4000f, 0.00063f)
		};
	}

	private static void Soil(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.15f),
			new Point(250f, 0.25f),
			new Point(500f, 0.4f),
			new Point(1000f, 0.55f),
			new Point(2000f, 0.6f),
			new Point(4000f, 0.6f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.2f),
			new Point(500f, 0.25f),
			new Point(1000f, 0.4f),
			new Point(2000f, 0.55f),
			new Point(4000f, 0.7f)
		};
		material.transmission.points = new List<Point>();
	}

	private static void SoundProof(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(1000f, 1f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(1000f)
		};
		material.transmission.points = new List<Point>();
	}

	private static void Snow(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.45f),
			new Point(250f, 0.75f),
			new Point(500f, 0.9f),
			new Point(1000f, 0.95f),
			new Point(2000f, 0.95f),
			new Point(4000f, 0.95f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.2f),
			new Point(250f, 0.3f),
			new Point(500f, 0.4f),
			new Point(1000f, 0.5f),
			new Point(2000f, 0.6f),
			new Point(4000f, 0.75f)
		};
		material.transmission.points = new List<Point>();
	}

	private static void Steel(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.05f),
			new Point(250f, 0.1f),
			new Point(500f, 0.1f),
			new Point(1000f, 0.1f),
			new Point(2000f, 0.07f),
			new Point(4000f, 0.02f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.1f),
			new Point(500f, 0.1f),
			new Point(1000f, 0.1f),
			new Point(2000f, 0.1f),
			new Point(4000f, 0.1f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.25f),
			new Point(250f, 0.2f),
			new Point(500f, 0.17f),
			new Point(1000f, 0.089f),
			new Point(2000f, 0.089f),
			new Point(4000f, 0.0056f)
		};
	}

	private static void Water(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.01f),
			new Point(250f, 0.01f),
			new Point(500f, 0.01f),
			new Point(1000f, 0.02f),
			new Point(2000f, 0.02f),
			new Point(4000f, 0.03f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.1f),
			new Point(500f, 0.1f),
			new Point(1000f, 0.07f),
			new Point(2000f, 0.05f),
			new Point(4000f, 0.05f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.03f),
			new Point(250f, 0.03f),
			new Point(500f, 0.03f),
			new Point(1000f, 0.02f),
			new Point(2000f, 0.015f),
			new Point(4000f, 0.01f)
		};
	}

	private static void WoodThin(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.42f),
			new Point(250f, 0.21f),
			new Point(500f, 0.1f),
			new Point(1000f, 0.08f),
			new Point(2000f, 0.06f),
			new Point(4000f, 0.06f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.1f),
			new Point(500f, 0.1f),
			new Point(1000f, 0.1f),
			new Point(2000f, 0.1f),
			new Point(4000f, 0.15f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.2f),
			new Point(250f, 0.125f),
			new Point(500f, 0.079f),
			new Point(1000f, 0.1f),
			new Point(2000f, 0.089f),
			new Point(4000f, 0.05f)
		};
	}

	private static void WoodThick(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.19f),
			new Point(250f, 0.14f),
			new Point(500f, 0.09f),
			new Point(1000f, 0.06f),
			new Point(2000f, 0.06f),
			new Point(4000f, 0.05f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.1f),
			new Point(500f, 0.1f),
			new Point(1000f, 0.1f),
			new Point(2000f, 0.1f),
			new Point(4000f, 0.15f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.035f),
			new Point(250f, 0.028f),
			new Point(500f, 0.028f),
			new Point(1000f, 0.028f),
			new Point(2000f, 0.011f),
			new Point(4000f, 0.0071f)
		};
	}

	private static void WoodFloor(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.15f),
			new Point(250f, 0.11f),
			new Point(500f, 0.1f),
			new Point(1000f, 0.07f),
			new Point(2000f, 0.06f),
			new Point(4000f, 0.07f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.1f),
			new Point(500f, 0.1f),
			new Point(1000f, 0.1f),
			new Point(2000f, 0.1f),
			new Point(4000f, 0.15f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.071f),
			new Point(250f, 0.025f),
			new Point(500f, 0.0158f),
			new Point(1000f, 0.0056f),
			new Point(2000f, 0.0035f),
			new Point(4000f, 0.0016f)
		};
	}

	private static void WoodOnConcrete(ref ONSPPropagationMaterial material)
	{
		material.absorption.points = new List<Point>
		{
			new Point(125f, 0.04f),
			new Point(250f, 0.04f),
			new Point(500f, 0.07f),
			new Point(1000f, 0.06f),
			new Point(2000f, 0.06f),
			new Point(4000f, 0.07f)
		};
		material.scattering.points = new List<Point>
		{
			new Point(125f, 0.1f),
			new Point(250f, 0.1f),
			new Point(500f, 0.1f),
			new Point(1000f, 0.1f),
			new Point(2000f, 0.1f),
			new Point(4000f, 0.15f)
		};
		material.transmission.points = new List<Point>
		{
			new Point(125f, 0.004f),
			new Point(250f, 0.0079f),
			new Point(500f, 0.0056f),
			new Point(1000f, 0.0016f),
			new Point(2000f, 0.0014f),
			new Point(4000f, 0.0005f)
		};
	}
}
public class ONSPPropagationSettings : MonoBehaviour
{
	public float quality = 100f;

	private void Update()
	{
		ONSPPropagation.Interface.SetPropagationQuality(quality / 100f);
	}
}
public sealed class ONSPSettings : ScriptableObject
{
	[SerializeField]
	public int voiceLimit = 64;

	private static ONSPSettings instance;

	public static ONSPSettings Instance
	{
		get
		{
			if (instance == null)
			{
				instance = Resources.Load<ONSPSettings>("ONSPSettings");
				if (instance == null)
				{
					instance = ScriptableObject.CreateInstance<ONSPSettings>();
				}
			}
			return instance;
		}
	}
}
public class ONSPVersion : MonoBehaviour
{
	public const string strONSPS = "AudioPluginOculusSpatializer";

	[DllImport("AudioPluginOculusSpatializer")]
	private static extern void ONSP_GetVersion(ref int Major, ref int Minor, ref int Patch);

	private void Awake()
	{
		int Major = 0;
		int Minor = 0;
		int Patch = 0;
		ONSP_GetVersion(ref Major, ref Minor, ref Patch);
		UnityEngine.Debug.Log($"ONSP Version: {Major:F0}.{Minor:F0}.{Patch:F0}");
	}

	private void Start()
	{
	}

	private void Update()
	{
	}
}
public static class AppSettingsExtensions
{
	public static ChatAppSettings GetChatSettings(this AppSettings appSettings)
	{
		return new ChatAppSettings
		{
			AppId = appSettings.AppIdChat,
			AppVersion = appSettings.AppVersion,
			FixedRegion = (appSettings.IsBestRegion ? null : appSettings.FixedRegion),
			NetworkLogging = appSettings.NetworkLogging,
			Protocol = appSettings.Protocol,
			Server = (appSettings.IsDefaultNameServer ? null : appSettings.Server)
		};
	}
}
public class ChannelSelector : MonoBehaviour, IPointerClickHandler, IEventSystemHandler
{
	public string Channel;

	public void SetChannel(string channel)
	{
		Channel = channel;
		GetComponentInChildren<Text>().text = Channel;
	}

	public void OnPointerClick(PointerEventData eventData)
	{
		UnityEngine.Object.FindObjectOfType<ChatGui>().ShowChannel(Channel);
	}
}
[ExecuteInEditMode]
public class ChatAppIdCheckerUI : MonoBehaviour
{
	public Text Description;

	public void Update()
	{
		if (string.IsNullOrEmpty(PhotonNetwork.PhotonServerSettings.AppSettings.AppIdChat))
		{
			if (Description != null)
			{
				Description.text = "<Color=Red>WARNING:</Color>\nPlease setup a Chat AppId in the PhotonServerSettings file.";
			}
		}
		else if (Description != null)
		{
			Description.text = string.Empty;
		}
	}
}
public class ChatGui : MonoBehaviour, IChatClientListener
{
	public string[] ChannelsToJoinOnConnect;

	public string[] FriendsList;

	public int HistoryLengthToFetch;

	private string selectedChannelName;

	public ChatClient chatClient;

	protected internal ChatAppSettings chatAppSettings;

	public GameObject missingAppIdErrorPanel;

	public GameObject ConnectingLabel;

	public RectTransform ChatPanel;

	public GameObject UserIdFormPanel;

	public InputField InputFieldChat;

	public Text CurrentChannelText;

	public Toggle ChannelToggleToInstantiate;

	public GameObject FriendListUiItemtoInstantiate;

	private readonly Dictionary<string, Toggle> channelToggles = new Dictionary<string, Toggle>();

	private readonly Dictionary<string, FriendItem> friendListItemLUT = new Dictionary<string, FriendItem>();

	public bool ShowState = true;

	public GameObject Title;

	public Text StateText;

	public Text UserIdText;

	private static string HelpText = "\n    -- HELP --\nTo subscribe to channel(s) (channelnames are case sensitive) :  \n\t<color=#E07B00>\\subscribe</color> <color=green><list of channelnames></color>\n\tor\n\t<color=#E07B00>\\s</color> <color=green><list of channelnames></color>\n\nTo leave channel(s):\n\t<color=#E07B00>\\unsubscribe</color> <color=green><list of channelnames></color>\n\tor\n\t<color=#E07B00>\\u</color> <color=green><list of channelnames></color>\n\nTo switch the active channel\n\t<color=#E07B00>\\join</color> <color=green><channelname></color>\n\tor\n\t<color=#E07B00>\\j</color> <color=green><channelname></color>\n\nTo send a private message: (username are case sensitive)\n\t\\<color=#E07B00>msg</color> <color=green><username></color> <color=green><message></color>\n\nTo change status:\n\t\\<color=#E07B00>state</color> <color=green><stateIndex></color> <color=green><message></color>\n<color=green>0</color> = Offline <color=green>1</color> = Invisible <color=green>2</color> = Online <color=green>3</color> = Away \n<color=green>4</color> = Do not disturb <color=green>5</color> = Looking For Group <color=green>6</color> = Playing\n\nTo clear the current chat tab (private chats get closed):\n\t<color=#E07B00>\\clear</color>";

	public int TestLength = 2048;

	private byte[] testBytes = new byte[2048];

	public string UserName { get; set; }

	public void Start()
	{
		UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
		UserIdText.text = "";
		StateText.text = "";
		StateText.gameObject.SetActive(value: true);
		UserIdText.gameObject.SetActive(value: true);
		Title.SetActive(value: true);
		ChatPanel.gameObject.SetActive(value: false);
		ConnectingLabel.SetActive(value: false);
		if (string.IsNullOrEmpty(UserName))
		{
			UserName = "user" + Environment.TickCount % 99;
		}
		chatAppSettings = PhotonNetwork.PhotonServerSettings.AppSettings.GetChatSettings();
		bool flag = !string.IsNullOrEmpty(chatAppSettings.AppId);
		missingAppIdErrorPanel.SetActive(!flag);
		UserIdFormPanel.gameObject.SetActive(flag);
		if (!flag)
		{
			UnityEngine.Debug.LogError("You need to set the chat app ID in the PhotonServerSettings file in order to continue.");
		}
	}

	public void Connect()
	{
		UserIdFormPanel.gameObject.SetActive(value: false);
		chatClient = new ChatClient(this);
		chatClient.UseBackgroundWorkerForSending = true;
		chatClient.AuthValues = new Photon.Chat.AuthenticationValues(UserName);
		chatClient.ConnectUsingSettings(chatAppSettings);
		ChannelToggleToInstantiate.gameObject.SetActive(value: false);
		UnityEngine.Debug.Log("Connecting as: " + UserName);
		ConnectingLabel.SetActive(value: true);
	}

	public void OnDestroy()
	{
		if (chatClient != null)
		{
			chatClient.Disconnect();
		}
	}

	public void OnApplicationQuit()
	{
		if (chatClient != null)
		{
			chatClient.Disconnect();
		}
	}

	public void Update()
	{
		if (chatClient != null)
		{
			chatClient.Service();
		}
		if (StateText == null)
		{
			UnityEngine.Object.Destroy(base.gameObject);
		}
		else
		{
			StateText.gameObject.SetActive(ShowState);
		}
	}

	public void OnEnterSend()
	{
		if (Input.GetKey(KeyCode.Return) || Input.GetKey(KeyCode.KeypadEnter))
		{
			SendChatMessage(InputFieldChat.text);
			InputFieldChat.text = "";
		}
	}

	public void OnClickSend()
	{
		if (InputFieldChat != null)
		{
			SendChatMessage(InputFieldChat.text);
			InputFieldChat.text = "";
		}
	}

	private void SendChatMessage(string inputLine)
	{
		if (string.IsNullOrEmpty(inputLine))
		{
			return;
		}
		if ("test".Equals(inputLine))
		{
			if (TestLength != testBytes.Length)
			{
				testBytes = new byte[TestLength];
			}
			chatClient.SendPrivateMessage(chatClient.AuthValues.UserId, testBytes, forwardAsWebhook: true);
		}
		bool flag = chatClient.PrivateChannels.ContainsKey(selectedChannelName);
		string target = string.Empty;
		if (flag)
		{
			target = selectedChannelName.Split(':')[1];
		}
		if (inputLine[0].Equals('\\'))
		{
			string[] array = inputLine.Split(new char[1] { ' ' }, 2);
			if (array[0].Equals("\\help"))
			{
				PostHelpToCurrentChannel();
			}
			if (array[0].Equals("\\state"))
			{
				int num = 0;
				List<string> list = new List<string>();
				list.Add("i am state " + num);
				string[] array2 = array[1].Split(' ', ',');
				if (array2.Length != 0)
				{
					num = int.Parse(array2[0]);
				}
				if (array2.Length > 1)
				{
					list.Add(array2[1]);
				}
				chatClient.SetOnlineStatus(num, list.ToArray());
			}
			else if ((array[0].Equals("\\subscribe") || array[0].Equals("\\s")) && !string.IsNullOrEmpty(array[1]))
			{
				chatClient.Subscribe(array[1].Split(' ', ','));
			}
			else if ((array[0].Equals("\\unsubscribe") || array[0].Equals("\\u")) && !string.IsNullOrEmpty(array[1]))
			{
				chatClient.Unsubscribe(array[1].Split(' ', ','));
			}
			else if (array[0].Equals("\\clear"))
			{
				ChatChannel channel;
				if (flag)
				{
					chatClient.PrivateChannels.Remove(selectedChannelName);
				}
				else if (chatClient.TryGetChannel(selectedChannelName, flag, out channel))
				{
					channel.ClearMessages();
				}
			}
			else if (array[0].Equals("\\msg") && !string.IsNullOrEmpty(array[1]))
			{
				string[] array3 = array[1].Split(new char[2] { ' ', ',' }, 2);
				if (array3.Length >= 2)
				{
					string target2 = array3[0];
					string message = array3[1];
					chatClient.SendPrivateMessage(target2, message);
				}
			}
			else if ((array[0].Equals("\\join") || array[0].Equals("\\j")) && !string.IsNullOrEmpty(array[1]))
			{
				string[] array4 = array[1].Split(new char[2] { ' ', ',' }, 2);
				if (channelToggles.ContainsKey(array4[0]))
				{
					ShowChannel(array4[0]);
					return;
				}
				chatClient.Subscribe(new string[1] { array4[0] });
			}
			else
			{
				UnityEngine.Debug.Log("The command '" + array[0] + "' is invalid.");
			}
		}
		else if (flag)
		{
			chatClient.SendPrivateMessage(target, inputLine);
		}
		else
		{
			chatClient.PublishMessage(selectedChannelName, inputLine);
		}
	}

	public void PostHelpToCurrentChannel()
	{
		CurrentChannelText.text += HelpText;
	}

	public void DebugReturn(DebugLevel level, string message)
	{
		switch (level)
		{
		case DebugLevel.ERROR:
			UnityEngine.Debug.LogError(message);
			break;
		case DebugLevel.WARNING:
			UnityEngine.Debug.LogWarning(message);
			break;
		default:
			UnityEngine.Debug.Log(message);
			break;
		}
	}

	public void OnConnected()
	{
		if (ChannelsToJoinOnConnect != null && ChannelsToJoinOnConnect.Length != 0)
		{
			chatClient.Subscribe(ChannelsToJoinOnConnect, HistoryLengthToFetch);
		}
		ConnectingLabel.SetActive(value: false);
		UserIdText.text = "Connected as " + UserName;
		ChatPanel.gameObject.SetActive(value: true);
		if (FriendsList != null && FriendsList.Length != 0)
		{
			chatClient.AddFriends(FriendsList);
			string[] friendsList = FriendsList;
			foreach (string text in friendsList)
			{
				if (FriendListUiItemtoInstantiate != null && text != UserName)
				{
					InstantiateFriendButton(text);
				}
			}
		}
		if (FriendListUiItemtoInstantiate != null)
		{
			FriendListUiItemtoInstantiate.SetActive(value: false);
		}
		chatClient.SetOnlineStatus(2);
	}

	public void OnDisconnected()
	{
		ConnectingLabel.SetActive(value: false);
	}

	public void OnChatStateChange(ChatState state)
	{
		StateText.text = state.ToString();
	}

	public void OnSubscribed(string[] channels, bool[] results)
	{
		foreach (string channelName in channels)
		{
			chatClient.PublishMessage(channelName, "says 'hi'.");
			if (ChannelToggleToInstantiate != null)
			{
				InstantiateChannelButton(channelName);
			}
		}
		UnityEngine.Debug.Log("OnSubscribed: " + string.Join(", ", channels));
		ShowChannel(channels[0]);
	}

	private void InstantiateChannelButton(string channelName)
	{
		if (channelToggles.ContainsKey(channelName))
		{
			UnityEngine.Debug.Log("Skipping creation for an existing channel toggle.");
			return;
		}
		Toggle toggle = UnityEngine.Object.Instantiate(ChannelToggleToInstantiate);
		toggle.gameObject.SetActive(value: true);
		toggle.GetComponentInChildren<ChannelSelector>().SetChannel(channelName);
		toggle.transform.SetParent(ChannelToggleToInstantiate.transform.parent, worldPositionStays: false);
		channelToggles.Add(channelName, toggle);
	}

	private void InstantiateFriendButton(string friendId)
	{
		GameObject obj = UnityEngine.Object.Instantiate(FriendListUiItemtoInstantiate);
		obj.gameObject.SetActive(value: true);
		FriendItem component = obj.GetComponent<FriendItem>();
		component.FriendId = friendId;
		obj.transform.SetParent(FriendListUiItemtoInstantiate.transform.parent, worldPositionStays: false);
		friendListItemLUT[friendId] = component;
	}

	public void OnUnsubscribed(string[] channels)
	{
		foreach (string text in channels)
		{
			if (channelToggles.ContainsKey(text))
			{
				UnityEngine.Object.Destroy(channelToggles[text].gameObject);
				channelToggles.Remove(text);
				UnityEngine.Debug.Log("Unsubscribed from channel '" + text + "'.");
				if (text == selectedChannelName && channelToggles.Count > 0)
				{
					IEnumerator<KeyValuePair<string, Toggle>> enumerator = channelToggles.GetEnumerator();
					enumerator.MoveNext();
					ShowChannel(enumerator.Current.Key);
					enumerator.Current.Value.isOn = true;
				}
			}
			else
			{
				UnityEngine.Debug.Log("Can't unsubscribe from channel '" + text + "' because you are currently not subscribed to it.");
			}
		}
	}

	public void OnGetMessages(string channelName, string[] senders, object[] messages)
	{
		if (channelName.Equals(selectedChannelName))
		{
			ShowChannel(selectedChannelName);
		}
	}

	public void OnPrivateMessage(string sender, object message, string channelName)
	{
		InstantiateChannelButton(channelName);
		if (message is byte[] array)
		{
			UnityEngine.Debug.Log("Message with byte[].Length: " + array.Length);
		}
		if (selectedChannelName.Equals(channelName))
		{
			ShowChannel(channelName);
		}
	}

	public void OnStatusUpdate(string user, int status, bool gotMessage, object message)
	{
		UnityEngine.Debug.LogWarning("status: " + $"{user} is {status}. Msg:{message}");
		if (friendListItemLUT.ContainsKey(user))
		{
			FriendItem friendItem = friendListItemLUT[user];
			if (friendItem != null)
			{
				friendItem.OnFriendStatusUpdate(status, gotMessage, message);
			}
		}
	}

	public void OnUserSubscribed(string channel, string user)
	{
		UnityEngine.Debug.LogFormat("OnUserSubscribed: channel=\"{0}\" userId=\"{1}\"", channel, user);
	}

	public void OnUserUnsubscribed(string channel, string user)
	{
		UnityEngine.Debug.LogFormat("OnUserUnsubscribed: channel=\"{0}\" userId=\"{1}\"", channel, user);
	}

	public void AddMessageToSelectedChannel(string msg)
	{
		ChatChannel channel = null;
		if (!chatClient.TryGetChannel(selectedChannelName, out channel))
		{
			UnityEngine.Debug.Log("AddMessageToSelectedChannel failed to find channel: " + selectedChannelName);
		}
		else
		{
			channel?.Add("Bot", msg, 0);
		}
	}

	public void ShowChannel(string channelName)
	{
		if (string.IsNullOrEmpty(channelName))
		{
			return;
		}
		ChatChannel channel = null;
		if (!chatClient.TryGetChannel(channelName, out channel))
		{
			UnityEngine.Debug.Log("ShowChannel failed to find channel: " + channelName);
			return;
		}
		selectedChannelName = channelName;
		CurrentChannelText.text = channel.ToStringMessages();
		UnityEngine.Debug.Log("ShowChannel: " + selectedChannelName);
		foreach (KeyValuePair<string, Toggle> channelToggle in channelToggles)
		{
			channelToggle.Value.isOn = ((channelToggle.Key == channelName) ? true : false);
		}
	}

	public void OpenDashboard()
	{
		UnityEngine.Application.OpenURL("https://dashboard.photonengine.com");
	}
}
public class FriendItem : MonoBehaviour
{
	public Text NameLabel;

	public Text StatusLabel;

	public Text Health;

	[HideInInspector]
	public string FriendId
	{
		get
		{
			return NameLabel.text;
		}
		set
		{
			NameLabel.text = value;
		}
	}

	public void Awake()
	{
		Health.text = string.Empty;
	}

	public void OnFriendStatusUpdate(int status, bool gotMessage, object message)
	{
		StatusLabel.text = status switch
		{
			1 => "Invisible", 
			2 => "Online", 
			3 => "Away", 
			4 => "Do not disturb", 
			5 => "Looking For Game/Group", 
			6 => "Playing", 
			_ => "Offline", 
		};
		if (gotMessage)
		{
			string text = string.Empty;
			if (message != null && message is string[] array && array.Length >= 2)
			{
				text = array[1] + "%";
			}
			Health.text = text;
		}
	}
}
public class IgnoreUiRaycastWhenInactive : MonoBehaviour, ICanvasRaycastFilter
{
	public bool IsRaycastLocationValid(Vector2 screenPoint, Camera eventCamera)
	{
		return base.gameObject.activeInHierarchy;
	}
}
[RequireComponent(typeof(ChatGui))]
public class NamePickGui : MonoBehaviour
{
	private const string UserNamePlayerPref = "NamePickUserName";

	public ChatGui chatNewComponent;

	public InputField idInput;

	public void Start()
	{
		chatNewComponent = UnityEngine.Object.FindObjectOfType<ChatGui>();
		string @string = PlayerPrefs.GetString("NamePickUserName");
		if (!string.IsNullOrEmpty(@string))
		{
			idInput.text = @string;
		}
	}

	public void EndEditOnEnter()
	{
		if (Input.GetKey(KeyCode.Return) || Input.GetKey(KeyCode.KeypadEnter))
		{
			StartChat();
		}
	}

	public void StartChat()
	{
		ChatGui chatGui = UnityEngine.Object.FindObjectOfType<ChatGui>();
		chatGui.UserName = idInput.text.Trim();
		chatGui.Connect();
		base.enabled = false;
		PlayerPrefs.SetString("NamePickUserName", chatGui.UserName);
	}
}
public class HandState : MonoBehaviour
{
	public GameObject handObject;

	private float thumb;

	private float index;

	private float middle;

	public bool isRightHand = true;

	private Animator ani;

	public Transform handNormal;

	public Transform handRod;

	public Transform handGrab;

	private bool[] multiFingerState = new bool[8] { false, false, false, false, true, false, false, false };

	private void Awake()
	{
		ani = handObject.GetComponent<Animator>();
	}

	public void ChangeState(int handSelect)
	{
		switch (handSelect)
		{
		case 0:
			multiFingerState[0] = false;
			multiFingerState[4] = false;
			multiFingerState[5] = true;
			multiFingerState[6] = false;
			multiFingerState[7] = false;
			break;
		case 1:
			multiFingerState[0] = true;
			multiFingerState[4] = true;
			multiFingerState[5] = false;
			multiFingerState[6] = false;
			multiFingerState[7] = false;
			break;
		case 2:
			multiFingerState[0] = true;
			multiFingerState[4] = false;
			multiFingerState[5] = true;
			multiFingerState[6] = false;
			multiFingerState[7] = false;
			break;
		case 3:
			multiFingerState[0] = true;
			multiFingerState[4] = false;
			multiFingerState[5] = false;
			multiFingerState[6] = true;
			multiFingerState[7] = false;
			break;
		case 4:
			multiFingerState[0] = true;
			multiFingerState[4] = false;
			multiFingerState[5] = false;
			multiFingerState[6] = false;
			multiFingerState[7] = true;
			break;
		}
		if (multiFingerState[0])
		{
			handObject.SetActive(value: true);
		}
		else
		{
			handObject.SetActive(value: false);
		}
		if (ani != null)
		{
			ani.SetBool("normal", multiFingerState[4]);
			ani.SetBool("grab", multiFingerState[5]);
			ani.SetBool("spinning", multiFingerState[6]);
			ani.SetBool("casting", multiFingerState[7]);
		}
	}

	private void Update()
	{
		if (multiFingerState[4])
		{
			if (isRightHand)
			{
				if (OVRInput.Get(OVRInput.Touch.Two, OVRInput.Controller.Touch) || OVRInput.Get(OVRInput.Touch.One, OVRInput.Controller.Touch) || OVRInput.Get(OVRInput.Touch.SecondaryThumbstick, OVRInput.Controller.Touch))
				{
					thumb = Mathf.Lerp(thumb, 1f, 0.5f);
				}
				else
				{
					thumb = Mathf.Lerp(thumb, 0f, 0.5f);
				}
				index = OVRInput.Get(OVRInput.Axis1D.SecondaryIndexTrigger, OVRInput.Controller.Touch);
				middle = OVRInput.Get(OVRInput.Axis1D.SecondaryHandTrigger, OVRInput.Controller.Touch);
			}
			else
			{
				if (OVRInput.Get(OVRInput.Touch.Three, OVRInput.Controller.Touch) || OVRInput.Get(OVRInput.Touch.Four, OVRInput.Controller.Touch) || OVRInput.Get(OVRInput.Touch.PrimaryThumbstick, OVRInput.Controller.Touch))
				{
					thumb = Mathf.Lerp(thumb, 1f, 0.5f);
				}
				else
				{
					thumb = Mathf.Lerp(thumb, 0f, 0.5f);
				}
				index = OVRInput.Get(OVRInput.Axis1D.PrimaryIndexTrigger, OVRInput.Controller.Touch);
				middle = OVRInput.Get(OVRInput.Axis1D.PrimaryHandTrigger, OVRInput.Controller.Touch);
			}
		}
		else
		{
			thumb = 0f;
			index = 0f;
			middle = 0f;
		}
		if ((double)thumb > 0.5)
		{
			multiFingerState[1] = true;
		}
		else
		{
			multiFingerState[1] = false;
		}
		if ((double)index > 0.5)
		{
			multiFingerState[2] = true;
		}
		else
		{
			multiFingerState[2] = false;
		}
		if ((double)middle > 0.5)
		{
			multiFingerState[3] = true;
		}
		else
		{
			multiFingerState[3] = false;
		}
		if (ani != null)
		{
			ani.SetFloat("thumb", thumb);
			ani.SetFloat("index", index);
			ani.SetFloat("middle", middle);
		}
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
		{
			if (isRightHand)
			{
				MultiplayManager.Instance.localAvatar.fingerRSyncData = multiFingerState;
			}
			else
			{
				MultiplayManager.Instance.localAvatar.fingerLSyncData = multiFingerState;
			}
		}
	}
}
public class SchoolBubbles : MonoBehaviour
{
	public ParticleSystem _bubbleParticles;

	public float _emitEverySecond = 0.01f;

	public float _speedEmitMultiplier = 0.25f;

	public int _minBubbles;

	public int _maxBubbles = 5;

	public void Start()
	{
		if (_bubbleParticles == null)
		{
			base.transform.GetComponent<ParticleSystem>();
		}
	}

	public void EmitBubbles(Vector3 pos, float amount)
	{
		if (!(amount * _speedEmitMultiplier < 1f))
		{
			_bubbleParticles.transform.position = pos;
			_bubbleParticles.Emit(Mathf.Clamp((int)(amount * _speedEmitMultiplier), _minBubbles, _maxBubbles));
		}
	}
}
public class SchoolChild : MonoBehaviour
{
	[HideInInspector]
	public SchoolController _spawner;

	private Vector3 _wayPoint;

	[HideInInspector]
	public float _speed = 10f;

	private float _stuckCounter;

	private float _damping;

	private Transform _model;

	private float _targetSpeed;

	private float tParam;

	private float _rotateCounterR;

	private float _rotateCounterL;

	public Transform _scanner;

	private bool _scan = true;

	private bool _instantiated;

	private static int _updateNextSeed;

	private int _updateSeed = -1;

	[HideInInspector]
	public Transform _cacheTransform;

	private Animator fishAni;

	private float HorRot;

	private float VerRot;

	private float oldXangle;

	public void Start()
	{
		if (_cacheTransform == null)
		{
			_cacheTransform = base.transform;
		}
		if (_spawner != null)
		{
			SetRandomScale();
			LocateRequiredChildren();
			RandomizeStartAnimationFrame();
			SkewModelForLessUniformedMovement();
			_speed = UnityEngine.Random.Range(_spawner._minSpeed, _spawner._maxSpeed);
			Wander(0f);
			SetRandomWaypoint();
			CheckForBubblesThenInvoke();
			_instantiated = true;
			GetStartPos();
			FrameSkipSeedInit();
			_spawner._activeChildren++;
		}
		else
		{
			base.enabled = false;
			UnityEngine.Debug.Log(string.Concat(base.gameObject, " found no school to swim in: ", this, " disabled... Standalone fish not supported, please use the SchoolController"));
		}
	}

	public void Update()
	{
		if (_spawner._updateDivisor <= 1 || _spawner._updateCounter == _updateSeed)
		{
			CheckForDistanceToWaypoint();
			RotationBasedOnWaypointOrAvoidance();
			ForwardMovement();
			SetAnimationSpeed();
		}
	}

	public void FrameSkipSeedInit()
	{
		if (_spawner._updateDivisor > 1)
		{
			int num = _spawner._updateDivisor - 1;
			_updateNextSeed++;
			_updateSeed = _updateNextSeed;
			_updateNextSeed %= num;
		}
	}

	public void CheckForBubblesThenInvoke()
	{
		if (_spawner._bubbles != null)
		{
			InvokeRepeating("EmitBubbles", _spawner._bubbles._emitEverySecond * UnityEngine.Random.value + 1f, _spawner._bubbles._emitEverySecond);
		}
	}

	public void EmitBubbles()
	{
		_spawner._bubbles.EmitBubbles(_cacheTransform.position, _speed);
	}

	public void OnDisable()
	{
		CancelInvoke();
		_spawner._activeChildren--;
	}

	public void OnEnable()
	{
		if (_instantiated)
		{
			CheckForBubblesThenInvoke();
			_spawner._activeChildren++;
		}
	}

	public void LocateRequiredChildren()
	{
		if (_model == null)
		{
			_model = _cacheTransform.Find("Model");
			fishAni = _model.GetComponent<Animator>();
		}
		if (_scanner == null)
		{
			_scanner = new GameObject().transform;
			_scanner.parent = base.transform;
			_scanner.localRotation = Quaternion.identity;
			_scanner.localPosition = Vector3.zero;
		}
	}

	public void SkewModelForLessUniformedMovement()
	{
		Quaternion identity = Quaternion.identity;
		identity.eulerAngles = new Vector3(0f, 0f, UnityEngine.Random.Range(-25, 25));
		_model.rotation = identity;
	}

	public void SetRandomScale()
	{
		float num = UnityEngine.Random.Range(_spawner._minScale, _spawner._maxScale);
		_cacheTransform.localScale = Vector3.one * num;
	}

	public void RandomizeStartAnimationFrame()
	{
		fishAni.GetCurrentAnimatorStateInfo(0);
	}

	public void GetStartPos()
	{
		_cacheTransform.position = _wayPoint - new Vector3(0.1f, 0.1f, 0.1f);
	}

	public Vector3 findWaypoint()
	{
		Vector3 zero = Vector3.zero;
		zero.x = UnityEngine.Random.Range(0f - _spawner._spawnSphere, _spawner._spawnSphere) + _spawner._posBuffer.x;
		zero.z = UnityEngine.Random.Range(0f - _spawner._spawnSphereDepth, _spawner._spawnSphereDepth) + _spawner._posBuffer.z;
		zero.y = UnityEngine.Random.Range(0f - _spawner._spawnSphereHeight, _spawner._spawnSphereHeight) + _spawner._posBuffer.y;
		return zero;
	}

	public void RayCastToPushAwayFromObstacles()
	{
		if (_spawner._push)
		{
			RotateScanner();
			RayCastToPushAwayFromObstaclesCheckForCollision();
		}
	}

	public void RayCastToPushAwayFromObstaclesCheckForCollision()
	{
		RaycastHit hitInfo = default(RaycastHit);
		float num = 0f;
		Vector3 forward = _scanner.forward;
		if (Physics.Raycast(_cacheTransform.position, forward, out hitInfo, _spawner._pushDistance, _spawner._avoidanceMask))
		{
			SchoolChild component = hitInfo.transform.GetComponent<SchoolChild>();
			num = (_spawner._pushDistance - hitInfo.distance) / _spawner._pushDistance;
			if (component != null)
			{
				_cacheTransform.position -= forward * _spawner._newDelta * num * _spawner._pushForce;
				return;
			}
			_speed -= 0.01f * _spawner._newDelta;
			if (_speed < 0.1f)
			{
				_speed = 0.1f;
			}
			_cacheTransform.position -= forward * _spawner._newDelta * num * _spawner._pushForce * 2f;
			_scan = false;
		}
		else
		{
			_scan = true;
		}
	}

	public void RotateScanner()
	{
		if (_scan)
		{
			_scanner.rotation = UnityEngine.Random.rotation;
		}
		else
		{
			_scanner.Rotate(new Vector3(150f * _spawner._newDelta, 0f, 0f));
		}
	}

	public bool Avoidance()
	{
		if (!_spawner._avoidance)
		{
			return false;
		}
		RaycastHit hitInfo = default(RaycastHit);
		float num = 0f;
		Quaternion rotation = _cacheTransform.rotation;
		Vector3 eulerAngles = _cacheTransform.rotation.eulerAngles;
		Vector3 forward = _cacheTransform.forward;
		Vector3 right = _cacheTransform.right;
		if (Physics.Raycast(_cacheTransform.position, -Vector3.up + forward * 0.1f, out hitInfo, _spawner._avoidDistance, _spawner._avoidanceMask))
		{
			num = (_spawner._avoidDistance - hitInfo.distance) / _spawner._avoidDistance;
			eulerAngles.x -= _spawner._avoidSpeed * num * _spawner._newDelta * (_speed + 1f);
			rotation.eulerAngles = eulerAngles;
			_cacheTransform.rotation = rotation;
		}
		if (Physics.Raycast(_cacheTransform.position, Vector3.up + forward * 0.1f, out hitInfo, _spawner._avoidDistance, _spawner._avoidanceMask))
		{
			num = (_spawner._avoidDistance - hitInfo.distance) / _spawner._avoidDistance;
			eulerAngles.x += _spawner._avoidSpeed * num * _spawner._newDelta * (_speed + 1f);
			rotation.eulerAngles = eulerAngles;
			_cacheTransform.rotation = rotation;
		}
		if (Physics.Raycast(_cacheTransform.position, forward + right * UnityEngine.Random.Range(-0.1f, 0.1f), out hitInfo, _spawner._stopDistance, _spawner._avoidanceMask))
		{
			num = (_spawner._stopDistance - hitInfo.distance) / _spawner._stopDistance;
			eulerAngles.y -= _spawner._avoidSpeed * num * _spawner._newDelta * (_targetSpeed + 3f);
			rotation.eulerAngles = eulerAngles;
			_cacheTransform.rotation = rotation;
			_speed -= num * _spawner._newDelta * _spawner._stopSpeedMultiplier * _speed;
			if (_speed < 0.01f)
			{
				_speed = 0.01f;
			}
			return true;
		}
		if (Physics.Raycast(_cacheTransform.position, forward + right * (_spawner._avoidAngle + _rotateCounterL), out hitInfo, _spawner._avoidDistance, _spawner._avoidanceMask))
		{
			num = (_spawner._avoidDistance - hitInfo.distance) / _spawner._avoidDistance;
			_rotateCounterL += 0.1f;
			eulerAngles.y -= _spawner._avoidSpeed * num * _spawner._newDelta * _rotateCounterL * (_speed + 1f);
			rotation.eulerAngles = eulerAngles;
			_cacheTransform.rotation = rotation;
			if (_rotateCounterL > 1.5f)
			{
				_rotateCounterL = 1.5f;
			}
			_rotateCounterR = 0f;
			return true;
		}
		if (Physics.Raycast(_cacheTransform.position, forward + right * (0f - (_spawner._avoidAngle + _rotateCounterR)), out hitInfo, _spawner._avoidDistance, _spawner._avoidanceMask))
		{
			num = (_spawner._avoidDistance - hitInfo.distance) / _spawner._avoidDistance;
			if (hitInfo.point.y < _cacheTransform.position.y)
			{
				eulerAngles.y -= _spawner._avoidSpeed * num * _spawner._newDelta * (_speed + 1f);
			}
			else
			{
				eulerAngles.x += _spawner._avoidSpeed * num * _spawner._newDelta * (_speed + 1f);
			}
			_rotateCounterR += 0.1f;
			eulerAngles.y += _spawner._avoidSpeed * num * _spawner._newDelta * _rotateCounterR * (_speed + 1f);
			rotation.eulerAngles = eulerAngles;
			_cacheTransform.rotation = rotation;
			if (_rotateCounterR > 1.5f)
			{
				_rotateCounterR = 1.5f;
			}
			_rotateCounterL = 0f;
			return true;
		}
		_rotateCounterL = 0f;
		_rotateCounterR = 0f;
		return false;
	}

	public void ForwardMovement()
	{
		_cacheTransform.position += _cacheTransform.TransformDirection(Vector3.forward) * _speed * _spawner._newDelta;
		if (tParam < 1f)
		{
			if (_speed > _targetSpeed)
			{
				tParam += _spawner._newDelta * _spawner._acceleration;
			}
			else
			{
				tParam += _spawner._newDelta * _spawner._brake;
			}
			_speed = Mathf.Lerp(_speed, _targetSpeed, tParam);
		}
	}

	public void RotationBasedOnWaypointOrAvoidance()
	{
		Quaternion identity = Quaternion.identity;
		identity = Quaternion.LookRotation(_wayPoint - _cacheTransform.position);
		Avoidance();
		float x = _cacheTransform.localEulerAngles.x;
		x = ((x > 180f) ? (x - 360f) : x);
		Quaternion rotation = _cacheTransform.rotation;
		Vector3 eulerAngles = rotation.eulerAngles;
		eulerAngles.x = ClampAngle(x, -50f, 50f);
		rotation.eulerAngles = eulerAngles;
		Vector3 forward = _cacheTransform.forward;
		_cacheTransform.rotation = rotation;
		Quaternion rotation2 = Quaternion.Slerp(_cacheTransform.rotation, identity, _spawner._newDelta * _damping);
		_cacheTransform.rotation = rotation2;
		Vector3 forward2 = _cacheTransform.forward;
		float num = Angle(new Vector2(forward.x, forward.z), new Vector2(forward2.x, forward2.z));
		x = Mathf.Abs(ClampAngle(x, -50f, 50f));
		x = ((!(x > 30f)) ? 1f : ((50f - x) * 0.05f));
		HorRot = Mathf.Clamp(Mathf.Lerp(HorRot, num * x, Time.deltaTime), -1f, 1f);
		turnAniBlend(HorRot);
	}

	private float Angle(Vector2 a, Vector2 b)
	{
		Vector2 normalized = a.normalized;
		Vector2 normalized2 = b.normalized;
		float x = normalized.x * normalized2.x + normalized.y * normalized2.y;
		return Mathf.Atan2(normalized.y * normalized2.x - normalized.x * normalized2.y, x) * 57.29578f;
	}

	private void turnAniBlend(float hor)
	{
		if (fishAni != null)
		{
			fishAni.SetFloat("Xdir", hor);
		}
	}

	public void CheckForDistanceToWaypoint()
	{
		if ((_cacheTransform.position - _wayPoint).magnitude < _spawner._waypointDistance + _stuckCounter)
		{
			Wander(0f);
			_stuckCounter = 0f;
			CheckIfThisShouldTriggerNewFlockWaypoint();
		}
		else
		{
			_stuckCounter += _spawner._newDelta * (_spawner._waypointDistance * 0.25f);
		}
	}

	public void CheckIfThisShouldTriggerNewFlockWaypoint()
	{
		if (_spawner._childTriggerPos)
		{
			_spawner.SetRandomWaypointPosition();
		}
	}

	public static float ClampAngle(float angle, float min, float max)
	{
		if (angle < -360f)
		{
			angle += 360f;
		}
		if (angle > 360f)
		{
			angle -= 360f;
		}
		return Mathf.Clamp(angle, min, max);
	}

	public void SetAnimationSpeed()
	{
		fishAni.speed = UnityEngine.Random.Range(_spawner._minAnimationSpeed, _spawner._maxAnimationSpeed) * _spawner._schoolSpeed * _speed + 0.1f;
	}

	public void Wander(float delay)
	{
		_damping = UnityEngine.Random.Range(_spawner._minDamping, _spawner._maxDamping);
		_targetSpeed = UnityEngine.Random.Range(_spawner._minSpeed, _spawner._maxSpeed) * _spawner._speedCurveMultiplier.Evaluate(UnityEngine.Random.value) * _spawner._schoolSpeed;
		Invoke("SetRandomWaypoint", delay);
	}

	public void SetRandomWaypoint()
	{
		tParam = 0f;
		_wayPoint = findWaypoint();
	}
}
public class SchoolController : MonoBehaviour
{
	public SchoolChild[] _childPrefab;

	public bool _groupChildToNewTransform;

	public Transform _groupTransform;

	public string _groupName = "";

	public bool _groupChildToSchool;

	public int _childAmount = 250;

	public float _spawnSphere = 3f;

	public float _spawnSphereDepth = 3f;

	public float _spawnSphereHeight = 1.5f;

	public float _childSpeedMultipler = 2f;

	public float _minSpeed = 6f;

	public float _maxSpeed = 10f;

	public AnimationCurve _speedCurveMultiplier = new AnimationCurve(new Keyframe(0f, 1f), new Keyframe(1f, 1f));

	public float _minScale = 0.7f;

	public float _maxScale = 1f;

	public float _minDamping = 1f;

	public float _maxDamping = 2f;

	public float _waypointDistance = 1f;

	public float _minAnimationSpeed = 2f;

	public float _maxAnimationSpeed = 4f;

	public float _randomPositionTimerMax = 10f;

	public float _randomPositionTimerMin = 4f;

	public float _acceleration = 0.025f;

	public float _brake = 0.01f;

	public float _positionSphere = 25f;

	public float _positionSphereDepth = 5f;

	public float _positionSphereHeight = 5f;

	public bool _childTriggerPos;

	public bool _forceChildWaypoints;

	public bool _autoRandomPosition;

	public float _forcedRandomDelay = 1.5f;

	public float _schoolSpeed;

	public List<SchoolChild> _roamers;

	public Vector3 _posBuffer;

	public Vector3 _posOffset;

	public bool _avoidance;

	public float _avoidAngle = 0.35f;

	public float _avoidDistance = 1f;

	public float _avoidSpeed = 75f;

	public float _stopDistance = 0.5f;

	public float _stopSpeedMultiplier = 2f;

	public LayerMask _avoidanceMask = -1;

	public bool _push;

	public float _pushDistance;

	public float _pushForce = 5f;

	public SchoolBubbles _bubbles;

	public int _updateDivisor = 1;

	public float _newDelta;

	public int _updateCounter;

	public int _activeChildren;

	public void Start()
	{
		_posBuffer = base.transform.position + _posOffset;
		_schoolSpeed = UnityEngine.Random.Range(1f, _childSpeedMultipler);
	}

	public void Update()
	{
		if (_activeChildren > 0)
		{
			if (_updateDivisor > 1)
			{
				_updateCounter++;
				_updateCounter %= _updateDivisor;
				_newDelta = Time.deltaTime * (float)_updateDivisor;
			}
			else
			{
				_newDelta = Time.deltaTime;
			}
		}
	}

	public void InstantiateGroup()
	{
		if (!(_groupTransform != null))
		{
			GameObject gameObject = new GameObject();
			_groupTransform = gameObject.transform;
			_groupTransform.position = base.transform.position;
			if (_groupName != "")
			{
				gameObject.name = _groupName;
			}
			else
			{
				gameObject.name = base.transform.name + " Fish Container";
			}
		}
	}

	public void AddFish(int amount)
	{
		if (_groupChildToNewTransform)
		{
			InstantiateGroup();
		}
		for (int i = 0; i < amount; i++)
		{
			int num = UnityEngine.Random.Range(0, _childPrefab.Length);
			SchoolChild schoolChild = UnityEngine.Object.Instantiate(_childPrefab[num]);
			schoolChild._spawner = this;
			_roamers.Add(schoolChild);
			AddChildToParent(schoolChild.transform);
		}
	}

	public void AddChildToParent(Transform obj)
	{
		if (_groupChildToSchool)
		{
			obj.parent = base.transform;
		}
		else if (_groupChildToNewTransform)
		{
			obj.parent = _groupTransform;
		}
	}

	public void RemoveFish()
	{
		if (_roamers.Count > 0)
		{
			SchoolChild schoolChild = _roamers[_roamers.Count - 1];
			_roamers.RemoveAt(_roamers.Count - 1);
			UnityEngine.Object.Destroy(schoolChild.gameObject);
		}
	}

	public void UpdateFishAmount(int amount, int total)
	{
		for (int i = 0; i < total; i++)
		{
			RemoveFish();
		}
		AddFish(amount);
	}

	public void SetRandomWaypointPosition()
	{
		_schoolSpeed = UnityEngine.Random.Range(1f, _childSpeedMultipler);
		Vector3 zero = Vector3.zero;
		zero.x = UnityEngine.Random.Range(0f - _positionSphere, _positionSphere) + base.transform.position.x;
		zero.z = UnityEngine.Random.Range(0f - _positionSphereDepth, _positionSphereDepth) + base.transform.position.z;
		zero.y = UnityEngine.Random.Range(0f - _positionSphereHeight, _positionSphereHeight) + base.transform.position.y;
		_posBuffer = zero;
		if (_forceChildWaypoints)
		{
			for (int i = 0; i < _roamers.Count; i++)
			{
				_roamers[i].Wander(UnityEngine.Random.value * _forcedRandomDelay);
			}
		}
	}

	public void AutoRandomWaypointPosition()
	{
		if (_autoRandomPosition && _activeChildren > 0)
		{
			SetRandomWaypointPosition();
		}
		CancelInvoke("AutoRandomWaypointPosition");
		Invoke("AutoRandomWaypointPosition", RandomWaypointTime());
	}

	public float RandomWaypointTime()
	{
		return UnityEngine.Random.Range(_randomPositionTimerMin, _randomPositionTimerMax);
	}

	public void OnDrawGizmos()
	{
		if (!UnityEngine.Application.isPlaying && _posBuffer != base.transform.position + _posOffset)
		{
			_posBuffer = base.transform.position + _posOffset;
		}
		Gizmos.color = Color.blue;
		Gizmos.DrawWireCube(_posBuffer, new Vector3(_spawnSphere * 2f, _spawnSphereHeight * 2f, _spawnSphereDepth * 2f));
		Gizmos.color = Color.cyan;
		Gizmos.DrawWireCube(base.transform.position, new Vector3(_positionSphere * 2f + _spawnSphere * 2f, _positionSphereHeight * 2f + _spawnSphereHeight * 2f, _positionSphereDepth * 2f + _spawnSphereDepth * 2f));
	}
}
public class FlockChild : MonoBehaviour
{
	[HideInInspector]
	public FlockController _spawner;

	[HideInInspector]
	public Vector3 _wayPoint;

	public float _speed;

	[HideInInspector]
	public bool _dived = true;

	[HideInInspector]
	public float _stuckCounter;

	[HideInInspector]
	public float _damping;

	[HideInInspector]
	public bool _soar = true;

	[HideInInspector]
	public bool _landing;

	[HideInInspector]
	public float _targetSpeed;

	[HideInInspector]
	public bool _move = true;

	public GameObject _model;

	public Transform _modelT;

	[HideInInspector]
	public float _avoidValue;

	[HideInInspector]
	public float _avoidDistance;

	private float _soarTimer;

	private bool _instantiated;

	private static int _updateNextSeed;

	private int _updateSeed = -1;

	[HideInInspector]
	public bool _avoid = true;

	public Transform _thisT;

	public Vector3 _landingPosOffset;

	public void Start()
	{
		FindRequiredComponents();
		Wander(0f);
		SetRandomScale();
		_thisT.position = findWaypoint();
		RandomizeStartAnimationFrame();
		InitAvoidanceValues();
		_speed = _spawner._minSpeed;
		_spawner._activeChildren += 1f;
		_instantiated = true;
		if (_spawner._updateDivisor > 1)
		{
			int num = _spawner._updateDivisor - 1;
			_updateNextSeed++;
			_updateSeed = _updateNextSeed;
			_updateNextSeed %= num;
		}
	}

	public void Update()
	{
		if (_spawner._updateDivisor <= 1 || _spawner._updateCounter == _updateSeed)
		{
			SoarTimeLimit();
			CheckForDistanceToWaypoint();
			RotationBasedOnWaypointOrAvoidance();
			LimitRotationOfModel();
		}
	}

	public void OnDisable()
	{
		CancelInvoke();
		_spawner._activeChildren -= 1f;
	}

	public void OnEnable()
	{
		if (_instantiated)
		{
			_spawner._activeChildren += 1f;
			if (_landing)
			{
				_model.GetComponent<Animation>().Play(_spawner._idleAnimation);
			}
			else
			{
				_model.GetComponent<Animation>().Play(_spawner._flapAnimation);
			}
		}
	}

	public void FindRequiredComponents()
	{
		if (_thisT == null)
		{
			_thisT = base.transform;
		}
		if (_model == null)
		{
			_model = _thisT.Find("Model").gameObject;
		}
		if (_modelT == null)
		{
			_modelT = _model.transform;
		}
	}

	public void RandomizeStartAnimationFrame()
	{
		foreach (AnimationState item in _model.GetComponent<Animation>())
		{
			item.time = UnityEngine.Random.value * item.length;
		}
	}

	public void InitAvoidanceValues()
	{
		_avoidValue = UnityEngine.Random.Range(0.3f, 0.1f);
		if (_spawner._birdAvoidDistanceMax != _spawner._birdAvoidDistanceMin)
		{
			_avoidDistance = UnityEngine.Random.Range(_spawner._birdAvoidDistanceMax, _spawner._birdAvoidDistanceMin);
		}
		else
		{
			_avoidDistance = _spawner._birdAvoidDistanceMin;
		}
	}

	public void SetRandomScale()
	{
		float num = UnityEngine.Random.Range(_spawner._minScale, _spawner._maxScale);
		_thisT.localScale = new Vector3(num, num, num);
	}

	public void SoarTimeLimit()
	{
		if (_soar && _spawner._soarMaxTime > 0f)
		{
			if (_soarTimer > _spawner._soarMaxTime)
			{
				Flap();
				_soarTimer = 0f;
			}
			else
			{
				_soarTimer += _spawner._newDelta;
			}
		}
	}

	public void CheckForDistanceToWaypoint()
	{
		if (!_landing && (_thisT.position - _wayPoint).magnitude < _spawner._waypointDistance + _stuckCounter)
		{
			Wander(0f);
			_stuckCounter = 0f;
		}
		else if (!_landing)
		{
			_stuckCounter += _spawner._newDelta;
		}
		else
		{
			_stuckCounter = 0f;
		}
	}

	public void RotationBasedOnWaypointOrAvoidance()
	{
		Vector3 vector = _wayPoint - _thisT.position;
		if (_targetSpeed > -1f && vector != Vector3.zero)
		{
			Quaternion b = Quaternion.LookRotation(vector);
			_thisT.rotation = Quaternion.Slerp(_thisT.rotation, b, _spawner._newDelta * _damping);
		}
		if (_spawner._childTriggerPos && (_thisT.position - _spawner._posBuffer).magnitude < 1f)
		{
			_spawner.SetFlockRandomPosition();
		}
		_speed = Mathf.Lerp(_speed, _targetSpeed, _spawner._newDelta * 2.5f);
		if (_move)
		{
			_thisT.position += _thisT.forward * _speed * _spawner._newDelta;
			if (_avoid && _spawner._birdAvoid)
			{
				Avoidance();
			}
		}
	}

	public bool Avoidance()
	{
		RaycastHit hitInfo = default(RaycastHit);
		Vector3 forward = _modelT.forward;
		bool result = false;
		Quaternion identity = Quaternion.identity;
		Vector3 zero = Vector3.zero;
		Vector3 zero2 = Vector3.zero;
		zero2 = _thisT.position;
		identity = _thisT.rotation;
		zero = _thisT.rotation.eulerAngles;
		if (Physics.Raycast(_thisT.position, forward + _modelT.right * _avoidValue, out hitInfo, _avoidDistance, _spawner._avoidanceMask))
		{
			zero.y -= (float)_spawner._birdAvoidHorizontalForce * _spawner._newDelta * _damping;
			identity.eulerAngles = zero;
			_thisT.rotation = identity;
			result = true;
		}
		else if (Physics.Raycast(_thisT.position, forward + _modelT.right * (0f - _avoidValue), out hitInfo, _avoidDistance, _spawner._avoidanceMask))
		{
			zero.y += (float)_spawner._birdAvoidHorizontalForce * _spawner._newDelta * _damping;
			identity.eulerAngles = zero;
			_thisT.rotation = identity;
			result = true;
		}
		if (_spawner._birdAvoidDown && !_landing && Physics.Raycast(_thisT.position, -Vector3.up, out hitInfo, _avoidDistance, _spawner._avoidanceMask))
		{
			zero.x -= (float)_spawner._birdAvoidVerticalForce * _spawner._newDelta * _damping;
			identity.eulerAngles = zero;
			_thisT.rotation = identity;
			zero2.y += (float)_spawner._birdAvoidVerticalForce * _spawner._newDelta * 0.01f;
			_thisT.position = zero2;
			result = true;
		}
		else if (_spawner._birdAvoidUp && !_landing && Physics.Raycast(_thisT.position, Vector3.up, out hitInfo, _avoidDistance, _spawner._avoidanceMask))
		{
			zero.x += (float)_spawner._birdAvoidVerticalForce * _spawner._newDelta * _damping;
			identity.eulerAngles = zero;
			_thisT.rotation = identity;
			zero2.y -= (float)_spawner._birdAvoidVerticalForce * _spawner._newDelta * 0.01f;
			_thisT.position = zero2;
			result = true;
		}
		return result;
	}

	public void LimitRotationOfModel()
	{
		Quaternion identity = Quaternion.identity;
		Vector3 zero = Vector3.zero;
		identity = _modelT.localRotation;
		zero = identity.eulerAngles;
		if ((((_soar && _spawner._flatSoar) || (_spawner._flatFly && !_soar)) && _wayPoint.y > _thisT.position.y) || _landing)
		{
			zero.x = Mathf.LerpAngle(_modelT.localEulerAngles.x, 0f - _thisT.localEulerAngles.x, _spawner._newDelta * 1.75f);
			identity.eulerAngles = zero;
			_modelT.localRotation = identity;
		}
		else
		{
			zero.x = Mathf.LerpAngle(_modelT.localEulerAngles.x, 0f, _spawner._newDelta * 1.75f);
			identity.eulerAngles = zero;
			_modelT.localRotation = identity;
		}
	}

	public void Wander(float delay)
	{
		if (!_landing)
		{
			_damping = UnityEngine.Random.Range(_spawner._minDamping, _spawner._maxDamping);
			_targetSpeed = UnityEngine.Random.Range(_spawner._minSpeed, _spawner._maxSpeed);
			Invoke("SetRandomMode", delay);
		}
	}

	public void SetRandomMode()
	{
		CancelInvoke("SetRandomMode");
		if (!_dived && UnityEngine.Random.value < _spawner._soarFrequency)
		{
			Soar();
		}
		else if (!_dived && UnityEngine.Random.value < _spawner._diveFrequency)
		{
			Dive();
		}
		else
		{
			Flap();
		}
	}

	public void Flap()
	{
		if (_move)
		{
			if (_model != null)
			{
				_model.GetComponent<Animation>().CrossFade(_spawner._flapAnimation, 0.5f);
			}
			_soar = false;
			animationSpeed();
			_wayPoint = findWaypoint();
			_dived = false;
		}
	}

	public Vector3 findWaypoint()
	{
		Vector3 zero = Vector3.zero;
		zero.x = UnityEngine.Random.Range(0f - _spawner._spawnSphere, _spawner._spawnSphere) + _spawner._posBuffer.x;
		zero.z = UnityEngine.Random.Range(0f - _spawner._spawnSphereDepth, _spawner._spawnSphereDepth) + _spawner._posBuffer.z;
		zero.y = UnityEngine.Random.Range(0f - _spawner._spawnSphereHeight, _spawner._spawnSphereHeight) + _spawner._posBuffer.y;
		return zero;
	}

	public void Soar()
	{
		if (_move)
		{
			_model.GetComponent<Animation>().CrossFade(_spawner._soarAnimation, 1.5f);
			_wayPoint = findWaypoint();
			_soar = true;
		}
	}

	public void Dive()
	{
		if (_spawner._soarAnimation != null)
		{
			_model.GetComponent<Animation>().CrossFade(_spawner._soarAnimation, 1.5f);
		}
		else
		{
			foreach (AnimationState item in _model.GetComponent<Animation>())
			{
				if (_thisT.position.y < _wayPoint.y + 25f)
				{
					item.speed = 0.1f;
				}
			}
		}
		_wayPoint = findWaypoint();
		_wayPoint.y -= _spawner._diveValue;
		_dived = true;
	}

	public void animationSpeed()
	{
		foreach (AnimationState item in _model.GetComponent<Animation>())
		{
			if (!_dived && !_landing)
			{
				item.speed = UnityEngine.Random.Range(_spawner._minAnimationSpeed, _spawner._maxAnimationSpeed);
			}
			else
			{
				item.speed = _spawner._maxAnimationSpeed;
			}
		}
	}
}
public class FlockChildFish : MonoBehaviour
{
	[HideInInspector]
	public FlockControllerFish _spawner;

	[HideInInspector]
	public Vector3 _wayPoint;

	public float _speed;

	[HideInInspector]
	public bool _dived = true;

	[HideInInspector]
	public float _stuckCounter;

	[HideInInspector]
	public float _damping;

	[HideInInspector]
	public bool _landing;

	[HideInInspector]
	public float _targetSpeed;

	[HideInInspector]
	public bool _move = true;

	public GameObject _model;

	public Transform _modelT;

	[HideInInspector]
	public float _avoidValue;

	[HideInInspector]
	public float _avoidDistance;

	private float _soarTimer;

	private bool _instantiated;

	private static int _updateNextSeed;

	private int _updateSeed = -1;

	[HideInInspector]
	public bool _avoid = true;

	public Transform _thisT;

	public Vector3 _landingPosOffset;

	public void Start()
	{
		FindRequiredComponents();
		Wander(0f);
		SetRandomScale();
		_thisT.position = findWaypoint();
		RandomizeStartAnimationFrame();
		_speed = _spawner._minSpeed;
		_spawner._activeChildren += 1f;
		_instantiated = true;
		if (_spawner._updateDivisor > 1)
		{
			int num = _spawner._updateDivisor - 1;
			_updateNextSeed++;
			_updateSeed = _updateNextSeed;
			_updateNextSeed %= num;
		}
	}

	public void Update()
	{
		if (_spawner._updateDivisor <= 1 || _spawner._updateCounter == _updateSeed)
		{
			CheckForDistanceToWaypoint();
			RotationBasedOnWaypointOrAvoidance();
			LimitRotationOfModel();
		}
	}

	public void OnDisable()
	{
		CancelInvoke();
		_spawner._activeChildren -= 1f;
	}

	public void OnEnable()
	{
		if (_instantiated)
		{
			_spawner._activeChildren += 1f;
			_model.GetComponent<Animation>().Play(_spawner._idleAnimation);
		}
	}

	public void FindRequiredComponents()
	{
		if (_thisT == null)
		{
			_thisT = base.transform;
		}
		if (_model == null)
		{
			_model = _thisT.Find("Model").gameObject;
		}
		if (_modelT == null)
		{
			_modelT = _model.transform;
		}
	}

	public void RandomizeStartAnimationFrame()
	{
		foreach (AnimationState item in _model.GetComponent<Animation>())
		{
			item.time = UnityEngine.Random.value * item.length;
		}
	}

	public void SetRandomScale()
	{
		float num = UnityEngine.Random.Range(_spawner._minScale, _spawner._maxScale);
		_thisT.localScale = new Vector3(num, num, num);
	}

	public void CheckForDistanceToWaypoint()
	{
		if (!_landing && (_thisT.position - _wayPoint).magnitude < _spawner._waypointDistance + _stuckCounter)
		{
			Wander(0f);
			_stuckCounter = 0f;
		}
		else if (!_landing)
		{
			_stuckCounter += _spawner._newDelta;
		}
		else
		{
			_stuckCounter = 0f;
		}
	}

	public void RotationBasedOnWaypointOrAvoidance()
	{
		Vector3 vector = _wayPoint - _thisT.position;
		if (_targetSpeed > -1f && vector != Vector3.zero)
		{
			Quaternion b = Quaternion.LookRotation(vector);
			_thisT.rotation = Quaternion.Slerp(_thisT.rotation, b, _spawner._newDelta * _damping);
		}
		if (_spawner._childTriggerPos && (_thisT.position - _spawner._posBuffer).magnitude < 1f)
		{
			_spawner.SetFlockRandomPosition();
		}
		_speed = Mathf.Lerp(_speed, _targetSpeed, _spawner._newDelta * 2.5f);
		if (_move)
		{
			_thisT.position += _thisT.forward * _speed * _spawner._newDelta;
		}
	}

	public void LimitRotationOfModel()
	{
		Quaternion identity = Quaternion.identity;
		Vector3 zero = Vector3.zero;
		identity = _modelT.localRotation;
		zero = identity.eulerAngles;
		zero.x = Mathf.LerpAngle(_modelT.localEulerAngles.x, 0f - _thisT.localEulerAngles.x, _spawner._newDelta * 1.75f);
		identity.eulerAngles = zero;
		_modelT.localRotation = identity;
	}

	public void Wander(float delay)
	{
		_damping = UnityEngine.Random.Range(_spawner._minDamping, _spawner._maxDamping);
		_targetSpeed = UnityEngine.Random.Range(_spawner._minSpeed, _spawner._maxSpeed);
	}

	public Vector3 findWaypoint()
	{
		Vector3 zero = Vector3.zero;
		zero.x = UnityEngine.Random.Range(0f - _spawner._spawnSphere, _spawner._spawnSphere) + _spawner._posBuffer.x;
		zero.z = UnityEngine.Random.Range(0f - _spawner._spawnSphereDepth, _spawner._spawnSphereDepth) + _spawner._posBuffer.z;
		zero.y = UnityEngine.Random.Range(0f - _spawner._spawnSphereHeight, _spawner._spawnSphereHeight) + _spawner._posBuffer.y;
		return zero;
	}

	public void animationSpeed()
	{
		foreach (AnimationState item in _model.GetComponent<Animation>())
		{
			if (!_dived && !_landing)
			{
				item.speed = UnityEngine.Random.Range(_spawner._minAnimationSpeed, _spawner._maxAnimationSpeed);
			}
			else
			{
				item.speed = _spawner._maxAnimationSpeed;
			}
		}
	}
}
public class FlockController : MonoBehaviour
{
	public FlockChild _childPrefab;

	public int _childAmount = 250;

	public bool _slowSpawn;

	public float _spawnSphere = 3f;

	public float _spawnSphereHeight = 3f;

	public float _spawnSphereDepth = -1f;

	public float _minSpeed = 6f;

	public float _maxSpeed = 10f;

	public float _minScale = 0.7f;

	public float _maxScale = 1f;

	public float _soarFrequency;

	public string _soarAnimation = "Soar";

	public string _flapAnimation = "Flap";

	public string _idleAnimation = "Idle";

	public float _diveValue = 7f;

	public float _diveFrequency = 0.5f;

	public float _minDamping = 1f;

	public float _maxDamping = 2f;

	public float _waypointDistance = 1f;

	public float _minAnimationSpeed = 2f;

	public float _maxAnimationSpeed = 4f;

	public float _randomPositionTimer = 10f;

	public float _positionSphere = 25f;

	public float _positionSphereHeight = 25f;

	public float _positionSphereDepth = -1f;

	public bool _childTriggerPos;

	public bool _forceChildWaypoints;

	public float _forcedRandomDelay = 1.5f;

	public bool _flatFly;

	public bool _flatSoar;

	public bool _birdAvoid;

	public int _birdAvoidHorizontalForce = 1000;

	public bool _birdAvoidDown;

	public bool _birdAvoidUp;

	public int _birdAvoidVerticalForce = 300;

	public float _birdAvoidDistanceMax = 4.5f;

	public float _birdAvoidDistanceMin = 5f;

	public float _soarMaxTime;

	public LayerMask _avoidanceMask = -1;

	public List<FlockChild> _roamers;

	public Vector3 _posBuffer;

	public int _updateDivisor = 1;

	public float _newDelta;

	public int _updateCounter;

	public float _activeChildren;

	public bool _groupChildToNewTransform;

	public Transform _groupTransform;

	public string _groupName = "";

	public bool _groupChildToFlock;

	public Vector3 _startPosOffset;

	public Transform _thisT;

	public void Start()
	{
		_thisT = base.transform;
		if (_positionSphereDepth == -1f)
		{
			_positionSphereDepth = _positionSphere;
		}
		if (_spawnSphereDepth == -1f)
		{
			_spawnSphereDepth = _spawnSphere;
		}
		_posBuffer = _thisT.position + _startPosOffset;
		if (!_slowSpawn)
		{
			AddChild(_childAmount);
		}
		if (_randomPositionTimer > 0f)
		{
			InvokeRepeating("SetFlockRandomPosition", _randomPositionTimer, _randomPositionTimer);
		}
	}

	public void AddChild(int amount)
	{
		if (_groupChildToNewTransform)
		{
			InstantiateGroup();
		}
		for (int i = 0; i < amount; i++)
		{
			FlockChild flockChild = UnityEngine.Object.Instantiate(_childPrefab);
			flockChild._spawner = this;
			_roamers.Add(flockChild);
			AddChildToParent(flockChild.transform);
		}
	}

	public void AddChildToParent(Transform obj)
	{
		if (_groupChildToFlock)
		{
			obj.parent = base.transform;
		}
		else if (_groupChildToNewTransform)
		{
			obj.parent = _groupTransform;
		}
	}

	public void RemoveChild(int amount)
	{
		for (int i = 0; i < amount; i++)
		{
			FlockChild flockChild = _roamers[_roamers.Count - 1];
			_roamers.RemoveAt(_roamers.Count - 1);
			UnityEngine.Object.Destroy(flockChild.gameObject);
		}
	}

	public void Update()
	{
		if (_activeChildren > 0f)
		{
			if (_updateDivisor > 1)
			{
				_updateCounter++;
				_updateCounter %= _updateDivisor;
				_newDelta = Time.deltaTime * (float)_updateDivisor;
			}
			else
			{
				_newDelta = Time.deltaTime;
			}
		}
		UpdateChildAmount();
	}

	public void InstantiateGroup()
	{
		if (!(_groupTransform != null))
		{
			GameObject gameObject = new GameObject();
			_groupTransform = gameObject.transform;
			_groupTransform.position = _thisT.position;
			if (_groupName != "")
			{
				gameObject.name = _groupName;
			}
			else
			{
				gameObject.name = _thisT.name + " Fish Container";
			}
		}
	}

	public void UpdateChildAmount()
	{
		if (_childAmount >= 0 && _childAmount < _roamers.Count)
		{
			RemoveChild(1);
		}
		else if (_childAmount > _roamers.Count)
		{
			AddChild(1);
		}
	}

	public void OnDrawGizmos()
	{
		if (_thisT == null)
		{
			_thisT = base.transform;
		}
		if (!UnityEngine.Application.isPlaying && _posBuffer != _thisT.position + _startPosOffset)
		{
			_posBuffer = _thisT.position + _startPosOffset;
		}
		if (_positionSphereDepth == -1f)
		{
			_positionSphereDepth = _positionSphere;
		}
		if (_spawnSphereDepth == -1f)
		{
			_spawnSphereDepth = _spawnSphere;
		}
		Gizmos.color = Color.blue;
		Gizmos.DrawWireCube(_posBuffer, new Vector3(_spawnSphere * 2f, _spawnSphereHeight * 2f, _spawnSphereDepth * 2f));
		Gizmos.color = Color.cyan;
		Gizmos.DrawWireCube(_thisT.position, new Vector3(_positionSphere * 2f + _spawnSphere * 2f, _positionSphereHeight * 2f + _spawnSphereHeight * 2f, _positionSphereDepth * 2f + _spawnSphereDepth * 2f));
	}

	public void SetFlockRandomPosition()
	{
		Vector3 zero = Vector3.zero;
		zero.x = UnityEngine.Random.Range(0f - _positionSphere, _positionSphere) + _thisT.position.x;
		zero.z = UnityEngine.Random.Range(0f - _positionSphereDepth, _positionSphereDepth) + _thisT.position.z;
		zero.y = UnityEngine.Random.Range(0f - _positionSphereHeight, _positionSphereHeight) + _thisT.position.y;
		_posBuffer = zero;
		if (_forceChildWaypoints)
		{
			for (int i = 0; i < _roamers.Count; i++)
			{
				_roamers[i].Wander(UnityEngine.Random.value * _forcedRandomDelay);
			}
		}
	}

	public void destroyBirds()
	{
		for (int i = 0; i < _roamers.Count; i++)
		{
			UnityEngine.Object.Destroy(_roamers[i].gameObject);
		}
		_childAmount = 0;
		_roamers.Clear();
	}
}
public class FlockControllerFish : MonoBehaviour
{
	public FlockChildFish _childPrefab;

	public int _childAmount = 250;

	public bool _slowSpawn;

	public float _spawnSphere = 3f;

	public float _spawnSphereHeight = 3f;

	public float _spawnSphereDepth = -1f;

	public float _minSpeed = 6f;

	public float _maxSpeed = 10f;

	public float _minScale = 0.7f;

	public float _maxScale = 1f;

	public string _idleAnimation = "Idle";

	public float _minDamping = 1f;

	public float _maxDamping = 2f;

	public float _waypointDistance = 1f;

	public float _minAnimationSpeed = 2f;

	public float _maxAnimationSpeed = 4f;

	public float _randomPositionTimer = 10f;

	public float _positionSphere = 25f;

	public float _positionSphereHeight = 25f;

	public float _positionSphereDepth = -1f;

	public bool _childTriggerPos;

	public bool _forceChildWaypoints;

	public float _forcedRandomDelay = 1.5f;

	public bool _flatFly;

	public List<FlockChildFish> _roamers;

	public Vector3 _posBuffer;

	public int _updateDivisor = 1;

	public float _newDelta;

	public int _updateCounter;

	public float _activeChildren;

	public bool _groupChildToNewTransform;

	public Transform _groupTransform;

	public string _groupName = "";

	public bool _groupChildToFlock;

	public Vector3 _startPosOffset;

	public Transform _thisT;

	public void Start()
	{
		_thisT = base.transform;
		if (_positionSphereDepth == -1f)
		{
			_positionSphereDepth = _positionSphere;
		}
		if (_spawnSphereDepth == -1f)
		{
			_spawnSphereDepth = _spawnSphere;
		}
		_posBuffer = _thisT.position + _startPosOffset;
		AddChild(_childAmount);
		if (_randomPositionTimer > 0f)
		{
			InvokeRepeating("SetFlockRandomPosition", _randomPositionTimer, _randomPositionTimer);
		}
	}

	public void AddChild(int amount)
	{
		if (_groupChildToNewTransform)
		{
			InstantiateGroup();
		}
		for (int i = 0; i < amount; i++)
		{
			FlockChildFish flockChildFish = UnityEngine.Object.Instantiate(_childPrefab);
			flockChildFish._spawner = this;
			_roamers.Add(flockChildFish);
			AddChildToParent(flockChildFish.transform);
		}
	}

	public void AddChildToParent(Transform obj)
	{
		if (_groupChildToFlock)
		{
			obj.parent = base.transform;
		}
		else if (_groupChildToNewTransform)
		{
			obj.parent = _groupTransform;
		}
	}

	public void RemoveChild(int amount)
	{
		for (int i = 0; i < amount; i++)
		{
			FlockChildFish flockChildFish = _roamers[_roamers.Count - 1];
			_roamers.RemoveAt(_roamers.Count - 1);
			UnityEngine.Object.Destroy(flockChildFish.gameObject);
		}
	}

	public void Update()
	{
		if (_activeChildren > 0f)
		{
			if (_updateDivisor > 1)
			{
				_updateCounter++;
				_updateCounter %= _updateDivisor;
				_newDelta = Time.deltaTime * (float)_updateDivisor;
			}
			else
			{
				_newDelta = Time.deltaTime;
			}
		}
		UpdateChildAmount();
	}

	public void InstantiateGroup()
	{
		if (!(_groupTransform != null))
		{
			GameObject gameObject = new GameObject();
			_groupTransform = gameObject.transform;
			_groupTransform.position = _thisT.position;
			if (_groupName != "")
			{
				gameObject.name = _groupName;
			}
			else
			{
				gameObject.name = _thisT.name + " Fish Container";
			}
		}
	}

	public void UpdateChildAmount()
	{
		if (_childAmount >= 0 && _childAmount < _roamers.Count)
		{
			RemoveChild(1);
		}
		else if (_childAmount > _roamers.Count)
		{
			AddChild(1);
		}
	}

	public void OnDrawGizmos()
	{
		if (_thisT == null)
		{
			_thisT = base.transform;
		}
		if (!UnityEngine.Application.isPlaying && _posBuffer != _thisT.position + _startPosOffset)
		{
			_posBuffer = _thisT.position + _startPosOffset;
		}
		if (_positionSphereDepth == -1f)
		{
			_positionSphereDepth = _positionSphere;
		}
		if (_spawnSphereDepth == -1f)
		{
			_spawnSphereDepth = _spawnSphere;
		}
		Gizmos.color = Color.blue;
		Gizmos.DrawWireCube(_posBuffer, new Vector3(_spawnSphere * 2f, _spawnSphereHeight * 2f, _spawnSphereDepth * 2f));
		Gizmos.color = Color.cyan;
		Gizmos.DrawWireCube(_thisT.position, new Vector3(_positionSphere * 2f + _spawnSphere * 2f, _positionSphereHeight * 2f + _spawnSphereHeight * 2f, _positionSphereDepth * 2f + _spawnSphereDepth * 2f));
	}

	public void SetFlockRandomPosition()
	{
		Vector3 zero = Vector3.zero;
		zero.x = UnityEngine.Random.Range(0f - _positionSphere, _positionSphere) + _thisT.position.x;
		zero.z = UnityEngine.Random.Range(0f - _positionSphereDepth, _positionSphereDepth) + _thisT.position.z;
		zero.y = UnityEngine.Random.Range(0f - _positionSphereHeight, _positionSphereHeight) + _thisT.position.y;
		_posBuffer = zero;
		if (_forceChildWaypoints)
		{
			for (int i = 0; i < _roamers.Count; i++)
			{
				_roamers[i].Wander(UnityEngine.Random.value * _forcedRandomDelay);
			}
		}
	}
}
public class aniSpeed : MonoBehaviour
{
	public float speed = 1f;

	public string aniName = "Take 001";

	private Animation ani;

	private void Start()
	{
		ani = GetComponent<Animation>();
		randomPlay();
	}

	private void randomPlay()
	{
		ani[aniName].speed = speed;
	}
}
public class AquaAnimalItem : MonoBehaviour, IPointerEnterHandler, IEventSystemHandler, IPointerExitHandler
{
	public int id;

	public Text itemName;

	public Image image;

	public Image toggle;

	public Sprite[] toggleImages;

	private bool On;

	public bool achievementItem;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	public void ShowToggle(bool value)
	{
		toggle.gameObject.SetActive(value);
	}

	public void SetToggle(bool value)
	{
		if (value)
		{
			On = true;
			toggle.sprite = toggleImages[1];
			dataManager.userData.animals[id].state = true;
			main.aquariumController.AddAwardFish();
		}
		else
		{
			On = false;
			toggle.sprite = toggleImages[0];
			dataManager.userData.animals[id].state = false;
			main.aquariumController.RemoveAwardFish();
		}
	}

	public void ToggleEvent()
	{
		On = !On;
		SetToggle(On);
		dataManager.Save();
	}

	public void OnPointerEnter(PointerEventData pointerEventData)
	{
		if (!toggle.gameObject.activeInHierarchy)
		{
			main.aquariumManager.ShowAquaPopup(achievementItem);
		}
	}

	public void OnPointerExit(PointerEventData pointerEventData)
	{
		main.aquariumManager.HideAquaPopup();
	}
}
public class AquaFishContainer : MonoBehaviour
{
	public Text currentUI;

	public Text maxUI;

	public int totalPage;

	public int currentPage;

	public GameObject pagingContent;

	public GameObject pagingPrefab;

	public List<GameObject> pagings;

	private Color32 selectedColor;

	private Color32 unSelectedColor;

	private DataManager dataManager;

	private Main main;

	private List<FishItem> aquaFishes = new List<FishItem>();

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		selectedColor = Singleton<AchievementController>.Instance.color_buttonSelected;
		unSelectedColor = Singleton<AchievementController>.Instance.color_buttonUnSelected;
		foreach (FishItem fishItem in dataManager.ItemDatabase.dlcs[dataManager.currentNation].fishItems)
		{
			if (main.lobbyId == 0)
			{
				if (fishItem.ID < 25)
				{
					aquaFishes.Add(fishItem);
				}
			}
			else if (main.lobbyId == 1 && fishItem.ID >= 25)
			{
				aquaFishes.Add(fishItem);
			}
		}
	}

	private void OnEnable()
	{
		currentPage = 0;
		totalPage = (int)Mathf.Ceil((float)aquaFishes.Count / 8f);
		SetStatus();
		foreach (GameObject paging in pagings)
		{
			UnityEngine.Object.Destroy(paging);
		}
		pagings.Clear();
		for (int i = 0; i < totalPage; i++)
		{
			GameObject item = UnityEngine.Object.Instantiate(pagingPrefab, pagingContent.transform);
			pagings.Add(item);
		}
		SelectPaging();
		main.aquaFishManager.ShowItems(currentPage);
	}

	public void SelectPaging()
	{
		for (int i = 0; i < pagings.Count; i++)
		{
			if (i == currentPage)
			{
				pagings[i].GetComponent<Image>().color = selectedColor;
			}
			else
			{
				pagings[i].GetComponent<Image>().color = unSelectedColor;
			}
		}
	}

	public void SetStatus()
	{
		int currentFishCount = main.aquariumController.GetCurrentFishCount();
		currentUI.text = currentFishCount.ToString();
		main.aquariumController.CheckAchivementAqua(currentFishCount);
		maxUI.text = main.aquariumController.fishTankMax.ToString();
	}

	public void PrevPage()
	{
		if (currentPage > 0)
		{
			currentPage--;
			main.aquaFishManager.ShowItems(currentPage);
			SelectPaging();
		}
	}

	public void NextPage()
	{
		if (currentPage < totalPage - 1)
		{
			currentPage++;
			main.aquaFishManager.ShowItems(currentPage);
			SelectPaging();
		}
	}
}
public class AquaFishInfoPopupContainer : MonoBehaviour
{
	public Text desc;

	public void SetText(string text)
	{
		desc.text = text;
	}

	public void Close()
	{
	}
}
public class AquaFishItem : MonoBehaviour
{
	public int id;

	public Text fishname;

	public Image image;

	public Image panel;

	public Text countText;

	private int count;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
	}

	public void SetCount(int val)
	{
		if (val >= 0)
		{
			count = val;
			countText.text = count.ToString();
		}
	}

	public void Select()
	{
		main.aquaFishManager.ShowFishPopup(id);
	}

	public void Increase()
	{
		int iD = main.aquaFishManager.aquaFishes[id].ID;
		int currentFishCount = main.aquariumController.GetCurrentFishCount();
		int num = dataManager.userData.fishes[main.nationId].fishCount[iD];
		if (count >= num || currentFishCount >= main.aquariumController.fishTankMax)
		{
			return;
		}
		count++;
		countText.text = count.ToString();
		dataManager.userData.aquariums[main.nationId].rooms[main.lobbyId].fishCount[id] = count;
		main.aquaFishManager.SetStatus();
		main.aquariumController.AddFish(id);
		main.aquariumController.CheckAchivementAqua(count);
		dataManager.SaveUserData();
		foreach (GameObject fishItem in main.aquaFishManager.fishItems)
		{
			fishItem.GetComponent<AquaFishItem>().changeColor();
		}
	}

	public void Decrease()
	{
		if (count <= 0)
		{
			return;
		}
		count--;
		countText.text = count.ToString();
		dataManager.userData.aquariums[main.nationId].rooms[main.lobbyId].fishCount[id] = count;
		main.aquaFishManager.SetStatus();
		main.aquariumController.RemoveFish(id);
		dataManager.SaveUserData();
		foreach (GameObject fishItem in main.aquaFishManager.fishItems)
		{
			fishItem.GetComponent<AquaFishItem>().changeColor();
		}
	}

	public void changeColor()
	{
		int iD = main.aquaFishManager.aquaFishes[id].ID;
		int currentFishCount = main.aquariumController.GetCurrentFishCount();
		int num = dataManager.userData.fishes[main.nationId].fishCount[iD];
		if (count < num && currentFishCount < main.aquariumController.fishTankMax)
		{
			panel.color = Singleton<AchievementController>.Instance.color_buttonSelected;
		}
		else
		{
			panel.color = Singleton<AchievementController>.Instance.color_buttonUnSelected;
		}
	}

	public void Reset()
	{
		dataManager.userData.aquariums[main.nationId].rooms[main.lobbyId].fishCount[id] = 0;
		count = 0;
		countText.text = "0";
		main.aquaFishManager.SetStatus();
		main.aquariumController.UpdateFish(id);
		dataManager.SaveUserData();
		foreach (GameObject fishItem in main.aquaFishManager.fishItems)
		{
			fishItem.GetComponent<AquaFishItem>().changeColor();
		}
	}
}
public class AquaFishPopupContainer : MonoBehaviour
{
	public Image fish;

	public Text itemName;

	public Text totalCount;

	public Text maxSize;

	public Text maxWeight;

	public Image[] habitAts;

	public Image[] baits;

	public Text limit;

	public Text fishGrade;

	private void Awake()
	{
	}

	public void SetMaxCount()
	{
	}

	public void Close()
	{
		Singleton<Main>.Instance.aquaFishManager.CloseFishPopup();
	}
}
public class AquaPopupContainer : MonoBehaviour
{
	public Text desc;

	private Main main;

	private void Awake()
	{
		main = Singleton<Main>.Instance;
	}

	public void SetText(string text)
	{
		desc.text = text;
	}

	public void Close()
	{
		main.aquariumManager.HideAquaPopup();
	}
}
public class AquariumContainer : MonoBehaviour
{
	private void OnEnable()
	{
	}

	public void ToggleEvent(bool b)
	{
	}
}
public enum FISHHABITAT
{
	LAKE,
	RIVER,
	LAKE_RIVER,
	SEA
}
public enum FISHGRADE
{
	NORMAL,
	RARE
}
public class AquariumFishManager : MonoBehaviour
{
	public bool isCreated;

	public GameObject aquaFishPanel;

	public GameObject fishPrefab;

	public GameObject fishContent;

	public List<GameObject> fishItems;

	public AquaFishPopupContainer aquaFishPopup;

	public AquaFishInfoPopupContainer aquaFishInfoPopup;

	public AquaFishContainer aquaFishContainer;

	public List<Sprite> FishHabitAtSprites;

	private DataManager dataManager;

	private Main main;

	[SerializeField]
	public List<FishItem> aquaFishes = new List<FishItem>();

	public int countPerPage = 8;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		aquaFishPanel.SetActive(value: true);
		aquaFishPopup.gameObject.SetActive(value: false);
		List<FishItem> list = dataManager.ItemDatabase.dlcs[main.nationId].fishItems;
		for (int i = 0; i < list.Count; i++)
		{
			for (int j = 0; j < list[i].rooms.Count; j++)
			{
				if (list[i].rooms[j] == main.lobbyId)
				{
					aquaFishes.Add(list[i]);
				}
			}
		}
	}

	private void OnEnable()
	{
		if (!isCreated)
		{
			CreateFishItems();
		}
	}

	private void OnDisable()
	{
		CloseFishPopup();
	}

	private void CreateFishItems()
	{
		for (int i = 0; i < aquaFishes.Count; i++)
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(fishPrefab, fishContent.transform);
			gameObject.GetComponent<AquaFishItem>().id = i;
			gameObject.GetComponent<AquaFishItem>().fishname.GetComponent<Localize>().SetKey(aquaFishes[i].multiLineNameKey);
			gameObject.GetComponent<AquaFishItem>().image.sprite = aquaFishes[i].shopIconImage;
			int count = dataManager.userData.aquariums[main.nationId].rooms[main.lobbyId].fishCount[i];
			gameObject.GetComponent<AquaFishItem>().SetCount(count);
			gameObject.GetComponent<AquaFishItem>().changeColor();
			fishItems.Add(gameObject);
		}
		ShowItems(0);
		isCreated = true;
	}

	public IEnumerator delayShowItem(int index)
	{
		yield return new WaitForSeconds(1f);
		ShowItems(index);
	}

	public void ShowItems(int page)
	{
		Mathf.Ceil((float)aquaFishes.Count / (float)countPerPage);
		int num = page * countPerPage;
		int num2 = (page + 1) * countPerPage;
		for (int i = 0; i < aquaFishes.Count; i++)
		{
			if (i >= num && i < num2)
			{
				fishItems[i].SetActive(value: true);
			}
			else
			{
				fishItems[i].SetActive(value: false);
			}
		}
	}

	public void ShowFishInfoPopup(bool show)
	{
		aquaFishInfoPopup.gameObject.SetActive(show);
	}

	public void CloseFishPopup()
	{
		aquaFishPopup.gameObject.SetActive(value: false);
	}

	public void ShowFishPopup(int id)
	{
		int iD = main.aquaFishManager.aquaFishes[id].ID;
		aquaFishPopup.itemName.GetComponent<Localize>().SetKey(main.aquaFishManager.aquaFishes[id].nameKey);
		int num = dataManager.userData.fishes[main.nationId].fishCount[iD];
		float num2 = dataManager.userData.fishes[main.nationId].maxWeight[iD];
		if (dataManager.userData.unit == 0)
		{
			num2 = dataManager.changeUnitWeight(num2) * 0.001f;
			aquaFishPopup.maxWeight.text = num2.ToString("N2") + " lb";
		}
		else
		{
			num2 = dataManager.changeUnitKg(num2);
			aquaFishPopup.maxWeight.text = num2.ToString("N2") + " kg";
		}
		float cmToIn = dataManager.userData.fishes[main.nationId].maxSize[iD];
		if (dataManager.userData.unit == 0)
		{
			cmToIn = dataManager.changeUnitLength(cmToIn);
			aquaFishPopup.maxSize.text = cmToIn.ToString("N2") + " " + LocalizationManager.GetKeyTranslation("LodgeTVSettings/0013");
		}
		else
		{
			aquaFishPopup.maxSize.text = cmToIn.ToString("N2") + " " + LocalizationManager.GetKeyTranslation("LodgeTVSettings/0014");
		}
		int[] fishhabitat = main.aquaFishManager.aquaFishes[id].fishhabitat;
		int[] fishbait = main.aquaFishManager.aquaFishes[id].fishbait;
		aquaFishPopup.fish.sprite = main.aquaFishManager.aquaFishes[id].descImage;
		aquaFishPopup.totalCount.text = num.ToString();
		for (int i = 0; i < 4; i++)
		{
			if (fishhabitat.Length > i)
			{
				aquaFishPopup.habitAts[i].gameObject.SetActive(value: true);
				aquaFishPopup.habitAts[i].sprite = FishHabitAtSprites[fishhabitat[i]];
			}
			else
			{
				aquaFishPopup.habitAts[i].gameObject.SetActive(value: false);
			}
		}
		for (int j = 0; j < 4; j++)
		{
			if (fishbait.Length > j)
			{
				aquaFishPopup.baits[j].gameObject.SetActive(value: true);
				aquaFishPopup.baits[j].sprite = dataManager.ItemDatabase.lureItems[fishbait[j]].descImage;
			}
			else
			{
				aquaFishPopup.baits[j].gameObject.SetActive(value: false);
			}
		}
		int num3 = dataManager.userData.fishes[main.nationId].fishCount[iD];
		if (num3 <= 50)
		{
			aquaFishPopup.limit.text = num3.ToString();
		}
		else
		{
			aquaFishPopup.limit.text = main.aquariumController.fishTankMax.ToString();
		}
		if (main.aquaFishManager.aquaFishes[id].fishRare == 0)
		{
			aquaFishPopup.fishGrade.gameObject.SetActive(value: false);
		}
		else
		{
			aquaFishPopup.fishGrade.gameObject.SetActive(value: true);
		}
		aquaFishPopup.gameObject.SetActive(value: true);
	}

	public void SetStatus()
	{
		aquaFishContainer.SetStatus();
	}

	public void ResetAquariumFish()
	{
		for (int i = 0; i < aquaFishes.Count; i++)
		{
			fishItems[i].GetComponent<AquaFishItem>().Reset();
			main.aquariumController.UpdateFish(i);
		}
	}
}
public class AquariumItem : MonoBehaviour, IPointerEnterHandler, IEventSystemHandler, IPointerExitHandler
{
	public int id;

	public Text itemName;

	public Image image;

	public Image toggle;

	public Sprite[] toggleImages;

	private bool On;

	public bool achievementItem;

	public AquariumType type;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	public void ShowToggle(bool value)
	{
		toggle.gameObject.SetActive(value);
	}

	public void SetToggle(bool value)
	{
		if (type == AquariumType.WALL)
		{
			if (value)
			{
				On = true;
				toggle.sprite = toggleImages[1];
				for (int i = 0; i < main.aquariumManager.wallPrefabs.Count; i++)
				{
					if (i == id)
					{
						dataManager.userData.aquariums[main.nationId].rooms[main.lobbyId].items[i].state = true;
						main.aquariumManager.wallPrefabs[i].GetComponent<AquariumItem>().toggle.sprite = toggleImages[1];
						main.aquariumController.SettingWall(id);
					}
					else
					{
						dataManager.userData.aquariums[main.nationId].rooms[main.lobbyId].items[i].state = false;
						main.aquariumManager.wallPrefabs[i].GetComponent<AquariumItem>().toggle.sprite = toggleImages[0];
					}
				}
			}
			else
			{
				On = false;
				toggle.sprite = toggleImages[0];
			}
		}
		else if (value)
		{
			On = true;
			toggle.sprite = toggleImages[1];
			dataManager.userData.aquariums[main.nationId].rooms[main.lobbyId].items[id].state = true;
			main.aquariumController.SettingDeco(id, On);
		}
		else
		{
			On = false;
			toggle.sprite = toggleImages[0];
			dataManager.userData.aquariums[main.nationId].rooms[main.lobbyId].items[id].state = false;
			main.aquariumController.SettingDeco(id, On);
		}
	}

	public void ToggleEvent()
	{
		if (type == AquariumType.DECORATION)
		{
			On = !On;
		}
		else
		{
			On = true;
		}
		SetToggle(On);
		dataManager.Save();
	}

	public void OnPointerEnter(PointerEventData pointerEventData)
	{
		if (!toggle.gameObject.activeInHierarchy)
		{
			main.aquariumManager.ShowAquaPopup(achievementItem);
		}
	}

	public void OnPointerExit(PointerEventData pointerEventData)
	{
		main.aquariumManager.HideAquaPopup();
	}
}
public class AquariumManager : MonoBehaviour
{
	public bool isCreated;

	public GameObject aquariumPanel;

	public GameObject aquariumPrefab;

	public GameObject aquaAnimalPrefab;

	public GameObject wallsContent;

	public List<GameObject> wallPrefabs;

	public GameObject decorationsContent;

	public List<GameObject> decorationPrefabs;

	public GameObject animalsContent;

	public List<GameObject> animalsPrefabs;

	public AquaPopupContainer aquaPopup;

	public string aquaInfoPopupText_store = "PURCHASE IT AT THE STORE TO ACTIVATE";

	public string aquaInfoPopupText_achive = "UNLOCK ACHIEVEMENTS TO ACTIVATE";

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		aquariumPanel.SetActive(value: true);
		aquaPopup.gameObject.SetActive(value: false);
	}

	private void OnEnable()
	{
		if (main.lobbyId == 0)
		{
			CreateAquariumItems();
		}
		else
		{
			CreateAnimalItems();
		}
	}

	private void OnDisable()
	{
	}

	private void CreateAquariumItems()
	{
		foreach (GameObject wallPrefab in wallPrefabs)
		{
			UnityEngine.Object.Destroy(wallPrefab);
		}
		foreach (GameObject decorationPrefab in decorationPrefabs)
		{
			UnityEngine.Object.Destroy(decorationPrefab);
		}
		wallPrefabs.Clear();
		decorationPrefabs.Clear();
		AquariumDataList aquariumDataList = dataManager.userData.aquariums[main.nationId].rooms[main.lobbyId];
		for (int i = 0; i < aquariumDataList.items.Count; i++)
		{
			if (dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[i].type == AquariumType.WALL)
			{
				GameObject gameObject = UnityEngine.Object.Instantiate(aquariumPrefab, wallsContent.transform);
				gameObject.GetComponent<AquariumItem>().id = dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[i].ID;
				gameObject.GetComponent<AquariumItem>().itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[i].nameKey);
				gameObject.GetComponent<AquariumItem>().image.sprite = dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[i].descImage;
				gameObject.GetComponent<AquariumItem>().achievementItem = dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[i].achievementItem;
				gameObject.GetComponent<AquariumItem>().type = dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[i].type;
				gameObject.GetComponent<AquariumItem>().SetToggle(aquariumDataList.items[i].state);
				gameObject.GetComponent<AquariumItem>().ShowToggle(aquariumDataList.items[i].purchased);
				wallPrefabs.Add(gameObject);
			}
			else if (dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[i].type == AquariumType.DECORATION)
			{
				GameObject gameObject2 = UnityEngine.Object.Instantiate(aquariumPrefab, decorationsContent.transform);
				gameObject2.GetComponent<AquariumItem>().id = dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[i].ID;
				gameObject2.GetComponent<AquariumItem>().itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[i].nameKey);
				gameObject2.GetComponent<AquariumItem>().achievementItem = dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[i].achievementItem;
				gameObject2.GetComponent<AquariumItem>().image.sprite = dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[i].descImage;
				gameObject2.GetComponent<AquariumItem>().type = dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[i].type;
				gameObject2.GetComponent<AquariumItem>().SetToggle(aquariumDataList.items[i].state);
				gameObject2.GetComponent<AquariumItem>().ShowToggle(aquariumDataList.items[i].purchased);
				decorationPrefabs.Add(gameObject2);
			}
		}
	}

	public void CreateAnimalItems()
	{
		foreach (GameObject animalsPrefab in animalsPrefabs)
		{
			UnityEngine.Object.Destroy(animalsPrefab);
		}
		animalsPrefabs.Clear();
		List<AnimalData> animals = dataManager.userData.animals;
		for (int i = 0; i < animals.Count; i++)
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(aquaAnimalPrefab, animalsContent.transform);
			gameObject.GetComponent<AquaAnimalItem>().id = dataManager.ItemDatabase.animalItems[i].ID;
			gameObject.GetComponent<AquaAnimalItem>().itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.animalItems[i].nameKey);
			gameObject.GetComponent<AquaAnimalItem>().image.sprite = dataManager.ItemDatabase.animalItems[i].descImage;
			gameObject.GetComponent<AquaAnimalItem>().achievementItem = dataManager.ItemDatabase.animalItems[i].achievementItem;
			gameObject.GetComponent<AquaAnimalItem>().SetToggle(dataManager.userData.animals[i].state);
			gameObject.GetComponent<AquaAnimalItem>().ShowToggle(dataManager.userData.animals[i].purchased);
			animalsPrefabs.Add(gameObject);
		}
	}

	public void ShowAquaPopup(bool isaAhievementItem)
	{
		if (!isaAhievementItem)
		{
			aquaPopup.desc.GetComponent<Localize>().SetKey("LodgeTVInteriorAquarium/0013");
		}
		else
		{
			aquaPopup.desc.GetComponent<Localize>().SetKey("LodgeTVInteriorAquarium/0014");
		}
		aquaPopup.gameObject.SetActive(value: true);
	}

	public void HideAquaPopup()
	{
		aquaPopup.gameObject.SetActive(value: false);
	}
}
public class FishInfo : MonoBehaviour, IPointerEnterHandler, IEventSystemHandler, IPointerExitHandler
{
	private Main main;

	private void Awake()
	{
		main = Singleton<Main>.Instance;
	}

	public void OnPointerEnter(PointerEventData pointerEventData)
	{
		main.aquaFishManager.ShowFishInfoPopup(show: true);
	}

	public void OnPointerExit(PointerEventData pointerEventData)
	{
		main.aquaFishManager.ShowFishInfoPopup(show: false);
	}
}
public class AquaTexAni : MonoBehaviour
{
	public float delaySpeed = 0.1f;

	public Material causticObjMat;

	public Material causticSandMat;

	public int XNum = 4;

	public int YNum = 4;

	private int x;

	private int y;

	private void Start()
	{
		StartCoroutine(AniTex());
	}

	private IEnumerator AniTex()
	{
		x++;
		if (x > XNum - 1)
		{
			x = 0;
			y++;
			if (y > YNum - 1)
			{
				y = 0;
			}
		}
		causticObjMat.SetTextureOffset("_Caustic", new Vector2((float)x * 0.25f, 1f - (float)y * 0.25f));
		causticSandMat.SetTextureOffset("_Caustic", new Vector2((float)x * 0.25f, 1f - (float)y * 0.25f));
		yield return new WaitForSeconds(delaySpeed);
		StartCoroutine(AniTex());
	}
}
public class AquaTexFish : MonoBehaviour
{
	public float delaySpeed = 0.1f;

	public Material aquaFishMat;

	public int XNum = 4;

	public int YNum = 4;

	private int x;

	private int y;

	private void Start()
	{
		StartCoroutine(AniTex());
	}

	private IEnumerator AniTex()
	{
		x++;
		if (x > XNum - 1)
		{
			x = 0;
			y++;
			if (y > YNum - 1)
			{
				y = 0;
			}
		}
		aquaFishMat.SetTextureOffset("_Caustic", new Vector2((float)x * 0.25f, 1f - (float)y * 0.25f));
		yield return new WaitForSeconds(delaySpeed);
		StartCoroutine(AniTex());
	}
}
public class audioRandom : MonoBehaviour
{
	private float randomTime;

	public float minAudioTimeCycle = 20f;

	private AudioSource audioR;

	private void Start()
	{
		randomTime = UnityEngine.Random.Range(minAudioTimeCycle, minAudioTimeCycle * 2f);
		audioR = GetComponent<AudioSource>();
		StartCoroutine(audioPlay());
	}

	private IEnumerator audioPlay()
	{
		while (true)
		{
			if (!audioR.isPlaying)
			{
				audioR.Play();
			}
			yield return new WaitForSeconds(randomTime);
		}
	}
}
public class autoDestory : MonoBehaviour
{
	public float destroyTime;

	private void Start()
	{
		UnityEngine.Object.Destroy(base.gameObject, destroyTime);
	}
}
public class autoDestroy : MonoBehaviour
{
	public float destoryTime = 2f;

	private void Start()
	{
		Invoke("destroy", destoryTime);
	}

	private void destroy()
	{
		UnityEngine.Object.Destroy(base.gameObject);
	}
}
public class autoHide : MonoBehaviour
{
	public float offTime = 2f;

	private void Start()
	{
		Invoke("hide", offTime);
	}

	private void hide()
	{
		base.gameObject.SetActive(value: false);
	}
}
public class AvatarEye : MonoBehaviour
{
	public GameObject innerEye;

	public GameObject outerEye;
}
public class AvatarHat : MonoBehaviour
{
	public GameObject hairPrefab;

	public void ShowHairPrefab(bool show)
	{
		if (show)
		{
			hairPrefab.SetActive(value: true);
		}
		else
		{
			hairPrefab.SetActive(value: false);
		}
	}
}
[Serializable]
public class GenderSubCat
{
	public Transform[] subCategories;
}
public class CustomizingAvatarController : MonoBehaviour
{
	[Header("Mirror")]
	public GameObject canvas_Mirror;

	[Header("AvatarPrefab")]
	public GameObject avatarPrefab;

	[HideInInspector]
	public AvatarController myAvatar;

	[Header("MainCategories")]
	public GameObject[] mainCategoryButtons;

	public Button[] upperButtons;

	public Color selectedColor;

	public Color unselectedColor;

	public CustomizingCategory currentSelectedCategory;

	public GameObject[] secondMainCategories;

	[Header("Subcategories")]
	public GameObject elementPrefab;

	public GameObject[] genderPanels;

	public Sprite[] genderImages;

	public float scrollSpeed = 0.01f;

	private List<GameObject> genderItemsM = new List<GameObject>();

	private List<GameObject> genderItemsFM = new List<GameObject>();

	private List<GameObject> faceItemsM = new List<GameObject>();

	private List<GameObject> faceItemsFM = new List<GameObject>();

	private List<GameObject> hairItemsM = new List<GameObject>();

	private List<GameObject> hairItemsFM = new List<GameObject>();

	private List<GameObject> mustacheItemsM = new List<GameObject>();

	private List<GameObject> mustacheItemsFM = new List<GameObject>();

	private List<GameObject> eyebrowItemsM = new List<GameObject>();

	private List<GameObject> eyebrowItemsFM = new List<GameObject>();

	private List<GameObject> innerfitItemsM = new List<GameObject>();

	private List<GameObject> innerfitItemsFM = new List<GameObject>();

	private List<GameObject> outerfitItemsM = new List<GameObject>();

	private List<GameObject> outerfitItemsFM = new List<GameObject>();

	private List<GameObject> hatItemsM = new List<GameObject>();

	private List<GameObject> hatItemsFM = new List<GameObject>();

	private List<GameObject> glassesItemsM = new List<GameObject>();

	private List<GameObject> glassesItemsFM = new List<GameObject>();

	private List<GameObject> glovesItemsM = new List<GameObject>();

	private List<GameObject> glovesItemsFM = new List<GameObject>();

	public List<List<GameObject>> itemsM = new List<List<GameObject>>();

	public List<List<GameObject>> itemsFM = new List<List<GameObject>>();

	[Header("ColorPalette")]
	public ColorSetDatabase colorSetDatabase;

	public GameObject[] palettePanels;

	public GameObject colorButtonPrefab;

	public ToggleGroup[] toggleGroups;

	[Header("Cautions")]
	public GameObject saveCaution;

	public GameObject undoCaution;

	private DataManager dataManager;

	private Main main;

	[Header("DataToSave")]
	public int curGender;

	public int curFace;

	public int curFaceColor;

	public int curAge;

	public int curEyeColor;

	public int curHair;

	public int curHairColor;

	public int curMustache;

	public int curMustacheColor;

	public int curEyebrow;

	public int curEyebrowColor;

	public int curInnerfit;

	public int curInnerfitColor;

	public int curOuterfit;

	public int curOuterfitColor;

	public int curHat;

	public int curGlasses;

	public int curWatch;

	public int curGlove;

	private bool isScrolling;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
		InstantiateAvatar();
		InstantiateSubElements();
		InstantiateColorPaletteButtons();
		SelectUpperButtonEvent(0);
		SelectMainCategoryEvent(0);
		GenderCheck();
	}

	public void TurnOnMirror(bool turnOn)
	{
		canvas_Mirror.SetActive(turnOn);
	}

	public void SelectMainCategoryEvent(int index)
	{
		CheckGenderPanel(curGender);
		currentSelectedCategory = (CustomizingCategory)index;
		ShowItems(index);
		OpenColorPalette(index);
	}

	public void SelectUpperButtonEvent(int buttonIndex)
	{
		for (int i = 0; i < upperButtons.Length; i++)
		{
			if (i == buttonIndex)
			{
				upperButtons[i].GetComponent<Image>().color = selectedColor;
			}
			else
			{
				upperButtons[i].GetComponent<Image>().color = unselectedColor;
			}
		}
		InitSecondMainCategory();
		if (buttonIndex == 5 || buttonIndex == 6)
		{
			ShowSecondMainCategory(buttonIndex);
		}
	}

	public void GenderCheck()
	{
		if (curGender == 0)
		{
			if (!upperButtons[3].gameObject.activeSelf)
			{
				upperButtons[3].gameObject.SetActive(value: true);
			}
		}
		else if (upperButtons[3].gameObject.activeSelf)
		{
			upperButtons[3].gameObject.SetActive(value: false);
		}
	}

	private void InitSecondMainCategory()
	{
		for (int i = 0; i < secondMainCategories.Length; i++)
		{
			if (secondMainCategories[i].activeSelf)
			{
				secondMainCategories[i].SetActive(value: false);
			}
		}
	}

	private void ShowItems(int index)
	{
		ScrollRect component = genderPanels[curGender].GetComponent<ScrollRect>();
		if (curGender == 0)
		{
			for (int i = 0; i < itemsM.Count; i++)
			{
				if (i == index)
				{
					foreach (GameObject item in itemsM[index])
					{
						item.SetActive(value: true);
					}
					continue;
				}
				foreach (GameObject item2 in itemsM[i])
				{
					item2.SetActive(value: false);
				}
			}
			if (itemsM[index].Count > 5)
			{
				component.content.pivot = new Vector2(0f, 0.5f);
				component.horizontalNormalizedPosition = 0f;
			}
			else
			{
				component.content.pivot = new Vector2(0.5f, 0.5f);
				component.horizontalNormalizedPosition = 0.5f;
			}
			return;
		}
		for (int j = 0; j < itemsFM.Count; j++)
		{
			if (j == index)
			{
				foreach (GameObject item3 in itemsFM[index])
				{
					item3.SetActive(value: true);
				}
				continue;
			}
			foreach (GameObject item4 in itemsFM[j])
			{
				item4.SetActive(value: false);
			}
		}
		if (itemsFM[index].Count > 5)
		{
			component.content.pivot = new Vector2(0f, 0.5f);
			component.horizontalNormalizedPosition = 0f;
		}
		else
		{
			component.content.pivot = new Vector2(0.5f, 0.5f);
			component.horizontalNormalizedPosition = 0.5f;
		}
	}

	private void ShowSecondMainCategory(int upperButtonIndex)
	{
		switch (upperButtonIndex)
		{
		case 5:
			secondMainCategories[0].SetActive(value: true);
			break;
		case 6:
			secondMainCategories[1].SetActive(value: true);
			break;
		}
	}

	private void OpenColorPalette(int index)
	{
		InitColorPalette();
		if (index >= 1 && index <= 3)
		{
			palettePanels[index - 1].SetActive(value: true);
			return;
		}
		switch (index)
		{
		case 4:
			palettePanels[3].SetActive(value: true);
			break;
		case 5:
			palettePanels[4].SetActive(value: true);
			break;
		case 6:
			palettePanels[5].SetActive(value: true);
			break;
		}
	}

	private void InstantiateAvatar()
	{
		GameObject gameObject = UnityEngine.Object.Instantiate(avatarPrefab, main.cameraTransform);
		myAvatar = gameObject.GetComponentInChildren<AvatarController>();
		gameObject.transform.localPosition = Vector3.zero;
		gameObject.layer = LayerMask.NameToLayer("MyAvatar");
		GetCurrentSetting();
		myAvatar.ClearPool();
		myAvatar.InitMyAavatar(curGender);
	}

	private void InstantiateSubElements()
	{
		for (int i = 0; i < dataManager.ItemDatabase.avatars.Length; i++)
		{
			for (int j = 0; j < genderPanels.Length; j++)
			{
				GameObject gameObject = UnityEngine.Object.Instantiate(elementPrefab, genderPanels[i].GetComponent<ScrollRect>().content);
				SubCategoryElement component = gameObject.GetComponent<SubCategoryElement>();
				component.customizingCategory = CustomizingCategory.GENDER;
				component.SetImage(genderImages[j]);
				component.id = j;
				component.customizingAvatarController = this;
				if (i == 0)
				{
					genderItemsM.Add(gameObject);
				}
				else
				{
					genderItemsFM.Add(gameObject);
				}
			}
			FaceItem[] faceItems = dataManager.ItemDatabase.avatars[i].faceItems;
			foreach (FaceItem faceItem in faceItems)
			{
				GameObject gameObject2 = UnityEngine.Object.Instantiate(elementPrefab, genderPanels[i].GetComponent<ScrollRect>().content);
				SubCategoryElement component2 = gameObject2.GetComponent<SubCategoryElement>();
				component2.customizingCategory = CustomizingCategory.FACE;
				component2.SetImage(faceItem.itemImage);
				component2.id = faceItem.ID;
				component2.customizingAvatarController = this;
				if (i == 0)
				{
					faceItemsM.Add(gameObject2);
				}
				else
				{
					faceItemsFM.Add(gameObject2);
				}
			}
			HairItem[] hairItems = dataManager.ItemDatabase.avatars[i].hairItems;
			foreach (HairItem hairItem in hairItems)
			{
				GameObject gameObject3 = UnityEngine.Object.Instantiate(elementPrefab, genderPanels[i].GetComponent<ScrollRect>().content);
				SubCategoryElement component3 = gameObject3.GetComponent<SubCategoryElement>();
				component3.customizingCategory = CustomizingCategory.HAIR;
				component3.SetImage(hairItem.itemImage);
				component3.id = hairItem.ID;
				component3.customizingAvatarController = this;
				if (i == 0)
				{
					hairItemsM.Add(gameObject3);
				}
				else
				{
					hairItemsFM.Add(gameObject3);
				}
			}
			MustacheItem[] mustacheItems = dataManager.ItemDatabase.avatars[i].mustacheItems;
			foreach (MustacheItem mustacheItem in mustacheItems)
			{
				GameObject gameObject4 = UnityEngine.Object.Instantiate(elementPrefab, genderPanels[i].GetComponent<ScrollRect>().content);
				SubCategoryElement component4 = gameObject4.GetComponent<SubCategoryElement>();
				component4.customizingCategory = CustomizingCategory.MUSTACHE;
				component4.SetImage(mustacheItem.itemImage);
				component4.id = mustacheItem.ID;
				component4.customizingAvatarController = this;
				if (i == 0)
				{
					mustacheItemsM.Add(gameObject4);
				}
				else
				{
					mustacheItemsFM.Add(gameObject4);
				}
			}
			EyebrowItem[] eyebrowItems = dataManager.ItemDatabase.avatars[i].eyebrowItems;
			foreach (EyebrowItem eyebrowItem in eyebrowItems)
			{
				GameObject gameObject5 = UnityEngine.Object.Instantiate(elementPrefab, genderPanels[i].GetComponent<ScrollRect>().content);
				SubCategoryElement component5 = gameObject5.GetComponent<SubCategoryElement>();
				component5.customizingCategory = CustomizingCategory.EYEBROW;
				component5.SetImage(eyebrowItem.itemImage);
				component5.id = eyebrowItem.ID;
				component5.customizingAvatarController = this;
				if (i == 0)
				{
					eyebrowItemsM.Add(gameObject5);
				}
				else
				{
					eyebrowItemsFM.Add(gameObject5);
				}
			}
			InnerfitItem[] innerfitItems = dataManager.ItemDatabase.avatars[i].innerfitItems;
			foreach (InnerfitItem innerfitItem in innerfitItems)
			{
				GameObject gameObject6 = UnityEngine.Object.Instantiate(elementPrefab, genderPanels[i].GetComponent<ScrollRect>().content);
				SubCategoryElement component6 = gameObject6.GetComponent<SubCategoryElement>();
				component6.customizingCategory = CustomizingCategory.INNERFIT;
				component6.SetImage(innerfitItem.itemImage);
				component6.id = innerfitItem.ID;
				component6.customizingAvatarController = this;
				if (i == 0)
				{
					innerfitItemsM.Add(gameObject6);
				}
				else
				{
					innerfitItemsFM.Add(gameObject6);
				}
			}
			OutfitItem[] outfitItems = dataManager.ItemDatabase.avatars[i].outfitItems;
			foreach (OutfitItem outfitItem in outfitItems)
			{
				GameObject gameObject7 = UnityEngine.Object.Instantiate(elementPrefab, genderPanels[i].GetComponent<ScrollRect>().content);
				SubCategoryElement component7 = gameObject7.GetComponent<SubCategoryElement>();
				component7.customizingCategory = CustomizingCategory.OUTERFIT;
				component7.SetImage(outfitItem.itemImage);
				component7.id = outfitItem.ID;
				component7.customizingAvatarController = this;
				if (i == 0)
				{
					outerfitItemsM.Add(gameObject7);
				}
				else
				{
					outerfitItemsFM.Add(gameObject7);
				}
			}
			HatItem[] hatItems = dataManager.ItemDatabase.avatars[i].hatItems;
			foreach (HatItem hatItem in hatItems)
			{
				GameObject gameObject8 = UnityEngine.Object.Instantiate(elementPrefab, genderPanels[i].GetComponent<ScrollRect>().content);
				SubCategoryElement component8 = gameObject8.GetComponent<SubCategoryElement>();
				component8.customizingCategory = CustomizingCategory.HAT;
				component8.SetImage(hatItem.itemImage);
				component8.id = hatItem.ID;
				component8.customizingAvatarController = this;
				if (i == 0)
				{
					hatItemsM.Add(gameObject8);
				}
				else
				{
					hatItemsFM.Add(gameObject8);
				}
			}
			GlassesItem[] glassesItems = dataManager.ItemDatabase.avatars[i].glassesItems;
			foreach (GlassesItem glassesItem in glassesItems)
			{
				GameObject gameObject9 = UnityEngine.Object.Instantiate(elementPrefab, genderPanels[i].GetComponent<ScrollRect>().content);
				SubCategoryElement component9 = gameObject9.GetComponent<SubCategoryElement>();
				component9.customizingCategory = CustomizingCategory.GLASSES;
				component9.SetImage(glassesItem.itemImage);
				component9.id = glassesItem.ID;
				component9.customizingAvatarController = this;
				if (i == 0)
				{
					glassesItemsM.Add(gameObject9);
				}
				else
				{
					glassesItemsFM.Add(gameObject9);
				}
			}
			foreach (int glove in dataManager.userData.gloves)
			{
				GameObject gameObject10 = UnityEngine.Object.Instantiate(elementPrefab, genderPanels[i].GetComponent<ScrollRect>().content);
				SubCategoryElement component10 = gameObject10.GetComponent<SubCategoryElement>();
				component10.customizingCategory = CustomizingCategory.GLOVES;
				component10.SetImage(dataManager.ItemDatabase.gloveItems[glove].equipImage);
				component10.id = glove;
				component10.customizingAvatarController = this;
				if (i == 0)
				{
					glovesItemsM.Add(gameObject10);
				}
				else
				{
					glovesItemsFM.Add(gameObject10);
				}
			}
		}
		itemsM.Add(genderItemsM);
		itemsM.Add(faceItemsM);
		itemsM.Add(hairItemsM);
		itemsM.Add(mustacheItemsM);
		itemsM.Add(eyebrowItemsM);
		itemsM.Add(innerfitItemsM);
		itemsM.Add(outerfitItemsM);
		itemsM.Add(hatItemsM);
		itemsM.Add(glassesItemsM);
		itemsM.Add(glovesItemsM);
		itemsFM.Add(genderItemsFM);
		itemsFM.Add(faceItemsFM);
		itemsFM.Add(hairItemsFM);
		itemsFM.Add(mustacheItemsFM);
		itemsFM.Add(eyebrowItemsFM);
		itemsFM.Add(innerfitItemsFM);
		itemsFM.Add(outerfitItemsFM);
		itemsFM.Add(hatItemsFM);
		itemsFM.Add(glassesItemsFM);
		itemsFM.Add(glovesItemsFM);
	}

	private void InstantiateColorPaletteButtons()
	{
		for (int i = 0; i < colorSetDatabase.faceColorSet.Count; i++)
		{
			GameObject obj = UnityEngine.Object.Instantiate(colorButtonPrefab, toggleGroups[0].transform);
			Toggle component = obj.GetComponent<Toggle>();
			component.targetGraphic.color = colorSetDatabase.faceColorSet[i];
			component.group = toggleGroups[0];
			if (i == dataManager.userData.avatars[curGender].curFaceColor)
			{
				component.isOn = true;
			}
			PaletteColor component2 = obj.GetComponent<PaletteColor>();
			component2.customizingAvatarController = this;
			component2.id = i;
			component2.color = colorSetDatabase.faceColorSet[i];
		}
		for (int j = 0; j < colorSetDatabase.hairColorSet.Count; j++)
		{
			GameObject obj2 = UnityEngine.Object.Instantiate(colorButtonPrefab, toggleGroups[1].transform);
			Toggle component3 = obj2.GetComponent<Toggle>();
			component3.targetGraphic.color = colorSetDatabase.hairColorSet[j];
			component3.group = toggleGroups[1];
			if (j == dataManager.userData.avatars[curGender].curHairColor)
			{
				component3.isOn = true;
			}
			PaletteColor component4 = obj2.GetComponent<PaletteColor>();
			component4.customizingAvatarController = this;
			component4.id = j;
			component4.color = colorSetDatabase.hairColorSet[j];
		}
		for (int k = 0; k < colorSetDatabase.mustacheColorSet.Count; k++)
		{
			GameObject obj3 = UnityEngine.Object.Instantiate(colorButtonPrefab, toggleGroups[2].transform);
			Toggle component5 = obj3.GetComponent<Toggle>();
			component5.targetGraphic.color = colorSetDatabase.mustacheColorSet[k];
			component5.group = toggleGroups[2];
			if (k == dataManager.userData.avatars[curGender].curMustacheColor)
			{
				component5.isOn = true;
			}
			PaletteColor component6 = obj3.GetComponent<PaletteColor>();
			component6.customizingAvatarController = this;
			component6.id = k;
			component6.color = colorSetDatabase.mustacheColorSet[k];
		}
		for (int l = 0; l < colorSetDatabase.eyebrowColorSet.Count; l++)
		{
			GameObject obj4 = UnityEngine.Object.Instantiate(colorButtonPrefab, toggleGroups[3].transform);
			Toggle component7 = obj4.GetComponent<Toggle>();
			component7.targetGraphic.color = colorSetDatabase.eyebrowColorSet[l];
			component7.group = toggleGroups[3];
			if (l == dataManager.userData.avatars[curGender].curEyebrowColor)
			{
				component7.isOn = true;
			}
			PaletteColor component8 = obj4.GetComponent<PaletteColor>();
			component8.customizingAvatarController = this;
			component8.id = l;
			component8.color = colorSetDatabase.eyebrowColorSet[l];
		}
		for (int m = 0; m < colorSetDatabase.eyeColorSet.Count; m++)
		{
			GameObject obj5 = UnityEngine.Object.Instantiate(colorButtonPrefab, toggleGroups[4].transform);
			Toggle component9 = obj5.GetComponent<Toggle>();
			component9.targetGraphic.color = colorSetDatabase.eyeColorSet[m];
			component9.group = toggleGroups[4];
			if (m == dataManager.userData.avatars[curGender].curEyeColor)
			{
				component9.isOn = true;
			}
			PaletteColor component10 = obj5.GetComponent<PaletteColor>();
			component10.customizingAvatarController = this;
			component10.id = m;
			component10.color = colorSetDatabase.eyeColorSet[m];
			component10.isEyeColor = true;
		}
		for (int n = 0; n < colorSetDatabase.innerFitColorSet.Count; n++)
		{
			GameObject obj6 = UnityEngine.Object.Instantiate(colorButtonPrefab, toggleGroups[5].transform);
			Toggle component11 = obj6.GetComponent<Toggle>();
			component11.targetGraphic.color = colorSetDatabase.innerFitColorSet[n];
			component11.group = toggleGroups[5];
			if (n == dataManager.userData.avatars[curGender].curInnerfitColor)
			{
				component11.isOn = true;
			}
			PaletteColor component12 = obj6.GetComponent<PaletteColor>();
			component12.customizingAvatarController = this;
			component12.id = n;
			component12.color = colorSetDatabase.innerFitColorSet[n];
		}
		for (int num = 0; num < colorSetDatabase.outerFitColorSet.Count; num++)
		{
			GameObject obj7 = UnityEngine.Object.Instantiate(colorButtonPrefab, toggleGroups[6].transform);
			Toggle component13 = obj7.GetComponent<Toggle>();
			component13.targetGraphic.color = colorSetDatabase.outerFitColorSet[num];
			component13.group = toggleGroups[6];
			if (num == dataManager.userData.avatars[curGender].curOuterfitColor)
			{
				component13.isOn = true;
			}
			PaletteColor component14 = obj7.GetComponent<PaletteColor>();
			component14.customizingAvatarController = this;
			component14.id = num;
			component14.color = colorSetDatabase.outerFitColorSet[num];
		}
	}

	public void SelectAgeEvent(int ageIndex)
	{
		curAge = ageIndex;
		myAvatar.ChangeAge(ageIndex);
	}

	public void CheckGenderPanel(int genderIndex)
	{
		for (int i = 0; i < genderPanels.Length; i++)
		{
			if (i == genderIndex)
			{
				genderPanels[i].SetActive(value: true);
			}
			else
			{
				genderPanels[i].SetActive(value: false);
			}
		}
	}

	private void InitColorPalette()
	{
		for (int i = 0; i < palettePanels.Length; i++)
		{
			palettePanels[i].SetActive(value: false);
		}
	}

	private void GetCurrentSetting()
	{
		curGender = dataManager.userData.curGender;
		curFace = dataManager.userData.avatars[curGender].curFaceShape;
		curFaceColor = dataManager.userData.avatars[curGender].curFaceColor;
		curAge = dataManager.userData.avatars[curGender].curAge;
		curEyeColor = dataManager.userData.avatars[curGender].curEyeColor;
		curHair = dataManager.userData.avatars[curGender].curHairShape;
		curHairColor = dataManager.userData.avatars[curGender].curHairColor;
		curMustache = dataManager.userData.avatars[curGender].curMustacheShape;
		curMustacheColor = dataManager.userData.avatars[curGender].curMustacheColor;
		curEyebrow = dataManager.userData.avatars[curGender].curEyebrowShape;
		curEyebrowColor = dataManager.userData.avatars[curGender].curEyebrowColor;
		curInnerfit = dataManager.userData.avatars[curGender].curInnerfit;
		curInnerfitColor = dataManager.userData.avatars[curGender].curInnerfitColor;
		curOuterfit = dataManager.userData.avatars[curGender].curOuterfit;
		curOuterfitColor = dataManager.userData.avatars[curGender].curOuterfitColor;
		curHat = dataManager.userData.avatars[curGender].curHat;
		curGlasses = dataManager.userData.avatars[curGender].curGlasses;
		curGlove = dataManager.userData.curGlove;
	}

	public void UpdateDataToSave(int gender)
	{
		curFace = dataManager.userData.avatars[gender].curFaceShape;
		curFaceColor = dataManager.userData.avatars[gender].curFaceColor;
		curAge = dataManager.userData.avatars[gender].curAge;
		curEyeColor = dataManager.userData.avatars[gender].curEyeColor;
		curHair = dataManager.userData.avatars[gender].curHairShape;
		curHairColor = dataManager.userData.avatars[gender].curHairColor;
		curMustache = dataManager.userData.avatars[gender].curMustacheShape;
		curMustacheColor = dataManager.userData.avatars[gender].curMustacheColor;
		curEyebrow = dataManager.userData.avatars[gender].curEyebrowShape;
		curEyebrowColor = dataManager.userData.avatars[gender].curEyebrowColor;
		curInnerfit = dataManager.userData.avatars[gender].curInnerfit;
		curInnerfitColor = dataManager.userData.avatars[gender].curInnerfitColor;
		curOuterfit = dataManager.userData.avatars[gender].curOuterfit;
		curOuterfitColor = dataManager.userData.avatars[gender].curOuterfitColor;
		curHat = dataManager.userData.avatars[gender].curHat;
		curGlasses = dataManager.userData.avatars[gender].curGlasses;
	}

	public void ScrollRightEvent()
	{
		MonoBehaviour.print("ScrollRightEvent");
		isScrolling = true;
		Scrollbar horizontalScrollbar = genderPanels[curGender].GetComponent<ScrollRect>().horizontalScrollbar;
		StartCoroutine(Scroll(horizontalScrollbar, scrollSpeed));
	}

	public void ScrollLeftEvent()
	{
		isScrolling = true;
		Scrollbar horizontalScrollbar = genderPanels[curGender].GetComponent<ScrollRect>().horizontalScrollbar;
		StartCoroutine(Scroll(horizontalScrollbar, 0f - scrollSpeed));
	}

	private IEnumerator Scroll(Scrollbar scrollbar, float scrollValue)
	{
		while (isScrolling)
		{
			scrollbar.value += scrollValue;
			yield return null;
		}
	}

	public void StopScrollEvent()
	{
		isScrolling = false;
	}

	public void OpenSaveCaution()
	{
		saveCaution.SetActive(value: true);
	}

	public void CloseSaveCaution()
	{
		saveCaution.SetActive(value: false);
	}

	public void OpenUndoCaution()
	{
		undoCaution.SetActive(value: true);
	}

	public void CloseUndoCaution()
	{
		undoCaution.SetActive(value: false);
	}

	public void SaveData()
	{
		dataManager.userData.curGender = curGender;
		dataManager.userData.avatars[curGender].curFaceShape = curFace;
		dataManager.userData.avatars[curGender].curFaceColor = curFaceColor;
		dataManager.userData.avatars[curGender].curAge = curAge;
		dataManager.userData.avatars[curGender].curEyeColor = curEyeColor;
		dataManager.userData.avatars[curGender].curHairShape = curHair;
		dataManager.userData.avatars[curGender].curHairColor = curHairColor;
		dataManager.userData.avatars[curGender].curMustacheShape = curMustache;
		dataManager.userData.avatars[curGender].curMustacheColor = curMustacheColor;
		dataManager.userData.avatars[curGender].curEyebrowShape = curEyebrow;
		dataManager.userData.avatars[curGender].curEyebrowColor = curEyebrowColor;
		dataManager.userData.avatars[curGender].curInnerfit = curInnerfit;
		dataManager.userData.avatars[curGender].curInnerfitColor = curInnerfitColor;
		dataManager.userData.avatars[curGender].curOuterfit = curOuterfit;
		dataManager.userData.avatars[curGender].curOuterfitColor = curOuterfitColor;
		dataManager.userData.avatars[curGender].curHat = curHat;
		dataManager.userData.avatars[curGender].curGlasses = curGlasses;
		dataManager.userData.curGlove = curGlove;
		dataManager.Save();
		CloseSaveCaution();
	}

	public void UndoCustomizing()
	{
		myAvatar.ChangeGender(curGender);
		CloseUndoCaution();
	}
}
public class DummyAvatar : MonoBehaviour
{
	public ColorSetDatabase colorSet;

	public Dictionary<int, GameObject> facePool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> hairPool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> mustachePool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> eyebrowPool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> innerfitPool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> outerfitPool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> hatPool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> glassesPool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> watchPool = new Dictionary<int, GameObject>();

	public GameObject faceRoot;

	public GameObject clothRoot;

	public GameObject hairRoot;

	public GameObject eyebrowRoot;

	public GameObject mustacheRoot;

	public GameObject lookAtEyeL;

	public GameObject lookAtEyeR;

	public GameObject hatRoot;

	public GameObject glassesRoot;

	public GameObject watchRoot;

	public int curGender = -1;

	public int curFace = -1;

	public int curFaceColor = -1;

	public int curAge = -1;

	public int curEyeColor = -1;

	public int curHairShape = -1;

	public int curHairColor = -1;

	public int curEyebrowShape = -1;

	public int curEyebrowColor = -1;

	public int curMustacheShape = -1;

	public int curMustacheColor = -1;

	public int curInnerfit = -1;

	public int curInnerfitColor = -1;

	public int curOuterfit = -1;

	public int curOuterfitColor = -1;

	public int curHat = -1;

	public int curGlasses = -1;

	public int curWatch = -1;

	private DataManager dataManager;

	private ItemDatabase itemDatabase;

	[HideInInspector]
	public CustomizingAvatarController customizingAvatarController;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		itemDatabase = dataManager.ItemDatabase;
	}

	private void Start()
	{
		customizingAvatarController = UnityEngine.Object.FindObjectOfType<CustomizingAvatarController>();
	}

	private void ClearPool()
	{
		foreach (KeyValuePair<int, GameObject> item in facePool)
		{
			UnityEngine.Object.Destroy(item.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item2 in hairPool)
		{
			UnityEngine.Object.Destroy(item2.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item3 in eyebrowPool)
		{
			UnityEngine.Object.Destroy(item3.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item4 in mustachePool)
		{
			UnityEngine.Object.Destroy(item4.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item5 in hatPool)
		{
			UnityEngine.Object.Destroy(item5.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item6 in glassesPool)
		{
			UnityEngine.Object.Destroy(item6.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item7 in watchPool)
		{
			UnityEngine.Object.Destroy(item7.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item8 in innerfitPool)
		{
			UnityEngine.Object.Destroy(item8.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item9 in outerfitPool)
		{
			UnityEngine.Object.Destroy(item9.Value.gameObject);
		}
		facePool.Clear();
		hairPool.Clear();
		eyebrowPool.Clear();
		mustachePool.Clear();
		innerfitPool.Clear();
		outerfitPool.Clear();
		hatPool.Clear();
		glassesPool.Clear();
		watchPool.Clear();
	}

	public void InitAvatar(int index)
	{
		if (customizingAvatarController == null)
		{
			customizingAvatarController = UnityEngine.Object.FindObjectOfType<CustomizingAvatarController>();
		}
		ClearPool();
		curGender = index;
		AvatarData avatarData = dataManager.userData.avatars[curGender];
		curFace = avatarData.curFaceShape;
		curFaceColor = avatarData.curFaceColor;
		curAge = avatarData.curAge;
		curEyeColor = avatarData.curEyeColor;
		curHairShape = avatarData.curHairShape;
		curHairColor = avatarData.curHairColor;
		curEyebrowShape = avatarData.curEyebrowShape;
		curEyebrowColor = avatarData.curEyebrowColor;
		curMustacheShape = avatarData.curMustacheShape;
		curMustacheColor = avatarData.curMustacheColor;
		curInnerfit = avatarData.curInnerfit;
		curInnerfitColor = avatarData.curInnerfitColor;
		curOuterfit = avatarData.curOuterfit;
		curOuterfitColor = avatarData.curOuterfitColor;
		curHat = avatarData.curHat;
		curGlasses = avatarData.curGlasses;
		FaceItem[] faceItems = itemDatabase.avatars[curGender].faceItems;
		foreach (FaceItem faceItem in faceItems)
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(faceItem.prefab, base.transform);
			facePool.Add(faceItem.ID, gameObject);
			if (avatarData.curFaceShape == faceItem.ID)
			{
				gameObject.SetActive(value: true);
				faceRoot = gameObject;
				faceRoot.GetComponent<AvatarRigCTRL>().eyeRootsLeftRight[0] = lookAtEyeL.transform;
				faceRoot.GetComponent<AvatarRigCTRL>().eyeRootsLeftRight[1] = lookAtEyeR.transform;
				GameObject eyePrefab = itemDatabase.avatars[curGender].faceItems[curFace].eyePrefab;
				SkinnedMeshRenderer skinnedMeshRenderer = faceRoot.GetComponent<FaceController>().skinnedMeshRenderer;
				if (skinnedMeshRenderer != null && curFaceColor != -1)
				{
					skinnedMeshRenderer.material.color = colorSet.faceColorSet[curFaceColor];
				}
				if (skinnedMeshRenderer != null)
				{
					skinnedMeshRenderer.material.SetTexture("_MainTex", dataManager.ItemDatabase.avatars[curGender].faceItems[curFace].ageTexture.diffuseMap[curAge]);
					skinnedMeshRenderer.material.SetTexture("_Bumpmap", dataManager.ItemDatabase.avatars[curGender].faceItems[curFace].ageTexture.normalMap[curAge]);
				}
				if (lookAtEyeL.GetComponentInChildren<AvatarEye>() == null)
				{
					GameObject obj = UnityEngine.Object.Instantiate(eyePrefab, lookAtEyeL.transform);
					lookAtEyeL.transform.SetParent(faceRoot.transform);
					obj.transform.localPosition = Vector3.zero;
					UnityEngine.Object.Instantiate(eyePrefab, lookAtEyeR.transform).transform.localPosition = Vector3.zero;
					lookAtEyeR.transform.SetParent(faceRoot.transform);
					Renderer component = lookAtEyeL.GetComponentInChildren<AvatarEye>().innerEye.GetComponent<Renderer>();
					if (component != null)
					{
						component.material.color = colorSet.eyeColorSet[curEyeColor];
					}
					Renderer component2 = lookAtEyeR.GetComponentInChildren<AvatarEye>().innerEye.GetComponent<Renderer>();
					if (component2 != null)
					{
						component2.material.color = colorSet.eyeColorSet[curEyeColor];
					}
				}
			}
			else
			{
				gameObject.SetActive(value: false);
			}
		}
		HairItem[] hairItems = itemDatabase.avatars[curGender].hairItems;
		foreach (HairItem hairItem in hairItems)
		{
			GameObject gameObject2 = UnityEngine.Object.Instantiate(hairItem.prefab, hairRoot.transform);
			hairPool.Add(hairItem.ID, gameObject2);
			if (avatarData.curHairShape == hairItem.ID)
			{
				gameObject2.SetActive(value: true);
				Renderer component3 = gameObject2.GetComponent<Renderer>();
				if (component3 != null && avatarData.curHairColor != -1)
				{
					component3.material.color = colorSet.hairColorSet[curHairColor];
				}
			}
			else
			{
				gameObject2.SetActive(value: false);
			}
		}
		EyebrowItem[] eyebrowItems = itemDatabase.avatars[curGender].eyebrowItems;
		foreach (EyebrowItem eyebrowItem in eyebrowItems)
		{
			GameObject gameObject3 = UnityEngine.Object.Instantiate(eyebrowItem.prefab, eyebrowRoot.transform);
			eyebrowPool.Add(eyebrowItem.ID, gameObject3);
			if (avatarData.curEyebrowShape == eyebrowItem.ID)
			{
				gameObject3.SetActive(value: true);
				Renderer component4 = gameObject3.GetComponent<Renderer>();
				if (component4 != null && curEyebrowColor != -1)
				{
					component4.material.color = colorSet.eyebrowColorSet[curEyebrowColor];
				}
			}
			else
			{
				gameObject3.SetActive(value: false);
			}
		}
		MustacheItem[] mustacheItems = itemDatabase.avatars[curGender].mustacheItems;
		foreach (MustacheItem mustacheItem in mustacheItems)
		{
			GameObject gameObject4 = UnityEngine.Object.Instantiate(mustacheItem.prefab, mustacheRoot.transform);
			mustachePool.Add(mustacheItem.ID, gameObject4);
			if (avatarData.curMustacheShape == mustacheItem.ID)
			{
				gameObject4.SetActive(value: true);
				Renderer component5 = gameObject4.GetComponent<Renderer>();
				if (component5 != null)
				{
					component5.material.color = colorSet.mustacheColorSet[curMustacheColor];
				}
			}
			else
			{
				gameObject4.SetActive(value: false);
			}
		}
		InnerfitItem[] innerfitItems = itemDatabase.avatars[curGender].innerfitItems;
		foreach (InnerfitItem innerfitItem in innerfitItems)
		{
			GameObject gameObject5 = UnityEngine.Object.Instantiate(innerfitItem.prefab, clothRoot.transform);
			innerfitPool.Add(innerfitItem.ID, gameObject5);
			if (avatarData.curInnerfit == innerfitItem.ID)
			{
				gameObject5.SetActive(value: true);
				Renderer component6 = gameObject5.GetComponent<Renderer>();
				if (component6 != null)
				{
					component6.material.color = colorSet.innerFitColorSet[curInnerfitColor];
				}
			}
			else
			{
				gameObject5.SetActive(value: false);
			}
		}
		OutfitItem[] outfitItems = itemDatabase.avatars[curGender].outfitItems;
		foreach (OutfitItem outfitItem in outfitItems)
		{
			GameObject gameObject6 = UnityEngine.Object.Instantiate(outfitItem.prefab, clothRoot.transform);
			outerfitPool.Add(outfitItem.ID, gameObject6);
			if (avatarData.curOuterfit == outfitItem.ID)
			{
				gameObject6.SetActive(value: true);
				Renderer component7 = gameObject6.GetComponent<Renderer>();
				if (component7 != null)
				{
					component7.material.color = colorSet.outerFitColorSet[curOuterfitColor];
				}
			}
			else
			{
				gameObject6.SetActive(value: false);
			}
		}
		HatItem[] hatItems = itemDatabase.avatars[curGender].hatItems;
		foreach (HatItem hatItem in hatItems)
		{
			GameObject gameObject7 = UnityEngine.Object.Instantiate(hatItem.prefab, hatRoot.transform);
			hatPool.Add(hatItem.ID, gameObject7);
			if (avatarData.curHat == hatItem.ID)
			{
				gameObject7.SetActive(value: true);
				AvatarHat component8 = gameObject7.GetComponent<AvatarHat>();
				if (component8 != null)
				{
					if (curHairShape == 0)
					{
						component8.ShowHairPrefab(show: false);
						continue;
					}
					hairPool[curHairShape].SetActive(value: false);
					component8.ShowHairPrefab(show: true);
					component8.hairPrefab.GetComponent<Renderer>().material.color = colorSet.hairColorSet[curHairColor];
				}
			}
			else
			{
				gameObject7.SetActive(value: false);
			}
		}
		GlassesItem[] glassesItems = itemDatabase.avatars[curGender].glassesItems;
		foreach (GlassesItem glassesItem in glassesItems)
		{
			GameObject gameObject8 = UnityEngine.Object.Instantiate(glassesItem.prefab, glassesRoot.transform);
			glassesPool.Add(glassesItem.ID, gameObject8);
			if (avatarData.curGlasses == glassesItem.ID)
			{
				gameObject8.SetActive(value: true);
			}
			else
			{
				gameObject8.SetActive(value: false);
			}
		}
		hairRoot.transform.SetParent(faceRoot.transform);
		clothRoot.transform.SetParent(faceRoot.GetComponent<FaceController>().neckBase.transform);
		clothRoot.transform.localPosition = new Vector3(0f, 0.07075249f, 0.07075249f);
		clothRoot.transform.localEulerAngles = Vector3.zero;
		eyebrowRoot.transform.SetParent(faceRoot.transform);
		mustacheRoot.transform.SetParent(faceRoot.transform);
		lookAtEyeL.transform.SetParent(faceRoot.transform);
		lookAtEyeR.transform.SetParent(faceRoot.transform);
		hatRoot.transform.SetParent(faceRoot.transform);
		glassesRoot.transform.SetParent(faceRoot.transform);
		watchRoot.transform.SetParent(faceRoot.transform);
		base.gameObject.layer = LayerMask.NameToLayer("DummyAvatar");
		Transform[] componentsInChildren = GetComponentsInChildren<Transform>(includeInactive: true);
		for (int i = 0; i < componentsInChildren.Length; i++)
		{
			componentsInChildren[i].gameObject.layer = LayerMask.NameToLayer("DummyAvatar");
		}
		base.transform.localScale = new Vector3(1f, 1f, -1f);
		GetComponentInChildren<AvatarRigCTRL>().isInvertRotation = false;
	}

	public void InitAvatar()
	{
		ClearPool();
		curGender = dataManager.userData.curGender;
		AvatarData avatarData = dataManager.userData.avatars[curGender];
		curFace = avatarData.curFaceShape;
		curFaceColor = avatarData.curFaceColor;
		curAge = avatarData.curAge;
		curEyeColor = avatarData.curEyeColor;
		curHairShape = avatarData.curHairShape;
		curHairColor = avatarData.curHairColor;
		curEyebrowShape = avatarData.curEyebrowShape;
		curEyebrowColor = avatarData.curEyebrowColor;
		curMustacheShape = avatarData.curMustacheShape;
		curMustacheColor = avatarData.curMustacheColor;
		curInnerfit = avatarData.curInnerfit;
		curInnerfitColor = avatarData.curInnerfitColor;
		curOuterfit = avatarData.curOuterfit;
		curOuterfitColor = avatarData.curOuterfitColor;
		curHat = avatarData.curHat;
		curGlasses = avatarData.curGlasses;
		FaceItem[] faceItems = itemDatabase.avatars[curGender].faceItems;
		foreach (FaceItem faceItem in faceItems)
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(faceItem.prefab, base.transform);
			facePool.Add(faceItem.ID, gameObject);
			if (avatarData.curFaceShape == faceItem.ID)
			{
				gameObject.SetActive(value: true);
				faceRoot = gameObject;
				faceRoot.GetComponent<AvatarRigCTRL>().eyeRootsLeftRight[0] = lookAtEyeL.transform;
				faceRoot.GetComponent<AvatarRigCTRL>().eyeRootsLeftRight[1] = lookAtEyeR.transform;
				GameObject eyePrefab = itemDatabase.avatars[curGender].faceItems[curFace].eyePrefab;
				SkinnedMeshRenderer skinnedMeshRenderer = faceRoot.GetComponent<FaceController>().skinnedMeshRenderer;
				if (skinnedMeshRenderer != null && curFaceColor != -1)
				{
					skinnedMeshRenderer.material.color = colorSet.faceColorSet[curFaceColor];
				}
				if (skinnedMeshRenderer != null)
				{
					skinnedMeshRenderer.material.SetTexture("_MainTex", dataManager.ItemDatabase.avatars[curGender].faceItems[curFace].ageTexture.diffuseMap[curAge]);
					skinnedMeshRenderer.material.SetTexture("_Bumpmap", dataManager.ItemDatabase.avatars[curGender].faceItems[curFace].ageTexture.normalMap[curAge]);
				}
				if (lookAtEyeL.GetComponentInChildren<AvatarEye>() == null)
				{
					GameObject obj = UnityEngine.Object.Instantiate(eyePrefab, lookAtEyeL.transform);
					lookAtEyeL.transform.SetParent(faceRoot.transform);
					obj.transform.localPosition = Vector3.zero;
					UnityEngine.Object.Instantiate(eyePrefab, lookAtEyeR.transform).transform.localPosition = Vector3.zero;
					lookAtEyeR.transform.SetParent(faceRoot.transform);
					Renderer component = lookAtEyeL.GetComponentInChildren<AvatarEye>().innerEye.GetComponent<Renderer>();
					if (component != null)
					{
						component.material.color = colorSet.eyeColorSet[curEyeColor];
					}
					Renderer component2 = lookAtEyeR.GetComponentInChildren<AvatarEye>().innerEye.GetComponent<Renderer>();
					if (component2 != null)
					{
						component2.material.color = colorSet.eyeColorSet[curEyeColor];
					}
				}
			}
			else
			{
				gameObject.SetActive(value: false);
			}
		}
		HairItem[] hairItems = itemDatabase.avatars[curGender].hairItems;
		foreach (HairItem hairItem in hairItems)
		{
			GameObject gameObject2 = UnityEngine.Object.Instantiate(hairItem.prefab, hairRoot.transform);
			hairPool.Add(hairItem.ID, gameObject2);
			if (avatarData.curHairShape == hairItem.ID)
			{
				gameObject2.SetActive(value: true);
				Renderer component3 = gameObject2.GetComponent<Renderer>();
				if (component3 != null && avatarData.curHairColor != -1)
				{
					component3.material.color = colorSet.hairColorSet[curHairColor];
				}
			}
			else
			{
				gameObject2.SetActive(value: false);
			}
		}
		EyebrowItem[] eyebrowItems = itemDatabase.avatars[curGender].eyebrowItems;
		foreach (EyebrowItem eyebrowItem in eyebrowItems)
		{
			GameObject gameObject3 = UnityEngine.Object.Instantiate(eyebrowItem.prefab, eyebrowRoot.transform);
			eyebrowPool.Add(eyebrowItem.ID, gameObject3);
			if (avatarData.curEyebrowShape == eyebrowItem.ID)
			{
				gameObject3.SetActive(value: true);
				Renderer component4 = gameObject3.GetComponent<Renderer>();
				if (component4 != null && curEyebrowColor != -1)
				{
					component4.material.color = colorSet.eyebrowColorSet[curEyebrowColor];
				}
			}
			else
			{
				gameObject3.SetActive(value: false);
			}
		}
		MustacheItem[] mustacheItems = itemDatabase.avatars[curGender].mustacheItems;
		foreach (MustacheItem mustacheItem in mustacheItems)
		{
			GameObject gameObject4 = UnityEngine.Object.Instantiate(mustacheItem.prefab, mustacheRoot.transform);
			mustachePool.Add(mustacheItem.ID, gameObject4);
			if (avatarData.curMustacheShape == mustacheItem.ID)
			{
				gameObject4.SetActive(value: true);
				Renderer component5 = gameObject4.GetComponent<Renderer>();
				if (component5 != null)
				{
					component5.material.color = colorSet.mustacheColorSet[curMustacheColor];
				}
			}
			else
			{
				gameObject4.SetActive(value: false);
			}
		}
		InnerfitItem[] innerfitItems = itemDatabase.avatars[curGender].innerfitItems;
		foreach (InnerfitItem innerfitItem in innerfitItems)
		{
			GameObject gameObject5 = UnityEngine.Object.Instantiate(innerfitItem.prefab, clothRoot.transform);
			innerfitPool.Add(innerfitItem.ID, gameObject5);
			if (avatarData.curInnerfit == innerfitItem.ID)
			{
				gameObject5.SetActive(value: true);
				Renderer component6 = gameObject5.GetComponent<Renderer>();
				if (component6 != null)
				{
					component6.material.color = colorSet.innerFitColorSet[curInnerfitColor];
				}
			}
			else
			{
				gameObject5.SetActive(value: false);
			}
		}
		OutfitItem[] outfitItems = itemDatabase.avatars[curGender].outfitItems;
		foreach (OutfitItem outfitItem in outfitItems)
		{
			GameObject gameObject6 = UnityEngine.Object.Instantiate(outfitItem.prefab, clothRoot.transform);
			outerfitPool.Add(outfitItem.ID, gameObject6);
			if (avatarData.curOuterfit == outfitItem.ID)
			{
				gameObject6.SetActive(value: true);
				Renderer component7 = gameObject6.GetComponent<Renderer>();
				if (component7 != null)
				{
					component7.material.color = colorSet.outerFitColorSet[curOuterfitColor];
				}
			}
			else
			{
				gameObject6.SetActive(value: false);
			}
		}
		HatItem[] hatItems = itemDatabase.avatars[curGender].hatItems;
		foreach (HatItem hatItem in hatItems)
		{
			GameObject gameObject7 = UnityEngine.Object.Instantiate(hatItem.prefab, hatRoot.transform);
			hatPool.Add(hatItem.ID, gameObject7);
			if (avatarData.curHat == hatItem.ID)
			{
				gameObject7.SetActive(value: true);
				AvatarHat component8 = gameObject7.GetComponent<AvatarHat>();
				if (component8 != null)
				{
					if (curHairShape == 0)
					{
						component8.ShowHairPrefab(show: false);
						continue;
					}
					hairPool[curHairShape].SetActive(value: false);
					component8.ShowHairPrefab(show: true);
					component8.hairPrefab.GetComponent<Renderer>().material.color = colorSet.hairColorSet[curHairColor];
				}
			}
			else
			{
				gameObject7.SetActive(value: false);
			}
		}
		GlassesItem[] glassesItems = itemDatabase.avatars[curGender].glassesItems;
		foreach (GlassesItem glassesItem in glassesItems)
		{
			GameObject gameObject8 = UnityEngine.Object.Instantiate(glassesItem.prefab, glassesRoot.transform);
			glassesPool.Add(glassesItem.ID, gameObject8);
			if (avatarData.curGlasses == glassesItem.ID)
			{
				gameObject8.SetActive(value: true);
			}
			else
			{
				gameObject8.SetActive(value: false);
			}
		}
		hairRoot.transform.SetParent(faceRoot.transform);
		clothRoot.transform.SetParent(faceRoot.GetComponent<FaceController>().neckBase.transform);
		clothRoot.transform.localPosition = new Vector3(0f, 0.07075249f, 0.07075249f);
		clothRoot.transform.localEulerAngles = Vector3.zero;
		eyebrowRoot.transform.SetParent(faceRoot.transform);
		mustacheRoot.transform.SetParent(faceRoot.transform);
		lookAtEyeL.transform.SetParent(faceRoot.transform);
		lookAtEyeR.transform.SetParent(faceRoot.transform);
		hatRoot.transform.SetParent(faceRoot.transform);
		glassesRoot.transform.SetParent(faceRoot.transform);
		watchRoot.transform.SetParent(faceRoot.transform);
		base.gameObject.layer = LayerMask.NameToLayer("DummyAvatar");
		Transform[] componentsInChildren = GetComponentsInChildren<Transform>(includeInactive: true);
		for (int i = 0; i < componentsInChildren.Length; i++)
		{
			componentsInChildren[i].gameObject.layer = LayerMask.NameToLayer("DummyAvatar");
		}
		base.transform.localScale = new Vector3(1f, 1f, -1f);
		GetComponentInChildren<AvatarRigCTRL>().isInvertRotation = false;
	}

	public void ChangeGender(int index)
	{
		InitAvatar(index);
	}

	public void ChangeFace(int index)
	{
		curFace = index;
		hairRoot.transform.SetParent(base.transform);
		mustacheRoot.transform.SetParent(base.transform);
		eyebrowRoot.transform.SetParent(base.transform);
		clothRoot.transform.SetParent(base.transform);
		hatRoot.transform.SetParent(base.transform);
		glassesRoot.transform.SetParent(base.transform);
		watchRoot.transform.SetParent(base.transform);
		lookAtEyeL.transform.SetParent(base.transform);
		lookAtEyeR.transform.SetParent(base.transform);
		foreach (KeyValuePair<int, GameObject> item in facePool)
		{
			item.Value.SetActive(value: false);
		}
		GameObject gameObject = null;
		facePool[index].SetActive(value: true);
		gameObject = facePool[index];
		ChangeFaceColor(curFaceColor, colorSet.faceColorSet[curFaceColor]);
		hairRoot.transform.SetParent(gameObject.transform);
		mustacheRoot.transform.SetParent(gameObject.transform);
		eyebrowRoot.transform.SetParent(gameObject.transform);
		clothRoot.transform.SetParent(facePool[index].GetComponent<FaceController>().neckBase.transform);
		clothRoot.transform.localPosition = new Vector3(0f, 0.07075249f, 0.07075249f);
		clothRoot.transform.localEulerAngles = Vector3.zero;
		hatRoot.transform.SetParent(gameObject.transform);
		glassesRoot.transform.SetParent(gameObject.transform);
		watchRoot.transform.SetParent(gameObject.transform);
		lookAtEyeL.transform.SetParent(gameObject.transform);
		lookAtEyeR.transform.SetParent(gameObject.transform);
		base.gameObject.layer = LayerMask.NameToLayer("DummyAvatar");
		Transform[] componentsInChildren = GetComponentsInChildren<Transform>(includeInactive: true);
		for (int i = 0; i < componentsInChildren.Length; i++)
		{
			componentsInChildren[i].gameObject.layer = LayerMask.NameToLayer("DummyAvatar");
		}
	}

	public void ChangeFaceColor(int index, Color color)
	{
		curFaceColor = index;
		Renderer skinnedMeshRenderer = facePool[curFace].GetComponent<FaceController>().skinnedMeshRenderer;
		if (skinnedMeshRenderer != null)
		{
			skinnedMeshRenderer.material.color = color;
		}
		customizingAvatarController.curFaceColor = curFaceColor;
	}

	public void ChangeHair(int index)
	{
		curHairShape = index;
		foreach (KeyValuePair<int, GameObject> item in hairPool)
		{
			item.Value.SetActive(value: false);
		}
		hairPool[index].SetActive(value: true);
		ChangeHairColor(curHairColor, colorSet.hairColorSet[curHairColor]);
		if (curHat != 0)
		{
			ChangeHat(0);
		}
	}

	public void ChangeHairColor(int index, Color color)
	{
		curHairColor = index;
		Renderer component = hairPool[curHairShape].GetComponent<Renderer>();
		if (component != null)
		{
			component.material.color = color;
		}
		customizingAvatarController.curHairColor = curHairColor;
	}

	public void ChangeEyeColor(int index, Color color)
	{
		curEyeColor = index;
		Renderer component = lookAtEyeL.GetComponentInChildren<AvatarEye>().innerEye.GetComponent<Renderer>();
		if (component != null)
		{
			component.material.color = color;
		}
		Renderer component2 = lookAtEyeR.GetComponentInChildren<AvatarEye>().innerEye.GetComponent<Renderer>();
		if (component2 != null)
		{
			component2.material.color = color;
		}
		customizingAvatarController.curEyeColor = curEyeColor;
	}

	public void ChangeMustache(int index)
	{
		curMustacheShape = index;
		foreach (KeyValuePair<int, GameObject> item in mustachePool)
		{
			item.Value.SetActive(value: false);
		}
		mustachePool[index].SetActive(value: true);
		ChangeMustacheColor(curMustacheColor, colorSet.mustacheColorSet[curMustacheColor]);
	}

	public void ChangeMustacheColor(int index, Color color)
	{
		curMustacheColor = index;
		Renderer component = mustachePool[curMustacheShape].GetComponent<Renderer>();
		if (component != null)
		{
			component.material.color = color;
		}
		customizingAvatarController.curMustacheColor = curMustacheColor;
	}

	public void ChangeAge(int index)
	{
		curAge = index;
		Renderer skinnedMeshRenderer = facePool[curFace].GetComponent<FaceController>().skinnedMeshRenderer;
		if (skinnedMeshRenderer != null)
		{
			skinnedMeshRenderer.material.SetTexture("_MainTex", dataManager.ItemDatabase.avatars[curGender].faceItems[curFace].ageTexture.diffuseMap[curAge]);
			skinnedMeshRenderer.material.SetTexture("_Bumpmap", dataManager.ItemDatabase.avatars[curGender].faceItems[curFace].ageTexture.normalMap[curAge]);
		}
	}

	public void ChangeEyebrow(int index)
	{
		curEyebrowShape = index;
		foreach (KeyValuePair<int, GameObject> item in eyebrowPool)
		{
			item.Value.SetActive(value: false);
		}
		eyebrowPool[index].SetActive(value: true);
		ChangeEyebrowColor(curEyebrowColor, colorSet.eyebrowColorSet[curEyebrowColor]);
	}

	public void ChangeEyebrowColor(int index, Color color)
	{
		curEyebrowColor = index;
		Renderer component = eyebrowPool[curEyebrowShape].GetComponent<Renderer>();
		if (component != null)
		{
			component.material.color = color;
		}
		customizingAvatarController.curEyebrowColor = curEyebrowColor;
	}

	public void ChangeInnerFit(int index)
	{
		curInnerfit = index;
		foreach (KeyValuePair<int, GameObject> item in innerfitPool)
		{
			item.Value.SetActive(value: false);
		}
		innerfitPool[index].SetActive(value: true);
	}

	public void ChangeInnerFitColor(int index, Color color)
	{
		curInnerfitColor = index;
		Renderer component = innerfitPool[curInnerfit].GetComponent<Renderer>();
		if (component != null)
		{
			component.material.color = color;
		}
		customizingAvatarController.curInnerfitColor = curInnerfitColor;
	}

	public void ChangeOuterFit(int index)
	{
		curOuterfit = index;
		foreach (KeyValuePair<int, GameObject> item in outerfitPool)
		{
			item.Value.SetActive(value: false);
		}
		outerfitPool[index].SetActive(value: true);
	}

	public void ChangeOuterFitColor(int index, Color color)
	{
		curOuterfitColor = index;
		Renderer component = outerfitPool[curOuterfit].GetComponent<Renderer>();
		if (component != null)
		{
			component.material.color = color;
		}
		customizingAvatarController.curOuterfitColor = curOuterfitColor;
	}

	public void ChangeHat(int index)
	{
		curHat = index;
		foreach (KeyValuePair<int, GameObject> item in hatPool)
		{
			item.Value.SetActive(value: false);
		}
		hatPool[index].SetActive(value: true);
		AvatarHat component = hatPool[index].GetComponent<AvatarHat>();
		if (component != null)
		{
			if (curHairShape == 0)
			{
				component.ShowHairPrefab(show: false);
			}
			else
			{
				hairPool[curHairShape].SetActive(value: false);
				component.ShowHairPrefab(show: true);
				component.hairPrefab.GetComponent<Renderer>().material.color = colorSet.hairColorSet[curHairColor];
			}
		}
		if (index == 0)
		{
			hairPool[curHairShape].SetActive(value: true);
		}
	}

	public void ChangeHatHairColor(int index, Color color)
	{
		curHairColor = index;
		if (curHat != 0)
		{
			Renderer component = hatPool[curHat].GetComponent<AvatarHat>().hairPrefab.GetComponent<Renderer>();
			if (component != null)
			{
				component.material.color = color;
			}
		}
	}

	public void ChangeWatch(int index)
	{
		curWatch = index;
		foreach (KeyValuePair<int, GameObject> item in watchPool)
		{
			item.Value.SetActive(value: false);
		}
		watchPool[index].SetActive(value: true);
	}

	public void ChangeGlasses(int index)
	{
		curGlasses = index;
		foreach (KeyValuePair<int, GameObject> item in glassesPool)
		{
			item.Value.SetActive(value: false);
		}
		glassesPool[index].SetActive(value: true);
	}
}
public class FaceCamera : MonoBehaviour
{
	private Main main;

	[Header("RotateAxis")]
	public bool x;

	public bool y;

	public bool z;

	[Header("ScaleByDistance")]
	public bool isScaleAdjustByDistance = true;

	public float scalingPower = 0.25f;

	public float adjustingPointMin = 2f;

	public float adjustingPointMax = 50f;

	private float defaultScale = 1f;

	private Vector3 defaultSize = new Vector3(-1.5f, 1.5f, 1f);

	private void Awake()
	{
		SceneManager.sceneLoaded += OnSceneLoaded;
	}

	private void OnEnable()
	{
		if (main == null)
		{
			FindMain();
		}
	}

	private void OnDestroy()
	{
		SceneManager.sceneLoaded -= OnSceneLoaded;
	}

	private void Start()
	{
		FindMain();
	}

	private void Update()
	{
		if (main == null)
		{
			return;
		}
		if (x && y && z)
		{
			base.transform.LookAt(main.cameraTransform);
		}
		else if (!x && y && !z)
		{
			Vector3 worldPosition = new Vector3(main.cameraTransform.position.x, base.transform.position.y, main.cameraTransform.position.z);
			base.transform.LookAt(worldPosition);
		}
		if (main.scene == SceneState.LOBBY)
		{
			if (base.transform.localScale != defaultSize)
			{
				base.transform.localScale = defaultSize;
			}
		}
		else if (main.scene == SceneState.STAGE && isScaleAdjustByDistance)
		{
			float num = Vector3.Distance(base.transform.position, main.cameraTransform.position);
			float num2 = ((!(num >= adjustingPointMin) || !(num <= adjustingPointMax)) ? defaultScale : GetNewScale(num));
			base.transform.localScale = new Vector3(0f - num2, num2, base.transform.localScale.z);
		}
	}

	private void OnSceneLoaded(Scene scene, LoadSceneMode mode)
	{
		FindMain();
	}

	private void FindMain()
	{
		main = Singleton<Main>.Instance;
	}

	private float GetNewScale(float currentDistance)
	{
		return currentDistance * scalingPower + 0.75f;
	}
}
[Serializable]
public class dummyAvatarData
{
	public List<GameObject> face;

	public List<GameObject> hair;

	public List<GameObject> mustache;

	public List<GameObject> eyebrow;

	public List<GameObject> outfit;

	public List<GameObject> accessory;
}
public class MyAvatar : MonoBehaviour
{
	[HideInInspector]
	public CustomizingAvatarController customizingAvatarController;

	[Header("Customizing")]
	public ColorSetDatabase colorSetDatabase;

	public int curGender;

	public Transform leftHand;

	public Transform rightHand;

	public GameObject userInfoPivot;

	public AvatarController avatarController;

	private void Awake()
	{
		leftHand.gameObject.SetActive(value: false);
		rightHand.gameObject.SetActive(value: false);
		userInfoPivot.SetActive(value: false);
	}

	private void Start()
	{
		if (Singleton<Main>.Instance.scene != SceneState.ROOM)
		{
			avatarController.InitMyAavatar(Singleton<DataManager>.Instance.userData.curGender);
		}
	}
}
public class PaletteColor : MonoBehaviour, IPointerClickHandler, IEventSystemHandler
{
	public CustomizingAvatarController customizingAvatarController;

	public Color color;

	public int id;

	public bool isEyeColor;

	public void OnPointerClick(PointerEventData eventData)
	{
		int curGender = customizingAvatarController.myAvatar.curGender;
		switch (customizingAvatarController.currentSelectedCategory)
		{
		case CustomizingCategory.FACE:
			customizingAvatarController.curFaceColor = id;
			customizingAvatarController.myAvatar.ChangeFaceColor(id, color);
			break;
		case CustomizingCategory.HAIR:
			customizingAvatarController.curHairColor = id;
			if (customizingAvatarController.curHat == 0)
			{
				customizingAvatarController.myAvatar.ChangeHairColor(id, color);
			}
			else
			{
				customizingAvatarController.myAvatar.ChangeHatHairColor(id, color);
			}
			break;
		case CustomizingCategory.MUSTACHE:
			if (curGender == 0)
			{
				customizingAvatarController.curMustacheColor = id;
				customizingAvatarController.myAvatar.ChangeMustacheColor(id, color);
			}
			break;
		case CustomizingCategory.EYEBROW:
			if (isEyeColor)
			{
				customizingAvatarController.curEyeColor = id;
				customizingAvatarController.myAvatar.ChangeEyeColor(id, color);
			}
			else
			{
				customizingAvatarController.curEyebrowColor = id;
				customizingAvatarController.myAvatar.ChangeEyebrowColor(id, color);
			}
			break;
		case CustomizingCategory.INNERFIT:
			customizingAvatarController.curInnerfitColor = id;
			customizingAvatarController.myAvatar.ChangeInnerfitColor(id, color);
			break;
		case CustomizingCategory.OUTERFIT:
			customizingAvatarController.curOuterfitColor = id;
			customizingAvatarController.myAvatar.ChangeOuterfitColor(id, color);
			break;
		}
	}
}
public class SubCategoryElement : MonoBehaviour, IPointerClickHandler, IEventSystemHandler
{
	public CustomizingCategory customizingCategory;

	public Image image;

	public int id;

	public CustomizingAvatarController customizingAvatarController;

	public void SetImage(Sprite sprite)
	{
		image.sprite = sprite;
	}

	public void OnPointerClick(PointerEventData eventData)
	{
		switch (customizingCategory)
		{
		case CustomizingCategory.GENDER:
			customizingAvatarController.curGender = id;
			customizingAvatarController.myAvatar.curGender = id;
			customizingAvatarController.GenderCheck();
			customizingAvatarController.UpdateDataToSave(id);
			break;
		case CustomizingCategory.FACE:
			customizingAvatarController.curFace = id;
			break;
		case CustomizingCategory.HAIR:
			if (customizingAvatarController.curHat != 0)
			{
				customizingAvatarController.curHat = 0;
			}
			customizingAvatarController.curHair = id;
			break;
		case CustomizingCategory.MUSTACHE:
			customizingAvatarController.curMustache = id;
			break;
		case CustomizingCategory.EYEBROW:
			customizingAvatarController.curEyebrow = id;
			break;
		case CustomizingCategory.INNERFIT:
			customizingAvatarController.curInnerfit = id;
			break;
		case CustomizingCategory.OUTERFIT:
			customizingAvatarController.curOuterfit = id;
			break;
		case CustomizingCategory.HAT:
			customizingAvatarController.curHat = id;
			break;
		case CustomizingCategory.GLASSES:
			customizingAvatarController.curGlasses = id;
			break;
		case CustomizingCategory.GLOVES:
			customizingAvatarController.curGlove = id;
			break;
		}
		customizingAvatarController.myAvatar.ChangeItem(customizingCategory, id);
	}
}
public class baitLinePos : MonoBehaviour
{
	public GameObject linePosLeft;

	public GameObject linePosRight;

	private Transform lineTransLeft;

	private Transform lineTransRight;

	private void Start()
	{
		lineTransLeft = linePosLeft.transform;
		lineTransRight = linePosRight.transform;
	}

	private void LateUpdate()
	{
		if (linePosLeft.activeSelf)
		{
			base.transform.position = lineTransLeft.position;
		}
		else if (linePosRight.activeSelf)
		{
			base.transform.position = lineTransRight.position;
		}
	}
}
public class bonusFishMove : MonoBehaviour
{
	public float distance = 0.2f;

	public float attachTime = 1f;

	private Transform targetPos;

	private Animation fishAni;

	private bool bMove;

	private float sTime;

	private void Start()
	{
	}

	private void Update()
	{
		if (bMove)
		{
			sTime += Time.deltaTime * (1f / attachTime);
			if (sTime > attachTime)
			{
				bMove = false;
			}
			base.transform.localPosition = Vector3.Lerp(base.transform.localPosition, Vector3.zero, sTime);
		}
	}
}
public class CamFadeControl : MonoBehaviour
{
	[Tooltip("Fade duration")]
	public float fadeTime = 2f;

	[Tooltip("Screen color at maximum fade")]
	public Color fadeColor = new Color(0.01f, 0.01f, 0.01f, 1f);

	public bool fadeOnStart = true;

	public int renderQueue = 5000;

	private float uiFadeAlpha;

	private MeshRenderer fadeRenderer;

	private Material fadeMaterial;

	private bool isFading;

	public float currentAlpha { get; private set; }

	private void Start()
	{
		fadeMaterial = GetComponent<Renderer>().material;
		fadeRenderer = GetComponent<MeshRenderer>();
		SetFadeLevel(0f);
		if (fadeOnStart)
		{
			StartCoroutine(Fade(1f, 0f));
		}
		else
		{
			fadeRenderer.enabled = false;
		}
	}

	public void FadeOut()
	{
		fadeRenderer.enabled = true;
		StartCoroutine(Fade(0f, 1f));
	}

	public void FadeSpeed(float Start, float End, float time)
	{
		fadeRenderer.enabled = true;
		StartCoroutine(FadeTime(Start, End, time));
	}

	public void SetUIFade(float level)
	{
		uiFadeAlpha = Mathf.Clamp01(level);
		SetMaterialAlpha();
	}

	public void SetFadeLevel(float level)
	{
		currentAlpha = level;
		SetMaterialAlpha();
	}

	private IEnumerator Fade(float startAlpha, float endAlpha)
	{
		float elapsedTime = 0f;
		while (elapsedTime < fadeTime)
		{
			elapsedTime += Time.deltaTime;
			currentAlpha = Mathf.Lerp(startAlpha, endAlpha, Mathf.Clamp01(elapsedTime / fadeTime));
			SetMaterialAlpha();
			yield return new WaitForEndOfFrame();
		}
	}

	private IEnumerator FadeTime(float startAlpha, float endAlpha, float time)
	{
		float elapsedTime = 0f;
		while (elapsedTime < time)
		{
			elapsedTime += Time.deltaTime;
			currentAlpha = Mathf.Lerp(startAlpha, endAlpha, Mathf.Clamp01(elapsedTime / time));
			SetMaterialAlpha();
			yield return new WaitForEndOfFrame();
		}
	}

	private void SetMaterialAlpha()
	{
		Color color = fadeColor;
		color.a = Mathf.Max(currentAlpha, uiFadeAlpha);
		isFading = color.a > 0f;
		if (fadeMaterial != null)
		{
			fadeMaterial.color = color;
			fadeMaterial.renderQueue = renderQueue;
			fadeRenderer.material = fadeMaterial;
			fadeRenderer.enabled = isFading;
		}
	}
}
public class changeQue : MonoBehaviour
{
	public Renderer fishRen;

	private void Start()
	{
		fishRen.materials[1].renderQueue = 2500;
	}
}
public class CloudScroll : MonoBehaviour
{
	public float horizontalScrollSpeed = 0.25f;

	public float verticalScrollSpeed = 0.25f;

	private bool scroll = true;

	public void FixedUpdate()
	{
		if (scroll)
		{
			float y = Time.time * verticalScrollSpeed;
			float x = Time.time * horizontalScrollSpeed;
			GetComponent<Renderer>().material.mainTextureOffset = new Vector2(x, y);
		}
	}

	public void DoActivateTrigger()
	{
		scroll = !scroll;
	}
}
public class cloudThunder : MonoBehaviour
{
	public float cycleTime = 10f;

	public float brightPow = 1f;

	[HideInInspector]
	public float bright;

	public AudioClip[] sounds;

	private AudioSource audios;

	private float randomTime;

	private Color oriColor;

	private Animation ani;

	private Material mat;

	private void Start()
	{
		ani = GetComponent<Animation>();
		mat = GetComponent<Renderer>().material;
		oriColor = mat.GetColor("_CloudColor");
		StartCoroutine(thunder());
	}

	private IEnumerator thunder()
	{
		randomTime = UnityEngine.Random.Range(cycleTime, cycleTime * 2f);
		yield return new WaitForSeconds(randomTime);
		ani.Play();
		randomSound();
		while (ani.isPlaying)
		{
			float num = bright * brightPow;
			mat.SetColor("_CloudColor", oriColor + new Color(num, num, num, 0f));
			yield return null;
		}
		StartCoroutine(thunder());
	}

	private void randomSound()
	{
		_ = sounds.Length;
		audios = GetComponent<AudioSource>();
		int num = UnityEngine.Random.Range(0, sounds.Length);
		audios.clip = sounds[num];
		audios.Play();
	}
}
public class colorBlinker : MonoBehaviour
{
	public Color baseColor = Color.white;

	[HideInInspector]
	public float sin;

	public float speed = 1f;

	public bool fade = true;

	private Renderer rend;

	private Color original;

	private IEnumerator coroutine;

	private Animation ani;

	private void Awake()
	{
		rend = GetComponent<Renderer>();
		ani = GetComponent<Animation>();
		coroutine = blink();
	}

	private void OnEnable()
	{
		StartCoroutine(coroutine);
	}

	private void OnDisable()
	{
		StopCoroutine(coroutine);
	}

	private IEnumerator blink()
	{
		ani["sinGraph"].speed = speed;
		while (true)
		{
			float a = (sin + 1f) * 0.5f;
			if (fade)
			{
				rend.material.color = new Color(1f, 1f, 1f, a) * baseColor;
			}
			else
			{
				rend.material.color = new Color(1f, 1f, 1f, 1f) * baseColor;
			}
			yield return null;
		}
	}
}
public class BatteryDisplay : MonoBehaviour
{
	private Text batteryText;

	private float sTime;

	private void Awake()
	{
		batteryText = GetComponent<Text>();
	}

	private void OnEnable()
	{
		batteryText.text = OVRInput.GetControllerBatteryPercentRemaining(OVRInput.Controller.LTouch) + " %";
		MonoBehaviour.print(OVRInput.GetControllerBatteryPercentRemaining(OVRInput.Controller.LTouch) + " %");
	}

	private void Update()
	{
		sTime += Time.deltaTime;
		if (sTime > 10f)
		{
			sTime = 0f;
			batteryText.text = OVRInput.GetControllerBatteryPercentRemaining(OVRInput.Controller.LTouch) + " %";
			MonoBehaviour.print(OVRInput.GetControllerBatteryPercentRemaining(OVRInput.Controller.LTouch) + " %");
		}
	}
}
public class Console : Singleton<Console>
{
	public GameObject panelConsole;

	public GameObject panelFishingMenu;

	public GameObject panelKeyboard;

	public Transform pivotRotate;

	public Transform pivotDistance;

	public Transform pivotScale;

	public Transform pivotBoard;

	public Transform pivotHeight;

	public float distance = 1f;

	public float scale = 0.7f;

	public float angle = 35f;

	public float height = 0.2f;

	public control_Menu menuControl;

	public RectTransform buttonMedia;

	public RectTransform buttonKeyboard;

	public RectTransform[] buttonMenu;

	public float buttonDownHeight;

	public float buttonUpHeight = -15f;

	public float buttonSpeed = 1f;

	private bool keyboardShow;

	public Color colorSelected;

	public Color colorUnselected;

	public Color colorOverlay;

	public Color colorCaution;

	public Keyboard keyboard;

	public Image ImageMedia;

	public Image ImageMap;

	private AudioSource beepSound;

	private Main main;

	private DataManager dataManager;

	private bool isDragingL;

	private bool isDragingR;

	private Vector3 dragStartRotation = Vector3.zero;

	private Vector3 consoleStartRotation = Vector3.zero;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
		pivotDistance.localPosition = new Vector3(0f, 0f, distance);
		pivotScale.localScale = new Vector3(scale, scale, scale);
		pivotBoard.localEulerAngles = new Vector3(angle, 0f, 0f);
		main.isMenuOn = false;
		beepSound = GetComponent<AudioSource>();
		HideConsole();
	}

	private void LateUpdate()
	{
		if (main.scene == SceneState.STAGE)
		{
			if (main.fishingControl.gameState == control_Fishing.EfishingState.ready && main.tutoControl.menu)
			{
				ToggleConsole();
			}
		}
		else
		{
			ToggleConsole();
		}
		if (isDragingL)
		{
			Vector3 vector = main.getLeftHandTransform().eulerAngles - dragStartRotation;
			pivotRotate.eulerAngles = new Vector3(consoleStartRotation.x + vector.x, consoleStartRotation.y + vector.y, 0f);
			if (VRInput.bInputTriggerUp(VRInput.eController.mainhand))
			{
				if (!dataManager.userData.rightHand)
				{
					isDragingL = false;
				}
			}
			else if (VRInput.bInputTriggerUp(VRInput.eController.subhand) && dataManager.userData.rightHand)
			{
				isDragingL = false;
			}
		}
		if (!isDragingR)
		{
			return;
		}
		Vector3 vector2 = main.getRightHandTransform().eulerAngles - dragStartRotation;
		pivotRotate.eulerAngles = new Vector3(consoleStartRotation.x + vector2.x, consoleStartRotation.y + vector2.y, 0f);
		if (VRInput.bInputTriggerUp(VRInput.eController.mainhand))
		{
			if (dataManager.userData.rightHand)
			{
				isDragingR = false;
			}
		}
		else if (VRInput.bInputTriggerUp(VRInput.eController.subhand) && !dataManager.userData.rightHand)
		{
			isDragingR = false;
		}
	}

	private void ToggleConsole()
	{
		if (VRInput.Button_T_Click(VRInput.eController.bothhand))
		{
			if (main.isMenuOn)
			{
				HideConsole();
			}
			else
			{
				ShowConsole();
			}
		}
	}

	public void doDragingL()
	{
		dragStartRotation = main.getLeftHandTransform().eulerAngles;
		consoleStartRotation = pivotRotate.eulerAngles;
		isDragingL = true;
	}

	public void doDragingR()
	{
		dragStartRotation = main.getRightHandTransform().eulerAngles;
		consoleStartRotation = pivotRotate.eulerAngles;
		isDragingR = true;
	}

	public void setPosition()
	{
		base.transform.position = Singleton<Main>.Instance.cameraTransform.position;
	}

	public void ShowConsole()
	{
		setPosition();
		pivotHeight.localPosition = new Vector3(0f, 0f - height, 0f);
		if (main.scene == SceneState.STAGE)
		{
			if (!main.useTutorial)
			{
				pivotRotate.eulerAngles = new Vector3(main.cameraTransform.eulerAngles.x, main.cameraTransform.eulerAngles.y, 0f);
			}
		}
		else
		{
			pivotRotate.eulerAngles = new Vector3(main.cameraTransform.eulerAngles.x, main.cameraTransform.eulerAngles.y, 0f);
		}
		panelConsole.SetActive(value: true);
		panelFishingMenu.SetActive(value: true);
		panelKeyboard.SetActive(value: false);
		main.isMenuOn = true;
		if (!main.useTutorial)
		{
			for (int i = 0; i < buttonMenu.Length; i++)
			{
				if (i == 0)
				{
					buttonMenu[i].localPosition = new Vector3(buttonMenu[i].localPosition.x, buttonMenu[i].localPosition.y, buttonDownHeight);
				}
				else
				{
					buttonMenu[i].localPosition = new Vector3(buttonMenu[i].localPosition.x, buttonMenu[i].localPosition.y, buttonUpHeight);
				}
			}
		}
		else
		{
			for (int j = 0; j < buttonMenu.Length; j++)
			{
				if (j == 2)
				{
					buttonMenu[j].localPosition = new Vector3(buttonMenu[j].localPosition.x, buttonMenu[j].localPosition.y, buttonDownHeight);
				}
				else
				{
					buttonMenu[j].localPosition = new Vector3(buttonMenu[j].localPosition.x, buttonMenu[j].localPosition.y, buttonUpHeight);
				}
			}
		}
		buttonKeyboard.localPosition = new Vector3(buttonKeyboard.localPosition.x, buttonKeyboard.localPosition.y, buttonUpHeight);
		if (dataManager.userData.isMediaOn)
		{
			buttonMedia.localPosition = new Vector3(buttonMedia.localPosition.x, buttonMedia.localPosition.y, buttonDownHeight);
		}
		else
		{
			buttonMedia.localPosition = new Vector3(buttonMedia.localPosition.x, buttonMedia.localPosition.y, buttonUpHeight);
		}
		menuControl.MenuOn();
	}

	public void HideConsole()
	{
		panelConsole.SetActive(value: false);
		panelFishingMenu.SetActive(value: false);
		panelKeyboard.SetActive(value: false);
		main.isMenuOn = false;
		keyboardShow = false;
	}

	public void ToggleKeyboard()
	{
		if (!main.useTutorial)
		{
			keyboardShow = !keyboardShow;
			if (keyboardShow)
			{
				ShowKeyboard();
				ClickMenu(-1);
			}
			else
			{
				HideKeyboard();
				ClickMenu(0);
			}
		}
	}

	public void ShowLetter()
	{
		if (!Singleton<Main>.Instance.isMenuOn)
		{
			Singleton<Console>.Instance.ShowConsole();
		}
		ShowKeyboard();
		ClickMenu(-1);
	}

	public void HideLetter()
	{
		HideKeyboard();
		ClickMenu(-1);
	}

	public void ShowKeyboard()
	{
		keyboardShow = true;
		panelKeyboard.SetActive(value: true);
		buttonKeyboard.localPosition = new Vector3(buttonKeyboard.localPosition.x, buttonKeyboard.localPosition.y, buttonDownHeight);
	}

	private void HideKeyboard()
	{
		keyboardShow = false;
		panelKeyboard.SetActive(value: false);
		buttonKeyboard.localPosition = new Vector3(buttonKeyboard.localPosition.x, buttonKeyboard.localPosition.y, buttonUpHeight);
	}

	public void ToggleMedia()
	{
		dataManager.userData.isMediaOn = !dataManager.userData.isMediaOn;
		if (main.scene == SceneState.STAGE)
		{
			if (main.tutoControl.media)
			{
				if (dataManager.userData.isMediaOn)
				{
					Singleton<MediaController>.Instance.TurnOnMedia();
				}
				else
				{
					Singleton<MediaController>.Instance.TurnOffMedia();
				}
			}
		}
		else if (dataManager.userData.isMediaOn)
		{
			Singleton<MediaController>.Instance.TurnOnMedia();
		}
		else
		{
			Singleton<MediaController>.Instance.TurnOffMedia();
		}
		buttonCheckMedia();
	}

	public void ResetMediaPosition()
	{
		Singleton<MediaController>.Instance.TurnOnMedia();
		Singleton<MediaController>.Instance.Reposition(isReset: true);
	}

	public void buttonCheckMedia()
	{
		if (dataManager.userData.isMediaOn)
		{
			buttonMedia.localPosition = new Vector3(buttonMedia.localPosition.x, buttonMedia.localPosition.y, buttonDownHeight);
		}
		else
		{
			buttonMedia.localPosition = new Vector3(buttonMedia.localPosition.x, buttonMedia.localPosition.y, buttonUpHeight);
		}
		beepSound.Play();
	}

	public void ClickMenu(int num)
	{
		if (num == -1)
		{
			panelFishingMenu.SetActive(value: false);
			for (int i = 0; i < buttonMenu.Length; i++)
			{
				buttonMenu[i].localPosition = new Vector3(buttonMenu[i].localPosition.x, buttonMenu[i].localPosition.y, buttonUpHeight);
			}
		}
		else
		{
			panelFishingMenu.SetActive(value: true);
			HideKeyboard();
			for (int j = 0; j < buttonMenu.Length; j++)
			{
				if (j == num)
				{
					buttonMenu[j].localPosition = new Vector3(buttonMenu[j].localPosition.x, buttonMenu[j].localPosition.y, buttonDownHeight);
				}
				else
				{
					buttonMenu[j].localPosition = new Vector3(buttonMenu[j].localPosition.x, buttonMenu[j].localPosition.y, buttonUpHeight);
				}
			}
		}
		menuControl.ClickMneuButton(num);
	}

	private IEnumerator buttonMove(float height)
	{
		yield return null;
	}
}
public class ConsoleDisplayInfo : MonoBehaviour
{
	public Text textTime;

	public Text textBatteryControllerR;

	public Text textBatteryControllerL;

	public Text textBatteryControllerHMD;

	public GameObject uiControllerBattery;

	public GameObject uiHMDBattery;

	public float rescanTime = 30f;

	private float sTime;

	private void Start()
	{
		OVRManager.VrFocusAcquired += OnFocus;
	}

	private void OnFocus()
	{
		textBatteryControllerR.text = OVRInput.GetControllerBatteryPercentRemaining(OVRInput.Controller.RTouch).ToString();
		textBatteryControllerL.text = OVRInput.GetControllerBatteryPercentRemaining(OVRInput.Controller.LTouch).ToString();
		int num = (int)(SystemInfo.batteryLevel * 100f);
		textBatteryControllerHMD.text = num.ToString();
	}

	private void OnEnable()
	{
		textTime.text = DateTime.Now.ToString("hh:mm tt");
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			uiControllerBattery.SetActive(value: true);
			uiHMDBattery.SetActive(value: true);
			textBatteryControllerR.text = OVRInput.GetControllerBatteryPercentRemaining(OVRInput.Controller.RTouch).ToString();
			textBatteryControllerL.text = OVRInput.GetControllerBatteryPercentRemaining(OVRInput.Controller.LTouch).ToString();
			int num = (int)(SystemInfo.batteryLevel * 100f);
			textBatteryControllerHMD.text = num.ToString();
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			uiHMDBattery.SetActive(value: true);
			uiControllerBattery.SetActive(value: false);
			int num2 = (int)(SystemInfo.batteryLevel * 100f);
			textBatteryControllerHMD.text = num2.ToString();
		}
		else
		{
			uiHMDBattery.SetActive(value: false);
			uiControllerBattery.SetActive(value: false);
		}
	}

	private void Update()
	{
		sTime += Time.deltaTime;
		if (sTime > rescanTime)
		{
			sTime = 0f;
			textTime.text = DateTime.Now.ToString("hh:mm tt");
			if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
			{
				textBatteryControllerR.text = OVRInput.GetControllerBatteryPercentRemaining(OVRInput.Controller.RTouch).ToString();
				textBatteryControllerL.text = OVRInput.GetControllerBatteryPercentRemaining(OVRInput.Controller.LTouch).ToString();
				int num = (int)(SystemInfo.batteryLevel * 100f);
				textBatteryControllerHMD.text = num.ToString();
			}
			if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
			{
				int num2 = (int)(SystemInfo.batteryLevel * 100f);
				textBatteryControllerHMD.text = num2.ToString();
			}
		}
	}
}
public class InventoryManager : MonoBehaviour
{
	public List<GameObject> slots;

	private void Start()
	{
	}

	private void Update()
	{
	}
}
public class SetTimeDisplay : MonoBehaviour
{
	private Text timeText;

	private float sTime;

	private void Awake()
	{
		timeText = GetComponent<Text>();
	}

	private void OnEnable()
	{
		timeText.text = DateTime.Now.ToString("hh:mm tt");
	}

	private void Update()
	{
		sTime += Time.deltaTime;
		if (sTime > 30f)
		{
			sTime = 0f;
			timeText.text = DateTime.Now.ToString("hh:mm tt");
		}
	}
}
public class ARFish : MonoBehaviour
{
	private ARFishController arFishController;

	private void Start()
	{
		arFishController = ARFishController.instance;
	}

	private void Update()
	{
	}

	private void OnCollisionEnter(Collision collision)
	{
		if (collision.gameObject.CompareTag("BULLET"))
		{
			arFishController.arFishShootingGame.ScoreUp(1);
			Hide();
			arFishController.effectLibrary.ARFishParticleSpawn(base.transform.position, UnityEngine.Random.Range(0, arFishController.effectLibrary.arFishParticles.Length));
			StartCoroutine(Show());
		}
	}

	private void Hide()
	{
		GetComponent<Collider>().enabled = false;
		GetComponent<Renderer>().enabled = false;
	}

	private IEnumerator Show()
	{
		yield return new WaitForSeconds(5f);
		GetComponent<Collider>().enabled = true;
		GetComponent<Renderer>().enabled = true;
	}
}
public class ARFishController : MonoBehaviour
{
	public static ARFishController instance;

	[Header("ARFish")]
	public Material hologramMaterial;

	public SchoolController[] schoolControllers_saltWaterFish;

	public float lastingTime = 60f;

	private float _lastingTime;

	[HideInInspector]
	public bool isARFishOn;

	[Header("ShootingGame")]
	public ARFishShootingGame arFishShootingGame;

	[Header("Effects")]
	public EffectLibrary effectLibrary;

	public AudioSource audioSource;

	[Header("For test")]
	public bool beginOnStart;

	private void Awake()
	{
		instance = this;
	}

	private void Start()
	{
		if (beginOnStart)
		{
			DisplayARFish();
		}
		_lastingTime = lastingTime;
	}

	private void Update()
	{
		if (isARFishOn)
		{
			if (_lastingTime > 0f)
			{
				_lastingTime -= Time.deltaTime;
			}
			else
			{
				RemoveARFish();
			}
		}
	}

	public void DisplayARFish()
	{
		for (int i = 0; i < schoolControllers_saltWaterFish.Length; i++)
		{
			schoolControllers_saltWaterFish[i]._childAmount = 1;
			schoolControllers_saltWaterFish[i].UpdateFishAmount(schoolControllers_saltWaterFish[i]._childAmount, schoolControllers_saltWaterFish[i]._roamers.Count);
			Collider componentInChildren = schoolControllers_saltWaterFish[i]._roamers[0].gameObject.GetComponentInChildren<Collider>();
			if (componentInChildren != null)
			{
				componentInChildren.enabled = true;
				componentInChildren.gameObject.AddComponent<ARFish>();
				if ((bool)hologramMaterial)
				{
					componentInChildren.GetComponent<Renderer>().material = hologramMaterial;
				}
			}
			schoolControllers_saltWaterFish[i].AutoRandomWaypointPosition();
		}
		isARFishOn = true;
	}

	public void RemoveARFish()
	{
		for (int i = 0; i < schoolControllers_saltWaterFish.Length; i++)
		{
			schoolControllers_saltWaterFish[i]._childAmount = 0;
			schoolControllers_saltWaterFish[i].UpdateFishAmount(schoolControllers_saltWaterFish[i]._childAmount, schoolControllers_saltWaterFish[i]._roamers.Count);
		}
		isARFishOn = false;
		RenewTime(lastingTime);
	}

	public void RenewTime(float timeRenewed)
	{
		_lastingTime = timeRenewed;
	}
}
public class ARFishShootingGame : MonoBehaviour
{
	private ARFishController arFishController;

	public GameObject scoreBoard;

	public Text txt_score;

	public Text txt_timeLeft;

	[HideInInspector]
	public bool isGameStarted;

	public int score;

	public float timeLeft = 30f;

	private void Start()
	{
		arFishController = ARFishController.instance;
		scoreBoard.SetActive(value: false);
	}

	private void Update()
	{
		if (isGameStarted)
		{
			if (timeLeft > 0f)
			{
				timeLeft -= Time.deltaTime;
				UpdateTimeLeft();
			}
			else
			{
				isGameStarted = false;
				GameEnd();
			}
		}
	}

	public void GameStart()
	{
		if (!isGameStarted && arFishController.isARFishOn)
		{
			ScoreReset();
			scoreBoard.SetActive(value: true);
			isGameStarted = true;
			timeLeft = 30f;
			UpdateScoreBoard();
			arFishController.RenewTime(arFishController.lastingTime);
		}
	}

	public void GameEnd()
	{
		arFishController.RemoveARFish();
		isGameStarted = false;
		txt_timeLeft.text = "Game Done";
		Invoke("HideScoreBoard", 5f);
	}

	private void ScoreReset()
	{
		score = 0;
	}

	private void HideScoreBoard()
	{
		scoreBoard.SetActive(value: false);
	}

	public void ScoreUp(int _score)
	{
		if (isGameStarted)
		{
			score += _score;
			UpdateScoreBoard();
		}
	}

	public void ScoreDown(int _score)
	{
		if (isGameStarted)
		{
			score -= _score;
			UpdateScoreBoard();
		}
	}

	private void UpdateScoreBoard()
	{
		txt_score.text = score.ToString();
	}

	private void UpdateTimeLeft()
	{
		txt_timeLeft.text = timeLeft.ToString("N1");
	}
}
public class Branch : RVRFGrabbable
{
	public Transform[] igniteSpots;

	private void OnTriggerEnter(Collider other)
	{
		if (!other.gameObject.GetComponent<CampFireController>())
		{
			return;
		}
		GameObject gameObject = other.gameObject;
		CampFireController component = other.gameObject.GetComponent<CampFireController>();
		float num = float.MaxValue;
		Transform transform = null;
		Transform[] array = igniteSpots;
		foreach (Transform transform2 in array)
		{
			float sqrMagnitude = (gameObject.transform.position - transform2.position).sqrMagnitude;
			if (sqrMagnitude < num)
			{
				num = sqrMagnitude;
				transform = transform2;
			}
		}
		if (transform != null)
		{
			component.IgniteBranch(this, transform.position);
		}
		if (base.grabbedBy == null)
		{
			StartCoroutine(IfNotGrabbedDisappear(component.branchStack));
		}
	}

	private IEnumerator IfNotGrabbedDisappear(BranchStack branchStack)
	{
		yield return new WaitForSeconds(10f);
		if (base.grabbedBy == null)
		{
			base.gameObject.transform.position = branchStack.transform.position;
			base.gameObject.SetActive(value: false);
		}
	}
}
public class BranchStack : MonoBehaviour
{
	public GameObject[] branchPrefabsForLobby;

	public GameObject[] branchPrefabsForStage;

	public int numberOfEachBranch = 5;

	public List<GameObject> branchPooling;

	public GameObject pickedBranch;

	private void Start()
	{
		BranchPooling();
	}

	private void BranchPooling()
	{
		GameObject[] array = null;
		if (Singleton<Main>.Instance.scene == SceneState.LOBBY)
		{
			array = branchPrefabsForLobby;
		}
		else if (Singleton<Main>.Instance.scene == SceneState.STAGE)
		{
			array = branchPrefabsForStage;
		}
		for (int i = 0; i < numberOfEachBranch; i++)
		{
			for (int j = 0; j < array.Length; j++)
			{
				GameObject gameObject = UnityEngine.Object.Instantiate(array[j], base.transform);
				gameObject.SetActive(value: false);
				branchPooling.Add(gameObject);
			}
		}
	}

	public GameObject TakeOutBranch(Vector3 destination, Quaternion rotation)
	{
		GameObject gameObject = null;
		foreach (GameObject item in branchPooling)
		{
			if (!item.activeSelf)
			{
				item.SetActive(value: true);
				gameObject = item;
				gameObject.transform.position = destination;
				gameObject.transform.rotation = rotation;
				break;
			}
		}
		if (gameObject == null)
		{
			foreach (GameObject item2 in branchPooling)
			{
				if (item2.activeSelf)
				{
					gameObject = item2;
					gameObject.transform.position = destination;
					gameObject.transform.rotation = rotation;
					break;
				}
			}
		}
		return gameObject;
	}
}
public class CampFireController : MonoBehaviour
{
	public ParticleSystem campFireParticleSystem;

	private ParticleSystem.MainModule particleModule;

	public GameObject branchIgnitingParticle;

	private List<GameObject> branchIgnitingParticlePool = new List<GameObject>();

	public int poolSize = 10;

	public BranchStack branchStack;

	public Vector2 minStartSize = new Vector2(0.5f, 1f);

	public Vector2 maxStartSize = new Vector2(10f, 10f);

	public float ignitingPower = 1f;

	public float extinguishingPower = 0.01f;

	private Vector2 currentStartSize;

	private void Start()
	{
		particleModule = campFireParticleSystem.main;
		particleModule.startSize = new ParticleSystem.MinMaxCurve(minStartSize.x, minStartSize.y);
		BranchIgnitingParticlePooling();
	}

	private void BranchIgnitingParticlePooling()
	{
		for (int i = 0; i < poolSize; i++)
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(branchIgnitingParticle, base.transform);
			gameObject.SetActive(value: false);
			branchIgnitingParticlePool.Add(gameObject);
		}
	}

	private void Update()
	{
		currentStartSize = new Vector2(campFireParticleSystem.main.startSize.constantMin, campFireParticleSystem.main.startSize.constantMax);
		if (currentStartSize.x > minStartSize.x)
		{
			Vector2 vector = currentStartSize - new Vector2(extinguishingPower, extinguishingPower);
			particleModule.startSize = new ParticleSystem.MinMaxCurve(vector.x, vector.y);
		}
	}

	private void OnTriggerEnter(Collider other)
	{
		if ((bool)other.GetComponent<Branch>() && !(currentStartSize.x > maxStartSize.x))
		{
			Vector2 vector = currentStartSize + new Vector2(ignitingPower, ignitingPower);
			particleModule.startSize = new ParticleSystem.MinMaxCurve(vector.x, vector.y);
		}
	}

	public void IgniteBranch(Branch branch, Vector3 ignitePosition)
	{
		foreach (GameObject item in branchIgnitingParticlePool)
		{
			if (!item.activeSelf)
			{
				item.SetActive(value: true);
				item.transform.position = ignitePosition;
				item.transform.parent = branch.transform;
				StartCoroutine(ExtinguishIgnite(item, 10f));
				break;
			}
		}
	}

	private IEnumerator ExtinguishIgnite(GameObject ignite, float time)
	{
		yield return new WaitForSeconds(time);
		ignite.SetActive(value: false);
		ignite.transform.position = base.transform.position;
		ignite.transform.parent = base.transform;
	}
}
public class CrystallBall : MonoBehaviour
{
	private ARFishController arFishController;

	private float breakThreshold = 3f;

	public GameObject breakParticle;

	private void Start()
	{
	}

	private void OnCollisionEnter(Collision collision)
	{
		if (collision != null && GetComponent<Rigidbody>().velocity.magnitude > breakThreshold)
		{
			UnityEngine.Object.Instantiate(breakParticle).transform.position = base.transform.position;
			UnityEngine.Object.Destroy(base.gameObject);
		}
	}
}
public class EffectLibrary : MonoBehaviour
{
	private ARFishController arFishController;

	[Header("ARFish")]
	public GameObject[] arFishParticles;

	public int poolSize = 5;

	private List<List<GameObject>> arFishParticlePools = new List<List<GameObject>>();

	public AudioClip[] arFishSounds;

	[Header("CrystalBall")]
	public GameObject crystallBallParticle;

	private void Start()
	{
		arFishController = ARFishController.instance;
		ARFishParticlePooling();
	}

	private void ARFishParticlePooling()
	{
		for (int i = 0; i < arFishParticles.Length; i++)
		{
			List<GameObject> item = new List<GameObject>();
			arFishParticlePools.Add(item);
			for (int j = 0; j < poolSize; j++)
			{
				GameObject gameObject = UnityEngine.Object.Instantiate(arFishParticles[i], base.transform);
				gameObject.SetActive(value: false);
				arFishParticlePools[i].Add(gameObject);
			}
		}
	}

	public void ARFishParticleSpawn(Vector3 position, int index)
	{
		foreach (GameObject item in arFishParticlePools[index])
		{
			if (!item.activeSelf)
			{
				item.transform.position = position;
				item.SetActive(value: true);
				StartCoroutine(BackToPool(item));
				arFishController.audioSource.PlayOneShot(arFishSounds[index]);
				break;
			}
		}
	}

	private IEnumerator BackToPool(GameObject usedParticle)
	{
		yield return new WaitForSeconds(2f);
		usedParticle.SetActive(value: false);
	}
}
public class FavoriteController : MonoBehaviour
{
	private List<GameObject> favoriteElements = new List<GameObject>();

	public GameObject favoritePrefab;

	public GameObject panelFavorite;

	public GameObject addButton;

	private DataManager dataManager;

	public InputField selectedInputField;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
	}

	private void Start()
	{
		StartCoroutine(waitSetting());
	}

	private IEnumerator waitSetting()
	{
		while (!dataManager.loaded)
		{
			yield return null;
		}
		Load();
		if (dataManager.userData.favorites.Count < 7)
		{
			AddElement();
		}
	}

	private void Update()
	{
	}

	private void Load()
	{
		List<string> favorites = dataManager.userData.favorites;
		if (favorites.Count > 0)
		{
			for (int i = 0; i < favorites.Count; i++)
			{
				GetSavedElement(i);
			}
		}
	}

	public void Save()
	{
		List<string> list = new List<string>();
		foreach (GameObject favoriteElement in favoriteElements)
		{
			if (favoriteElement.GetComponent<FavoriteElement>().isButtonMode)
			{
				list.Add(favoriteElement.GetComponent<FavoriteElement>().input.text);
			}
		}
		dataManager.userData.favorites = list;
		dataManager.Save();
	}

	public void ShowPanel(bool show)
	{
		panelFavorite.SetActive(show);
	}

	public void RemoveElement(int index)
	{
		favoriteElements.RemoveAt(index);
		Refresh();
		Save();
	}

	public void Remove(GameObject go)
	{
		favoriteElements.Remove(go);
		Refresh();
		Save();
	}

	public void AddElement()
	{
		GameObject gameObject = UnityEngine.Object.Instantiate(favoritePrefab, panelFavorite.transform);
		gameObject.GetComponent<FavoriteElement>().Init(this);
		selectedInputField = gameObject.GetComponent<FavoriteElement>().input;
		favoriteElements.Add(gameObject);
	}

	public void GetSavedElement(int index)
	{
		GameObject gameObject = UnityEngine.Object.Instantiate(favoritePrefab, panelFavorite.transform);
		gameObject.GetComponent<FavoriteElement>().Init(this);
		gameObject.GetComponent<FavoriteElement>().input.text = dataManager.userData.favorites[index];
		gameObject.GetComponent<FavoriteElement>().SwitchFavoriteUrlToButton();
		favoriteElements.Add(gameObject);
	}

	public void Refresh()
	{
		int num = 0;
		foreach (GameObject favoriteElement in favoriteElements)
		{
			favoriteElement.GetComponent<FavoriteElement>().indexText.text = num.ToString();
			num++;
		}
	}
}
public class FavoriteElement : MonoBehaviour
{
	private MediaController mediaController;

	private DataManager dataManager;

	public GameObject favoriteInput;

	public GameObject favoriteOutput;

	[Header("Input")]
	public Text indexText;

	public InputField input;

	[Header("Output")]
	public Text urlAdded;

	public Button deleteButton;

	public FavoriteController favoriteController;

	public bool isButtonMode;

	private void Awake()
	{
		mediaController = Singleton<MediaController>.Instance;
		dataManager = Singleton<DataManager>.Instance;
	}

	public void Init(FavoriteController fc)
	{
		favoriteController = fc;
	}

	public void Remove()
	{
		if (Singleton<DataManager>.Instance.userData.favorites.Count == 7)
		{
			favoriteController.AddElement();
		}
		favoriteController.Remove(base.gameObject);
		UnityEngine.Object.Destroy(base.gameObject);
	}

	public void AddFavoriteUrl()
	{
		if (!(input.text == "") && Singleton<DataManager>.Instance.userData.favorites.Count < 7)
		{
			isButtonMode = true;
			string text = input.text;
			urlAdded.text = text;
			favoriteController.Save();
			favoriteInput.SetActive(value: false);
			favoriteOutput.SetActive(value: true);
			if (Singleton<DataManager>.Instance.userData.favorites.Count <= 6)
			{
				favoriteController.AddElement();
			}
		}
	}

	public void SwitchFavoriteUrlToButton()
	{
		string text = input.text;
		urlAdded.text = text;
		favoriteInput.SetActive(value: false);
		favoriteOutput.SetActive(value: true);
		isButtonMode = true;
	}

	public void LoadUrl()
	{
		mediaController.StopMusic();
		string text = urlAdded.text;
		mediaController.ActiveMedia(4, text);
		if (mediaController.canvasWebViewPrefab.WebView != null)
		{
			mediaController.canvasWebViewPrefab.WebView.LoadUrl(text);
		}
		mediaController.webViewController.OpenAndCloseWebViewElements();
	}

	public void ShowKeyboard()
	{
		if (!Singleton<Main>.Instance.isMenuOn)
		{
			Singleton<Console>.Instance.ShowConsole();
		}
		Singleton<Console>.Instance.ClickMenu(-1);
		Singleton<Console>.Instance.ShowKeyboard();
	}
}
public class MediaController : Singleton<MediaController>
{
	private Main main;

	public MusicPlayerManager musicPlayerManager;

	public WebViewController webViewController;

	public FavoriteController favoriteController;

	public VolumeController volumeController;

	private VRInputModule vrInputModule;

	private VRPlayerController vrPlayerController;

	private VRLobbyPointer vrLobbyPointer;

	private VRFishingPlayerController vrFishingPlayerController;

	private VRFishingPointer vrFishingPointer;

	[Header("CanvasWebViewPrefab")]
	public GameObject canvasWebViewPrefabObject;

	public CanvasWebViewPrefab canvasWebViewPrefab;

	public Canvas canvas_Media;

	public Transform panelWebView;

	public GameObject panelNoInternet;

	private WebViewPrefabView webViewPrefabView;

	private Collider collider_WebView;

	private MeshRenderer meshrenderer_WebView;

	private Material webViewMateiral;

	[Header("Menus")]
	public GameObject[] mediaPanels;

	public GameObject[] mediaButtons;

	public Image[] mediaButtonImages;

	public Image[] settings;

	public GameObject WebFunctions;

	public GameObject musicInfoPanel;

	public GameObject webInfoPanel;

	public GameObject clearCacheBrowsingDataPanel;

	public Color unselectedColor;

	public Color selectedColor;

	[Header("UpperPanel")]
	public GameObject upperPanel;

	public Image upperPanelImage;

	public CanvasGroup upperPanelCanvasGroup;

	public float maxTime = 3f;

	public float TimeStayed = 3f;

	[Header("Media Movement")]
	public GameObject pivot_FloatingMenu;

	public Transform tr_pivot_FloatingMenu;

	public Transform tr_FloatingMenu;

	public Transform rotateAnchor;

	private bool firstDone_Lobby;

	private bool firstDone_Stage;

	public bool isPositionAdjustableL;

	public bool isPositionAdjustableR;

	private Vector3 curAnchorRotation;

	private Vector3 preAnchorRotation;

	public bool isScaleAdjustableL;

	public bool isScaleAdjustableR;

	public bool isScaleAdjustableByThumbstickL;

	public bool isScaleAdjustableByThumbstickR;

	public float scalingDegree = 0.0001f;

	private Vector3 curAnchorRotation_size;

	private Vector3 preAnchorRotation_size;

	private Vector3 curAnchorPosition_size;

	private Vector3 preAnchorPosition_size;

	public float minScale = 0.001f;

	public float maxScale = 0.01f;

	public bool isDistanceAdjustableL;

	public bool isDistanceAdjustableR;

	public bool isDistanceAdjustableByThumbstickL;

	public bool isDistanceAdjustableByThumbstickR;

	public float movingSpeedDegree = 0.15f;

	private Vector3 offset;

	private Vector3 curAnchorPosition_distance;

	private Vector3 preAnchorPosition_distance;

	private Vector3 curAnchorRotation_distance;

	private Vector3 preAnchorRotation_distance;

	public float minDistance = 1.2f;

	public float maxDistance = 9.9f;

	public float distanceSizeThreshold = 5f;

	private float thumbstickThreshold = 0.5f;

	public bool isWebViewScrollableL;

	public bool isWebViewScrollableR;

	private float scrollPower = 25f;

	private float scrollThreshold = 0.1f;

	public bool isAlphaAdjustable;

	public float alphaChangePower = 0.05f;

	private float alphaMax = 1f;

	private float alphaMin = 0.2f;

	public bool isColorAdjustable;

	private float colorChangePower = 0.025f;

	private float colorMax = 1f;

	private float colorMin = 0.2f;

	public GameObject panel_colorValue;

	public Text text_colorValue;

	public Vector3 resetPositionStage = new Vector3(0f, 1.2f, 0f);

	public Vector3 resetDirectionStage = new Vector3(0f, -45f, 0f);

	public Image tutoCloseButton;

	private DataManager dataManager;

	private int lobbyID;

	public TextAsset blank;

	private void Awake()
	{
		if (Singleton<MediaController>.Instance != null && Singleton<MediaController>.Instance != this)
		{
			UnityEngine.Object.Destroy(base.gameObject);
			return;
		}
		UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		SceneManager.sceneUnloaded += OnSceneUnLoaded;
		SceneManager.sceneLoaded += OnSceneLoaded;
		WebViewReady();
	}

	private void RegisterKeyboardEvent()
	{
		Singleton<Console>.Instance.keyboard.KeyboardReceiveEvent.AddListener(delegate(string s)
		{
			if (favoriteController != null && favoriteController.selectedInputField != null && favoriteController.selectedInputField.IsActive())
			{
				if (s == "Backspace")
				{
					BackspaceInputField();
				}
				else if (s == "Enter")
				{
					EnterInputField();
				}
				else
				{
					favoriteController.selectedInputField.text += s;
				}
			}
			else if (canvasWebViewPrefab != null)
			{
				canvasWebViewPrefab.WebView.HandleKeyboardInput(s);
			}
		});
	}

	private void BackspaceInputField()
	{
		if (favoriteController.selectedInputField.text.Length > 0)
		{
			string text = favoriteController.selectedInputField.text.Remove(favoriteController.selectedInputField.text.Length - 1, 1);
			favoriteController.selectedInputField.text = text;
		}
	}

	private void EnterInputField()
	{
		favoriteController.selectedInputField.gameObject.GetComponentInParent<FavoriteElement>().AddFavoriteUrl();
	}

	private void WebViewReady()
	{
		mediaPanels[1].SetActive(value: true);
		GetRendererAndCollider();
		mediaPanels[1].SetActive(value: false);
	}

	private void GetRendererAndCollider()
	{
		webViewPrefabView = GetComponentInChildren<WebViewPrefabView>(includeInactive: true);
		if (webViewPrefabView != null)
		{
			collider_WebView = webViewPrefabView.GetComponent<Collider>();
			meshrenderer_WebView = webViewPrefabView.GetComponent<MeshRenderer>();
		}
	}

	public void FullScreen()
	{
		if (!(canvasWebViewPrefab == null))
		{
			string url = canvasWebViewPrefab.WebView.Url;
			if (url.Contains("watch?v="))
			{
				string text = url.Replace("watch?v=", "embed/");
				UnityEngine.Debug.Log("Youtube URL = " + text);
				canvasWebViewPrefab.WebView.LoadUrl(text);
			}
		}
	}

	private void OnDestroy()
	{
		SceneManager.sceneUnloaded -= OnSceneUnLoaded;
		SceneManager.sceneLoaded -= OnSceneLoaded;
	}

	private void OnSceneLoaded(Scene scene, LoadSceneMode mode)
	{
		if (canvas_Media.worldCamera == null)
		{
			canvas_Media.worldCamera = Camera.main;
		}
		if (scene.name.ToLower().Contains("lobby"))
		{
			main = Singleton<Main>.Instance;
			LobbySetting();
			if (dataManager.userData.isMediaOn)
			{
				DisplayWebView();
				GetPositionAndRotation();
				GetDistanceAndScale();
			}
			RegisterKeyboardEvent();
		}
		else if (scene.name.ToLower().Contains("stage"))
		{
			main = Singleton<Main>.Instance;
			StageSetting();
			if (dataManager.userData.isMediaOn && !main.useTutorial)
			{
				DisplayWebView();
				GetPositionAndRotation();
				GetDistanceAndScale();
			}
			RegisterKeyboardEvent();
			if (main.useTutorial)
			{
				TurnOffMedia();
			}
		}
		else if (scene.name.ToLower().Contains("loading"))
		{
			mediaPanels[0].SetActive(value: false);
			HideWebView();
			TurnOffUpperPanel();
		}
		if (vrInputModule == null)
		{
			vrInputModule = UnityEngine.Object.FindObjectOfType<VRInputModule>();
		}
	}

	private void OnSceneUnLoaded(Scene scene)
	{
		HideWebView();
	}

	private void Update()
	{
		if (isPositionAdjustableL || isPositionAdjustableR)
		{
			ChangePosition(vrPointerPressed: true);
		}
		else
		{
			ChangePosition(vrPointerPressed: false);
		}
		if (isDistanceAdjustableL || isDistanceAdjustableR)
		{
			ChangeDistance();
		}
		if (isScaleAdjustableL || isScaleAdjustableR)
		{
			ChangeScale();
		}
		if (isWebViewScrollableL || isWebViewScrollableR)
		{
			ScrollWebView();
		}
		if (isAlphaAdjustable)
		{
			ChangeAlpha();
		}
		if (isColorAdjustable)
		{
			ChangeColor();
		}
		if (VRInput.bInputTriggerUp(VRInput.eController.mainhand))
		{
			if (isPositionAdjustableR)
			{
				isPositionAdjustableR = false;
			}
			if (isPositionAdjustableL)
			{
				isPositionAdjustableL = false;
			}
			if (isDistanceAdjustableR)
			{
				isDistanceAdjustableR = false;
			}
			if (isDistanceAdjustableL)
			{
				isDistanceAdjustableL = false;
			}
			if (isScaleAdjustableR)
			{
				isScaleAdjustableR = false;
			}
			if (isScaleAdjustableL)
			{
				isScaleAdjustableL = false;
			}
		}
		ShowAndHideUpperPanel();
		switch (main.scene)
		{
		case SceneState.LOBBY:
			if (VRInput.GetScreenButton())
			{
				if (!dataManager.userData.isMediaOn)
				{
					TurnOnMedia();
					Reposition(isReset: false);
					TurnOnUpperPanel();
					Singleton<Console>.Instance.buttonCheckMedia();
				}
				else if (dataManager.userData.isMediaOn)
				{
					TurnOffMedia();
					TurnOffUpperPanel();
					Singleton<Console>.Instance.buttonCheckMedia();
				}
			}
			break;
		case SceneState.STAGE:
			if (VRInput.GetScreenButton() && main.tutoControl.menu)
			{
				ClickMediaButton();
			}
			break;
		}
	}

	public void ClickMediaButton()
	{
		switch (main.scene)
		{
		case SceneState.LOBBY:
			ToggleMedia();
			break;
		case SceneState.STAGE:
			ToggleMedia();
			if (main.fishingControl.gameState == control_Fishing.EfishingState.ready && !dataManager.userData.isMediaOn && !main.fishingControl.isTackleGround)
			{
				main.handControl.setTackleGround(handReset: true);
			}
			break;
		}
	}

	public void Close()
	{
		TurnOffMedia();
		dataManager.userData.mediaState = 0;
		StopMusic();
		StopMedia();
		if (panelNoInternet.activeSelf)
		{
			panelNoInternet.SetActive(value: false);
		}
	}

	public void ToggleMedia()
	{
		dataManager.userData.isMediaOn = !dataManager.userData.isMediaOn;
		if (dataManager.userData.isMediaOn)
		{
			TurnOnMedia();
		}
		else
		{
			TurnOffMedia();
		}
	}

	public void TurnOffMedia()
	{
		if (main.useTutorial && main.tutoControl.tutoState == control_tutorial.tutorialState.media)
		{
			main.tutoControl.changeTutoState(control_tutorial.tutorialState.end);
		}
		TurnOffUpperPanel();
		mediaPanels[0].SetActive(value: false);
		HideWebView();
		dataManager.userData.isMediaOn = false;
	}

	public void TurnOnMedia()
	{
		if (main.useTutorial)
		{
			if (main.tutoControl.tutoState == control_tutorial.tutorialState.difficulty)
			{
				main.tutoControl.changeTutoState(control_tutorial.tutorialState.media);
			}
			if (!main.tutoControl.media)
			{
				return;
			}
		}
		TurnOnUpperPanel();
		if (dataManager.userData.mediaState == 0)
		{
			dataManager.userData.mediaState = 1;
			ActiveMedia(dataManager.userData.mediaState);
		}
		else
		{
			ActiveMedia(dataManager.userData.mediaState);
		}
		Reposition(isReset: false);
	}

	public void TurnOnUpperPanel()
	{
		upperPanel.SetActive(value: true);
	}

	public void TurnOffUpperPanel()
	{
		upperPanel.SetActive(value: false);
	}

	private void ShowAndHideUpperPanel()
	{
		if (!(vrInputModule != null))
		{
			return;
		}
		if (vrInputModule.raycasterStatusR == RaycasterStatus.Physics || vrInputModule.raycasterStatusR == RaycasterStatus.UI)
		{
			TimeStayed = 3f;
			if (upperPanelCanvasGroup.alpha != 1f)
			{
				upperPanelCanvasGroup.alpha = 1f;
			}
		}
		else if (upperPanel.activeSelf)
		{
			if (TimeStayed >= 0f)
			{
				TimeStayed -= Time.deltaTime;
			}
			else if (TimeStayed <= 0f && upperPanelCanvasGroup.alpha >= 0f)
			{
				upperPanelCanvasGroup.alpha -= Time.deltaTime;
			}
		}
	}

	public void ActiveMedia(int mediaState)
	{
		if (mediaState == 0)
		{
			TurnOffUpperPanel();
			mediaPanels[0].SetActive(value: false);
			HideWebView();
			TurnOffWebFunctions();
			ChangeMediaColors(mediaState);
			if (panelNoInternet.activeSelf)
			{
				panelNoInternet.SetActive(value: false);
			}
			return;
		}
		if (mediaState == 1)
		{
			TurnOnUpperPanel();
			mediaPanels[0].SetActive(value: true);
			dataManager.userData.isMediaOn = true;
			TurnOffWebFunctions();
			if (!dataManager.userData.ignoreInfoMusic)
			{
				TurnOnMusicInfoPanel();
			}
			ChangeMediaColors(mediaState);
			if (panelNoInternet.activeSelf)
			{
				panelNoInternet.SetActive(value: false);
			}
			return;
		}
		OnlineCheck.Check(delegate(bool isConnected, NetworkReachability b)
		{
			if (!isConnected)
			{
				panelNoInternet.SetActive(value: true);
			}
			else
			{
				panelNoInternet.SetActive(value: false);
				if (mediaState == 2 || mediaState == 3 || mediaState == 4 || mediaState == 5)
				{
					TurnOnUpperPanel();
					mediaPanels[0].SetActive(value: false);
					mediaPanels[1].SetActive(value: true);
					InstantiateWebView();
					DisplayWebView();
					TurnOnWebFunctions();
					dataManager.userData.isMediaOn = true;
					if (!dataManager.userData.ignoreInfoWeb)
					{
						TurnOnWebInfoPanel();
					}
					if (mediaState == 4)
					{
						webViewController.isWebViewOn = true;
					}
				}
				ChangeMediaColors(mediaState);
			}
		});
	}

	public void ActiveMedia(int mediaState, string initialUrl)
	{
		if (mediaState == 0)
		{
			TurnOffUpperPanel();
			mediaPanels[0].SetActive(value: false);
			HideWebView();
			TurnOffWebFunctions();
			ChangeMediaColors(mediaState);
			if (panelNoInternet.activeSelf)
			{
				panelNoInternet.SetActive(value: false);
			}
			return;
		}
		if (mediaState == 1)
		{
			TurnOnUpperPanel();
			mediaPanels[0].SetActive(value: true);
			dataManager.userData.isMediaOn = true;
			TurnOffWebFunctions();
			if (!dataManager.userData.ignoreInfoMusic)
			{
				TurnOnMusicInfoPanel();
			}
			ChangeMediaColors(mediaState);
			if (panelNoInternet.activeSelf)
			{
				panelNoInternet.SetActive(value: false);
			}
			return;
		}
		OnlineCheck.Check(delegate(bool isConnected, NetworkReachability b)
		{
			if (!isConnected)
			{
				panelNoInternet.SetActive(value: true);
			}
			else
			{
				panelNoInternet.SetActive(value: false);
				if (mediaState == 2 || mediaState == 3 || mediaState == 4 || mediaState == 5)
				{
					TurnOnUpperPanel();
					mediaPanels[0].SetActive(value: false);
					mediaPanels[1].SetActive(value: true);
					if (mediaState == 4)
					{
						dataManager.userData.mediaState = 4;
						webViewController.isWebViewOn = true;
						InstantiateWebView(initialUrl);
						ShowKeyboard();
					}
					else
					{
						InstantiateWebView();
					}
					DisplayWebView();
					TurnOnWebFunctions();
					if (!dataManager.userData.ignoreInfoWeb)
					{
						TurnOnWebInfoPanel();
					}
					dataManager.userData.isMediaOn = true;
				}
				ChangeMediaColors(mediaState);
			}
		});
	}

	private void ChangeMediaColors(int _mediaState)
	{
		for (int i = 0; i < mediaButtonImages.Length; i++)
		{
			switch (_mediaState)
			{
			case 0:
				mediaButtonImages[i].color = unselectedColor;
				break;
			case 1:
				if (i == 0)
				{
					mediaButtonImages[i].color = selectedColor;
				}
				else
				{
					mediaButtonImages[i].color = unselectedColor;
				}
				break;
			case 2:
				if (i == 1)
				{
					mediaButtonImages[i].color = selectedColor;
				}
				else
				{
					mediaButtonImages[i].color = unselectedColor;
				}
				break;
			case 3:
				if (i == 2)
				{
					mediaButtonImages[i].color = selectedColor;
				}
				else
				{
					mediaButtonImages[i].color = unselectedColor;
				}
				break;
			}
		}
	}

	private void PositionPivot()
	{
		Quaternion rotation = Quaternion.Euler(Camera.main.transform.eulerAngles.x, Camera.main.transform.eulerAngles.y, 0f);
		tr_pivot_FloatingMenu.SetPositionAndRotation(Camera.main.transform.position, rotation);
	}

	public void LobbySetting()
	{
		lobbyID = main.lobbyId;
		vrInputModule = main.vrInputModule;
		vrPlayerController = main.vrPlayerController;
		if (dataManager.userData.isMediaOn)
		{
			ActiveMedia(dataManager.userData.mediaState);
		}
		ChangeAnchor();
	}

	public void StageSetting()
	{
		vrInputModule = main.vrInputModule;
		vrFishingPlayerController = main.vrFishingPlayerController;
		if (dataManager.userData.rightHand)
		{
			vrFishingPointer = main.vrFishingPointerR;
		}
		else
		{
			vrFishingPointer = main.vrFishingPointerL;
		}
		if (dataManager.userData.isMediaOn && !main.useTutorial)
		{
			ActiveMedia(dataManager.userData.mediaState);
		}
		ChangeAnchor();
	}

	public void DisplayWebView()
	{
		if (collider_WebView != null && meshrenderer_WebView != null)
		{
			collider_WebView.enabled = true;
			meshrenderer_WebView.enabled = true;
		}
	}

	public void HideWebView()
	{
		if (collider_WebView != null && meshrenderer_WebView != null)
		{
			collider_WebView.enabled = false;
			meshrenderer_WebView.enabled = false;
		}
	}

	public void Hide()
	{
		if (dataManager.userData.mediaState == 1)
		{
			TurnOffUpperPanel();
			mediaPanels[0].SetActive(value: false);
			dataManager.userData.isMediaOn = false;
		}
		else if (dataManager.userData.mediaState == 2 || dataManager.userData.mediaState == 3 || dataManager.userData.mediaState == 4 || dataManager.userData.mediaState == 5)
		{
			TurnOffUpperPanel();
			HideWebView();
			dataManager.userData.isMediaOn = false;
		}
	}

	public void Reposition(bool isReset)
	{
		switch (main.scene)
		{
		case SceneState.LOBBY:
			if (!firstDone_Lobby)
			{
				Quaternion rotation4 = Quaternion.Euler(0f, Camera.main.transform.eulerAngles.y - 30f, 0f);
				tr_pivot_FloatingMenu.SetPositionAndRotation(Camera.main.transform.position, rotation4);
				tr_FloatingMenu.localPosition = new Vector3(0f, 0f, minDistance);
				tr_FloatingMenu.localScale = new Vector3(minScale, minScale, 0.001f);
				firstDone_Lobby = true;
			}
			else if (isReset)
			{
				Quaternion rotation5 = Quaternion.Euler(0f, Camera.main.transform.eulerAngles.y - 30f, 0f);
				tr_pivot_FloatingMenu.SetPositionAndRotation(Camera.main.transform.position, rotation5);
				tr_FloatingMenu.localPosition = new Vector3(0f, 0f, minDistance);
				tr_FloatingMenu.localScale = new Vector3(minScale, minScale, 0.001f);
				SetPositionAndRotation();
				SetDistance();
				SetScale();
			}
			else if (!isReset)
			{
				Quaternion rotation6 = Quaternion.Euler(Camera.main.transform.eulerAngles.x, Camera.main.transform.eulerAngles.y, 0f);
				tr_pivot_FloatingMenu.SetPositionAndRotation(Camera.main.transform.position, rotation6);
				tr_FloatingMenu.localPosition = new Vector3(0f, 0f, dataManager.userData.distanceLodges[lobbyID]);
				tr_FloatingMenu.localScale = new Vector3(dataManager.userData.scaleLodges[lobbyID], dataManager.userData.scaleLodges[lobbyID], 0.001f);
			}
			break;
		case SceneState.STAGE:
			if (main.useTutorial)
			{
				Quaternion rotation = Quaternion.Euler(Camera.main.transform.eulerAngles.x, -45f, 0f);
				tr_pivot_FloatingMenu.SetPositionAndRotation(Camera.main.transform.position, rotation);
				tr_FloatingMenu.localPosition = new Vector3(0f, 0f, minDistance);
				tr_FloatingMenu.localScale = new Vector3(minScale, minScale, 0.001f);
				SetPositionAndRotation();
			}
			else if (!firstDone_Stage)
			{
				Quaternion rotation2 = Quaternion.Euler(Camera.main.transform.eulerAngles.x, -45f, 0f);
				tr_pivot_FloatingMenu.SetPositionAndRotation(Camera.main.transform.position, rotation2);
				tr_FloatingMenu.localPosition = new Vector3(0f, 0f, minDistance);
				SetPositionAndRotation();
				firstDone_Stage = true;
			}
			else if (isReset)
			{
				new Vector3(0f, Camera.main.transform.position.y, 0f);
				Quaternion rotation3 = Quaternion.Euler(resetDirectionStage);
				tr_pivot_FloatingMenu.SetPositionAndRotation(Camera.main.transform.position, rotation3);
				tr_FloatingMenu.localPosition = new Vector3(0f, 0f, minDistance);
				tr_FloatingMenu.localScale = new Vector3(minScale, minScale, 0.001f);
				SetPositionAndRotation();
				SetDistance();
				SetScale();
			}
			else
			{
				tr_pivot_FloatingMenu.SetPositionAndRotation(Camera.main.transform.position, Quaternion.Euler(dataManager.userData.directionStage));
				tr_FloatingMenu.localPosition = new Vector3(0f, 0f, dataManager.userData.distanceStage);
				tr_FloatingMenu.localScale = new Vector3(dataManager.userData.scaleStage, dataManager.userData.scaleStage, 0.001f);
			}
			break;
		}
	}

	private void ChangePosition(bool vrPointerPressed)
	{
		if (vrPointerPressed)
		{
			curAnchorRotation = rotateAnchor.eulerAngles;
			if (preAnchorRotation.y != 0f)
			{
				float y = curAnchorRotation.y - preAnchorRotation.y;
				tr_pivot_FloatingMenu.eulerAngles += new Vector3(0f, y, 0f);
			}
			if (preAnchorRotation.x != 0f)
			{
				float x = curAnchorRotation.x - preAnchorRotation.x;
				tr_pivot_FloatingMenu.eulerAngles += new Vector3(x, 0f, 0f);
			}
			preAnchorRotation = curAnchorRotation;
			ChangeDistanceByThumbstick();
			LimitDistance();
			ChangeScaleByThumbstick();
			LimitScale();
			SetPositionAndRotation();
			SetDistance();
			SetScale();
		}
		else if (preAnchorRotation != Vector3.zero)
		{
			preAnchorRotation = Vector3.zero;
		}
	}

	private void GetPositionAndRotation()
	{
		switch (main.scene)
		{
		case SceneState.LOBBY:
		{
			Quaternion rotation2 = Quaternion.Euler(dataManager.userData.directionLodges[lobbyID].x, dataManager.userData.directionLodges[lobbyID].y, 0f);
			tr_pivot_FloatingMenu.SetPositionAndRotation(dataManager.userData.positionLodges[lobbyID], rotation2);
			break;
		}
		case SceneState.STAGE:
		{
			Quaternion rotation = Quaternion.Euler(dataManager.userData.directionStage.x, dataManager.userData.directionStage.y, 0f);
			tr_pivot_FloatingMenu.SetPositionAndRotation(dataManager.userData.positionStage, rotation);
			break;
		}
		}
	}

	private void GetDistanceAndScale()
	{
		switch (main.scene)
		{
		case SceneState.LOBBY:
			tr_FloatingMenu.localPosition = new Vector3(0f, 0f, dataManager.userData.distanceLodges[lobbyID]);
			tr_FloatingMenu.localScale = new Vector3(dataManager.userData.scaleLodges[lobbyID], dataManager.userData.scaleLodges[lobbyID], 0.001f);
			break;
		case SceneState.STAGE:
			tr_FloatingMenu.localPosition = new Vector3(0f, 0f, dataManager.userData.distanceStage);
			tr_FloatingMenu.localScale = new Vector3(dataManager.userData.scaleStage, dataManager.userData.scaleStage, 0.001f);
			break;
		}
	}

	private void SetPositionAndRotation()
	{
		switch (main.scene)
		{
		case SceneState.LOBBY:
			dataManager.userData.directionLodges[lobbyID] = tr_pivot_FloatingMenu.transform.eulerAngles;
			dataManager.userData.positionLodges[lobbyID] = tr_pivot_FloatingMenu.transform.position;
			break;
		case SceneState.STAGE:
			dataManager.userData.directionStage = tr_pivot_FloatingMenu.transform.eulerAngles;
			dataManager.userData.positionStage = tr_pivot_FloatingMenu.transform.position;
			break;
		}
	}

	private void ChangeDistance()
	{
		Vector3 vector = Vector3.zero;
		if (isDistanceAdjustableL)
		{
			vector = ((!dataManager.userData.bothHand) ? VRInput.GetLocalControllerAngularVelocity(VRInput.eController.mainhand) : (dataManager.userData.rightHand ? VRInput.GetLocalControllerAngularVelocity(VRInput.eController.subhand) : VRInput.GetLocalControllerAngularVelocity(VRInput.eController.mainhand)));
		}
		if (isDistanceAdjustableR)
		{
			vector = ((!dataManager.userData.bothHand) ? VRInput.GetLocalControllerAngularVelocity(VRInput.eController.mainhand) : (dataManager.userData.rightHand ? VRInput.GetLocalControllerAngularVelocity(VRInput.eController.mainhand) : VRInput.GetLocalControllerAngularVelocity(VRInput.eController.subhand)));
		}
		if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
		{
			vector *= 1f;
		}
		else if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
		{
			vector *= -1f;
		}
		else if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			vector *= -1f;
		}
		tr_FloatingMenu.localPosition += new Vector3(0f, 0f, vector.x * movingSpeedDegree);
		ChangeDistanceByThumbstick();
		LimitDistance();
		LimitScale();
		SetDistance();
		SetPositionAndRotation();
		SetScale();
	}

	private void ScalingByDistance()
	{
		float z = tr_FloatingMenu.localPosition.z;
		if (z >= distanceSizeThreshold)
		{
			float num = 0.0003f * z - 0.0005f;
			tr_FloatingMenu.localScale = new Vector3(num, num, 0.001f);
		}
	}

	private void ChangeDistanceByThumbstick()
	{
		Vector2 vector = Vector2.zero;
		if (isDistanceAdjustableByThumbstickL)
		{
			vector = ((!dataManager.userData.bothHand) ? VRInput.GetThumbstickData(VRInput.eController.mainhand) : (dataManager.userData.rightHand ? VRInput.GetThumbstickData(VRInput.eController.subhand) : VRInput.GetThumbstickData(VRInput.eController.mainhand)));
		}
		if (isDistanceAdjustableByThumbstickR)
		{
			vector = ((!dataManager.userData.bothHand) ? VRInput.GetThumbstickData(VRInput.eController.mainhand) : (dataManager.userData.rightHand ? VRInput.GetThumbstickData(VRInput.eController.mainhand) : VRInput.GetThumbstickData(VRInput.eController.subhand)));
		}
		float z = 0.1f;
		if (vector.y > thumbstickThreshold)
		{
			tr_FloatingMenu.localPosition += new Vector3(0f, 0f, z);
		}
		else if (vector.y < 0f - thumbstickThreshold)
		{
			tr_FloatingMenu.localPosition -= new Vector3(0f, 0f, z);
		}
	}

	private void LimitDistance()
	{
		if (tr_FloatingMenu.localPosition.z < minDistance)
		{
			tr_FloatingMenu.localPosition = new Vector3(tr_FloatingMenu.localPosition.x, tr_FloatingMenu.localPosition.y, minDistance);
		}
		else if (tr_FloatingMenu.localPosition.z > maxDistance)
		{
			tr_FloatingMenu.localPosition = new Vector3(tr_FloatingMenu.localPosition.x, tr_FloatingMenu.localPosition.y, maxDistance);
		}
	}

	private void SetDistance()
	{
		switch (main.scene)
		{
		case SceneState.LOBBY:
			dataManager.userData.distanceLodges[lobbyID] = tr_FloatingMenu.localPosition.z;
			break;
		case SceneState.STAGE:
			dataManager.userData.distanceStage = tr_FloatingMenu.localPosition.z;
			break;
		}
	}

	private void ChangeScale()
	{
		Vector3 vector = Vector3.zero;
		if (isScaleAdjustableL)
		{
			vector = ((!dataManager.userData.bothHand) ? VRInput.GetLocalControllerAngularVelocity(VRInput.eController.mainhand) : (dataManager.userData.rightHand ? VRInput.GetLocalControllerAngularVelocity(VRInput.eController.subhand) : VRInput.GetLocalControllerAngularVelocity(VRInput.eController.mainhand)));
		}
		if (isScaleAdjustableR)
		{
			vector = ((!dataManager.userData.bothHand) ? VRInput.GetLocalControllerAngularVelocity(VRInput.eController.mainhand) : (dataManager.userData.rightHand ? VRInput.GetLocalControllerAngularVelocity(VRInput.eController.mainhand) : VRInput.GetLocalControllerAngularVelocity(VRInput.eController.subhand)));
		}
		if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
		{
			vector *= 1f;
		}
		else if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
		{
			vector *= -1f;
		}
		else if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			vector *= -1f;
		}
		tr_FloatingMenu.localScale += new Vector3((0f - vector.x) * scalingDegree, (0f - vector.x) * scalingDegree, 0f);
		tr_FloatingMenu.localScale += new Vector3(vector.y * scalingDegree, vector.y * scalingDegree, 0f);
		ChangeScaleByThumbstick();
		LimitScale();
		SetScale();
		SetPositionAndRotation();
		SetDistance();
	}

	private void ChangeScaleByThumbstick()
	{
		Vector2 vector = Vector2.zero;
		if (isScaleAdjustableByThumbstickL)
		{
			vector = ((!dataManager.userData.bothHand) ? VRInput.GetThumbstickData(VRInput.eController.mainhand) : (dataManager.userData.rightHand ? VRInput.GetThumbstickData(VRInput.eController.subhand) : VRInput.GetThumbstickData(VRInput.eController.mainhand)));
		}
		if (isScaleAdjustableByThumbstickR)
		{
			vector = ((!dataManager.userData.bothHand) ? VRInput.GetThumbstickData(VRInput.eController.mainhand) : (dataManager.userData.rightHand ? VRInput.GetThumbstickData(VRInput.eController.mainhand) : VRInput.GetThumbstickData(VRInput.eController.subhand)));
		}
		float num = 5E-05f;
		if (vector.x >= thumbstickThreshold)
		{
			tr_FloatingMenu.localScale += new Vector3(num, num, 0f);
		}
		else if (vector.x <= 0f - thumbstickThreshold)
		{
			tr_FloatingMenu.localScale -= new Vector3(num, num, 0f);
		}
	}

	private void LimitScale()
	{
		float z = tr_FloatingMenu.localPosition.z;
		if (z >= distanceSizeThreshold)
		{
			float num = 0.0003f * z - 0.0005f;
			if (tr_FloatingMenu.localScale.x < num)
			{
				tr_FloatingMenu.localScale = new Vector3(num, num, 0.001f);
				return;
			}
		}
		if (tr_FloatingMenu.localScale.x > maxScale)
		{
			tr_FloatingMenu.localScale = new Vector3(maxScale, maxScale, tr_FloatingMenu.localScale.z);
		}
		else if (tr_FloatingMenu.localScale.x < minScale)
		{
			tr_FloatingMenu.localScale = new Vector3(minScale, minScale, tr_FloatingMenu.localScale.z);
		}
	}

	private void SetScale()
	{
		switch (main.scene)
		{
		case SceneState.LOBBY:
			dataManager.userData.scaleLodges[lobbyID] = tr_FloatingMenu.localScale.x;
			break;
		case SceneState.STAGE:
			dataManager.userData.scaleStage = tr_FloatingMenu.localScale.x;
			break;
		}
	}

	public void SwitchMedia(int _mediaState)
	{
		dataManager.userData.mediaState = _mediaState;
		ActiveMedia(dataManager.userData.mediaState);
		if (dataManager.userData.mediaState == 1)
		{
			StopMedia();
			if (favoriteController != null)
			{
				favoriteController.ShowPanel(show: false);
			}
		}
		else if (dataManager.userData.mediaState == 2)
		{
			LoadURL("https://www.youtube.com/");
			webViewController.isWebViewOn = true;
			StopMusic();
			ShowKeyboard();
		}
		else if (dataManager.userData.mediaState == 3)
		{
			LoadURL("https://open.spotify.com/");
			webViewController.isWebViewOn = true;
			StopMusic();
			ShowKeyboard();
		}
		else if (dataManager.userData.mediaState == 5)
		{
			LoadURL("https://music.youtube.com/");
			webViewController.isWebViewOn = true;
			StopMusic();
			ShowKeyboard();
		}
	}

	private void StopMedia()
	{
		if (canvasWebViewPrefab != null && webViewController.isWebViewOn)
		{
			DestroyWebView();
		}
	}

	public void StopMusic()
	{
		if (musicPlayerManager.IsPlaying)
		{
			musicPlayerManager.PlayButtonEvent();
		}
	}

	public void LoadURL(string url)
	{
		if (canvasWebViewPrefab != null && canvasWebViewPrefab.WebView != null)
		{
			canvasWebViewPrefab.WebView.LoadUrl(url);
		}
	}

	private void ShowKeyboard()
	{
		if (!Singleton<Main>.Instance.isMenuOn)
		{
			Singleton<Console>.Instance.ShowConsole();
		}
		Singleton<Console>.Instance.ClickMenu(-1);
		Singleton<Console>.Instance.ShowKeyboard();
	}

	public void Back()
	{
		if (canvasWebViewPrefab != null && canvasWebViewPrefab.WebView != null)
		{
			canvasWebViewPrefab.WebView.GoBack();
		}
	}

	public void Forward()
	{
		if (canvasWebViewPrefab != null && canvasWebViewPrefab.WebView != null)
		{
			canvasWebViewPrefab.WebView.GoForward();
		}
	}

	public void Refresh()
	{
		if (canvasWebViewPrefab != null && canvasWebViewPrefab.WebView != null)
		{
			canvasWebViewPrefab.WebView.Reload();
		}
	}

	public void AdjustScale()
	{
		settings[1].color = selectedColor;
	}

	public void StopAdjustingScale()
	{
		settings[1].color = unselectedColor;
	}

	public void AdjustDistance()
	{
		settings[2].color = selectedColor;
	}

	public void StopAdjustingDistance()
	{
		settings[2].color = unselectedColor;
	}

	public void AdjustPosition()
	{
		settings[3].color = selectedColor;
	}

	public void StopAdjustingPosition()
	{
		isPositionAdjustableR = false;
		settings[3].color = unselectedColor;
	}

	public void AdjustAlpha()
	{
		isAlphaAdjustable = true;
	}

	public void StopAdjustingAlpha()
	{
		isAlphaAdjustable = false;
	}

	public void AdjustColor()
	{
		isColorAdjustable = true;
	}

	public void StopAdjustingColor()
	{
		isColorAdjustable = false;
		panel_colorValue.SetActive(value: false);
	}

	public void DisposeALL()
	{
		canvasWebViewPrefab.WebView.Dispose();
	}

	public void DestroyWebView()
	{
		if (canvasWebViewPrefab != null)
		{
			UnityEngine.Object.Destroy(canvasWebViewPrefab.gameObject);
		}
		webViewController.isWebViewOn = false;
	}

	public void InstantiateWebView()
	{
		if (canvasWebViewPrefab == null)
		{
			UnityEngine.Debug.Log("InstantiateWebView!");
			GameObject gameObject = UnityEngine.Object.Instantiate(canvasWebViewPrefabObject, panelWebView);
			canvasWebViewPrefab = gameObject.GetComponent<CanvasWebViewPrefab>();
			webViewController.isWebViewOn = true;
			GetRendererAndCollider();
		}
	}

	public void InstantiateWebView(string initialUrl)
	{
		if (canvasWebViewPrefab == null)
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(canvasWebViewPrefabObject, panelWebView);
			canvasWebViewPrefab = gameObject.GetComponent<CanvasWebViewPrefab>();
			canvasWebViewPrefab.InitialUrl = initialUrl;
			webViewController.isWebViewOn = true;
			GetRendererAndCollider();
		}
	}

	public void ChangeAnchor()
	{
	}

	private void TurnOnWebFunctions()
	{
		WebFunctions.SetActive(value: true);
	}

	private void TurnOffWebFunctions()
	{
		WebFunctions.SetActive(value: false);
	}

	private void TurnOnMusicInfoPanel()
	{
		musicInfoPanel.SetActive(value: true);
		if (webInfoPanel.activeSelf)
		{
			TurnOffWebInfoPanel();
		}
	}

	public void TurnOffMusicInfoPanel()
	{
		musicInfoPanel.SetActive(value: false);
		dataManager.userData.ignoreInfoMusic = true;
		dataManager.Save();
	}

	private void TurnOnWebInfoPanel()
	{
		webInfoPanel.SetActive(value: true);
		if (musicInfoPanel.activeSelf)
		{
			TurnOffMusicInfoPanel();
		}
	}

	public void TurnOffWebInfoPanel()
	{
		webInfoPanel.SetActive(value: false);
		dataManager.userData.ignoreInfoWeb = true;
		dataManager.Save();
	}

	public void ClearBrowsingDataPopUpEvent()
	{
		clearCacheBrowsingDataPanel.SetActive(value: true);
	}

	public void TurnOffClearBrowsingDataEvent()
	{
		clearCacheBrowsingDataPanel.SetActive(value: false);
	}

	public void ClearBrowsingDataEvent()
	{
		UnityEngine.Debug.Log("Clear Browing data");
		Web.ClearAllData();
		clearCacheBrowsingDataPanel.SetActive(value: false);
	}

	public void ScrollWebView()
	{
		if (isDistanceAdjustableR || isDistanceAdjustableL || isPositionAdjustableR || isPositionAdjustableL || isScaleAdjustableR || isScaleAdjustableL || isAlphaAdjustable || isColorAdjustable)
		{
			return;
		}
		Vector2 vector = Vector2.zero;
		if (dataManager.userData.bothHand)
		{
			if (VRInput.Touch_Down_Stay(VRInput.eController.mainhand) || VRInput.Touch_Up_Stay(VRInput.eController.mainhand))
			{
				vector = VRInput.GetThumbstickData(VRInput.eController.mainhand);
			}
			else if (VRInput.Touch_Down_Stay(VRInput.eController.subhand) || VRInput.Touch_Up_Stay(VRInput.eController.subhand))
			{
				vector = VRInput.GetThumbstickData(VRInput.eController.subhand);
			}
		}
		else
		{
			vector = VRInput.GetThumbstickData(VRInput.eController.mainhand);
		}
		if (canvasWebViewPrefab != null)
		{
			if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
			{
				scrollPower = 6f;
			}
			if (Mathf.Abs(vector.x) > scrollThreshold)
			{
				canvasWebViewPrefab.WebView.Scroll(-vector * scrollPower);
			}
			if (Mathf.Abs(vector.y) > scrollThreshold)
			{
				canvasWebViewPrefab.WebView.Scroll(-vector * scrollPower);
			}
		}
	}

	public void ChangeAlpha()
	{
		if (!(meshrenderer_WebView == null))
		{
			webViewMateiral = meshrenderer_WebView.sharedMaterial;
			Vector4 currentColor = webViewMateiral.GetColor("_MainColor");
			Vector3 localControllerAngularVelocity = VRInput.GetLocalControllerAngularVelocity(VRInput.eController.mainhand);
			if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
			{
				currentColor += new Vector4(0f, 0f, 0f, (0f - localControllerAngularVelocity.x) * alphaChangePower);
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
			{
				currentColor += new Vector4(0f, 0f, 0f, localControllerAngularVelocity.x * alphaChangePower);
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.GO)
			{
				currentColor += new Vector4(0f, 0f, 0f, localControllerAngularVelocity.x * alphaChangePower);
			}
			Vector2 thumbstickData = VRInput.GetThumbstickData(VRInput.eController.mainhand);
			currentColor += new Vector4(0f, 0f, 0f, thumbstickData.x * alphaChangePower / 2f);
			currentColor += new Vector4(0f, 0f, 0f, thumbstickData.y * alphaChangePower / 2f);
			Vector4 vector = LimitAlpha(currentColor);
			webViewMateiral.SetColor("_MainColor", vector);
		}
	}

	private Vector4 LimitAlpha(Vector4 currentColor)
	{
		if (currentColor.w > alphaMax)
		{
			currentColor = new Vector4(currentColor.x, currentColor.y, currentColor.z, alphaMax);
			return currentColor;
		}
		if (currentColor.w < alphaMin)
		{
			currentColor = new Vector4(currentColor.x, currentColor.y, currentColor.z, alphaMin);
			return currentColor;
		}
		return currentColor;
	}

	public void ChangeColor()
	{
		if (!(meshrenderer_WebView == null))
		{
			webViewMateiral = meshrenderer_WebView.sharedMaterial;
			Vector4 currentColor = webViewMateiral.GetColor("_MainColor");
			Vector3 localControllerAngularVelocity = VRInput.GetLocalControllerAngularVelocity(VRInput.eController.mainhand);
			localControllerAngularVelocity *= colorChangePower;
			if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
			{
				currentColor += new Vector4(0f - localControllerAngularVelocity.x, 0f - localControllerAngularVelocity.x, 0f - localControllerAngularVelocity.x, 0f);
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
			{
				currentColor += new Vector4(localControllerAngularVelocity.x, localControllerAngularVelocity.x, localControllerAngularVelocity.x, 0f);
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.GO)
			{
				currentColor += new Vector4(localControllerAngularVelocity.x, localControllerAngularVelocity.x, localControllerAngularVelocity.x, 0f);
			}
			Vector2 thumbstickData = VRInput.GetThumbstickData(VRInput.eController.mainhand);
			thumbstickData *= colorChangePower;
			currentColor += new Vector4(thumbstickData.x, thumbstickData.x, thumbstickData.x, 0f);
			currentColor += new Vector4(thumbstickData.y, thumbstickData.y, thumbstickData.y, 0f);
			Vector4 vector = LimitColor(currentColor);
			webViewMateiral.SetColor("_MainColor", vector);
			int num = Mathf.RoundToInt(11f * vector.x - 1.25f);
			panel_colorValue.SetActive(value: true);
			text_colorValue.text = num.ToString();
		}
	}

	private Vector4 LimitColor(Vector4 currentColor)
	{
		if (currentColor.x > colorMax)
		{
			currentColor = new Vector4(colorMax, colorMax, colorMax, currentColor.w);
			return currentColor;
		}
		if (currentColor.x < colorMin)
		{
			currentColor = new Vector4(colorMin, colorMin, colorMin, currentColor.w);
			return currentColor;
		}
		return currentColor;
	}
}
public enum Status
{
	None,
	Screen,
	Radar
}
public class MenuController : MonoBehaviour
{
	public Status currentStatus;

	private control_Fishing fishingControl;

	public Transform cameraTransform;

	[Header("FloatingMenu")]
	public CanvasWebViewPrefab canvasWebViewPrefab;

	public GameObject floatingMenu;

	private Transform transformFloatingMenu;

	public float floatingMenuStartDistance_z = 1f;

	public GameObject[] hidingMenus;

	[Header("FloatingMenu Movement")]
	public Transform pivot_floatingMenu;

	public float startHeight = 1.8f;

	public float floatingMenuMovingDistance_z = 0.5f;

	public float floatingMenuMovingRotation_y = 15f;

	public float floatingMenuMovingRotation_x = 15f;

	public float floatingMenuScaleDegree = 1.5f;

	private bool isShowingFloatingMenu;

	public Transform anchor;

	public Vector3 curAnchorRotation;

	public Vector3 preAnchorRotation;

	[Header("UIs")]
	public GameObject[] menus;

	public Image[] menuIconImages;

	public Color unselectedColor;

	public Color selectedColor;

	public Image toggle_ShowFloatingMenu;

	public Sprite[] toggleSprites;

	public VRFishingPointer vrFishingPointer;

	private Main main;

	private void Awake()
	{
		main = Singleton<Main>.Instance;
		fishingControl = main.fishingControl;
	}

	private void Start()
	{
		transformFloatingMenu = floatingMenu.GetComponent<Transform>();
		floatingMenu.SetActive(value: false);
	}

	private void Update()
	{
		Process();
		RotateFloatingMenu();
	}

	private void Process()
	{
		if (currentStatus == Status.None)
		{
			if (fishingControl.gameState == control_Fishing.EfishingState.ready && VRInput.GetScreenButton())
			{
				floatingMenu.SetActive(value: true);
				vrFishingPointer.isRaycastingLineDrawing = true;
				if (!isShowingFloatingMenu)
				{
					ResetFloatingMenu();
				}
				for (int i = 0; i < hidingMenus.Length; i++)
				{
					hidingMenus[i].SetActive(value: true);
				}
				currentStatus = Status.Screen;
			}
		}
		else if (currentStatus == Status.Screen)
		{
			if (VRInput.GetScreenButton())
			{
				currentStatus = Status.None;
				HideMenu();
			}
		}
		else
		{
			_ = currentStatus;
			_ = 2;
		}
	}

	private void RotateFloatingMenu()
	{
		if (vrFishingPointer.pressed)
		{
			curAnchorRotation = anchor.eulerAngles;
			if (preAnchorRotation.y != 0f)
			{
				float y = curAnchorRotation.y - preAnchorRotation.y;
				pivot_floatingMenu.eulerAngles += new Vector3(0f, y, 0f);
				UnityEngine.Debug.Log("Rotation 된다!!");
			}
			if (preAnchorRotation.x != 0f)
			{
				float x = curAnchorRotation.x - preAnchorRotation.x;
				pivot_floatingMenu.eulerAngles += new Vector3(x, 0f, 0f);
			}
			preAnchorRotation = curAnchorRotation;
		}
		else if (!vrFishingPointer.pressed)
		{
			preAnchorRotation = Vector3.zero;
		}
	}

	private void HideMenu()
	{
		if (isShowingFloatingMenu)
		{
			for (int i = 0; i < hidingMenus.Length; i++)
			{
				hidingMenus[i].SetActive(value: false);
			}
		}
		else if (!isShowingFloatingMenu)
		{
			floatingMenu.SetActive(value: false);
		}
	}

	public void ResetFloatingMenu()
	{
		pivot_floatingMenu.localPosition = cameraTransform.position;
		pivot_floatingMenu.localEulerAngles = new Vector3(cameraTransform.eulerAngles.x, cameraTransform.eulerAngles.y, 0f);
		transformFloatingMenu.localPosition = new Vector3(0f, 0f, floatingMenuStartDistance_z);
	}

	public void MoveFloatingMenu(string direction)
	{
		switch (direction)
		{
		case "RIGHT":
			pivot_floatingMenu.localEulerAngles += new Vector3(0f, floatingMenuMovingRotation_y, 0f);
			break;
		case "LEFT":
			pivot_floatingMenu.localEulerAngles -= new Vector3(0f, floatingMenuMovingRotation_x, 0f);
			break;
		case "UP":
			pivot_floatingMenu.localEulerAngles -= new Vector3(floatingMenuMovingRotation_x, 0f, 0f);
			break;
		case "DOWN":
			pivot_floatingMenu.localEulerAngles += new Vector3(floatingMenuMovingRotation_x, 0f, 0f);
			break;
		case "FURTHER":
			transformFloatingMenu.localPosition += new Vector3(0f, 0f, floatingMenuMovingDistance_z);
			break;
		case "CLOSER":
			transformFloatingMenu.localPosition -= new Vector3(0f, 0f, floatingMenuMovingDistance_z);
			break;
		case "LARGE":
			transformFloatingMenu.localScale *= floatingMenuScaleDegree;
			break;
		case "SMALL":
			transformFloatingMenu.localScale /= floatingMenuScaleDegree;
			break;
		}
	}

	public void MenuClick(int menuIndex)
	{
		for (int i = 0; i < menus.Length; i++)
		{
			if (i == menuIndex)
			{
				menus[i].SetActive(value: true);
				menuIconImages[i].color = selectedColor;
			}
			else
			{
				menus[i].SetActive(value: false);
				menuIconImages[i].color = unselectedColor;
			}
		}
	}

	public void Toggle_isShowingFloatingMenu()
	{
		if (!isShowingFloatingMenu)
		{
			toggle_ShowFloatingMenu.sprite = toggleSprites[1];
		}
		else if (isShowingFloatingMenu)
		{
			toggle_ShowFloatingMenu.sprite = toggleSprites[0];
		}
		isShowingFloatingMenu = !isShowingFloatingMenu;
	}

	public void LoadURL(string url)
	{
		canvasWebViewPrefab.WebView.LoadUrl(url);
	}
}
public class RVRFGrabbable : MonoBehaviour
{
	public Collider[] _grabColliders;

	public bool hasSnapPosition;

	[Header("DistanceGrab")]
	public bool isDistanceGrabbable;

	public float distanceGrabJumpPower;

	public float catchTime = 0.3f;

	public Ease ease = Ease.InQuint;

	protected RVRFGrabber _grabbedBy;

	protected Collider _grabbedCollider;

	protected bool _isKinematicSet;

	private LiquidSineAnim getLiquidSineAnim;

	[HideInInspector]
	public bool isDetected;

	private Shader outlineShader_Store;

	private Shader selfShader_Store;

	public Collider[] grabColliders => _grabColliders;

	public bool isGrabbed => _grabbedBy != null;

	public RVRFGrabber grabbedBy => _grabbedBy;

	private void Awake()
	{
		if (_grabColliders.Length == 0)
		{
			Collider component = GetComponent<Collider>();
			if (component == null)
			{
				throw new ArgumentException("RVRFGrabbable needs to have at least one collider");
			}
			_grabColliders = new Collider[1] { component };
		}
		getLiquidSineAnim = GameObject.Find("Console_Manager").GetComponent<LiquidSineAnim>();
		outlineShader_Store = getLiquidSineAnim.outlineShader;
		selfShader_Store = GetComponentInChildren<Renderer>().material.shader;
	}

	private void Start()
	{
		_isKinematicSet = GetComponent<Rigidbody>().isKinematic;
		Invoke("AutoDisable", 60f);
	}

	private void AutoDisable()
	{
		if (_grabbedBy == null)
		{
			base.gameObject.SetActive(value: false);
		}
		else
		{
			Invoke("AutoDisable", 60f);
		}
	}

	public virtual void GrabBegin(RVRFGrabber grabber, Collider grabCollider)
	{
		_grabbedBy = grabber;
		_grabbedCollider = grabCollider;
		base.gameObject.GetComponent<Rigidbody>().isKinematic = true;
	}

	public virtual void GrabEnd(Vector3 linearVelocity, Vector3 angularVelocity)
	{
		Rigidbody component = base.gameObject.GetComponent<Rigidbody>();
		component.isKinematic = false;
		if (component.gameObject.GetComponent<floatingOBJ>() != null)
		{
			if (Singleton<Main>.Instance.scene == SceneState.LOBBY)
			{
				component.velocity = Singleton<Main>.Instance.vrPlayerController.ovrCameraRig.transform.TransformDirection(linearVelocity * 0.5f);
				component.angularVelocity = Singleton<Main>.Instance.vrPlayerController.ovrCameraRig.transform.TransformDirection(angularVelocity * 0.5f);
				if ((bool)component.gameObject.GetComponent<floatingOBJ>())
				{
					component.GetComponent<floatingOBJ>().isHandRelease = true;
				}
			}
			else if (Singleton<Main>.Instance.scene == SceneState.STAGE)
			{
				component.velocity = Singleton<Main>.Instance.vrFishingPlayerController.ovrCameraRig.transform.TransformDirection(linearVelocity * 0.5f);
				component.angularVelocity = Singleton<Main>.Instance.vrFishingPlayerController.ovrCameraRig.transform.TransformDirection(angularVelocity * 0.5f);
				if ((bool)component.gameObject.GetComponent<floatingOBJ>())
				{
					component.GetComponent<floatingOBJ>().isHandRelease = true;
				}
			}
		}
		else if (Singleton<Main>.Instance.scene == SceneState.LOBBY)
		{
			component.velocity = Singleton<Main>.Instance.vrPlayerController.ovrCameraRig.transform.TransformDirection(linearVelocity);
			component.angularVelocity = Singleton<Main>.Instance.vrPlayerController.ovrCameraRig.transform.TransformDirection(angularVelocity);
		}
		else if (Singleton<Main>.Instance.scene == SceneState.STAGE)
		{
			component.velocity = Singleton<Main>.Instance.vrFishingPlayerController.ovrCameraRig.transform.TransformDirection(linearVelocity);
			component.angularVelocity = Singleton<Main>.Instance.vrFishingPlayerController.ovrCameraRig.transform.TransformDirection(angularVelocity);
		}
		_grabbedBy = null;
		_grabbedCollider = null;
	}

	private void Update()
	{
		if (!isDetected && GetComponentInChildren<Renderer>().material.shader != selfShader_Store)
		{
			GetComponentInChildren<Renderer>().material.shader = selfShader_Store;
		}
		else if (isDetected && GetComponentInChildren<Renderer>().material.shader != outlineShader_Store)
		{
			GetComponentInChildren<Renderer>().material.shader = outlineShader_Store;
		}
	}
}
public class RVRFGrabber : MonoBehaviour
{
	public VRInput.Hand hand;

	public Transform defaultGrabTransform;

	public Transform snapTransform;

	[HideInInspector]
	public RVRFGrabbable _grabbedObject;

	protected Dictionary<RVRFGrabbable, int> grabCandidates = new Dictionary<RVRFGrabbable, int>();

	private VRPointerBase vrPointer;

	private DataManager dataManager;

	private Main main;

	public RVRFGrabbable grabbedObject => _grabbedObject;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
		if (defaultGrabTransform == null)
		{
			defaultGrabTransform = base.transform;
		}
		if (snapTransform == null)
		{
			snapTransform = base.transform;
		}
		if (main.scene == SceneState.STAGE)
		{
			vrPointer = base.transform.GetComponentInParent<VRFishingPointer>();
		}
		else if (main.scene == SceneState.LOBBY)
		{
			vrPointer = base.transform.GetComponentInParent<VRLobbyPointer>();
		}
	}

	private void Update()
	{
		switch (main.scene)
		{
		case SceneState.LOBBY:
			if (VRInput.InputGrabDown(hand))
			{
				if (_grabbedObject != null)
				{
					break;
				}
				GrabBegin();
				DistanceGrabBegin();
				if (((VRLobbyPointer)vrPointer).DetectBranchStack() != null)
				{
					GameObject gameObject2 = ((VRLobbyPointer)vrPointer).DetectBranchStack().TakeOutBranch(base.transform.position, Quaternion.identity);
					_grabbedObject = gameObject2.GetComponent<Branch>();
					_grabbedObject.GrabBegin(this, gameObject2.GetComponent<Collider>());
					_grabbedObject.transform.parent = base.transform;
				}
				SelectInventoryItem(hand);
			}
			if (VRInput.InputGrabUp(hand))
			{
				GrabEnd();
			}
			break;
		case SceneState.STAGE:
			if (VRInput.InputGrabDown(hand))
			{
				if (main.fishingControl.gameState != 0 || _grabbedObject != null)
				{
					break;
				}
				GrabBegin();
				DistanceGrabBegin();
				if (((VRFishingPointer)vrPointer).DetectBranchStack() != null)
				{
					GameObject gameObject = ((VRFishingPointer)vrPointer).DetectBranchStack().TakeOutBranch(base.transform.position, Quaternion.identity);
					_grabbedObject = gameObject.GetComponent<RVRFGrabbable>();
					_grabbedObject.GrabBegin(this, gameObject.GetComponent<Collider>());
					_grabbedObject.transform.parent = base.transform;
					if (main.isOceanBreezeStage)
					{
						main.stuffControl.isGrabItem = true;
					}
					main.handControl.setTackleGround(handReset: true);
				}
				SelectInventoryItem(hand);
			}
			if (VRInput.InputGrabUp(hand))
			{
				GrabEnd();
			}
			break;
		}
	}

	private void GrabBegin()
	{
		if (_grabbedObject != null)
		{
			return;
		}
		float num = float.MaxValue;
		RVRFGrabbable rVRFGrabbable = null;
		Collider grabCollider = null;
		foreach (RVRFGrabbable key in grabCandidates.Keys)
		{
			UnityEngine.Debug.Log("grabbable object is " + key.gameObject.name);
			for (int i = 0; i < key.grabColliders.Length; i++)
			{
				Collider collider = key.grabColliders[i];
				if (collider != null)
				{
					Vector3 vector = collider.ClosestPointOnBounds(defaultGrabTransform.position);
					float sqrMagnitude = (defaultGrabTransform.position - vector).sqrMagnitude;
					if (sqrMagnitude < num)
					{
						num = sqrMagnitude;
						rVRFGrabbable = key;
						grabCollider = collider;
					}
				}
			}
		}
		if (!(rVRFGrabbable != null))
		{
			return;
		}
		_grabbedObject = rVRFGrabbable;
		_grabbedObject.GrabBegin(this, grabCollider);
		_grabbedObject.transform.parent = base.transform;
		if (main.scene == SceneState.STAGE)
		{
			if (main.isOceanBreezeStage)
			{
				main.stuffControl.isGrabItem = true;
			}
			main.handControl.setTackleGround(handReset: true);
		}
		if (_grabbedObject.hasSnapPosition)
		{
			SnapPositionAndRotation();
		}
	}

	private void DistanceGrabBegin()
	{
		if (_grabbedObject != null)
		{
			return;
		}
		Collider grabCollider = null;
		if (main.scene == SceneState.LOBBY)
		{
			if (!((VRLobbyPointer)vrPointer).IsDistanceGrabbable())
			{
				return;
			}
			_grabbedObject = ((VRLobbyPointer)vrPointer).DetectDistanceGrabbable();
			grabCollider = _grabbedObject.GetComponent<Collider>();
		}
		else if (main.scene == SceneState.STAGE)
		{
			if (!((VRFishingPointer)vrPointer).IsDistanceGrabbable())
			{
				return;
			}
			_grabbedObject = ((VRFishingPointer)vrPointer).DetectDistanceGrabbable();
			grabCollider = _grabbedObject.GetComponent<Collider>();
		}
		_grabbedObject.GrabBegin(this, grabCollider);
		_grabbedObject.transform.parent = base.transform;
		if (main.scene == SceneState.STAGE)
		{
			if (main.isOceanBreezeStage)
			{
				main.stuffControl.isGrabItem = true;
			}
			main.handControl.setTackleGround(handReset: true);
		}
		if (_grabbedObject.hasSnapPosition)
		{
			_grabbedObject.transform.DOJump(defaultGrabTransform.position, _grabbedObject.distanceGrabJumpPower, 1, _grabbedObject.catchTime).SetEase(_grabbedObject.ease).OnComplete(SnapPositionAndRotation);
		}
		else
		{
			_grabbedObject.transform.DOJump(defaultGrabTransform.position, _grabbedObject.distanceGrabJumpPower, 1, _grabbedObject.catchTime).SetEase(_grabbedObject.ease);
		}
	}

	private void SnapPositionAndRotation()
	{
		_grabbedObject.transform.SetPositionAndRotation(snapTransform.position, snapTransform.rotation);
	}

	private void GrabEnd()
	{
		if (_grabbedObject != null)
		{
			ReleaseGrabbable();
		}
	}

	private void ReleaseGrabbable()
	{
		Vector3 vector = Vector3.zero;
		Vector3 vector2 = Vector3.zero;
		if (hand == VRInput.Hand.LEFT)
		{
			vector = VRInput.GetLocalControllerVelocity(VRInput.Hand.LEFT);
			vector2 = VRInput.GetLocalControllerAngularVelocity(VRInput.Hand.LEFT);
		}
		else if (hand == VRInput.Hand.RIGHT)
		{
			vector = VRInput.GetLocalControllerVelocity(VRInput.Hand.RIGHT);
			vector2 = VRInput.GetLocalControllerAngularVelocity(VRInput.Hand.RIGHT);
		}
		_grabbedObject.transform.parent = null;
		if (_grabbedObject.isDistanceGrabbable)
		{
			_grabbedObject.transform.DOPause();
		}
		_grabbedObject.GrabEnd(vector * 2f, vector2 * 2f);
		_grabbedObject = null;
		grabCandidates.Clear();
		if (main.isOceanBreezeStage)
		{
			main.stuffControl.isGrabItem = false;
		}
	}

	private void SelectInventoryItem(VRInput.Hand hand)
	{
		switch (hand)
		{
		case VRInput.Hand.LEFT:
			if (main.vrInputModule.gameObjectOverL != null && main.vrInputModule.gameObjectOverL.GetComponent<InventoryItem>() != null)
			{
				main.vrInputModule.gameObjectOverL.GetComponent<InventoryItem>().OnGrab(defaultGrabTransform);
			}
			break;
		case VRInput.Hand.RIGHT:
			if (main.vrInputModule.gameObjectOverR != null && main.vrInputModule.gameObjectOverR.GetComponent<InventoryItem>() != null)
			{
				main.vrInputModule.gameObjectOverR.GetComponent<InventoryItem>().OnGrab(defaultGrabTransform);
			}
			break;
		}
	}

	private void OnTriggerEnter(Collider other)
	{
		RVRFGrabbable rVRFGrabbable = other.GetComponent<RVRFGrabbable>() ?? other.GetComponentInParent<RVRFGrabbable>();
		if (!(rVRFGrabbable == null))
		{
			int value = 0;
			grabCandidates.TryGetValue(rVRFGrabbable, out value);
			grabCandidates[rVRFGrabbable] = value + 1;
			if ((bool)rVRFGrabbable.GetComponentInChildren<bulletShoot>())
			{
				rVRFGrabbable.GetComponentInChildren<bulletShoot>().isGunGrabbed = true;
			}
		}
	}

	private void OnTriggerExit(Collider other)
	{
		RVRFGrabbable rVRFGrabbable = other.GetComponent<RVRFGrabbable>() ?? other.GetComponentInParent<RVRFGrabbable>();
		if (rVRFGrabbable == null)
		{
			return;
		}
		int value = 0;
		if (grabCandidates.TryGetValue(rVRFGrabbable, out value))
		{
			if (value > 1)
			{
				grabCandidates[rVRFGrabbable] = value - 1;
			}
			else
			{
				grabCandidates.Remove(rVRFGrabbable);
			}
			if ((bool)rVRFGrabbable.GetComponentInChildren<bulletShoot>() && rVRFGrabbable.grabbedBy == null)
			{
				rVRFGrabbable.GetComponentInChildren<bulletShoot>().isGunGrabbed = false;
			}
		}
	}
}
public class VolumeController : MonoBehaviour
{
	public Slider slider;

	public TextAsset volumeJS;

	private Main main;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
	}

	private void OnEnable()
	{
		if (Singleton<Main>.Instance != null)
		{
			main = Singleton<Main>.Instance;
		}
		slider.value = (float)dataManager.userData.volumeMusic * 0.1f;
	}

	private void OnDisable()
	{
	}

	public void SetVolumeUpEvent()
	{
		float num = (float)dataManager.userData.volumeMusic * 0.1f + 0.1f;
		if (num > 1f)
		{
			num = 1f;
		}
		slider.value = num;
		int num2 = dataManager.userData.volumeMusic + 1;
		if (num2 > 10)
		{
			num2 = 10;
		}
		if (main.scene == SceneState.LOBBY)
		{
			main.lobbyUIManager.SetMusicVolume(num2);
		}
		else
		{
			main.soundControl.setMusicVolume(num2);
		}
	}

	public void SetVolumeDownEvent()
	{
		float num = (float)dataManager.userData.volumeMusic * 0.1f - 0.1f;
		if (num < 0f)
		{
			num = 0f;
		}
		slider.value = num;
		int num2 = dataManager.userData.volumeMusic - 1;
		if (num2 < 0)
		{
			num2 = 0;
		}
		if (main.scene == SceneState.LOBBY)
		{
			main.lobbyUIManager.SetMusicVolume(num2);
		}
		else
		{
			main.soundControl.setMusicVolume(num2);
		}
	}
}
public class WebViewController : MonoBehaviour
{
	public bool isWebViewOn;

	public GameObject panel_WebViewElement;

	public GameObject panel_Spotify;

	private void OnEnable()
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT)
		{
			panel_Spotify.SetActive(value: false);
		}
	}

	public void OpenAndCloseWebViewElements()
	{
		if (panel_WebViewElement.activeSelf)
		{
			panel_WebViewElement.SetActive(value: false);
		}
		else
		{
			panel_WebViewElement.SetActive(value: true);
		}
	}
}
public class delayTurnon : MonoBehaviour
{
	public float onTime = 1f;

	public GameObject onObject;

	private void Start()
	{
		StartCoroutine(turnOn());
	}

	private IEnumerator turnOn()
	{
		yield return new WaitForSeconds(onTime);
		onObject.SetActive(value: true);
	}
}
public class distanceScale : MonoBehaviour
{
	public float ScaleBaseDistance = 20f;

	public float baseScale = 1f;

	public bool realtimeScale = true;

	private void Start()
	{
		baseScale = base.transform.localScale.x;
		float num = baseScale + base.transform.position.z * ScaleBaseDistance;
		base.transform.localScale = new Vector3(num, num, num);
	}

	private void Update()
	{
		if (realtimeScale)
		{
			float num = baseScale + base.transform.position.z * ScaleBaseDistance;
			base.transform.localScale = new Vector3(num, num, num);
		}
	}
}
public class effectCircle : MonoBehaviour
{
	private Main main;

	private control_tackle tackleCon;

	private control_Fishing fishingCon;

	private control_Lure lureCon;

	private control_envrionment envCon;

	private control_gpoint gpControl;

	private control_handselect handControl;

	public float speed = 2f;

	public float effectCycle = 2f;

	private Material material;

	private Renderer render;

	private IEnumerator cEffect;

	private IEnumerator cBiteHaptic;

	private void Awake()
	{
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
		render = GetComponent<Renderer>();
		material = render.material;
		tackleCon = main.tackleControl;
		fishingCon = main.fishingControl;
		lureCon = main.lureControl;
		envCon = main.envControl;
		gpControl = main.gpointControl;
		handControl = main.handControl;
		render.enabled = false;
	}

	public void create()
	{
		stop();
		if (new Vector2(base.transform.position.x, base.transform.position.z).sqrMagnitude > gpControl.fishLimitDistFromPlayer * gpControl.fishLimitDistFromPlayer)
		{
			cEffect = effectDo();
			StartCoroutine(cEffect);
			cBiteHaptic = HapticBite();
			StartCoroutine(cBiteHaptic);
		}
	}

	public void stop()
	{
		if (cEffect != null)
		{
			StopCoroutine(cEffect);
			render.enabled = false;
		}
		if (cBiteHaptic != null)
		{
			StopCoroutine(cBiteHaptic);
		}
	}

	private IEnumerator HapticBite()
	{
		while (true)
		{
			if (fishingCon.isAttactedFish)
			{
				handControl.haptic(0.1f, 0.15f, isMainhand: true);
				tackleCon.bendAniBite = 0.02f;
				yield return new WaitForSeconds(0.1f);
				tackleCon.bendAniBite = 0f;
			}
			yield return new WaitForSeconds(UnityEngine.Random.Range(0.5f, 3f));
		}
	}

	private IEnumerator effectDo()
	{
		do
		{
			render.enabled = true;
			float grow = 0f;
			while (grow <= 1f)
			{
				base.transform.position = new Vector3(lureCon.transform.position.x, envCon.water_Height, lureCon.transform.position.z);
				grow += Time.deltaTime * speed;
				float num = grow * tackleCon.getLureRange();
				base.transform.localScale = new Vector3(num, num, 1f);
				float a = ((!(grow >= 0.5f)) ? 1f : ((1f - grow) * 2f));
				material.SetColor("_Color", new Color(1f, 1f, 1f, a));
				yield return null;
			}
			render.enabled = false;
			yield return new WaitForSeconds(effectCycle);
		}
		while (!(new Vector2(base.transform.position.x, base.transform.position.z).sqrMagnitude < gpControl.fishLimitDistFromPlayer * gpControl.fishLimitDistFromPlayer));
		if (cBiteHaptic != null)
		{
			StopCoroutine(cBiteHaptic);
		}
	}
}
public class duckMove : MonoBehaviour
{
	public Animator duckAni;

	public Animator duckAniShadow;

	public float moveSpeed = 1f;

	public float rotateSpeed = 1f;

	public float randomStayMinTime = 10f;

	public float randomStayMaxTime = 10f;

	public float arriveDistance = 0.1f;

	public Transform targetPos;

	private Vector3 newDir;

	private float height;

	private bool isMoving;

	private bool eventFinish;

	private void Start()
	{
		AnimatorStateInfo currentAnimatorStateInfo = duckAni.GetCurrentAnimatorStateInfo(0);
		float normalizedTime = UnityEngine.Random.Range(0f, 1f);
		duckAni.Play(currentAnimatorStateInfo.fullPathHash, -1, normalizedTime);
		duckAniShadow.Play(currentAnimatorStateInfo.fullPathHash, -1, normalizedTime);
		base.transform.position = targetPos.position;
		base.transform.rotation = targetPos.rotation;
		StartCoroutine(eMove());
	}

	private IEnumerator eMove()
	{
		while (true)
		{
			Vector3 target = targetPos.position - base.transform.position;
			Vector3 forward = Vector3.RotateTowards(base.transform.forward, target, Time.deltaTime * rotateSpeed, 0f);
			base.transform.rotation = Quaternion.LookRotation(forward);
			base.transform.position = Vector3.Lerp(base.transform.position, targetPos.position, Time.deltaTime * 0.8f);
			yield return null;
		}
	}

	public void swim()
	{
		duckAni.SetBool("swim", value: true);
		duckAniShadow.SetBool("swim", value: true);
		duckAniShadow.SetFloat("offset", UnityEngine.Random.Range(0f, 2f));
	}

	public void idle()
	{
		duckAni.SetBool("swim", value: false);
		duckAniShadow.SetBool("swim", value: false);
		duckAniShadow.SetFloat("offset", UnityEngine.Random.Range(0f, 30f));
		switch (UnityEngine.Random.Range(0, 6))
		{
		case 1:
			duckAni.SetTrigger("event1");
			duckAniShadow.SetTrigger("event1");
			break;
		case 2:
			duckAni.SetTrigger("event2");
			duckAniShadow.SetTrigger("event2");
			break;
		case 3:
			duckAni.SetTrigger("event0");
			duckAniShadow.SetTrigger("event0");
			break;
		case 0:
			break;
		}
	}
}
public class envTextureScroll : MonoBehaviour
{
	public Material EnvSimpleMat;

	public Material EnvWaveMat;

	public float scrollSpeed = 0.01f;

	private Renderer rend;

	private float offset;

	private bool waveMat = true;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		rend = GetComponent<Renderer>();
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			rend.material = EnvSimpleMat;
			waveMat = false;
		}
		else
		{
			rend.material = EnvWaveMat;
			waveMat = true;
		}
	}

	private void Start()
	{
		if (waveMat)
		{
			StartCoroutine(Wave());
		}
	}

	private IEnumerator Wave()
	{
		while (true)
		{
			offset += Time.deltaTime * scrollSpeed;
			if (offset >= 1f)
			{
				offset = 0f;
			}
			rend.material.SetTextureOffset("_DistortionMap", new Vector2(offset, 0f));
			yield return null;
		}
	}
}
public class eventCherryLeaf : MonoBehaviour
{
	private ParticleSystem particle;

	private ParticleSystem.EmissionModule emissionModule;

	public float emissionStop = 15f;

	public float emissionMax = 30f;

	public float eventMinTime = 100f;

	public float eventMaxTime = 200f;

	private float emissionRate = 15f;

	[HideInInspector]
	public bool eventFinished;

	private void Start()
	{
		particle = GetComponent<ParticleSystem>();
		emissionModule = particle.emission;
		emissionModule.rateOverTime = emissionRate;
		StartCoroutine(eventStart());
	}

	private IEnumerator eventStart()
	{
		float seconds = UnityEngine.Random.Range(eventMinTime, eventMaxTime) * (40f - emissionRate) * 0.1f;
		yield return new WaitForSeconds(seconds);
		emissionRate = UnityEngine.Random.Range(0f, 35f);
		if (emissionRate > emissionMax)
		{
			emissionRate = emissionMax;
		}
		else if (emissionRate < emissionStop)
		{
			emissionRate = 0f;
		}
		emissionModule.rateOverTime = emissionRate;
		StartCoroutine(eventStart());
	}
}
public class eventFirefly : MonoBehaviour
{
	private ParticleSystem particleFirefly;

	private ParticleSystem.EmissionModule emissionMudoule;

	private void Start()
	{
		particleFirefly = GetComponent<ParticleSystem>();
		emissionMudoule = particleFirefly.emission;
	}

	public void eventStart()
	{
		ParticleSystem.ShapeModule shape = particleFirefly.shape;
		shape.scale = new Vector3(UnityEngine.Random.Range(5f, 20f), 2f, 2f);
		int num = UnityEngine.Random.Range(5, 30);
		emissionMudoule.rateOverTime = num;
		particleFirefly.Play();
	}

	public void eventEnd()
	{
		particleFirefly.Stop();
	}
}
public class eventFirework : MonoBehaviour
{
	public control_event eventControl;

	public ParticleSystem[] fireWork;

	private void Awake()
	{
		for (int i = 0; i < fireWork.Length; i++)
		{
			fireWork[i].Stop();
		}
	}

	public void eventStart()
	{
		for (int i = 0; i < fireWork.Length; i++)
		{
			fireWork[i].Play();
		}
	}

	public void eventEnd()
	{
		for (int i = 0; i < fireWork.Length; i++)
		{
			fireWork[i].Stop();
		}
		eventControl.eventFinished = true;
	}
}
public class eventRain : MonoBehaviour
{
	public GameObject rainObj;

	public ParticleSystem rainParticle;

	private ParticleSystem.EmissionModule rainParticleEmit;

	public ParticleSystem rainWater;

	private ParticleSystem.EmissionModule rainWaterEmit;

	public Renderer rainPlane;

	public AudioSource soundRain;

	public float rainMainPower = 1f;

	private Material rainPlaneMat;

	public float rainShowTime = 5f;

	public int rainRateMax = 100;

	public int waterRateMax = 200;

	private float rainPlanePower = 1f;

	private float waitTime;

	private float rainwaterPower;

	public bool autoStart;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
	}

	private void Start()
	{
		rainParticleEmit = rainParticle.emission;
		rainWaterEmit = rainWater.emission;
		waitTime = rainShowTime / (float)rainRateMax;
		rainwaterPower = waterRateMax / rainRateMax;
		rainPlaneMat = rainPlane.material;
		rainPlaneMat.SetColor("_TintColor", new Color(1f, 1f, 1f, 0f));
		soundRain.volume = 0f;
		rainParticleEmit.rateOverTime = 0f;
		rainWaterEmit.rateOverTime = 0f;
		if (autoStart)
		{
			StartCoroutine(rainStart());
		}
	}

	public void eventStart()
	{
		StartCoroutine(rainStart());
	}

	public void eventEnd()
	{
		StartCoroutine(rainStop());
	}

	private IEnumerator rainStart()
	{
		rainPlanePower = UnityEngine.Random.Range(0.5f, 1f);
		rainObj.SetActive(value: true);
		int power = 0;
		rainParticle.Play();
		rainWater.Play();
		soundRain.Play();
		while (power <= 100)
		{
			power += 10;
			rainParticleEmit.rateOverTime = (float)power * rainMainPower;
			rainWaterEmit.rateOverTime = (float)power * rainwaterPower * rainMainPower;
			rainPlaneMat.SetColor("_TintColor", new Color(1f, 1f, 1f, (float)power * 0.01f * rainPlanePower * rainMainPower));
			soundRain.volume = (float)power * 0.01f * rainMainPower * (float)dataManager.userData.volumeAmbient * 0.1f;
			yield return new WaitForSeconds(waitTime * 100f);
		}
	}

	private IEnumerator rainStop()
	{
		int power = 100;
		while (power > 0)
		{
			power -= 10;
			rainParticleEmit.rateOverTime = (float)power * rainMainPower;
			rainWaterEmit.rateOverTime = (float)power * rainwaterPower * rainMainPower;
			rainPlaneMat.SetColor("_TintColor", new Color(1f, 1f, 1f, (float)power * 0.01f * rainPlanePower * rainMainPower));
			soundRain.volume = (float)power * 0.01f * rainMainPower * (float)dataManager.userData.volumeAmbient * 0.1f;
			yield return new WaitForSeconds(waitTime * 100f);
		}
		rainParticle.Stop();
		rainWater.Stop();
		soundRain.Stop();
		rainObj.SetActive(value: false);
	}
}
public class eventRainbow : MonoBehaviour
{
	public control_event eventControl;

	public GameObject rainbow;

	public float eventSpeed = 0.5f;

	private Material rainbowMat;

	private void Awake()
	{
		rainbow.SetActive(value: false);
		rainbowMat = rainbow.GetComponent<Renderer>().material;
	}

	public void eventStart()
	{
		StartCoroutine(rainbowShow());
	}

	public void eventEnd()
	{
		StartCoroutine(rainbowHide());
	}

	private IEnumerator rainbowShow()
	{
		rainbowMat.SetColor("_Color", new Color(0f, 0f, 0f, 1f));
		rainbow.SetActive(value: true);
		float stime = 0f;
		while (stime <= 1f)
		{
			stime += Time.deltaTime * eventSpeed;
			rainbowMat.SetColor("_Color", new Color(stime, stime, stime, 1f));
			yield return null;
		}
		rainbowMat.SetColor("_Color", new Color(1f, 1f, 1f, 1f));
	}

	private IEnumerator rainbowHide()
	{
		float stime = 1f;
		while (stime >= 0f)
		{
			stime -= Time.deltaTime * eventSpeed;
			rainbowMat.SetColor("_Color", new Color(stime, stime, stime, 1f));
			yield return null;
		}
		rainbow.SetActive(value: false);
		eventControl.eventFinished = true;
	}
}
public class eventRedCrown : MonoBehaviour
{
	public Transform[] startPosition;

	public GameObject RootObj;

	public Animator birdAni;

	public Animation flyAni;

	public AnimationClip[] flyAniClip;

	public float idleTime = 5f;

	public float flyMinTime = 100f;

	public float flyMaxTime = 200f;

	public float hideXPos = 100f;

	private void Start()
	{
	}

	public void eventStart()
	{
		MonoBehaviour.print("eventStart");
		RootObj.SetActive(value: true);
		int num = UnityEngine.Random.Range(0, startPosition.Length);
		RootObj.transform.position = startPosition[num].position;
		StartCoroutine(birdAniEvent());
	}

	private void aniIdle1(int ani)
	{
		switch (ani)
		{
		case 1:
			birdAni.SetTrigger("idle1");
			break;
		case 2:
			birdAni.SetTrigger("idle2");
			break;
		}
	}

	private IEnumerator birdAniEvent()
	{
		float stime = 0f;
		float flyTime = UnityEngine.Random.Range(flyMinTime, flyMaxTime);
		while (stime < flyTime)
		{
			stime += idleTime;
			int ani = UnityEngine.Random.Range(0, 4);
			aniIdle1(ani);
			yield return new WaitForSeconds(idleTime);
		}
		birdAni.SetTrigger("jump");
		flyAni.clip = flyAniClip[UnityEngine.Random.Range(0, flyAniClip.Length)];
		flyAni.Play();
		while (Mathf.Abs(flyAni.transform.position.x) < hideXPos)
		{
			yield return new WaitForSeconds(1f);
		}
		RootObj.SetActive(value: false);
	}
}
public class eventSparrow : MonoBehaviour
{
	public FlockController birdFlock;

	public int minBird = 5;

	public int maxBird = 12;

	private void Awake()
	{
		birdFlock._childAmount = UnityEngine.Random.Range(minBird, maxBird);
		birdFlock.UpdateChildAmount();
	}
}
public class eventSwimBird : MonoBehaviour
{
	public GameObject birdMoveDummy;

	public GameObject[] birdObj;

	public GameObject[] birdbabyObj;

	public float AdultRatio = 50f;

	public float BabyRatio = 30f;

	public float minLimitX = 1f;

	public float maxLimitX = 100f;

	public float minLimitZ = 1f;

	public float maxLimitZ = 1f;

	public float moveSpeed = 1f;

	public float rotateSpeed = 1f;

	public float randomStayMinTime = 10f;

	public float randomStayMaxTime = 10f;

	public float arriveDistance = 0.1f;

	private Vector3 randomTarget;

	private Vector3 newDir;

	private float lerpMoveSpeed;

	private float height;

	private bool eventFinish;

	private void Awake()
	{
		birdMoveDummy.SetActive(value: false);
		for (int i = 0; i < birdObj.Length; i++)
		{
			birdObj[i].SetActive(value: false);
		}
		for (int j = 0; j < birdbabyObj.Length; j++)
		{
			birdbabyObj[j].SetActive(value: false);
		}
	}

	private void Start()
	{
		height = base.transform.position.y;
		birdMoveDummy.transform.position = new Vector3(UnityEngine.Random.Range(minLimitX, maxLimitX), height, UnityEngine.Random.Range(minLimitZ, maxLimitZ));
		birdMoveDummy.transform.rotation = Quaternion.Euler(new Vector3(0f, UnityEngine.Random.Range(0, 360), 0f));
		for (int i = 0; i < birdObj.Length; i++)
		{
			if (birdObj[i].activeSelf)
			{
				birdObj[i].SendMessage("idle");
			}
		}
		if (birdbabyObj != null)
		{
			for (int j = 0; j < birdbabyObj.Length; j++)
			{
				if (birdbabyObj[j].activeSelf)
				{
					birdbabyObj[j].SendMessage("idle");
				}
			}
		}
		StartCoroutine(randomMove());
	}

	public void eventStart()
	{
		birdMoveDummy.SetActive(value: true);
		birdObj[0].SetActive(value: true);
		if ((float)UnityEngine.Random.Range(0, 100) < AdultRatio)
		{
			birdObj[1].SetActive(value: true);
		}
		if (birdbabyObj == null)
		{
			return;
		}
		for (int i = 0; i < birdbabyObj.Length; i++)
		{
			if ((float)UnityEngine.Random.Range(0, 100) < BabyRatio)
			{
				birdbabyObj[i].SetActive(value: true);
			}
		}
	}

	private IEnumerator randomMove()
	{
		float seconds = UnityEngine.Random.Range(randomStayMinTime, randomStayMaxTime);
		yield return new WaitForSeconds(seconds);
		randomTarget = new Vector3(UnityEngine.Random.Range(minLimitX, maxLimitX), height, UnityEngine.Random.Range(minLimitZ, maxLimitZ));
		float distance = Vector3.Distance(randomTarget, birdMoveDummy.transform.position);
		for (int l = 0; l < birdObj.Length; l++)
		{
			if (birdObj[l].activeSelf)
			{
				yield return new WaitForSeconds(UnityEngine.Random.Range(0f, 1f));
				birdObj[l].SendMessage("swim");
			}
		}
		for (int l = 0; l < birdbabyObj.Length; l++)
		{
			if (birdbabyObj[l].activeSelf)
			{
				yield return new WaitForSeconds(UnityEngine.Random.Range(0f, 1f));
				birdbabyObj[l].SendMessage("swim");
			}
		}
		while (distance > arriveDistance)
		{
			lerpMoveSpeed = Mathf.Lerp(lerpMoveSpeed, moveSpeed, Time.deltaTime);
			Vector3 target = randomTarget - birdMoveDummy.transform.position;
			Vector3 forward = Vector3.RotateTowards(birdMoveDummy.transform.forward, target, Time.deltaTime * rotateSpeed, 0f);
			birdMoveDummy.transform.rotation = Quaternion.LookRotation(forward);
			birdMoveDummy.transform.position += birdMoveDummy.transform.forward * lerpMoveSpeed * Time.deltaTime;
			distance = Vector3.Distance(randomTarget, birdMoveDummy.transform.position);
			yield return null;
		}
		while (lerpMoveSpeed > 0f)
		{
			lerpMoveSpeed -= Time.deltaTime;
			birdMoveDummy.transform.position += base.transform.forward * lerpMoveSpeed * Time.deltaTime;
			yield return null;
		}
		lerpMoveSpeed = 0f;
		for (int l = 0; l < birdObj.Length; l++)
		{
			if (birdObj[l].activeSelf)
			{
				yield return new WaitForSeconds(UnityEngine.Random.Range(0f, 1f));
				birdObj[l].SendMessage("idle");
			}
		}
		if (birdbabyObj != null)
		{
			for (int l = 0; l < birdbabyObj.Length; l++)
			{
				if (birdbabyObj[l].activeSelf)
				{
					yield return new WaitForSeconds(UnityEngine.Random.Range(0f, 1f));
					birdbabyObj[l].SendMessage("idle");
				}
			}
		}
		StartCoroutine(randomMove());
	}
}
public class eventThunder : MonoBehaviour
{
	public ParticleSystem pThundersFar;

	public ParticleSystem pThundersMiddle;

	public ParticleSystem pThundersClose;

	private AudioSource aThundersFar;

	private AudioSource aThundersMiddle;

	private AudioSource aThundersClose;

	public float thunderCycleMinTime = 5f;

	public float thunderCycleMaxTime = 10f;

	public bool autoStart;

	private void Start()
	{
		aThundersFar = pThundersFar.GetComponent<AudioSource>();
		aThundersMiddle = pThundersMiddle.GetComponent<AudioSource>();
		aThundersClose = pThundersClose.GetComponent<AudioSource>();
		if (autoStart)
		{
			eventStart();
		}
	}

	public void eventStart()
	{
		StartCoroutine(thunderStart());
	}

	private IEnumerator thunderStart()
	{
		while (true)
		{
			float seconds = UnityEngine.Random.Range(thunderCycleMinTime, thunderCycleMaxTime);
			yield return new WaitForSeconds(seconds);
			int num = UnityEngine.Random.Range(0, 10);
			if (num < 2)
			{
				pThundersClose.Play();
				aThundersClose.Play();
			}
			else if (num > 5)
			{
				pThundersFar.Play();
				aThundersFar.Play();
			}
			else
			{
				pThundersMiddle.Play();
				aThundersMiddle.Play();
			}
		}
	}
}
public class flockMove : MonoBehaviour
{
	public control_event eventControl;

	public GameObject birdObject;

	public float minLimitX = 1f;

	public float maxLimitX = 100f;

	public float minLimitZ = 1f;

	public float maxLimitZ = 1f;

	public float minHeight = 1f;

	public float maxHeight = 5f;

	public float moveSpeed = 1f;

	public float rotateSpeed = 1f;

	public float randomTime = 3f;

	private Vector3 randomPos;

	public Transform direction;

	public Transform newDir;

	public ParticleSystem[] birdParticle;

	public Vector3 startPoisition;

	public Vector3 endPosition;

	private float sTime;

	private bool eventFinish;

	private void Awake()
	{
		birdObject.SetActive(value: false);
		base.transform.position = startPoisition;
	}

	public void eventStart()
	{
		birdObject.SetActive(value: true);
		sTime = 0f;
		StartCoroutine(randomMove());
	}

	public void eventEnd()
	{
		eventFinish = true;
	}

	private IEnumerator randomMove()
	{
		float time = 0f;
		float LimitTime = UnityEngine.Random.Range(randomTime * 0.5f, randomTime * 1.5f);
		if (eventFinish)
		{
			randomPos = endPosition;
			if (Vector3.Distance(base.transform.position, endPosition) < 20f)
			{
				birdObject.SetActive(value: false);
				eventFinish = false;
				base.transform.position = startPoisition;
				eventControl.eventFinished = true;
				yield break;
			}
		}
		else
		{
			randomPos = new Vector3(UnityEngine.Random.Range(minLimitX, maxLimitX), UnityEngine.Random.Range(minHeight, maxHeight), UnityEngine.Random.Range(minLimitZ, maxLimitZ));
		}
		while (time < LimitTime)
		{
			sTime += Time.deltaTime;
			time += Time.deltaTime;
			newDir.LookAt(randomPos);
			direction.rotation = Quaternion.Lerp(direction.rotation, newDir.rotation, Time.deltaTime * rotateSpeed);
			base.transform.position += direction.forward * moveSpeed * Time.deltaTime;
			yield return null;
		}
		for (int i = 0; i < birdParticle.Length; i++)
		{
			ParticleSystem.ShapeModule shape = birdParticle[i].shape;
			shape.radius = UnityEngine.Random.Range(10f, 20f);
		}
		StartCoroutine(randomMove());
	}
}
public class moonManager : MonoBehaviour
{
	public Transform horizonTransform;

	public float rotateSpeed = 1f;

	public float startAngle;

	public float endAngle = 100f;

	public float fadeAngle = 10f;

	public float fadeEndAngle = 3f;

	public Renderer moonRender;

	public Color moonColor = Color.white;

	private Material moonMaterial;

	private float alpha;

	public bool moonMove;

	private void Start()
	{
		moonMaterial = moonRender.material;
		calculateMoonPhase();
		if (moonMove)
		{
			StartCoroutine(moonRotate());
		}
	}

	private IEnumerator moonRotate()
	{
		moonMaterial.SetColor("_TintColor", new Color(moonColor.r, moonColor.b, moonColor.b, alpha));
		horizonTransform.localEulerAngles = new Vector3(0f, startAngle, 0f);
		float sAngle = 0.001f;
		while (sAngle < Math.Abs(endAngle - startAngle))
		{
			sAngle += Time.deltaTime * rotateSpeed;
			if (sAngle < fadeAngle)
			{
				alpha = sAngle / fadeAngle;
				moonMaterial.SetColor("_TintColor", new Color(moonColor.r, moonColor.b, moonColor.b, alpha));
			}
			else if (sAngle > Math.Abs(endAngle - startAngle) - fadeEndAngle)
			{
				float num = Math.Abs(endAngle - startAngle) - sAngle;
				if (num != 0f)
				{
					alpha = num / fadeEndAngle;
				}
				moonMaterial.SetColor("_TintColor", new Color(moonColor.r, moonColor.b, moonColor.b, alpha));
			}
			else
			{
				alpha = 1f;
				moonMaterial.SetColor("_TintColor", new Color(moonColor.r, moonColor.b, moonColor.b, alpha));
			}
			horizonTransform.localEulerAngles = new Vector3(0f, startAngle + sAngle, 0f);
			yield return null;
		}
	}

	private void calculateMoonPhase()
	{
		DateTime dateTime = new DateTime(2019, 5, 6);
		int num = (int)((float)(DateTime.Now.Date - dateTime).TotalDays % 29.530588f / 29.530588f * 16f);
		float x = (float)(num % 4) * 0.25f;
		float y = Mathf.Floor((float)num / 4f) * 0.25f;
		moonMaterial.SetTextureOffset("_MainTex", new Vector2(x, y));
	}
}
public class AchievementController : Singleton<AchievementController>
{
	public enum AchievementList
	{
		stage,
		tackle,
		day,
		sunset,
		night,
		rain,
		release,
		fishing,
		aquarium,
		bigfish,
		money,
		rare,
		shark,
		hugefish
	}

	public Color color_buttonSelected;

	public Color color_buttonUnSelected;

	public Color color_buttonUninteractive;

	public Transform cameraTrans;

	public GameObject panel;

	public Text textTitle;

	public Text textGuide;

	public Text textGradeNum;

	public Text textReward;

	public GameObject panelLVup;

	public Text textLevel;

	public float uiPanelStayTime = 3f;

	public float popupSpeed = 3f;

	public int rewardGrade = 3;

	private Vector3 oriScale;

	public TrophyManager trophyCon;

	public AchieveItem[] achievements;

	private AudioSource audioplay;

	private IEnumerator cPopup;

	private IEnumerator cPopupLV;

	private int maximumGold = 100000;

	[HideInInspector]
	public bool popupOn;

	private DataManager dataManager;

	private int id;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
	}

	private void Start()
	{
		base.transform.rotation = Quaternion.identity;
		panel.SetActive(value: false);
		base.transform.rotation = Quaternion.identity;
		panelLVup.SetActive(value: false);
		audioplay = GetComponent<AudioSource>();
	}

	public int getRemain(int id)
	{
		int result = 0;
		int num = dataManager.userData.achievements[dataManager.currentNation].achievement[id];
		int num2 = dataManager.userData.achievements[dataManager.currentNation].grade[id];
		if (num != 5)
		{
			result = achievements[id].targetNumber[num2] - num;
		}
		return result;
	}

	public bool checkUpgrade(int id, int value)
	{
		if (!Singleton<Main>.Instance.useTutorial)
		{
			dataManager.userData.achievements[dataManager.currentNation].achievement[id] += value;
		}
		return upgrade(id);
	}

	public bool checkUpgrade(int id)
	{
		if (!Singleton<Main>.Instance.useTutorial)
		{
			dataManager.userData.achievements[dataManager.currentNation].achievement[id]++;
		}
		return upgrade(id);
	}

	private bool upgrade(int id)
	{
		bool flag = false;
		int num = dataManager.userData.achievements[dataManager.currentNation].achievement[id];
		int num2 = dataManager.userData.achievements[dataManager.currentNation].grade[id];
		if (num2 < 5 && num > achievements[id].targetNumber[num2] - 1)
		{
			dataManager.userData.achievements[dataManager.currentNation].grade[id]++;
			flag = true;
		}
		if (flag)
		{
			checkReward(id, dataManager.userData.achievements[dataManager.currentNation].grade[id]);
			popUp(id);
			if (trophyCon != null)
			{
				trophyCon.trophyShow(id);
			}
		}
		return flag;
	}

	private void popUp(int id)
	{
		if (cPopup != null)
		{
			StopCoroutine(cPopup);
		}
		cPopup = scaleShow(id);
		audioplay.Play();
		StartCoroutine(cPopup);
	}

	public void popLevelUp(int lv)
	{
		if (cPopupLV != null)
		{
			StopCoroutine(cPopupLV);
		}
		cPopupLV = levelupShow(lv);
		audioplay.Play();
		StartCoroutine(cPopupLV);
	}

	private IEnumerator scaleShow(int id)
	{
		popupOn = true;
		base.transform.position = cameraTrans.position;
		base.transform.rotation = Quaternion.Euler(0f, cameraTrans.eulerAngles.y, 0f);
		panel.SetActive(value: true);
		textTitle.GetComponent<Localize>().SetKey(achievements[id].nameKey);
		textGuide.text = "";
		textGradeNum.text = dataManager.userData.achievements[dataManager.currentNation].grade[id].ToString();
		if (dataManager.userData.achievements[dataManager.currentNation].grade[id] == 3)
		{
			if (achievements[id].reward == RewardType.GOLD)
			{
				textReward.GetComponent<Localize>().SetKey(achievements[id].nameKey);
				textReward.text = LocalizationManager.GetKeyTranslation("LodgeAchievePopup/0003") + " " + achievements[id].rewardGold + " " + LocalizationManager.GetKeyTranslation("LodgeAchievePopup/0004");
			}
			else
			{
				textReward.GetComponent<Localize>().SetKey(achievements[id].nameKey);
				textReward.text = LocalizationManager.GetKeyTranslation("LodgeAchievePopup/0003") + " " + textReward.GetComponent<Localize>().GetMainTargetsText();
			}
		}
		else
		{
			textReward.text = "";
		}
		float scale = 0f;
		while (scale <= 1f)
		{
			scale += Time.deltaTime * popupSpeed;
			panel.transform.localScale = new Vector3(scale, scale, scale);
			yield return null;
		}
		textGuide.GetComponent<Localize>().SetKey("FishingSpot/0009");
		bool isPushed = true;
		while (isPushed)
		{
			if (OVRInput.GetDown(OVRInput.Button.SecondaryIndexTrigger, OVRInput.Controller.Touch) || OVRInput.GetDown(OVRInput.Button.PrimaryIndexTrigger, OVRInput.Controller.Touch) || OVRInput.GetDown(OVRInput.Button.PrimaryIndexTrigger))
			{
				isPushed = false;
			}
			yield return null;
		}
		popupOn = false;
		while (scale > 0f)
		{
			scale -= Time.deltaTime * popupSpeed;
			panel.transform.localScale = new Vector3(scale, scale, scale);
			yield return null;
		}
		panel.SetActive(value: false);
	}

	private IEnumerator levelupShow(int lv)
	{
		base.transform.position = cameraTrans.position;
		base.transform.rotation = Quaternion.Euler(0f, cameraTrans.eulerAngles.y, 0f);
		panelLVup.SetActive(value: true);
		textLevel.GetComponent<Localize>().SetKey("LodgeLevelUpPopup/0002");
		textLevel.text = textLevel.GetComponent<Localize>().GetMainTargetsText() + " " + lv;
		float scale = 0f;
		while (scale <= 1f)
		{
			scale += Time.deltaTime * popupSpeed;
			panelLVup.transform.localScale = new Vector3(scale, scale, scale);
			yield return null;
		}
		yield return new WaitForSeconds(uiPanelStayTime);
		while (scale > 0f)
		{
			scale -= Time.deltaTime * popupSpeed;
			panelLVup.transform.localScale = new Vector3(scale, scale, scale);
			yield return null;
		}
		panelLVup.SetActive(value: false);
	}

	private void checkReward(int id, int grade)
	{
		if (grade == rewardGrade)
		{
			if (achievements[id].reward == RewardType.GOLD)
			{
				goldCheck(achievements[id].rewardGold);
			}
			else if (achievements[id].reward == RewardType.DECORATION)
			{
				dataManager.userData.aquariums[dataManager.currentNation].rooms[0].items[achievements[id].decorationId].purchased = true;
			}
			else if (achievements[id].reward == RewardType.GLOVE)
			{
				if (!dataManager.userData.gloves.Contains(achievements[id].decorationId))
				{
					dataManager.userData.gloves.Add(dataManager.ItemDatabase.gloveItems[achievements[id].decorationId].ID);
					dataManager.userData.gloves.Sort();
				}
			}
			else if (achievements[id].reward == RewardType.FISH && dataManager.userData.animals.Count > 0)
			{
				dataManager.userData.animals[0].purchased = true;
			}
		}
		dataManager.Save();
	}

	public void goldCheck(int gold)
	{
		int num = dataManager.userData.userGold + gold;
		if (num < maximumGold)
		{
			dataManager.userData.userGold = num;
			checkUpgrade(10, gold);
		}
	}
}
public class control_bait : MonoBehaviour
{
	private Rigidbody rb;

	private Main main;

	private void Awake()
	{
		main = Singleton<Main>.Instance;
		rb = GetComponent<Rigidbody>();
	}

	private void Start()
	{
	}

	public void OnOffGravity(bool gravity)
	{
		rb.useGravity = gravity;
	}
}
public class control_bending : MonoBehaviour
{
	public Transform[] bones;

	public float power = 1f;

	public Transform handTrans;

	private float boneAngle;

	public Transform lookatT;

	private void Start()
	{
		boneAngle = 1f / (float)bones.Length;
	}

	private void Update()
	{
		float num = 0f - Vector3.Angle(new Vector3(0f, lookatT.forward.y, 0f - lookatT.forward.z), new Vector3(0f, handTrans.up.y, handTrans.up.z)) + 90f;
		float num2 = Vector3.Angle(new Vector3(0f, lookatT.forward.x, lookatT.forward.z), new Vector3(0f, handTrans.right.x, handTrans.right.z)) - 90f;
		for (int i = 0; i < bones.Length; i++)
		{
			bones[i].localEulerAngles = new Vector3(0f, num * boneAngle * power, num2 * boneAngle * power);
		}
	}
}
public class Control_boat : MonoBehaviour
{
	public bool isMyBoat;

	public GameObject colliders;

	private AudioSource boatSound;

	private void Start()
	{
		boatSound = GetComponent<AudioSource>();
		if (Singleton<Main>.Instance.scene == SceneState.STAGE)
		{
			if (isMyBoat)
			{
				boatSound.Play();
			}
			colliders.SetActive(value: false);
		}
	}
}
public class control_boundary : MonoBehaviour
{
	public GameObject boundaryObj;

	public bool boundarCheck = true;

	private control_envrionment envControl;

	public Color boundarColor = Color.black;

	public float fadeSpeed = 0.5f;

	private float fadeDistance;

	private bool inBoundary = true;

	private Material fadeMat;

	private Material fenceMat;

	private float stime;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
		envControl = main.envControl;
		fadeDistance = envControl.fadeDistance;
		fadeMat = boundaryObj.GetComponent<Renderer>().material;
		fenceMat = envControl.boundaryFence.GetComponent<Renderer>().material;
		init();
		if (dataManager.targetPlatform != 0 && boundarCheck)
		{
			StartCoroutine(checkDistance());
		}
	}

	private void init()
	{
		boundaryObj.SetActive(value: false);
		envControl.boundaryFence.SetActive(value: false);
		fenceMat.SetColor("_Color", new Color(1f, 1f, 1f, 0f));
		fadeMat.SetColor("_Color", new Color(boundarColor.r, boundarColor.b, boundarColor.g, 0f));
	}

	private IEnumerator checkDistance()
	{
		while (true)
		{
			if (new Vector3(base.transform.position.x, base.transform.position.z, 0f).sqrMagnitude > fadeDistance * fadeDistance)
			{
				if (inBoundary)
				{
					inBoundary = false;
					StartCoroutine(screenDark());
				}
			}
			else if (!inBoundary)
			{
				inBoundary = true;
				StartCoroutine(screenBack());
			}
			yield return new WaitForSeconds(0.6f);
		}
	}

	private IEnumerator screenDark()
	{
		envControl.boundaryFence.SetActive(value: true);
		boundaryObj.SetActive(value: true);
		while (stime <= 1f)
		{
			stime += Time.deltaTime * fadeSpeed;
			fadeMat.SetColor("_Color", new Color(boundarColor.r, boundarColor.b, boundarColor.g, boundarColor.a * stime));
			fenceMat.SetColor("_TintColor", new Color(1f, 1f, 1f, stime));
			yield return null;
		}
	}

	private IEnumerator screenBack()
	{
		while (stime > 0f)
		{
			stime -= Time.deltaTime * fadeSpeed;
			fadeMat.SetColor("_Color", new Color(boundarColor.r, boundarColor.b, boundarColor.g, boundarColor.a * stime));
			fenceMat.SetColor("_TintColor", new Color(1f, 1f, 1f, stime));
			yield return null;
		}
		init();
	}
}
public class control_envrionment : MonoBehaviour
{
	public int stageID;

	[HideInInspector]
	public int stageType;

	[HideInInspector]
	public int envTime;

	public AudioSource[] sound_env;

	public Transform tackleGroundPivot;

	public Collider col_water;

	public float water_Height;

	public Transform releasePos;

	public GameObject boundaryFence;

	public float fadeDistance = 2f;

	public bool useEnvDistortion;

	public Renderer EnvRenderer;

	public float scrollSpeed = 0.01f;

	private float offset;

	public GameObject waterPlaneLow;

	public GameObject waterPlaneHigh;

	public Material mWaterMiddle;

	public Material mWaterHigh;

	public StageItem stageInfos;

	public Transform hugeFishLandingPos;

	[Header("Multiplay")]
	public Transform multiplayPositionPivot;

	public Transform[] multiplayPositions;

	public GameObject[] multiHolderPositions;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		if (waterPlaneLow != null)
		{
			waterPlaneLow.SetActive(value: false);
		}
		if (waterPlaneHigh != null)
		{
			waterPlaneHigh.SetActive(value: false);
		}
		water_Height = col_water.transform.position.y;
		if (main.enableFishing)
		{
			init();
		}
		else
		{
			tackleGroundPivot.gameObject.SetActive(value: false);
		}
		waterPlaneSet();
		CheckEnvWave();
	}

	private void init()
	{
		stageInfos = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems[stageID];
		stageType = stageInfos.stageType;
		main.finderControl.image_tabletMap.sprite = stageInfos.stageMap;
		envTime = stageInfos.stageTime;
		tackleGroundPivot.GetComponent<BoxCollider>().enabled = false;
	}

	private void CheckEnvWave()
	{
		if (EnvRenderer != null)
		{
			if (dataManager.targetPlatform == DEVICE_TYPE.GO)
			{
				EnvRenderer.material.shader = Shader.Find("Custom/EnvUnlit");
			}
			else if (!useEnvDistortion)
			{
				EnvRenderer.material.shader = Shader.Find("Custom/EnvUnlit");
			}
			else
			{
				StartCoroutine(Wave());
			}
		}
	}

	private IEnumerator Wave()
	{
		while (true)
		{
			offset += Time.deltaTime * scrollSpeed;
			if (offset >= 1f)
			{
				offset = 0f;
			}
			EnvRenderer.material.SetTextureOffset("_DistortionMap", new Vector2(offset, 0f));
			yield return null;
		}
	}

	public void waterPlaneSet()
	{
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			waterPlaneLow.SetActive(value: true);
		}
		else if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
		{
			if (dataManager.userData.graphicQuality == 0)
			{
				waterPlaneLow.SetActive(value: true);
			}
			else
			{
				waterPlaneHigh.SetActive(value: true);
			}
		}
		else if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
		{
			if (dataManager.userData.graphicQuality == 0)
			{
				waterPlaneHigh.SetActive(value: true);
				waterPlaneHigh.GetComponent<Renderer>().material = mWaterMiddle;
			}
			else
			{
				waterPlaneHigh.SetActive(value: true);
				waterPlaneHigh.GetComponent<Renderer>().material = mWaterHigh;
			}
		}
	}
}
public class control_event : MonoBehaviour
{
	public bool EnvEvent = true;

	public GameObject eventObject;

	public float eventRatio = 10f;

	public float eventStartMinTime = 100f;

	public float eventStartMaxTime = 200f;

	public float eventEndMinTime = 100f;

	public float eventEndMaxTime = 200f;

	public float evnetRestartWaitTime = 200f;

	public bool eventOnStart;

	public bool eventAutoReplay;

	[HideInInspector]
	public bool eventFinished;

	public FlockController birdEvent;

	public int birdEventRatio = 50;

	public int birdMinAmount;

	public int birdMaxAmount = 3;

	private void Start()
	{
		if (birdEvent != null)
		{
			int num = UnityEngine.Random.Range(birdMinAmount, birdMaxAmount);
			if (num != 0)
			{
				birdEvent.gameObject.SetActive(value: true);
				birdEvent._childAmount = num + 1;
				birdEvent.UpdateChildAmount();
			}
		}
		if (EnvEvent && (float)UnityEngine.Random.Range(0, 100) < eventRatio)
		{
			if (eventOnStart)
			{
				eventObject.SendMessage("eventStart");
			}
			else
			{
				StartCoroutine(eventStart());
			}
		}
	}

	private IEnumerator eventStart()
	{
		yield return new WaitForSeconds(UnityEngine.Random.Range(eventStartMinTime, eventStartMaxTime));
		eventObject.SendMessage("eventStart");
		yield return new WaitForSeconds(UnityEngine.Random.Range(eventEndMinTime, eventEndMaxTime));
		eventObject.SendMessage("eventEnd");
		if (!eventAutoReplay)
		{
			while (!eventFinished)
			{
				yield return new WaitForSeconds(1f);
			}
			eventFinished = false;
		}
		yield return new WaitForSeconds(evnetRestartWaitTime);
		StartCoroutine(eventStart());
	}
}
public class control_fish : MonoBehaviour
{
	private graphFishGradeRate gradeRate;

	private control_Fishing fishingControl;

	private control_Lure lureControl;

	private control_envrionment envControl;

	public bool isFish;

	public int fishID;

	public string fishName;

	public float fishSize;

	public float fishWeight;

	public int fishGrade;

	public float fishLife;

	public float fishPower;

	public float fishSpeed;

	public float fishRedirect;

	public float fishRecovery;

	public float fishBonus;

	public bool fishHuge;

	public bool fishRare;

	public bool fishDrag;

	public bool fishJump;

	public float fishJumpHeight;

	public float fishScale;

	public Transform lurePos;

	public bool isMonsterFishing;

	public bool dragable;

	public Transform fishPivot;

	public fishSetScript fishInst;

	public AnimationCurve fishSizeGraph;

	public AnimationCurve fishRateSmall;

	public AnimationCurve fishRateLarge;

	public AnimationCurve fishRateHuge;

	public StageItem.cStageFishType[] stageHugeFish;

	public StageItem.cStageFishType[] stageLargeFish;

	public StageItem.cStageFishType[] stageMiddleFish;

	public StageItem.cStageFishType[] stageSmallFish;

	public StageItem stageInfos;

	private int stageID;

	private fishSetScript fishset;

	public bool debugFishRate;

	public bool debugFishID;

	public float dHugeFishRate;

	public float dLargeFishRate;

	public float dMiddleFishRate;

	public float dSmallFishRate;

	public int dHugeFishArrayNum;

	public int dLargeFishArrayNum;

	public int dMiddleFishArrayNum;

	public int dSmallFishArrayNum;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		lureControl = main.lureControl;
		envControl = main.envControl;
		fishingControl = main.fishingControl;
		stageID = main.envControl.stageID;
		fishInit();
	}

	private void fishInit()
	{
		stageInfos = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems[stageID];
		int num = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems[stageID].hugeFish.Length;
		stageHugeFish = new StageItem.cStageFishType[num];
		for (int i = 0; i < num; i++)
		{
			stageHugeFish[i] = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems[stageID].hugeFish[i];
		}
		int num2 = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems[stageID].largeFish.Length;
		stageLargeFish = new StageItem.cStageFishType[num2];
		for (int j = 0; j < num2; j++)
		{
			stageLargeFish[j] = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems[stageID].largeFish[j];
		}
		int num3 = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems[stageID].middleFish.Length;
		stageMiddleFish = new StageItem.cStageFishType[num3];
		for (int k = 0; k < num3; k++)
		{
			stageMiddleFish[k] = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems[stageID].middleFish[k];
		}
		int num4 = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems[stageID].smallFish.Length;
		stageSmallFish = new StageItem.cStageFishType[num4];
		for (int l = 0; l < num4; l++)
		{
			stageSmallFish[l] = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems[stageID].smallFish[l];
		}
	}

	public bool fishSet(Transform trans, fishSetScript fish, int grade, bool isShark, bool bFish)
	{
		bool result = false;
		if (bFish)
		{
			if (isShark && fishInst != null)
			{
				fishInst.destroy();
			}
			switch (grade)
			{
			case 1:
				fishInst = UnityEngine.Object.Instantiate(fish, trans.position, trans.rotation);
				result = false;
				fishHuge = false;
				break;
			case 2:
				fishInst = UnityEngine.Object.Instantiate(fish, trans.position, trans.rotation);
				result = false;
				fishHuge = false;
				break;
			case 3:
				fishInst = UnityEngine.Object.Instantiate(fish, trans.position, trans.rotation);
				result = true;
				fishHuge = false;
				break;
			case 4:
				fishInst = UnityEngine.Object.Instantiate(fish, trans.position, trans.rotation);
				fishHuge = true;
				result = true;
				break;
			}
		}
		else
		{
			fishInst = UnityEngine.Object.Instantiate(fish, trans.position, trans.rotation);
			result = false;
			fishHuge = false;
		}
		isFish = bFish;
		fishGrade = grade;
		fishInst.transform.parent = trans;
		fishID = fish.fishInfo.ID;
		fishName = fishInst.fishInfo.ItemName;
		fishDrag = fishInst.fishInfo.drag;
		fishJump = fishInst.fishInfo.jump;
		fishJumpHeight = fishInst.fishInfo.jumpHeight;
		fishSize = setSize();
		fishRedirect = fishInst.fishInfo.redirect;
		fishPower = fishInst.fishInfo.power + fishScale * 0.1f * UnityEngine.Random.Range(-1f, 1f);
		if (fishInst.fishInfo.fishRare == 1)
		{
			fishRare = true;
		}
		else
		{
			fishRare = false;
		}
		fishLife = fishInst.fishInfo.life * fishScale;
		fishSpeed = fishInst.fishInfo.speed;
		fishWeight = getWeight(fishSize);
		fishRecovery = fishLife * fishInst.fishInfo.recovery;
		fishBonus = fishInst.fishInfo.bonus;
		fishInst.fishPivot.localScale = Vector3.one * fishScale;
		fishPivot = fishInst.fishPivot.transform;
		if (isShark)
		{
			fishingControl.fishHealth = fishLife * lureControl.healthRatio;
			fishInst.sharkAppear();
		}
		else
		{
			fishingControl.fishHealth = fishLife;
		}
		if (grade == 2 && fishScale > 1.1f)
		{
			result = true;
		}
		MonoBehaviour.print("후킹 성공 Fish ID 는 = " + fishID);
		if (PhotonNetwork.IsConnected)
		{
			MultiplayManager.Instance.localFish.SpawnFish(fishID);
		}
		return result;
	}

	private float setSize()
	{
		float time = UnityEngine.Random.Range(0f, 40f) + (float)dataManager.userData.userLv * 3f;
		fishScale = fishSizeGraph.Evaluate(time);
		float num = fishInst.fishInfo.basicSize * fishScale;
		if (num < fishInst.fishInfo.minSize)
		{
			num = fishInst.fishInfo.minSize;
		}
		return num;
	}

	private float getWeight(float size)
	{
		float num = size * 0.333f;
		float num2 = num * 0.5f;
		return size * num * num2 / 3f;
	}

	public Vector4 getFishGradeRate(int StageID)
	{
		float time = dataManager.userData.userLv;
		float num = 0f;
		float num2 = 0f;
		float num3 = 0f;
		float num4 = 0f;
		if (StageID >= 17)
		{
			if (!debugFishRate)
			{
				num3 = fishRateLarge.Evaluate(time);
				num4 = fishRateHuge.Evaluate(time);
			}
			else
			{
				num3 = dLargeFishRate;
				num4 = dHugeFishRate;
			}
			num2 = 100f - (num3 + num4);
		}
		else
		{
			if (!debugFishRate)
			{
				num = fishRateSmall.Evaluate(time);
				num3 = fishRateLarge.Evaluate(time);
			}
			else
			{
				num = dSmallFishRate;
				num3 = dLargeFishRate;
			}
			num2 = 100f - (num + num3);
		}
		return new Vector4(num, num2, num3, num4);
	}

	public int getStageFishGrade(bool first)
	{
		_ = dataManager.userData.userLv;
		Vector4 fishGradeRate = main.fishControl.getFishGradeRate(stageID);
		float x = fishGradeRate.x;
		float y = fishGradeRate.y;
		float z = fishGradeRate.z;
		float w = fishGradeRate.w;
		float num = UnityEngine.Random.Range(0, 100);
		if (stageInfos.hugeFish.Length + stageInfos.largeFish.Length + stageInfos.middleFish.Length + stageInfos.smallFish.Length == 0)
		{
			return 0;
		}
		if (stageID >= 17)
		{
			if (num < y && stageInfos.middleFish.Length != 0)
			{
				return 2;
			}
			if ((num > 100f - w) & (stageInfos.hugeFish.Length != 0))
			{
				return 4;
			}
			return 3;
		}
		if ((num < x) & (stageInfos.smallFish.Length != 0))
		{
			return 1;
		}
		if ((num > 100f - z) & (stageInfos.largeFish.Length != 0))
		{
			return 3;
		}
		return 2;
	}

	public fishSetScript getStageFishset(int grade)
	{
		int num = UnityEngine.Random.Range(1, 100);
		switch (grade)
		{
		case 1:
		{
			int num4 = 0;
			if (debugFishRate && debugFishID)
			{
				fishset = stageSmallFish[dSmallFishArrayNum].fishSet;
				break;
			}
			for (int k = 0; k < stageSmallFish.Length; k++)
			{
				if (k != 0)
				{
					num4 = stageSmallFish[k - 1].catchRatio;
				}
				if (num > num4 && num <= stageSmallFish[k].catchRatio)
				{
					fishset = stageSmallFish[k].fishSet;
				}
			}
			break;
		}
		case 2:
		{
			int num5 = 0;
			if (debugFishRate && debugFishID)
			{
				fishset = stageMiddleFish[dMiddleFishArrayNum].fishSet;
				break;
			}
			for (int l = 0; l < stageMiddleFish.Length; l++)
			{
				if (l != 0)
				{
					num5 = stageMiddleFish[l - 1].catchRatio;
				}
				if (num > num5 && num <= stageMiddleFish[l].catchRatio)
				{
					fishset = stageMiddleFish[l].fishSet;
				}
			}
			break;
		}
		case 3:
		{
			int num3 = 0;
			if (debugFishRate && debugFishID)
			{
				fishset = stageLargeFish[dLargeFishArrayNum].fishSet;
				break;
			}
			for (int j = 0; j < stageLargeFish.Length; j++)
			{
				if (j != 0)
				{
					num3 = stageLargeFish[j - 1].catchRatio;
				}
				if (num > num3 && num <= stageLargeFish[j].catchRatio)
				{
					fishset = stageLargeFish[j].fishSet;
				}
			}
			break;
		}
		case 4:
		{
			int num2 = 0;
			if (debugFishRate && debugFishID)
			{
				fishset = stageHugeFish[dHugeFishArrayNum].fishSet;
				break;
			}
			for (int i = 0; i < stageHugeFish.Length; i++)
			{
				if (i != 0)
				{
					num2 = stageHugeFish[i - 1].catchRatio;
				}
				if (num > num2 && num <= stageHugeFish[i].catchRatio)
				{
					fishset = stageHugeFish[i].fishSet;
				}
			}
			break;
		}
		default:
			fishset = stageMiddleFish[0].fishSet;
			break;
		}
		return fishset;
	}
}
public class control_fishFinder : MonoBehaviour
{
	public OVRScreenFade screenFade;

	public OVRManager oculusManager;

	private control_sound soundSetting;

	private control_Fishing fishingControl;

	private control_gpoint gpControl;

	private control_handselect handControl;

	public Canvas canvas_radar;

	public RectTransform radarPivot;

	public float tabletMenuAngle;

	public float tabletRadarAngle = 45f;

	public float tabletHideAngle = 90f;

	public float tableUpSpeed = 1f;

	public float menuRotSpeed = 1.5f;

	public float tabletMoveSpeed = 1f;

	public GameObject arGlasses;

	public bool arGlassFirstDo = true;

	private IEnumerator cTabletRotage;

	public Transform camPos;

	public Transform playerPos;

	public Vector3 posFromCam;

	public Transform tabletPivot;

	public Vector3 tabletOffset = new Vector3(0f, 0f, 0.6f);

	public Vector3 tabletRotation = new Vector3(-180f, 0f, -180f);

	public Vector3 tableHandOffset = new Vector3(0f, 0f, 0f);

	public Vector3 tabletHandRotation = new Vector3(-90f, 0f, 180f);

	private control_Fishing fishingCon;

	public GameObject tablet;

	public Image image_tabletMap;

	[HideInInspector]
	public bool isFishFinder;

	public Text[] textDistance1;

	public Text[] textDistance2;

	public Text[] textDistance3;

	public int distanceFeet = 100;

	public int distanceMeter = 30;

	private AudioSource audio;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		soundSetting = main.soundControl;
		fishingControl = main.fishingControl;
		gpControl = main.gpointControl;
		fishingCon = main.fishingControl;
		handControl = main.handControl;
	}

	private void Start()
	{
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			oculusManager.trackingOriginType = OVRManager.TrackingOrigin.EyeLevel;
		}
		else
		{
			oculusManager.trackingOriginType = OVRManager.TrackingOrigin.FloorLevel;
		}
		audio = GetComponent<AudioSource>();
		arGlasses.SetActive(value: false);
		tablet.SetActive(value: false);
		if (dataManager.userData.gameDifficulty == 0)
		{
			fishingControl.uiOnOff(onOff: true);
		}
		else
		{
			fishingControl.uiOnOff(onOff: false);
		}
		setPlayerPosition();
	}

	private void Update()
	{
		if (isFishFinder && dataManager != null)
		{
			pivotMovement();
			radarPivot.transform.localRotation = Quaternion.Euler(new Vector3(0f, 0f, base.transform.eulerAngles.y));
			base.transform.localRotation = Quaternion.Lerp(base.transform.localRotation, Quaternion.Euler(0f, camPos.transform.localEulerAngles.y, 0f), Time.deltaTime * menuRotSpeed);
			if (fishingControl.gameState == control_Fishing.EfishingState.ready && VRInput.Button_T_Click(VRInput.eController.bothhand))
			{
				gpControl.isFishShow = false;
				menuPositionSet(tabletMenuAngle);
				radarHide();
			}
		}
	}

	public void menuPositionSet(float angle)
	{
		base.transform.parent = null;
		tabletPivot.transform.localRotation = Quaternion.Euler(tabletHideAngle, 0f, 0f);
		base.transform.position = camPos.position;
		base.transform.eulerAngles = new Vector3(0f, camPos.eulerAngles.y, 0f);
		tabletPivot.localPosition = posFromCam;
		tablet.transform.localPosition = tabletOffset;
		tablet.transform.localEulerAngles = tabletRotation;
		if (cTabletRotage != null)
		{
			StopCoroutine(cTabletRotage);
		}
		tablet.SetActive(value: true);
		cTabletRotage = tabletRotate(tabletPivot.transform.localRotation, angle, show: true);
		if (dataManager.userData.unit == 0)
		{
			for (int i = 0; i < 2; i++)
			{
				textDistance1[i].text = distanceFeet + " ft";
				textDistance2[i].text = distanceFeet * 2 + " ft";
				textDistance3[i].text = distanceFeet * 3 + " ft";
			}
		}
		else
		{
			for (int j = 0; j < 2; j++)
			{
				textDistance1[j].text = distanceMeter + " m";
				textDistance2[j].text = distanceMeter * 2 + " m";
				textDistance3[j].text = distanceMeter * 3 + " m";
			}
		}
		StartCoroutine(cTabletRotage);
	}

	private void pivotMovement()
	{
		if (dataManager.targetPlatform != 0)
		{
			base.transform.position = Vector3.Lerp(base.transform.position, camPos.position, Time.deltaTime * tabletMoveSpeed);
		}
	}

	private IEnumerator tabletRotate(Quaternion startAngle, float endAngle, bool show)
	{
		float sTime = 0f;
		while (sTime <= 1f)
		{
			sTime += Time.deltaTime * tableUpSpeed;
			tabletPivot.transform.localRotation = Quaternion.Slerp(startAngle, Quaternion.Euler(endAngle, 0f, 0f), sTime);
			yield return null;
		}
		if (!show)
		{
			if (!handControl.isGlassesOn)
			{
				handControl.onOffOtherHand(On: true);
			}
			tablet.SetActive(value: false);
		}
	}

	public void radarShow()
	{
		isFishFinder = true;
		gpControl.isFishShow = true;
		menuPositionSet(tabletRadarAngle);
		canvas_radar.enabled = true;
	}

	public void radarHide()
	{
		isFishFinder = false;
		gpControl.isFishShow = false;
		if (cTabletRotage != null)
		{
			StopCoroutine(cTabletRotage);
		}
		cTabletRotage = tabletRotate(tabletPivot.transform.localRotation, tabletHideAngle, show: false);
		StartCoroutine(cTabletRotage);
	}

	private void hideTablet()
	{
		tablet.SetActive(value: false);
	}

	private void close()
	{
		isFishFinder = false;
	}

	public IEnumerator glassOn()
	{
		arGlasses.SetActive(value: true);
		handControl.setGlassesHand(glassesOn: true);
		gpControl.fishHide();
		yield return new WaitForSeconds(1.5f);
		gpControl.fishShow();
		handControl.setGlassesHand(glassesOn: false);
		arGlasses.SetActive(value: false);
	}

	private void setPlayerPosition()
	{
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			main.vrFishingPlayerController.playerTransform.position = new Vector3(0f, 1.2f + dataManager.userData.position.y * 0.2f, dataManager.userData.position.z * 0.2f);
		}
		else
		{
			main.vrFishingPlayerController.playerTransform.position = new Vector3(0f, dataManager.userData.position.y * 0.1f, dataManager.userData.position.z * 0.2f);
		}
	}
}
public class control_Fishing : MonoBehaviour
{
	public enum EfishingState
	{
		ready,
		casting,
		retrieve,
		fighting,
		landing,
		catching,
		failed
	}

	private enum eInputSwing
	{
		stay,
		fail,
		succeed
	}

	public bool debugNotFail;

	public bool debugFastFishing;

	private control_Lure lureCon;

	private control_fish fishCon;

	private control_tackle tackleCon;

	private control_fishFinder finderCon;

	private control_particle particleControl;

	private control_envrionment envCon;

	private control_gpoint gpControl;

	private control_score scoreControl;

	private control_bait baitControl;

	private control_sound soundControl;

	private control_handselect handControl;

	public EfishingState gameState;

	[Header("Fishing Control Set")]
	public float reelReleaseSpeed = 7.6f;

	public bool sharkReady;

	public int sharkAppearNumber;

	public int sharkAppearNumberMax = 10;

	[HideInInspector]
	public bool isTackleGround;

	[HideInInspector]
	public bool bCastingReady;

	public float nodeInputBaseTime = 2f;

	public float biteWaitTime = 1.5f;

	[HideInInspector]
	public float rodDragTension;

	[HideInInspector]
	public float fDistance;

	[HideInInspector]
	public float lineTension = 20f;

	[HideInInspector]
	public float fishHealth;

	public float fishHealthSpeed = 0.5f;

	public float fishDragRecoverMul = 2f;

	public float difficultyForNoUI = 0.6f;

	[HideInInspector]
	public bool bEnableHook;

	[HideInInspector]
	public bool bCountFail;

	[HideInInspector]
	public float angleX;

	public float catchedDistance = 0.6f;

	[HideInInspector]
	public int hitContinue;

	[HideInInspector]
	public float hitContinueTime;

	public float hitContinueCyleTime = 1f;

	[HideInInspector]
	public bool bReeling;

	[HideInInspector]
	public bool bDrag;

	public float dragMaxTension = 25f;

	[HideInInspector]
	public int getFish;

	[HideInInspector]
	public float tensionDifficult;

	[HideInInspector]
	public float tensionStress;

	[HideInInspector]
	public float tensionSlack;

	public float tensionAddMax = 3f;

	public float dangerTensionTime = 2f;

	public float slackLimit = 0.8f;

	[HideInInspector]
	public static bool bPause;

	public float catchDistance = 5f;

	public float catchDistanceSaltwater = 10f;

	public float noChangeDirDistanceAdd = 2f;

	private float tensionAdd;

	[HideInInspector]
	public float sDangerTension;

	private float rightDirTensionReeling = 2f;

	private float rightDirTension = 0.5f;

	private float wrongDirTensionReeling = 1f;

	private float wrongDirTension = 3f;

	private LayerMask cullingLayer;

	public float nodefailMul = 2f;

	[Header("Input Control")]
	public float hookMinSpeed = 5f;

	public float swingMinSpeed = 1f;

	public float fastretrieveTime = 1f;

	private float lastPushedTime;

	private bool isFastRetrieve;

	private Vector3 castingVector;

	private float[] castingSpeedArray;

	public float reelHapticCycle = 0.3f;

	[HideInInspector]
	public Vector2 conVelocity;

	private Quaternion conRotation;

	private Vector2 oldControllerAngle = Vector2.zero;

	public float swingSpeedMul = 1f;

	public float castMinSpeed = 1f;

	public float castMaxSpeed = 10f;

	public float castAddPower = 1.5f;

	public float reelSpeed = 1f;

	private Vector3[] rodDirectionVec;

	private Vector3 rodOldPos;

	private float castingSpeed;

	private bool pushed;

	private float fishtension = 1f;

	private float swingSpeed;

	private float sTime;

	private float Gravity;

	[Header("Get Ref Objects")]
	public Camera cam;

	public Transform pinPosition;

	public Transform playerRootPos;

	public Transform rodDirectionPos;

	public GameObject catchedPos;

	private AudioSource audios;

	public goodPointScript attractedFish;

	[HideInInspector]
	public bool isAttactedFish;

	private Collider colliderWater;

	private Rigidbody LureRig;

	[HideInInspector]
	public bool isGrabFish;

	[Header("UIs")]
	public float uiRotSpeed = 1f;

	public float uiArrowRotSpeed = 1f;

	public GameObject uiFishingSet;

	public GameObject uiRoot;

	public GameObject uiArrow;

	public GameObject uiHookL;

	public GameObject uiHookR;

	public GameObject uiTensionStress;

	public GameObject uiTensionSlack;

	public GameObject uiTensionStressGlow;

	public GameObject uiTensionSlackGlow;

	public Material TabletMaterial;

	public Material lineMaterial;

	public Color lineColorStress = Color.red;

	public Color lineColorStressSemi = Color.red;

	public Color lineColorSlack = Color.blue;

	public Color lineColorSlackSemi = Color.blue;

	public Color lineColorNormal = Color.white;

	public Color lineColorSafe = Color.green;

	public GameObject uiHookset;

	public GameObject particleRetHit;

	private uiFishIconControl uiFishIcon;

	public GameObject particleBoom;

	public Transform particlePos;

	public Transform particlePosArrow;

	public GameObject uiBar;

	public GameObject uiCautionL;

	public GameObject uiCautionR;

	private Material matArrow;

	private Material mUiStress;

	private Material mUiSlack;

	private Material mUiStressGlow;

	private Material mUiSlackGlow;

	private GameObject eCircle;

	private DataManager dataManager;

	private Main main;

	private MediaController mediaController;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		mediaController = Singleton<MediaController>.Instance;
		main = Singleton<Main>.Instance;
		lureCon = main.lureControl;
		fishCon = main.fishControl;
		tackleCon = main.tackleControl;
		finderCon = main.finderControl;
		particleControl = main.particleControl;
		envCon = main.envControl;
		gpControl = main.gpointControl;
		scoreControl = main.scoreControl;
		baitControl = main.baitControl;
		soundControl = main.soundControl;
		handControl = main.handControl;
	}

	private void Start()
	{
		if (main.enableFishing)
		{
			if (main.useTutorial)
			{
				debugNotFail = true;
			}
			rodDirectionVec = new Vector3[5];
			castingSpeedArray = new float[5];
			mUiSlack = uiTensionSlack.GetComponent<Renderer>().material;
			mUiStress = uiTensionStress.GetComponent<Renderer>().material;
			mUiSlackGlow = uiTensionSlackGlow.GetComponent<Renderer>().material;
			mUiStressGlow = uiTensionStressGlow.GetComponent<Renderer>().material;
			LureRig = lureCon.gameObject.GetComponent<Rigidbody>();
			uiFishIcon = GetComponent<uiFishIconControl>();
			uiArrow.SetActive(value: false);
			matArrow = uiArrow.GetComponent<Renderer>().material;
			audios = GetComponent<AudioSource>();
			colliderWater = envCon.col_water;
			initiate();
			gpControl.createFish(first: true);
			StartCoroutine(cGetConVelocity());
			if (envCon.stageInfos.stageType == 2 || main.isOceanBreezeStage)
			{
				catchDistance = catchDistanceSaltwater;
			}
		}
	}

	private void FixedUpdate()
	{
		if (!main.enableFishing)
		{
			return;
		}
		switch (gameState)
		{
		case EfishingState.casting:
			sTime += Time.fixedDeltaTime;
			Gravity = -9.8f * sTime * Time.fixedDeltaTime;
			castingVector += new Vector3(0f, Gravity, 0f);
			LureRig.MovePosition(LureRig.position + castingVector * Time.deltaTime);
			break;
		case EfishingState.retrieve:
			if (bPause)
			{
				break;
			}
			if (dataManager.userData.bothHand)
			{
				lureCon.retreieveMove(handControl.reelRotSpeed * 2.3f);
			}
			else if (bReeling)
			{
				if (isFastRetrieve)
				{
					lureCon.retreieveMove(2f);
				}
				else
				{
					lureCon.retreieveMove(1f);
				}
			}
			else
			{
				lureCon.retreieveMove(0f);
			}
			break;
		}
	}

	private void Update()
	{
		inputCheck();
		Vector3 position = cam.transform.position;
		if (!main.enableFishing)
		{
			return;
		}
		fDistance = Vector3.Distance(new Vector3(position.x, 0f, position.z), new Vector3(lureCon.transform.position.x, 0f, lureCon.transform.position.z));
		switch (gameState)
		{
		case EfishingState.ready:
			if (!main.isMenuOn)
			{
				if (VRInput.bInputTriggerDown(VRInput.eController.bothhand) && main.tutoControl.indicator)
				{
					glassOn();
					main.tutoControl.changeTutoState(control_tutorial.tutorialState.changeLure);
				}
				if (main.tutoControl.changelure && !isTackleGround)
				{
					lureChange();
				}
				if (bCastingReady && main.tutoControl.casting && !isTackleGround)
				{
					casting();
				}
			}
			if (!VRInput.bInputTriggerDown(VRInput.eController.mainhand) && !VRInput.bInputGrabDown(VRInput.eController.mainhand))
			{
				break;
			}
			if (main.stuffControl == null)
			{
				if (dataManager.userData.rightHand)
				{
					if (main.vrFishingPointerR.detectFishingRod())
					{
						handControl.setTackleHand();
					}
				}
				else if (main.vrFishingPointerL.detectFishingRod())
				{
					handControl.setTackleHand();
				}
			}
			else
			{
				if (main.stuffControl.isGrabItem)
				{
					break;
				}
				if (dataManager.userData.rightHand)
				{
					if (main.vrFishingPointerR.detectFishingRod())
					{
						handControl.setTackleHand();
					}
				}
				else if (main.vrFishingPointerL.detectFishingRod())
				{
					handControl.setTackleHand();
				}
			}
			break;
		case EfishingState.retrieve:
			if (bPause)
			{
				break;
			}
			if (dataManager.userData.bothHand)
			{
				tackleCon.reelWindRatio(handControl.otherHand.getReelAniTime());
				tackleCon.reelSoundBothHand(bReeling, drag: false);
				if (bReeling && main.tutoControl.reeling)
				{
					handControl.hapticDelay(1f / (handControl.reelRotSpeed * 19f + 1f), 0.03f, 0.2f, isMainhand: false);
				}
			}
			else if (bReeling && main.tutoControl.reeling)
			{
				if (isFastRetrieve)
				{
					tackleCon.reelWind(3);
				}
				else
				{
					tackleCon.reelWind(1);
				}
			}
			else
			{
				tackleCon.reelWind(0);
			}
			biteColorChange();
			if (fDistance < catchDistance)
			{
				particleControl.splashCreate();
				resetting();
			}
			break;
		case EfishingState.fighting:
		{
			controlTensionDisplay();
			getLureDirection();
			fishtension = fishCon.fishPower * 0.125f + 0.375f;
			bool flag = false;
			if (fDistance > catchDistance)
			{
				flag = true;
			}
			if (flag)
			{
				if (!bReeling)
				{
					hitContinue = 0;
					hitContinueTime = 0f;
				}
				if (dataManager.userData.bothHand)
				{
					tackleCon.reelWindRatio(handControl.otherHand.getReelAniTime());
					tackleCon.reelSoundBothHand(bReeling, bDrag);
					if (handControl.isGrabReel & bReeling)
					{
						handControl.hapticDelay(0.1f, 0.03f, lineTension * 0.002f * tensionDifficult, isMainhand: false);
					}
				}
				if (debugFastFishing && VRInput.bInputBackDown())
				{
					fishHealth *= 0.5f;
				}
				switch (lureCon.eFishing)
				{
				case control_Lure.eFishMovement.stay:
					if (lineTension < 50f - tensionStress && lineTension > tensionSlack)
					{
						handControl.hapticDelay(0.01f, 0.3f, tensionDifficult * handControl.fishHapticPower * 0.15f, isMainhand: true);
					}
					tensionDirCheck(dirCorrect: true);
					if (bReeling)
					{
						float num3 = continueHitPower();
						tackleCon.reelWind(hitContinue + 1);
						lineTension += Time.deltaTime * tackleCon.getReelSpeed() * reelReleaseSpeed * fishtension;
						if (main.tutoControl.groggy)
						{
							if (lineTension < 50f - tensionStress)
							{
								fishHealth -= Time.deltaTime * num3 * tackleCon.getRodPower() * fishHealthSpeed;
							}
							else if (!debugNotFail)
							{
								fishHealth -= Time.deltaTime * num3 * tackleCon.getRodPower() * fishHealthSpeed * 0.1f;
							}
							else
							{
								fishHealth -= Time.deltaTime * num3 * tackleCon.getRodPower() * fishHealthSpeed;
							}
						}
						if (main.useTutorial && main.tutoControl.tutoState == control_tutorial.tutorialState.linetension && lineTension < 50f - tensionStress && lineTension > tensionSlack)
						{
							if (main.tutoControl.tensionValue < main.tutoControl.tutoTensionForNext)
							{
								main.tutoControl.tensionValue += Time.deltaTime;
							}
							else
							{
								main.tutoControl.changeTutoState(control_tutorial.tutorialState.fighting);
								lureCon.tutorialNext(control_Lure.eFishMovement.right);
							}
						}
						if (fishHealth < 0f)
						{
							fishHealth = 0f;
						}
						break;
					}
					if (!bDrag)
					{
						lineTension -= Time.deltaTime * reelReleaseSpeed * 2.5f;
						tackleCon.reelWind(0);
					}
					else if (lineTension > dragMaxTension)
					{
						lineTension -= Time.deltaTime * reelReleaseSpeed;
					}
					if (main.tutoControl.groggy)
					{
						if (lineTension > tensionSlack)
						{
							fishHealth += Time.deltaTime * fishCon.fishRecovery * fishHealthSpeed;
						}
						else if (!debugNotFail)
						{
							fishHealth += Time.deltaTime * fishCon.fishRecovery * fishHealthSpeed * 5f;
						}
					}
					break;
				case control_Lure.eFishMovement.up:
				{
					if (bReeling)
					{
						tackleCon.reelWind(2);
					}
					else
					{
						tackleCon.reelWind(0);
					}
					float num = conRotation.eulerAngles.x;
					if (num < 270f)
					{
						num += 360f;
					}
					num = 360f - Mathf.Clamp(num, 270f, 360f);
					num = Mathf.Clamp(num * 0.025f, 0f, 2f);
					manageTensionFishHealth(num > 0.8f + (float)fishCon.fishGrade * 0.1f);
					break;
				}
				case control_Lure.eFishMovement.left:
				{
					if (bReeling)
					{
						tackleCon.reelWind(2);
					}
					else
					{
						tackleCon.reelWind(0);
					}
					float num5 = Mathf.Clamp(angleX * 0.025f, 0f, 2f);
					manageTensionFishHealth(num5 > 0.3f + (float)fishCon.fishGrade * 0.1f);
					break;
				}
				case control_Lure.eFishMovement.right:
				{
					if (bReeling)
					{
						tackleCon.reelWind(2);
					}
					else
					{
						tackleCon.reelWind(0);
					}
					float num4 = Mathf.Clamp((0f - angleX) * 0.025f, 0f, 2f);
					manageTensionFishHealth(num4 > 0.3f + (float)fishCon.fishGrade * 0.1f);
					break;
				}
				case control_Lure.eFishMovement.jumpL:
					if (bReeling)
					{
						tackleCon.reelWind(2);
					}
					else
					{
						tackleCon.reelWind(0);
					}
					tensionDirCheck(dirCorrect: true);
					uiArrow.SetActive(value: false);
					break;
				case control_Lure.eFishMovement.jumpR:
					if (bReeling)
					{
						tackleCon.reelWind(2);
					}
					else
					{
						tackleCon.reelWind(0);
					}
					tensionDirCheck(dirCorrect: true);
					uiArrow.SetActive(value: false);
					break;
				case control_Lure.eFishMovement.groggy:
					tensionDirCheck(dirCorrect: true);
					if (bReeling)
					{
						float num2 = continueHitPower();
						lineTension += Time.deltaTime * tackleCon.getReelSpeed() * reelReleaseSpeed * 0.5f * fishtension;
						tackleCon.reelWind(hitContinue + 1);
						if (main.tutoControl.groggy)
						{
							fishHealth -= Time.deltaTime * num2 * tackleCon.getRodPower() * fishHealthSpeed;
						}
						if (fishHealth < 0f)
						{
							fishHealth = 0f;
						}
					}
					else
					{
						tackleCon.reelWind(0);
						if (lineTension > tensionSlack + 2f)
						{
							lineTension -= Time.deltaTime * reelReleaseSpeed * 1.5f;
						}
					}
					uiArrow.SetActive(value: false);
					break;
				case control_Lure.eFishMovement.angry:
					tensionDirCheck(dirCorrect: true);
					handControl.hapticDelay(0.02f, 0.05f, tensionDifficult * handControl.fishHapticPower * 1f, isMainhand: true);
					if (bReeling)
					{
						continueHitPower();
						lineTension += Time.deltaTime * tackleCon.getReelSpeed() * reelReleaseSpeed * 1.5f * fishtension;
						if (bReeling)
						{
							tackleCon.reelWind(1);
						}
						else
						{
							tackleCon.reelWind(4);
						}
						if (main.tutoControl.groggy)
						{
							fishHealth -= Time.deltaTime * tackleCon.getRodPower() * 0.3f * fishHealthSpeed;
						}
						if (fishHealth < 0f)
						{
							fishHealth = 0f;
						}
					}
					else
					{
						tackleCon.reelWind(4);
						fishHealth += Time.deltaTime * fishCon.fishRecovery * fishDragRecoverMul * fishHealthSpeed;
						if (lineTension > dragMaxTension)
						{
							lineTension -= Time.deltaTime * reelReleaseSpeed * 0.3f;
						}
						else
						{
							lineTension += Time.deltaTime * tackleCon.getReelSpeed() * reelReleaseSpeed * 0.3f * fishtension;
						}
					}
					uiArrow.SetActive(value: false);
					break;
				case control_Lure.eFishMovement.landing:
					tackleCon.reelWind(0);
					tensionDirCheck(dirCorrect: true);
					break;
				}
				if (lineTension > 50f)
				{
					lineTension = 50f;
				}
				if (lineTension < 0f)
				{
					lineTension = 0f;
				}
				if (lineTension >= 50f - tensionStress)
				{
					handControl.hapticDelay(0.05f, 0.05f, tensionDifficult * handControl.fishHapticPower * 1f, isMainhand: true);
					if (fishCon.fishGrade != 1)
					{
						sDangerTension += Time.deltaTime;
					}
					if (dataManager.userData.gameDifficulty == 0)
					{
						uiCautionR.SetActive(value: true);
						uiCautionL.SetActive(value: false);
					}
					if (dataManager.userData.lineEfffect)
					{
						lineMaterial.SetColor("_Color", lineColorStress);
					}
				}
				else if (lineTension <= tensionSlack)
				{
					handControl.hapticStop(isMainhand: true);
					if (fishCon.fishGrade != 1)
					{
						sDangerTension += Time.deltaTime * slackLimit;
					}
					if (dataManager.userData.gameDifficulty == 0)
					{
						uiCautionL.SetActive(value: true);
						uiCautionR.SetActive(value: false);
					}
					if (dataManager.userData.lineEfffect)
					{
						lineMaterial.SetColor("_Color", lineColorSlack);
					}
				}
				else
				{
					sDangerTension = 0f;
					if (dataManager.userData.gameDifficulty == 0)
					{
						uiCautionR.SetActive(value: false);
						uiCautionL.SetActive(value: false);
					}
					if (dataManager.userData.lineEfffect)
					{
						if (lineTension >= 45f - tensionStress)
						{
							lineMaterial.SetColor("_Color", lineColorStressSemi);
						}
						else if (lineTension <= tensionSlack + 5f)
						{
							lineMaterial.SetColor("_Color", lineColorSlackSemi);
						}
						else if (lureCon.eFishing == control_Lure.eFishMovement.groggy)
						{
							lineMaterial.SetColor("_Color", lineColorSafe);
						}
						else
						{
							lineMaterial.SetColor("_Color", lineColorNormal);
						}
					}
				}
				if (lureCon.eFishing != control_Lure.eFishMovement.jumpL && lureCon.eFishing != control_Lure.eFishMovement.jumpR)
				{
					if (fDistance > tackleCon.getReelLength())
					{
						lineBreakFail();
					}
					if (sDangerTension > dangerTensionTime && !debugNotFail)
					{
						lineBreakFail();
					}
				}
			}
			else
			{
				gameState = EfishingState.landing;
				main.tutoControl.changeTutoState(control_tutorial.tutorialState.landing);
				if (fishCon.isFish)
				{
					particleControl.waterParticleControl();
				}
				handControl.hapticStop(isMainhand: true);
			}
			renderLineTension();
			break;
		}
		case EfishingState.landing:
			lureCon.eFishing = control_Lure.eFishMovement.landing;
			handControl.haptic(0.7f, tensionDifficult * handControl.fishHapticPower * 0.5f, isMainhand: true);
			lureCon.landing();
			uiCautionR.SetActive(value: false);
			uiCautionL.SetActive(value: false);
			uiHookset.SetActive(value: true);
			uiFishingSet.SetActive(value: false);
			lureCon.stopMoving();
			if (dataManager.userData.lineEfffect)
			{
				lineMaterial.SetColor("_Color", lineColorSafe);
			}
			if (main.tutoControl.landing && checkControllerSwing(0, hookMinSpeed) == eInputSwing.succeed && !lureCon.getIsFishJump())
			{
				gameState = EfishingState.catching;
				CatchedJump();
			}
			break;
		case EfishingState.catching:
			if (!fishCon.fishHuge && fishCon.fishInst != null)
			{
				fishCon.fishInst.fishPivot.localEulerAngles = new Vector3(0f, 0f, 120f * Time.deltaTime * inputTouchLeftRight() + fishCon.fishInst.fishPivot.localEulerAngles.z);
			}
			break;
		case EfishingState.failed:
			particleControl.waterParticleControl();
			attractedFish = null;
			gpControl.fishReset();
			reset();
			StartCoroutine(lureCon.lureFailReset());
			break;
		case EfishingState.casting:
			break;
		}
	}

	private void resetting()
	{
		particleControl.waterParticleControl();
		lureCon.lureReset();
		reset();
	}

	private float continueHitPower()
	{
		if (hitContinue < 2)
		{
			hitContinueTime += Time.deltaTime;
			if (hitContinueTime > hitContinueCyleTime)
			{
				hitContinueTime = 0f;
				hitContinue++;
				uiFishIcon.hitContinue(hitContinue);
			}
		}
		return 1f + (float)hitContinue * 0.3f;
	}

	private void glassOn()
	{
		bCastingReady = true;
		if (finderCon.arGlassFirstDo && dataManager.userData.gameDifficulty == 0)
		{
			StartCoroutine(finderCon.glassOn());
			finderCon.arGlassFirstDo = false;
		}
		else if (dataManager.userData.gameDifficulty != 2)
		{
			gpControl.fishShow();
		}
	}

	private void manageTensionFishHealth(bool rightDirection)
	{
		if (rightDirection)
		{
			tensionDirCheck(dirCorrect: true);
			tensionControl(bRight: true);
			handControl.hapticStay(tensionDifficult * handControl.fishHapticPower * 0.5f, isMainhand: true);
			if (dataManager.userData.gameDifficulty == 0)
			{
				if (fishCon.fishGrade >= 2)
				{
					rodDragTension += Time.deltaTime * 1.2f;
				}
				else
				{
					rodDragTension += Time.deltaTime;
				}
			}
			else if (fishCon.fishGrade >= 2)
			{
				rodDragTension += Time.deltaTime * difficultyForNoUI * 1.2f;
			}
			else
			{
				rodDragTension += Time.deltaTime * difficultyForNoUI;
			}
			float num = nodeInputBaseTime + fishCon.fishPower * 0.3f - tackleCon.getRodAction();
			if (rodDragTension > num)
			{
				fightingNodeSucceed();
			}
			float x = 0.16f - rodDragTension / num * 0.62f;
			matArrow.SetTextureOffset("_BackTex", new Vector2(x, 0f));
			if (!main.tutoControl.groggy)
			{
				return;
			}
			if (bReeling)
			{
				fishHealth -= Time.deltaTime * tackleCon.getRodPower() * fishHealthSpeed * 0.5f;
				if (fishHealth < 0f)
				{
					fishHealth = 0f;
				}
			}
			else
			{
				fishHealth += Time.deltaTime * fishCon.fishRecovery * fishHealthSpeed * 0.5f;
			}
			return;
		}
		tensionDirCheck(dirCorrect: false);
		tensionControl(bRight: false);
		if (lineTension < 50f - tensionStress && lineTension > tensionSlack)
		{
			handControl.hapticDelay(0.01f, 0.3f, tensionDifficult * handControl.fishHapticPower * 0.15f, isMainhand: true);
		}
		rodDragTension -= Time.deltaTime * 0.2f;
		if (rodDragTension < 0f)
		{
			rodDragTension = 0f;
		}
		float num2 = nodeInputBaseTime + fishCon.fishPower * 0.3f - tackleCon.getRodAction();
		float x2 = 0.16f - rodDragTension / num2 * 0.62f;
		matArrow.SetTextureOffset("_BackTex", new Vector2(x2, 0f));
		if (!main.tutoControl.groggy)
		{
			return;
		}
		if (bReeling)
		{
			fishHealth -= Time.deltaTime * tackleCon.getRodPower() * fishHealthSpeed * 0.8f;
			if (fishHealth < 0f)
			{
				fishHealth = 0f;
			}
		}
		else
		{
			fishHealth += Time.deltaTime * fishCon.fishRecovery * fishHealthSpeed * 2f;
		}
	}

	public bool casting()
	{
		swingSpeed = new Vector2(VRInput.GetLocalControllerAcceleration(VRInput.eController.mainhand).x, VRInput.GetLocalControllerAcceleration(VRInput.eController.mainhand).z).sqrMagnitude * swingSpeedMul;
		if (VRInput.bInputTriggerDown(VRInput.eController.mainhand))
		{
			tackleCon.bailOpen();
			tackleCon.isBailOpen = true;
			castingSpeed = 0f;
			for (int i = 0; i < rodDirectionVec.Length; i++)
			{
				rodDirectionVec[i] = rodDirectionPos.position;
			}
			rodOldPos = rodDirectionPos.position;
		}
		if (VRInput.bInputTrigger(VRInput.eController.mainhand))
		{
			Vector3 vector = rodDirectionPos.position - rodOldPos;
			castingSpeedArray[0] = castingSpeedArray[1];
			castingSpeedArray[1] = castingSpeedArray[2];
			castingSpeedArray[2] = castingSpeedArray[3];
			castingSpeedArray[3] = castingSpeedArray[4];
			castingSpeedArray[4] = swingSpeed;
			Vector3.Angle(vector, rodDirectionVec[4]);
			if (vector.z > 0f)
			{
				rodDirectionVec[0] = rodDirectionVec[1];
				rodDirectionVec[1] = rodDirectionVec[2];
				rodDirectionVec[2] = rodDirectionVec[3];
				rodDirectionVec[3] = rodDirectionVec[4];
				rodDirectionVec[4] = vector;
			}
			rodOldPos = rodDirectionPos.position;
		}
		if (VRInput.bInputTriggerUp(VRInput.eController.mainhand))
		{
			tackleCon.isBailOpen = false;
			Vector3 vector2 = Vector3.zero;
			for (int j = 0; j < rodDirectionVec.Length; j++)
			{
				vector2 = new Vector3(rodDirectionVec[j].x, 0f, rodDirectionVec[j].z) + vector2;
			}
			if (tackleCon.transform.forward.z > 0f)
			{
				float t = Mathf.Abs(rodDirectionPos.position.y - tackleCon.transform.position.y) * 0.5f;
				vector2 = Vector3.Lerp(new Vector3(tackleCon.transform.forward.x, 0f, tackleCon.transform.forward.z), vector2, t);
			}
			Vector3 vector3 = Vector3.Normalize(vector2) + new Vector3(0f, 0.3f, 0f);
			if (swingSpeed > castMinSpeed && vector3.z > 0f)
			{
				bCastingReady = false;
				for (int k = 0; k < castingSpeedArray.Length; k++)
				{
					castingSpeed += castingSpeedArray[k];
				}
				castingSpeed *= 0.2f;
				castingSpeed += castAddPower;
				if (castingSpeed > castMaxSpeed + tackleCon.getRodDistance())
				{
					castingSpeed = castMaxSpeed + tackleCon.getRodDistance();
				}
				castingVector = vector3 * castingSpeed;
				if (dataManager.userData.gameDifficulty == 1)
				{
					finderCon.radarHide();
				}
				gameState = EfishingState.casting;
				MultiplayEventManager.Instance.SendFishState(FishState.Casting);
				LureRig.isKinematic = true;
				return true;
			}
			tackleCon.bailClose();
		}
		return false;
	}

	public void lureChange()
	{
		if (VRInput.Touch_Left_Click(VRInput.eController.bothhand))
		{
			if (!mediaController.isDistanceAdjustableR && !mediaController.isDistanceAdjustableL && !mediaController.isPositionAdjustableR && !mediaController.isPositionAdjustableL && !mediaController.isScaleAdjustableR && !mediaController.isScaleAdjustableL && !mediaController.isAlphaAdjustable && !mediaController.isColorAdjustable)
			{
				if (!bCastingReady)
				{
					glassOn();
				}
				else
				{
					gpControl.fishShow();
				}
				tackleCon.ChangeLure(-1);
				tackleCon.ShowHideLure(show: true);
				audios.Play();
				gpControl.changeLure();
				main.tutoControl.changeTutoState(control_tutorial.tutorialState.casting);
			}
		}
		else if (VRInput.Touch_Right_Click(VRInput.eController.bothhand) && !mediaController.isDistanceAdjustableR && !mediaController.isDistanceAdjustableL && !mediaController.isPositionAdjustableR && !mediaController.isPositionAdjustableL && !mediaController.isScaleAdjustableR && !mediaController.isScaleAdjustableL && !mediaController.isAlphaAdjustable && !mediaController.isColorAdjustable)
		{
			if (!bCastingReady)
			{
				glassOn();
			}
			else
			{
				gpControl.fishShow();
			}
			tackleCon.ChangeLure(1);
			tackleCon.ShowHideLure(show: true);
			audios.Play();
			gpControl.changeLure();
			main.tutoControl.changeTutoState(control_tutorial.tutorialState.casting);
		}
	}

	private void tensionControl(bool bRight)
	{
		if (bRight)
		{
			tensionDirCheck(dirCorrect: true);
			if (bReeling)
			{
				lineTension += Time.deltaTime * tackleCon.getReelSpeed() * reelReleaseSpeed * rightDirTensionReeling * fishtension;
			}
			else
			{
				lineTension -= Time.deltaTime * reelReleaseSpeed * rightDirTension;
			}
		}
		else
		{
			tensionDirCheck(dirCorrect: false);
			if (bReeling)
			{
				lineTension += Time.deltaTime * tackleCon.getReelSpeed() * reelReleaseSpeed * wrongDirTensionReeling * fishtension;
			}
			else
			{
				lineTension -= Time.deltaTime * reelReleaseSpeed * wrongDirTension;
			}
		}
	}

	private void tensionDirCheck(bool dirCorrect)
	{
		if (dirCorrect)
		{
			tensionAdd -= Time.deltaTime * 10f;
			if (tensionAdd <= 0f)
			{
				tensionAdd = 0f;
			}
		}
		else
		{
			tensionAdd += Time.deltaTime * 5f;
			if (tensionAdd > tensionAddMax)
			{
				tensionAdd = tensionAddMax;
			}
		}
		tensionSlack = tensionDifficult * tackleCon.getLureStuck() + tensionAdd;
		mUiSlack.SetTextureOffset("_MainTex", new Vector2(tensionSlack * 0.02f, 0f));
		mUiSlackGlow.SetTextureOffset("_MainTex", new Vector2(tensionSlack * 0.02f, 0f));
	}

	private void lineBreakFail()
	{
		MultiplayEventManager.Instance.SendFishState(FishState.Fail);
		particleControl.splashCreate();
		lureCon.failedCatch(fishCon.fishID);
		gameState = EfishingState.failed;
		tackleCon.ShowHideLure(show: true);
		particleControl.waterParticleControl();
		handControl.hapticStop(isMainhand: true);
		if (PhotonNetwork.IsConnected)
		{
			MultiplayManager.Instance.localFish.RemoveFish();
		}
	}

	public IEnumerator turnArrow(float angle, bool lerp)
	{
		float time = 0f;
		while (time < 1f)
		{
			if (lerp)
			{
				uiArrow.transform.localRotation = Quaternion.Slerp(uiArrow.transform.localRotation, Quaternion.Euler(0f, 0f, angle), Time.deltaTime * uiArrowRotSpeed);
			}
			else
			{
				uiArrow.transform.localRotation = Quaternion.Euler(0f, 0f, angle);
			}
			time += Time.deltaTime;
			yield return null;
		}
	}

	private IEnumerator iHookset(int fishGrade, fishSetScript fishset, bool bFish)
	{
		main.tutoControl.changeTutoState(control_tutorial.tutorialState.hookSet);
		uiHookset.SetActive(value: true);
		float hookTime = 0f;
		bool loop = true;
		while (loop)
		{
			if (!main.useTutorial)
			{
				hookTime += Time.deltaTime;
				if (hookTime > biteWaitTime)
				{
					loop = false;
				}
			}
			if (attractedFish != null)
			{
				if (attractedFish.bEnableHookset && main.tutoControl.hookset && checkControllerSwing(0, hookMinSpeed) == eInputSwing.succeed)
				{
					particleControl.effectCircleStop();
					uiHookset.SetActive(value: false);
					soundControl.sEffectAudio.clip = soundControl.soundHookset[fishGrade - 1];
					soundControl.sEffectAudio.Play();
					particleControl.splashParitcleRight(isRight: false, 0.5f, lureCon.transform.position);
					gameState = EfishingState.fighting;
					particleControl.waterParticleControl();
					uiFishIcon.uiShow();
					gpControl.isFishShow = false;
					uiFishingSet.SetActive(value: true);
					setDifficulyAndShark(fishGrade, fishset, bFish);
					handControl.haptic(1.5f, tensionDifficult * handControl.fishHapticPower * 0.5f, isMainhand: true);
					tackleCon.ShowHideLure(show: false);
					main.tutoControl.changeTutoState(control_tutorial.tutorialState.linetension);
					MultiplayEventManager.Instance.SendFishState(FishState.Hookset);
					yield break;
				}
			}
			else
			{
				loop = false;
			}
			yield return null;
		}
		particleControl.particleOff();
		particleControl.effectCircleCreate();
		attractedFish = null;
		gpControl.hookFailed();
		bEnableHook = false;
		uiHookset.SetActive(value: false);
	}

	public void setDifficulyAndShark(int fishGrade, fishSetScript fishset, bool bFish)
	{
		if (fishGrade < 4)
		{
			if (envCon.stageInfos.sharkRatio > (float)UnityEngine.Random.Range(0, 100))
			{
				sharkReady = true;
				sharkAppearNumber = UnityEngine.Random.Range(2, sharkAppearNumberMax);
			}
			else
			{
				sharkReady = false;
			}
		}
		tensionDifficult = lureCon.setFish(fishGrade, fishset, isShark: false, bFish) * 2f;
		tensionStress = tensionDifficult * tackleCon.getReelPower() * 1.5f;
		tensionSlack = tensionDifficult * tackleCon.getLureStuck();
	}

	public void changeToShark()
	{
		tensionDifficult = lureCon.setFish(fishCon.stageHugeFish[0].fishSet.fishInfo.grade, fishCon.stageHugeFish[0].fishSet, isShark: true, bFish: true) * 2f;
		tensionStress = tensionDifficult * tackleCon.getReelPower() * 1.5f;
		tensionSlack = tensionDifficult * tackleCon.getLureStuck();
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
		{
			int iD = fishCon.stageHugeFish[0].fishSet.fishInfo.ID;
			MultiplayManager.Instance.localFish.fishID = iD;
			MultiplayEventManager.Instance.SendInstantiationFishEvent(iD);
		}
	}

	public void hitWater()
	{
		if (gameState == EfishingState.casting)
		{
			main.tutoControl.changeTutoState(control_tutorial.tutorialState.reeling);
			if (!dataManager.userData.bothHand)
			{
				handControl.setHandleHand(OnOff: true);
			}
			gameState = EfishingState.retrieve;
			particleControl.effectCircleCreate();
			if (colliderWater != null)
			{
				colliderWater.enabled = false;
			}
			particleControl.waterParticleControl();
		}
	}

	public void hitGround()
	{
		if (gameState == EfishingState.casting)
		{
			lureCon.transform.position = pinPosition.position;
			reset();
		}
	}

	public Vector3 getLureDirection()
	{
		Vector3 vector = Vector3.Normalize(lureCon.gameObject.transform.position - tackleCon.transform.position);
		Vector3 result = Quaternion.AngleAxis(tackleCon.transform.eulerAngles.x, tackleCon.transform.forward) * (tackleCon.transform.forward - vector);
		Vector3 vector2 = new Vector3(vector.x, 0f, vector.z);
		Vector3 vector3 = new Vector3(tackleCon.transform.forward.x, 0f, tackleCon.transform.forward.z);
		angleX = Vector3.Angle(vector2, vector3);
		if (Vector3.Cross(vector2, vector3).y < 0f)
		{
			angleX = 0f - angleX;
		}
		return result;
	}

	private void renderLineTension()
	{
		uiBar.transform.localEulerAngles = new Vector3(0f, 0f, lineTension * 6f);
	}

	private void fightingNodeSucceed()
	{
		rodDragTension = 0f;
		uiFishIcon.hit();
		handControl.hapticStop(isMainhand: true);
		handControl.haptic(0.3f, tensionDifficult * handControl.fishHapticPower, isMainhand: true);
		lureCon.groggyNum++;
		particleControl.splashParitcleRight(isRight: false, 0.5f, lureCon.transform.position);
		soundControl.sEffectAudio.clip = soundControl.soundDrag;
		soundControl.sEffectAudio.Play();
		lureCon.stopDirectionReset();
		UnityEngine.Object.Instantiate(particleRetHit, particlePosArrow.position, particlePosArrow.rotation).transform.localScale = particlePosArrow.localScale * 0.5f;
		if (lineTension > tensionSlack + 10f)
		{
			lineTension = tensionSlack + 10f;
		}
		main.tutoControl.changeTutoState(control_tutorial.tutorialState.jump);
		if (main.useTutorial)
		{
			lureCon.tutorialNext(control_Lure.eFishMovement.stay);
		}
	}

	public void fightingNodeFailed()
	{
		handControl.hapticStop(isMainhand: true);
		soundControl.sEffectAudio.clip = soundControl.soundFailed;
		soundControl.sEffectAudio.Play();
		rodDragTension = 0f;
		lineTension += 10f;
		if (lineTension > 50f)
		{
			lineTension = 50f;
		}
		if (!main.useTutorial)
		{
			StartCoroutine(fishHealRecover());
		}
	}

	private IEnumerator fishHealRecover()
	{
		float stime = 0f;
		particleControl.particleOn();
		while (stime < 0.5f)
		{
			stime += Time.deltaTime;
			if (fishHealth <= 0f)
			{
				break;
			}
			fishHealth += fishCon.fishRecovery * fishHealthSpeed * nodefailMul * Time.deltaTime * lureCon.healthRatio;
			yield return null;
		}
		particleControl.particleOff();
	}

	private eInputSwing checkControllerSwing(int direction, float speed)
	{
		eInputSwing result = eInputSwing.stay;
		switch (direction)
		{
		case 0:
			if (conVelocity.y > speed)
			{
				result = eInputSwing.succeed;
			}
			break;
		case 1:
			if (conVelocity.y < 0f - speed)
			{
				result = eInputSwing.succeed;
			}
			break;
		case 2:
			if (conVelocity.x < 0f - speed)
			{
				result = eInputSwing.succeed;
			}
			else if (conVelocity.x > speed)
			{
				result = eInputSwing.fail;
			}
			break;
		case 3:
			if (conVelocity.x > speed)
			{
				result = eInputSwing.succeed;
			}
			else if (conVelocity.x < 0f - speed)
			{
				result = eInputSwing.fail;
			}
			break;
		}
		return result;
	}

	public IEnumerator countCheck(int direction)
	{
		float time2 = 0f;
		bool bContinue = true;
		while (time2 < 0.9f && bContinue)
		{
			time2 += Time.deltaTime;
			switch (direction)
			{
			case 0:
				if (checkControllerSwing(3, swingMinSpeed) == eInputSwing.succeed)
				{
					countSucceed(1);
					uiHookL.SetActive(value: false);
					uiHookR.SetActive(value: false);
					if (main.useTutorial)
					{
						main.tutoControl.changeTutoState(control_tutorial.tutorialState.groggy);
						lureCon.tutorialNext(control_Lure.eFishMovement.groggy);
					}
					yield break;
				}
				if (checkControllerSwing(3, swingMinSpeed * 2f) == eInputSwing.fail)
				{
					uiHookL.SetActive(value: false);
					uiHookR.SetActive(value: false);
					bContinue = false;
				}
				break;
			case 1:
				if (checkControllerSwing(2, swingMinSpeed) == eInputSwing.succeed)
				{
					countSucceed(-1);
					uiHookL.SetActive(value: false);
					uiHookR.SetActive(value: false);
					if (main.useTutorial)
					{
						main.tutoControl.changeTutoState(control_tutorial.tutorialState.groggy);
						lureCon.tutorialNext(control_Lure.eFishMovement.groggy);
					}
					yield break;
				}
				if (checkControllerSwing(2, swingMinSpeed * 2f) == eInputSwing.fail)
				{
					uiHookL.SetActive(value: false);
					uiHookR.SetActive(value: false);
					bContinue = false;
				}
				break;
			}
			yield return null;
		}
		yield return new WaitForSeconds(0.3f);
		lureCon.fishAngryCount();
		bCountFail = true;
		time2 = 0f;
		particleControl.particleOn();
		lineTension -= 10f;
		if (lineTension < 0f)
		{
			lineTension = 0f;
		}
		if (!main.useTutorial)
		{
			while (time2 < 1f)
			{
				time2 += Time.deltaTime;
				if (fishHealth <= 0f)
				{
					break;
				}
				fishHealth += fishCon.fishRecovery * fishHealthSpeed * nodefailMul * Time.deltaTime;
				yield return null;
			}
		}
		particleControl.particleOff();
	}

	private void countSucceed(int direction)
	{
		handControl.haptic(0.3f, 1f, isMainhand: true);
		bCountFail = false;
		uiFishIcon.hit();
		lureCon.groggyNum += 2;
		lineTension = 20f;
		if (lineTension < tensionSlack)
		{
			lineTension = tensionSlack + 5f;
		}
		soundControl.sEffectAudio.clip = soundControl.soundCountSucceed;
		soundControl.sEffectAudio.Play();
		GameObject gameObject = UnityEngine.Object.Instantiate(particleBoom, particlePos.position, particlePos.rotation);
		gameObject.transform.parent = uiFishingSet.transform;
		if (direction == -1)
		{
			gameObject.transform.localScale = new Vector3(uiFishingSet.transform.localScale.x, uiFishingSet.transform.localScale.y, uiFishingSet.transform.localScale.z);
		}
		else
		{
			gameObject.transform.localScale = new Vector3(0f - uiFishingSet.transform.localScale.x, uiFishingSet.transform.localScale.y, uiFishingSet.transform.localScale.z);
		}
		if (main.tutoControl.groggy)
		{
			fishHealth -= tackleCon.getRodPower() * fishHealthSpeed * 2f;
		}
		if (fishHealth < 0f)
		{
			fishHealth = 0f;
		}
	}

	private void CatchedJump()
	{
		if (dataManager.userData.lineEfffect)
		{
			lineMaterial.SetColor("_Color", lineColorNormal);
		}
		lureCon.changeCurLength(fDistance * 0.4f);
		soundControl.sEffectAudio.clip = soundControl.soundCatched;
		soundControl.sEffectAudio.Play();
		tackleCon.rodSoundStop();
		particleControl.bigsplashCreate(lureCon.transform.position, fishCon.fishSize * 0.02f);
		if (fishCon.fishHuge)
		{
			handControl.setLandingCatchHand();
		}
		else
		{
			fishCon.fishInst.fishCatched();
			catchedPos.SetActive(value: true);
			if (dataManager.userData.bothHand)
			{
				if (dataManager.userData.rightHand)
				{
					catchedPos.transform.position = handControl.lefthandControl.transform.position;
				}
				else
				{
					catchedPos.transform.position = handControl.righthandControl.transform.position;
				}
				catchedPos.transform.rotation = Quaternion.identity;
				handControl.setJumpCatchHand(On: true);
			}
			else
			{
				catchedPos.transform.position = new Vector3(cam.transform.position.x, cam.transform.position.y, cam.transform.position.z + catchedDistance);
				catchedPos.transform.rotation = Quaternion.identity;
			}
		}
		lureCon.catchedJump();
		particleControl.waterParticleControl();
		lureCon.audioStop();
		soundControl.BGM.Stop();
		uiArrow.SetActive(value: false);
		uiHookL.SetActive(value: false);
		uiHookR.SetActive(value: false);
		uiHookset.SetActive(value: false);
		uiFishingSet.SetActive(value: false);
	}

	public void SelectCatchOrRelease()
	{
		Singleton<AchievementController>.Instance.checkUpgrade(7);
		if (envCon.envTime == 1)
		{
			Singleton<AchievementController>.Instance.checkUpgrade(2);
		}
		else if (envCon.envTime == 2)
		{
			Singleton<AchievementController>.Instance.checkUpgrade(3);
		}
		else if (envCon.envTime == 3)
		{
			Singleton<AchievementController>.Instance.checkUpgrade(4);
		}
		else if (envCon.envTime == 4)
		{
			Singleton<AchievementController>.Instance.checkUpgrade(5);
		}
		if (fishCon.fishGrade == 3)
		{
			Singleton<AchievementController>.Instance.checkUpgrade(9);
		}
		if (fishCon.fishGrade == 4)
		{
			Singleton<AchievementController>.Instance.checkUpgrade(13);
		}
		if (fishCon.fishRare)
		{
			Singleton<AchievementController>.Instance.checkUpgrade(11);
		}
		if (fishCon.fishID == 25)
		{
			Singleton<AchievementController>.Instance.checkUpgrade(12);
			AnalyticsEvent.Custom("fishCount", new Dictionary<string, object> { { "tigerShark", 1 } });
		}
		dataManager.userData.fishTotal++;
		dataManager.userData.fishes[dataManager.currentNation].fishCount[fishCon.fishID]++;
		if (fishCon.fishWeight > dataManager.userData.fishes[dataManager.currentNation].maxWeight[fishCon.fishID])
		{
			dataManager.userData.fishes[dataManager.currentNation].maxWeight[fishCon.fishID] = fishCon.fishWeight;
		}
		if (fishCon.fishSize > dataManager.userData.fishes[dataManager.currentNation].maxSize[fishCon.fishID])
		{
			dataManager.userData.fishes[dataManager.currentNation].maxSize[fishCon.fishID] = fishCon.fishSize;
		}
		scoreControl.scoreShow(fishCon.fishName, fishCon.fishID, fishCon.fishSize, fishCon.fishBonus, fishCon.fishWeight, fishCon.fishRare, new Vector3(cam.transform.position.x, cam.transform.position.y, cam.transform.position.z + catchedDistance));
		main.tutoControl.changeTutoState(control_tutorial.tutorialState.keepRelease);
	}

	public void ChooseKeepRelease()
	{
		if (attractedFish != null)
		{
			attractedFish.destory();
		}
		attractedFish = null;
		main.tutoControl.changeTutoState(control_tutorial.tutorialState.menu);
	}

	public void ReleaseFish(bool release)
	{
		if (release)
		{
			if (fishCon.fishGrade == 1)
			{
				UnityEngine.Object.Instantiate(particleControl.releaseSplash_small, envCon.releasePos.position, Quaternion.identity);
			}
			else if (fishCon.fishGrade == 3)
			{
				UnityEngine.Object.Instantiate(particleControl.releaseSplash_large, envCon.releasePos.position, Quaternion.identity);
			}
			else if (fishCon.fishGrade == 4)
			{
				UnityEngine.Object.Instantiate(particleControl.releaseSplash_large, envCon.releasePos.position, Quaternion.identity);
			}
			else
			{
				UnityEngine.Object.Instantiate(particleControl.releaseSplash_middle, envCon.releasePos.position, Quaternion.identity);
			}
			fishCon.fishInst.release(envCon.releasePos);
		}
		else
		{
			fishCon.fishInst.destroy();
		}
	}

	public void fishCatchLure(goodPointScript fish, bool bFish)
	{
		if (attractedFish == null)
		{
			attractedFish = fish;
			bEnableHook = true;
			particleControl.particleOn();
			StartCoroutine(iHookset(fish.GpGrade, fish.fishSet, bFish));
			handControl.haptic(0.6f, tensionDifficult * handControl.fishHapticPower * 1.5f, isMainhand: true);
			if (dataManager.userData.lineEfffect)
			{
				lineMaterial.SetColor("_Color", lineColorStress);
			}
		}
	}

	private void controlTensionDisplay()
	{
		mUiStress.SetTextureOffset("_MainTex", new Vector2(tensionStress * 0.02f, 0f));
		mUiSlack.SetTextureOffset("_MainTex", new Vector2(tensionSlack * 0.02f, 0f));
		mUiStressGlow.SetTextureOffset("_MainTex", new Vector2(tensionStress * 0.02f, 0f));
		mUiSlackGlow.SetTextureOffset("_MainTex", new Vector2(tensionSlack * 0.02f, 0f));
	}

	public void BGMplay()
	{
		if ((dataManager.userData.mediaState == 0 || dataManager.userData.mediaState == 1) && !dataManager.isPlayingMusic)
		{
			soundControl.BGM.Play();
		}
	}

	public void biteColorChange()
	{
		if (bEnableHook)
		{
			if (dataManager.userData.lineEfffect)
			{
				lineMaterial.SetColor("_Color", lineColorStress);
			}
			isAttactedFish = true;
		}
		else if (gpControl.checkAttracted())
		{
			if (dataManager.userData.lineEfffect)
			{
				lineMaterial.SetColor("_Color", lineColorStressSemi);
			}
			isAttactedFish = true;
		}
		else
		{
			if (dataManager.userData.lineEfffect)
			{
				lineMaterial.SetColor("_Color", lineColorNormal);
			}
			isAttactedFish = false;
		}
	}

	public void uiOnOff(bool onOff)
	{
		if (onOff)
		{
			cullingLayer = 1 << LayerMask.NameToLayer("MyAvatar");
			cam.cullingMask = ~(int)cullingLayer;
		}
		else
		{
			cullingLayer = (1 << LayerMask.NameToLayer("UI")) | (1 << LayerMask.NameToLayer("MyAvatar"));
			cam.cullingMask = ~(int)cullingLayer;
		}
	}

	public void initiate()
	{
		attractedFish = null;
		catchedPos.SetActive(value: false);
		oldControllerAngle = Vector2.zero;
		isFastRetrieve = false;
		bCastingReady = false;
		sharkReady = false;
		hitContinueTime = 0f;
		hitContinue = 0;
		sDangerTension = 0f;
		tensionAdd = 0f;
		uiCautionR.SetActive(value: false);
		uiCautionL.SetActive(value: false);
		colliderWater.enabled = true;
		swingSpeed = 0f;
		bDrag = false;
		bCountFail = false;
		lineMaterial.SetColor("_Color", lineColorNormal);
		sTime = 0f;
		lureCon.reset();
		uiFishIcon.reset();
		uiArrow.SetActive(value: false);
		uiHookL.SetActive(value: false);
		uiHookR.SetActive(value: false);
		uiHookset.SetActive(value: false);
		uiFishingSet.SetActive(value: false);
		bEnableHook = false;
		lineTension = 20f;
		soundControl.BGM.Stop();
		gameState = EfishingState.ready;
		particleControl.waterParticleControl();
		isAttactedFish = false;
		particleControl.effectCircleStop();
		handControl.isRotating = false;
		handControl.reelRotSpeed = 0f;
		handControl.bStayHaptic = false;
		handControl.isHapticM = false;
		handControl.isHapticS = false;
		sharkReady = false;
		for (int i = 0; i < castingSpeedArray.Length; i++)
		{
			castingSpeedArray[i] = 0f;
		}
	}

	public void reset()
	{
		tackleCon.reelSoundBothHand(reeling: false, drag: false);
		if (!dataManager.userData.bothHand)
		{
			handControl.setHandleHand(OnOff: false);
		}
		if (dataManager.userData.gameDifficulty == 1)
		{
			finderCon.radarHide();
		}
		tackleCon.reset();
		initiate();
	}

	public void inputCheck()
	{
		conRotation = tackleCon.transform.rotation;
		if (dataManager.userData.bothHand)
		{
			bReeling = handControl.isRotating;
			if (bReeling)
			{
				lastPushedTime += Time.deltaTime;
				if (lastPushedTime > fastretrieveTime)
				{
					isFastRetrieve = true;
				}
				else
				{
					isFastRetrieve = false;
				}
			}
			else
			{
				lastPushedTime = 0f;
				isFastRetrieve = false;
			}
		}
		else if (VRInput.bInputTriggerDown(VRInput.eController.mainhand))
		{
			bReeling = true;
			lastPushedTime = Time.time;
		}
		else if (VRInput.bInputTrigger(VRInput.eController.mainhand))
		{
			bReeling = true;
			if (Time.time - lastPushedTime > fastretrieveTime)
			{
				isFastRetrieve = true;
			}
		}
		else if (VRInput.bInputTriggerUp(VRInput.eController.mainhand))
		{
			bReeling = false;
			isFastRetrieve = false;
		}
		else
		{
			bReeling = false;
			isFastRetrieve = false;
		}
	}

	private float inputTouchLeftRight()
	{
		if (VRInput.Touch_Left_Stay(VRInput.eController.bothhand))
		{
			return -1f;
		}
		if (VRInput.Touch_Right_Stay(VRInput.eController.bothhand))
		{
			return 1f;
		}
		return 0f;
	}

	private IEnumerator cGetConVelocity()
	{
		while (true)
		{
			float num = 0f - tackleCon.transform.eulerAngles.x;
			if (num > 180f)
			{
				num -= 360f;
			}
			else if (num < -180f)
			{
				num += 360f;
			}
			float num2 = tackleCon.transform.eulerAngles.y;
			if (num2 > 180f)
			{
				num2 -= 360f;
			}
			else if (num2 < -180f)
			{
				num += 360f;
			}
			Vector2 vector = new Vector2(num2, num);
			if (oldControllerAngle == Vector2.zero)
			{
				oldControllerAngle = vector;
			}
			conVelocity = (vector - oldControllerAngle) * Time.deltaTime * 1000f;
			oldControllerAngle = vector;
			yield return null;
		}
	}

	public void grabCatch(Transform trans)
	{
		if (!fishCon.fishHuge)
		{
			catchedPos.transform.parent = trans;
			catchedPos.transform.localPosition = Vector3.zero;
			catchedPos.transform.localRotation = Quaternion.identity;
			handControl.setJumpCatchHand(On: false);
			lureCon.transform.parent = trans;
			lureCon.transform.localPosition = Vector3.zero;
			if (!isGrabFish)
			{
				isGrabFish = true;
				StartCoroutine(lureConRotLock());
			}
		}
	}

	private IEnumerator lureConRotLock()
	{
		while (isGrabFish)
		{
			lureCon.transform.rotation = Quaternion.identity;
			yield return null;
		}
	}

	public void releaseCatch()
	{
		catchedPos.transform.parent = null;
		catchedPos.transform.rotation = Quaternion.identity;
		catchedPos.SetActive(value: false);
		lureCon.transform.parent = null;
	}
}
public class control_gpoint : MonoBehaviour
{
	private control_fishFinder finderControl;

	private control_envrionment envControl;

	public float posXarea;

	public float posYareaMin;

	public float posYareaMax;

	public float shoreAddDistance = 20f;

	public int gpMaxCount = 10;

	public float gpStayTime = 120f;

	public Transform tablet;

	public goodPointScript gpPrefab1_samll;

	public goodPointScript gpPrefab2_middle;

	public goodPointScript gpPrefab3_large;

	public goodPointScript gpPrefab4_Huge;

	public Sprite gpRadar1;

	public Sprite gpRadar2;

	public Sprite gpRadar3;

	public Sprite gpRadar4;

	public Image gpRadarImage;

	private int[] posIndex;

	public float baseScale = 3f;

	public float minScale = 1f;

	public float hitScale = 0.5f;

	public float gpScaleSpeed = 0.02f;

	public float lureCatchDis = 0.5f;

	public float fishMaxDisFromOri = 15f;

	public float fishMoveLerpSpeed = 2f;

	public float fishLimitDistFromPlayer = 15f;

	public float fishSwimSpeed = 1f;

	public float fishFollowSpeed = 2f;

	public float fishRunawaySpeed = 3f;

	public Color[] lureAttractionColor;

	public float radarPosScale = 0.05f;

	public float radarIconScale = 0.05f;

	public List<goodPointScript> listGpFish = new List<goodPointScript>();

	public bool isFishShow;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		finderControl = main.finderControl;
		envControl = main.envControl;
	}

	public void createFish(bool first)
	{
		if (!main.enableFishing)
		{
			return;
		}
		if (!main.useTutorial)
		{
			for (int i = 0; i < gpMaxCount; i++)
			{
				createGP(first);
			}
		}
		else
		{
			createTutoFish();
		}
	}

	public void deleteFish(goodPointScript fish)
	{
		listGpFish.Remove(fish);
		UnityEngine.Object.Destroy(fish.fishRadar);
		UnityEngine.Object.Destroy(fish.gameObject);
	}

	public void resetFishAll()
	{
		for (int i = 0; i < listGpFish.Count; i++)
		{
			UnityEngine.Object.Destroy(listGpFish[i].fishRadar);
			UnityEngine.Object.Destroy(listGpFish[i].gameObject);
		}
		listGpFish.Clear();
		createFish(first: true);
	}

	public void createGP(bool first)
	{
		float num = ((main.envControl.stageID <= 15) ? 0f : shoreAddDistance);
		Vector3 position = new Vector3(UnityEngine.Random.Range(0f - posXarea + (0f - num), posXarea + num), envControl.water_Height, UnityEngine.Random.Range(posYareaMin + num * 0.5f, posYareaMax + (float)dataManager.userData.userLv + num * 0.5f));
		int stageFishGrade = main.fishControl.getStageFishGrade(first);
		switch (stageFishGrade)
		{
		case 0:
		{
			goodPointScript goodPointScript2 = null;
			break;
		}
		case 1:
		{
			goodPointScript goodPointScript2 = UnityEngine.Object.Instantiate(gpPrefab1_samll, position, Quaternion.identity);
			goodPointScript2.fishSet = main.fishControl.getStageFishset(stageFishGrade);
			goodPointScript2.fishID = goodPointScript2.fishSet.fishInfo.ID;
			goodPointScript2.fishRadarSet();
			goodPointScript2.GpGrade = stageFishGrade;
			goodPointScript2.setAttractPoint();
			listGpFish.Add(goodPointScript2);
			break;
		}
		case 2:
		{
			goodPointScript goodPointScript2 = UnityEngine.Object.Instantiate(gpPrefab2_middle, position, Quaternion.identity);
			goodPointScript2.fishSet = main.fishControl.getStageFishset(stageFishGrade);
			goodPointScript2.fishID = goodPointScript2.fishSet.fishInfo.ID;
			goodPointScript2.GpGrade = stageFishGrade;
			goodPointScript2.fishRadarSet();
			listGpFish.Add(goodPointScript2);
			break;
		}
		case 3:
		{
			goodPointScript goodPointScript2 = UnityEngine.Object.Instantiate(gpPrefab3_large, position, Quaternion.identity);
			goodPointScript2.fishSet = main.fishControl.getStageFishset(stageFishGrade);
			goodPointScript2.fishID = goodPointScript2.fishSet.fishInfo.ID;
			goodPointScript2.GpGrade = stageFishGrade;
			goodPointScript2.fishRadarSet();
			listGpFish.Add(goodPointScript2);
			break;
		}
		case 4:
		{
			goodPointScript goodPointScript2 = UnityEngine.Object.Instantiate(gpPrefab4_Huge, position, Quaternion.identity);
			goodPointScript2.fishSet = main.fishControl.getStageFishset(stageFishGrade);
			goodPointScript2.fishID = goodPointScript2.fishSet.fishInfo.ID;
			goodPointScript2.GpGrade = stageFishGrade;
			goodPointScript2.fishRadarSet();
			listGpFish.Add(goodPointScript2);
			break;
		}
		}
	}

	public void createTutoFish()
	{
		goodPointScript goodPointScript2 = UnityEngine.Object.Instantiate(position: new Vector3(0f, envControl.water_Height, main.tutoControl.tutoFishDistance), original: gpPrefab3_large, rotation: Quaternion.identity);
		goodPointScript2.fishSet = main.tutoControl.tutoFishItem.fishSet;
		goodPointScript2.fishID = goodPointScript2.fishSet.fishInfo.ID;
		goodPointScript2.GpGrade = 3;
		goodPointScript2.fishRadarSet();
		listGpFish.Add(goodPointScript2);
	}

	public void hookFailed()
	{
		if (listGpFish != null)
		{
			for (int i = 0; i < listGpFish.Count; i++)
			{
				listGpFish[i].runaway();
			}
		}
	}

	public void fishShow()
	{
		if (isFishShow)
		{
			return;
		}
		isFishShow = true;
		if (dataManager.userData.gameDifficulty == 0 || main.useTutorial)
		{
			GetComponent<AudioSource>().Play();
			if (listGpFish != null)
			{
				for (int i = 0; i < listGpFish.Count; i++)
				{
					listGpFish[i].fishShow();
				}
			}
		}
		else if (dataManager.userData.gameDifficulty == 1 && !main.fishingControl.isTackleGround)
		{
			finderControl.radarShow();
		}
	}

	public void fishHide()
	{
		isFishShow = false;
		if ((dataManager.userData.gameDifficulty == 0 || main.useTutorial) && listGpFish != null)
		{
			for (int i = 0; i < listGpFish.Count; i++)
			{
				listGpFish[i].fishHide();
			}
		}
	}

	public void changeLure()
	{
		if (!main.useTutorial)
		{
			if (listGpFish == null)
			{
				return;
			}
			for (int i = 0; i < listGpFish.Count; i++)
			{
				if (listGpFish[i] != null)
				{
					listGpFish[i].lureCheck(dataManager.userData.curLure);
				}
			}
		}
		else
		{
			if (listGpFish == null)
			{
				return;
			}
			for (int j = 0; j < listGpFish.Count; j++)
			{
				if (listGpFish[j] != null)
				{
					listGpFish[j].lureCheck(main.tutoControl.curTutoLure);
				}
			}
		}
	}

	public void fishReset()
	{
		if (listGpFish == null)
		{
			return;
		}
		for (int i = 0; i < listGpFish.Count; i++)
		{
			if (listGpFish[i] != null)
			{
				listGpFish[i].fishReset();
			}
		}
	}

	public bool checkAttracted()
	{
		bool result = false;
		for (int i = 0; i < listGpFish.Count; i++)
		{
			if (listGpFish[i].bAttracting)
			{
				result = true;
			}
		}
		return result;
	}
}
public class control_hand : MonoBehaviour
{
	public enum eHandState
	{
		none,
		normal,
		grab,
		spinning,
		casting,
		reeling
	}

	public HandState handState;

	public bool isRight = true;

	private control_tackle tackleCon;

	private control_Fishing fishingCon;

	private control_handselect handControl;

	private GameObject normalPlane;

	private float oldFrame;

	private float aniFrame;

	private float aniTime;

	private bool isGrab;

	private Collider handCollider;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		handCollider = GetComponent<Collider>();
		setHandState(eHandState.none);
	}

	private void Start()
	{
		tackleCon = main.tackleControl;
		fishingCon = main.fishingControl;
		handControl = main.handControl;
	}

	public void addRigid()
	{
		if (base.gameObject.GetComponent<Rigidbody>() == null)
		{
			base.gameObject.AddComponent<Rigidbody>().isKinematic = true;
		}
	}

	public void removeRigid()
	{
		if (base.gameObject.GetComponent<Rigidbody>() != null)
		{
			UnityEngine.Object.Destroy(base.gameObject.GetComponent<Rigidbody>());
		}
	}

	public void colliderOnOff(bool on)
	{
		if (on)
		{
			handCollider.enabled = true;
		}
		else
		{
			handCollider.enabled = false;
		}
	}

	public void setHandState(eHandState state)
	{
		handState.ChangeState((int)state);
	}

	public void grabRest()
	{
		isGrab = false;
		handControl.isGrabReel = false;
	}

	private void OnTriggerStay(Collider other)
	{
		if (dataManager.targetPlatform != 0 && other.CompareTag("reelhandle") && fishingCon.gameState != control_Fishing.EfishingState.catching)
		{
			if (VRInput.bInputTriggerDown(VRInput.eController.subhand))
			{
				handControl.haptic(0.01f, 1f, isMainhand: false);
			}
			if (VRInput.bInputTrigger(VRInput.eController.subhand) || VRInput.bInputGrab(VRInput.eController.subhand))
			{
				reelGrabOn(other);
			}
			else
			{
				reelGrabOff(other);
			}
		}
	}

	private void OnTriggerExit(Collider other)
	{
		reelGrabOff(other);
	}

	private void reelGrabOn(Collider other)
	{
		if (!handControl.isGlassesOn && !isGrab)
		{
			handState.ChangeState(0);
			handControl.setHandleHand(OnOff: true);
			normalPlane = other.gameObject;
			isGrab = true;
			handControl.isGrabReel = true;
		}
	}

	private void reelGrabOff(Collider other)
	{
		if (fishingCon.gameState != control_Fishing.EfishingState.catching && !handControl.isGlassesOn && isGrab)
		{
			handState.ChangeState(1);
			handControl.setHandleHand(OnOff: false);
			isGrab = false;
			handControl.isGrabReel = false;
		}
	}

	public float getReelAniTime()
	{
		if (normalPlane != null)
		{
			Vector3 to = Vector3.ProjectOnPlane(base.transform.position - normalPlane.transform.position, normalPlane.transform.right);
			float num = angle360(normalPlane.transform.up, to, normalPlane.transform.forward);
			if (isGrab)
			{
				aniFrame = num / 360f;
			}
			else
			{
				aniFrame = oldFrame;
			}
			float num2 = Mathf.Abs(aniFrame - oldFrame);
			if (num2 > 0.5f)
			{
				num2 = 1f - num2;
			}
			handControl.reelRotSpeed = num2 * Time.deltaTime * 1000f;
			if (handControl.reelRotSpeed > 1f)
			{
				handControl.reelRotSpeed = 1f;
			}
			oldFrame = aniFrame;
			if (handControl.reelRotSpeed > handControl.rotationDetectSpeed)
			{
				handControl.isRotating = true;
			}
			else
			{
				handControl.isRotating = false;
			}
		}
		else
		{
			aniFrame = 0f;
		}
		return aniFrame;
	}

	private float angle360(Vector3 from, Vector3 to, Vector3 right)
	{
		float num = Vector3.Angle(from, to);
		if (!(Vector3.Angle(right, to) > 90f))
		{
			return num;
		}
		return 360f - num;
	}
}
public class control_handselect : MonoBehaviour
{
	private control_Fishing fishingControl;

	private control_tackle tackleControl;

	private control_fishFinder finderControl;

	private control_envrionment envControl;

	public int handType;

	public Transform TackleTransform;

	public Transform pivotRightHand;

	public Transform pivotLeftHand;

	public control_hand righthandControl;

	public control_hand lefthandControl;

	[HideInInspector]
	public control_hand mainHand;

	[HideInInspector]
	public control_hand otherHand;

	public GameObject handGrab_Right;

	public GameObject handGrab_Left;

	public GameObject handTablet_Right;

	public GameObject handTablet_Left;

	public GameObject handGlasses_Right;

	public GameObject handGlasses_Left;

	public float rotationDetectSpeed = 0.5f;

	[HideInInspector]
	public float reelRotSpeed;

	[HideInInspector]
	public bool isRotating;

	[HideInInspector]
	public bool handReady;

	[HideInInspector]
	public bool isGlassesOn;

	[HideInInspector]
	public bool isHapticM;

	[HideInInspector]
	public bool isHapticS;

	[HideInInspector]
	public bool bStayHaptic;

	public float fishHapticPower = 0.2f;

	public float biteHapticPower = 0.5f;

	private bool initCheck = true;

	[HideInInspector]
	public bool isGrabReel;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		tackleControl = main.tackleControl;
		fishingControl = main.fishingControl;
		finderControl = main.finderControl;
		envControl = main.envControl;
		handReady = false;
	}

	private void Start()
	{
		if (main.enableFishing)
		{
			checkController(reset: true);
		}
		else
		{
			setNoFishingHand();
		}
	}

	public void checkController(bool reset)
	{
		if (reset)
		{
			resetHands();
		}
		setMainHand();
		setTackleParent();
	}

	private void setNoFishingHand()
	{
		resetHands();
		if (dataManager.userData.rightHand)
		{
			mainHand = righthandControl;
			otherHand = lefthandControl;
		}
		else
		{
			mainHand = lefthandControl;
			otherHand = righthandControl;
		}
		if (dataManager.userData.bothHand)
		{
			mainHand.setHandState(control_hand.eHandState.normal);
			otherHand.setHandState(control_hand.eHandState.normal);
			mainHand.addRigid();
			otherHand.addRigid();
			mainHand.colliderOnOff(on: true);
			otherHand.colliderOnOff(on: true);
		}
		else
		{
			mainHand.setHandState(control_hand.eHandState.normal);
			otherHand.setHandState(control_hand.eHandState.none);
			mainHand.colliderOnOff(on: true);
			mainHand.addRigid();
			otherHand.colliderOnOff(on: false);
		}
		handReady = true;
	}

	public void setMainHand()
	{
		if (dataManager.userData.rightHand)
		{
			mainHand = righthandControl;
			mainHand.removeRigid();
			otherHand = lefthandControl;
		}
		else
		{
			mainHand = lefthandControl;
			mainHand.removeRigid();
			otherHand = righthandControl;
		}
		if (dataManager.userData.bothHand)
		{
			otherHand.setHandState(control_hand.eHandState.normal);
			otherHand.addRigid();
			OnOffOtherHandCollider(onCollider: true);
		}
		else
		{
			otherHand.setHandState(control_hand.eHandState.none);
			OnOffOtherHandCollider(onCollider: false);
		}
		if (initCheck)
		{
			initCheck = false;
		}
		else
		{
			tackleControl.handleSelect();
			setFishingHand();
		}
		handReady = true;
	}

	public void setTackleParent()
	{
		if (dataManager.userData.rightHand)
		{
			TackleTransform.parent = pivotRightHand;
		}
		else
		{
			TackleTransform.parent = pivotLeftHand;
		}
		TackleTransform.localPosition = Vector3.zero;
		TackleTransform.localRotation = Quaternion.identity;
	}

	public void setTackleGround(bool handReset)
	{
		if ((fishingControl.gameState == control_Fishing.EfishingState.ready || fishingControl.gameState == control_Fishing.EfishingState.catching) && !fishingControl.isTackleGround)
		{
			TackleTransform.parent = envControl.tackleGroundPivot;
			TackleTransform.localPosition = Vector3.zero;
			TackleTransform.localRotation = Quaternion.identity;
			fishingControl.isTackleGround = true;
			envControl.tackleGroundPivot.GetComponent<BoxCollider>().enabled = true;
			if (handReset)
			{
				mainHand.setHandState(control_hand.eHandState.normal);
			}
			MultiplayEventManager.Instance.SendFishState(FishState.Holder);
		}
	}

	public void setTackleHand()
	{
		if (dataManager.userData.rightHand)
		{
			TackleTransform.parent = pivotRightHand;
		}
		else
		{
			TackleTransform.parent = pivotLeftHand;
		}
		TackleTransform.localPosition = Vector3.zero;
		TackleTransform.localRotation = Quaternion.identity;
		fishingControl.isTackleGround = false;
		if (dataManager.userData.gameDifficulty == 1)
		{
			finderControl.radarShow();
		}
		Singleton<Console>.Instance.HideConsole();
		setFishingHand();
		envControl.tackleGroundPivot.GetComponent<BoxCollider>().enabled = false;
		MultiplayEventManager.Instance.SendFishState(FishState.None);
		main.captureControl.GrabRod();
	}

	public void setFishingHand()
	{
		if (tackleControl.getReelType() == ItemType.ReelS)
		{
			mainHand.setHandState(control_hand.eHandState.spinning);
		}
		else
		{
			mainHand.setHandState(control_hand.eHandState.casting);
		}
	}

	public void onOffOtherHand(bool On)
	{
		if (dataManager.userData.bothHand)
		{
			if (On)
			{
				otherHand.setHandState(control_hand.eHandState.normal);
				OnOffOtherHandCollider(onCollider: true);
				setHandleHand(OnOff: false);
				otherHand.grabRest();
			}
			else
			{
				otherHand.setHandState(control_hand.eHandState.none);
				OnOffOtherHandCollider(onCollider: false);
				setHandleHand(OnOff: false);
				otherHand.grabRest();
			}
		}
	}

	public void setHandleHand(bool OnOff)
	{
		tackleControl.getReelControl().handShowHide(OnOff);
	}

	public void OnOffOtherHandCollider(bool onCollider)
	{
		otherHand.colliderOnOff(onCollider);
	}

	public void setLandingCatchHand()
	{
		if (dataManager.userData.bothHand)
		{
			otherHand.colliderOnOff(on: false);
			tackleControl.getReelControl().handShowHide(show: false);
			otherHand.setHandState(control_hand.eHandState.normal);
		}
	}

	public void setJumpCatchHand(bool On)
	{
		if (On)
		{
			if (dataManager.userData.bothHand)
			{
				otherHand.colliderOnOff(on: false);
				otherHand.setHandState(control_hand.eHandState.normal);
			}
			else if (dataManager.userData.rightHand)
			{
				handGrab_Right.SetActive(value: false);
				handGrab_Left.SetActive(value: true);
			}
			else
			{
				handGrab_Right.SetActive(value: true);
				handGrab_Left.SetActive(value: false);
			}
			tackleControl.getReelControl().handShowHide(show: false);
		}
		else
		{
			handGrab_Right.SetActive(value: false);
			handGrab_Left.SetActive(value: false);
		}
	}

	public void setTabletHand()
	{
		if (dataManager.userData.rightHand)
		{
			handGrab_Right.SetActive(value: false);
			handGrab_Left.SetActive(value: true);
		}
		else
		{
			handGrab_Right.SetActive(value: true);
			handGrab_Left.SetActive(value: false);
		}
		if (!dataManager.userData.bothHand)
		{
			setHandleHand(OnOff: false);
		}
		else
		{
			onOffOtherHand(On: false);
		}
	}

	public void setGlassesHand(bool glassesOn)
	{
		isGlassesOn = glassesOn;
		if (glassesOn)
		{
			setHandleHand(OnOff: false);
			if (dataManager.userData.rightHand)
			{
				handGlasses_Right.SetActive(value: false);
				handGlasses_Left.SetActive(value: true);
			}
			else
			{
				handGlasses_Right.SetActive(value: true);
				handGlasses_Left.SetActive(value: false);
			}
			onOffOtherHand(On: false);
		}
		else
		{
			handGlasses_Right.SetActive(value: false);
			handGlasses_Left.SetActive(value: false);
			if (!finderControl.isFishFinder)
			{
				onOffOtherHand(On: true);
			}
		}
	}

	private void resetHands()
	{
		handGrab_Right.SetActive(value: false);
		handGrab_Left.SetActive(value: false);
		handTablet_Right.SetActive(value: false);
		handTablet_Left.SetActive(value: false);
		handGlasses_Right.SetActive(value: false);
		handGlasses_Left.SetActive(value: false);
	}

	public void hapticStay(float power, bool isMainhand)
	{
		if (power > 1f)
		{
			power = 1f;
		}
		if (dataManager.targetPlatform != 0 && isMainhand && !bStayHaptic)
		{
			bStayHaptic = true;
			if (dataManager.userData.rightHand)
			{
				OVRInput.SetControllerVibration(0.3f, power, OVRInput.Controller.RTouch);
			}
			else
			{
				OVRInput.SetControllerVibration(0.3f, power, OVRInput.Controller.LTouch);
			}
		}
	}

	public void hapticStop(bool isMainhand)
	{
		if (dataManager.targetPlatform != 0 && isMainhand && bStayHaptic)
		{
			bStayHaptic = false;
			if (dataManager.userData.rightHand)
			{
				OVRInput.SetControllerVibration(0f, 0f, OVRInput.Controller.RTouch);
			}
			else
			{
				OVRInput.SetControllerVibration(0f, 0f, OVRInput.Controller.LTouch);
			}
		}
	}

	public void haptic(float time, float power, bool isMainhand)
	{
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			return;
		}
		if (isMainhand)
		{
			if (!isHapticM)
			{
				isHapticM = true;
				StartCoroutine(cHapticMain(time, power));
			}
		}
		else if (!isHapticS)
		{
			isHapticS = true;
			StartCoroutine(cHapticSub(time, power));
		}
	}

	private IEnumerator cHapticMain(float time, float power)
	{
		if (power > 1f)
		{
			power = 1f;
		}
		if (dataManager.userData.rightHand)
		{
			OVRInput.SetControllerVibration(1f, power, OVRInput.Controller.RTouch);
		}
		else
		{
			OVRInput.SetControllerVibration(1f, power, OVRInput.Controller.LTouch);
		}
		yield return new WaitForSeconds(time);
		if (dataManager.userData.rightHand)
		{
			OVRInput.SetControllerVibration(0f, 0f, OVRInput.Controller.RTouch);
		}
		else
		{
			OVRInput.SetControllerVibration(0f, 0f, OVRInput.Controller.LTouch);
		}
		isHapticM = false;
		bStayHaptic = false;
	}

	private IEnumerator cHapticSub(float time, float power)
	{
		if (power > 1f)
		{
			power = 1f;
		}
		if (dataManager.userData.rightHand)
		{
			OVRInput.SetControllerVibration(1f, power, OVRInput.Controller.LTouch);
		}
		else
		{
			OVRInput.SetControllerVibration(1f, power, OVRInput.Controller.RTouch);
		}
		yield return new WaitForSeconds(time);
		if (dataManager.userData.rightHand)
		{
			OVRInput.SetControllerVibration(0f, 0f, OVRInput.Controller.LTouch);
		}
		else
		{
			OVRInput.SetControllerVibration(0f, 0f, OVRInput.Controller.RTouch);
		}
		isHapticS = false;
		bStayHaptic = false;
	}

	public void hapticDelay(float delay, float time, float power, bool isMainhand)
	{
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			return;
		}
		if (isMainhand)
		{
			if (!isHapticM)
			{
				isHapticM = true;
				StartCoroutine(cHapticDelayMain(delay, time, power));
			}
		}
		else if (!isHapticS)
		{
			isHapticS = true;
			StartCoroutine(cHapticDelaySub(delay, time, power));
		}
	}

	private IEnumerator cHapticDelayMain(float delay, float time, float power)
	{
		if (power > 1f)
		{
			power = 1f;
		}
		if (dataManager.userData.rightHand)
		{
			OVRInput.SetControllerVibration(1f, power, OVRInput.Controller.RTouch);
		}
		else
		{
			OVRInput.SetControllerVibration(1f, power, OVRInput.Controller.LTouch);
		}
		yield return new WaitForSeconds(time);
		if (dataManager.userData.rightHand)
		{
			OVRInput.SetControllerVibration(0f, 0f, OVRInput.Controller.RTouch);
		}
		else
		{
			OVRInput.SetControllerVibration(0f, 0f, OVRInput.Controller.LTouch);
		}
		yield return new WaitForSeconds(delay);
		isHapticM = false;
		bStayHaptic = false;
	}

	private IEnumerator cHapticDelaySub(float delay, float time, float power)
	{
		if (power > 1f)
		{
			power = 1f;
		}
		if (dataManager.userData.rightHand)
		{
			OVRInput.SetControllerVibration(1f, power, OVRInput.Controller.LTouch);
		}
		else
		{
			OVRInput.SetControllerVibration(1f, power, OVRInput.Controller.RTouch);
		}
		yield return new WaitForSeconds(time);
		if (dataManager.userData.rightHand)
		{
			OVRInput.SetControllerVibration(0f, 0f, OVRInput.Controller.LTouch);
		}
		else
		{
			OVRInput.SetControllerVibration(0f, 0f, OVRInput.Controller.RTouch);
		}
		yield return new WaitForSeconds(delay);
		isHapticS = false;
		bStayHaptic = false;
	}
}
public class control_item_lure : MonoBehaviour
{
	public LureItem[] item_lure;

	public GameObject[] lureObj;

	private int grade;

	private void Awake()
	{
		ChangeLureGrade();
	}

	private void Start()
	{
	}

	public LureItem getLureInfo()
	{
		return item_lure[grade];
	}

	public int getLureFishAttraction(int fishID)
	{
		return item_lure[grade].fish[fishID];
	}

	public float getLureBiteSpeed(int fishID)
	{
		return item_lure[grade].fish[fishID];
	}

	public float getLureRange()
	{
		return 5f + (float)item_lure[grade].range;
	}

	public float getLureStuck()
	{
		return 1f - 0.1f * (float)item_lure[grade].stuck;
	}

	public float getLureType()
	{
		return (float)item_lure[grade].type * 0.2f;
	}

	public void lureShow()
	{
		lureObj[grade].SetActive(value: true);
	}

	public void lureHide()
	{
		lureObj[grade].SetActive(value: false);
	}

	private void ChangeLureGrade()
	{
		for (int i = 0; i < lureObj.Length; i++)
		{
			if (i == 0)
			{
				lureObj[i].SetActive(value: true);
			}
			else
			{
				lureObj[i].SetActive(value: false);
			}
		}
	}
}
public class control_item_reel : MonoBehaviour
{
	public ReelItem item_reel;

	public Animator reelAni;

	public Transform[] reellineWindPos;

	public Transform[] reellineReleasePos;

	public GameObject rightReel;

	public GameObject leftReel;

	public GameObject rightHand;

	public GameObject leftHand;

	public Transform rightHandle;

	public Transform leftHandle;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		if (rightHand != null)
		{
			rightHand.SetActive(value: false);
		}
		if (leftHand != null)
		{
			leftHand.SetActive(value: false);
		}
		if (rightReel != null)
		{
			rightReel.SetActive(value: false);
		}
		if (leftReel != null)
		{
			leftReel.SetActive(value: false);
		}
	}

	public ReelItem getReelInfo()
	{
		return item_reel;
	}

	public float getReelSpeed()
	{
		return 1f - (float)item_reel.tension * 0.03f;
	}

	public float getReelPower()
	{
		return 1f - 0.1f * (float)item_reel.power;
	}

	public float getReelLength()
	{
		return 30f + (float)item_reel.length * 6f;
	}

	public void handShowHide(bool show)
	{
		if (dataManager.userData.rightHand)
		{
			leftHand.SetActive(show);
		}
		else
		{
			rightHand.SetActive(show);
		}
	}

	public float getReelAngle()
	{
		if (dataManager.userData.rightHand)
		{
			return leftHandle.transform.localEulerAngles.x;
		}
		return rightHandle.transform.localEulerAngles.x;
	}

	public void rotateReelHandle(bool isRight, float angle)
	{
		if (isRight)
		{
			leftHandle.transform.localEulerAngles = new Vector3(angle, 0f, 0f);
		}
		else
		{
			rightHandle.transform.localEulerAngles = new Vector3(angle, 0f, 0f);
		}
	}

	public void ShowReelHanded(bool isRight)
	{
		if (isRight)
		{
			if (leftReel != null)
			{
				leftReel.SetActive(value: true);
			}
			if (rightReel != null)
			{
				rightReel.SetActive(value: false);
			}
		}
		else
		{
			if (leftReel != null)
			{
				leftReel.SetActive(value: false);
			}
			if (rightReel != null)
			{
				rightReel.SetActive(value: true);
			}
		}
	}

	public void ShowOnlyHandle(bool isRight)
	{
		ShowReelHanded(isRight);
		if (leftHand != null)
		{
			leftHand.SetActive(value: false);
		}
		if (rightHand != null)
		{
			rightHand.SetActive(value: false);
		}
	}
}
public class control_item_rod : MonoBehaviour
{
	public RodItem item_rod;

	public Transform[] rodlinePos;

	public Transform[] rodBonesPos;

	public Transform pinPosition;

	public RodItem getRodInfo()
	{
		return item_rod;
	}

	public float getRodPower()
	{
		return 1f + 0.13f * (float)item_rod.power;
	}

	public float getRodAction()
	{
		return (float)item_rod.action * 0.15f;
	}

	public float getRodDistance()
	{
		return (float)item_rod.distance * 3f;
	}
}
public class control_language : MonoBehaviour
{
	public int userLanguage;

	private Localize localize;

	[TextArea(3, 20)]
	[SerializeField]
	private string[] textContent;

	[TextArea(3, 20)]
	[SerializeField]
	private string[] textContentQuest;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		localize = GetComponent<Localize>();
	}

	private void OnEnable()
	{
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			localize.SetKey("LodgeTutorialGo/0001");
		}
		else if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
		{
			localize.SetKey("LodgeTutorialQuest/0001");
		}
		else if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
		{
			localize.SetKey("LodgeTutorialQuest/0001");
		}
	}
}
public class control_Lure : MonoBehaviour
{
	public enum eFishMovement
	{
		stay,
		up,
		left,
		right,
		jumpL,
		jumpR,
		groggy,
		angry,
		landing
	}

	private control_fish fishCon;

	private control_Fishing fishingControl;

	private control_particle particleControl;

	private control_tackle tackleCon;

	private control_bait baitControl;

	private control_envrionment envControl;

	private control_handselect handControl;

	public uiFishIconControl iconControl;

	public ObiRope rope;

	private ObiRopeCursor cursor;

	public float ropeReelSpeed = 30f;

	public float reelRewindSpeed = 30f;

	public float dontTurnDistance = 5f;

	private float waterHeight;

	private float lureHeightFromWater;

	public float fishHeightFromWater = 0.4f;

	public float speedLureDive = 0.2f;

	[HideInInspector]
	public float height;

	public float jumpHeight = 1f;

	public float catchedHeight = 1f;

	public float catchedJumpSpeed = 0.5f;

	private AudioSource audioFish;

	public AudioClip aFishSwimg;

	public float lureLerpMoveSpeed = 2f;

	public float DistanceForSpeed = 20f;

	private Rigidbody rb;

	public float moveangleLimit = 60f;

	public float nodeInputTime = 2f;

	public float changeFishDirRndMin = 3f;

	public float changeFishDirRndMax = 5f;

	public int jumpRndMin = 5;

	public int jumpRndMax = 10;

	private int jumpTurnNum;

	private int changeDirNum;

	private int sharkNum;

	public int groggyMin = 5;

	[HideInInspector]
	public int groggyNum;

	[HideInInspector]
	public int groggyRnd;

	private float nextDirection;

	private float fishSpeed;

	private float distance;

	[HideInInspector]
	public float healthRatio = 1f;

	private Animation catchedJumpAni;

	[HideInInspector]
	public float aniCatchedSpeed;

	[HideInInspector]
	public float aniCatchedHeight;

	private Material matFishpower;

	public GameObject uiAngryMode;

	private Vector3 catchedMovePos;

	private IEnumerator dragCoroutine;

	private IEnumerator moveCoroutine;

	private IEnumerator jumpCoroutine;

	private float hitWaterDistance;

	private float reelMoveSpeed;

	private Vector3 relativePos;

	private bool touchGround;

	private ui_scale_distance fishMoveScale;

	[HideInInspector]
	public eFishMovement eFishing;

	private Vector3 directionToPlayer;

	public Transform RodPinTrans;

	public Transform nextPosPivot;

	public Transform nextPosDistance;

	public Transform nextTartgetDirection;

	public Animator nextTarget;

	public float dragMinDist = 20f;

	public float dragMoveSpeed = 1f;

	[HideInInspector]
	public bool bFishTurn;

	private bool bFishTurnable;

	public float fishSideMoveScale = 1f;

	[HideInInspector]
	public bool secondTurn;

	[HideInInspector]
	public int angryTurnCount;

	private int angryCountMax = 5;

	private fishJump FishJump;

	[HideInInspector]
	public bool getIsJumping;

	private DataManager dataManager;

	private Main main;

	private float tx;

	private float ty;

	private float tz;

	private float v;

	private float elapsed_time;

	private float t;

	private Vector3 start_pos;

	private Vector3 end_pos;

	private float dat;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		fishCon = main.fishControl;
		audioFish = GetComponent<AudioSource>();
		fishingControl = main.fishingControl;
		particleControl = main.particleControl;
		tackleCon = main.tackleControl;
		envControl = main.envControl;
		handControl = main.handControl;
		catchedJumpAni = GetComponent<Animation>();
		rb = GetComponent<Rigidbody>();
		cursor = rope.GetComponent<ObiRopeCursor>();
		baitControl = main.baitControl;
	}

	private void Start()
	{
		if (main.enableFishing)
		{
			uiAngryMode.SetActive(value: false);
			waterHeight = envControl.water_Height;
			FishJump = nextPosPivot.GetComponent<fishJump>();
		}
		else
		{
			UnityEngine.Object.Destroy(base.gameObject);
			UnityEngine.Object.Destroy(baitControl.gameObject);
		}
	}

	private void LateUpdate()
	{
		setLureHeight();
		distance = fishingControl.fDistance;
		switch (fishingControl.gameState)
		{
		case control_Fishing.EfishingState.casting:
			cursor.ChangeLength(distance * 0.8f);
			break;
		case control_Fishing.EfishingState.retrieve:
			cursor.ChangeLength(distance * 0.55f);
			break;
		case control_Fishing.EfishingState.fighting:
		{
			if (fishingControl.fishHealth != 0f)
			{
				healthRatio = fishingControl.fishHealth / fishCon.fishLife;
			}
			else
			{
				healthRatio = 0f;
			}
			fishSpeed = Mathf.Clamp(DistanceForSpeed / distance, 3f, 20f) * fishCon.fishSpeed;
			cursor.ChangeLength(distance * 0.1f);
			Vector3 vector = new Vector3(fishingControl.cam.transform.position.x, 0f, fishingControl.cam.transform.position.z) - new Vector3(base.transform.position.x, 0f, base.transform.position.z);
			relativePos = base.transform.position - new Vector3(nextTarget.transform.position.x, base.transform.position.y, nextTarget.transform.position.z);
			switch (eFishing)
			{
			case eFishMovement.stay:
			{
				PullLureNextPos();
				Vector3 next = base.transform.position - new Vector3(nextTartgetDirection.transform.position.x, base.transform.position.y, nextTartgetDirection.transform.position.z);
				if (healthRatio < 0.6f)
				{
					next = new Vector3(nextTartgetDirection.transform.position.x, base.transform.position.y, nextTartgetDirection.transform.position.z) - base.transform.position;
				}
				fishCon.fishInst.LookNextPos(next, lerp: true, 3f);
				break;
			}
			case eFishMovement.up:
				PullLureNextPos();
				if (healthRatio < 0.6f)
				{
					vector = -vector;
				}
				fishCon.fishInst.LookNextPos(vector, lerp: true, 5f);
				break;
			case eFishMovement.left:
				PullLureNextPos();
				fishCon.fishInst.LookNextPos(relativePos, lerp: true, 5f);
				nextPosPivot.transform.Rotate(nextDirection * Vector3.up * Time.deltaTime * fishSpeed * 1.5f);
				break;
			case eFishMovement.right:
				PullLureNextPos();
				fishCon.fishInst.LookNextPos(relativePos, lerp: true, 5f);
				nextPosPivot.transform.Rotate(nextDirection * Vector3.up * Time.deltaTime * fishSpeed * 1.5f);
				break;
			case eFishMovement.jumpL:
				PullLureNextPos();
				fishCon.fishInst.LookNextPos(relativePos, lerp: false, 10f);
				nextPosPivot.transform.Rotate(nextDirection * Vector3.up * Time.deltaTime * fishSpeed * 2f);
				break;
			case eFishMovement.jumpR:
				PullLureNextPos();
				fishCon.fishInst.LookNextPos(relativePos, lerp: false, 10f);
				nextPosPivot.transform.Rotate(nextDirection * Vector3.up * Time.deltaTime * fishSpeed * 2f);
				break;
			case eFishMovement.groggy:
				PullLureNextPos();
				fishCon.fishInst.LookNextPos(new Vector3(RodPinTrans.position.x, relativePos.y, RodPinTrans.position.z), lerp: true, 1f);
				break;
			case eFishMovement.angry:
				PullLureNextPos();
				fishCon.fishInst.LookNextPos(vector, lerp: true, 2f);
				break;
			case eFishMovement.landing:
				PullLureNextPos();
				fishCon.fishInst.LookNextPos(relativePos, lerp: true, 2f);
				break;
			}
			break;
		}
		case control_Fishing.EfishingState.landing:
			fishCon.fishPivot = fishCon.fishPivot.transform;
			PullLureNextPos();
			if (fishCon.fishHuge)
			{
				nextTarget.SetBool("roam", value: false);
				relativePos = base.transform.position - new Vector3(RodPinTrans.position.x, base.transform.position.y, RodPinTrans.position.z);
				fishCon.fishInst.LookNextPos(relativePos, lerp: true, 1f);
			}
			else
			{
				relativePos = base.transform.position - new Vector3(nextTarget.transform.position.x, base.transform.position.y, nextTarget.transform.position.z);
				fishCon.fishInst.LookNextPos(relativePos, lerp: true, 1f);
			}
			break;
		case control_Fishing.EfishingState.catching:
			nextTarget.SetBool("roam", value: false);
			break;
		case control_Fishing.EfishingState.ready:
			break;
		}
	}

	private void fishStayDirection()
	{
		Vector3 toDirection = new Vector3(nextTartgetDirection.transform.position.x, fishCon.fishInst.transform.position.y, nextTartgetDirection.transform.position.z) - fishCon.fishInst.transform.position;
		Quaternion b = Quaternion.FromToRotation(fishCon.fishInst.transform.up, toDirection);
		fishCon.fishInst.transform.rotation = Quaternion.Lerp(fishCon.fishInst.transform.rotation, b, Time.deltaTime * 5f);
	}

	public void catchedJump()
	{
		stopMoving();
		rb.velocity = Vector3.zero;
		rb.angularVelocity = Vector3.zero;
		Jump();
		handControl.haptic(0.4f, fishCon.fishInst.fishInfo.power * 1f, isMainhand: true);
	}

	public void Jump()
	{
		start_pos = base.transform.position;
		if (fishCon.fishHuge)
		{
			end_pos = envControl.hugeFishLandingPos.position;
		}
		else
		{
			end_pos = fishingControl.catchedPos.transform.position;
		}
		float num = end_pos.y - start_pos.y;
		float num2 = catchedHeight - start_pos.y;
		if (fishCon.fishHuge)
		{
			num2 *= 1.2f;
		}
		ty = Mathf.Sqrt(2f * catchedJumpSpeed * num2);
		float num3 = catchedJumpSpeed;
		float num4 = -2f * ty;
		float num5 = 2f * num;
		dat = (0f - num4 + Mathf.Sqrt(num4 * num4 - 4f * num3 * num5)) / (2f * num3);
		if (start_pos.x != end_pos.x)
		{
			tx = (0f - (start_pos.x - end_pos.x)) / dat;
		}
		else
		{
			tx = 0f;
		}
		if (start_pos.z != end_pos.z)
		{
			tz = (0f - (start_pos.z - end_pos.z)) / dat;
		}
		else
		{
			tz = 0f;
		}
		elapsed_time = 0f;
		StartCoroutine(ShootImpl());
	}

	private IEnumerator ShootImpl()
	{
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
		{
			MultiplayEventManager.Instance.SendFishState(FishState.Landing, fishCon);
			Singleton<NotificationManager>.Instance.SaveMyFishInfo(fishCon.fishID, fishCon.fishSize, fishCon.fishWeight);
		}
		Quaternion fishRot = fishCon.fishInst.transform.rotation;
		while (true)
		{
			elapsed_time += Time.deltaTime;
			float x = start_pos.x + tx * elapsed_time;
			float y = start_pos.y + ty * elapsed_time - 0.5f * catchedJumpSpeed * elapsed_time * elapsed_time;
			float z = start_pos.z + tz * elapsed_time;
			Vector3 position = new Vector3(x, y, z);
			base.transform.position = position;
			if (fishCon.fishHuge)
			{
				fishCon.fishInst.transform.rotation = Quaternion.Lerp(fishRot, envControl.hugeFishLandingPos.rotation, elapsed_time / dat);
			}
			if (elapsed_time >= dat)
			{
				break;
			}
			yield return null;
		}
		if (dataManager.userData.bothHand)
		{
			handControl.haptic(0.3f, fishCon.fishInst.fishInfo.power * 0.5f, isMainhand: false);
			handControl.otherHand.setHandState(control_hand.eHandState.grab);
		}
		else
		{
			handControl.haptic(0.3f, fishCon.fishInst.fishInfo.power * 0.5f, isMainhand: true);
			handControl.setJumpCatchHand(On: true);
		}
		if (fishCon.fishHuge)
		{
			fishCon.fishInst.transform.parent = envControl.hugeFishLandingPos;
			fishCon.fishInst.transform.localPosition = Vector3.zero;
			fishCon.fishInst.transform.localRotation = Quaternion.identity;
			rb.isKinematic = true;
			if (fishCon.fishInst.linePivot != null)
			{
				base.transform.parent = fishCon.fishInst.linePivot;
			}
			base.transform.localPosition = Vector3.zero;
		}
		else
		{
			base.transform.position = fishingControl.catchedPos.transform.position;
			fishCon.fishInst.lineShow(show: true);
		}
		if (dataManager.userData.bothHand)
		{
			fishingControl.grabCatch(handControl.otherHand.transform);
		}
		if (fishCon.isFish)
		{
			fishingControl.SelectCatchOrRelease();
		}
		fishCon.fishInst.isCatched = true;
	}

	public void retreieveMove(float reelingSpeed)
	{
		Vector3 vector = Vector3.Normalize(new Vector3(RodPinTrans.position.x, 0f, RodPinTrans.position.z) - new Vector3(base.transform.position.x, 0f, base.transform.position.z));
		reelMoveSpeed = Mathf.Lerp(reelMoveSpeed, fishingControl.reelSpeed * reelingSpeed, Time.deltaTime * lureLerpMoveSpeed);
		rb.MovePosition(new Vector3(base.transform.position.x, envControl.water_Height - lureHeightFromWater, base.transform.position.z) + vector * Time.deltaTime * reelMoveSpeed);
		hitWaterDistance = fishingControl.fDistance;
	}

	private void setNextPos()
	{
		hitWaterDistance = fishingControl.fDistance;
		Vector3 forward = new Vector3(base.transform.position.x, 0f, base.transform.position.z) - new Vector3(RodPinTrans.position.x, 0f, RodPinTrans.position.z);
		nextPosPivot.transform.position = new Vector3(RodPinTrans.position.x, 0f, RodPinTrans.position.z);
		nextPosPivot.transform.rotation = Quaternion.LookRotation(forward);
		nextPosDistance.transform.localPosition = new Vector3(0f, waterHeight - lureHeightFromWater, hitWaterDistance * healthRatio);
	}

	private void setLureHeight()
	{
		if (fishingControl.gameState == control_Fishing.EfishingState.retrieve)
		{
			if (tackleCon.getLureHeight() != 0f)
			{
				if (VRInput.bInputTrigger(VRInput.eController.mainhand))
				{
					if (lureHeightFromWater > 0.1f)
					{
						lureHeightFromWater -= Time.deltaTime * speedLureDive;
					}
				}
				else if (lureHeightFromWater < tackleCon.getLureHeight())
				{
					lureHeightFromWater += Time.deltaTime * speedLureDive;
				}
			}
			else
			{
				lureHeightFromWater = 0f;
			}
		}
		else if (fishingControl.gameState == control_Fishing.EfishingState.fighting)
		{
			if (distance < 10f)
			{
				lureHeightFromWater = fishHeightFromWater * distance * 0.1f;
			}
			else
			{
				lureHeightFromWater = fishHeightFromWater;
			}
			fishCon.fishInst.transform.localPosition = new Vector3(0f, healthRatio * fishCon.fishInst.fishInfo.depthWater, 0f);
		}
	}

	public float setFish(int fishGrade, fishSetScript fishset, bool isShark, bool bFish)
	{
		fishingControl.BGMplay();
		if (!main.useTutorial)
		{
			groggyRnd = groggyMin + UnityEngine.Random.Range(-2, 3);
		}
		else
		{
			groggyRnd = 100;
		}
		bFishTurnable = fishCon.fishSet(base.transform, fishset, fishGrade, isShark, bFish);
		if (isShark)
		{
			resetAngry();
			resetShark();
			stopMoving();
			dragCoroutine = dragMove(hitWaterDistance, shark: true);
			StartCoroutine(dragCoroutine);
		}
		else if (!main.useTutorial)
		{
			if (fishCon.fishDrag)
			{
				resetAngry();
				if (dragCoroutine != null)
				{
					StopCoroutine(dragCoroutine);
				}
				dragCoroutine = dragMove(hitWaterDistance, shark: false);
				StartCoroutine(dragCoroutine);
			}
			else
			{
				moveCoroutine = changeDirection();
				StartCoroutine(moveCoroutine);
			}
		}
		return fishCon.fishPower;
	}

	private IEnumerator dragMove(float getiDist, bool shark)
	{
		fishingControl.bDrag = true;
		tackleCon.reelWind(4);
		eFishing = eFishMovement.angry;
		iconControl.iconChange(3);
		uiAngryMode.SetActive(value: true);
		MultiplayEventManager.Instance.SendFishState(FishState.Drag);
		if (shark)
		{
			yield return new WaitForSeconds(1f);
			particleControl.bigsplashCreate(base.transform.position, fishCon.fishSize * 0.03f);
			while (fishingControl.fishHealth < fishCon.fishLife && fishingControl.fDistance < 70f)
			{
				if (fishingControl.lineTension < 50f - (fishingControl.tensionStress + 10f))
				{
					fishingControl.lineTension += Time.deltaTime * 10f;
				}
				fishingControl.fishHealth += Time.deltaTime * 2f;
				hitWaterDistance += Time.deltaTime * dragMoveSpeed * 0.5f;
				yield return null;
			}
		}
		else
		{
			float dragTargetPos = dragMinDist + (tackleCon.getReelLength() - dragMinDist) * UnityEngine.Random.Range(0.2f, 0.5f);
			while (hitWaterDistance < dragTargetPos)
			{
				if (fishingControl.gameState != control_Fishing.EfishingState.fighting)
				{
					fishingControl.bDrag = false;
					break;
				}
				if (fishingControl.lineTension < 50f - (fishingControl.tensionStress + 10f))
				{
					fishingControl.lineTension += Time.deltaTime * 10f;
				}
				hitWaterDistance += Time.deltaTime * dragMoveSpeed;
				yield return null;
			}
		}
		fishingControl.bDrag = false;
		moveCoroutine = changeDirection();
		StartCoroutine(moveCoroutine);
	}

	private void PullLureNextPos()
	{
		nextPosDistance.transform.localPosition = new Vector3(0f, waterHeight - lureHeightFromWater, hitWaterDistance * healthRatio);
		Vector3 position = Vector3.Lerp(base.transform.position, nextTarget.transform.position, Time.deltaTime * lureLerpMoveSpeed);
		position.y = nextTarget.transform.position.y;
		rb.MovePosition(position);
	}

	private void OnTriggerEnter(Collider other)
	{
		if (fishingControl.gameState == control_Fishing.EfishingState.casting)
		{
			if (other.CompareTag("water"))
			{
				handControl.haptic(0.2f, 0.15f, isMainhand: true);
				fishingControl.hitWater();
				tackleCon.hitWater();
				particleControl.splashCreate();
				rb.isKinematic = true;
				baitControl.OnOffGravity(gravity: false);
				setNextPos();
				tackleCon.bailClose();
			}
			else if (other.CompareTag("ground"))
			{
				fishingControl.hitGround();
				tackleCon.hitGround();
				hitGround();
				tackleCon.bailClose();
			}
		}
		else
		{
			if (other.CompareTag("ground"))
			{
				touchGround = true;
			}
			if (other.CompareTag("water") && !touchGround)
			{
				handControl.haptic(0.1f, 0.1f, isMainhand: true);
				particleControl.splashCreate();
			}
		}
	}

	private void OnTriggerExit(Collider other)
	{
		if (other.CompareTag("ground"))
		{
			touchGround = false;
		}
	}

	public void stopMoving()
	{
		if (moveCoroutine != null)
		{
			StopCoroutine(moveCoroutine);
		}
		if (dragCoroutine != null)
		{
			StopCoroutine(dragCoroutine);
		}
	}

	public void guideMoving()
	{
		eFishing = eFishMovement.right;
		moveCoroutine = changeDirection();
		StartCoroutine(moveCoroutine);
	}

	private void hitGround()
	{
		lureReset();
	}

	public void stopDirectionReset()
	{
		if (moveCoroutine != null)
		{
			StopCoroutine(moveCoroutine);
		}
		bFishTurn = false;
		secondTurn = false;
		resetDirection(bFail: false);
	}

	public bool getIsFishJump()
	{
		return FishJump.isJumping;
	}

	private void resetDirection(bool bFail)
	{
		fishingControl.hitContinue = 0;
		fishingControl.hitContinueTime = 0f;
		if (bFail || fishingControl.bCountFail)
		{
			if (fishCon.dragable)
			{
				angryTurnCount++;
				if (angryTurnCount >= angryCountMax)
				{
					resetAngry();
					eFishing = eFishMovement.angry;
					angryTurnCount = 0;
				}
				else
				{
					eFishing = eFishMovement.stay;
				}
			}
			else
			{
				eFishing = eFishMovement.stay;
			}
			fishingControl.bCountFail = false;
			if (bFail)
			{
				nodeFailed();
			}
		}
		else if (fishingControl.fDistance > fishingControl.catchDistance + fishingControl.noChangeDirDistanceAdd)
		{
			if (secondTurn)
			{
				switch (eFishing)
				{
				case eFishMovement.stay:
					eFishing = (eFishMovement)UnityEngine.Random.Range(1, 4);
					break;
				case eFishMovement.up:
					eFishing = (eFishMovement)UnityEngine.Random.Range(2, 4);
					break;
				case eFishMovement.left:
					eFishing = (eFishMovement)(1 + UnityEngine.Random.Range(0, 2) * 2);
					break;
				case eFishMovement.right:
					eFishing = (eFishMovement)UnityEngine.Random.Range(1, 3);
					break;
				case eFishMovement.jumpL:
					eFishing = eFishMovement.stay;
					break;
				case eFishMovement.jumpR:
					eFishing = eFishMovement.stay;
					break;
				case eFishMovement.groggy:
					eFishing = (eFishMovement)UnityEngine.Random.Range(0, 4);
					break;
				case eFishMovement.angry:
					eFishing = eFishMovement.stay;
					break;
				}
			}
			else
			{
				fishingControl.rodDragTension = 0f;
				switch (eFishing)
				{
				case eFishMovement.stay:
					if (main.tutoControl.fighting)
					{
						if (fishCon.fishGrade != 1 && distance > dontTurnDistance)
						{
							eFishing = (eFishMovement)UnityEngine.Random.Range(1, 4);
						}
						else
						{
							eFishing = eFishMovement.stay;
						}
					}
					else
					{
						eFishing = eFishMovement.stay;
					}
					break;
				case eFishMovement.up:
					eFishing = eFishMovement.stay;
					break;
				case eFishMovement.left:
					eFishing = eFishMovement.stay;
					break;
				case eFishMovement.right:
					eFishing = eFishMovement.stay;
					break;
				case eFishMovement.jumpL:
					eFishing = eFishMovement.stay;
					break;
				case eFishMovement.jumpR:
					eFishing = eFishMovement.stay;
					break;
				case eFishMovement.groggy:
					if (fishCon.fishGrade != 1)
					{
						eFishing = (eFishMovement)UnityEngine.Random.Range(0, 4);
					}
					else
					{
						eFishing = eFishMovement.stay;
					}
					break;
				case eFishMovement.angry:
					eFishing = eFishMovement.stay;
					break;
				}
			}
		}
		else
		{
			eFishing = eFishMovement.stay;
		}
		if (main.tutoControl.groggy)
		{
			if (fishingControl.fishHealth <= 0f)
			{
				eFishing = eFishMovement.groggy;
				stopMoving();
			}
			if (groggyNum > groggyRnd)
			{
				groggyRnd = groggyMin + UnityEngine.Random.Range(-2, 3);
				groggyNum = 0;
				eFishing = eFishMovement.groggy;
			}
		}
		iconChange();
		moveCoroutine = changeDirection();
		StartCoroutine(moveCoroutine);
	}

	private void iconChange()
	{
		switch (eFishing)
		{
		case eFishMovement.stay:
			iconControl.iconChange(0);
			StartCoroutine(FadeOutAudio(audioFish, 0.5f));
			uiAngryMode.SetActive(value: false);
			break;
		case eFishMovement.up:
			iconControl.iconChange(1);
			uiAngryMode.SetActive(value: false);
			break;
		case eFishMovement.left:
			iconControl.iconChange(1);
			uiAngryMode.SetActive(value: false);
			break;
		case eFishMovement.right:
			iconControl.iconChange(1);
			uiAngryMode.SetActive(value: false);
			break;
		case eFishMovement.jumpL:
			iconControl.iconChange(1);
			StartCoroutine(FadeOutAudio(audioFish, 0.5f));
			uiAngryMode.SetActive(value: false);
			break;
		case eFishMovement.jumpR:
			iconControl.iconChange(1);
			StartCoroutine(FadeOutAudio(audioFish, 0.5f));
			uiAngryMode.SetActive(value: false);
			break;
		case eFishMovement.groggy:
			iconControl.iconChange(2);
			StartCoroutine(FadeOutAudio(audioFish, 0.5f));
			uiAngryMode.SetActive(value: false);
			if (fishingControl.lineTension > fishingControl.tensionSlack + 5f)
			{
				fishingControl.lineTension = fishingControl.tensionSlack + 5f;
			}
			break;
		case eFishMovement.angry:
			iconControl.iconChange(3);
			uiAngryMode.SetActive(value: true);
			break;
		}
	}

	public void tutorialNext(eFishMovement state)
	{
		eFishing = state;
		iconChange();
		if (moveCoroutine != null)
		{
			StopCoroutine(moveCoroutine);
		}
		moveCoroutine = changeDirection();
		StartCoroutine(moveCoroutine);
	}

	private IEnumerator changeDirection()
	{
		float seconds = 0f;
		bool isNodeFailed = false;
		if (!secondTurn)
		{
			fishingControl.rodDragTension = 0f;
		}
		if (!main.useTutorial)
		{
			if (bFishTurnable)
			{
				if (UnityEngine.Random.Range(0, 2) == 0)
				{
					bFishTurn = true;
				}
				else
				{
					bFishTurn = false;
				}
			}
			if (eFishing != eFishMovement.groggy && fishCon.fishJump && !secondTurn && eFishing != eFishMovement.angry)
			{
				changeDirNum++;
			}
			if (fishingControl.sharkReady && healthRatio > 0.2f)
			{
				sharkNum++;
				if (sharkNum > fishingControl.sharkAppearNumber)
				{
					fishingControl.sharkReady = false;
					fishingControl.changeToShark();
					sharkNum = 0;
				}
			}
			if (changeDirNum > jumpTurnNum && fishCon.fishJump && healthRatio > 0.3f)
			{
				particleControl.particleOff();
				fishingControl.uiArrow.SetActive(value: false);
				handControl.haptic(0.2f, 1f, isMainhand: true);
				jumpTurnNum = UnityEngine.Random.Range(jumpRndMin, jumpRndMax);
				changeDirNum = 0;
				int num = UnityEngine.Random.Range(0, 2);
				float num2 = nextPosPivot.transform.localEulerAngles.y;
				if (num2 > 180f)
				{
					num2 -= 360f;
				}
				if (num == 0)
				{
					if (num2 < 0f - moveangleLimit)
					{
						num = 1;
					}
				}
				else if (num2 > moveangleLimit)
				{
					num = 0;
				}
				if (num == 0)
				{
					eFishing = eFishMovement.jumpL;
					nextDirection = -1f;
					particleControl.splashParitcleRight(isRight: false, 1f, base.transform.position);
					StartCoroutine(particleControl.delaySplashCreate(base.gameObject, fishCon.fishSize * 0.01f, 1.1f));
					fishingControl.uiHookL.SetActive(value: true);
					IEnumerator routine = fishingControl.countCheck(0);
					StartCoroutine(routine);
				}
				else
				{
					eFishing = eFishMovement.jumpR;
					nextDirection = 1f;
					particleControl.splashParitcleRight(isRight: true, 1f, base.transform.position);
					StartCoroutine(particleControl.delaySplashCreate(base.gameObject, fishCon.fishSize * 0.01f, 1.1f));
					fishingControl.uiHookR.SetActive(value: true);
					IEnumerator routine2 = fishingControl.countCheck(1);
					StartCoroutine(routine2);
				}
				if (fishCon.isMonsterFishing)
				{
					fishCon.fishInst.monsterRoaming(isTrue: false);
				}
				fishJump();
				yield return new WaitForSeconds(1f);
				fishingControl.uiHookL.SetActive(value: false);
				fishingControl.uiHookR.SetActive(value: false);
			}
			else
			{
				switch (eFishing)
				{
				case eFishMovement.stay:
					MultiplayEventManager.Instance.SendFishState(FishState.Stay);
					fishingControl.uiArrow.SetActive(value: false);
					particleControl.particleOff();
					if (fishCon.isFish)
					{
						nextTarget.SetBool("roam", value: true);
					}
					nextDirection = 0f;
					seconds = UnityEngine.Random.Range(changeFishDirRndMin, changeFishDirRndMax) * fishCon.fishRedirect;
					break;
				case eFishMovement.up:
					MultiplayEventManager.Instance.SendFishState(FishState.Swim);
					fishingControl.uiArrow.SetActive(value: true);
					if (fishCon.isMonsterFishing)
					{
						fishCon.fishInst.monsterRoaming(isTrue: false);
					}
					if (secondTurn)
					{
						StartCoroutine(fishingControl.turnArrow(0f, lerp: true));
					}
					else
					{
						StartCoroutine(fishingControl.turnArrow(0f, lerp: false));
					}
					nextTarget.SetBool("roam", value: false);
					audioFish.clip = aFishSwimg;
					audioFish.Play();
					nextDirection = 0f;
					particleControl.particleOn();
					if (!secondTurn)
					{
						if (bFishTurn)
						{
							seconds = nodeInputTime * 0.7f;
							secondTurn = true;
						}
						else
						{
							seconds = nodeInputTime;
							secondTurn = false;
							isNodeFailed = true;
						}
					}
					else
					{
						seconds = nodeInputTime * 0.7f;
						isNodeFailed = true;
						secondTurn = false;
						bFishTurn = false;
					}
					break;
				case eFishMovement.left:
				{
					MultiplayEventManager.Instance.SendFishState(FishState.Swim);
					if (fishCon.isMonsterFishing)
					{
						fishCon.fishInst.monsterRoaming(isTrue: false);
					}
					nextTarget.SetBool("roam", value: false);
					audioFish.clip = aFishSwimg;
					audioFish.Play();
					float num2 = nextPosPivot.transform.localEulerAngles.y;
					if (num2 > 180f)
					{
						num2 -= 360f;
					}
					if (num2 > 0f - moveangleLimit)
					{
						nextDirection = -1f;
						particleControl.particleOn();
					}
					else
					{
						eFishing = eFishMovement.right;
						nextDirection = 1f;
						particleControl.particleOn();
					}
					fishingControl.uiArrow.SetActive(value: true);
					if (!secondTurn)
					{
						StartCoroutine(fishingControl.turnArrow(nextDirection * -90f, lerp: false));
						if (bFishTurn)
						{
							seconds = nodeInputTime * 0.7f;
							secondTurn = true;
						}
						else
						{
							seconds = nodeInputTime;
							secondTurn = false;
							isNodeFailed = true;
						}
					}
					else
					{
						StartCoroutine(fishingControl.turnArrow(nextDirection * -90f, lerp: true));
						seconds = nodeInputTime * 0.7f;
						isNodeFailed = true;
						secondTurn = false;
						bFishTurn = false;
					}
					break;
				}
				case eFishMovement.right:
				{
					MultiplayEventManager.Instance.SendFishState(FishState.Swim);
					if (fishCon.isMonsterFishing)
					{
						fishCon.fishInst.monsterRoaming(isTrue: false);
					}
					nextTarget.SetBool("roam", value: false);
					audioFish.clip = aFishSwimg;
					audioFish.Play();
					float num2 = nextPosPivot.transform.localEulerAngles.y;
					if (num2 > 180f)
					{
						num2 -= 360f;
					}
					if (num2 < moveangleLimit)
					{
						nextDirection = 1f;
						particleControl.particleOn();
					}
					else
					{
						eFishing = eFishMovement.left;
						nextDirection = -1f;
						particleControl.particleOn();
					}
					fishingControl.uiArrow.SetActive(value: true);
					if (!secondTurn)
					{
						StartCoroutine(fishingControl.turnArrow(nextDirection * -90f, lerp: false));
						if (bFishTurn)
						{
							seconds = nodeInputTime * 0.7f;
							secondTurn = true;
						}
						else
						{
							seconds = nodeInputTime;
							secondTurn = false;
							isNodeFailed = true;
						}
					}
					else
					{
						StartCoroutine(fishingControl.turnArrow(nextDirection * -90f, lerp: true));
						seconds = nodeInputTime * 0.7f;
						isNodeFailed = true;
						secondTurn = false;
						bFishTurn = false;
					}
					break;
				}
				case eFishMovement.groggy:
					MultiplayEventManager.Instance.SendFishState(FishState.Stay);
					fishingControl.uiArrow.SetActive(value: false);
					particleControl.particleOff();
					nextTarget.SetBool("roam", value: false);
					nextDirection = 0f;
					seconds = UnityEngine.Random.Range(changeFishDirRndMin, changeFishDirRndMax) * fishCon.fishRedirect;
					break;
				case eFishMovement.angry:
					MultiplayEventManager.Instance.SendFishState(FishState.Drag);
					if (fishCon.isMonsterFishing)
					{
						fishCon.fishInst.monsterRoaming(isTrue: false);
					}
					fishingControl.uiArrow.SetActive(value: false);
					nextTarget.SetBool("roam", value: false);
					audioFish.clip = aFishSwimg;
					audioFish.Play();
					nextDirection = 0f;
					particleControl.particleOn();
					seconds = UnityEngine.Random.Range(changeFishDirRndMin, changeFishDirRndMax);
					break;
				case eFishMovement.landing:
					MultiplayEventManager.Instance.SendFishState(FishState.Swim);
					landing();
					seconds = 10f;
					break;
				}
				particleControl.waterParticleControl();
				yield return new WaitForSeconds(seconds);
			}
			resetDirection(isNodeFailed);
			yield break;
		}
		bFishTurn = false;
		if (main.tutoControl.tutoState == control_tutorial.tutorialState.jump)
		{
			particleControl.particleOff();
			fishingControl.uiArrow.SetActive(value: false);
			handControl.haptic(0.2f, 1f, isMainhand: true);
			bool jumpLeft = true;
			while (main.tutoControl.tutoState == control_tutorial.tutorialState.jump)
			{
				if (jumpLeft)
				{
					eFishing = eFishMovement.jumpL;
					nextDirection = -1f;
					particleControl.splashParitcleRight(isRight: false, 1f, base.transform.position);
					StartCoroutine(particleControl.delaySplashCreate(base.gameObject, fishCon.fishSize * 0.01f, 1.1f));
					fishingControl.uiHookL.SetActive(value: true);
					IEnumerator routine3 = fishingControl.countCheck(0);
					StartCoroutine(routine3);
				}
				else
				{
					eFishing = eFishMovement.jumpR;
					nextDirection = 1f;
					particleControl.splashParitcleRight(isRight: true, 1f, base.transform.position);
					StartCoroutine(particleControl.delaySplashCreate(base.gameObject, fishCon.fishSize * 0.01f, 1.1f));
					fishingControl.uiHookR.SetActive(value: true);
					IEnumerator routine4 = fishingControl.countCheck(1);
					StartCoroutine(routine4);
				}
				iconChange();
				fishJump();
				jumpLeft = !jumpLeft;
				yield return new WaitForSeconds(1f);
				nextDirection *= 0.5f;
				fishingControl.uiHookL.SetActive(value: false);
				fishingControl.uiHookR.SetActive(value: false);
				yield return new WaitForSeconds(3f);
			}
		}
		else
		{
			switch (eFishing)
			{
			case eFishMovement.stay:
				fishingControl.uiArrow.SetActive(value: false);
				particleControl.particleOff();
				if (fishCon.isFish)
				{
					nextTarget.SetBool("roam", value: true);
				}
				nextDirection = 0f;
				while (main.tutoControl.tutoState == control_tutorial.tutorialState.linetension)
				{
					yield return null;
				}
				break;
			case eFishMovement.right:
				nextTarget.SetBool("roam", value: false);
				audioFish.clip = aFishSwimg;
				audioFish.Play();
				nextDirection = 1f;
				particleControl.particleOn();
				fishingControl.uiArrow.SetActive(value: true);
				StartCoroutine(fishingControl.turnArrow(nextDirection * -90f, lerp: false));
				_ = nodeInputTime;
				secondTurn = false;
				yield return new WaitForSeconds(2f);
				nextDirection = 0f;
				break;
			case eFishMovement.groggy:
				fishingControl.uiArrow.SetActive(value: false);
				particleControl.particleOff();
				nextTarget.SetBool("roam", value: false);
				nextDirection = 0f;
				break;
			case eFishMovement.landing:
				landing();
				break;
			}
		}
		particleControl.waterParticleControl();
	}

	private void fishJump()
	{
		fishCon.fishInst.fishJump(1f);
		FishJump.jumpShaking(fishCon.fishJumpHeight);
		MultiplayEventManager.Instance.SendFishState(FishState.Jump);
	}

	public void landing()
	{
		fishingControl.uiArrow.SetActive(value: false);
		if (fishCon.isFish)
		{
			nextTarget.SetBool("roam", value: true);
		}
		if (!audioFish.isPlaying)
		{
			audioFish.clip = aFishSwimg;
			audioFish.Play();
		}
		nextDirection = 0f;
		fishCon.fishInst.fishLandingWait();
	}

	private void nodeFailed()
	{
		fishingControl.fightingNodeFailed();
		secondTurn = false;
	}

	public void failedCatch(int type)
	{
		fishCon.fishInst.fishFailed();
		StartCoroutine(particleControl.delaySplashCreate(base.transform.position, fishCon.fishSize * 0.01f, 0.8f));
	}

	public void audioStop()
	{
		audioFish.Stop();
	}

	private IEnumerator FadeOutAudio(AudioSource audioSource, float FadeTime)
	{
		float startVolume = audioSource.volume;
		while (audioSource.volume > 0f)
		{
			audioSource.volume -= startVolume * Time.deltaTime / FadeTime;
			yield return null;
		}
		audioSource.Stop();
		audioSource.volume = startVolume;
	}

	public void reset()
	{
		baitControl.OnOffGravity(gravity: true);
		angryTurnCount = 0;
		if (audioFish != null)
		{
			audioFish.Stop();
		}
		uiAngryMode.SetActive(value: false);
		secondTurn = false;
		bFishTurnable = false;
		nextTarget.SetBool("roam", value: false);
		healthRatio = 1f;
		jumpTurnNum = UnityEngine.Random.Range(jumpRndMin, jumpRndMax);
		changeDirNum = 0;
		sharkNum = 0;
		if (particleControl != null)
		{
			particleControl.particleOff();
		}
		eFishing = eFishMovement.stay;
		stopMoving();
	}

	public void resetShark()
	{
		angryTurnCount = 0;
		if (audioFish != null)
		{
			audioFish.Stop();
		}
		uiAngryMode.SetActive(value: false);
		secondTurn = false;
		bFishTurnable = false;
		fishingControl.sDangerTension = 0f;
		jumpTurnNum = UnityEngine.Random.Range(jumpRndMin, jumpRndMax);
		changeDirNum = 0;
		sharkNum = 0;
	}

	public void changeCurLength(float length)
	{
		cursor.ChangeLength(length);
	}

	public void lureReset()
	{
		base.transform.parent = null;
		base.transform.rotation = Quaternion.identity;
		rb.isKinematic = false;
		StartCoroutine(lineWind(3f));
	}

	public IEnumerator lureFailReset()
	{
		yield return null;
		tackleCon.reelWind(3);
		while (distance > 3f)
		{
			cursor.ChangeLength(distance * 0.5f);
			Vector3 vector = Vector3.Normalize(new Vector3(fishingControl.pinPosition.position.x, envControl.water_Height - lureHeightFromWater, fishingControl.pinPosition.position.z) - base.transform.position);
			rb.MovePosition(base.transform.position + vector * Time.deltaTime * reelRewindSpeed * (distance * 0.5f + 1f));
			yield return new WaitForFixedUpdate();
		}
		tackleCon.reelWind(0);
		rb.isKinematic = false;
		StartCoroutine(lineWind(2f));
	}

	public void fishAngryCount()
	{
		if (fishCon.fishJump)
		{
			angryTurnCount++;
		}
	}

	private IEnumerator lineWind(float speed)
	{
		while (rope.RestLength > 0.3f)
		{
			cursor.ChangeLength(rope.RestLength - Time.deltaTime * speed);
			yield return null;
		}
	}

	private void resetAngry()
	{
		angryCountMax = 6 - UnityEngine.Random.Range(0, fishCon.fishGrade);
	}
}
public class control_Menu : MonoBehaviour
{
	public GameObject[] menuPanels;

	public GameObject settingFrameObj;

	public GameObject settingHandObj;

	public GameObject settingQualityObj;

	public GameObject positionStage;

	public GameObject positionLodge;

	public Color colorSelected;

	public Color colorUnselected;

	public Color colorBack;

	private int musicVolume;

	private int ambientVolume;

	private int settingQuailityIndex;

	private int settingFrameIndex = 1;

	private int settingUiIndex;

	public Image playerPosIcon;

	public Image musicSelectImage;

	public Image ambientSelectImage;

	public Image[] musicVolumeImages;

	public Image[] ambientVolumeImages;

	public Image[] graphicSettingImages;

	public Image[] graphicSettingCheck;

	public Image[] frameSettingImages;

	public Image[] frameSettingCheck;

	public Image[] handSettingImages;

	public Image[] handSettingCheck;

	public Image[] uimodeSettingCheck;

	public GameObject uimodeLineEffectButton;

	public Text uimodeLineColorCheck;

	public Button[] menuButtonsForLock;

	private DataManager dataManager;

	[HideInInspector]
	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	public void MenuOn()
	{
		reset();
		if (main.scene == SceneState.STAGE)
		{
			if (!main.fishingControl.isTackleGround && main.isMenuOn)
			{
				main.handControl.setTackleGround(handReset: true);
			}
		}
		else
		{
			_ = main.scene;
			_ = 1;
		}
	}

	private void MenuSetActiveTrue(int number)
	{
		menuPanels[number].SetActive(value: true);
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
		{
			settingHandObj.SetActive(value: false);
			settingQualityObj.SetActive(value: false);
		}
		else
		{
			settingHandObj.SetActive(value: true);
			settingQualityObj.SetActive(value: true);
		}
	}

	public void ClickMneuButton(int num)
	{
		if (num == -1)
		{
			return;
		}
		for (int i = 0; i < menuPanels.Length; i++)
		{
			if (num == i)
			{
				MenuSetActiveTrue(i);
			}
			else
			{
				menuPanels[i].SetActive(value: false);
			}
		}
		switch (num)
		{
		case 1:
			if (main.scene == SceneState.STAGE)
			{
				positionLodge.SetActive(value: false);
				positionStage.SetActive(value: true);
				playerPosIcon.rectTransform.localPosition = new Vector3(dataManager.userData.position.z * 60f, dataManager.userData.position.y * 60f, 0f);
			}
			else if (main.scene == SceneState.LOBBY || main.scene == SceneState.ROOM)
			{
				positionLodge.SetActive(value: true);
				positionStage.SetActive(value: false);
				playerPosIcon.rectTransform.localPosition = new Vector3(0f, dataManager.lobbyCamHeight * 10f * 60f, 0f);
			}
			break;
		case 0:
		case 2:
		case 3:
			break;
		}
	}

	public void cameraMoveControl(int pos)
	{
		if (main.scene == SceneState.STAGE)
		{
			if (!main.useTutorial)
			{
				dataManager.userData.position.y = pos / 10 - 3;
				dataManager.userData.position.z = pos % 10 - 3;
				setPlayerPosition();
				playerPosIcon.rectTransform.localPosition = new Vector3(dataManager.userData.position.z * 60f, dataManager.userData.position.y * 60f, 0f);
				Singleton<Console>.Instance.setPosition();
			}
		}
		else
		{
			main.vrPlayerController.SetHeight(pos);
			playerPosIcon.rectTransform.localPosition = new Vector3(0f, dataManager.lobbyCamHeight * 10f * 60f, 0f);
			Singleton<Console>.Instance.setPosition();
		}
	}

	private void setPlayerPosition()
	{
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			main.vrFishingPlayerController.playerTransform.position = new Vector3(0f, 1.2f + dataManager.userData.position.y * 0.2f, dataManager.userData.position.z * 0.2f);
		}
		else
		{
			main.vrFishingPlayerController.playerTransform.position = new Vector3(0f, dataManager.userData.position.y * 0.1f, dataManager.userData.position.z * 0.2f);
		}
	}

	public void reset()
	{
		settingReset();
		if (!main.useTutorial)
		{
			menuPanels[0].SetActive(value: true);
			for (int i = 1; i < menuPanels.Length; i++)
			{
				menuPanels[i].SetActive(value: false);
			}
		}
		else
		{
			for (int j = 0; j < menuPanels.Length; j++)
			{
				menuPanels[j].SetActive(value: false);
			}
			MenuSetActiveTrue(2);
		}
	}

	public void settingMusic(int volume)
	{
		if (main.useTutorial)
		{
			return;
		}
		if (main.scene == SceneState.STAGE)
		{
			main.soundControl.setMusicVolume(volume);
		}
		else
		{
			main.lobbyUIManager.SetMusicVolume(volume);
		}
		for (int i = 0; i < musicVolumeImages.Length; i++)
		{
			if (i <= dataManager.userData.volumeMusic)
			{
				musicVolumeImages[i].color = colorSelected;
			}
			else
			{
				musicVolumeImages[i].color = colorUnselected;
			}
		}
	}

	public void settingAmbient(int volume)
	{
		if (main.useTutorial)
		{
			return;
		}
		if (main.scene == SceneState.STAGE)
		{
			main.soundControl.setAmbientVolume(volume);
		}
		else
		{
			main.lobbyUIManager.SetAmbientVolume(volume);
		}
		for (int i = 0; i < ambientVolumeImages.Length; i++)
		{
			if (i <= dataManager.userData.volumeAmbient)
			{
				ambientVolumeImages[i].color = colorSelected;
			}
			else
			{
				ambientVolumeImages[i].color = colorUnselected;
			}
		}
	}

	public void settingQuaility(int quality)
	{
		if (!main.useTutorial)
		{
			dataManager.userData.graphicQuality = quality;
			for (int i = 0; i < graphicSettingCheck.Length; i++)
			{
				graphicSettingCheck[i].enabled = false;
			}
			graphicSettingCheck[dataManager.userData.graphicQuality].enabled = true;
			main.settingController.qualityChange();
			staticLoading.Stage = SceneManager.GetActiveScene().name;
			SceneManager.LoadScene("Loading");
		}
	}

	public void settingFramerate(bool bHigh)
	{
		if (!main.useTutorial)
		{
			dataManager.userData.bFrameRateHigh = bHigh;
			for (int i = 0; i < frameSettingCheck.Length; i++)
			{
				frameSettingCheck[i].enabled = false;
			}
			if (bHigh)
			{
				frameSettingCheck[1].enabled = true;
			}
			else
			{
				frameSettingCheck[0].enabled = true;
			}
			main.settingController.frameRateChange();
		}
	}

	public void settingHand(int hand)
	{
		if (main.useTutorial)
		{
			return;
		}
		switch (hand)
		{
		case 0:
			dataManager.userData.rightHand = false;
			Singleton<MediaController>.Instance.ChangeAnchor();
			handSettingCheck[0].enabled = true;
			handSettingCheck[1].enabled = false;
			if (main.scene == SceneState.STAGE)
			{
				main.vrFishingPlayerController.SetController();
			}
			else
			{
				main.lobbyUIManager.SetHand(right: false);
			}
			break;
		case 1:
			dataManager.userData.rightHand = true;
			Singleton<MediaController>.Instance.ChangeAnchor();
			handSettingCheck[0].enabled = false;
			handSettingCheck[1].enabled = true;
			if (main.scene == SceneState.STAGE)
			{
				main.vrFishingPlayerController.SetController();
			}
			else
			{
				main.lobbyUIManager.SetHand(right: true);
			}
			break;
		case 2:
		{
			if (main.scene == SceneState.LOBBY)
			{
				main.lobbyUIManager.SetHandBoth();
				break;
			}
			bool flag = !dataManager.userData.bothHand;
			dataManager.userData.bothHand = flag;
			if (flag)
			{
				handSettingCheck[2].enabled = true;
			}
			else
			{
				handSettingCheck[2].enabled = false;
			}
			break;
		}
		}
		dataManager.SaveUserData();
		if (main.scene == SceneState.STAGE)
		{
			main.handControl.setMainHand();
		}
	}

	public void settingDifficulty(int difficulty)
	{
		if (main.useTutorial || dataManager.userData.gameDifficulty == difficulty)
		{
			return;
		}
		dataManager.userData.gameDifficulty = difficulty;
		for (int i = 0; i < uimodeSettingCheck.Length; i++)
		{
			uimodeSettingCheck[i].enabled = false;
		}
		uimodeSettingCheck[difficulty].enabled = true;
		if (main.scene == SceneState.STAGE)
		{
			main.gpointControl.fishHide();
			if (dataManager.userData.gameDifficulty == 0)
			{
				main.fishingControl.uiOnOff(onOff: true);
			}
			else
			{
				main.fishingControl.uiOnOff(onOff: false);
			}
			main.gpointControl.resetFishAll();
			main.fishingControl.bCastingReady = false;
		}
	}

	public void settingLineEffect()
	{
		if (!main.useTutorial)
		{
			if (dataManager.userData.lineEfffect)
			{
				dataManager.userData.lineEfffect = false;
				uimodeLineColorCheck.enabled = false;
			}
			else
			{
				dataManager.userData.lineEfffect = true;
				uimodeLineColorCheck.enabled = true;
			}
		}
	}

	private void settingReset()
	{
		musicSelectImage.color = colorUnselected;
		musicVolume = dataManager.userData.volumeMusic;
		for (int i = 0; i < musicVolumeImages.Length; i++)
		{
			if (i <= musicVolume)
			{
				musicVolumeImages[i].color = colorSelected;
			}
			else
			{
				musicVolumeImages[i].color = colorUnselected;
			}
		}
		ambientSelectImage.color = colorUnselected;
		ambientVolume = dataManager.userData.volumeAmbient;
		for (int j = 0; j < ambientVolumeImages.Length; j++)
		{
			if (j <= ambientVolume)
			{
				ambientVolumeImages[j].color = colorSelected;
			}
			else
			{
				ambientVolumeImages[j].color = colorUnselected;
			}
		}
		settingQuailityIndex = dataManager.userData.graphicQuality;
		for (int k = 0; k < graphicSettingCheck.Length; k++)
		{
			graphicSettingCheck[k].enabled = false;
		}
		graphicSettingCheck[settingQuailityIndex].enabled = true;
		for (int l = 0; l < frameSettingCheck.Length; l++)
		{
			frameSettingCheck[l].enabled = false;
		}
		if (!dataManager.userData.bFrameRateHigh)
		{
			settingFrameIndex = 0;
		}
		else
		{
			settingFrameIndex = 1;
		}
		frameSettingCheck[settingFrameIndex].enabled = true;
		handSettingCheck[0].enabled = !dataManager.userData.rightHand;
		handSettingCheck[1].enabled = dataManager.userData.rightHand;
		handSettingCheck[2].enabled = dataManager.userData.bothHand;
		for (int m = 0; m < uimodeSettingCheck.Length; m++)
		{
			uimodeSettingCheck[m].enabled = false;
		}
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			uimodeLineEffectButton.SetActive(value: false);
		}
		else
		{
			uimodeLineEffectButton.SetActive(value: true);
			if (dataManager.userData.lineEfffect)
			{
				uimodeLineColorCheck.enabled = true;
			}
			else
			{
				uimodeLineColorCheck.enabled = false;
			}
		}
		if (dataManager.userData.gameDifficulty == 0)
		{
			settingUiIndex = 0;
		}
		else if (dataManager.userData.gameDifficulty == 1)
		{
			settingUiIndex = 1;
		}
		else
		{
			settingUiIndex = 2;
		}
		uimodeSettingCheck[settingUiIndex].enabled = true;
	}

	public void quitgame()
	{
		OVRManager.PlatformUIConfirmQuit();
	}

	public void changeTackle()
	{
		if (main.scene == SceneState.STAGE)
		{
			main.tackleControl.changeTackle();
		}
	}
}
public class control_menuItem : MonoBehaviour
{
	public Image[] lureImages;

	private void Start()
	{
	}

	private void Update()
	{
	}
}
public class control_particle : MonoBehaviour
{
	private control_Fishing fishingControl;

	private control_fish fishControl;

	private control_handselect handControl;

	private control_envrionment envControl;

	public GameObject pSplashJumpLPrefab;

	public GameObject pSplashJumpRPrefab;

	public ParticleSystem ps_ripple;

	public ParticleSystem ps_splash;

	public ParticleSystem ps_runSplahs;

	private ParticleSystem.MainModule pmainRipple;

	private ParticleSystem.MainModule pmainSplash;

	private ParticleSystem.MainModule pmainRunSplahs;

	public GameObject bigSplash;

	public GameObject releaseSplash_small;

	public GameObject releaseSplash_middle;

	public GameObject releaseSplash_large;

	public GameObject smallSplash;

	public effectCircle lureAttractEffect;

	private float rippleSize;

	private float splashSize;

	private float runSplahsSize;

	private Main main;

	private void Awake()
	{
		main = Singleton<Main>.Instance;
		fishingControl = main.fishingControl;
		fishControl = main.fishControl;
		envControl = main.envControl;
		handControl = main.handControl;
		pmainRipple = ps_ripple.main;
		pmainSplash = ps_splash.main;
		pmainRunSplahs = ps_runSplahs.main;
		rippleSize = pmainRipple.startSize.constant;
		splashSize = pmainSplash.startSize.constant;
		runSplahsSize = pmainRunSplahs.startSize.constant;
	}

	public void particleOn()
	{
		pmainSplash.loop = true;
		pmainRunSplahs.loop = true;
		if (fishControl.fishGrade == 1)
		{
			pmainSplash.startSize = splashSize * 0.5f;
			pmainRunSplahs.startSize = runSplahsSize * 0.5f;
		}
		else if (fishControl.fishGrade == 2)
		{
			pmainSplash.startSize = splashSize * 0.7f;
			pmainRunSplahs.startSize = runSplahsSize * 0.7f;
		}
		else if (fishControl.fishGrade == 3)
		{
			pmainSplash.startSize = splashSize;
			pmainRunSplahs.startSize = runSplahsSize;
		}
		ps_splash.Play();
		ps_runSplahs.Play();
	}

	public void particleOff()
	{
		pmainSplash.loop = false;
		pmainRunSplahs.loop = false;
	}

	public void splashParitcleRight(bool isRight, float scale, Vector3 pos)
	{
		GameObject gameObject = ((!isRight) ? UnityEngine.Object.Instantiate(pSplashJumpLPrefab, new Vector3(pos.x, envControl.water_Height, pos.z), Quaternion.identity) : UnityEngine.Object.Instantiate(pSplashJumpRPrefab, new Vector3(pos.x, envControl.water_Height, pos.z), Quaternion.identity));
		gameObject.transform.localScale = new Vector3(scale, scale, scale);
	}

	public void waterParticleControl()
	{
		switch (fishingControl.gameState)
		{
		case control_Fishing.EfishingState.ready:
			pmainRipple.loop = false;
			break;
		case control_Fishing.EfishingState.casting:
			pmainRipple.loop = false;
			break;
		case control_Fishing.EfishingState.retrieve:
			pmainRipple.loop = true;
			ps_ripple.Play();
			pmainRipple.startSize = rippleSize * 0.5f;
			break;
		case control_Fishing.EfishingState.fighting:
			pmainRipple.loop = true;
			ps_ripple.Play();
			pmainRipple.startSize = rippleSize;
			break;
		case control_Fishing.EfishingState.landing:
			particleOn();
			break;
		case control_Fishing.EfishingState.catching:
			pmainRipple.loop = false;
			particleOff();
			break;
		case control_Fishing.EfishingState.failed:
			pmainRipple.loop = false;
			break;
		}
	}

	public void bigsplashCreate(Vector3 position, float size)
	{
		GameObject obj = UnityEngine.Object.Instantiate(bigSplash, new Vector3(position.x, envControl.water_Height, position.z), Quaternion.identity);
		size = Mathf.Clamp(size, 0.2f, 1.5f);
		obj.transform.localScale = new Vector3(size, size, size);
	}

	public IEnumerator delaySplashCreate(GameObject posObj, float size, float time)
	{
		yield return new WaitForSeconds(time);
		handControl.haptic(0.2f, 0.5f, isMainhand: true);
		bigsplashCreate(posObj.transform.position, size);
	}

	public IEnumerator delaySplashCreate(Vector3 pos, float size, float time)
	{
		yield return new WaitForSeconds(time);
		bigsplashCreate(pos, size);
	}

	public void splashCreate()
	{
		UnityEngine.Object.Instantiate(smallSplash, new Vector3(base.transform.position.x, envControl.water_Height, base.transform.position.z), Quaternion.identity);
	}

	public void effectCircleCreate()
	{
		lureAttractEffect.create();
	}

	public void effectCircleStop()
	{
		lureAttractEffect.stop();
	}
}
public class control_score : MonoBehaviour
{
	public GameObject panelPivot;

	private control_Lure lureControl;

	private control_Fishing fishingControl;

	private control_tackle tackleControl;

	private control_handselect handControl;

	public Text textFishName;

	public Text textFishLength;

	public Text textFishRare;

	public Text textBonus;

	public Text textBonusNum;

	public Vector3 DistanceFromCatchPos = new Vector3(0f, 0.5f, 1f);

	private Vector3 catchPosition;

	public Canvas canvas;

	public float scoreTime = 1.4f;

	public Image uiRelease;

	public Image uiKeep;

	public Text textRelease;

	public Text textKeep;

	public Image uiGlow;

	public Color selectColor = new Color32(229, 157, 81, 200);

	public Color nonselectColor = new Color32(103, 234, 233, 200);

	public int goldMaximum = 100000;

	private int exp;

	private int gold;

	public Text userLv;

	public Text userGold;

	public Slider lvSlider;

	public GameObject textMaxLv;

	public Text infoExp;

	public Text infoGold;

	private bool oldDir = true;

	public float baseScoreWeight = 30f;

	public float scoreMultiply = 0.01f;

	public float goldMultiply = 3f;

	public float bonusHard = 1.5f;

	public float bonusExpert = 2f;

	public float seaLevelBonus = 1.5f;

	private AudioSource audios;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		fishingControl = main.fishingControl;
		lureControl = main.lureControl;
		tackleControl = main.tackleControl;
		handControl = main.handControl;
		scoreHide();
	}

	private void Start()
	{
		lvSlider.value = dataManager.userExpBar;
		userGold.text = dataManager.userData.userGold.ToString();
		audios = GetComponent<AudioSource>();
	}

	public void scoreShow(string fishName, int fishID, float fishLength, float fishBonus, float fishWeight, bool fishRare, Vector3 catchPos)
	{
		catchPosition = catchPos;
		panelPivot.transform.position = new Vector3(catchPosition.x, catchPosition.y + DistanceFromCatchPos.y, catchPosition.z + DistanceFromCatchPos.z);
		canvas.enabled = true;
		textFishName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.dlcs[0].fishItems[fishID].multiLineNameKey);
		if (fishRare)
		{
			textFishRare.gameObject.SetActive(value: true);
		}
		else
		{
			textFishRare.gameObject.SetActive(value: false);
		}
		if (dataManager.userData.unit == 0)
		{
			float num = dataManager.changeUnitLength(fishLength);
			dataManager.changeUnitWeight(fishWeight);
			textFishLength.text = num.ToString("N3") + " " + LocalizationManager.GetKeyTranslation("LodgeTVSettings/0013");
		}
		else
		{
			textFishLength.text = fishLength.ToString("N2") + " " + LocalizationManager.GetKeyTranslation("LodgeTVSettings/0014");
		}
		textBonus.gameObject.SetActive(value: false);
		textBonusNum.gameObject.SetActive(value: false);
		userLv.text = dataManager.userData.userLv.ToString();
		userGold.text = dataManager.userData.userGold.ToString();
		fishingControl.getFish++;
		int grade = dataManager.ItemDatabase.dlcs[dataManager.currentNation].fishItems[fishID].grade;
		float num2 = fishLength * scoreMultiply;
		if (dataManager.userData.gameDifficulty == 0)
		{
			textBonus.gameObject.SetActive(value: false);
			textBonusNum.gameObject.SetActive(value: false);
			if (main.envControl.stageInfos.stageType == 0 || main.envControl.stageInfos.stageType == 1)
			{
				num2 *= seaLevelBonus;
			}
			exp = Mathf.CeilToInt(num2 * (1f + fishBonus));
			gold = Mathf.CeilToInt(num2 * (1f + fishBonus) * goldMultiply);
			if (fishRare)
			{
				dataManager.userData.totalScore += grade * 3;
			}
			else
			{
				dataManager.userData.totalScore += grade;
			}
		}
		else if (dataManager.userData.gameDifficulty == 1)
		{
			textBonus.gameObject.SetActive(value: true);
			textBonusNum.gameObject.SetActive(value: true);
			if (main.envControl.stageInfos.stageType == 0 || main.envControl.stageInfos.stageType == 1)
			{
				num2 *= seaLevelBonus;
			}
			textBonusNum.text = "x 2";
			exp = Mathf.CeilToInt(num2 * bonusHard * (1f + fishBonus));
			gold = Mathf.CeilToInt(num2 * bonusHard * (1f + fishBonus) * goldMultiply);
			if (fishRare)
			{
				dataManager.userData.totalScore += (int)((float)(grade * 3) * bonusHard);
			}
			else
			{
				dataManager.userData.totalScore += (int)((float)grade * bonusHard);
			}
		}
		else
		{
			textBonus.gameObject.SetActive(value: true);
			textBonusNum.gameObject.SetActive(value: true);
			if (main.envControl.stageInfos.stageType == 0 || main.envControl.stageInfos.stageType == 1)
			{
				num2 *= seaLevelBonus;
			}
			textBonusNum.text = "x 3";
			exp = Mathf.CeilToInt(num2 * bonusExpert * (1f + fishBonus));
			gold = Mathf.CeilToInt(num2 * bonusExpert * (1f + fishBonus) * goldMultiply);
			if (fishRare)
			{
				dataManager.userData.totalScore += (int)((float)(grade * 3) * bonusExpert);
			}
			else
			{
				dataManager.userData.totalScore += (int)((float)grade * bonusExpert);
			}
		}
		if (dataManager.userData.userLv < dataManager.maxLevel)
		{
			infoExp.GetComponent<Localize>().SetKey("LodgeTVFishingTackle/0002");
			infoExp.text = "+ " + exp + " " + infoExp.text;
			textMaxLv.SetActive(value: false);
		}
		else
		{
			infoExp.GetComponent<Localize>().SetKey("FishingSpot/0005");
			lvSlider.gameObject.SetActive(value: false);
			textMaxLv.SetActive(value: true);
		}
		if (dataManager.userData.userGold < goldMaximum)
		{
			infoGold.GetComponent<Localize>().SetKey("FishingSpot/0006");
			infoGold.text = "+ " + gold + " " + infoGold.text;
		}
		else
		{
			infoGold.GetComponent<Localize>().SetKey("FishingSpotTablet/0025");
		}
		uiKeep.raycastTarget = true;
		uiRelease.raycastTarget = true;
	}

	public void scoreHide()
	{
		textMaxLv.SetActive(value: false);
		canvas.enabled = false;
	}

	public void ScorebuttonOverlay(bool release)
	{
		uiGlow.enabled = true;
		if (release)
		{
			uiRelease.color = selectColor;
			uiRelease.rectTransform.localPosition = new Vector3(uiRelease.rectTransform.localPosition.x, uiRelease.rectTransform.localPosition.y, -20f);
			textRelease.color = Color.white;
			uiKeep.color = nonselectColor;
			uiKeep.rectTransform.localPosition = new Vector3(uiKeep.rectTransform.localPosition.x, uiKeep.rectTransform.localPosition.y, -8f);
			textKeep.color = new Color32(60, 60, 60, byte.MaxValue);
			uiGlow.rectTransform.localPosition = new Vector3(-170f, uiGlow.rectTransform.localPosition.y, uiGlow.rectTransform.localPosition.z);
			audios.Play();
		}
		else
		{
			uiRelease.color = nonselectColor;
			uiRelease.rectTransform.localPosition = new Vector3(uiRelease.rectTransform.localPosition.x, uiRelease.rectTransform.localPosition.y, -8f);
			textRelease.color = new Color32(60, 60, 60, byte.MaxValue);
			uiKeep.color = selectColor;
			uiKeep.rectTransform.localPosition = new Vector3(uiKeep.rectTransform.localPosition.x, uiKeep.rectTransform.localPosition.y, -20f);
			textKeep.color = Color.white;
			uiGlow.rectTransform.localPosition = new Vector3(170f, uiGlow.rectTransform.localPosition.y, uiGlow.rectTransform.localPosition.z);
			audios.Play();
		}
	}

	public void ScorebuttonOut()
	{
		uiRelease.color = nonselectColor;
		uiRelease.rectTransform.localPosition = new Vector3(uiRelease.rectTransform.localPosition.x, uiRelease.rectTransform.localPosition.y, -8f);
		textRelease.color = new Color32(60, 60, 60, byte.MaxValue);
		uiKeep.color = nonselectColor;
		uiKeep.rectTransform.localPosition = new Vector3(uiKeep.rectTransform.localPosition.x, uiKeep.rectTransform.localPosition.y, -8f);
		textKeep.color = new Color32(60, 60, 60, byte.MaxValue);
		uiGlow.enabled = false;
	}

	public void selectReleaseOrKeep(bool release)
	{
		uiKeep.raycastTarget = false;
		uiRelease.raycastTarget = false;
		StartCoroutine(doKeepOrRelease(release));
	}

	private IEnumerator doKeepOrRelease(bool release)
	{
		fishingControl.ChooseKeepRelease();
		if (release)
		{
			if (dataManager.userData.userLv < dataManager.maxLevel)
			{
				if (!main.useTutorial)
				{
					expUp(exp);
				}
				lvSlider.value = dataManager.userExpBar;
				userLv.text = dataManager.userData.userLv.ToString();
			}
			else
			{
				lvSlider.gameObject.SetActive(value: false);
				textMaxLv.SetActive(value: true);
				lvSlider.value = 0f;
			}
			lvSlider.GetComponent<AudioSource>().Play();
			Singleton<AchievementController>.Instance.checkUpgrade(6);
			MultiplayEventManager.Instance.SendFishState(FishState.Release);
		}
		else
		{
			if (dataManager.userData.userGold < goldMaximum)
			{
				if (!main.useTutorial)
				{
					Singleton<AchievementController>.Instance.goldCheck(gold);
				}
				userGold.text = dataManager.userData.userGold.ToString();
			}
			userGold.GetComponent<AudioSource>().Play();
			MultiplayEventManager.Instance.SendFishState(FishState.Keep);
		}
		fishingControl.ReleaseFish(release);
		dataManager.SaveUserData();
		lureControl.lureReset();
		tackleControl.ShowHideLure(show: true);
		fishingControl.releaseCatch();
		handControl.setJumpCatchHand(On: false);
		handControl.onOffOtherHand(On: true);
		scoreHide();
		fishingControl.reset();
		MultiplayEventManager.Instance.SendFishState(FishState.None);
		yield return null;
	}

	private void expUp(int exp)
	{
		dataManager.userData.userExp += exp;
		if (dataManager.userData.userExp > dataManager.levelUpDatabase.GetExp(dataManager.userData.userLv - 1))
		{
			dataManager.userData.userLv++;
			Singleton<AchievementController>.Instance.popLevelUp(dataManager.userData.userLv);
			Singleton<AchievementController>.Instance.checkUpgrade(0);
		}
		dataManager.SetExpBar();
	}
}
public class control_sound : MonoBehaviour
{
	public AudioSource BGM;

	public AudioSource MusicAudio;

	private AudioSource MusicAudioSource;

	private AudioSource[] AmbientAudios;

	public AudioClip soundCountSucceed;

	public AudioClip soundCatched;

	public AudioClip soundFailed;

	public AudioClip soundDrag;

	public AudioClip[] soundHookset;

	public AudioSource sEffectAudio;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
		AmbientAudios = main.envControl.sound_env;
		MusicAudioSource = Singleton<MediaController>.Instance.musicPlayerManager.audioSource;
		reset();
	}

	public int setMusicVolume(int volume)
	{
		dataManager.userData.volumeMusic = volume;
		BGM.volume = (float)dataManager.userData.volumeMusic * 0.1f;
		MusicAudioSource.volume = (float)dataManager.userData.volumeMusic * 0.1f;
		return dataManager.userData.volumeMusic;
	}

	public int musicVolumeUp()
	{
		if (dataManager.userData.volumeMusic < 10)
		{
			dataManager.userData.volumeMusic++;
			BGM.volume = (float)dataManager.userData.volumeMusic * 0.1f;
			MusicAudio.volume = (float)dataManager.userData.volumeMusic * 0.1f;
		}
		return dataManager.userData.volumeMusic;
	}

	public int musicVolumeDown()
	{
		if (dataManager.userData.volumeMusic > 0)
		{
			dataManager.userData.volumeMusic--;
			BGM.volume = (float)dataManager.userData.volumeMusic * 0.1f;
			MusicAudio.volume = (float)dataManager.userData.volumeMusic * 0.1f;
		}
		return dataManager.userData.volumeMusic;
	}

	public int setAmbientVolume(int volume)
	{
		dataManager.userData.volumeAmbient = volume;
		for (int i = 0; i < AmbientAudios.Length; i++)
		{
			AmbientAudios[i].volume = (float)dataManager.userData.volumeAmbient * 0.1f;
		}
		return dataManager.userData.volumeAmbient;
	}

	public int ambientVolumeUp()
	{
		if (dataManager.userData.volumeAmbient < 10)
		{
			dataManager.userData.volumeAmbient++;
			for (int i = 0; i < AmbientAudios.Length; i++)
			{
				AmbientAudios[i].volume = (float)dataManager.userData.volumeAmbient * 0.1f;
			}
		}
		return dataManager.userData.volumeAmbient;
	}

	public int ambientVolumeDown()
	{
		if (dataManager.userData.volumeAmbient > 0)
		{
			dataManager.userData.volumeAmbient--;
			for (int i = 0; i < AmbientAudios.Length; i++)
			{
				AmbientAudios[i].volume = (float)dataManager.userData.volumeAmbient * 0.1f;
			}
		}
		return dataManager.userData.volumeAmbient;
	}

	private void reset()
	{
		BGM.volume = (float)dataManager.userData.volumeMusic * 0.1f;
		MusicAudio.volume = (float)dataManager.userData.volumeMusic * 0.1f;
		for (int i = 0; i < AmbientAudios.Length; i++)
		{
			AmbientAudios[i].volume = (float)dataManager.userData.volumeAmbient * 0.1f;
		}
	}
}
public class Control_stuff : MonoBehaviour
{
	public bool autoCreatePrefabs;

	public float autoCreateTime = 10f;

	public GameObject[] stuffPrefabs;

	private control_envrionment envControl;

	public GameObject particle;

	public float posXarea;

	public float posYareaMin;

	public float posYareaMax;

	public float shoreAddDistance = 20f;

	public int stuffMaxCount = 10;

	public float stuffStayTime = 120f;

	public goodPointScript gpPrefab_Stuff;

	private int[] posIndex;

	public float baseScale = 3f;

	public float minScale = 1f;

	public float hitScale = 0.5f;

	public float gpScaleSpeed = 0.02f;

	public float lureCatchDis = 0.5f;

	[HideInInspector]
	public List<goodPointScript> listGpStuff = new List<goodPointScript>();

	[HideInInspector]
	public bool isGrabItem;

	private DataManager dataManager;

	private Main main;

	private int itemNumber;

	private LiquidSineAnim getLiquidSineAnim;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		envControl = main.envControl;
		getLiquidSineAnim = GetComponent<LiquidSineAnim>();
	}

	private void Start()
	{
		CreateStuffPoint(first: true);
		if (autoCreatePrefabs)
		{
			StartCoroutine(autoCreate());
		}
	}

	private IEnumerator autoCreate()
	{
		while (true)
		{
			yield return new WaitForSeconds(autoCreateTime);
			createStuff(base.transform.position);
		}
	}

	public void createStuff(Vector3 position)
	{
		UnityEngine.Object.Instantiate(particle, position, Quaternion.identity);
		GameObject obj = UnityEngine.Object.Instantiate(stuffPrefabs[itemNumber], position, Quaternion.identity);
		itemNumber++;
		if (itemNumber > stuffPrefabs.Length - 1)
		{
			itemNumber = 0;
		}
		if (obj.tag == "PhysicsOBJs")
		{
			getLiquidSineAnim.RefreshPhysicsOBJs = true;
		}
	}

	public void CreateStuffPoint(bool first)
	{
		if (main.enableFishing)
		{
			for (int i = 0; i < stuffMaxCount; i++)
			{
				CreateStuffPrefabs(first);
			}
		}
	}

	public void deleteStuff(goodPointScript stuff)
	{
		listGpStuff.Remove(stuff);
		UnityEngine.Object.Destroy(stuff.gameObject);
	}

	public void resetStuffAll()
	{
		for (int i = 0; i < listGpStuff.Count; i++)
		{
			UnityEngine.Object.Destroy(listGpStuff[i].gameObject);
		}
		listGpStuff.Clear();
		CreateStuffPoint(first: true);
	}

	public void CreateStuffPrefabs(bool first)
	{
		goodPointScript goodPointScript2 = UnityEngine.Object.Instantiate(position: new Vector3(UnityEngine.Random.Range(0f - posXarea, posXarea), envControl.water_Height, UnityEngine.Random.Range(posYareaMin * 0.5f, posYareaMax + (float)dataManager.userData.userLv * 0.5f)), original: gpPrefab_Stuff, rotation: Quaternion.identity);
		goodPointScript2.isFish = false;
		goodPointScript2.GpGrade = 1;
		goodPointScript2.setAttractPoint();
		listGpStuff.Add(goodPointScript2);
	}

	public void fishShow()
	{
	}

	public void fishHide()
	{
	}

	public void fishReset()
	{
		if (listGpStuff == null)
		{
			return;
		}
		for (int i = 0; i < listGpStuff.Count; i++)
		{
			if (listGpStuff[i] != null)
			{
				listGpStuff[i].fishReset();
			}
		}
	}

	public bool checkAttracted()
	{
		bool result = false;
		for (int i = 0; i < listGpStuff.Count; i++)
		{
			if (listGpStuff[i].bAttracting)
			{
				result = true;
			}
		}
		return result;
	}
}
public class control_tackle : MonoBehaviour
{
	public enum eReelState
	{
		stop,
		slow,
		normal,
		fast,
		drag
	}

	[HideInInspector]
	public eReelState curReelState;

	private eReelState oldReelState;

	public GameObject[] item_rodS_prefab;

	public GameObject[] item_rodC_prefab;

	public GameObject[] item_reelS_prefab;

	public GameObject[] item_reelC_prefab;

	public GameObject[] item_lure_prefab;

	public Material gloveMaterial;

	public Transform rodIdlePivot;

	private control_item_rod item_rod_con;

	private control_item_reel item_reel_con;

	private control_item_lure[] item_lure_con;

	private control_Fishing fishingControl;

	private control_fish fishControl;

	private control_Lure lureControl;

	private control_bait baitControl;

	private control_handselect handControl;

	private control_gpoint gpControl;

	private GameObject rodObj;

	private GameObject reelObj;

	public Transform ropeTransform;

	private Animation rodAni;

	public GameObject lureObj;

	public AudioClip[] reelClips;

	public AudioClip a_bendRod;

	public AudioClip a_hookRod;

	public AudioClip a_castingRod;

	public LineRenderer rodLine;

	public AudioSource SoundReel;

	public AudioSource SoundRod;

	[HideInInspector]
	public float bendAniValue;

	[HideInInspector]
	public float bendAniFishingValue;

	[HideInInspector]
	public float bendAniBite;

	private float power = 1f;

	private float newpower = 1f;

	private float boneAngle;

	public Transform lookatT;

	private Transform target;

	private float angleY;

	private float angleZ;

	public float maxAngleY = 90f;

	public float maxAngleZ = 90f;

	public float swingBendPow = 0.1f;

	[HideInInspector]
	public bool isBailOpen;

	public Transform lineFinger;

	public Transform tacklePivot;

	[HideInInspector]
	public int curReelType;

	private DataManager dataManager;

	private Main main;

	[HideInInspector]
	public float multiRodBending;

	[HideInInspector]
	public float multiReelAngle;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		fishingControl = main.fishingControl;
		baitControl = main.baitControl;
		handControl = main.handControl;
		gpControl = main.gpointControl;
		rodAni = GetComponent<Animation>();
		fishControl = main.fishControl;
		lureControl = main.lureControl;
		item_lure_con = new control_item_lure[item_lure_prefab.Length];
		for (int i = 0; i < item_lure_prefab.Length; i++)
		{
			item_lure_con[i] = item_lure_prefab[i].GetComponent<control_item_lure>();
		}
	}

	private void Start()
	{
		if (main.enableFishing)
		{
			initTackles();
		}
		else
		{
			UnityEngine.Object.Destroy(ropeTransform.gameObject);
		}
	}

	public void initTackles()
	{
		changeRodObj();
		changeReelObj();
		handleSelect();
		handControl.checkController(reset: true);
		ShowHideLure(show: true);
		boneAngle = 1f / (float)item_rod_con.rodBonesPos.Length;
		target = lureControl.transform;
	}

	public void handleSelect()
	{
		if (dataManager.userData.bothHand)
		{
			item_reel_con.reelAni.SetBool("hand", value: true);
		}
		else
		{
			item_reel_con.reelAni.SetBool("hand", value: false);
		}
		item_reel_con.ShowReelHanded(dataManager.userData.rightHand);
	}

	private void LateUpdate()
	{
		if (main.enableFishing)
		{
			lookatT.transform.LookAt(target);
			if (handControl.handReady)
			{
				rodBending();
				if (!control_Fishing.bPause)
				{
					switch (fishingControl.gameState)
					{
					case control_Fishing.EfishingState.ready:
						rodLineRender(rewind: true);
						reelWind(0);
						break;
					case control_Fishing.EfishingState.casting:
						if (!SoundRod.isPlaying)
						{
							SoundRod.clip = a_castingRod;
							SoundRod.Play();
						}
						rodLineRender(rewind: false);
						reelWind(4);
						break;
					case control_Fishing.EfishingState.retrieve:
						if (!rodAni.isPlaying)
						{
							rodAni.Play();
						}
						if (SoundRod.isPlaying)
						{
							SoundRod.Stop();
						}
						rodLineRender(rewind: true);
						break;
					case control_Fishing.EfishingState.fighting:
						if (!rodAni.isPlaying)
						{
							rodAni.Play();
						}
						if (fishingControl.lineTension > 40f)
						{
							if (!SoundRod.isPlaying)
							{
								SoundRod.clip = a_bendRod;
								SoundRod.Play();
							}
						}
						else if (SoundRod.isPlaying && SoundRod.clip == a_bendRod)
						{
							SoundRod.Stop();
						}
						if (lureControl.eFishing == control_Lure.eFishMovement.angry)
						{
							rodLineRender(rewind: false);
						}
						else
						{
							rodLineRender(rewind: true);
						}
						break;
					case control_Fishing.EfishingState.landing:
						rodAni.Stop();
						reelWind(0);
						if (SoundRod.isPlaying && SoundRod.clip == a_bendRod)
						{
							SoundRod.Stop();
						}
						rodLineRender(rewind: true);
						break;
					case control_Fishing.EfishingState.catching:
						reelWind(0);
						SoundRod.Stop();
						rodLineRender(rewind: true);
						break;
					}
				}
			}
		}
		if (item_reel_con != null)
		{
			multiReelAngle = item_reel_con.reelAni.GetFloat("frame");
		}
	}

	public void rodSoundStop()
	{
		if (rodAni.isPlaying)
		{
			rodAni.Stop();
		}
		SoundRod.Stop();
	}

	public void hitWater()
	{
		SoundRod.Stop();
		reelWind(0);
	}

	public void hitGround()
	{
		SoundRod.Stop();
		reelWind(0);
	}

	public void reset()
	{
		reelWind(0);
		isBailOpen = false;
		rodAni.Stop();
	}

	public void reelSoundBothHand(bool reeling, bool drag)
	{
		if (drag)
		{
			if (SoundReel.loop)
			{
				SoundReel.loop = false;
				SoundReel.clip = reelClips[3];
				SoundReel.Play();
			}
			return;
		}
		SoundReel.clip = reelClips[0];
		SoundReel.loop = true;
		if (reeling)
		{
			if (!SoundReel.isPlaying)
			{
				SoundReel.Play();
			}
		}
		else
		{
			SoundReel.Stop();
		}
	}

	public void reelWindRatio(float ratio)
	{
		if (curReelState == eReelState.drag)
		{
			if (item_reel_con.item_reel.itemType == ItemType.ReelC)
			{
				item_reel_con.reelAni.SetBool("drag", value: true);
			}
			else
			{
				item_reel_con.reelAni.SetFloat("frame", ratio);
			}
		}
		else
		{
			item_reel_con.reelAni.SetBool("drag", value: false);
			item_reel_con.reelAni.SetFloat("frame", ratio);
		}
	}

	public void reelWind(int reelState)
	{
		curReelState = (eReelState)reelState;
		if (curReelState != oldReelState)
		{
			switch (reelState)
			{
			case 0:
				item_reel_con.reelAni.SetBool("drag", value: false);
				item_reel_con.reelAni.SetFloat("speed", 0f);
				SoundReel.Stop();
				break;
			case 1:
				item_reel_con.reelAni.SetBool("drag", value: false);
				item_reel_con.reelAni.SetFloat("speed", 1f);
				SoundReel.clip = reelClips[0];
				SoundReel.Play();
				break;
			case 2:
				item_reel_con.reelAni.SetBool("drag", value: false);
				item_reel_con.reelAni.SetFloat("speed", 2f);
				SoundReel.clip = reelClips[1];
				SoundReel.Play();
				break;
			case 3:
				item_reel_con.reelAni.SetBool("drag", value: false);
				item_reel_con.reelAni.SetFloat("speed", 3f);
				SoundReel.clip = reelClips[2];
				SoundReel.Play();
				break;
			case 4:
				if (item_reel_con.item_reel.itemType == ItemType.ReelS)
				{
					item_reel_con.reelAni.SetFloat("speed", 0f);
				}
				else
				{
					item_reel_con.reelAni.SetBool("drag", value: true);
					item_reel_con.reelAni.SetFloat("speed", 2f);
				}
				if (fishingControl.gameState == control_Fishing.EfishingState.fighting)
				{
					SoundReel.clip = reelClips[3];
					SoundReel.Play();
				}
				break;
			}
		}
		oldReelState = curReelState;
	}

	public void rodLineRender(bool rewind)
	{
		if (isBailOpen)
		{
			for (int i = 0; i < 2; i++)
			{
				if (item_reel_con.item_reel.itemType == ItemType.ReelS)
				{
					if (i == 1)
					{
						rodLine.SetPosition(i, lineFinger.position);
					}
					else
					{
						rodLine.SetPosition(i, item_reel_con.reellineWindPos[i].position);
					}
				}
				else
				{
					rodLine.SetPosition(i, item_reel_con.reellineWindPos[i].position);
				}
			}
			for (int j = 0; j < item_rod_con.rodlinePos.Length; j++)
			{
				rodLine.SetPosition(j + 2, item_rod_con.rodlinePos[j].position);
			}
		}
		else if (rewind)
		{
			for (int k = 0; k < 2; k++)
			{
				rodLine.SetPosition(k, item_reel_con.reellineWindPos[k].position);
			}
			for (int l = 0; l < item_rod_con.rodlinePos.Length; l++)
			{
				rodLine.SetPosition(l + 2, item_rod_con.rodlinePos[l].position);
			}
		}
		else
		{
			item_reel_con.reellineReleasePos[0].localRotation = Quaternion.Euler(0f, 0f, Time.time * 10000f);
			for (int m = 0; m < 2; m++)
			{
				rodLine.SetPosition(m, item_reel_con.reellineReleasePos[m].position);
			}
			for (int n = 0; n < item_rod_con.rodlinePos.Length; n++)
			{
				rodLine.SetPosition(n + 2, item_rod_con.rodlinePos[n].position);
			}
		}
	}

	private void rodBending()
	{
		Vector3 forward = base.transform.forward;
		Vector3 b = Vector3.Normalize(lureControl.transform.position - fishingControl.rodDirectionPos.position);
		int num = item_rod_con.rodBonesPos.Length;
		switch (fishingControl.gameState)
		{
		case control_Fishing.EfishingState.retrieve:
		{
			if (fishingControl.bEnableHook)
			{
				power = 0.6f + bendAniFishingValue * 0.1f;
			}
			else if (fishingControl.isAttactedFish)
			{
				power = Mathf.Lerp(power, 0.3f, Time.deltaTime * 5f) + bendAniBite;
			}
			else
			{
				power = Mathf.Lerp(power, 0.3f, Time.deltaTime * 5f);
			}
			for (int j = 0; j < num; j++)
			{
				Quaternion quaternion2 = Quaternion.LookRotation(Vector3.Lerp(forward, b, 1f / (float)num * (float)j * power), base.transform.up);
				item_rod_con.rodBonesPos[j].rotation = quaternion2 * Quaternion.Euler(180f, 90f, 0f);
			}
			multiRodBending = power;
			return;
		}
		case control_Fishing.EfishingState.fighting:
		{
			float num2 = 0.3f + fishingControl.tensionDifficult * 0.075f;
			if (fishingControl.lineTension > 47f - fishingControl.tensionStress)
			{
				newpower = num2 + bendAniValue;
			}
			else if (fishingControl.lineTension < fishingControl.tensionSlack + 3f)
			{
				newpower = num2 * 0.3f;
			}
			else
			{
				switch (lureControl.eFishing)
				{
				case control_Lure.eFishMovement.stay:
					newpower = num2 + bendAniFishingValue * fishControl.fishPower * 0.1f;
					break;
				case control_Lure.eFishMovement.up:
					newpower = num2 + bendAniFishingValue * fishControl.fishPower * 0.15f;
					break;
				case control_Lure.eFishMovement.right:
					newpower = num2 + bendAniFishingValue * fishControl.fishPower * 0.15f;
					break;
				case control_Lure.eFishMovement.left:
					newpower = num2 + bendAniFishingValue * fishControl.fishPower * 0.15f;
					break;
				case control_Lure.eFishMovement.angry:
					newpower = num2 + bendAniFishingValue * fishControl.fishPower * 0.2f;
					break;
				case control_Lure.eFishMovement.groggy:
					newpower = num2;
					break;
				case control_Lure.eFishMovement.jumpL:
					newpower = num2;
					break;
				case control_Lure.eFishMovement.jumpR:
					newpower = num2;
					break;
				case control_Lure.eFishMovement.landing:
					newpower = num2;
					break;
				}
			}
			power = Mathf.Lerp(power, newpower, Time.deltaTime * 5f);
			for (int i = 0; i < num; i++)
			{
				Quaternion quaternion = Quaternion.LookRotation(Vector3.Lerp(forward, b, 1f / (float)num * (float)i * power), base.transform.up);
				item_rod_con.rodBonesPos[i].rotation = quaternion * Quaternion.Euler(180f, 90f, 0f);
			}
			multiRodBending = power;
			return;
		}
		case control_Fishing.EfishingState.landing:
		{
			power = Mathf.Lerp(power, 0.3f + fishingControl.tensionDifficult * 0.05f, Time.deltaTime * 5f);
			for (int k = 0; k < num; k++)
			{
				Quaternion quaternion3 = Quaternion.LookRotation(Vector3.Lerp(forward, b, 1f / (float)num * (float)k * power), base.transform.up);
				item_rod_con.rodBonesPos[k].rotation = quaternion3 * Quaternion.Euler(180f, 90f, 0f);
			}
			multiRodBending = power;
			return;
		}
		}
		power = 0.5f;
		bendAniBite = 0f;
		angleZ = (0f - fishingControl.conVelocity.y) * swingBendPow;
		if (Mathf.Abs(angleZ) > maxAngleZ)
		{
			if (angleZ < 0f)
			{
				angleZ = 0f - maxAngleZ;
			}
			else
			{
				angleZ = maxAngleZ;
			}
		}
		angleY = fishingControl.conVelocity.x * swingBendPow;
		if (Mathf.Abs(angleY) > maxAngleY)
		{
			if (angleY < 0f)
			{
				angleY = 0f - maxAngleY;
			}
			else
			{
				angleY = maxAngleY;
			}
		}
		for (int l = 1; l < item_rod_con.rodBonesPos.Length; l++)
		{
			item_rod_con.rodBonesPos[l].localEulerAngles = new Vector3(0f, angleY * boneAngle * power, angleZ * boneAngle * power);
		}
		multiRodBending = 0f;
	}

	public int getIndexCurTackle(SELECTEDTACKLE type)
	{
		switch (type)
		{
		case SELECTEDTACKLE.ROD:
			if (dataManager.userData.curType == 0)
			{
				dataManager.userData.rodS.IndexOf(dataManager.userData.curRodS);
			}
			else
			{
				dataManager.userData.rodC.IndexOf(dataManager.userData.curRodC);
			}
			break;
		case SELECTEDTACKLE.REEL:
			if (dataManager.userData.curType == 0)
			{
				dataManager.userData.reelS.IndexOf(dataManager.userData.curReelS);
			}
			else
			{
				dataManager.userData.reelC.IndexOf(dataManager.userData.curReelC);
			}
			break;
		}
		return 0;
	}

	public void bailOpen()
	{
		item_reel_con.reelAni.speed = 1f;
		item_reel_con.reelAni.SetBool("open", value: true);
	}

	public void bailClose()
	{
		item_reel_con.reelAni.speed = 1f;
		item_reel_con.reelAni.SetBool("open", value: false);
	}

	public void ropePosReset(Transform parent)
	{
		ropeTransform.position = parent.position;
		ropeTransform.rotation = parent.rotation;
		ropeTransform.parent = parent;
	}

	public void changeRodObj()
	{
		if (!main.useTutorial)
		{
			if (rodObj != null)
			{
				UnityEngine.Object.Destroy(rodObj);
			}
			if (dataManager.userData.curType == 0)
			{
				rodObj = UnityEngine.Object.Instantiate(item_rodS_prefab[dataManager.userData.curRodS], tacklePivot.position, tacklePivot.rotation);
				item_rod_con = rodObj.GetComponent<control_item_rod>();
				rodObj.transform.parent = tacklePivot;
				rodObj.transform.localPosition = Vector3.zero;
				ropePosReset(item_rod_con.pinPosition);
			}
			else
			{
				rodObj = UnityEngine.Object.Instantiate(item_rodC_prefab[dataManager.userData.curRodC], tacklePivot.position, tacklePivot.rotation);
				item_rod_con = rodObj.GetComponent<control_item_rod>();
				rodObj.transform.parent = tacklePivot;
				rodObj.transform.localPosition = Vector3.zero;
				ropePosReset(item_rod_con.pinPosition);
			}
		}
		else
		{
			if (rodObj != null)
			{
				UnityEngine.Object.Destroy(rodObj);
			}
			rodObj = UnityEngine.Object.Instantiate(item_rodS_prefab[0], tacklePivot.position, tacklePivot.rotation);
			item_rod_con = rodObj.GetComponent<control_item_rod>();
			rodObj.transform.parent = tacklePivot;
			rodObj.transform.localPosition = Vector3.zero;
			ropePosReset(item_rod_con.pinPosition);
		}
	}

	public void changeReelObj()
	{
		if (!main.useTutorial)
		{
			if (reelObj != null)
			{
				UnityEngine.Object.Destroy(reelObj);
			}
			if (dataManager.userData.curType == 0)
			{
				reelObj = UnityEngine.Object.Instantiate(item_reelS_prefab[dataManager.userData.curReelS], tacklePivot.position, tacklePivot.rotation);
				item_reel_con = reelObj.GetComponent<control_item_reel>();
				reelObj.transform.parent = tacklePivot;
				reelObj.transform.localPosition = Vector3.zero;
			}
			else
			{
				reelObj = UnityEngine.Object.Instantiate(item_reelC_prefab[dataManager.userData.curReelC], tacklePivot.position, tacklePivot.rotation);
				item_reel_con = reelObj.GetComponent<control_item_reel>();
				reelObj.transform.parent = tacklePivot;
				reelObj.transform.localPosition = Vector3.zero;
			}
		}
		else
		{
			if (reelObj != null)
			{
				UnityEngine.Object.Destroy(reelObj);
			}
			reelObj = UnityEngine.Object.Instantiate(item_reelS_prefab[0], tacklePivot.position, tacklePivot.rotation);
			item_reel_con = reelObj.GetComponent<control_item_reel>();
			reelObj.transform.parent = tacklePivot;
			reelObj.transform.localPosition = Vector3.zero;
		}
	}

	public void ShowHideLure(bool show)
	{
		if (show)
		{
			for (int i = 0; i < item_lure_con.Length; i++)
			{
				if (!main.useTutorial)
				{
					if (i == dataManager.userData.curLure)
					{
						item_lure_con[i].lureShow();
					}
					else
					{
						item_lure_con[i].lureHide();
					}
				}
				else if (i == main.tutoControl.curTutoLure)
				{
					item_lure_con[i].lureShow();
				}
				else
				{
					item_lure_con[i].lureHide();
				}
			}
			gpControl.changeLure();
		}
		else
		{
			for (int j = 0; j < item_lure_con.Length; j++)
			{
				item_lure_con[j].lureHide();
			}
		}
	}

	public RodItem getCurRodInfo()
	{
		return item_rod_con.getRodInfo();
	}

	public float getRodPower()
	{
		return item_rod_con.getRodPower();
	}

	public float getRodAction()
	{
		return item_rod_con.getRodAction();
	}

	public float getRodDistance()
	{
		return item_rod_con.getRodDistance();
	}

	public ItemType getReelType()
	{
		return item_reel_con.item_reel.itemType;
	}

	public control_item_reel getReelControl()
	{
		return item_reel_con;
	}

	public ReelItem getCurReelInfo()
	{
		return item_reel_con.getReelInfo();
	}

	public float getReelSpeed()
	{
		return item_reel_con.getReelSpeed();
	}

	public float getReelPower()
	{
		return item_reel_con.getReelPower();
	}

	public float getReelLength()
	{
		return item_reel_con.getReelLength();
	}

	public LureItem getCurLureInfo()
	{
		if (!main.useTutorial)
		{
			return item_lure_con[dataManager.userData.curLure].getLureInfo();
		}
		return item_lure_con[main.tutoControl.curTutoLure].getLureInfo();
	}

	public float getLureBiteSpeed(int fishID)
	{
		return item_lure_con[dataManager.userData.curLure].getLureBiteSpeed(fishID);
	}

	public int getLureAttraction(int fishID)
	{
		if (!main.useTutorial)
		{
			return item_lure_con[dataManager.userData.curLure].getLureFishAttraction(fishID);
		}
		return item_lure_con[main.tutoControl.curTutoLure].getLureFishAttraction(fishID);
	}

	public float getLureRange()
	{
		return item_lure_con[dataManager.userData.curLure].getLureRange();
	}

	public float getLureStuck()
	{
		return item_lure_con[dataManager.userData.curLure].getLureStuck();
	}

	public float getLureHeight()
	{
		return item_lure_con[dataManager.userData.curLure].getLureType();
	}

	public void rotateReel(float rotateSpeed)
	{
		item_reel_con.reelAni.SetBool("drag", value: false);
		item_reel_con.reelAni.SetFloat("speed", rotateSpeed);
	}

	public void ChangeLure(int order)
	{
		if (!main.useTutorial)
		{
			int num = dataManager.userData.lure.IndexOf(dataManager.userData.curLure);
			switch (order)
			{
			case -1:
			{
				int index2 = num - 1;
				if (num > 0)
				{
					int curLure3 = dataManager.userData.lure[index2];
					dataManager.userData.curLure = curLure3;
				}
				else
				{
					int curLure4 = dataManager.userData.lure.Last();
					dataManager.userData.curLure = curLure4;
				}
				break;
			}
			case 1:
			{
				int index = num + 1;
				if (num < dataManager.userData.lure.Count - 1)
				{
					int curLure = dataManager.userData.lure[index];
					dataManager.userData.curLure = curLure;
				}
				else
				{
					int curLure2 = dataManager.userData.lure[0];
					dataManager.userData.curLure = curLure2;
				}
				break;
			}
			}
			return;
		}
		int num2 = main.tutoControl.tutoLures.IndexOf(main.tutoControl.curTutoLure);
		switch (order)
		{
		case -1:
		{
			int index4 = num2 - 1;
			if (num2 > 0)
			{
				int curTutoLure3 = main.tutoControl.tutoLures[index4];
				main.tutoControl.curTutoLure = curTutoLure3;
			}
			else
			{
				int curTutoLure4 = main.tutoControl.tutoLures.Last();
				main.tutoControl.curTutoLure = curTutoLure4;
			}
			break;
		}
		case 1:
		{
			int index3 = num2 + 1;
			if (num2 < main.tutoControl.tutoLures.Count - 1)
			{
				int curTutoLure = main.tutoControl.tutoLures[index3];
				main.tutoControl.curTutoLure = curTutoLure;
			}
			else
			{
				int curTutoLure2 = main.tutoControl.tutoLures[0];
				main.tutoControl.curTutoLure = curTutoLure2;
			}
			break;
		}
		}
	}

	public void changeTackle()
	{
		if (main.enableFishing)
		{
			changeRodObj();
			changeReelObj();
			handleSelect();
			ShowHideLure(show: true);
			boneAngle = 1f / (float)item_rod_con.rodBonesPos.Length;
			target = lureControl.transform;
			fishingControl.initiate();
		}
	}

	public int getCurRod()
	{
		if (dataManager.userData.curType == 0)
		{
			return dataManager.userData.curRodS;
		}
		return dataManager.userData.curRodC;
	}

	public void setCurRod(int id)
	{
		if (id < 0)
		{
			if (dataManager.userData.curType == 0)
			{
				dataManager.userData.curRodS = dataManager.userData.rodS[dataManager.userData.rodS.Count - 1];
			}
			else
			{
				dataManager.userData.curRodC = dataManager.userData.rodC[dataManager.userData.rodC.Count - 1];
			}
		}
		else if (dataManager.userData.curType == 0)
		{
			dataManager.userData.curRodS = id;
		}
		else
		{
			dataManager.userData.curRodC = id;
		}
	}

	public int getCurReel()
	{
		if (dataManager.userData.curType == 0)
		{
			return dataManager.userData.curReelS;
		}
		return dataManager.userData.curReelC;
	}

	public void setCurReel(int id)
	{
		if (id < 0)
		{
			if (dataManager.userData.curType == 0)
			{
				dataManager.userData.curReelS = dataManager.userData.reelS[dataManager.userData.reelS.Count - 1];
			}
			else
			{
				dataManager.userData.curReelC = dataManager.userData.reelC[dataManager.userData.reelC.Count - 1];
			}
		}
		else if (dataManager.userData.curType == 0)
		{
			dataManager.userData.curReelS = id;
		}
		else
		{
			dataManager.userData.curReelC = id;
		}
	}

	public List<int> getRodList(int id)
	{
		if (dataManager.userData.curType == 0)
		{
			return dataManager.userData.rodS;
		}
		return dataManager.userData.rodC;
	}

	public int getReelList(int id)
	{
		if (dataManager.userData.curType == 0)
		{
			return dataManager.userData.reelS[id];
		}
		return dataManager.userData.reelC[id];
	}
}
public class control_tutorial : MonoBehaviour
{
	public enum tutorialState
	{
		ready,
		Indicator,
		changeLure,
		casting,
		reeling,
		hookSet,
		linetension,
		fighting,
		jump,
		groggy,
		landing,
		keepRelease,
		menu,
		difficulty,
		media,
		end
	}

	public int fishCount = 1;

	public StageItem.cStageFishType tutoFishItem;

	public float tutoFishDistance = 25f;

	public float tutoTensionForNext = 5f;

	public float tutoFishLureAttract = 2f;

	[HideInInspector]
	public float tensionValue;

	public tutorialState tutoState;

	public bool tutoPause;

	public Text tutoTitle;

	public Text tutoText;

	public Text tutoTryText;

	public GameObject tutoPanel;

	public bool indicator = true;

	public bool changelure = true;

	public bool casting = true;

	public bool reeling = true;

	public bool hookset = true;

	public bool fighting = true;

	public bool jump = true;

	public bool groggy = true;

	public bool landing = true;

	public bool keepRelease = true;

	public bool menu = true;

	public bool media = true;

	public bool end = true;

	[HideInInspector]
	public List<int> tutoLures = new List<int> { 1, 4 };

	[HideInInspector]
	public int curTutoLure;

	private AudioSource audioBeep;

	private DataManager dataManager;

	private Main main;

	private Console console;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		console = Singleton<Console>.Instance;
		audioBeep = GetComponent<AudioSource>();
		if (main.useTutorial)
		{
			dataManager.userData.gameDifficulty = 0;
		}
	}

	private void Start()
	{
		tutoPanelDisplay(show: false);
		if (main.useTutorial)
		{
			indicator = false;
			changelure = false;
			casting = false;
			reeling = false;
			hookset = false;
			fighting = false;
			jump = false;
			groggy = false;
			landing = false;
			keepRelease = false;
			menu = false;
			media = false;
			end = false;
			Singleton<MediaController>.Instance.Close();
			fishingTutoStart(tutorialState.Indicator);
		}
		else
		{
			indicator = true;
			changelure = true;
			casting = true;
			reeling = true;
			hookset = true;
			fighting = true;
			jump = true;
			groggy = true;
			landing = true;
			keepRelease = true;
			menu = true;
			media = true;
			end = true;
		}
	}

	private void Update()
	{
		if (main.tutoControl.menu && !main.isMenuOn && main.fishingControl.gameState == control_Fishing.EfishingState.ready && main.tutoControl.tutoState == tutorialState.menu && VRInput.Button_T_Click(VRInput.eController.bothhand))
		{
			main.tutoControl.changeTutoState(tutorialState.difficulty);
		}
	}

	public bool CheckCurState(tutorialState state)
	{
		bool result = false;
		if (main.useTutorial)
		{
			result = true;
		}
		else if (tutoState == state)
		{
			result = true;
		}
		return result;
	}

	public void changeTutoState(tutorialState state)
	{
		if (main.useTutorial && tutoState != tutorialState.end && tutoState < state)
		{
			tutoState = state;
			tutoPanelDisplay(show: false);
			fishingTutoStart(tutoState);
		}
	}

	public void fishingTutoStart(tutorialState state)
	{
		StartCoroutine(iFishingTutoStart(state));
	}

	private IEnumerator iFishingTutoStart(tutorialState state)
	{
		yield return new WaitForSeconds(0.5f);
		switch (state)
		{
		case tutorialState.Indicator:
			yield return new WaitForSeconds(1f);
			audioBeep.Play();
			indicator = true;
			textDisplay(1);
			break;
		case tutorialState.changeLure:
			yield return new WaitForSeconds(0.5f);
			audioBeep.Play();
			changelure = true;
			textDisplay(2);
			break;
		case tutorialState.casting:
			yield return new WaitForSeconds(0.5f);
			audioBeep.Play();
			casting = true;
			textDisplay(3);
			break;
		case tutorialState.reeling:
			yield return new WaitForSeconds(0.5f);
			audioBeep.Play();
			reeling = true;
			textDisplay(4);
			break;
		case tutorialState.hookSet:
			yield return new WaitForSeconds(0.5f);
			audioBeep.Play();
			hookset = true;
			textDisplay(5);
			break;
		case tutorialState.linetension:
			yield return new WaitForSeconds(0.5f);
			audioBeep.Play();
			textDisplay(6);
			break;
		case tutorialState.fighting:
			yield return new WaitForSeconds(0.5f);
			audioBeep.Play();
			fighting = true;
			textDisplay(7);
			break;
		case tutorialState.jump:
			yield return new WaitForSeconds(0.5f);
			audioBeep.Play();
			jump = true;
			textDisplay(8);
			break;
		case tutorialState.groggy:
			yield return new WaitForSeconds(0.5f);
			audioBeep.Play();
			groggy = true;
			textDisplay(9);
			break;
		case tutorialState.landing:
			yield return new WaitForSeconds(0.5f);
			audioBeep.Play();
			landing = true;
			textDisplay(10);
			break;
		case tutorialState.keepRelease:
			yield return new WaitForSeconds(0.5f);
			audioBeep.Play();
			keepRelease = true;
			textDisplay(11);
			break;
		case tutorialState.menu:
			yield return new WaitForSeconds(0.5f);
			audioBeep.Play();
			menu = true;
			textDisplay(12);
			dataManager.userData.ignoreTutorial = true;
			dataManager.Save();
			break;
		case tutorialState.difficulty:
			yield return new WaitForSeconds(0.5f);
			audioBeep.Play();
			media = true;
			textDisplay(13);
			console.ImageMedia.color = console.colorCaution;
			break;
		case tutorialState.media:
			yield return new WaitForSeconds(0.5f);
			audioBeep.Play();
			textDisplay(14);
			console.ImageMedia.color = console.colorUnselected;
			Singleton<MediaController>.Instance.tutoCloseButton.color = console.colorCaution;
			break;
		case tutorialState.end:
			yield return new WaitForSeconds(0.5f);
			audioBeep.Play();
			end = true;
			textDisplay(15);
			console.ImageMap.color = console.colorCaution;
			Singleton<MediaController>.Instance.tutoCloseButton.color = console.colorUnselected;
			break;
		}
	}

	private void tutoPanelDisplay(bool show)
	{
		tutoPanel.transform.position = main.fishingControl.cam.transform.position;
		tutoTryText.enabled = false;
		tutoPanel.SetActive(show);
	}

	private void textDisplay(int number)
	{
		tutoPanelDisplay(show: true);
		tutoTitle.GetComponent<Localize>().SetKey("StageTutorialQuestTitle/00" + number.ToString("00"));
		if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
		{
			tutoText.GetComponent<Localize>().SetKey("StageTutorialQuest/00" + number.ToString("00"));
		}
		else if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			if (number == 2 || number == 4 || number == 12 || number == 15)
			{
				tutoText.GetComponent<Localize>().SetKey("StageTutorialGo/00" + number.ToString("00"));
			}
			else
			{
				tutoText.GetComponent<Localize>().SetKey("StageTutorialQuest/00" + number.ToString("00"));
			}
		}
		else if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
		{
			if (number == 14)
			{
				tutoText.GetComponent<Localize>().SetKey("StageTutorialRift/00" + number.ToString("00"));
			}
			else
			{
				tutoText.GetComponent<Localize>().SetKey("StageTutorialQuest/00" + number.ToString("00"));
			}
		}
		tutoTryText.enabled = true;
	}
}
public class control_typing : MonoBehaviour
{
	public control_Fishing controlFishing;

	public GameObject panel;

	public float letterPause = 0.2f;

	public AudioClip typeSound1;

	public AudioClip typeSound2;

	private AudioSource typeSound;

	public smoothRotateFromCam panelRotate;

	public GameObject nextControllerUI;

	private string message;

	public Text[] textComp;

	private bool skip;

	private void Start()
	{
		typeSound = GetComponent<AudioSource>();
		Text[] array = textComp;
		for (int i = 0; i < array.Length; i++)
		{
			array[i].enabled = false;
		}
		panel.SetActive(value: false);
		nextControllerUI.SetActive(value: false);
	}

	public void startTutorial()
	{
		panel.SetActive(value: true);
		StartCoroutine(iTypeText(0));
	}

	public void nextTutorial(int num)
	{
		StartCoroutine(iTypeText(num));
	}

	private IEnumerator iTypeText(int num)
	{
		nextControllerUI.SetActive(value: false);
		Text[] array = textComp;
		for (int i = 0; i < array.Length; i++)
		{
			array[i].enabled = false;
		}
		textComp[num].enabled = true;
		message = textComp[num].text;
		textComp[num].text = "";
		char[] array2 = message.ToCharArray();
		foreach (char c in array2)
		{
			textComp[num].text += c;
			if (UnityEngine.Random.Range(0, 2) == 0)
			{
				typeSound.clip = typeSound1;
			}
			else
			{
				typeSound.clip = typeSound2;
			}
			skip = !skip;
			if (skip)
			{
				typeSound.Play();
			}
			yield return new WaitForSeconds(letterPause);
		}
		nextControllerUI.SetActive(value: true);
	}
}
public class fishJump : MonoBehaviour
{
	private Animation aniJump;

	[HideInInspector]
	public float height;

	private ui_scale_distance getDistance;

	[HideInInspector]
	public bool isJumping;

	private void Start()
	{
		aniJump = GetComponent<Animation>();
		getDistance = GetComponent<ui_scale_distance>();
	}

	public void jumpShaking(float jumpHeight)
	{
		if (!isJumping)
		{
			StartCoroutine(cJumpShaking(jumpHeight));
		}
	}

	private IEnumerator cJumpShaking(float jumpHeight)
	{
		float getHeight = base.transform.position.y;
		aniJump.Play("fishShakingJump");
		isJumping = true;
		while (aniJump.isPlaying)
		{
			base.transform.position = new Vector3(base.transform.position.x, getHeight + height * jumpHeight, base.transform.position.z);
			yield return null;
		}
		isJumping = false;
	}
}
public class fishSideMove : MonoBehaviour
{
	private void Start()
	{
	}

	public void fishMoveSize(float size)
	{
		base.transform.localScale = Vector3.one * size;
	}

	public void sizeReset()
	{
		base.transform.localScale = Vector3.one;
	}
}
public class graphFishGradeRate : MonoBehaviour
{
	public AnimationCurve fishRateSmall;

	public AnimationCurve fishRateLarge;

	public AnimationCurve fishRateHuge;

	public Vector4 getFishGradeRate()
	{
		float time = Singleton<DataManager>.Instance.userData.userLv;
		float num = fishRateSmall.Evaluate(time);
		float num2 = fishRateLarge.Evaluate(time);
		float num3 = fishRateHuge.Evaluate(time);
		float y = 1f - (num + num2 + num3);
		return new Vector4(num, y, num2, num3);
	}
}
public class radarDirection : MonoBehaviour
{
	public Transform rodDirection;

	private Quaternion rodForward;

	private Image uiImage;

	private void Start()
	{
		uiImage = GetComponent<Image>();
	}

	private void Update()
	{
		_ = rodDirection.forward;
		float num = Vector3.Angle(Vector3.ProjectOnPlane(rodDirection.forward, Vector3.up), Vector3.forward);
		float num2 = Mathf.Abs(rodDirection.rotation.eulerAngles.x - 270f);
		if (num < 55f && num2 >= 30f)
		{
			uiImage.color = new Color(1f, 1f, 1f, 1f);
		}
		else if (num > 55f && num2 >= 30f)
		{
			float a = (60f - Mathf.Clamp(num, 55f, 60f)) * 0.2f;
			uiImage.color = new Color(1f, 1f, 1f, a);
		}
		else if (num2 < 30f && num < 60f)
		{
			float a2 = (Mathf.Clamp(num2, 20f, 30f) - 20f) * 0.05f;
			uiImage.color = new Color(1f, 1f, 1f, a2);
		}
		else
		{
			uiImage.color = new Color(1f, 1f, 1f, 0f);
		}
		base.transform.localEulerAngles = new Vector3(0f, 0f, 0f - rodDirection.rotation.eulerAngles.y);
	}
}
public class radarEffect : MonoBehaviour
{
	public float speed = 1f;

	private Vector3 oriScale;

	private float scale;

	private Image uiImage;

	private void Start()
	{
		oriScale = base.transform.localScale;
		uiImage = GetComponent<Image>();
		base.transform.localScale = Vector3.zero;
	}

	private void Update()
	{
		if (scale >= 1f)
		{
			scale = 0f;
		}
		else
		{
			scale += Time.deltaTime * speed;
		}
		uiImage.color = new Color(1f, 1f, 1f, 1f - scale);
		base.transform.localScale = oriScale * scale;
	}

	private IEnumerator scaleChange()
	{
		while (true)
		{
			if (scale >= 1f)
			{
				scale = 0f;
			}
			else
			{
				scale += Time.deltaTime * speed;
			}
			uiImage.color = new Color(1f, 1f, 1f, 1f - scale);
			base.transform.localScale = oriScale * scale;
			yield return null;
		}
	}
}
public class selectStageUI : MonoBehaviour
{
	public List<Image> lodgeButtons;

	public List<Image> stageButtons;

	public Image buttonGo;

	public control_Menu menuControl;

	public GameObject stageInfo;

	public Text stageName;

	public Image stageType;

	public Image stageTime;

	private string selectedStage = "";

	private bool stop;

	private Color unableColor;

	private Color unselectedColor;

	private Color selectedColor;

	public Sprite IconDay;

	public Sprite IconSunset;

	public Sprite IconNight;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		unableColor = menuControl.colorBack;
		unselectedColor = menuControl.colorUnselected;
		selectedColor = menuControl.colorSelected;
		stageInfo.SetActive(value: false);
	}

	public void SelectRoom(string sceneName)
	{
		stageInfo.SetActive(value: false);
		int iD = dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems.Where((RoomItem s) => s.roomScene == sceneName).First().ID;
		List<RoomItem> roomItems = dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems;
		RoomList roomList = dataManager.userData.rooms[dataManager.currentNation];
		List<StageItem> stageItems = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems;
		selectedStage = roomItems[iD].roomScene;
		for (int i = 0; i < lodgeButtons.Count; i++)
		{
			if (roomItems[i].unlocklv <= dataManager.userData.userLv || roomList.items[i].purchased)
			{
				if (i == iD)
				{
					lodgeButtons[i].GetComponent<Button>().interactable = true;
					lodgeButtons[i].color = selectedColor;
				}
				else
				{
					lodgeButtons[i].color = unselectedColor;
				}
			}
		}
		for (int j = 0; j < stageButtons.Count; j++)
		{
			if (j <= dataManager.userData.userLv - 1)
			{
				if (j > 16 && dataManager.userData.boats.Count == 0)
				{
					stageButtons[j].color = unableColor;
				}
				else if (j != stageItems[iD].level - 1)
				{
					stageButtons[j].color = unselectedColor;
				}
			}
			else
			{
				stageButtons[j].color = unableColor;
			}
		}
		buttonGo.color = selectedColor;
		buttonGo.GetComponent<Button>().interactable = true;
	}

	private int GetIDbySceneName(string sceneName)
	{
		return dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems.Where((StageItem s) => s.stageScene == sceneName).First().id;
	}

	private string GetSceneNameByIndex(int index)
	{
		return SceneManager.GetSceneAt(index).name;
	}

	public void SelectStage(string sceneName)
	{
		int iDbySceneName = GetIDbySceneName(sceneName);
		List<StageItem> stageItems = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems;
		List<RoomItem> roomItems = dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems;
		RoomList roomList = dataManager.userData.rooms[dataManager.currentNation];
		selectedStage = stageItems[iDbySceneName].stageScene;
		if (sceneName == "Stage15_hongchun")
		{
			if (checkHongchunTime() == 1)
			{
				iDbySceneName = GetIDbySceneName("Stage15_hongchun_sunset");
			}
			else if (checkHongchunTime() == 2)
			{
				iDbySceneName = GetIDbySceneName("Stage15_hongchun");
			}
		}
		stageInfo.SetActive(value: true);
		stageName.GetComponent<Localize>().SetKey(stageItems[iDbySceneName].nameKey);
		stageType.sprite = stageItems[iDbySceneName].stageTypeImage;
		stageTime.sprite = stageItems[iDbySceneName].stageTimeImage;
		for (int i = 0; i < stageButtons.Count; i++)
		{
			if (i <= dataManager.userData.userLv - 1)
			{
				if (i > 16 && dataManager.userData.boats.Count == 0)
				{
					stageButtons[i].color = unableColor;
				}
				else if (i == stageItems[iDbySceneName].level - 1)
				{
					stageButtons[i].color = selectedColor;
				}
				else
				{
					stageButtons[i].color = unselectedColor;
				}
			}
			else
			{
				stageButtons[i].color = unableColor;
			}
		}
		for (int j = 0; j < lodgeButtons.Count; j++)
		{
			if ((roomItems[j].unlocklv <= dataManager.userData.userLv || roomList.items[j].purchased) && j != iDbySceneName)
			{
				lodgeButtons[j].color = unselectedColor;
			}
		}
		buttonGo.color = selectedColor;
		buttonGo.GetComponent<Button>().interactable = true;
	}

	public void movetoStage()
	{
		dataManager.SaveUserData();
		staticLoading.Stage = selectedStage;
		if (PhotonNetwork.InRoom && PhotonNetwork.IsMasterClient)
		{
			MultiplayEventManager.Instance.GoFishingEvent();
		}
		SceneManager.LoadScene("Loading");
	}

	private IEnumerator cBackLobby()
	{
		float num = 0.2f;
		main.fadeCamera.fadeTime = num;
		main.fadeCamera.FadeOut();
		yield return new WaitForSeconds(num);
		staticLoading.Stage = selectedStage;
		SceneManager.LoadScene("Loading");
	}

	private void OnEnable()
	{
		InitButtons();
	}

	private void Start()
	{
	}

	public void InitButtons()
	{
		RoomList roomList = dataManager.userData.rooms[dataManager.currentNation];
		_ = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems;
		for (int i = 0; i < lodgeButtons.Count; i++)
		{
			if (roomList.items[i].purchased)
			{
				lodgeButtons[i].color = unselectedColor;
				lodgeButtons[i].GetComponent<Button>().interactable = true;
			}
			else
			{
				lodgeButtons[i].color = unableColor;
				lodgeButtons[i].GetComponent<Button>().interactable = false;
			}
		}
		for (int j = 0; j < stageButtons.Count; j++)
		{
			if (j < dataManager.userData.userLv - 1)
			{
				stageButtons[j].color = unselectedColor;
				stageButtons[j].GetComponent<Button>().interactable = true;
				continue;
			}
			if (j > dataManager.userData.userLv - 1)
			{
				stageButtons[j].color = unableColor;
				stageButtons[j].GetComponent<Button>().interactable = false;
				continue;
			}
			stageButtons[j].color = selectedColor;
			stageButtons[j].GetComponent<Button>().interactable = true;
			if (main.scene == SceneState.STAGE)
			{
				string stageScene = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems[main.envControl.stageID].stageScene;
				SelectStage(stageScene);
			}
			else
			{
				string stageScene = ((main.lobbyId != 0) ? "Lobby_KR_sea" : "Lobby");
				SelectRoom(stageScene);
			}
		}
		if (dataManager.userData.boats.Count == 0)
		{
			stageButtons[17].color = unableColor;
			stageButtons[17].GetComponent<Button>().interactable = false;
			stageButtons[18].color = unableColor;
			stageButtons[18].GetComponent<Button>().interactable = false;
			stageButtons[19].color = unableColor;
			stageButtons[19].GetComponent<Button>().interactable = false;
		}
		buttonGo.color = unselectedColor;
		buttonGo.GetComponent<Button>().interactable = false;
	}

	private int checkHongchunTime()
	{
		int result = 0;
		if (dataManager.userData.cabinTime == 0)
		{
			int hour = DateTime.Now.Hour;
			if (hour >= 17 && hour <= 19)
			{
				result = 1;
			}
			else if (hour > 19 || hour < 6)
			{
				result = 2;
			}
		}
		else if (dataManager.userData.cabinTime == 1)
		{
			result = 0;
		}
		else if (dataManager.userData.cabinTime == 2)
		{
			result = 1;
		}
		else if (dataManager.userData.cabinTime == 3)
		{
			result = 2;
		}
		return result;
	}
}
public class SettingController : MonoBehaviour
{
	public enum detectedControllerType
	{
		none,
		right,
		left,
		both
	}

	private string deviceName;

	[HideInInspector]
	public detectedControllerType detectedController;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
	}

	private void Start()
	{
		qualityChange();
		frameRateChange();
	}

	public void qualityChange()
	{
		switch (dataManager.userData.graphicQuality)
		{
		case 0:
			XRSettings.eyeTextureResolutionScale = 1f;
			OVRManager.fixedFoveatedRenderingLevel = OVRManager.FixedFoveatedRenderingLevel.High;
			QualitySettings.SetQualityLevel(dataManager.userData.graphicQuality, applyExpensiveChanges: true);
			break;
		case 1:
			XRSettings.eyeTextureResolutionScale = 1.1f;
			OVRManager.fixedFoveatedRenderingLevel = OVRManager.FixedFoveatedRenderingLevel.Medium;
			QualitySettings.SetQualityLevel(dataManager.userData.graphicQuality, applyExpensiveChanges: true);
			break;
		case 2:
			XRSettings.eyeTextureResolutionScale = 1.15f;
			OVRManager.fixedFoveatedRenderingLevel = OVRManager.FixedFoveatedRenderingLevel.Low;
			QualitySettings.SetQualityLevel(dataManager.userData.graphicQuality, applyExpensiveChanges: true);
			break;
		}
	}

	public void frameRateChange()
	{
		if (dataManager.userData.bFrameRateHigh)
		{
			OVRManager.display.displayFrequency = 72f;
		}
		else
		{
			OVRManager.display.displayFrequency = 60f;
		}
	}

	private void detectController()
	{
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.IsControllerConnected(OVRInput.Controller.RTrackedRemote))
			{
				detectedController = detectedControllerType.right;
			}
			else if (OVRInput.IsControllerConnected(OVRInput.Controller.LTrackedRemote))
			{
				detectedController = detectedControllerType.left;
			}
		}
	}

	private void OnApplicationFocus(bool focusStatus)
	{
		if (dataManager.targetPlatform == DEVICE_TYPE.GO && focusStatus)
		{
			StartCoroutine(checkController());
		}
	}

	private IEnumerator checkController()
	{
		bool flag;
		while (true)
		{
			switch (OVRPlugin.GetDominantHand())
			{
			case OVRPlugin.Handedness.RightHanded:
				flag = true;
				break;
			case OVRPlugin.Handedness.LeftHanded:
				flag = false;
				break;
			default:
				yield return new WaitForSeconds(0.3f);
				continue;
			}
			break;
		}
		if (dataManager.userData.rightHand != flag)
		{
			dataManager.userData.rightHand = flag;
			SceneManager.LoadScene(1);
		}
	}
}
public class StageEventManager : PunSingleton<StageEventManager>
{
	public List<StageEventBase> stageEvents;

	[Header("Bird Event")]
	public FlockController birdEvent;

	public int ratio = 50;

	public int minAmount;

	public int maxAmount = 3;

	public override void OnEnable()
	{
		base.OnEnable();
	}

	public override void OnDisable()
	{
		base.OnDisable();
	}

	private void Awake()
	{
		for (int i = 0; i < stageEvents.Count; i++)
		{
			stageEvents[i].id = i;
		}
	}

	private void Start()
	{
		if (birdEvent != null)
		{
			int num = UnityEngine.Random.Range(minAmount, maxAmount);
			if (num != 0)
			{
				birdEvent.gameObject.SetActive(value: true);
				birdEvent._childAmount = num + 1;
				birdEvent.UpdateChildAmount();
			}
		}
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && !PhotonNetwork.IsMasterClient)
		{
			return;
		}
		for (int i = 0; i < stageEvents.Count; i++)
		{
			if (stageEvents[i].envEvent && (float)UnityEngine.Random.Range(0, 100) < stageEvents[i].ratio)
			{
				stageEvents[i].Play(isReceive: false);
			}
		}
	}

	public void Play(StageEvent stageEvent)
	{
		for (int i = 0; i < stageEvents.Count; i++)
		{
			if (stageEvent == stageEvents[i].stageEvent)
			{
				stageEvents[i].Play(isReceive: true);
			}
		}
	}

	private void Update()
	{
	}

	public override void OnPlayerPropertiesUpdate(Player targetPlayer, ExitGames.Client.Photon.Hashtable changedProps)
	{
		if (!PhotonNetwork.IsMasterClient || targetPlayer == PhotonNetwork.LocalPlayer || changedProps["scene"] == null || !(changedProps["scene"].ToString() == "stage"))
		{
			return;
		}
		for (int i = 0; i < stageEvents.Count; i++)
		{
			if (PhotonNetwork.CurrentRoom.CustomProperties["event" + i] != null && (bool)PhotonNetwork.CurrentRoom.CustomProperties["event" + i])
			{
				StageEventCode stageEventCode = ConvertStageEventToCode(stageEvents[i].stageEvent);
				MonoBehaviour.print("중간에 들어온 사람한테 이벤트 보내기 : " + stageEventCode);
				MultiplayEventManager.Instance.SendStageEventMessage(targetPlayer.ActorNumber, stageEventCode);
			}
		}
	}

	public override void OnRoomPropertiesUpdate(ExitGames.Client.Photon.Hashtable propertiesThatChanged)
	{
		if (PhotonNetwork.IsMasterClient)
		{
			return;
		}
		for (int i = 0; i < stageEvents.Count; i++)
		{
			if (propertiesThatChanged.ContainsKey("event" + i) && !(bool)propertiesThatChanged["event" + i] && stageEvents[i] != null)
			{
				MonoBehaviour.print("Event Stop Updated");
				stageEvents[i].Stop(isReceive: true);
			}
		}
	}

	public override void OnMasterClientSwitched(Player newMasterClient)
	{
		for (int i = 0; i < stageEvents.Count; i++)
		{
			if (newMasterClient == PhotonNetwork.LocalPlayer)
			{
				if (stageEvents[i] != null)
				{
					stageEvents[i].Init();
					stageEvents[i].Stop(isReceive: false);
				}
			}
			else if (stageEvents[i] != null)
			{
				stageEvents[i].Stop(isReceive: true);
			}
		}
	}

	public StageEventCode ConvertStageEventToCode(StageEvent stageEvent)
	{
		return stageEvent switch
		{
			StageEvent.Rainbow => StageEventCode.Rainbow, 
			StageEvent.Rain => StageEventCode.Rain, 
			StageEvent.Firework => StageEventCode.Firework, 
			StageEvent.FireFly => StageEventCode.FireFly, 
			StageEvent.CherryBlossom => StageEventCode.CherryBlossom, 
			_ => (StageEventCode)0, 
		};
	}
}
public class StartTutorialController : MonoBehaviour
{
	public GameObject tutoPanel;

	public float tutoHideTime = 20f;

	private bool isOpen;

	public float goHeight = 150f;

	private bool bTutoStart;

	private Transform cameraTransform;

	public Transform tutoTransform;

	private AudioSource audioS;

	public GameObject tutoArea;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		tutoPanel.SetActive(value: false);
		tutoArea.SetActive(value: false);
		cameraTransform = main.cameraTransform;
		audioS = GetComponent<AudioSource>();
	}

	private void Start()
	{
		CheckTutorialStart();
	}

	private void CheckTutorialStart()
	{
		if (!dataManager.userData.ignoreTutorial)
		{
			audioS.Play();
			tutoArea.SetActive(value: true);
			StartCoroutine(iStartTutorial());
		}
	}

	public void closeTuto()
	{
		if (isOpen)
		{
			StartCoroutine(iCloseTutorial());
			tutoArea.SetActive(value: false);
		}
	}

	public void ignoreTutorial()
	{
		bTutoStart = true;
		if (isOpen)
		{
			StartCoroutine(iCloseTutorial());
		}
	}

	private IEnumerator iStartTutorial()
	{
		isOpen = true;
		float scale = 0f;
		tutoPanel.transform.localScale = Vector3.zero;
		tutoPanel.SetActive(value: true);
		yield return new WaitForSeconds(1f);
		while (scale < 1f)
		{
			tutoTransform.position = cameraTransform.position;
			scale += Time.deltaTime * 3f;
			tutoPanel.transform.localScale = new Vector3(scale, scale, scale);
			yield return null;
		}
		tutoPanel.transform.localScale = new Vector3(1f, 1f, 1f);
		while (true)
		{
			if (dataManager.targetPlatform == DEVICE_TYPE.GO)
			{
				tutoTransform.position = new Vector3(cameraTransform.position.x, goHeight, cameraTransform.position.z);
			}
			else
			{
				tutoTransform.position = cameraTransform.position;
			}
			yield return null;
		}
	}

	private IEnumerator iCloseTutorial()
	{
		isOpen = false;
		float scale = 1f;
		while (scale > 0f)
		{
			scale -= Time.deltaTime * 4f;
			tutoPanel.transform.localScale = new Vector3(scale, scale, scale);
			yield return null;
		}
		tutoPanel.SetActive(value: false);
	}

	public void tutorialStart()
	{
		main.lobbyUIManager.SelectMenu(7);
		closeTuto();
		if (bTutoStart)
		{
			dataManager.userData.ignoreTutorial = true;
			dataManager.Save();
		}
	}
}
public class fishSetScript : MonoBehaviour
{
	public FishItem fishInfo;

	private Animation fishAnimation;

	public Animation sharkAppearAni;

	public Animator FishAni;

	public Renderer fishRender;

	[HideInInspector]
	public float height;

	[HideInInspector]
	public float floatingHeight;

	[HideInInspector]
	public bool isCatched;

	public Transform fishPivot;

	public Transform linePivot;

	private LineRenderer line;

	private IEnumerator cLineRender;

	private bool bFloatingFish;

	private float catchedPushdistance = 1.5f;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
	}

	private void Start()
	{
		fishAnimation = GetComponent<Animation>();
		line = GetComponent<LineRenderer>();
		cLineRender = lineRender();
		materailChange();
		isCatched = false;
	}

	public void monsterRoaming(bool isTrue)
	{
		FishAni.SetBool("roaming", isTrue);
	}

	public void fishLandingWait()
	{
		FishAni.SetBool("struggle", value: true);
	}

	private string ClipIndexToName(int index)
	{
		AnimationClip clipByIndex = GetClipByIndex(index);
		if (clipByIndex == null)
		{
			return null;
		}
		return clipByIndex.name;
	}

	private AnimationClip GetClipByIndex(int index)
	{
		int num = 0;
		foreach (AnimationState item in fishAnimation)
		{
			if (num == index)
			{
				return item.clip;
			}
			num++;
		}
		return null;
	}

	public void fishCatched()
	{
		fishAnimation.Play("fishJumpCatched");
		StartCoroutine(aniSpeedCon());
	}

	public void sharkAppear()
	{
		sharkAppearAni.Play();
		sharkAppearAni.GetComponent<AudioSource>().Play();
	}

	private IEnumerator hugeFishLanding(GameObject landingObj)
	{
		while (true)
		{
			base.transform.rotation = Quaternion.Lerp(base.transform.rotation, landingObj.transform.rotation, Time.deltaTime * 5f);
		}
	}

	public void destroy()
	{
		if (base.gameObject != null)
		{
			UnityEngine.Object.Destroy(base.gameObject);
		}
	}

	public void delayDestroy(float time)
	{
		StartCoroutine(iDestroy(time));
	}

	private IEnumerator iDestroy(float time)
	{
		yield return new WaitForSeconds(time);
		if (base.gameObject != null)
		{
			UnityEngine.Object.Destroy(base.gameObject);
		}
	}

	public void fishReset()
	{
		if (base.gameObject != null)
		{
			UnityEngine.Object.Destroy(base.gameObject);
		}
	}

	public void fishJump(float speed)
	{
		FishAni.SetTrigger("jump");
	}

	public void fishFailed()
	{
		base.transform.parent = null;
		StartCoroutine(jumpFailed());
	}

	private IEnumerator delayReset(float time)
	{
		yield return new WaitForSeconds(time);
		fishReset();
	}

	private IEnumerator aniSpeedCon()
	{
		float aniTime = 1f;
		while (aniTime > 0.2f)
		{
			aniTime -= Time.deltaTime * 1.5f;
			FishAni.speed = aniTime;
			yield return null;
		}
		yield return new WaitForSeconds(0.3f);
		while (aniTime < 1f)
		{
			aniTime += Time.deltaTime * 2f;
			FishAni.speed = aniTime;
			yield return null;
		}
		FishAni.speed = 1f;
	}

	private IEnumerator iFishMove(float speed, float time)
	{
		float stime = 0f;
		while (stime < time)
		{
			stime += Time.deltaTime;
			base.transform.Translate(-base.transform.forward * speed * Time.deltaTime, Space.World);
			yield return null;
		}
	}

	public void LookNextPos(Vector3 next, bool lerp, float speed)
	{
		if (lerp)
		{
			Vector3 forward = Vector3.RotateTowards(base.transform.forward, next, Time.deltaTime * speed, 0f);
			base.transform.rotation = Quaternion.LookRotation(forward);
		}
		else
		{
			base.transform.rotation = Quaternion.LookRotation(next);
		}
	}

	private IEnumerator jumpFailed()
	{
		float getHeight = base.transform.position.y;
		fishAnimation.Play("fishJumpFailed");
		FishAni.SetTrigger("jump");
		while (fishAnimation.isPlaying)
		{
			base.transform.localPosition = new Vector3(base.transform.localPosition.x, getHeight + height * fishInfo.jumpHeight, base.transform.localPosition.z);
			yield return null;
		}
		UnityEngine.Object.Destroy(base.gameObject);
	}

	public void release(Transform releasePos)
	{
		fishAnimation.Stop();
		base.transform.parent = null;
		base.transform.position = releasePos.position;
		base.transform.rotation = releasePos.rotation;
		StartCoroutine(cRelease());
	}

	private IEnumerator cRelease()
	{
		lineShow(show: false);
		FishAni.speed = 2.5f;
		FishAni.SetBool("struggle", value: false);
		FishAni.Play("swim");
		float sTime = 0f;
		float rTime = 0f;
		float releaseSpeed = 1.5f;
		float rotation = 0f;
		float newRotation = UnityEngine.Random.Range(-30f, 30f);
		fishPivot.localEulerAngles = Vector3.zero;
		while (sTime < 5f)
		{
			sTime += Time.deltaTime;
			rTime += Time.deltaTime;
			if (rTime > 1f)
			{
				rTime = 0f;
				newRotation = UnityEngine.Random.Range(-40f, 40f);
			}
			base.transform.Translate(-base.transform.forward * Time.deltaTime * (releaseSpeed + sTime * 0.5f), Space.World);
			rotation = Mathf.Lerp(rotation, newRotation, Time.deltaTime);
			base.transform.rotation = Quaternion.Euler(base.transform.eulerAngles.x, rotation + 180f, base.transform.eulerAngles.z);
			yield return null;
		}
		UnityEngine.Object.Destroy(base.gameObject);
	}

	public void lineShow(bool show)
	{
		if (show)
		{
			line.enabled = true;
			fishPivot.localPosition = new Vector3(0f, 0f, 0.1f);
			StartCoroutine(cLineRender);
		}
		else
		{
			StopCoroutine(cLineRender);
			line.enabled = false;
			fishPivot.localPosition = new Vector3(0f, 0f, 0f);
		}
	}

	private IEnumerator lineRender()
	{
		while (true)
		{
			line.SetPosition(0, base.transform.position);
			line.SetPosition(1, fishPivot.position);
			yield return null;
		}
	}

	private void materailChange()
	{
		if (dataManager.targetPlatform == DEVICE_TYPE.RIFT && dataManager.userData.graphicQuality != 0)
		{
			fishRender.sharedMaterial.renderQueue = 1998;
		}
	}
}
public class followLurePos : MonoBehaviour
{
	public Transform lure;

	private void Start()
	{
	}

	private void LateUpdate()
	{
		base.transform.position = lure.position;
	}
}
public class followObject : MonoBehaviour
{
	public Transform followTransform;

	public float smoothTime = 0.3f;

	private Transform thisTransform;

	private float rotation;

	private void Start()
	{
		thisTransform = base.transform;
	}

	private void LateUpdate()
	{
		rotation = Mathf.LerpAngle(thisTransform.eulerAngles.y, followTransform.eulerAngles.y, Time.deltaTime * smoothTime);
		base.transform.eulerAngles = new Vector3(thisTransform.eulerAngles.x, rotation, thisTransform.eulerAngles.z);
	}
}
public class followUI : MonoBehaviour
{
	public GameObject fish;

	private void Start()
	{
	}

	private void LateUpdate()
	{
		base.transform.position = new Vector3(fish.transform.position.x, base.transform.position.y, base.transform.position.z);
	}
}
public enum RewardType
{
	GOLD,
	DECORATION,
	FISH,
	GLOVE
}
[CreateAssetMenu(menuName = "Items/Achieve Item")]
public class AchieveItem : ScriptableObject
{
	[SerializeField]
	public int Id;

	public string title;

	public string content;

	public RewardType reward;

	public int rewardGold;

	public string decroationName;

	public int decorationId;

	public int[] targetNumber;

	public string nameKey;

	public string descKey;

	public string creditsKey;

	public string decoNameKey;
}
public class AutoSaveManager : MonoBehaviour
{
	private bool autosaveCloud;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		autosaveCloud = dataManager.userData.autoSave;
	}

	private void Start()
	{
		if (!dataManager.isBeta && autosaveCloud)
		{
			Save();
		}
	}

	public void Save()
	{
		if (!(dataManager != null))
		{
			return;
		}
		OnlineCheck.Check(delegate(bool isConnected, NetworkReachability b)
		{
			if (isConnected)
			{
				Singleton<DBManager>.Instance.Upload(null);
			}
		});
	}
}
public class AutoSaveToggle : MonoBehaviour
{
	public Image toggle;

	public Sprite[] toggleImages;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		SetToggle(dataManager.userData.autoSave);
	}

	public void SetToggle(bool value)
	{
		if (value)
		{
			dataManager.userData.autoSave = true;
			toggle.sprite = toggleImages[1];
		}
		else
		{
			dataManager.userData.autoSave = false;
			toggle.sprite = toggleImages[0];
		}
	}

	public void ToggleEvent()
	{
		dataManager.userData.autoSave = !dataManager.userData.autoSave;
		SetToggle(dataManager.userData.autoSave);
		dataManager.Save();
	}
}
[Serializable]
public class Avatar
{
	public string name;

	[SerializeField]
	public FaceItem[] faceItems;

	[SerializeField]
	public HairItem[] hairItems;

	[SerializeField]
	public MustacheItem[] mustacheItems;

	[SerializeField]
	public EyebrowItem[] eyebrowItems;

	[SerializeField]
	public InnerfitItem[] innerfitItems;

	[SerializeField]
	public OutfitItem[] outfitItems;

	[SerializeField]
	public HatItem[] hatItems;

	[SerializeField]
	public GlassesItem[] glassesItems;

	[SerializeField]
	public WatchItem[] watchItems;
}
[CreateAssetMenu]
public class ColorSetDatabase : ScriptableObject
{
	[Header("AVATAR")]
	public List<Color> faceColorSet;

	public List<Color> hairColorSet;

	public List<Color> mustacheColorSet;

	public List<Color> eyebrowColorSet;

	public List<Color> eyeColorSet;

	public List<Color> innerFitColorSet;

	public List<Color> outerFitColorSet;
}
public class DataManager : Singleton<DataManager>
{
	public float userExpBar;

	public int maxLevel = 20;

	public bool isPlayingMusic;

	public float lobbyCamHeight;

	private string savePath = "/Saves";

	public string saveFilename = "userData.json";

	public UserData userData = new UserData();

	public ItemDatabase ItemDatabase;

	public LevelUpDatabase levelUpDatabase;

	public bool isFirst = true;

	public bool isSecure;

	public UnityEvent loadCompleted;

	public bool loaded;

	public GameObject updatePopup;

	public bool checkVersion = true;

	public DEVICE_TYPE targetPlatform = DEVICE_TYPE.QUEST;

	public int currentNation;

	public int currentLobby;

	public bool isBeta;

	private bool isLoading;

	private float startTime;

	public bool IsInternetConnected;

	private float t;

	public List<bool> lobbyOnces = new List<bool> { false, false };

	private bool firstRun;

	public bool isTestSesaonReward;

	public int testNewSeason = 4;

	public TextAsset test;

	private void Awake()
	{
		if (Singleton<DataManager>.Instance != null && Singleton<DataManager>.Instance != this)
		{
			UnityEngine.Object.Destroy(base.gameObject);
			return;
		}
		UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
		Singleton<OculusManager>.Instance.OnFailedInit.AddListener(OnFailedInit);
		Singleton<OculusManager>.Instance.OnCompletedLoggedIn.AddListener(OnCompletedLoggedIn);
		Singleton<OculusManager>.Instance.OnFailedLoggedIn.AddListener(OnFailedLoggedIn);
		if (!isBeta)
		{
			saveFilename = "userData.json";
		}
		else
		{
			saveFilename = "userData_beta_20200715.json";
		}
		try
		{
			if (!Directory.Exists(UnityEngine.Application.persistentDataPath + savePath))
			{
				Directory.CreateDirectory(UnityEngine.Application.persistentDataPath + savePath);
			}
		}
		catch (IOException ex)
		{
			MonoBehaviour.print("DataManager Awake: " + ex.Message);
		}
		if (!Singleton<VersionManager>.Instance.ExistsLocalFile())
		{
			firstRun = true;
			ApplySystemLanguage();
		}
	}

	private void Start()
	{
		StartCoroutine(Singleton<VersionManager>.Instance.DeleteAllBetaData());
		OnlineCheck.Check(delegate(bool isConnected, NetworkReachability b)
		{
			IsInternetConnected = isConnected;
		});
		UnityEngine.Debug.Log(Microphone.devices.Length);
		UnityEngine.Debug.Log(UnityEngine.Application.internetReachability);
	}

	private void ParseAddItems(string text)
	{
		JObject jObject = JObject.Parse(text);
		List<string> list = (from s in jObject.Properties()
			select s.Name).ToList();
		FieldInfo[] array = (from fi in typeof(UserData).GetFields()
			where fi.GetCustomAttributes(typeof(NonDBAttribute), inherit: false).Length == 0
			select fi).ToArray();
		foreach (string item2 in (IEnumerable<string>)list)
		{
			FieldInfo[] array2 = array;
			foreach (FieldInfo fieldInfo in array2)
			{
				if (!(item2 == fieldInfo.Name) || !(fieldInfo.GetValue(userData).GetType() == typeof(List<int>)))
				{
					continue;
				}
				int[] array3 = jObject[item2].Values<int>().ToArray();
				foreach (int item in array3)
				{
					if (!((List<int>)fieldInfo.GetValue(userData)).Contains(item))
					{
						((List<int>)fieldInfo.GetValue(userData)).Add(item);
						((List<int>)fieldInfo.GetValue(userData)).Sort();
					}
				}
			}
		}
		StartCoroutine(Singleton<DBManager>.Instance.SetAddItem(Singleton<OculusManager>.Instance.id, delegate
		{
		}));
	}

	private void ApplySystemLanguage()
	{
		if (UnityEngine.Application.platform == RuntimePlatform.Android)
		{
			switch (UnityEngine.Application.systemLanguage)
			{
			case SystemLanguage.English:
				LocalizationManager.CurrentLanguage = "English";
				break;
			case SystemLanguage.French:
				LocalizationManager.CurrentLanguage = "French";
				break;
			case SystemLanguage.Spanish:
				LocalizationManager.CurrentLanguage = "Spanish";
				break;
			case SystemLanguage.German:
				LocalizationManager.CurrentLanguage = "German";
				break;
			case SystemLanguage.Korean:
				LocalizationManager.CurrentLanguage = "Korean";
				break;
			case SystemLanguage.Japanese:
				LocalizationManager.CurrentLanguage = "Japanese";
				break;
			default:
				LocalizationManager.CurrentLanguage = "English";
				break;
			}
		}
		else
		{
			LocalizationManager.CurrentLanguage = "English";
		}
	}

	private new void OnApplicationQuit()
	{
		Save();
	}

	private IEnumerator Prepare()
	{
		t = Time.time;
		if (IsInternetConnected && !isBeta)
		{
			bool canUpdate = false;
			yield return StartCoroutine(Singleton<DBManager>.Instance.GetVersion(delegate(object response)
			{
				if (response != null)
				{
					Singleton<DBManager>.Instance.cloudVersion = response.ToString();
					if (checkVersion && float.Parse(Singleton<DBManager>.Instance.cloudVersion, CultureInfo.InvariantCulture) > float.Parse(UnityEngine.Application.version, CultureInfo.InvariantCulture))
					{
						if (updatePopup != null)
						{
							updatePopup.SetActive(value: true);
						}
						canUpdate = true;
					}
				}
			}));
			if (canUpdate)
			{
				yield break;
			}
		}
		if (!Singleton<VersionManager>.Instance.ExistsLocalFile())
		{
			MonoBehaviour.print("no local data file, therefore it's newly saved");
			SaveUserData();
		}
		else
		{
			yield return StartCoroutine(Load());
		}
		if (firstRun)
		{
			userData.language = (int)Enum.Parse(typeof(Languages), LocalizationManager.CurrentLanguage);
		}
		Singleton<OculusManager>.Instance.SetOculusUserInfo(userData);
		IncreaseConnectedCount();
		CreateDynamicData();
		if (userData.userLv == 15 && userData.userExp > 1940)
		{
			userData.userExp = 1940;
		}
		if (IsInternetConnected && !isBeta)
		{
			if (userData.id != 0L)
			{
				yield return StartCoroutine(Singleton<DBManager>.Instance.GetRollBack(userData.id, delegate(object s)
				{
					if (s != null)
					{
						Singleton<DBManager>.Instance.rollback = int.Parse(s.ToString());
					}
				}));
				if (Singleton<DBManager>.Instance.rollback == 1)
				{
					yield return StartCoroutine(Singleton<DBManager>.Instance.GetUserData(userData.id, delegate(object s)
					{
						if (s != null)
						{
							JArray jArray = s as JArray;
							if (jArray.Count > 0)
							{
								ParseFromJObject(JArray.Parse(jArray.ToString()).OfType<JObject>().First());
							}
							StartCoroutine(Singleton<DBManager>.Instance.SetRollback(userData.id, 0, null));
						}
					}));
				}
				else if (Singleton<DBManager>.Instance.rollback == 2)
				{
					Singleton<DBManager>.Instance.completedSaveRollback = true;
				}
			}
			yield return StartCoroutine(Singleton<DBManager>.Instance.GetSeason(delegate(object result)
			{
				int season = Singleton<DBManager>.Instance.season;
				if (isTestSesaonReward)
				{
					season = testNewSeason;
				}
				if (result != null && season != 1)
				{
					if (userData.season < season)
					{
						userData.season = season;
						userData.totalScore = 0;
					}
					StartCoroutine(Singleton<DBManager>.Instance.GetRankHistory(userData.id, season, delegate(object response)
					{
						if (response != null)
						{
							userData.seasonRank = JsonConvert.DeserializeObject<List<int>>(response.ToString());
						}
					}));
				}
			}));
		}
		userData.lastConnect = DateTime.Now.ToString("yyyy-MM-dd");
		detectDevice();
		SetExpBar();
		ReCaculateSharkReward();
		SaveUserData();
		if (IsInternetConnected && !isBeta)
		{
			MonoBehaviour.print("SetUserInfo");
			yield return StartCoroutine(Singleton<DBManager>.Instance.GetUserInfoID(userData.id, delegate
			{
				StartCoroutine(Singleton<DBManager>.Instance.SetUserInfo(userData, null));
			}));
			if (Singleton<DBManager>.Instance.completedSaveRollback)
			{
				yield return StartCoroutine(Singleton<DBManager>.Instance.GetColumnNames(delegate(object s)
				{
					if (s != null)
					{
						Singleton<DBManager>.Instance.columns = (from S in (s as JArray).OfType<JObject>()
							select S.GetValue<string>("Field")).ToList();
						StartCoroutine(Singleton<DBManager>.Instance.GetUserDataID(userData.id, delegate
						{
							StartCoroutine(Singleton<DBManager>.Instance.SetUserData(userData, delegate(object s2)
							{
								if (s2 != null)
								{
									StartCoroutine(Singleton<DBManager>.Instance.SetRollback(Singleton<OculusManager>.Instance.id, 3, delegate(object s3)
									{
										if (s3 != null)
										{
											Singleton<DBManager>.Instance.completedSaveRollback = false;
										}
									}));
								}
							}));
						}));
					}
				}));
			}
			yield return StartCoroutine(Singleton<DBManager>.Instance.GetAddItems(Singleton<OculusManager>.Instance.id, delegate(object s)
			{
				if (s != null)
				{
					ParseAddItems(s.ToString());
				}
			}));
		}
		loadCompleted.Invoke();
		loaded = true;
		VRInput.RegisterKeys();
	}

	public void AddNation(NationData nation)
	{
		userData.nations.Add(nation);
		Save();
	}

	public void OnFailedInit()
	{
		StartCoroutine(Prepare());
	}

	public void OnCompletedLoggedIn()
	{
		StartCoroutine(Prepare());
	}

	public void OnFailedLoggedIn()
	{
		StartCoroutine(Prepare());
	}

	private void IncreaseConnectedCount()
	{
		userData.userConnectedCount++;
		SaveUserData();
	}

	private void Version_0971(string data)
	{
	}

	public IEnumerator Load()
	{
		isLoading = true;
		string path = UnityEngine.Application.persistentDataPath + "/Saves/" + saveFilename;
		if (File.Exists(path))
		{
			try
			{
				string text = File.ReadAllText(path);
				string text2 = ((!isSecure) ? text : new AESEncryptor("castian2", AESBits.BITS128).Decrypt(text));
				if (!string.IsNullOrEmpty(text2))
				{
					Parse(text2);
				}
			}
			catch (Exception ex)
			{
				MonoBehaviour.print("Load Exception : " + ex);
				isLoading = false;
			}
		}
		while (isLoading)
		{
			yield return null;
		}
		yield return true;
	}

	public void Parse(string data)
	{
		if (JObject.Parse(data)["version"] != null)
		{
			userData.version = (string)JObject.Parse(data).GetValue("version");
		}
		if (JObject.Parse(data)["nickName"] != null)
		{
			userData.nickName = (string)JObject.Parse(data).GetValue("nickName");
		}
		if (JObject.Parse(data)["id"] != null)
		{
			userData.id = (ulong)JObject.Parse(data).GetValue("id");
		}
		if (JObject.Parse(data)["userLv"] != null)
		{
			userData.userLv = (int)JObject.Parse(data).GetValue("userLv");
		}
		if (JObject.Parse(data)["userExp"] != null)
		{
			userData.userExp = (int)JObject.Parse(data).GetValue("userExp");
		}
		if (JObject.Parse(data)["userGold"] != null)
		{
			userData.userGold = (int)JObject.Parse(data).GetValue("userGold");
		}
		if (JObject.Parse(data)["userConnectedCount"] != null)
		{
			userData.userConnectedCount = (int)JObject.Parse(data).GetValue("userConnectedCount");
		}
		if (JObject.Parse(data)["playtime"] != null)
		{
			userData.playtime = (int)JObject.Parse(data).GetValue("playtime");
		}
		if (JObject.Parse(data)["curRodS"] != null)
		{
			userData.curRodS = (int)JObject.Parse(data).GetValue("curRodS");
		}
		if (JObject.Parse(data)["curRodC"] != null)
		{
			userData.curRodC = (int)JObject.Parse(data).GetValue("curRodC");
		}
		if (JObject.Parse(data)["curReelS"] != null)
		{
			userData.curReelS = (int)JObject.Parse(data).GetValue("curReelS");
		}
		if (JObject.Parse(data)["curReelC"] != null)
		{
			userData.curReelC = (int)JObject.Parse(data).GetValue("curReelC");
		}
		if (JObject.Parse(data)["curLure"] != null)
		{
			userData.curLure = (int)JObject.Parse(data).GetValue("curLure");
		}
		if (JObject.Parse(data)["curGlove"] != null)
		{
			userData.curGlove = (int)JObject.Parse(data).GetValue("curGlove");
		}
		if (JObject.Parse(data)["curBoat"] != null)
		{
			userData.curBoat = (int)JObject.Parse(data).GetValue("curBoat");
		}
		if (JObject.Parse(data)["curNation"] != null)
		{
			userData.curNation = (int)JObject.Parse(data).GetValue("curNation");
		}
		if (JObject.Parse(data)["rodS"] != null)
		{
			userData.rodS = JObject.Parse(data).Value<JArray>("rodS").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["rodC"] != null)
		{
			userData.rodC = JObject.Parse(data).Value<JArray>("rodC").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["rodSDurability"] != null)
		{
			userData.rodSDurability = JObject.Parse(data).Value<JArray>("rodSDurability").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["rodCDurability"] != null)
		{
			userData.rodCDurability = JObject.Parse(data).Value<JArray>("rodCDurability").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["reelS"] != null)
		{
			userData.reelS = JObject.Parse(data).Value<JArray>("reelS").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["reelC"] != null)
		{
			userData.reelC = JObject.Parse(data).Value<JArray>("reelC").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["reelSDurability"] != null)
		{
			userData.reelSDurability = JObject.Parse(data).Value<JArray>("reelSDurability").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["reelCDurability"] != null)
		{
			userData.reelCDurability = JObject.Parse(data).Value<JArray>("reelCDurability").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["curType"] != null)
		{
			userData.curType = (int)JObject.Parse(data).GetValue("curType");
		}
		if (JObject.Parse(data)["lure"] != null)
		{
			userData.lure = JObject.Parse(data).Value<JArray>("lure").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["lureDurability"] != null)
		{
			userData.lureDurability = JObject.Parse(data).Value<JArray>("lureDurability").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["line"] != null)
		{
			userData.line = JObject.Parse(data).Value<JArray>("line").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["lineDurability"] != null)
		{
			userData.lineDurability = JObject.Parse(data).Value<JArray>("lineDurability").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["gloves"] != null)
		{
			userData.gloves = JObject.Parse(data).Value<JArray>("gloves").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["boats"] != null)
		{
			userData.boats = JObject.Parse(data).Value<JArray>("boats").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["spotCount"] != null)
		{
			userData.spotCount = JObject.Parse(data).Value<JArray>("spotCount").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["fishTotal"] != null)
		{
			userData.fishTotal = (int)JObject.Parse(data).GetValue("fishTotal");
		}
		if (JObject.Parse(data)["season"] != null)
		{
			userData.season = (int)JObject.Parse(data).GetValue("season");
		}
		if (JObject.Parse(data)["totalScore"] != null)
		{
			userData.totalScore = (int)JObject.Parse(data).GetValue("totalScore");
		}
		if (JObject.Parse(data)["seasonRank"] != null)
		{
			userData.seasonRank = JObject.Parse(data).Value<JArray>("seasonRank").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["aquaItem"] != null && JObject.Parse(data)["aquaState"] != null && JObject.Parse(data)["aquaFishCount"] != null)
		{
			ConvertOldAquaData(data);
		}
		if (JObject.Parse(data)["fishCount"] != null && JObject.Parse(data)["fishMaxSize"] != null && JObject.Parse(data)["fishMaxWeight"] != null)
		{
			ConvertOldFishData(data);
		}
		if (JObject.Parse(data)["achievement"] != null && JObject.Parse(data)["achievementGrade"] != null)
		{
			ConvertOldAchievementData(data);
		}
		if (JObject.Parse(data)["nations"] != null)
		{
			List<NationData> nations = JObject.Parse(data).Value<JArray>("nations").ToObject<List<NationData>>();
			userData.nations = nations;
		}
		if (JObject.Parse(data)["rooms"] != null)
		{
			List<RoomList> rooms = JObject.Parse(data).Value<JArray>("rooms").ToObject<List<RoomList>>();
			userData.rooms = rooms;
		}
		if (JObject.Parse(data)["furnitures"] != null)
		{
			List<FurnitureRoomList> furnitures = JObject.Parse(data).Value<JArray>("furnitures").ToObject<List<FurnitureRoomList>>();
			userData.furnitures = furnitures;
		}
		if (JObject.Parse(data)["aquariums"] != null)
		{
			List<AquariumRoomList> aquariums = JObject.Parse(data).Value<JArray>("aquariums").ToObject<List<AquariumRoomList>>();
			userData.aquariums = aquariums;
		}
		if (JObject.Parse(data)["fishes"] != null)
		{
			List<FishNationList> fishes = JObject.Parse(data).Value<JArray>("fishes").ToObject<List<FishNationList>>();
			userData.fishes = fishes;
		}
		if (JObject.Parse(data)["achievements"] != null)
		{
			List<AchieveNationList> achievements = JObject.Parse(data).Value<JArray>("achievements").ToObject<List<AchieveNationList>>();
			userData.achievements = achievements;
		}
		if (JObject.Parse(data)["animals"] != null)
		{
			List<AnimalData> animals = JObject.Parse(data).Value<JArray>("animals").ToObject<List<AnimalData>>();
			userData.animals = animals;
		}
		if (JObject.Parse(data)["props"] != null)
		{
			List<PropData> props = JObject.Parse(data).Value<JArray>("props").ToObject<List<PropData>>();
			userData.props = props;
		}
		int count = userData.rodS.Count;
		int count2 = userData.rodC.Count;
		int count3 = userData.reelS.Count;
		int count4 = userData.reelC.Count;
		int count5 = userData.lure.Count;
		int num = count + count2 + count3 + count4 + count5;
		if (num != userData.achievements[0].achievement[1])
		{
			userData.achievements[0].achievement[1] = num;
			for (int i = 0; i < ItemDatabase.dlcs[0].achieveItems[1].targetNumber.Count(); i++)
			{
				if (ItemDatabase.dlcs[0].achieveItems[1].targetNumber[i] <= num)
				{
					userData.achievements[0].grade[1] = i + 1;
				}
			}
		}
		if (JObject.Parse(data)["selectedAudioNumber"] != null)
		{
			userData.selectedAudioNumber = (int)JObject.Parse(data).GetValue("selectedAudioNumber");
		}
		if (JObject.Parse(data)["selectedAudioTime"] != null)
		{
			userData.selectedAudioTime = (float)JObject.Parse(data).GetValue("selectedAudioTime");
		}
		if (JObject.Parse(data)["playOn"] != null)
		{
			userData.playOn = (bool)JObject.Parse(data).GetValue("playOn");
		}
		if (JObject.Parse(data)["loopOn"] != null)
		{
			userData.loopOn = (bool)JObject.Parse(data).GetValue("loopOn");
		}
		if (JObject.Parse(data)["shuffleOn"] != null)
		{
			userData.shuffleOn = (bool)JObject.Parse(data).GetValue("shuffleOn");
		}
		if (JObject.Parse(data)["volumeMusic"] != null)
		{
			userData.volumeMusic = (int)JObject.Parse(data).GetValue("volumeMusic");
		}
		if (JObject.Parse(data)["volumeAmbient"] != null)
		{
			userData.volumeAmbient = (int)JObject.Parse(data).GetValue("volumeAmbient");
		}
		if (JObject.Parse(data)["graphicQuality"] != null)
		{
			userData.graphicQuality = (int)JObject.Parse(data).GetValue("graphicQuality");
		}
		if (JObject.Parse(data)["bFrameRateHigh"] != null)
		{
			userData.bFrameRateHigh = (bool)JObject.Parse(data).GetValue("bFrameRateHigh");
		}
		if (JObject.Parse(data)["gameDifficulty"] != null)
		{
			userData.gameDifficulty = (int)JObject.Parse(data).GetValue("gameDifficulty");
		}
		if (JObject.Parse(data)["walkCabin"] != null)
		{
			userData.walkCabin = (int)JObject.Parse(data).GetValue("walkCabin");
		}
		if (JObject.Parse(data)["rotateCabin"] != null)
		{
			userData.rotateCabin = (int)JObject.Parse(data).GetValue("rotateCabin");
		}
		if (JObject.Parse(data)["rightHand"] != null)
		{
			userData.rightHand = (bool)JObject.Parse(data).GetValue("rightHand");
		}
		if (JObject.Parse(data)["bothHand"] != null)
		{
			userData.bothHand = (bool)JObject.Parse(data).GetValue("bothHand");
		}
		if (JObject.Parse(data)["deviceType"] != null)
		{
			userData.deviceType = (int)JObject.Parse(data).GetValue("deviceType");
		}
		if (JObject.Parse(data)["position"] != null)
		{
			userData.position = JObject.Parse(data)["position"].ToObject<SerializableVector3>();
		}
		if (JObject.Parse(data)["lastConnect"] != null)
		{
			userData.lastConnect = (string)JObject.Parse(data).GetValue("lastConnect");
		}
		if (JObject.Parse(data)["language"] != null)
		{
			userData.language = (int)JObject.Parse(data).GetValue("language");
		}
		if (JObject.Parse(data)["cabinTime"] != null)
		{
			userData.cabinTime = (int)JObject.Parse(data).GetValue("cabinTime");
		}
		if (JObject.Parse(data)["controlType"] != null)
		{
			userData.controlType = (int)JObject.Parse(data).GetValue("controlType");
		}
		if (JObject.Parse(data)["unit"] != null)
		{
			userData.unit = (int)JObject.Parse(data).GetValue("unit");
		}
		if (JObject.Parse(data)["lineEfffect"] != null)
		{
			userData.lineEfffect = (bool)JObject.Parse(data).GetValue("lineEfffect");
		}
		if (JObject.Parse(data)["autoSave"] != null)
		{
			userData.autoSave = (bool)JObject.Parse(data).GetValue("autoSave");
		}
		if (JObject.Parse(data)["favorites"] != null)
		{
			userData.favorites = JObject.Parse(data).Value<JArray>("favorites").ToObject<List<string>>();
		}
		if (JObject.Parse(data)["ignoreTutorial"] != null)
		{
			userData.ignoreTutorial = (bool)JObject.Parse(data).GetValue("ignoreTutorial");
		}
		if (JObject.Parse(data)["ignoreInfoMusic"] != null)
		{
			userData.ignoreInfoMusic = (bool)JObject.Parse(data).GetValue("ignoreInfoMusic");
		}
		if (JObject.Parse(data)["ignoreInfoWeb"] != null)
		{
			userData.ignoreInfoWeb = (bool)JObject.Parse(data).GetValue("ignoreInfoWeb");
		}
		if (JObject.Parse(data)["curGender"] != null)
		{
			userData.curGender = (int)JObject.Parse(data).GetValue("curGender");
		}
		if (JObject.Parse(data)["avatars"] != null)
		{
			userData.avatars = JObject.Parse(data).Value<JArray>("avatars").ToObject<List<AvatarData>>();
		}
		if (JObject.Parse(data)["isUserInfoVisible"] != null)
		{
			userData.isUserInfoVisible = (bool)JObject.Parse(data).GetValue("isUserInfoVisible");
		}
		if (JObject.Parse(data)["isPushToTalk"] != null)
		{
			userData.isPushToTalk = (bool)JObject.Parse(data).GetValue("isPushToTalk");
		}
		if (JObject.Parse(data)["serverRegion"] != null)
		{
			userData.serverRegion = (string)JObject.Parse(data).GetValue("serverRegion");
		}
		isLoading = false;
	}

	public void ReCaculateSharkReward()
	{
		if (userData.fishes.Count > 0)
		{
			int num = userData.fishes[0].fishCount[25];
			userData.achievements[0].achievement[12] = num;
			for (int i = 0; i < ItemDatabase.dlcs[0].achieveItems[12].targetNumber.Count(); i++)
			{
				if (ItemDatabase.dlcs[0].achieveItems[12].targetNumber[i] <= num)
				{
					userData.achievements[0].grade[12] = i + 1;
				}
			}
		}
		if (userData.achievements[0].grade[12] >= 3 && !userData.animals[0].purchased)
		{
			userData.animals[0].purchased = true;
		}
	}

	public void ConvertOldAchievementData(string data)
	{
		List<int> achievement = JObject.Parse(data).Value<JArray>("achievement").ToObject<List<int>>();
		List<int> grade = JObject.Parse(data).Value<JArray>("achievementGrade").ToObject<List<int>>();
		List<DLC> dlcs = ItemDatabase.dlcs;
		for (int i = 0; i < dlcs.Count; i++)
		{
			if (userData.achievements.Count < dlcs.Count)
			{
				userData.achievements.Add(new AchieveNationList
				{
					nationName = dlcs[i].nation.ItemName
				});
			}
			for (int j = 0; j < ItemDatabase.dlcs[i].achieveItems.Count(); j++)
			{
				if (userData.achievements[i].achievement.Count < ItemDatabase.dlcs[i].achieveItems.Count())
				{
					userData.achievements[i].achievement.Add(0);
					userData.achievements[i].grade.Add(0);
				}
			}
		}
		userData.achievements[0].achievement = achievement;
		userData.achievements[0].grade = grade;
	}

	public void ConvertOldFishData(string data)
	{
		List<int> fishCount = JObject.Parse(data).Value<JArray>("fishCount").ToObject<List<int>>();
		List<float> maxSize = JObject.Parse(data).Value<JArray>("fishMaxSize").ToObject<List<float>>();
		List<float> maxWeight = JObject.Parse(data).Value<JArray>("fishMaxWeight").ToObject<List<float>>();
		List<DLC> dlcs = ItemDatabase.dlcs;
		for (int i = 0; i < dlcs.Count; i++)
		{
			if (userData.fishes.Count < dlcs.Count)
			{
				userData.fishes.Add(new FishNationList
				{
					nationName = dlcs[i].dlcName
				});
			}
			for (int j = 0; j < dlcs[i].fishItems.Count; j++)
			{
				if (userData.fishes[i].fishCount.Count < dlcs[i].fishItems.Count)
				{
					userData.fishes[i].fishCount.Add(0);
					userData.fishes[i].maxSize.Add(0f);
					userData.fishes[i].maxWeight.Add(0f);
				}
			}
		}
		userData.fishes[0].fishCount = fishCount;
		userData.fishes[0].maxSize = maxSize;
		userData.fishes[0].maxWeight = maxWeight;
	}

	public void ConvertOldAquaData(string data)
	{
		List<bool> list = JObject.Parse(data).Value<JArray>("aquaItem").ToObject<List<bool>>();
		List<bool> list2 = JObject.Parse(data).Value<JArray>("aquaState").ToObject<List<bool>>();
		List<int> fishCount = JObject.Parse(data).Value<JArray>("aquaFishCount").ToObject<List<int>>();
		int num = 25;
		int num2 = 22;
		List<DLC> nationItems = ItemDatabase.dlcs;
		for (int i = 0; i < nationItems.Count; i++)
		{
			if (userData.aquariums.Count < nationItems.Count)
			{
				userData.aquariums.Add(new AquariumRoomList
				{
					nationName = nationItems[i].nation.ItemName
				});
			}
			for (int k = 0; k < nationItems[i].roomItems.Count; k++)
			{
				if (userData.aquariums[i].rooms.Count < nationItems[i].roomItems.Count)
				{
					userData.aquariums[i].rooms.Add(new AquariumDataList
					{
						roomName = "Room_" + k
					});
				}
				int j;
				for (j = 0; j < nationItems[i].aquaItems.Count(); j++)
				{
					if (nationItems[i].aquaItems[j].nationId == i && nationItems[i].aquaItems[j].lobbyId == k && !userData.aquariums[i].rooms[k].items.Any((AquariumData s) => s.id == nationItems[i].aquaItems[j].ID))
					{
						bool defaultItem = nationItems[i].aquaItems[j].defaultItem;
						bool state = nationItems[i].aquaItems[j].state;
						userData.aquariums[i].rooms[k].items.Add(new AquariumData
						{
							id = nationItems[i].aquaItems[j].ID,
							name = nationItems[i].aquaItems[j].ItemName,
							purchased = defaultItem,
							state = state
						});
					}
				}
				int num3 = 0;
				num3 = ((k != 0) ? num2 : num);
				for (int l = 0; l < num3; l++)
				{
					if (userData.aquariums[i].rooms[k].fishCount.Count < num3)
					{
						userData.aquariums[i].rooms[k].fishCount.Add(0);
					}
				}
			}
		}
		for (int m = 0; m < list.Count; m++)
		{
			userData.aquariums[0].rooms[0].items[m].purchased = list[m];
			userData.aquariums[0].rooms[0].items[m].state = list2[m];
		}
		userData.aquariums[0].rooms[0].fishCount = fishCount;
	}

	public void ParseFromJObject(JObject jobject)
	{
		if (jobject == null)
		{
			return;
		}
		if (jobject["version"] != null)
		{
			userData.version = jobject["version"].ToString();
		}
		if (jobject["nickName"] != null)
		{
			userData.nickName = jobject["nickName"].ToString();
		}
		if (jobject["id"] != null)
		{
			userData.id = ulong.Parse(jobject["id"].ToString());
		}
		if (jobject["userLv"] != null)
		{
			userData.userLv = (int)jobject["userLv"];
		}
		if (jobject["userExp"] != null)
		{
			userData.userExp = (int)jobject["userExp"];
		}
		if (jobject["userGold"] != null)
		{
			userData.userGold = (int)jobject["userGold"];
		}
		if (jobject["curRodS"] != null)
		{
			userData.curRodS = (int)jobject["curRodS"];
		}
		if (jobject["curRodC"] != null)
		{
			userData.curRodC = (int)jobject["curRodC"];
		}
		if (jobject["curReelS"] != null)
		{
			userData.curReelS = (int)jobject["curReelS"];
		}
		if (jobject["curReelC"] != null)
		{
			userData.curReelC = (int)jobject["curReelC"];
		}
		if (jobject["curLure"] != null)
		{
			userData.curLure = (int)jobject["curLure"];
		}
		if (jobject["curLine"] != null)
		{
			userData.curLine = (int)jobject["curLine"];
		}
		if (jobject["curType"] != null)
		{
			userData.curType = (int)jobject["curType"];
		}
		if (jobject["curGlove"] != null && jobject["curGlove"].ToString() != "")
		{
			userData.curGlove = (int)jobject["curGlove"];
		}
		if (jobject["curBoat"] != null && jobject["curBoat"].ToString() != "")
		{
			userData.curBoat = (int)jobject["curBoat"];
		}
		if (jobject["curNation"] != null)
		{
			userData.curNation = (int)jobject["curNation"];
		}
		if (jobject["rodS"] != null)
		{
			userData.rodS = JsonConvert.DeserializeObject<List<int>>(jobject["rodS"].ToString());
		}
		if (jobject["rodC"] != null)
		{
			userData.rodC = JsonConvert.DeserializeObject<List<int>>(jobject["rodC"].ToString());
		}
		if (jobject["rodSDurability"] != null)
		{
			userData.rodSDurability = JsonConvert.DeserializeObject<List<int>>(jobject["rodSDurability"].ToString());
		}
		if (jobject["rodCDurability"] != null)
		{
			userData.rodCDurability = JsonConvert.DeserializeObject<List<int>>(jobject["rodCDurability"].ToString());
		}
		if (jobject["reelS"] != null)
		{
			userData.reelS = JsonConvert.DeserializeObject<List<int>>(jobject["reelS"].ToString());
		}
		if (jobject["reelC"] != null)
		{
			userData.reelC = JsonConvert.DeserializeObject<List<int>>(jobject["reelC"].ToString());
		}
		if (jobject["reelSDurability"] != null)
		{
			userData.reelSDurability = JsonConvert.DeserializeObject<List<int>>(jobject["reelSDurability"].ToString());
		}
		if (jobject["reelCDurability"] != null)
		{
			userData.reelCDurability = JsonConvert.DeserializeObject<List<int>>(jobject["reelCDurability"].ToString());
		}
		if (jobject["lure"] != null)
		{
			userData.lure = JsonConvert.DeserializeObject<List<int>>(jobject["lure"].ToString());
		}
		if (jobject["lureDurability"] != null)
		{
			userData.lureDurability = JsonConvert.DeserializeObject<List<int>>(jobject["lureDurability"].ToString());
		}
		if (jobject["line"] != null)
		{
			userData.line = JsonConvert.DeserializeObject<List<int>>(jobject["line"].ToString());
		}
		if (jobject["lineDurability"] != null)
		{
			userData.lineDurability = JsonConvert.DeserializeObject<List<int>>(jobject["lineDurability"].ToString());
		}
		if (jobject["gloves"] != null && jobject["gloves"].ToString() != "")
		{
			userData.gloves = JsonConvert.DeserializeObject<List<int>>(jobject["gloves"].ToString());
		}
		if (jobject["boats"] != null && jobject["boats"].ToString() != "")
		{
			userData.boats = JsonConvert.DeserializeObject<List<int>>(jobject["boats"].ToString());
		}
		if (jobject["aquariums"] != null && jobject["aquariums"].ToString() != "")
		{
			List<AquariumRoomList> aquariums = JsonConvert.DeserializeObject<List<AquariumRoomList>>(jobject["aquariums"].ToString());
			userData.aquariums = aquariums;
		}
		else if (jobject["aquaItem"] != null && jobject["aquaState"] != null && jobject["aquaFishCount"] != null)
		{
			List<bool> list = JsonConvert.DeserializeObject<List<bool>>(jobject["aquaItem"].ToString());
			List<bool> list2 = JsonConvert.DeserializeObject<List<bool>>(jobject["aquaState"].ToString());
			List<int> fishCount = JsonConvert.DeserializeObject<List<int>>(jobject["aquaFishCount"].ToString());
			userData.aquariums[0].rooms[0].fishCount = fishCount;
			for (int i = 0; i < list.Count; i++)
			{
				userData.aquariums[0].rooms[0].items[i] = new AquariumData
				{
					name = ItemDatabase.dlcs[0].aquaItems[i].ItemName,
					id = i,
					purchased = list[i],
					state = list2[i]
				};
			}
		}
		if (jobject["season"] != null && jobject["season"].ToString() != "")
		{
			userData.season = (int)jobject["season"];
			if (userData.season == (int)jobject["season"] && jobject["totalScore"] != null && jobject["totalScore"].ToString() != "")
			{
				userData.totalScore = (int)jobject["totalScore"];
			}
		}
		if (jobject["nations"] != null && jobject["nations"].ToString() != "")
		{
			List<NationData> nations = JsonConvert.DeserializeObject<List<NationData>>(jobject["nations"].ToString());
			userData.nations = nations;
		}
		if (jobject["rooms"] != null && jobject["rooms"].ToString() != "")
		{
			List<RoomList> rooms = JsonConvert.DeserializeObject<List<RoomList>>(jobject["rooms"].ToString());
			userData.rooms = rooms;
		}
		if (jobject["furnitures"] != null && jobject["furnitures"].ToString() != "")
		{
			List<FurnitureRoomList> furnitures = JsonConvert.DeserializeObject<List<FurnitureRoomList>>(jobject["furnitures"].ToString());
			userData.furnitures = furnitures;
		}
		if (jobject["fishes"] != null && jobject["fishes"].ToString() != "")
		{
			List<FishNationList> fishes = JsonConvert.DeserializeObject<List<FishNationList>>(jobject["fishes"].ToString());
			userData.fishes = fishes;
		}
		else if (jobject["fishCount"] != null && jobject["fishMaxSize"] != null && jobject["fishMaxWeight"] != null)
		{
			List<int> fishCount2 = JsonConvert.DeserializeObject<List<int>>(jobject["fishCount"].ToString());
			List<float> maxSize = JsonConvert.DeserializeObject<List<float>>(jobject["fishMaxSize"].ToString());
			List<float> maxWeight = JsonConvert.DeserializeObject<List<float>>(jobject["fishMaxWeight"].ToString());
			userData.fishes[0].fishCount = fishCount2;
			userData.fishes[0].maxSize = maxSize;
			userData.fishes[0].maxWeight = maxWeight;
		}
		if (jobject["achievements"] != null && jobject["achievements"].ToString() != "")
		{
			List<AchieveNationList> achievements = JsonConvert.DeserializeObject<List<AchieveNationList>>(jobject["achievements"].ToString());
			userData.achievements = achievements;
		}
		else if (jobject["achievement"] != null && jobject["achievementGrade"] != null)
		{
			List<int> achievement = JsonConvert.DeserializeObject<List<int>>(jobject["achievement"].ToString());
			List<int> grade = JsonConvert.DeserializeObject<List<int>>(jobject["achievementGrade"].ToString());
			userData.achievements[0].achievement = achievement;
			userData.achievements[0].grade = grade;
		}
		if (jobject["spotCount"] != null)
		{
			userData.spotCount = JsonConvert.DeserializeObject<List<int>>(jobject["spotCount"].ToString());
		}
		if (jobject["fishTotal"] != null)
		{
			userData.fishTotal = (int)jobject["fishTotal"];
		}
		if (jobject["props"] != null && jobject["props"].ToString() != "")
		{
			List<PropData> props = JsonConvert.DeserializeObject<List<PropData>>(jobject["props"].ToString());
			userData.props = props;
		}
		if (jobject["gameDifficulty"] != null)
		{
			userData.gameDifficulty = (int)jobject["gameDifficulty"];
		}
		if (jobject["rightHand"] != null)
		{
			userData.rightHand = (bool)jobject["rightHand"];
		}
		if (jobject["bothHand"] != null)
		{
			userData.bothHand = (bool)jobject["bothHand"];
		}
		if (jobject["language"] != null)
		{
			userData.language = (int)jobject["language"];
		}
		if (jobject["unit"] != null)
		{
			userData.unit = (int)jobject["unit"];
		}
		userData.selectedAudioNumber = -1;
		userData.selectedAudioTime = -1f;
		userData.playOn = false;
		userData.loopOn = false;
		userData.shuffleOn = false;
		userData.volumeMusic = 7;
		userData.volumeAmbient = 7;
		userData.graphicQuality = 2;
		userData.bFrameRateHigh = true;
		userData.walkCabin = 0;
		userData.rotateCabin = 0;
		userData.deviceType = 2;
		userData.position = new SerializableVector3(0f, 0f, 0f);
		userData.cabinTime = 0;
		userData.controlType = 0;
		Save();
	}

	public void SaveUserData()
	{
		try
		{
			userData.version = UnityEngine.Application.version;
			string text = null;
			string text2 = JsonConvert.SerializeObject(userData, Formatting.Indented);
			text = ((!isSecure) ? text2 : new AESEncryptor("castian2", AESBits.BITS128).Encrypt(text2));
			_ = UnityEngine.Application.persistentDataPath + savePath + "/" + saveFilename;
			File.WriteAllText(UnityEngine.Application.persistentDataPath + savePath + "/" + saveFilename, text);
		}
		catch (Exception ex)
		{
			UnityEngine.Debug.Log("Exception SaveUserData : " + ex);
		}
	}

	public bool Save()
	{
		try
		{
			userData.version = UnityEngine.Application.version;
			string text = null;
			string text2 = JsonConvert.SerializeObject(userData, Formatting.Indented);
			text = ((!isSecure) ? text2 : new AESEncryptor("castian2", AESBits.BITS128).Encrypt(text2));
			_ = UnityEngine.Application.persistentDataPath + savePath + "/" + saveFilename;
			File.WriteAllText(UnityEngine.Application.persistentDataPath + savePath + "/" + saveFilename, text);
			UnityEngine.Debug.Log("Success SaveUserData");
			return true;
		}
		catch (Exception ex)
		{
			UnityEngine.Debug.Log("Exception SaveUserData : " + ex);
			return false;
		}
	}

	private void detectDevice()
	{
		switch (targetPlatform)
		{
		case DEVICE_TYPE.GO:
			userData.deviceType = 0;
			userData.rightHand = detectMainHand();
			userData.bothHand = false;
			break;
		case DEVICE_TYPE.QUEST:
			userData.deviceType = 1;
			userData.graphicQuality = 2;
			break;
		case DEVICE_TYPE.RIFT:
			userData.deviceType = 2;
			userData.graphicQuality = 2;
			break;
		case DEVICE_TYPE.OTHERS:
			userData.deviceType = 1;
			break;
		}
		UnityEngine.Debug.Log("device : " + OVRPlugin.productName);
	}

	public bool detectMainHand()
	{
		return OVRPlugin.GetDominantHand() switch
		{
			OVRPlugin.Handedness.RightHanded => true, 
			OVRPlugin.Handedness.LeftHanded => false, 
			_ => true, 
		};
	}

	public float changeUnitLength(float cmToIn)
	{
		return cmToIn * 0.3937f;
	}

	public float changeUnitWeight(float kgTolb)
	{
		return kgTolb * 2.2046f;
	}

	public float changeUnitKg(float gToKg)
	{
		return gToKg * 0.001f;
	}

	public void SetExpBar()
	{
		if (userData.userLv == 1)
		{
			if (userData.userExp == 0)
			{
				userExpBar = 0f;
			}
			else
			{
				userExpBar = (float)userData.userExp / (float)levelUpDatabase.GetExp(userData.userLv - 1);
			}
			return;
		}
		float num = userData.userExp - levelUpDatabase.GetExp(userData.userLv - 2);
		if (num < 0f)
		{
			num = 0f;
			userData.userExp = levelUpDatabase.GetExp(userData.userLv - 2);
		}
		userExpBar = num / (float)(levelUpDatabase.GetExp(userData.userLv - 1) - levelUpDatabase.GetExp(userData.userLv - 2));
	}

	public void SavePlaytime()
	{
		float num = Time.time - startTime;
		userData.playtime += (int)(num / 60f);
		startTime = Time.time;
		SaveUserData();
	}

	public void CreateDynamicData()
	{
		List<DLC> nationItems = ItemDatabase.dlcs;
		int i;
		for (i = 0; i < nationItems.Count; i++)
		{
			if (!userData.nations.Any((NationData s) => s.id == nationItems[i].nation.ID))
			{
				userData.nations.Add(new NationData
				{
					id = nationItems[i].nation.ID,
					name = nationItems[i].nation.ItemName,
					purchased = nationItems[i].purchased
				});
			}
		}
		CreateRooms();
	}

	public void CreateRooms()
	{
		List<DLC> nationItems = ItemDatabase.dlcs;
		for (int i = 0; i < nationItems.Count; i++)
		{
			if (userData.rooms.Count < nationItems.Count)
			{
				userData.rooms.Add(new RoomList
				{
					nationName = nationItems[i].nation.ItemName
				});
			}
			int j;
			for (j = 0; j < nationItems[i].roomItems.Count; j++)
			{
				if (!userData.rooms[i].items.Any((RoomData s) => s.id == nationItems[i].roomItems[j].ID))
				{
					bool defaultItem = nationItems[i].roomItems[j].defaultItem;
					userData.rooms[i].items.Add(new RoomData
					{
						id = nationItems[i].roomItems[j].ID,
						name = nationItems[i].roomItems[j].ItemName,
						purchased = defaultItem
					});
				}
			}
		}
		CreateFishes();
		CreateAchieve();
		CreateFurnitures();
		CreateAquariums();
	}

	public void CreateAchieve()
	{
		List<DLC> dlcs = ItemDatabase.dlcs;
		for (int i = 0; i < dlcs.Count; i++)
		{
			if (userData.achievements.Count < dlcs.Count)
			{
				userData.achievements.Add(new AchieveNationList
				{
					nationName = dlcs[i].nation.ItemName
				});
			}
			for (int j = 0; j < ItemDatabase.dlcs[i].achieveItems.Count(); j++)
			{
				if (userData.achievements[i].achievement.Count < ItemDatabase.dlcs[i].achieveItems.Count())
				{
					userData.achievements[i].achievement.Add(0);
					userData.achievements[i].grade.Add(0);
				}
			}
		}
	}

	public void CreateFishes()
	{
		List<DLC> dlcs = ItemDatabase.dlcs;
		for (int i = 0; i < dlcs.Count; i++)
		{
			if (userData.fishes.Count < dlcs.Count)
			{
				userData.fishes.Add(new FishNationList
				{
					nationName = dlcs[i].nation.ItemName
				});
			}
			for (int j = 0; j < dlcs[i].fishItems.Count; j++)
			{
				if (userData.fishes[i].fishCount.Count < dlcs[i].fishItems.Count)
				{
					userData.fishes[i].fishCount.Add(0);
					userData.fishes[i].maxSize.Add(0f);
					userData.fishes[i].maxWeight.Add(0f);
				}
			}
		}
	}

	public void CreateFurnitures()
	{
		List<DLC> nationItems = ItemDatabase.dlcs;
		for (int i = 0; i < nationItems.Count; i++)
		{
			if (userData.furnitures.Count < nationItems.Count)
			{
				userData.furnitures.Add(new FurnitureRoomList
				{
					nationName = nationItems[i].nation.ItemName
				});
			}
			for (int k = 0; k < nationItems[i].roomItems.Count; k++)
			{
				if (userData.furnitures[i].rooms.Count < nationItems[i].roomItems.Count)
				{
					userData.furnitures[i].rooms.Add(new FurnitureDataList
					{
						roomName = "Room_" + k
					});
				}
				int j;
				for (j = 0; j < nationItems[i].furnitureItems.Count; j++)
				{
					if (nationItems[i].furnitureItems[j].nationId == i && nationItems[i].furnitureItems[j].lobbyId == k && !userData.furnitures[i].rooms[k].items.Any((FurnitureData s) => s.id == nationItems[i].furnitureItems[j].ID))
					{
						bool defaultItem = nationItems[i].furnitureItems[j].defaultItem;
						bool state = nationItems[i].furnitureItems[j].state;
						userData.furnitures[i].rooms[k].items.Add(new FurnitureData
						{
							id = nationItems[i].furnitureItems[j].ID,
							name = nationItems[i].furnitureItems[j].ItemName,
							purchased = defaultItem,
							state = state
						});
					}
				}
			}
		}
	}

	public void CreateAquariums()
	{
		List<DLC> nationItems = ItemDatabase.dlcs;
		int num = 25;
		int num2 = 22;
		for (int i = 0; i < nationItems.Count; i++)
		{
			if (userData.aquariums.Count < nationItems.Count)
			{
				userData.aquariums.Add(new AquariumRoomList
				{
					nationName = nationItems[i].nation.ItemName
				});
			}
			for (int k = 0; k < nationItems[i].roomItems.Count; k++)
			{
				if (userData.aquariums[i].rooms.Count < nationItems[i].roomItems.Count)
				{
					userData.aquariums[i].rooms.Add(new AquariumDataList
					{
						roomName = "Room_" + k
					});
				}
				int j;
				for (j = 0; j < nationItems[i].aquaItems.Count(); j++)
				{
					if (nationItems[i].aquaItems[j].nationId == i && nationItems[i].aquaItems[j].lobbyId == k && !userData.aquariums[i].rooms[k].items.Any((AquariumData s) => s.id == nationItems[i].aquaItems[j].ID))
					{
						bool defaultItem = nationItems[i].aquaItems[j].defaultItem;
						bool state = nationItems[i].aquaItems[j].state;
						userData.aquariums[i].rooms[k].items.Add(new AquariumData
						{
							id = nationItems[i].aquaItems[j].ID,
							name = nationItems[i].aquaItems[j].ItemName,
							purchased = defaultItem,
							state = state
						});
					}
				}
				int num3 = 0;
				num3 = ((k != 0) ? num2 : num);
				for (int l = 0; l < num3; l++)
				{
					if (userData.aquariums[i].rooms[k].fishCount.Count < num3)
					{
						userData.aquariums[i].rooms[k].fishCount.Add(0);
					}
				}
			}
		}
	}
}
public class DBManager : Singleton<DBManager>
{
	public List<string> columns;

	public List<FieldInfo> insertFields = new List<FieldInfo>();

	public List<string> updateFields = new List<string>();

	public List<string> updateValues = new List<string>();

	public CloudCheckWindow checkWindow;

	public string cloudVersion = "";

	public int season;

	public int rollback;

	public bool isGetUserData;

	public bool hasIDInUserInfo;

	public bool hasIDInUserData;

	private int dbUserConnectedCount;

	private int dbPlayTime;

	public bool completedSaveRollback;

	public bool useTestServer;

	[HideInInspector]
	public string server = "http://52.53.43.176/";

	private string testServer = "http://workspage.net:8080/";

	private DataManager dataManager;

	private void Awake()
	{
		if (Singleton<DBManager>.Instance != null && Singleton<DBManager>.Instance != this)
		{
			UnityEngine.Object.Destroy(base.gameObject);
			return;
		}
		dataManager = Singleton<DataManager>.Instance;
		UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
		if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
		{
			if (useTestServer)
			{
				server = testServer;
			}
			server += "quest/";
		}
		else if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			if (useTestServer)
			{
				server = testServer;
			}
			server += "go/";
		}
		else if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
		{
			if (useTestServer)
			{
				server = testServer;
			}
			server += "rift/";
		}
	}

	private void Start()
	{
	}

	private UnityWebRequest createPostRequest(string url, WWWForm form)
	{
		UnityWebRequest unityWebRequest = UnityWebRequest.Post(server + url, form);
		unityWebRequest.AddAllowCrossDomainHeader();
		return unityWebRequest;
	}

	public IEnumerator GetRankHistory(ulong id, int season, Action<object> done)
	{
		if (id == 0L)
		{
			done?.Invoke(null);
			yield break;
		}
		WWWForm wWWForm = new WWWForm();
		wWWForm.AddField("id", id.ToString());
		wWWForm.AddField("season", season);
		yield return StartCoroutine(requestJson(wWWForm, "getRankHistory", done));
	}

	public IEnumerator GetLetter(Action<object> done)
	{
		yield return StartCoroutine(requestJson(new WWWForm(), "getLetterData", done));
	}

	public IEnumerator GetColumnNames(Action<object> done)
	{
		yield return StartCoroutine(requestJson(new WWWForm(), "getColumnNames", done));
	}

	public IEnumerator GetSeason(Action<object> done)
	{
		yield return StartCoroutine(requestJson(new WWWForm(), "getSeason", updateSeason, done));
	}

	private void updateSeason(object s)
	{
		if (s != null)
		{
			season = int.Parse(s.ToString());
		}
	}

	public IEnumerator GetUserDataID(ulong id, Action<object> done = null)
	{
		if (id == 0L)
		{
			done?.Invoke(null);
			yield break;
		}
		WWWForm wWWForm = new WWWForm();
		wWWForm.AddField("id", id.ToString());
		yield return StartCoroutine(requestJson(wWWForm, "getUserDataID", updateUserDataID, done));
	}

	private void updateUserDataID(object response)
	{
		if (response != null)
		{
			if (int.Parse(response.ToString()) > 0)
			{
				hasIDInUserData = true;
			}
			else
			{
				hasIDInUserData = false;
			}
		}
	}

	public IEnumerator GetUserInfoID(ulong id, Action<object> done = null)
	{
		if (id == 0L)
		{
			done?.Invoke(null);
			yield break;
		}
		WWWForm wWWForm = new WWWForm();
		wWWForm.AddField("id", id.ToString());
		yield return StartCoroutine(requestJson(wWWForm, "getUserInfoID", updateUserInfoID, done));
	}

	private void updateUserInfoID(object response)
	{
		if (response != null)
		{
			JArray source = response as JArray;
			hasIDInUserInfo = true;
			UserData userData = dataManager.userData;
			int num = (from S in source.OfType<JObject>()
				select S.GetValue<int>("userConnectedCount")).FirstOrDefault();
			dbUserConnectedCount = num;
			int num2 = (from S in source.OfType<JObject>()
				select S.GetValue<int>("playTime")).ToList().FirstOrDefault();
			dbPlayTime = num2;
			if (dbUserConnectedCount > userData.userConnectedCount)
			{
				dbUserConnectedCount += userData.userConnectedCount;
				userData.userConnectedCount = dbUserConnectedCount;
			}
			else
			{
				dbUserConnectedCount = userData.userConnectedCount;
			}
			if (dbPlayTime > userData.playtime)
			{
				dbPlayTime += userData.playtime;
				userData.playtime = dbPlayTime;
			}
			else
			{
				dbPlayTime = userData.playtime;
			}
			dataManager.Save();
		}
	}

	public IEnumerator GetVersion(Action<object> done)
	{
		yield return StartCoroutine(requestJson(new WWWForm(), "getVersion", done));
	}

	public IEnumerator GetRollBack(ulong id, Action<object> done)
	{
		if (id != 0L && hasIDInUserInfo)
		{
			WWWForm wWWForm = new WWWForm();
			wWWForm.AddField("id", id.ToString());
			yield return StartCoroutine(requestJson(wWWForm, "getRollBack", done));
		}
	}

	public IEnumerator GetUserData(ulong id, Action<object> done)
	{
		if (id != 0L)
		{
			WWWForm wWWForm = new WWWForm();
			wWWForm.AddField("id", id.ToString());
			yield return StartCoroutine(requestJson(wWWForm, "getUserData", done));
		}
	}

	public IEnumerator GetSeasonEndDate(Action<object> done)
	{
		yield return StartCoroutine(requestJson(new WWWForm(), "getSeasonEndDate", done));
	}

	public IEnumerator GetAddItems(ulong id, Action<object> done)
	{
		if (id != 0L)
		{
			WWWForm wWWForm = new WWWForm();
			wWWForm.AddField("id", id.ToString());
			yield return StartCoroutine(requestJson(wWWForm, "getAddItems", done));
		}
	}

	public IEnumerator SetRollback(ulong id, int rollback, Action<object> done)
	{
		if (id != 0L)
		{
			WWWForm wWWForm = new WWWForm();
			wWWForm.AddField("id", id.ToString());
			wWWForm.AddField("rollback", rollback);
			yield return StartCoroutine(setDatas(wWWForm, "setRollBack", done, 0));
		}
	}

	public IEnumerator SetAddItem(ulong id, Action<object> done)
	{
		if (id != 0L)
		{
			WWWForm wWWForm = new WWWForm();
			wWWForm.AddField("id", id.ToString());
			yield return StartCoroutine(setDatas(wWWForm, "setAddItems", done, 0));
		}
	}

	public IEnumerator SetUserInfo(UserData userData, Action<object> done)
	{
		if (userData.id != 0L)
		{
			WWWForm wWWForm = new WWWForm();
			if (hasIDInUserInfo)
			{
				wWWForm.AddField("method", "update");
			}
			else
			{
				wWWForm.AddField("method", "insert");
			}
			wWWForm.AddField("curVersion", UnityEngine.Application.version);
			wWWForm.AddField("nickName", userData.nickName);
			wWWForm.AddField("id", userData.id.ToString());
			wWWForm.AddField("userLv", userData.userLv);
			wWWForm.AddField("userExp", userData.userExp);
			wWWForm.AddField("userGold", userData.userGold);
			wWWForm.AddField("lastConnect", userData.lastConnect.ToString());
			wWWForm.AddField("userConnectedCount", dbUserConnectedCount);
			wWWForm.AddField("playtime", dbPlayTime);
			wWWForm.AddField("rodS", JsonConvert.SerializeObject(userData.rodS));
			wWWForm.AddField("rodC", JsonConvert.SerializeObject(userData.rodC));
			wWWForm.AddField("reelS", JsonConvert.SerializeObject(userData.reelS));
			wWWForm.AddField("reelC", JsonConvert.SerializeObject(userData.reelC));
			wWWForm.AddField("gloves", JsonConvert.SerializeObject(userData.gloves));
			wWWForm.AddField("lure", JsonConvert.SerializeObject(userData.lure));
			wWWForm.AddField("boats", JsonConvert.SerializeObject(userData.boats));
			wWWForm.AddField("fishTotal", userData.fishTotal);
			wWWForm.AddField("season", userData.season);
			wWWForm.AddField("totalscore", userData.totalScore);
			DEVICE_TYPE deviceType = (DEVICE_TYPE)userData.deviceType;
			wWWForm.AddField("deviceType", deviceType.ToString());
			wWWForm.AddField("language", UnityEngine.Application.systemLanguage.ToString());
			wWWForm.AddField("nations", JsonConvert.SerializeObject(userData.nations));
			wWWForm.AddField("rooms", JsonConvert.SerializeObject(userData.rooms));
			wWWForm.AddField("furnitures", JsonConvert.SerializeObject(userData.furnitures));
			wWWForm.AddField("aquariums", JsonConvert.SerializeObject(userData.aquariums));
			wWWForm.AddField("fishes", JsonConvert.SerializeObject(userData.fishes));
			wWWForm.AddField("achievements", JsonConvert.SerializeObject(userData.achievements));
			yield return StartCoroutine(setDatas(wWWForm, "setUserInfo", done, 0));
		}
	}

	public IEnumerator SetUserData(UserData userData, Action<object> done)
	{
		if (userData.id == 0L)
		{
			yield break;
		}
		updateFields.Clear();
		updateValues.Clear();
		WWWForm wWWForm = new WWWForm();
		if (hasIDInUserData)
		{
			wWWForm.AddField("method", "update");
		}
		else
		{
			wWWForm.AddField("method", "insert");
		}
		FieldInfo[] array = (from fi in typeof(UserData).GetFields()
			where fi.GetCustomAttributes(typeof(NonDBAttribute), inherit: false).Length == 0
			select fi).ToArray();
		foreach (FieldInfo fieldInfo in array)
		{
			if (!columns.Contains(fieldInfo.Name))
			{
				continue;
			}
			updateFields.Add(fieldInfo.Name);
			if (!fieldInfo.GetValue(userData).GetType().IsGenericType)
			{
				if (fieldInfo.GetValue(userData).GetType() == typeof(bool))
				{
					int num = (((bool)fieldInfo.GetValue(userData)) ? 1 : 0);
					updateValues.Add(num.ToString());
				}
				else
				{
					updateValues.Add(fieldInfo.GetValue(userData).ToString());
				}
			}
			else
			{
				updateValues.Add(JsonConvert.SerializeObject(fieldInfo.GetValue(userData)));
			}
		}
		for (int j = 0; j < updateFields.Count; j++)
		{
			wWWForm.AddField(updateFields[j], updateValues[j]);
		}
		wWWForm.AddField("savedDate", DateTime.Now.ToString("yyyy-MM-dd"));
		yield return StartCoroutine(setDatas(wWWForm, "setUserData", done, 0));
	}

	public IEnumerator SetLetter(UserData userData, string message, Action<object> done)
	{
		if (userData.id != 0L)
		{
			WWWForm wWWForm = new WWWForm();
			wWWForm.AddField("id", userData.id.ToString());
			wWWForm.AddField("nickName", userData.nickName);
			wWWForm.AddField("message", message);
			wWWForm.AddField("language", userData.language);
			yield return StartCoroutine(setDatas(wWWForm, "setLetterData", done, 0));
		}
	}

	public IEnumerator SetFeedback(string method, int idx, Action<object> done)
	{
		WWWForm wWWForm = new WWWForm();
		wWWForm.AddField("method", method);
		wWWForm.AddField("idx", idx);
		yield return StartCoroutine(setDatas(wWWForm, "setLetterFeedback", done, 0));
	}

	private IEnumerator requestJson(WWWForm form, string api, Action<object> done, Action<object> done2 = null)
	{
		UnityWebRequest request = createPostRequest(api, form);
		yield return request.SendWebRequest();
		if (request.isNetworkError || request.isHttpError || request.responseCode != 200)
		{
			request.Dispose();
			done?.Invoke(null);
			done2?.Invoke(null);
			yield break;
		}
		JToken jToken = request.downloadHandler.text.ToJObject();
		int num = int.Parse(jToken["err_code"].ToString());
		JToken jToken2 = jToken["response"];
		if (num == 0 && done != null)
		{
			if (jToken2.Type == JTokenType.Null)
			{
				done(null);
				done2?.Invoke(null);
			}
			else
			{
				done(jToken2);
				done2?.Invoke(jToken2);
			}
		}
		request.Dispose();
	}

	private IEnumerator setDatas(WWWForm form, string api, Action<object> done, int currentTry)
	{
		UnityWebRequest request = createPostRequest(api, form);
		yield return request.SendWebRequest();
		if (request.isNetworkError || request.isHttpError || request.responseCode != 200)
		{
			UnityEngine.Debug.Log("[http error:" + request.responseCode + "]  - " + form.data.Length + ", " + api);
			request.Dispose();
			done?.Invoke(null);
			yield break;
		}
		JToken jToken = request.downloadHandler.text.ToJObject();
		UnityEngine.Debug.Log(api + ", response : " + jToken);
		JToken jToken2 = jToken["response"];
		if (done != null)
		{
			if (jToken2.Type == JTokenType.Null)
			{
				done(null);
			}
			else
			{
				done(jToken2);
			}
		}
		if (jToken != null)
		{
		}
		request.Dispose();
	}

	public void Upload(CloudCheckWindow checkWindow)
	{
		MonoBehaviour.print("Cloud Save");
		if (checkWindow != null)
		{
			this.checkWindow = checkWindow;
		}
		UserData userData = dataManager.userData;
		if (userData.id == 0L)
		{
			return;
		}
		StartCoroutine(Singleton<DBManager>.Instance.GetColumnNames(delegate(object s)
		{
			if (s == null)
			{
				this.checkWindow.Fail(1);
			}
			else
			{
				JArray source = s as JArray;
				columns = (from S in source.OfType<JObject>()
					select S.GetValue<string>("Field")).ToList();
				StartCoroutine(GetUserDataID(userData.id, delegate
				{
					StartCoroutine(SetUserData(userData, delegate(object response)
					{
						if (response == null)
						{
							if (this.checkWindow != null)
							{
								this.checkWindow.Fail(1);
							}
						}
						else if (this.checkWindow != null)
						{
							this.checkWindow.Success(CLOUDCHECKMODE.SAVE);
						}
					}));
				}));
			}
		}));
	}

	public IEnumerator Download(CloudCheckWindow checkWindow)
	{
		MonoBehaviour.print("Cloud Load");
		this.checkWindow = checkWindow;
		ulong id = dataManager.userData.id;
		bool fail = false;
		yield return StartCoroutine(GetUserData(id, delegate(object value)
		{
			if (value == null)
			{
				checkWindow.Fail(1);
				fail = true;
			}
			else if ((value as JArray).Count > 0)
			{
				MonoBehaviour.print(value);
				dataManager.ParseFromJObject(JArray.Parse(value.ToString()).OfType<JObject>().First());
			}
		}));
		if (!fail)
		{
			yield return new WaitForSeconds(1f);
			if (dataManager.userData.userLv == 15 && dataManager.userData.userExp > 1940)
			{
				dataManager.userData.userExp = 1940;
			}
			dataManager.SetExpBar();
			CreateDynamicData();
			yield return new WaitForSeconds(1f);
			dataManager.ReCaculateSharkReward();
			dataManager.Save();
			checkWindow.Success(CLOUDCHECKMODE.LOAD);
			yield return new WaitForSeconds(2f);
			staticLoading.Stage = SceneManager.GetActiveScene().name;
			SceneManager.LoadScene("Loading");
		}
	}

	private void CreateDynamicData()
	{
		List<DLC> nationItems = dataManager.ItemDatabase.dlcs;
		UserData userData = dataManager.userData;
		int num = 25;
		int num2 = 22;
		for (int i = 0; i < nationItems.Count; i++)
		{
			if (userData.nations.Count < nationItems.Count)
			{
				userData.nations.Add(new NationData
				{
					id = nationItems[i].nation.ID,
					name = nationItems[i].nation.ItemName,
					purchased = nationItems[i].purchased
				});
			}
			if (userData.rooms.Count < nationItems.Count)
			{
				userData.rooms.Add(new RoomList
				{
					nationName = nationItems[i].nation.ItemName
				});
			}
			int j;
			for (j = 0; j < nationItems[i].roomItems.Count; j++)
			{
				if (!userData.rooms[i].items.Any((RoomData s) => s.id == nationItems[i].roomItems[j].ID))
				{
					bool defaultItem = nationItems[i].roomItems[j].defaultItem;
					userData.rooms[i].items.Add(new RoomData
					{
						id = nationItems[i].roomItems[j].ID,
						name = nationItems[i].roomItems[j].ItemName,
						purchased = defaultItem
					});
				}
			}
			if (userData.fishes.Count < nationItems.Count)
			{
				userData.fishes.Add(new FishNationList
				{
					nationName = nationItems[i].dlcName
				});
			}
			if (userData.aquariums.Count < nationItems.Count)
			{
				userData.aquariums.Add(new AquariumRoomList
				{
					nationName = nationItems[i].nation.ItemName
				});
			}
			for (int l = 0; l < nationItems[i].fishItems.Count; l++)
			{
				if (userData.fishes[i].fishCount.Count < nationItems[i].fishItems.Count)
				{
					userData.fishes[i].fishCount.Add(0);
					userData.fishes[i].maxSize.Add(0f);
					userData.fishes[i].maxWeight.Add(0f);
				}
			}
			for (int m = 0; m < nationItems[i].roomItems.Count; m++)
			{
				if (userData.aquariums[i].rooms.Count < nationItems[i].roomItems.Count)
				{
					userData.aquariums[i].rooms.Add(new AquariumDataList
					{
						roomName = "Room_" + m
					});
				}
				int k;
				for (k = 0; k < nationItems[i].aquaItems.Count(); k++)
				{
					if (nationItems[i].aquaItems[k].nationId == i && nationItems[i].aquaItems[k].lobbyId == m && !userData.aquariums[i].rooms[m].items.Any((AquariumData s) => s.id == nationItems[i].aquaItems[k].ID))
					{
						bool defaultItem2 = nationItems[i].aquaItems[k].defaultItem;
						bool state = nationItems[i].aquaItems[k].state;
						userData.aquariums[i].rooms[m].items.Add(new AquariumData
						{
							id = nationItems[i].aquaItems[k].ID,
							name = nationItems[i].aquaItems[k].ItemName,
							purchased = defaultItem2,
							state = state
						});
					}
				}
				int num3 = 0;
				num3 = ((m != 0) ? num2 : num);
				for (int n = 0; n < num3; n++)
				{
					if (userData.aquariums[i].rooms[m].fishCount.Count < num3)
					{
						userData.aquariums[i].rooms[m].fishCount.Add(0);
					}
				}
			}
			if (userData.achievements.Count < nationItems.Count)
			{
				userData.achievements.Add(new AchieveNationList
				{
					nationName = nationItems[i].nation.ItemName
				});
			}
			for (int num4 = 0; num4 < dataManager.ItemDatabase.dlcs[i].achieveItems.Count(); num4++)
			{
				if (userData.achievements[i].achievement.Count < dataManager.ItemDatabase.dlcs[i].achieveItems.Count())
				{
					userData.achievements[i].achievement.Add(0);
					userData.achievements[i].grade.Add(0);
				}
			}
		}
	}
}
[Serializable]
public class DLC
{
	public string dlcName;

	public NationItem nation;

	public List<AquaItem> aquaItems;

	public List<AchieveItem> achieveItems;

	public List<StageItem> stageItems;

	public List<RoomItem> roomItems;

	public List<FurnitureItem> furnitureItems;

	public List<FishItem> fishItems;

	public bool purchased;
}
internal class HTMLTags
{
	public static string StripHTMLTags(string str)
	{
		return Regex.Replace(str, "<(.|\\n)*?>", string.Empty);
	}

	public static string StripHTMLTags(string str, string strAllowTag, string option)
	{
		if (option.ToLower().Contains('h'))
		{
			str = RemoveHeaderTitle(str);
		}
		if (option.ToLower().Contains('c'))
		{
			str = RemoveComment(str);
		}
		if (option.ToLower().Contains('s'))
		{
			str = Regex.Replace(str, "style=['|\"].*?['|\"]", string.Empty);
		}
		str = Regex.Replace(str, "<br>", Environment.NewLine);
		string text = string.Empty;
		string[] array = strAllowTag.Split(',');
		foreach (string text2 in array)
		{
			text = ((!string.IsNullOrEmpty(text)) ? (text + $"|{text2.ToLower().Trim()}[ />]|{text2.ToUpper().Trim()}[ />]") : $"{text2.ToLower().Trim()}[ />]|{text2.ToUpper().Trim()}[ />]");
		}
		string pattern = "</?(?(?=" + text + ")notag|[a-zA-Z0-9]+)(?:\\s[a-zA-Z0-9\\-]+=?(?:([\",']?).*?\\1?)?)*\\s*/?>";
		string text3 = Regex.Replace(str, pattern, string.Empty);
		if (option.ToLower().Contains('r'))
		{
			text3 = ReplaceSpecialString(text3);
		}
		return text3;
	}

	public static string GetAtagLink(string aTag)
	{
		return new Regex("[Hh][Rr][Ee][Ff]=['|\"](.*?)['|\"]").Match(aTag).Groups[1].Value;
	}

	private static string RemoveHeaderTitle(string str)
	{
		str = Regex.Replace(str, "<!DOCTYPE.*?>", string.Empty);
		str = Regex.Replace(str, "\\<([Tt][Ii][Tt][Ll][Ee])\\>.*?\\<\\/\\1\\>", string.Empty);
		return str;
	}

	public static string RemoveComment(string str)
	{
		return Regex.Replace(str, "<!--.*?-->", string.Empty, RegexOptions.Singleline);
	}

	public static string ReplaceHTMLSpecialChars(string str)
	{
		return Regex.Replace(str, "<([^<>]+)?>", "&lt;$1&gt;");
	}

	public static string ReplaceHTMLSpecialChars(string str, string strAllowTag)
	{
		string text = "<(\\/?)(?!\\/####)([^<|>]+)?>";
		string replacement = "&lt;$1$2&gt;";
		string[] array = strAllowTag.Split(',');
		StringBuilder stringBuilder = new StringBuilder();
		for (int i = 0; i < array.Length; i++)
		{
			stringBuilder.Append("|" + array[i].Trim() + "(?!\\w)");
		}
		text = text.Replace("####", stringBuilder.ToString());
		return Regex.Replace(str, text, replacement);
	}

	private static string ReplaceSpecialString(string str)
	{
		foreach (KeyValuePair<string, string> item in new Dictionary<string, string>
		{
			{ "&nbsp;", " " },
			{ "&lt;", "<" },
			{ "&gt;", ">" },
			{ "&amp;", "&" },
			{ "&quot;", "\"" },
			{ "&#8220;", "\"" },
			{ "&#8221;", "\"" },
			{ "&lsquo;", "'" },
			{ "&rsquo;", "'" },
			{ "&#8216;", "'" },
			{ "&middot;", "·" },
			{ "&#8228;", "·" },
			{ "&#8211;", "-" }
		})
		{
			str = str.Replace(item.Key, item.Value);
		}
		return str;
	}
}
[CreateAssetMenu]
public class ItemDatabase : ScriptableObject
{
	[Header("DLCS")]
	[SerializeField]
	public List<DLC> dlcs;

	[Header("TACKLES")]
	[SerializeField]
	public RodItem[] rodSItems;

	[SerializeField]
	public RodItem[] rodCItems;

	[SerializeField]
	public ReelItem[] reelSItems;

	[SerializeField]
	public ReelItem[] reelCItems;

	[SerializeField]
	public LureItem[] lureItems;

	[SerializeField]
	public LineItem[] lineItems;

	[SerializeField]
	public GloveItem[] gloveItems;

	[SerializeField]
	public BoatItem[] boatItems;

	public AnimalItem[] animalItems;

	[Header("PROPS")]
	public PropItem[] propItems;

	[Header("AVATAR")]
	[SerializeField]
	public Avatar[] avatars;
}
[CreateAssetMenu(menuName = "Items/LevelUp")]
public class LevelUpDatabase : ScriptableObject
{
	[SerializeField]
	public List<int> exps;

	public int GetExp(int level)
	{
		if (level < exps.Count)
		{
			return exps[level];
		}
		return 0;
	}
}
public class ListTackleObject : MonoBehaviour
{
	public enum tackleType
	{
		none,
		rod,
		reel,
		lure
	}

	public tackleType type;

	public control_item_rod[] rodSObjects;

	public control_item_rod[] rodCObjects;

	public control_item_reel[] reelSObjects;

	public control_item_reel[] reelCObjects;

	private int curRodID;

	private int curReelID;

	private control_item_rod curRodObject;

	private control_item_reel curReelObject;

	private void Start()
	{
	}

	public void CreateRod(bool isSpinning, int id, Transform transfromRod)
	{
		type = tackleType.rod;
		if (isSpinning)
		{
			curRodObject = UnityEngine.Object.Instantiate(rodSObjects[id], transfromRod.position, transfromRod.rotation);
		}
		else
		{
			curRodObject = UnityEngine.Object.Instantiate(rodCObjects[id], transfromRod.position, transfromRod.rotation);
		}
	}

	public void CreateReel(bool isSpinning, int id, Transform transfromReel)
	{
		type = tackleType.reel;
		if (isSpinning)
		{
			curReelObject = UnityEngine.Object.Instantiate(reelSObjects[id], transfromReel.position, transfromReel.rotation);
			curReelObject.ShowOnlyHandle(isRight: true);
		}
		else
		{
			curReelObject = UnityEngine.Object.Instantiate(reelCObjects[id], transfromReel.position, transfromReel.rotation);
			curReelObject.ShowOnlyHandle(isRight: true);
		}
	}

	public void DestroyTackle()
	{
		switch (type)
		{
		case tackleType.rod:
			if (curRodObject != null)
			{
				UnityEngine.Object.Destroy(curRodObject);
			}
			break;
		case tackleType.reel:
			if (curReelObject != null)
			{
				UnityEngine.Object.Destroy(curReelObject);
			}
			break;
		case tackleType.lure:
			break;
		}
	}
}
public class LoginManager : Singleton<LoginManager>
{
	public ulong userId;

	public string nickName = "";

	private bool successCheckEntitlement;

	public void SetOculusUserInfo(UserData userData)
	{
		userData.id = userId;
		userData.nickName = nickName;
	}

	public void CheckEntitlement()
	{
		try
		{
			Core.AsyncInitialize();
			Entitlements.IsUserEntitledToApplication().OnComplete(EntitlementCallback);
			UnityEngine.Debug.LogError("CheckEntitlement");
		}
		catch (UnityException exception)
		{
			UnityEngine.Debug.LogError("Platform failed to initialize due to exception.");
			UnityEngine.Debug.LogException(exception);
			UnityEngine.Application.Quit();
		}
	}

	private void EntitlementCallback(Message msg)
	{
		if (msg.IsError)
		{
			UnityEngine.Debug.LogError("You are NOT entitled to use this app.");
			UnityEngine.Application.Quit();
		}
		else
		{
			successCheckEntitlement = true;
			UnityEngine.Debug.Log("You are entitled to use this app.");
		}
	}

	public IEnumerator GetOculusID()
	{
		bool completed = false;
		if (UnityEngine.Application.platform == RuntimePlatform.Android || UnityEngine.Application.platform == RuntimePlatform.WindowsEditor)
		{
			Users.GetLoggedInUser().OnComplete(delegate(Message<User> s)
			{
				if (s.Data != null)
				{
					MonoBehaviour.print("Oculus 아이디 : " + s.Data.ID);
					userId = s.Data.ID;
					nickName = s.Data.OculusID;
				}
				completed = true;
			});
		}
		else
		{
			userId = ulong.Parse(StringExtension.RemoveSpecialCharacters(Network.LocalIPAddress()));
			nickName = SystemInfo.deviceName;
			MonoBehaviour.print("PC용 Oculus 아이디 : " + userId);
			completed = true;
		}
		while (!completed)
		{
			yield return null;
		}
		yield return true;
	}
}
[Serializable]
public class Notices
{
	public string title;

	public string content;
}
public class NoticeManager : MonoBehaviour
{
	private HtmlDocument doc;

	public Text title;

	public Text content;

	public List<Notices> notices = new List<Notices>();

	public ScrollRect scrollRect;

	public GameObject upArrow;

	public GameObject downArrow;

	private DataManager dataManager;

	[InspectorButton("MoveTop")]
	public bool moveTop;

	[InspectorButton("MoveBottom")]
	public bool moveBottom;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		doc = new HtmlDocument();
	}

	private void Start()
	{
		string url = "";
		OnlineCheck.Check(delegate(bool isConnected, NetworkReachability b)
		{
			if (isConnected)
			{
				if (MultiplayManager.Instance.isLive)
				{
					if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
					{
						url = "https://www.realvrfishing.com/notices_quest/";
					}
					else if (dataManager.targetPlatform == DEVICE_TYPE.GO)
					{
						url = "https://www.realvrfishing.com/notices_go/";
					}
					else if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
					{
						url = "https://www.realvrfishing.com/notices_rift/";
					}
				}
				else
				{
					url = "https://www.realvrfishing.com/notices_beta/";
				}
				StartCoroutine(GetRequest(url, delegate
				{
					upArrow.SetActive(value: true);
					downArrow.SetActive(value: true);
					scrollRect.Rebuild(CanvasUpdate.Layout);
				}));
			}
			else
			{
				base.gameObject.SetActive(value: false);
			}
		});
	}

	private IEnumerator GetRequest(string uri, Action<object> done)
	{
		using UnityWebRequest webRequest = UnityWebRequest.Get(uri);
		yield return webRequest.SendWebRequest();
		string[] array = uri.Split('/');
		int num = array.Length - 1;
		if (webRequest.isNetworkError)
		{
			UnityEngine.Debug.Log(array[num] + ": Error: " + webRequest.error);
			done?.Invoke(null);
			yield break;
		}
		doc.LoadHtml(webRequest.downloadHandler.text);
		foreach (HtmlNode item in (IEnumerable<HtmlNode>)doc.DocumentNode.SelectNodes("//div[contains(@class,'et_pb_accordion_item_')]"))
		{
			Notices notices = new Notices();
			notices.title = item.SelectNodes("//*[@class=\"et_pb_toggle_title\"]").First().InnerText;
			foreach (HtmlNode item2 in (IEnumerable<HtmlNode>)item.SelectNodes("//div[@class=\"et_pb_toggle_content clearfix\"]/p"))
			{
				notices.content += item2.OuterHtml;
				notices.content += Environment.NewLine;
				notices.content = HTMLTags.StripHTMLTags(notices.content, "", "r");
			}
			this.notices.Add(notices);
		}
		title.text = this.notices[0].title;
		content.text = this.notices[0].content;
		done?.Invoke("complete");
	}

	public void MoveTop()
	{
		scrollRect.verticalScrollbar.value += 0.1f;
	}

	public void MoveBottom()
	{
		scrollRect.verticalScrollbar.value -= 0.1f;
	}

	private void OnEnable()
	{
	}
}
[CreateAssetMenu(menuName = "Items/Tutorial Item")]
public class TutorialItem : ScriptableObject
{
	public int id;

	[TextArea(5, 5)]
	public string[] tutorialGoLanguages;

	[TextArea(5, 5)]
	public string[] tutorialQuestLanguages;

	[TextArea(5, 5)]
	public string[] tutorialRiftLanguages;

	public string imageFolderFileName;
}
public enum Languages
{
	English,
	French,
	Spanish,
	German,
	Korean,
	Japanese
}
public enum DEVICE_TYPE
{
	GO = 0,
	QUEST = 1,
	RIFT = 2,
	OTHERS = 100
}
[Serializable]
public class NationData
{
	public string name;

	public int id;

	public bool purchased;
}
[Serializable]
public class RoomList
{
	public string nationName;

	public List<RoomData> items = new List<RoomData>();
}
[Serializable]
public class RoomData
{
	public string name;

	public int id;

	public bool purchased;
}
[Serializable]
public class FurnitureRoomList
{
	public string nationName;

	public List<FurnitureDataList> rooms = new List<FurnitureDataList>();
}
[Serializable]
public class FurnitureDataList
{
	public string roomName;

	public List<FurnitureData> items = new List<FurnitureData>();
}
[Serializable]
public class FurnitureData
{
	public string name;

	public int id;

	public bool purchased;

	public bool state;
}
[Serializable]
public class AquariumRoomList
{
	public string nationName;

	public List<AquariumDataList> rooms = new List<AquariumDataList>();
}
[Serializable]
public class AquariumDataList
{
	public string roomName;

	public List<AquariumData> items = new List<AquariumData>();

	public List<int> fishCount = new List<int>();
}
[Serializable]
public class AquariumData
{
	public string name;

	public int id;

	public bool purchased;

	public bool state;
}
[Serializable]
public class FishNationList
{
	public string nationName;

	public List<int> fishCount = new List<int>();

	public List<float> maxSize = new List<float>();

	public List<float> maxWeight = new List<float>();
}
[Serializable]
public class AchieveNationList
{
	public string nationName;

	public List<int> achievement = new List<int>();

	public List<int> grade = new List<int>();
}
[Serializable]
public class AnimalData
{
	public string name;

	public int id;

	public bool purchased;

	public bool state;
}
[Serializable]
public class PropData
{
	public int id;

	public int count = 1;
}
[Serializable]
public class AvatarData
{
	public int curFaceShape;

	public int curFaceColor;

	public int curAge;

	public int curEyeColor;

	public int curHairShape = 1;

	public int curHairColor;

	public int curMustacheShape;

	public int curMustacheColor;

	public int curEyebrowShape;

	public int curEyebrowColor;

	public int curInnerfit;

	public int curInnerfitColor;

	public int curOuterfit;

	public int curOuterfitColor;

	public int curHat;

	public int curGlasses;

	public List<int> innerfits = new List<int>();

	public List<int> outfits = new List<int>();

	public List<int> hats = new List<int>();

	public List<int> glasses = new List<int>();

	public List<int> watches = new List<int>();

	public List<int> gloves = new List<int>();
}
[Serializable]
public class UserData
{
	public string version;

	[Header("User Info")]
	public string nickName;

	public ulong id;

	public int userLv = 1;

	public int userExp;

	public int userGold;

	[NonDB]
	public string lastConnect;

	[NonDB]
	public int userConnectedCount;

	[NonDB]
	public int playtime;

	public int curRodS;

	public int curRodC;

	public int curReelS;

	public int curReelC;

	public int curLure;

	public int curLine;

	public int curType;

	public int curGlove;

	[DataVersion("1.195")]
	public int curBoat = -1;

	public int curNation;

	public List<int> rodS = new List<int> { 0 };

	public List<int> rodC = new List<int>();

	public List<int> rodSDurability = new List<int> { 0 };

	public List<int> rodCDurability = new List<int> { 0 };

	public List<int> reelS = new List<int> { 0 };

	public List<int> reelC = new List<int>();

	public List<int> reelSDurability = new List<int> { 0 };

	public List<int> reelCDurability = new List<int> { 0 };

	public List<int> lure = new List<int> { 0 };

	public List<int> lureDurability = new List<int> { 0 };

	public List<int> line = new List<int> { 0 };

	public List<int> lineDurability = new List<int> { 0 };

	public List<int> gloves = new List<int> { 0 };

	[DataVersion("1.195")]
	public List<int> boats = new List<int>();

	public List<int> spotCount = new List<int>();

	public int fishTotal;

	public int season;

	public int totalScore;

	[NonDB]
	public List<int> seasonRank = new List<int>();

	[NonDB]
	public int selectedAudioNumber = -1;

	[NonDB]
	public float selectedAudioTime = -1f;

	[NonDB]
	public bool playOn;

	[NonDB]
	public bool loopOn;

	[NonDB]
	public bool shuffleOn;

	[Header("Settings")]
	[NonDB]
	public int volumeMusic = 7;

	[NonDB]
	public int volumeAmbient = 7;

	[NonDB]
	public int graphicQuality = 2;

	[NonDB]
	public bool bFrameRateHigh = true;

	public int gameDifficulty;

	[NonDB]
	public int walkCabin;

	[NonDB]
	public int rotateCabin;

	public bool rightHand = true;

	public bool bothHand = true;

	[NonDB]
	public int deviceType = 2;

	[NonDB]
	public SerializableVector3 position;

	public int language;

	[NonDB]
	public int cabinTime;

	[NonDB]
	public int controlType;

	public int unit;

	[NonDB]
	public bool lineEfffect = true;

	[DataVersion("1.190")]
	public List<NationData> nations = new List<NationData>();

	public List<RoomList> rooms = new List<RoomList>();

	public List<FurnitureRoomList> furnitures = new List<FurnitureRoomList>();

	public List<AquariumRoomList> aquariums = new List<AquariumRoomList>();

	public List<FishNationList> fishes = new List<FishNationList>();

	public List<AchieveNationList> achievements = new List<AchieveNationList>();

	[NonDB]
	public List<AnimalData> animals = new List<AnimalData>
	{
		new AnimalData
		{
			name = "SEA TURTLE",
			purchased = false,
			state = false
		}
	};

	[NonDB]
	public bool autoSave;

	[Header("FloatingMenu")]
	[NonDB]
	public List<float> transparentLodges = new List<float> { 0f, 0f };

	[NonDB]
	public float transparentStage = 0.7f;

	[NonDB]
	public List<float> scaleLodges = new List<float> { 0.001f, 0.001f };

	[NonDB]
	public float scaleStage = 0.001f;

	[NonDB]
	public List<float> distanceLodges = new List<float> { 1.2f, 1.2f };

	[NonDB]
	public float distanceStage = 1.2f;

	[NonDB]
	public List<SerializableVector3> directionLodges = new List<SerializableVector3>
	{
		new SerializableVector3(0f, 0f, 0f),
		new SerializableVector3(0f, 0f, 0f)
	};

	[NonDB]
	public SerializableVector3 directionStage = new SerializableVector3(0f, -45f, 0f);

	[NonDB]
	public List<SerializableVector3> positionLodges = new List<SerializableVector3>
	{
		new SerializableVector3(0f, 1f, -0.5f),
		new SerializableVector3(1.6f, 1.3f, 2.7f)
	};

	[NonDB]
	public SerializableVector3 positionStage = new SerializableVector3(0f, 1.2f, 0f);

	[NonDB]
	public List<bool> lockLodges = new List<bool> { false, false };

	[NonDB]
	public bool lockStage;

	[NonDB]
	public bool isMediaOn;

	[NonDB]
	public int mediaState;

	[NonDB]
	public List<string> favorites = new List<string>();

	[NonDB]
	public bool ignoreTutorial;

	[NonDB]
	public bool ignoreInfoMusic;

	[NonDB]
	public bool ignoreInfoWeb;

	[NonDB]
	public List<PropData> props = new List<PropData>();

	[NonDB]
	public List<int> inventorySlots = new List<int>();

	[NonDB]
	public int curGender;

	[NonDB]
	public List<AvatarData> avatars = new List<AvatarData>();

	[NonDB]
	public bool isUserInfoVisible = true;

	[NonDB]
	public bool isPushToTalk;

	[NonDB]
	public string serverRegion = "usw";
}
public class VersionManager : Singleton<VersionManager>
{
	public string version;

	private readonly string[] oldVersions = new string[4] { "0.04", "0.05", "0.06", "0.07" };

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
	}

	public bool ExistsLocalFile()
	{
		string path = UnityEngine.Application.persistentDataPath + "/Saves/" + dataManager.saveFilename;
		if (File.Exists(path))
		{
			if (!string.IsNullOrEmpty(File.ReadAllText(path)))
			{
				return true;
			}
			return false;
		}
		return false;
	}

	public IEnumerator DeleteAllBetaData()
	{
		try
		{
			string[] array = oldVersions;
			foreach (string text in array)
			{
				if (File.Exists(UnityEngine.Application.persistentDataPath + "/Saves/userData_" + text + ".json"))
				{
					File.Delete(UnityEngine.Application.persistentDataPath + "/Saves/userData_" + text + ".json");
				}
			}
		}
		catch (Exception message)
		{
			MonoBehaviour.print(message);
		}
		yield return true;
	}

	public IEnumerator DeleteCurrentData()
	{
		if (File.Exists(UnityEngine.Application.persistentDataPath + "/Saves/" + dataManager.saveFilename))
		{
			File.Delete(UnityEngine.Application.persistentDataPath + "/Saves/" + dataManager.saveFilename);
		}
		yield return true;
	}

	public IEnumerator DeleteCurrentDataWithLoadScene()
	{
		if (File.Exists(UnityEngine.Application.persistentDataPath + "/Saves/" + dataManager.saveFilename))
		{
			File.Delete(UnityEngine.Application.persistentDataPath + "/Saves/" + dataManager.saveFilename);
		}
		Singleton<MediaController>.Instance.DestroyWebView();
		yield return new WaitForSeconds(1f);
		UnityEngine.Object.Destroy(Singleton<MediaController>.Instance.gameObject);
		UnityEngine.Object.Destroy(dataManager.gameObject);
		UnityEngine.Object.Destroy(UnityEngine.Object.FindObjectOfType<CallbackRunner>().gameObject);
		SceneManager.LoadScene(0);
		yield return true;
	}
}
public class GamePanelMove : MonoBehaviour
{
}
public class getPosition : MonoBehaviour
{
	public Transform getPos;

	private void Start()
	{
	}

	private void LateUpdate()
	{
		base.transform.position = getPos.position;
	}
}
public class getTrackRot : MonoBehaviour
{
	public Transform tracker;

	public float addAngle = 30f;

	public float Xrot;

	public float Yrot;

	public float Zrot;

	private void Start()
	{
	}

	private void FixedUpdate()
	{
		float num = tracker.localEulerAngles.z + addAngle;
		base.transform.localRotation = Quaternion.Euler(num * Xrot, num * Yrot, num * Zrot);
	}
}
public class goodPointScript : MonoBehaviour
{
	public enum eFishMoveState
	{
		ready,
		wander,
		follow,
		followWander,
		runaway,
		bite
	}

	private control_gpoint gpControl;

	private control_fishFinder finderControl;

	private control_tackle tackleCon;

	private control_envrionment envControl;

	private control_Fishing fishingControl;

	private control_Lure lureControl;

	public bool isFish;

	public float lureAttact = 10f;

	public int GpGrade;

	public int fishID;

	[HideInInspector]
	public bool bAttracting;

	public GameObject uiObj;

	public Image fishRadar;

	private float fishIconScale;

	public float moveLimit = 5f;

	public float moveTime = 2f;

	public float swimSpeed = 1f;

	public float rotationSpeed = 1f;

	private Vector3 oriPos;

	private Vector3 randomPos;

	public GameObject uiFish;

	private IEnumerator moveCoroutine;

	public eFishMoveState fishMoveState = eFishMoveState.wander;

	private float attractPoint;

	[HideInInspector]
	public float attractPointMax;

	private int attractionPower;

	private float distanceLure;

	private float targetFishSpeed = 1f;

	private float distanceFromOriPos;

	private float distanceFromPlayer;

	private Vector3 lurePos;

	public fishSetScript fishSet;

	[HideInInspector]
	public bool bEnableHookset;

	private bool attractStart;

	private Vector3 attractStartPosition = Vector3.zero;

	public Renderer fishRenderer;

	private AudioSource audios;

	private float fishStayTime;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		gpControl = main.gpointControl;
		envControl = main.envControl;
		finderControl = main.finderControl;
		tackleCon = main.tackleControl;
		lureControl = main.lureControl;
		fishingControl = main.fishingControl;
		moveCoroutine = moveRandom();
		if (isFish)
		{
			StartCoroutine(moveCoroutine);
		}
		oriPos = base.transform.position;
		base.transform.rotation = Quaternion.Euler(0f, UnityEngine.Random.Range(-180, 180), 0f);
		audios = GetComponent<AudioSource>();
		uiObj.SetActive(value: false);
	}

	private void Start()
	{
		setAttractPoint();
	}

	public void setAttractPoint()
	{
		if (isFish)
		{
			if (!main.useTutorial)
			{
				attractPoint = (6f - (float)tackleCon.getLureAttraction(fishID)) * UnityEngine.Random.Range(0.8f, 1.2f);
			}
			else
			{
				attractPoint = main.tutoControl.tutoFishLureAttract;
			}
		}
		else
		{
			attractPoint = 0.5f;
		}
		attractStartPosition = oriPos;
	}

	private void Update()
	{
		switch (fishingControl.gameState)
		{
		case control_Fishing.EfishingState.ready:
			fishMoveState = eFishMoveState.wander;
			fishMove();
			if (isFish)
			{
				fishRadarMove();
			}
			bEnableHookset = false;
			break;
		case control_Fishing.EfishingState.casting:
			fishMove();
			break;
		case control_Fishing.EfishingState.retrieve:
		{
			fishStayTime += Time.deltaTime;
			lurePos = lureControl.transform.position;
			distanceLure = Vector3.Distance(lurePos, new Vector3(base.transform.position.x, lurePos.y, base.transform.position.z));
			distanceFromOriPos = (attractStartPosition - base.transform.position).sqrMagnitude;
			distanceFromPlayer = new Vector3(base.transform.position.x, base.transform.position.z, 0f).sqrMagnitude;
			int num = ((!isFish) ? 6 : tackleCon.getLureAttraction(fishID));
			if (distanceFromPlayer < gpControl.fishLimitDistFromPlayer * gpControl.fishLimitDistFromPlayer)
			{
				runaway();
			}
			else if (distanceFromOriPos > gpControl.fishMaxDisFromOri * gpControl.fishMaxDisFromOri)
			{
				if (!bAttracting)
				{
					runaway();
				}
			}
			else if (fishMoveState != eFishMoveState.runaway && num != 0)
			{
				if (distanceLure < tackleCon.getLureRange())
				{
					if (!attractStart)
					{
						attractStart = true;
						attractStartPosition = base.transform.position;
					}
					if (distanceLure < gpControl.lureCatchDis)
					{
						bAttracting = true;
						if (fishingControl.attractedFish == null && !bEnableHookset)
						{
							fishMoveState = eFishMoveState.followWander;
							if (fishingControl.bReeling)
							{
								attractPoint -= Time.deltaTime;
							}
							else
							{
								attractPoint -= Time.deltaTime * 0.2f;
							}
							if (attractPoint < 0f)
							{
								if (!audios.isPlaying)
								{
									audios.Play();
								}
								fishMoveState = eFishMoveState.bite;
								bEnableHookset = true;
								fishingControl.fishCatchLure(this, isFish);
							}
						}
						else
						{
							fishMoveState = eFishMoveState.follow;
						}
					}
					else
					{
						fishMoveState = eFishMoveState.follow;
						if (fishingControl.attractedFish == null)
						{
							bAttracting = false;
							if (bEnableHookset)
							{
								fishingControl.attractedFish = null;
							}
							bEnableHookset = false;
						}
					}
				}
				else
				{
					bAttracting = false;
					bEnableHookset = false;
				}
			}
			fishMove();
			break;
		}
		default:
			uiObj.SetActive(value: false);
			break;
		}
	}

	private void fishMove()
	{
		switch (fishMoveState)
		{
		case eFishMoveState.wander:
			fishWander();
			break;
		case eFishMoveState.follow:
			fishFollow();
			break;
		case eFishMoveState.followWander:
			fishFollowWander();
			break;
		case eFishMoveState.bite:
			fishBite();
			break;
		case eFishMoveState.runaway:
			fishRunaway();
			break;
		case eFishMoveState.ready:
			break;
		}
	}

	private void fishWander()
	{
		Vector3 vector = oriPos + randomPos;
		Vector3 vector2 = new Vector3(vector.x, 0f, vector.z) - new Vector3(base.transform.position.x, 0f, base.transform.position.z);
		if ((base.transform.position - vector).sqrMagnitude > 1f)
		{
			targetFishSpeed = Mathf.Lerp(targetFishSpeed, gpControl.fishSwimSpeed * swimSpeed, Time.deltaTime);
		}
		else
		{
			targetFishSpeed = Mathf.Lerp(targetFishSpeed, 0f, Time.deltaTime);
		}
		base.transform.Translate(Vector3.forward * Time.deltaTime * targetFishSpeed);
		Quaternion identity = Quaternion.identity;
		if (vector2 != Vector3.zero)
		{
			identity = Quaternion.LookRotation(vector2);
			base.transform.rotation = Quaternion.Slerp(base.transform.rotation, identity, Time.deltaTime * rotationSpeed * targetFishSpeed);
		}
	}

	private void fishFollow()
	{
		targetFishSpeed = Mathf.Lerp(targetFishSpeed, gpControl.fishSwimSpeed * swimSpeed * 2f, Time.deltaTime);
		Vector3 vector = lurePos;
		Vector3 vector2 = new Vector3(vector.x, 0f, vector.z) - new Vector3(base.transform.position.x, 0f, base.transform.position.z);
		base.transform.position = Vector3.MoveTowards(base.transform.position, new Vector3(vector.x, base.transform.position.y, vector.z), Time.deltaTime * targetFishSpeed);
		Quaternion identity = Quaternion.identity;
		if (vector2 != Vector3.zero)
		{
			identity = Quaternion.LookRotation(vector2);
			base.transform.rotation = Quaternion.Slerp(base.transform.rotation, identity, Time.deltaTime * rotationSpeed * 2f);
		}
	}

	private void fishFollowWander()
	{
		targetFishSpeed = Mathf.Lerp(targetFishSpeed, gpControl.fishSwimSpeed * swimSpeed * 0.1f, Time.deltaTime);
		float num = Mathf.Sin(Time.time);
		Vector3 vector = lurePos + new Vector3(num, 0f, num);
		Vector3 vector2 = new Vector3(vector.x, 0f, vector.z) - new Vector3(base.transform.position.x, 0f, base.transform.position.z);
		base.transform.position = Vector3.MoveTowards(base.transform.position, new Vector3(vector.x, base.transform.position.y, vector.z), Time.deltaTime * targetFishSpeed);
		Quaternion identity = Quaternion.identity;
		if (vector2 != Vector3.zero)
		{
			identity = Quaternion.LookRotation(vector2);
			base.transform.rotation = Quaternion.Slerp(base.transform.rotation, identity, Time.deltaTime * rotationSpeed * 3f);
		}
	}

	private void fishRunaway()
	{
		targetFishSpeed = Mathf.Lerp(targetFishSpeed, gpControl.fishRunawaySpeed * swimSpeed * 2f, Time.deltaTime * 2f);
		Vector3 vector = oriPos;
		base.transform.position = Vector3.MoveTowards(base.transform.position, new Vector3(vector.x, base.transform.position.y, vector.z), Time.deltaTime * targetFishSpeed);
		Vector3 vector2 = new Vector3(vector.x, 0f, vector.z) - new Vector3(base.transform.position.x, 0f, base.transform.position.z);
		Quaternion identity = Quaternion.identity;
		if (vector2 != Vector3.zero)
		{
			identity = Quaternion.LookRotation(vector2);
			base.transform.rotation = Quaternion.Slerp(base.transform.rotation, identity, Time.deltaTime * rotationSpeed * 3f);
		}
	}

	private void fishBite()
	{
		targetFishSpeed = Mathf.Lerp(targetFishSpeed, gpControl.fishSwimSpeed * swimSpeed * 2f, Time.deltaTime * 2f);
		Vector3 vector = lurePos;
		base.transform.position = Vector3.MoveTowards(base.transform.position, new Vector3(vector.x, base.transform.position.y, vector.z), Time.deltaTime * targetFishSpeed * 2f);
		Vector3 vector2 = new Vector3(vector.x, 0f, vector.z) - new Vector3(base.transform.position.x, 0f, base.transform.position.z);
		Quaternion identity = Quaternion.identity;
		if (vector2 != Vector3.zero)
		{
			identity = Quaternion.LookRotation(vector2);
			base.transform.rotation = Quaternion.Slerp(base.transform.rotation, identity, Time.deltaTime * rotationSpeed);
		}
	}

	public void fishReset()
	{
		bAttracting = false;
		bEnableHookset = false;
		fishMoveState = eFishMoveState.ready;
		uiObj.SetActive(value: false);
		attractStart = false;
		base.transform.position = oriPos;
		base.transform.rotation = Quaternion.identity;
		setAttractPoint();
		targetFishSpeed = 1f;
		if (fishStayTime > gpControl.gpStayTime)
		{
			destory();
		}
	}

	public void destory()
	{
		gpControl.createGP(first: false);
		gpControl.deleteFish(GetComponent<goodPointScript>());
	}

	private IEnumerator moveRandom()
	{
		while (true)
		{
			randomPos = new Vector3(UnityEngine.Random.Range(0f - moveLimit, moveLimit), 0f, UnityEngine.Random.Range(0f - moveLimit, moveLimit));
			yield return new WaitForSeconds(UnityEngine.Random.Range(moveTime, moveTime));
		}
	}

	public void runaway()
	{
		if (fishMoveState == eFishMoveState.follow || fishMoveState == eFishMoveState.followWander || fishMoveState == eFishMoveState.bite)
		{
			fishMoveState = eFishMoveState.runaway;
			StartCoroutine(fishRunBack());
		}
	}

	private IEnumerator fishRunBack()
	{
		setAttractPoint();
		bAttracting = false;
		bEnableHookset = false;
		while ((base.transform.position - oriPos).sqrMagnitude > 0.010000001f)
		{
			yield return new WaitForSeconds(0.1f);
		}
		targetFishSpeed = gpControl.fishSwimSpeed * swimSpeed;
		fishMoveState = eFishMoveState.wander;
	}

	public void lureCheck(int currentNum)
	{
		int num = ((!isFish) ? 6 : tackleCon.getLureAttraction(fishID));
		fishRenderer.material.SetColor("_Color", gpControl.lureAttractionColor[num]);
		if (fishRadar != null)
		{
			fishRadar.color = gpControl.lureAttractionColor[num];
		}
	}

	public void fishShow()
	{
		uiObj.SetActive(value: true);
		if (!main.useTutorial)
		{
			lureCheck(dataManager.userData.curLure);
		}
		else
		{
			lureCheck(main.tutoControl.curTutoLure);
		}
	}

	public void fishHide()
	{
		uiObj.SetActive(value: false);
		base.transform.position = oriPos;
	}

	public void fishRadarSet()
	{
		fishRadar = UnityEngine.Object.Instantiate(gpControl.gpRadarImage, Vector3.zero, Quaternion.identity);
		fishRadar.transform.SetParent(finderControl.radarPivot.transform);
		fishRadar.transform.localPosition = new Vector3(base.transform.position.x, base.transform.position.z, 0f) * gpControl.radarPosScale;
		fishRadar.transform.localRotation = Quaternion.identity;
		fishRadar.transform.localScale = Vector3.one * gpControl.radarIconScale;
		switch (GpGrade)
		{
		case 1:
			fishRadar.sprite = gpControl.gpRadar1;
			break;
		case 2:
			fishRadar.sprite = gpControl.gpRadar2;
			break;
		case 3:
			fishRadar.sprite = gpControl.gpRadar3;
			break;
		case 4:
			fishRadar.sprite = gpControl.gpRadar4;
			break;
		}
		if (!main.useTutorial)
		{
			lureCheck(dataManager.userData.curLure);
		}
		else
		{
			lureCheck(main.tutoControl.curTutoLure);
		}
	}

	private void fishRadarMove()
	{
		fishRadar.transform.localPosition = new Vector3(base.transform.position.x, base.transform.position.z, 0f) * gpControl.radarPosScale;
		fishRadar.transform.localRotation = Quaternion.Euler(0f, 0f, 0f - finderControl.transform.eulerAngles.y);
		float num = Vector3.Angle(fishRadar.transform.localPosition, Vector3.right);
		float num2 = finderControl.transform.eulerAngles.y;
		if (num2 > 180f)
		{
			num2 = finderControl.transform.eulerAngles.y - 360f;
		}
		num2 = 0f - (num2 - 90f);
		float num3 = num - num2;
		if (num3 > 60f || num3 < -60f)
		{
			fishRadar.enabled = false;
		}
		else
		{
			fishRadar.enabled = true;
		}
	}
}
public class graphFishsize : MonoBehaviour
{
	public float size;

	public AnimationClip aniClip;

	public float getSize(float time)
	{
		aniClip.SampleAnimation(base.gameObject, time);
		return size;
	}
}
public class hapticCaution : MonoBehaviour
{
	public control_handselect handControl;

	public bool stressState = true;

	public float hapticCycleTime = 0.3f;

	public float hapticPower = 0.5f;

	private IEnumerator cHaptic;

	private void Awake()
	{
		cHaptic = hatic();
	}

	private void Start()
	{
	}

	private void OnEnable()
	{
		StartCoroutine(cHaptic);
	}

	private void OnDisable()
	{
		StopCoroutine(cHaptic);
	}

	private IEnumerator hatic()
	{
		while (true)
		{
			handControl.haptic(0.05f, hapticPower, isMainhand: true);
			yield return new WaitForSeconds(hapticCycleTime);
		}
	}
}
public class ammo : MonoBehaviour
{
	public float ammoSpeed;

	public float bulletLiveTime = 1f;

	public bool isLaser;

	private float tempLiveTimeCheck;

	private Rigidbody rb;

	private bulletShoot getBulletShoot;

	private bool isShoot;

	private void Awake()
	{
		rb = GetComponent<Rigidbody>();
	}

	private void OnEnable()
	{
		tempLiveTimeCheck = 0f;
		isShoot = true;
	}

	private void FixedUpdate()
	{
		if (isShoot)
		{
			rb.AddForce(base.transform.up * ammoSpeed, ForceMode.Impulse);
			isShoot = false;
		}
		if (bulletLiveTime <= 0f)
		{
			UnityEngine.Debug.Log("Bullet LiveTime cannot be less than 0");
			return;
		}
		tempLiveTimeCheck += Time.deltaTime;
		if (tempLiveTimeCheck > bulletLiveTime)
		{
			Reset();
		}
	}

	private void OnCollisionEnter(Collision collision)
	{
		if (isLaser)
		{
			Reset();
		}
	}

	private void Reset()
	{
		tempLiveTimeCheck = 0f;
		rb.velocity = Vector3.zero;
		rb.angularVelocity = Vector3.zero;
		base.gameObject.SetActive(value: false);
	}
}
public class AvatarFlipCopyMirrorDummy : MonoBehaviour
{
	public float mirrorXPivot = 3.0732f;

	public float wallOffsetForHands = -0.03f;

	public GameObject mirrorDummyAvatarPrefab;

	private Transform rootFotAvatarTrans;

	private Transform centerEyeAnchorTrans;

	private GameObject[] avatarHands;

	public GameObject avatarBody_duplicated;

	private GameObject[] avatarHands_duplicated;

	private GameObject OVRCamRig;

	private GameObject avaterHandLAnchor;

	private GameObject avaterHandRAnchor;

	private Vector3 curSpeed = Vector3.zero;

	private int interval;

	private void Awake()
	{
		GameObject[] array = GameObject.FindGameObjectsWithTag("MainCamera");
		for (int i = 0; i < array.Length; i++)
		{
			if (array[i].name == "CenterEyeAnchor")
			{
				centerEyeAnchorTrans = array[i].transform;
			}
		}
		CreateHand();
	}

	private void CreateHand()
	{
		HandState[] array = new HandState[2];
		array = base.transform.root.GetComponentsInChildren<HandState>();
		avatarHands = new GameObject[2];
		avatarHands[0] = array[0].gameObject;
		avatarHands[1] = array[1].gameObject;
		avatarHands[0].transform.parent = avatarHands[0].transform.root.transform;
		avatarHands[1].transform.parent = avatarHands[1].transform.root.transform;
		avatarHands_duplicated = new GameObject[2];
		avatarHands_duplicated[0] = UnityEngine.Object.Instantiate(avatarHands[0], base.transform.root.transform);
		avatarHands_duplicated[0].name = "AvatarHandL_Duplicated";
		avatarHands_duplicated[0].layer = LayerMask.NameToLayer("DummyAvatar");
		avatarHands_duplicated[1] = UnityEngine.Object.Instantiate(avatarHands[1], base.transform.root.transform);
		avatarHands_duplicated[1].name = "AvatarHandR_Duplicated";
		avatarHands_duplicated[1].layer = LayerMask.NameToLayer("DummyAvatar");
		avatarHands_duplicated[0].transform.localScale = new Vector3(1f, 1f, 1f);
		avatarHands_duplicated[1].transform.localScale = new Vector3(-1f, 1f, 1f);
		OVRCamRig = GameObject.Find("OVRCameraRig");
		avaterHandLAnchor = GameObject.Find("LeftHandAnchor");
		avaterHandRAnchor = GameObject.Find("RightHandAnchor");
		interval = 1;
	}

	private void Start()
	{
		CreateMirrorAvatar();
	}

	private void Update()
	{
		if (Time.frameCount % interval == 0)
		{
			float y = OVRCamRig.transform.localEulerAngles.y;
			float num = mirrorXPivot - centerEyeAnchorTrans.position.x;
			float y2 = centerEyeAnchorTrans.localEulerAngles.y;
			avatarBody_duplicated.transform.position = new Vector3(num + mirrorXPivot, centerEyeAnchorTrans.position.y, centerEyeAnchorTrans.position.z);
			avatarBody_duplicated.transform.rotation = Quaternion.Euler(new Vector3(0f - centerEyeAnchorTrans.rotation.eulerAngles.x, 0f, centerEyeAnchorTrans.rotation.eulerAngles.z) + new Vector3(0f, 0f - y2 - y + 180f, 0f));
			float num2 = mirrorXPivot - avatarHands[0].transform.position.x;
			float num3 = mirrorXPivot - avatarHands[1].transform.position.x;
			float x = Mathf.Clamp(avaterHandLAnchor.transform.position.x, avaterHandLAnchor.transform.position.x, mirrorXPivot + wallOffsetForHands - 0.08f);
			float x2 = Mathf.Clamp(avaterHandRAnchor.transform.position.x, avaterHandRAnchor.transform.position.x, mirrorXPivot + wallOffsetForHands - 0.08f);
			avatarHands[0].transform.position = new Vector3(x, avaterHandLAnchor.transform.position.y, avaterHandLAnchor.transform.position.z);
			avatarHands[1].transform.position = new Vector3(x2, avaterHandRAnchor.transform.position.y, avaterHandRAnchor.transform.position.z);
			avatarHands[0].transform.rotation = avaterHandLAnchor.transform.rotation;
			avatarHands[1].transform.rotation = avaterHandRAnchor.transform.rotation;
			avatarHands_duplicated[0].transform.position = new Vector3(num2 + mirrorXPivot, avatarHands[0].transform.position.y, avatarHands[0].transform.position.z);
			avatarHands_duplicated[1].transform.position = new Vector3(num3 + mirrorXPivot, avatarHands[1].transform.position.y, avatarHands[1].transform.position.z);
			float y3 = avatarHands[0].transform.localEulerAngles.y;
			float y4 = avatarHands[1].transform.localEulerAngles.y;
			avatarHands_duplicated[0].transform.rotation = Quaternion.Euler(new Vector3(avatarHands[0].transform.rotation.eulerAngles.x, 0f, 0f - avatarHands[0].transform.rotation.eulerAngles.z) + new Vector3(0f, 0f - y3, 0f));
			avatarHands_duplicated[1].transform.rotation = Quaternion.Euler(new Vector3(avatarHands[1].transform.rotation.eulerAngles.x, 0f, 0f - avatarHands[1].transform.rotation.eulerAngles.z) + new Vector3(0f, 0f - y4, 0f));
		}
	}

	private void CreateMirrorAvatar()
	{
		_ = centerEyeAnchorTrans.gameObject.GetComponentInChildren<AvatarRigCTRL>().gameObject;
		avatarBody_duplicated = UnityEngine.Object.Instantiate(mirrorDummyAvatarPrefab, base.transform.root.transform);
		avatarBody_duplicated.GetComponent<DummyAvatar>().InitAvatar();
		avatarBody_duplicated.transform.localScale = new Vector3(1f, 1f, -1f);
		if ((bool)avatarBody_duplicated.GetComponentInChildren<AvatarRigCTRL>())
		{
			avatarBody_duplicated.GetComponentInChildren<AvatarRigCTRL>().isInvertRotation = true;
			avatarBody_duplicated.GetComponentInChildren<AvatarRigCTRL>().dir = new Vector3(0f, 0f, -1f);
		}
		centerEyeAnchorTrans.GetComponentInChildren<Camera>().nearClipPlane = 0.1f;
		avatarBody_duplicated.layer = LayerMask.NameToLayer("DummyAvatar");
		Transform[] componentsInChildren = avatarBody_duplicated.transform.GetComponentsInChildren<Transform>(includeInactive: true);
		for (int i = 0; i < componentsInChildren.Length; i++)
		{
			componentsInChildren[i].gameObject.layer = LayerMask.NameToLayer("DummyAvatar");
		}
	}
}
public class AvatarRigCTRL : MonoBehaviour
{
	public float testRot;

	public Transform headBone;

	public Transform[] eyeRootsLeftRight = new Transform[2];

	public float eyeLookAtDistanceMult = 1f;

	public float eyeLookatHorizontalOffset;

	public float bodyRotationSpeed = 5f;

	public Transform neckBone;

	public Transform bodyBone;

	[HideInInspector]
	public bool isInvertRotation;

	private bool isInvertRotation_Stored;

	public float eyeOffTimeMin = 0.3f;

	public float eyeOffTimeMax = 0.8f;

	public float eyeStayTimeMin = 1.6f;

	public float eyeStayTimeMax = 3f;

	public bool isEyeOffTarget;

	private float eyeStayTimeCount;

	private float eyeOffTimeCount;

	private Vector3 randomVec = Vector3.zero;

	private int getRandomCheck;

	private bool isEyeOfftargeting;

	private GameObject eyeLookAtTarget;

	private Ray eyeTargetRay;

	private RaycastHit eyeTargetHitInfo;

	private Vector3 eyeLookAtTargetDefualtPos;

	private float lerpTimeToOri;

	private float lerpTimeToTarget;

	private bool isEyeNotRotate;

	public float eyesOffTargetAmount = 1f;

	public bool isTrunOff_eyesOffOnTarget;

	private Vector3 bodyLocalPos_Stored;

	private Transform bodyBoneTrans;

	private GameObject bodyRotHelper;

	private GameObject headLookAtTarget;

	private GameObject bodyRotDirTarget;

	private Vector3 bodyRotDirTargetLocalPos_Stored;

	private float rotTime;

	private Quaternion finalRotation;

	private Quaternion finalRotation_Stored;

	private Vector3 finalRotVelocity = Vector3.zero;

	private float inGapRotDelay;

	private GameObject bodyAnchorLocalPos;

	public float eyeNotBlinkTimeMin = 7f;

	public float eyeNotBlinkTimeMax = 10f;

	public bool isEyeBlink;

	private SkinnedMeshRenderer faceSkinnedRend;

	private float blinkTimeCunt;

	private float NotBlinkTimeCount;

	private int interval;

	private bool initialized;

	public SkinnedMeshRenderer faceSkinnedRenderer;

	public Vector3 dir = new Vector3(0f, 0f, 1f);

	private Transform tempHeadTrans;

	private void Initialize()
	{
		if (!eyeRootsLeftRight[0] || !eyeRootsLeftRight[1])
		{
			UnityEngine.Debug.Log(string.Concat("No Eye Root: ", eyeRootsLeftRight[0], " / ", eyeRootsLeftRight[1]));
			return;
		}
		if (!neckBone || !bodyBone)
		{
			UnityEngine.Debug.Log("No Neck or Body Bone is not added");
			return;
		}
		eyeLookAtTarget = new GameObject();
		eyeLookAtTarget.name = "EyeLookAtTarget";
		eyeLookAtTarget.transform.parent = neckBone.transform;
		eyeLookAtTargetDefualtPos = new Vector3(0f, 0f, 3f);
		eyeLookAtTarget.transform.localPosition = eyeLookAtTargetDefualtPos;
		eyeLookatHorizontalOffset = 0f;
		bodyRotHelper = new GameObject();
		bodyRotHelper.name = "BodyRotHelper_" + GetInstanceID();
		bodyRotHelper.transform.parent = bodyBone.transform.root;
		bodyBone.localEulerAngles = Vector3.zero;
		bodyLocalPos_Stored = bodyBone.localPosition;
		headLookAtTarget = new GameObject();
		headLookAtTarget.name = "HeadForwardDirection";
		headLookAtTarget.transform.parent = neckBone.transform;
		headLookAtTarget.transform.localPosition = new Vector3(0f, 0f, 1f);
		headLookAtTarget.transform.localEulerAngles = Vector3.zero;
		bodyRotDirTarget = new GameObject();
		bodyRotDirTarget.name = "BodyRotateDirectionTarget";
		bodyRotDirTarget.transform.parent = bodyBone.transform;
		bodyRotDirTarget.transform.localPosition = dir;
		bodyRotDirTargetLocalPos_Stored = bodyRotDirTarget.transform.localPosition;
		bodyBone.transform.parent = bodyBone.transform.root;
		bodyBone.transform.rotation = neckBone.transform.rotation;
		bodyAnchorLocalPos = new GameObject();
		bodyAnchorLocalPos.name = "BodyAnchorLocalPos";
		bodyAnchorLocalPos.transform.parent = neckBone.transform;
		bodyAnchorLocalPos.transform.localPosition = bodyLocalPos_Stored;
		faceSkinnedRend = faceSkinnedRenderer;
		if (base.gameObject.layer == LayerMask.NameToLayer("DummyAvatar"))
		{
			bodyRotHelper.transform.localEulerAngles = new Vector3(0f, 90f, 0f);
			isEyeNotRotate = true;
		}
		interval = 1;
		initialized = true;
	}

	private void Start()
	{
		Initialize();
	}

	private void Update()
	{
		if (!initialized)
		{
			UnityEngine.Debug.Log("Initialze fail!");
			return;
		}
		if (base.gameObject.layer == LayerMask.NameToLayer("DummyAvatar") && bodyRotDirTarget.transform.localPosition != new Vector3(0f, 0f, -1f))
		{
			bodyRotDirTarget.transform.localPosition = new Vector3(0f, 0f, -1f);
		}
		if (!isEyeNotRotate)
		{
			eyeTargetRay = new Ray(headBone.transform.position, headBone.transform.rotation * Vector3.forward);
			Physics.Raycast(eyeTargetRay, out eyeTargetHitInfo, 3f);
			UnityEngine.Debug.DrawRay(headBone.transform.position, headBone.transform.rotation * Vector3.forward, Color.red);
			if (eyeTargetHitInfo.collider != null)
			{
				if (eyeTargetHitInfo.collider.gameObject.layer == 13)
				{
					tempHeadTrans = eyeTargetHitInfo.collider.transform;
					eyeRootsLeftRight[0].transform.LookAt(tempHeadTrans, Vector3.up);
					eyeRootsLeftRight[1].transform.LookAt(tempHeadTrans, Vector3.up);
					Quaternion localRotation = rotationClampXY(eyeRootsLeftRight[0].transform.localRotation, -10f, 6f, -14f, 14f);
					Quaternion localRotation2 = rotationClampXY(eyeRootsLeftRight[1].transform.localRotation, -10f, 6f, -14f, 14f);
					eyeRootsLeftRight[0].transform.localRotation = localRotation;
					eyeRootsLeftRight[1].transform.localRotation = localRotation2;
					UnityEngine.Debug.DrawLine(eyeRootsLeftRight[0].transform.position, tempHeadTrans.position, Color.green);
					UnityEngine.Debug.DrawLine(eyeRootsLeftRight[1].transform.position, tempHeadTrans.position, Color.green);
				}
			}
			else
			{
				eyeRootsLeftRight[0].transform.localEulerAngles = Vector3.zero;
				eyeRootsLeftRight[1].transform.localEulerAngles = Vector3.zero;
			}
			if (!isTrunOff_eyesOffOnTarget && (bool)eyeRootsLeftRight[0].GetComponentInChildren<AvatarEye>() && (bool)eyeRootsLeftRight[0].GetComponentInChildren<AvatarEye>())
			{
				if (isEyeOffTarget)
				{
					eyeStayTimeCount = 0f;
					eyeOffTimeCount += Time.deltaTime;
					float num = Mathf.Clamp(UnityEngine.Random.value * 10f, eyeOffTimeMin, eyeOffTimeMax);
					if (getRandomCheck == 0)
					{
						randomVec = new Vector3(Mathf.Clamp((UnityEngine.Random.value - 0.5f) * 0.5f, -0.1f, 0.1f), Mathf.Clamp((UnityEngine.Random.value - 0.5f) * 0.5f, -0.1f, 0.1f), Mathf.Clamp((UnityEngine.Random.value - 0.5f) * 0.5f, -0.1f, 0.1f));
						randomVec *= 25f * eyesOffTargetAmount;
						getRandomCheck++;
					}
					if (eyeOffTimeCount > num)
					{
						eyeOffTimeCount = 0f;
						getRandomCheck = 0;
						isEyeOffTarget = false;
					}
					eyeRootsLeftRight[0].GetComponentInChildren<AvatarEye>().transform.localRotation = Quaternion.Euler(new Vector3(randomVec.x, randomVec.y, 0f));
					eyeRootsLeftRight[1].GetComponentInChildren<AvatarEye>().transform.localRotation = Quaternion.Euler(new Vector3(randomVec.x, 0f - randomVec.y, 0f));
				}
				else
				{
					eyeOffTimeCount = 0f;
					getRandomCheck = 0;
					eyeStayTimeCount += Time.deltaTime;
					float num2 = Mathf.Clamp(UnityEngine.Random.value * 10f, eyeStayTimeMin, eyeStayTimeMax);
					if (eyeStayTimeCount > num2)
					{
						eyeStayTimeCount = 0f;
						isEyeOffTarget = true;
					}
					eyeRootsLeftRight[0].GetComponentInChildren<AvatarEye>().transform.localRotation = Quaternion.identity;
					eyeRootsLeftRight[1].GetComponentInChildren<AvatarEye>().transform.localRotation = Quaternion.identity;
				}
			}
		}
		if (isEyeBlink)
		{
			blinkTimeCunt += Time.deltaTime * 8f;
			if (blinkTimeCunt < 1f)
			{
				faceSkinnedRend.SetBlendShapeWeight(6, blinkTimeCunt * 100f);
				faceSkinnedRend.SetBlendShapeWeight(7, blinkTimeCunt * 100f);
			}
			else if (1f <= blinkTimeCunt && blinkTimeCunt < 2f)
			{
				faceSkinnedRend.SetBlendShapeWeight(6, (2f - blinkTimeCunt) * 100f);
				faceSkinnedRend.SetBlendShapeWeight(7, (2f - blinkTimeCunt) * 100f);
			}
			else
			{
				blinkTimeCunt = 0f;
				NotBlinkTimeCount = 0f;
				isEyeBlink = false;
			}
		}
		else
		{
			NotBlinkTimeCount += Time.deltaTime;
			float num3 = Mathf.Clamp(UnityEngine.Random.value * 12f, eyeNotBlinkTimeMin, eyeNotBlinkTimeMax);
			if (NotBlinkTimeCount > num3)
			{
				isEyeBlink = true;
			}
		}
		if (Time.frameCount % interval != 0)
		{
			return;
		}
		if (isInvertRotation_Stored != isInvertRotation)
		{
			if (isInvertRotation)
			{
				bodyRotDirTarget.transform.localPosition = -bodyRotDirTargetLocalPos_Stored;
				UnityEngine.Debug.Log("Invert Rotation On");
			}
			else
			{
				bodyRotDirTarget.transform.localPosition = bodyRotDirTargetLocalPos_Stored;
				UnityEngine.Debug.Log("Invert Rotation Off");
			}
			isInvertRotation_Stored = isInvertRotation;
		}
		bodyBone.transform.position = bodyAnchorLocalPos.transform.position;
		bodyRotHelper.transform.position = bodyBone.transform.position;
		bodyBoneTrans = bodyBone.transform;
		float num4 = neckBone.transform.eulerAngles.x;
		if (num4 > 270f)
		{
			num4 -= 360f;
		}
		float num5 = num4 * num4 * num4 * 0.0002f;
		float num6 = neckBone.transform.eulerAngles.z;
		if (num6 > 270f)
		{
			num6 -= 360f;
		}
		float num7 = num6 * num6 * num6 * 0.0002f;
		bodyRotHelper.transform.position = bodyBone.transform.position;
		float num8 = Mathf.Abs(bodyBoneTrans.rotation.eulerAngles.y - neckBone.transform.rotation.eulerAngles.y);
		float x = headLookAtTarget.transform.InverseTransformPoint(bodyRotDirTarget.transform.position).x;
		if (num8 > 45f)
		{
			float y = (0f - x) * num8 * bodyRotationSpeed;
			bodyBoneTrans.Rotate(new Vector3(0f, y, 0f) * Time.deltaTime, Space.Self);
			bodyRotHelper.transform.rotation = bodyBoneTrans.rotation;
			inGapRotDelay = 0f;
		}
		else
		{
			inGapRotDelay += Time.deltaTime;
			if (inGapRotDelay > 1f)
			{
				float y2 = (0f - x) * num8 * bodyRotationSpeed * 0.3f;
				bodyBoneTrans.Rotate(new Vector3(0f, y2, 0f) * Time.deltaTime, Space.Self);
				bodyRotHelper.transform.rotation = bodyBoneTrans.rotation;
			}
		}
		float num9 = 0f;
		num9 = bodyRotHelper.transform.rotation.eulerAngles.y;
		if (Mathf.Abs(num5) > 50f || Mathf.Abs(num7) > 60f)
		{
			rotTime += Time.deltaTime;
			finalRotation = Quaternion.Slerp(bodyBoneTrans.rotation, neckBone.transform.rotation * Quaternion.identity, rotTime * bodyRotationSpeed);
			bodyRotHelper.transform.rotation = bodyBoneTrans.rotation;
		}
		else
		{
			rotTime = 0f;
			finalRotation = Quaternion.Euler(new Vector3(num5, num9, num7));
		}
		Quaternion rotation = Quaternion.RotateTowards(finalRotation_Stored, finalRotation, Time.deltaTime * 600f);
		bodyBoneTrans.rotation = rotation;
		finalRotation_Stored = bodyBoneTrans.rotation;
	}

	private Quaternion rotationClampXY(Quaternion rot, float minClampX, float maxClampX, float minClampY, float maxClampY)
	{
		rot.x /= rot.w;
		rot.y /= rot.w;
		rot.z /= rot.w;
		rot.w = 1f;
		float value = 114.59156f * Mathf.Atan(rot.x);
		value = Mathf.Clamp(value, minClampX, maxClampX);
		rot.x = Mathf.Tan((float)Math.PI / 360f * value);
		float value2 = 114.59156f * Mathf.Atan(rot.y);
		value2 = Mathf.Clamp(value2, minClampY, maxClampY);
		rot.y = Mathf.Tan((float)Math.PI / 360f * value2);
		return rot;
	}

	private void OnDestroy()
	{
		UnityEngine.Object.DestroyImmediate(bodyBone.gameObject);
		UnityEngine.Object.DestroyImmediate(bodyRotHelper);
	}
}
public class bottleBreak : MonoBehaviour
{
	public GameObject brokenBottle;

	private Collider[] brokenPieceCols;

	public GameObject breakingParticle;

	private GameObject particle_store;

	private ARFishController arFishController;

	private LiquidSineAnim getLiquidSineAnim;

	private float breakThreshold = 3f;

	private GameObject instBrokenBottle;

	private void Awake()
	{
		brokenPieceCols = brokenBottle.GetComponentsInChildren<Collider>();
		instBrokenBottle = new GameObject();
		instBrokenBottle.name = brokenBottle.name + "_brokenPieces_pool";
		instBrokenBottle.transform.position = new Vector3(0f, -2f, 0f);
		instBrokenBottle = UnityEngine.Object.Instantiate(brokenBottle, instBrokenBottle.transform);
		instBrokenBottle.SetActive(value: false);
		particle_store = UnityEngine.Object.Instantiate(breakingParticle);
		particle_store.transform.position = new Vector3(0f, -2f, 0f);
		particle_store.SetActive(value: false);
	}

	private void Start()
	{
		getLiquidSineAnim = GameObject.Find("Console_Manager").GetComponent<LiquidSineAnim>();
	}

	private void OnTriggerEnter(Collider other)
	{
		if (other.gameObject.CompareTag("BREAKGROUND"))
		{
			UnityEngine.Debug.Log("Velocity is " + GetComponent<Rigidbody>().velocity.magnitude);
			if (GetComponent<Rigidbody>().velocity.magnitude > breakThreshold)
			{
				particle_store.transform.position = base.transform.position;
				particle_store.SetActive(value: true);
				particle_store.GetComponent<ParticleSystem>().Play();
				particle_store.GetComponent<AudioSource>().Play();
				base.gameObject.SetActive(value: false);
				getLiquidSineAnim.RefreshPhysicsOBJs = true;
				instBrokenBottle.transform.position = base.transform.position;
				instBrokenBottle.SetActive(value: true);
				UnityEngine.Object.Destroy(particle_store, 2f);
			}
		}
	}

	private void OnCollisionEnter(Collision collision)
	{
		if (GetComponent<Rigidbody>().velocity.magnitude > breakThreshold)
		{
			particle_store.transform.position = base.transform.position;
			particle_store.SetActive(value: true);
			particle_store.GetComponent<ParticleSystem>().Play();
			particle_store.GetComponent<AudioSource>().Play();
			base.gameObject.SetActive(value: false);
			getLiquidSineAnim.RefreshPhysicsOBJs = true;
			instBrokenBottle.transform.position = base.transform.position;
			instBrokenBottle.SetActive(value: true);
			UnityEngine.Object.Destroy(particle_store, 2f);
			UnityEngine.Object.Destroy(base.gameObject);
		}
	}
}
public class brokenPieceCollision : MonoBehaviour
{
	private Rigidbody rb;

	private Collider col;

	private void Awake()
	{
		rb = GetComponent<Rigidbody>();
		col = GetComponent<Collider>();
	}

	private void OnCollisionEnter(Collision collision)
	{
		if (rb.velocity == Vector3.zero)
		{
			rb.Sleep();
			col.enabled = false;
		}
	}
}
public class bulletShoot : MonoBehaviour
{
	[Header("Gun Settings")]
	public GameObject ammoPrefab;

	public float shootingTimeDelay = 0.2f;

	public bool isInfiniteAmmo;

	private int infiniteAmmoSize;

	public int magSize;

	public float magChangeTime = 1f;

	public bool isEmissionLightOn;

	public Renderer gunRenderer;

	[Header("Sound FX Clips")]
	public AudioClip shootFX;

	public AudioClip magazineFX;

	public AudioClip noMagazineFX;

	private Transform bulletPoolParent;

	private AudioSource audioSrc;

	private List<GameObject> ammoPool;

	private int ammoRoundCount;

	private bool isMagChanging;

	private float checkTime;

	private Color defaultShootColor;

	private Collider rootCol;

	[HideInInspector]
	public bool isGunGrabbed;

	private IEnumerator MagChangeDelay()
	{
		isMagChanging = true;
		if ((bool)gunRenderer && isEmissionLightOn)
		{
			gunRenderer.material.SetColor("_EmissionColor", Color.yellow);
		}
		yield return new WaitForSeconds(magChangeTime);
		if ((bool)gunRenderer && isEmissionLightOn)
		{
			gunRenderer.material.SetColor("_EmissionColor", defaultShootColor);
		}
		isMagChanging = false;
	}

	private void Awake()
	{
		if ((bool)base.transform.GetComponentInParent<Renderer>().gameObject.GetComponent<Collider>())
		{
			rootCol = base.transform.GetComponentInParent<Renderer>().gameObject.GetComponent<Collider>();
			if (!rootCol.gameObject.GetComponent<Rigidbody>())
			{
				UnityEngine.Debug.Log("No Root Rigid: " + rootCol.gameObject.name);
			}
		}
		else
		{
			UnityEngine.Debug.Log(base.transform.GetComponentInParent<Renderer>().gameObject.name + " has no Root Collider");
		}
		gunRenderer = base.transform.GetComponentInParent<Renderer>();
		audioSrc = GetComponent<AudioSource>();
		if (isInfiniteAmmo)
		{
			float num = 4f / shootingTimeDelay;
			infiniteAmmoSize = (int)num + 1;
		}
		bulletPoolParent = new GameObject().transform;
		bulletPoolParent.name = "AmmoPool";
		bulletPoolParent.position = new Vector3(0f, -2f, 0f);
		ammoPool = spwanAmmoPool(ammoPrefab, magSize, bulletPoolParent);
		ammoRoundCount = 0;
		if ((bool)gunRenderer && isEmissionLightOn)
		{
			defaultShootColor = new Color(122f, 191f, 131f);
			defaultShootColor *= 0.01f;
			gunRenderer.material.SetColor("_EmissionColor", defaultShootColor);
		}
	}

	private void Update()
	{
		if (!isGunGrabbed)
		{
			return;
		}
		if (shootingTimeDelay > checkTime)
		{
			checkTime += Time.fixedDeltaTime;
		}
		else if (!isMagChanging)
		{
			bool buttonDown = Input.GetButtonDown("Fire1");
			bool flag = VRInput.bInputTriggerDown(VRInput.eController.mainhand);
			if (buttonDown || flag)
			{
				if (ammoRoundCount == magSize)
				{
					if (!isInfiniteAmmo)
					{
						if ((bool)gunRenderer && isEmissionLightOn)
						{
							gunRenderer.material.SetColor("_EmissionColor", Color.red);
						}
						audioSrc.PlayOneShot(noMagazineFX);
						UnityEngine.Debug.Log("Mag empty!");
						return;
					}
					ammoRoundCount = 0;
				}
				ammoPool[ammoRoundCount].transform.position = base.transform.position;
				ammoPool[ammoRoundCount].transform.rotation = base.transform.rotation;
				ammoPool[ammoRoundCount].SetActive(value: true);
				audioSrc.PlayOneShot(shootFX);
				UnityEngine.Debug.Log("Audio Playing: " + audioSrc.isPlaying);
				checkTime = 0f;
				ammoRoundCount++;
			}
		}
		if (isInfiniteAmmo)
		{
			return;
		}
		bool buttonDown2 = Input.GetButtonDown("Fire2");
		bool flag2 = VRInput.bInputTriggerDown(VRInput.eController.subhand);
		if (ammoRoundCount != 0 && (buttonDown2 || flag2))
		{
			StartCoroutine(MagChangeDelay());
			audioSrc.PlayOneShot(magazineFX);
			for (int i = 0; i < ammoPool.Count; i++)
			{
				ammoPool[i].transform.position = bulletPoolParent.transform.position;
				ammoPool[i].transform.rotation = Quaternion.identity;
				ammoPool[i].GetComponent<Rigidbody>().velocity = Vector3.zero;
				ammoPool[i].GetComponent<Rigidbody>().angularVelocity = Vector3.zero;
				ammoPool[i].SetActive(value: false);
			}
			ammoRoundCount = 0;
			UnityEngine.Debug.Log("Reloaded!");
		}
	}

	private List<GameObject> spwanAmmoPool(GameObject ammo, int numOfAmmo, Transform parent)
	{
		if (!ammo || numOfAmmo == 0)
		{
			UnityEngine.Debug.Log(string.Concat("Return!: Ammo Prefab is ", ammo, ", Mag Size is ", numOfAmmo));
			return null;
		}
		List<GameObject> list = new List<GameObject>();
		for (int i = 0; i < numOfAmmo; i++)
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(ammo, parent);
			Physics.IgnoreCollision(gameObject.GetComponent<Collider>(), rootCol);
			gameObject.transform.localPosition = Vector3.zero;
			gameObject.transform.localRotation = Quaternion.identity;
			gameObject.SetActive(value: false);
			list.Add(gameObject);
		}
		return list;
	}
}
public class camDepthTexture : MonoBehaviour
{
	private Camera mainCam;

	private Camera cam;

	private void Start()
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT)
		{
			Initialize();
		}
	}

	private void Initialize()
	{
		if ((bool)GetComponent<Camera>())
		{
			UnityEngine.Debug.Log("No Main Camera Attached");
		}
		else
		{
			cam = GetComponent<Camera>();
		}
	}

	private void OnWillRenderObject()
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT)
		{
			if (Camera.current != null)
			{
				cam = Camera.current;
			}
			Camera.current.depthTextureMode |= DepthTextureMode.Depth;
		}
	}
}
public class crabNav : MonoBehaviour
{
	public bool isGrabbed;

	public float normalSpeed = 0.6f;

	public float afterGrabSpeed = 1f;

	public AnimationClip animIdle;

	public AnimationClip animWalk;

	public AnimationClip animAttack;

	public AnimationClip animOut;

	public AnimationClip animHide;

	[HideInInspector]
	public Transform[] startingPoints;

	[HideInInspector]
	public Transform[] wayPoints;

	private Animation getAnim;

	private NavMeshAgent getNavAgnt;

	private RVRFGrabbable getGrabbable;

	private bool isOutingDone;

	private bool isHiding;

	private float delayStep;

	private Vector3 tempDestination_Stored;

	private GameObject tempGround;

	private IEnumerator IntialOutDelay(float outSpeed)
	{
		getNavAgnt.enabled = false;
		yield return new WaitForSeconds(0.2f);
		StartCoroutine(OutDelay(outSpeed, wayPoints));
		StopCoroutine("IntialOutDelay");
	}

	private IEnumerator OutDelay(float inOutSpeed, Transform[] wayPoints)
	{
		float seconds = 1f;
		AnimationClip clip = getAnim["anim_Out"].clip;
		getAnim.clip = clip;
		getAnim.Play();
		yield return new WaitForSeconds(seconds);
		_ = Vector3.zero;
		Vector3 position = wayPoints[UnityEngine.Random.Range(0, wayPoints.Length - 1)].position;
		getNavAgnt.enabled = true;
		getNavAgnt.SetDestination(position);
		getAnim.clip = animWalk;
		getAnim.Play();
		delayStep = 0f;
		isOutingDone = true;
	}

	private IEnumerator IntialHideDelay(float hideSpeed)
	{
		yield return new WaitForSeconds(1f);
		getAnim.Stop();
		StartCoroutine(HideDelay(hideSpeed));
		StopCoroutine("IntialHideDelay");
	}

	private IEnumerator HideDelay(float inOutSpeed)
	{
		getNavAgnt.enabled = false;
		float seconds = 1f;
		AnimationClip clip = getAnim["anim_Hide"].clip;
		getAnim.clip = clip;
		getAnim.Play();
		yield return new WaitForSeconds(seconds);
		getAnim.clip = animWalk;
		delayStep = 0f;
		getNavAgnt.enabled = true;
		base.gameObject.SetActive(value: false);
	}

	private void Awake()
	{
		tempGround = GameObject.FindGameObjectWithTag("BREAKGROUND");
		if ((bool)GetComponent<NavMeshAgent>())
		{
			getNavAgnt = GetComponent<NavMeshAgent>();
		}
		else
		{
			UnityEngine.Debug.Log("NavMeshAgent is not attached!");
		}
		if ((bool)GetComponent<Animation>())
		{
			getAnim = GetComponent<Animation>();
		}
		else
		{
			UnityEngine.Debug.Log("No Animation");
		}
		if ((bool)GetComponent<RVRFGrabbable>())
		{
			getGrabbable = GetComponent<RVRFGrabbable>();
		}
		else
		{
			UnityEngine.Debug.Log("RVFGrabbable is not attached!");
		}
		getNavAgnt.speed = normalSpeed;
		if (!animIdle || !animWalk || !animAttack)
		{
			UnityEngine.Debug.Log("All Crab Animation has to be set");
		}
		getAnim.AddClip(animOut, "anim_Out");
		getAnim.AddClip(animHide, "anim_Hide");
		getAnim.clip = animWalk;
		getAnim.Play();
		isOutingDone = false;
		isHiding = false;
	}

	private void OnEnable()
	{
		StartCoroutine(OutDelay(-0.01f, wayPoints));
		isHiding = false;
		isOutingDone = false;
	}

	private void Update()
	{
		if (getGrabbable.isGrabbed)
		{
			isGrabbed = true;
		}
		else
		{
			isGrabbed = false;
		}
		if (!isOutingDone)
		{
			return;
		}
		StopCoroutine("IntialHideDelay");
		StopCoroutine("OutDelay");
		if (!getNavAgnt.enabled)
		{
			return;
		}
		if (isHiding)
		{
			UnityEngine.Debug.Log("is Hiding");
			StartCoroutine(IntialHideDelay(0.01f));
		}
		else if (getNavAgnt.remainingDistance < 0.5f)
		{
			getNavAgnt.isStopped = true;
			float num = UnityEngine.Random.Range(0, 1);
			UnityEngine.Debug.Log("Randomize: " + num);
			if ((double)num >= 0.5)
			{
				getNavAgnt.SetDestination(wayPoints[UnityEngine.Random.Range(0, wayPoints.Length - 1)].position);
				getNavAgnt.isStopped = false;
			}
			else
			{
				getNavAgnt.SetDestination(startingPoints[UnityEngine.Random.Range(0, startingPoints.Length - 1)].position);
				getNavAgnt.isStopped = false;
				isHiding = true;
			}
		}
		else if (isGrabbed)
		{
			getAnim.clip = animAttack;
			getAnim.Play();
			tempDestination_Stored = getNavAgnt.destination;
			getNavAgnt.isStopped = true;
			getNavAgnt.speed = afterGrabSpeed;
			getNavAgnt.enabled = false;
			Physics.IgnoreCollision(GetComponent<Collider>(), tempGround.GetComponent<Collider>(), ignore: false);
		}
		else
		{
			getAnim.clip = animWalk;
			getAnim.Play();
			getNavAgnt.isStopped = false;
		}
	}

	private void OnCollisionEnter(Collision col)
	{
		if (col.gameObject.tag == "BULLET")
		{
			getNavAgnt.speed = afterGrabSpeed;
		}
		if (col.gameObject.tag == "BREAKGROUND")
		{
			if (!getNavAgnt.enabled)
			{
				isGrabbed = false;
				getNavAgnt.enabled = true;
				getNavAgnt.SetDestination(tempDestination_Stored);
			}
			Physics.IgnoreCollision(GetComponent<Collider>(), tempGround.GetComponent<Collider>(), ignore: true);
		}
		if ((bool)col.gameObject.GetComponent<NavMeshAgent>())
		{
			UnityEngine.Debug.Log(col.gameObject.name + " has been collide");
			Physics.IgnoreCollision(GetComponent<Collider>(), col.collider, ignore: true);
		}
	}
}
public class floatingOBJ : MonoBehaviour
{
	public float risingSpeed = 1f;

	public float maxRisingHeight;

	public float ramdomXYMovement;

	public float maxVelocity = 1f;

	public float maxVelBrakeTime = 2f;

	public float maxAngularVelocity;

	public float torqueValue = 0.5f;

	public float torqueHeight;

	public float maxLiveTime = 150f;

	public bool isHandRelease;

	private Rigidbody rb;

	private float torqueRandomVal;

	private float timeCheck;

	private float brakeTimeCheck;

	private bool isRigidSet;

	private bool isAirBrakeOn;

	private IEnumerator AirBrake(float intialVel, float maxVel, float brakeTime, Rigidbody floatRB)
	{
		brakeTimeCheck += Time.deltaTime;
		float num = intialVel - maxVel;
		if (intialVel > maxVel && brakeTimeCheck < brakeTime)
		{
			float num2 = Mathf.Lerp(0f, num * 1.1f, brakeTimeCheck / brakeTime);
			if (maxVel < floatRB.velocity.magnitude - num2)
			{
				floatRB.velocity = Vector3.ClampMagnitude(floatRB.velocity, floatRB.velocity.magnitude - num2);
			}
		}
		yield return new WaitForSeconds(brakeTime);
		brakeTimeCheck = 0f;
		isAirBrakeOn = true;
	}

	private void Awake()
	{
		rb = GetComponent<Rigidbody>();
	}

	private void Update()
	{
		if (maxLiveTime > 0f)
		{
			timeCheck += Time.deltaTime;
			if (timeCheck > maxLiveTime)
			{
				timeCheck = 0f;
				base.gameObject.SetActive(value: false);
			}
		}
		if (rb.velocity.magnitude > maxVelocity)
		{
			StartCoroutine(AirBrake(rb.velocity.magnitude, maxVelocity, maxVelBrakeTime, rb));
		}
		if (isAirBrakeOn)
		{
			rb.velocity = Vector3.ClampMagnitude(rb.velocity, maxVelocity);
		}
		if (!isRigidSet)
		{
			if (maxRisingHeight == 0f)
			{
				rb.AddForce(base.transform.up * risingSpeed, ForceMode.Force);
				if (base.transform.position.y > 100f)
				{
					base.gameObject.SetActive(value: false);
				}
			}
			else if (maxRisingHeight > 0f && base.transform.position.y < maxRisingHeight)
			{
				rb.AddForce(base.transform.up * risingSpeed, ForceMode.Force);
			}
			else if (maxRisingHeight > 0f && base.transform.position.y >= maxRisingHeight)
			{
				rb.velocity = Vector3.zero;
			}
			if (ramdomXYMovement > 0f)
			{
				float num = UnityEngine.Random.Range(0f - ramdomXYMovement, ramdomXYMovement);
				rb.AddForce(base.transform.forward * num, ForceMode.Impulse);
				float num2 = UnityEngine.Random.Range(0f - ramdomXYMovement, ramdomXYMovement);
				rb.AddForce(base.transform.right * num2, ForceMode.Impulse);
			}
			else
			{
				rb.angularVelocity = Vector3.zero;
			}
			if (maxAngularVelocity > 0f)
			{
				rb.maxAngularVelocity = maxAngularVelocity;
			}
			if (torqueHeight == 0f)
			{
				torqueRandomVal = UnityEngine.Random.Range(0f - torqueValue, torqueValue);
				Vector3 torque = new Vector3(base.transform.eulerAngles.x + torqueRandomVal, base.transform.eulerAngles.y, base.transform.eulerAngles.z + torqueRandomVal);
				rb.AddTorque(torque, ForceMode.Impulse);
				rb.centerOfMass = new Vector3(0f, 0.2f, 0f);
			}
			isRigidSet = true;
		}
		if (isHandRelease)
		{
			rb.AddForce(base.transform.up * risingSpeed, ForceMode.Impulse);
		}
		if (torqueHeight != 0f && torqueHeight < base.transform.position.y)
		{
			torqueRandomVal = UnityEngine.Random.Range(0f - torqueValue, torqueValue);
			Vector3 torque2 = new Vector3(base.transform.eulerAngles.x + torqueRandomVal, base.transform.eulerAngles.y, base.transform.eulerAngles.z + torqueRandomVal);
			rb.AddTorque(torque2, ForceMode.Impulse);
			rb.centerOfMass = new Vector3(0f, 0.2f, 0f);
		}
	}

	public void refresh()
	{
		rb.velocity = Vector3.zero;
		rb.angularVelocity = Vector3.zero;
		isRigidSet = false;
	}
}
[ExecuteInEditMode]
public class LightingDataBaker : MonoBehaviour
{
	[Serializable]
	public class SphericalHarmonics
	{
		public float[] coefficients = new float[27];
	}

	[Serializable]
	public class RendererInfo
	{
		public Renderer renderer;

		public int lightmapIndex;

		public Vector4 lightmapOffsetScale;
	}

	[Serializable]
	public class LightingScenarioData
	{
		public RendererInfo[] rendererInfos;

		public Texture2D[] lightmaps;

		public Texture2D[] lightmapsDir;

		public Texture2D[] lightmapsShadow;

		public LightmapsMode lightmapsMode;

		public SphericalHarmonics[] lightProbes;

		public ReflectionProbe[] reflProbes;
	}

	[HideInInspector]
	public string m_resourceFolder;

	private string jsonFileName = "mapconfig.txt";

	private string absoluteName;

	[SerializeField]
	[HideInInspector]
	public LightingScenarioData lightingScenariosData;

	public string GetResourcesDirectory(string dir)
	{
		return UnityEngine.Application.dataPath + "/Resources/" + dir + "/";
	}

	public bool CheckResourcesDirectoryExists(string dir)
	{
		return Directory.Exists(GetResourcesDirectory(dir));
	}

	private void CreateResourcesDirectory(string dir)
	{
		if (!CheckResourcesDirectoryExists(m_resourceFolder))
		{
			Directory.CreateDirectory(GetResourcesDirectory(dir));
		}
	}

	private void WriteJsonFile(string path, string json)
	{
		absoluteName = path + jsonFileName;
		File.WriteAllText(absoluteName, json);
	}
}
[ExecuteInEditMode]
[RequireComponent(typeof(LightingDataBaker))]
public class LightingDataChanger : MonoBehaviour
{
	[Serializable]
	private class StoreLightingData
	{
		[Header("====== Store LightingData ======")]
		public bool storeLightingData;
	}

	[Serializable]
	private class LoadLightingData
	{
		[Header("====== Load LightingData ======")]
		public bool loadLightingData;

		public bool showError;
	}

	public string resourceFolder;

	private string jsonFileName = "mapconfig.txt";

	private string absoluteName;

	[SerializeField]
	private StoreLightingData lightingStore = new StoreLightingData();

	[SerializeField]
	private LoadLightingData lightingLoad = new LoadLightingData();

	private LightingDataBaker getLightingDataBaker;

	private void Awake()
	{
		getLightingDataBaker = GetComponent<LightingDataBaker>();
	}

	public void ApplyLightingDataName(string setName)
	{
		resourceFolder = setName;
		Load();
		lightingLoad.loadLightingData = false;
	}

	public void Load()
	{
		getLightingDataBaker.enabled = true;
		TextAsset[] array = Resources.LoadAll<TextAsset>(resourceFolder);
		UnityEngine.Debug.Log("LightingData TextAsset: " + array[0].name + " / " + array.Length);
		getLightingDataBaker.lightingScenariosData = UnityEngine.JsonUtility.FromJson<LightingDataBaker.LightingScenarioData>(array[0].ToString());
		LightmapData[] array2 = new LightmapData[getLightingDataBaker.lightingScenariosData.lightmaps.Length];
		for (int i = 0; i < array2.Length; i++)
		{
			array2[i] = new LightmapData();
			Texture2D[] array3 = Resources.LoadAll<Texture2D>(resourceFolder);
			for (int j = 0; j < array3.Length; j++)
			{
				if (array3[i].name == "Lightmap-" + i + "_comp_light")
				{
					array2[i].lightmapColor = array3[i];
				}
				if (getLightingDataBaker.lightingScenariosData.lightmapsMode != 0 && array3[i].name == "Lightmap-" + i + "_comp_dir")
				{
					array2[i].lightmapDir = array3[i];
				}
			}
		}
		LoadLightProbes();
		LightmapSettings.lightmaps = array2;
		UnityEngine.Debug.Log("LightingData Loading DONE!: " + resourceFolder);
		getLightingDataBaker.enabled = false;
	}

	private void LoadLightProbes()
	{
		SphericalHarmonicsL2[] array = new SphericalHarmonicsL2[getLightingDataBaker.lightingScenariosData.lightProbes.Length];
		for (int i = 0; i < getLightingDataBaker.lightingScenariosData.lightProbes.Length; i++)
		{
			SphericalHarmonicsL2 sphericalHarmonicsL = default(SphericalHarmonicsL2);
			for (int j = 0; j < 3; j++)
			{
				for (int k = 0; k < 9; k++)
				{
					sphericalHarmonicsL[j, k] = getLightingDataBaker.lightingScenariosData.lightProbes[i].coefficients[j * 9 + k];
				}
			}
			array[i] = sphericalHarmonicsL;
		}
		try
		{
			LightmapSettings.lightProbes.bakedProbes = array;
		}
		catch
		{
			UnityEngine.Debug.LogWarning("Warning, error when trying to load lightprobes for scenario ");
		}
	}

	private void ApplyRendererInfo(LightingDataBaker.RendererInfo[] infos)
	{
		try
		{
			for (int i = 0; i < infos.Length; i++)
			{
				LightingDataBaker.RendererInfo rendererInfo = infos[i];
				rendererInfo.renderer.lightmapIndex = infos[i].lightmapIndex;
				if (!rendererInfo.renderer.isPartOfStaticBatch)
				{
					rendererInfo.renderer.lightmapScaleOffset = infos[i].lightmapOffsetScale;
				}
				if (rendererInfo.renderer.isPartOfStaticBatch && lightingLoad.showError)
				{
					UnityEngine.Debug.Log("Object " + rendererInfo.renderer.gameObject.name + " is part of static batch, skipping lightmap offset and scale.");
				}
			}
		}
		catch (Exception ex)
		{
			if (lightingLoad.showError)
			{
				UnityEngine.Debug.LogError("Error in ApplyRendererInfo:" + ex.Message.ToString() + " : " + ex.GetType().ToString() + " / " + ex.Data.ToString());
			}
		}
	}
}
[ExecuteInEditMode]
public class LightModeSetting : MonoBehaviour
{
	public enum LightMode
	{
		Directional,
		Point
	}

	[Header("Lighting ----------------------------------")]
	public LightMode lightModeSelect;

	public float pointLightIntensityMult = 1f;

	public bool isUsingLightProbe;

	private int interval = 10;

	private void Update()
	{
		if (Time.frameCount % interval == 0)
		{
			if (lightModeSelect == LightMode.Directional)
			{
				Shader.EnableKeyword("_LIGHTMODE_DIRECTIONAL");
				Shader.DisableKeyword("_LIGHTMODE_POINT");
			}
			else if (lightModeSelect == LightMode.Point)
			{
				Shader.EnableKeyword("_LIGHTMODE_POINT");
				Shader.DisableKeyword("_LIGHTMODE_DIRECTIONAL");
			}
			if (isUsingLightProbe)
			{
				Shader.EnableKeyword("_LIGHTPROBE_ON");
			}
			else
			{
				Shader.DisableKeyword("_LIGHTPROBE_ON");
			}
			Shader.SetGlobalFloat("_PointLightIntensityMult", pointLightIntensityMult);
		}
	}
}
public class LiquidSineAnim : MonoBehaviour
{
	public float wobbleAmount = 0.2f;

	public float wobbleMax = 0.05f;

	public bool RefreshPhysicsOBJs;

	public Shader outlineShader;

	private AnimationCurve SineAnimation;

	private List<GameObject> getPhyOBJs;

	private List<Vector3> pos_stored;

	private List<Quaternion> rot_stored;

	private Vector3 posVal;

	private Vector3 rotVal;

	private float wobbleAddX;

	private float wobbleAddZ;

	private float animCurvVal_out;

	private float wobbleXtoShader;

	private float wobbleZtoShader;

	private float timeVal;

	private GameObject movingOBJ;

	private bool isLiquidOBJs;

	private void Awake()
	{
		getPhyOBJs = GetPhysicsObjects(out pos_stored, out rot_stored);
		SineAnimation = new AnimationCurve();
		SineAnimation.AddKey(new Keyframe(0f, 1f, 0f, 0f));
		SineAnimation.AddKey(new Keyframe(0.5f, -1f, 0f, 0f));
		SineAnimation.AddKey(new Keyframe(1f, 1f, 0f, 0f));
	}

	private void Update()
	{
		if (RefreshPhysicsOBJs)
		{
			getPhyOBJs = GetPhysicsObjects(out pos_stored, out rot_stored);
			UnityEngine.Debug.Log("Refresh Done: " + getPhyOBJs.Count + " OBJs found / " + pos_stored.Count + " Positions found");
			RefreshPhysicsOBJs = false;
		}
		AnimCurveLooping(SineAnimation, out animCurvVal_out);
		Shader.SetGlobalFloat("_SineCal", animCurvVal_out);
		if (!isLiquidOBJs)
		{
			return;
		}
		if ((bool)movingOBJ)
		{
			movingOBJ.GetComponent<Renderer>().material.SetFloat("_SineX", wobbleXtoShader);
			movingOBJ.GetComponent<Renderer>().material.SetFloat("_SineZ", wobbleZtoShader);
		}
		for (int i = 0; i < getPhyOBJs.Count; i++)
		{
			if (getPhyOBJs[i].transform.position != pos_stored[i] || getPhyOBJs[i].transform.rotation != rot_stored[i])
			{
				posVal = pos_stored[i] - getPhyOBJs[i].transform.position / Time.deltaTime;
				rotVal = getPhyOBJs[i].transform.rotation.eulerAngles - rot_stored[i].eulerAngles;
				wobbleAddX += Mathf.Clamp((posVal.x + rotVal.z * 0.2f) * wobbleMax, 0f - wobbleMax, wobbleMax);
				wobbleAddZ += Mathf.Clamp((posVal.z + rotVal.x * 0.2f) * wobbleMax, 0f - wobbleMax, wobbleMax);
				movingOBJ = getPhyOBJs[i];
				pos_stored[i] = getPhyOBJs[i].transform.position;
				rot_stored[i] = getPhyOBJs[i].transform.rotation;
			}
		}
		wobbleAddX = Mathf.Lerp(wobbleAddX, 0f, Time.deltaTime);
		wobbleAddZ = Mathf.Lerp(wobbleAddZ, 0f, Time.deltaTime);
		wobbleXtoShader = animCurvVal_out * wobbleAddX;
		wobbleZtoShader = animCurvVal_out * wobbleAddZ;
	}

	private List<GameObject> GetPhysicsObjects(out List<Vector3> phyPositions_stored, out List<Quaternion> phyRotation_stored)
	{
		GameObject[] array = GameObject.FindGameObjectsWithTag("PhysicsOBJs");
		List<GameObject> list = new List<GameObject>();
		List<Vector3> list2 = new List<Vector3>();
		List<Quaternion> list3 = new List<Quaternion>();
		for (int i = 0; i < array.Length; i++)
		{
			if (array[i].GetComponentInChildren<Renderer>().material.shader.name == "Custom/liaquidSurf")
			{
				isLiquidOBJs = true;
				UnityEngine.Debug.Log("There is 'Liquid OBJ' in this scene");
				list.Add(array[i]);
				list2.Add(array[i].transform.position);
				list3.Add(array[i].transform.rotation);
			}
		}
		phyPositions_stored = list2;
		phyRotation_stored = list3;
		return list;
	}

	private void AnimCurveLooping(AnimationCurve animCurve, out float valOut)
	{
		if (timeVal < 0.99f)
		{
			timeVal += Time.fixedDeltaTime;
		}
		else if (timeVal > 0.99f)
		{
			timeVal = 0f;
		}
		valOut = animCurve.Evaluate(timeVal);
	}
}
public class moveToWayPoint : MonoBehaviour
{
	public GameObject crabPrefab;

	public int numOfCrab = 5;

	public float initialDelay = 5f;

	public float randomAppearDelayMin = 2f;

	public float randomAppearDelayMax = 5f;

	public Transform[] wayPoints;

	public Transform[] startPoints;

	public bool isOutLoop;

	private List<GameObject> instCrabs;

	private GameObject getGround;

	private bool crabReady;

	private bool crabOut;

	private int crabOutCount;

	private IEnumerator InitialTimeDelay(float delayTime)
	{
		crabReady = false;
		crabOut = false;
		yield return new WaitForSeconds(delayTime);
		crabReady = true;
		crabOut = true;
	}

	private IEnumerator RandomTimeDelay(float delayTime, Transform[] startPoints, Transform[] wayPoints)
	{
		if (instCrabs[crabOutCount].activeSelf)
		{
			UnityEngine.Debug.Log(instCrabs[crabOutCount].name + " is still out moving / ActiveSelf is " + instCrabs[crabOutCount].activeSelf);
			crabOut = false;
			yield return null;
		}
		else
		{
			_ = Vector3.zero;
			Vector3 position = startPoints[UnityEngine.Random.Range(0, startPoints.Length - 1)].transform.position + new Vector3(0f, 0.5f, 0f);
			instCrabs[crabOutCount].transform.position = position;
			instCrabs[crabOutCount].SetActive(value: true);
			crabOut = false;
		}
		yield return new WaitForSeconds(delayTime);
		crabOutCount++;
		if (instCrabs.Count > crabOutCount)
		{
			crabOut = true;
		}
		else if (instCrabs.Count == crabOutCount && isOutLoop)
		{
			UnityEngine.Debug.Log("Loop on, reset the count!");
			crabOutCount = 0;
			crabOut = true;
		}
	}

	private void Awake()
	{
		getGround = GameObject.FindGameObjectWithTag("BREAKGROUND");
		GameObject gameObject = new GameObject();
		gameObject.name = "CrabPool";
		gameObject.transform.position = new Vector3(0f, -2f, 0f);
		instCrabs = new List<GameObject>();
		for (int i = 0; i < numOfCrab; i++)
		{
			instCrabs.Add(UnityEngine.Object.Instantiate(crabPrefab));
			instCrabs[i].transform.parent = gameObject.transform;
			instCrabs[i].transform.position = Vector3.zero;
			instCrabs[i].GetComponent<crabNav>().startingPoints = startPoints;
			instCrabs[i].GetComponent<crabNav>().wayPoints = wayPoints;
			if ((bool)instCrabs[i].GetComponent<Collider>())
			{
				Physics.IgnoreCollision(instCrabs[i].GetComponent<Collider>(), getGround.GetComponent<Collider>(), ignore: true);
			}
			else
			{
				UnityEngine.Debug.Log(instCrabs[i].name + " has no collider for the grab");
			}
			instCrabs[i].SetActive(value: false);
		}
	}

	private void Start()
	{
		StartCoroutine(InitialTimeDelay(initialDelay));
	}

	private void Update()
	{
		if (crabReady && crabOut)
		{
			float delayTime = UnityEngine.Random.Range(randomAppearDelayMin, randomAppearDelayMax);
			if (wayPoints == null || startPoints == null)
			{
				UnityEngine.Debug.Log("There is no Way / Start Point!");
			}
			else
			{
				StartCoroutine(RandomTimeDelay(delayTime, startPoints, wayPoints));
			}
		}
	}
}
[ExecuteInEditMode]
public class RenderSortinOrder : MonoBehaviour
{
	public int sortingOrder = 2999;

	private void OnEnable()
	{
		GetComponent<Renderer>().sharedMaterial.renderQueue = sortingOrder;
	}
}
public class SineCalculation : MonoBehaviour
{
	public AnimationCurve sineAnim01;

	public AnimationCurve TexAnim01;

	public float speed = 1f;

	public bool sineLoop = true;

	private Renderer waterRend;

	private float playTimer01;

	private float playtime02;

	private float time;

	private void Start()
	{
		waterRend = GetComponentInChildren<Renderer>();
	}

	private void Update()
	{
		time = Time.time * speed;
		playTimer01 = time - Mathf.Floor(time);
		waterRend.sharedMaterial.SetFloat("_SineRoutine01", sineAnim01.Evaluate(playTimer01));
		waterRend.sharedMaterial.SetFloat("_TexRoutine01", TexAnim01.Evaluate(playTimer01));
	}
}
public class spwanTarget : MonoBehaviour
{
	public GameObject target;

	public int numOfTargets = 1;

	public float respawnTime = 1f;

	public bool isLoop;

	public float loopCooldownTime = 10f;

	public Transform spawnPoint;

	public bool isHitAnimation;

	private Animation animComp;

	private List<GameObject> spawnedTarget;

	private int spawnCounter;

	private float timeCheck;

	private float coolDownTimeCheck;

	private void Awake()
	{
		spawnedTarget = new List<GameObject>();
		if (target != null && numOfTargets > 0)
		{
			for (int i = 0; i < numOfTargets; i++)
			{
				spawnedTarget.Add(UnityEngine.Object.Instantiate(target, base.transform.position, base.transform.rotation, spawnPoint.transform));
			}
			for (int j = 0; j < spawnedTarget.Count; j++)
			{
				spawnedTarget[j].SetActive(value: false);
			}
			if (isHitAnimation)
			{
				animComp = base.transform.GetComponentInParent<Animation>();
			}
		}
		else
		{
			UnityEngine.Debug.Log("There is no target object");
		}
	}

	private void Update()
	{
		timeCheck += Time.deltaTime;
		if (isLoop && spawnCounter >= spawnedTarget.Count)
		{
			coolDownTimeCheck += Time.deltaTime;
		}
	}

	private void OnCollisionEnter(Collision col)
	{
		if (respawnTime > timeCheck || (!isLoop && spawnCounter >= spawnedTarget.Count))
		{
			return;
		}
		if (isLoop && spawnCounter >= spawnedTarget.Count)
		{
			if (!(loopCooldownTime < coolDownTimeCheck))
			{
				return;
			}
			spawnCounter = 0;
			coolDownTimeCheck = 0f;
		}
		if (col.collider.gameObject.tag != "BULLET")
		{
			return;
		}
		if (!spawnPoint)
		{
			spawnedTarget[spawnCounter].transform.position = new Vector3(base.transform.position.x, base.transform.position.y + 1.5f, base.transform.position.z);
			spawnedTarget[spawnCounter].transform.rotation = Quaternion.identity;
			if ((bool)spawnedTarget[spawnCounter].GetComponent<floatingOBJ>())
			{
				spawnedTarget[spawnCounter].GetComponent<floatingOBJ>().refresh();
			}
			spawnedTarget[spawnCounter].SetActive(value: true);
		}
		else
		{
			spawnedTarget[spawnCounter].transform.position = spawnPoint.transform.position;
			spawnedTarget[spawnCounter].transform.rotation = Quaternion.identity;
			if ((bool)spawnedTarget[spawnCounter].GetComponent<floatingOBJ>())
			{
				spawnedTarget[spawnCounter].GetComponent<floatingOBJ>().refresh();
			}
			spawnedTarget[spawnCounter].SetActive(value: true);
		}
		if (isHitAnimation)
		{
			animComp.Play();
		}
		timeCheck = 0f;
		spawnCounter++;
	}
}
public class WaterFishLOD : MonoBehaviour
{
	public float LOD_Distance = 12f;

	private Material fishMat;

	private Camera mainCam;

	private void Start()
	{
		fishMat = GetComponent<SkinnedMeshRenderer>().material;
		mainCam = Camera.main;
	}

	private void Update()
	{
		if (Vector3.Distance(base.transform.position, mainCam.transform.position) >= LOD_Distance)
		{
			fishMat.EnableKeyword("LOWLOD_ON");
			fishMat.DisableKeyword("LOWLOD_OFF");
		}
		else
		{
			fishMat.EnableKeyword("LOWLOD_OFF");
			fishMat.DisableKeyword("LOWLOD_ON");
		}
	}
}
public class VRFishingPlayerController : VRPlayerBase
{
	public GameObject ovrCameraRig;

	public OVRManager ovrManager;

	public Transform ovrCameraTransform;

	public Transform playerTransform;

	public control_hand LeftHandAnchor;

	public control_hand RightHandAnchor;

	private RVRFGrabber leftHandGrabber;

	private RVRFGrabber rightHandGrabber;

	private Transform centerEyeTransform;

	private DataManager dataManager;

	private Main main;

	public UnityEvent enteredStage;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		if (MultiplayManager.Instance != null && PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
		{
			SetMultiplayPositionPivot();
			MultiplayManager.Instance.localAvatar.isReady = true;
		}
		if (MultiplayManager.Instance != null && PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
		{
			ExitGames.Client.Photon.Hashtable hashtable = new ExitGames.Client.Photon.Hashtable();
			hashtable.Add("scene", "stage");
			PhotonNetwork.LocalPlayer.SetCustomProperties(hashtable);
			MultiplayEventManager.Instance.SendFishState(FishState.None);
		}
	}

	private void Start()
	{
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			ovrManager.trackingOriginType = OVRManager.TrackingOrigin.EyeLevel;
		}
		else
		{
			ovrManager.trackingOriginType = OVRManager.TrackingOrigin.FloorLevel;
		}
		Initilaize();
		leftHandGrabber = LeftHandAnchor.GetComponent<RVRFGrabber>();
		rightHandGrabber = RightHandAnchor.GetComponent<RVRFGrabber>();
	}

	private void Initilaize()
	{
		SetController();
	}

	public void SetController()
	{
		if (dataManager.userData.bothHand)
		{
			if (!dataManager.userData.rightHand)
			{
			}
		}
		else
		{
			_ = dataManager.userData.rightHand;
		}
		SwitchGrabber(dataManager.userData.rightHand);
	}

	private void SwitchGrabber(bool isRightHand)
	{
		if (!(leftHandGrabber == null) && !(rightHandGrabber == null))
		{
			if (isRightHand)
			{
				rightHandGrabber.enabled = true;
				leftHandGrabber.enabled = false;
			}
			else
			{
				rightHandGrabber.enabled = false;
				leftHandGrabber.enabled = true;
			}
		}
	}

	private void SetMultiplayPositionPivot()
	{
		int positionIndex = MultiplayManager.Instance.positionIndex;
		Vector3 vector = main.envControl.multiplayPositionPivot.position - main.envControl.multiplayPositions[positionIndex].position;
		main.envControl.multiplayPositionPivot.position += vector;
	}
}
public class VRFishingPointer : VRPointerBase
{
	public enum Hand
	{
		LEFT,
		RIGHT
	}

	public VRFishingPlayerController vrPlayerController;

	public Hand hand;

	private RVRFGrabbable tempDetectedGrabbable;

	private DataManager dataManager;

	private MediaController mediaController;

	private Main main;

	public bool pressed;

	public override void Awake()
	{
		base.Awake();
		dataManager = Singleton<DataManager>.Instance;
		mediaController = Singleton<MediaController>.Instance;
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
	}

	public override void Reset()
	{
		base.Reset();
	}

	public override void SetCursorStartDest(Vector3 start, Vector3 dest, Vector3 normal)
	{
		_startPoint = start;
		_endPoint = dest;
		_hitTarget = true;
	}

	public override void SetCursorStartDest(Vector3 start, Vector3 dest, Vector3 normal, RaycastHit result)
	{
		_startPoint = start;
		_endPoint = dest;
		detectedCollider = result.collider;
		_hitTarget = true;
	}

	public override void SetCursorRay(Transform t)
	{
		_startPoint = t.position;
		_forward = t.forward;
		_hitTarget = false;
	}

	private void Update()
	{
		if (detectedCollider == null && tempDetectedGrabbable != null)
		{
			tempDetectedGrabbable.isDetected = false;
			tempDetectedGrabbable = null;
		}
		else if (detectedCollider != null && tempDetectedGrabbable != null && detectedCollider.gameObject != tempDetectedGrabbable.gameObject)
		{
			tempDetectedGrabbable.isDetected = false;
		}
	}

	private void LateUpdate()
	{
		if (main.fishingControl.gameState == control_Fishing.EfishingState.ready || main.fishingControl.gameState == control_Fishing.EfishingState.catching)
		{
			main.vrInputModule.useRaycaster = true;
			UpdateLaserBeam(_startPoint, _endPoint);
			if (VRInput.bInputTriggerDown(VRInput.eController.mainhand))
			{
				if (vrInputModule.gameObjectOverL != null || vrInputModule.gameObjectOverR != null)
				{
					if (!dataManager.userData.rightHand)
					{
						if (vrInputModule.gameObjectOverL != null && hand == Hand.LEFT)
						{
							if (vrInputModule.gameObjectOverL.name == "Button_Position")
							{
								Singleton<MediaController>.Instance.rotateAnchor = Singleton<Main>.Instance.leftHandTransform;
								Singleton<MediaController>.Instance.isPositionAdjustableL = true;
								Singleton<MediaController>.Instance.isScaleAdjustableByThumbstickL = true;
								Singleton<MediaController>.Instance.isDistanceAdjustableByThumbstickL = true;
							}
							else if (vrInputModule.gameObjectOverL.name == "Button_Scale")
							{
								Singleton<MediaController>.Instance.isScaleAdjustableL = true;
								Singleton<MediaController>.Instance.isScaleAdjustableByThumbstickL = true;
							}
							else if (vrInputModule.gameObjectOverL.name == "Button_Distance")
							{
								Singleton<MediaController>.Instance.isDistanceAdjustableL = true;
								Singleton<MediaController>.Instance.isDistanceAdjustableByThumbstickL = true;
							}
							else if (vrInputModule.gameObjectOverL.CompareTag("DragConsole"))
							{
								Singleton<Console>.Instance.doDragingL();
							}
						}
					}
					else if (vrInputModule.gameObjectOverR != null && hand == Hand.RIGHT)
					{
						if (vrInputModule.gameObjectOverR.name == "Button_Position")
						{
							Singleton<MediaController>.Instance.rotateAnchor = Singleton<Main>.Instance.rightHandTransform;
							Singleton<MediaController>.Instance.isPositionAdjustableR = true;
							Singleton<MediaController>.Instance.isScaleAdjustableByThumbstickR = true;
							Singleton<MediaController>.Instance.isDistanceAdjustableByThumbstickR = true;
						}
						else if (vrInputModule.gameObjectOverR.name == "Button_Scale")
						{
							Singleton<MediaController>.Instance.isScaleAdjustableR = true;
							Singleton<MediaController>.Instance.isScaleAdjustableByThumbstickR = true;
						}
						else if (vrInputModule.gameObjectOverR.name == "Button_Distance")
						{
							Singleton<MediaController>.Instance.isDistanceAdjustableR = true;
							Singleton<MediaController>.Instance.isDistanceAdjustableByThumbstickR = true;
						}
						else if (vrInputModule.gameObjectOverR.CompareTag("DragConsole"))
						{
							Singleton<Console>.Instance.doDragingR();
						}
					}
				}
				else if (hand == Hand.LEFT)
				{
					Singleton<MediaController>.Instance.isPositionAdjustableL = false;
					Singleton<MediaController>.Instance.isScaleAdjustableL = false;
					Singleton<MediaController>.Instance.isScaleAdjustableByThumbstickL = false;
					Singleton<MediaController>.Instance.isDistanceAdjustableL = false;
					Singleton<MediaController>.Instance.isDistanceAdjustableByThumbstickL = false;
				}
				else
				{
					Singleton<MediaController>.Instance.isPositionAdjustableR = false;
					Singleton<MediaController>.Instance.isScaleAdjustableR = false;
					Singleton<MediaController>.Instance.isScaleAdjustableByThumbstickR = false;
					Singleton<MediaController>.Instance.isDistanceAdjustableR = false;
					Singleton<MediaController>.Instance.isDistanceAdjustableByThumbstickR = false;
				}
				if (detectedCollider != null && detectedCollider.CompareTag("Drag"))
				{
					if (!dataManager.userData.rightHand)
					{
						if (hand == Hand.LEFT)
						{
							Singleton<MediaController>.Instance.rotateAnchor = Singleton<Main>.Instance.leftHandTransform;
							Singleton<MediaController>.Instance.isPositionAdjustableL = true;
							Singleton<MediaController>.Instance.isScaleAdjustableByThumbstickL = true;
							Singleton<MediaController>.Instance.isDistanceAdjustableByThumbstickL = true;
						}
					}
					else if (hand == Hand.RIGHT)
					{
						Singleton<MediaController>.Instance.rotateAnchor = Singleton<Main>.Instance.rightHandTransform;
						Singleton<MediaController>.Instance.isPositionAdjustableR = true;
						Singleton<MediaController>.Instance.isScaleAdjustableByThumbstickR = true;
						Singleton<MediaController>.Instance.isDistanceAdjustableByThumbstickR = true;
					}
				}
				if (detectedCollider != null && detectedCollider.CompareTag("portal"))
				{
					Singleton<Main>.Instance.portalControl.stageMove();
				}
			}
			else if (VRInput.bInputTriggerDown(VRInput.eController.subhand))
			{
				if (vrInputModule.gameObjectOverL != null || vrInputModule.gameObjectOverR != null)
				{
					if (!dataManager.userData.rightHand)
					{
						if (vrInputModule.gameObjectOverR != null && hand == Hand.RIGHT)
						{
							if (vrInputModule.gameObjectOverR.name == "Button_Position")
							{
								mediaController.rotateAnchor = main.rightHandTransform;
								mediaController.isPositionAdjustableR = true;
								mediaController.isScaleAdjustableByThumbstickR = true;
								mediaController.isDistanceAdjustableByThumbstickR = true;
							}
							else if (vrInputModule.gameObjectOverR.name == "Button_Scale")
							{
								mediaController.isScaleAdjustableR = true;
								mediaController.isScaleAdjustableByThumbstickR = true;
							}
							else if (vrInputModule.gameObjectOverR.name == "Button_Distance")
							{
								mediaController.isDistanceAdjustableR = true;
								mediaController.isDistanceAdjustableByThumbstickR = true;
							}
							else if (vrInputModule.gameObjectOverR.CompareTag("DragConsole"))
							{
								Singleton<Console>.Instance.doDragingR();
							}
						}
					}
					else if (vrInputModule.gameObjectOverL != null && hand == Hand.LEFT)
					{
						if (vrInputModule.gameObjectOverL.name == "Button_Position")
						{
							mediaController.rotateAnchor = Singleton<Main>.Instance.leftHandTransform;
							mediaController.isPositionAdjustableL = true;
							mediaController.isScaleAdjustableByThumbstickL = true;
							mediaController.isDistanceAdjustableByThumbstickL = true;
						}
						else if (vrInputModule.gameObjectOverL.name == "Button_Scale")
						{
							mediaController.isScaleAdjustableL = true;
							mediaController.isScaleAdjustableByThumbstickL = true;
						}
						else if (vrInputModule.gameObjectOverL.name == "Button_Distance")
						{
							mediaController.isDistanceAdjustableL = true;
							mediaController.isDistanceAdjustableByThumbstickL = true;
						}
						else if (vrInputModule.gameObjectOverL.CompareTag("DragConsole"))
						{
							Singleton<Console>.Instance.doDragingL();
						}
					}
				}
				else if (hand == Hand.LEFT)
				{
					mediaController.isPositionAdjustableL = false;
					mediaController.isScaleAdjustableL = false;
					mediaController.isScaleAdjustableByThumbstickL = false;
					mediaController.isDistanceAdjustableL = false;
					mediaController.isDistanceAdjustableByThumbstickL = false;
				}
				else
				{
					mediaController.isPositionAdjustableR = false;
					mediaController.isScaleAdjustableR = false;
					mediaController.isScaleAdjustableByThumbstickR = false;
					mediaController.isDistanceAdjustableR = false;
					mediaController.isDistanceAdjustableByThumbstickR = false;
				}
				if (detectedCollider != null && detectedCollider.CompareTag("Drag"))
				{
					if (!dataManager.userData.rightHand)
					{
						if (hand == Hand.RIGHT)
						{
							mediaController.rotateAnchor = Singleton<Main>.Instance.rightHandTransform;
							mediaController.isPositionAdjustableR = true;
							mediaController.isScaleAdjustableByThumbstickR = true;
							mediaController.isDistanceAdjustableByThumbstickR = true;
						}
					}
					else if (hand == Hand.LEFT)
					{
						mediaController.rotateAnchor = Singleton<Main>.Instance.leftHandTransform;
						mediaController.isPositionAdjustableL = true;
						mediaController.isScaleAdjustableByThumbstickL = true;
						mediaController.isDistanceAdjustableByThumbstickL = true;
					}
				}
				if (detectedCollider != null && detectedCollider.CompareTag("portal"))
				{
					main.portalControl.stageMove();
				}
			}
			if (VRInput.bInputTriggerUp(VRInput.eController.mainhand))
			{
				if (hand == Hand.LEFT)
				{
					mediaController.isPositionAdjustableL = false;
					mediaController.isScaleAdjustableL = false;
					mediaController.isScaleAdjustableByThumbstickL = false;
					mediaController.isDistanceAdjustableL = false;
					mediaController.isDistanceAdjustableByThumbstickL = false;
				}
				else
				{
					mediaController.isPositionAdjustableR = false;
					mediaController.isScaleAdjustableR = false;
					mediaController.isScaleAdjustableByThumbstickR = false;
					mediaController.isDistanceAdjustableR = false;
					mediaController.isDistanceAdjustableByThumbstickR = false;
				}
			}
			else if (VRInput.bInputTriggerUp(VRInput.eController.subhand))
			{
				if (hand == Hand.LEFT)
				{
					mediaController.isPositionAdjustableL = false;
					mediaController.isScaleAdjustableL = false;
					mediaController.isScaleAdjustableByThumbstickL = false;
					mediaController.isDistanceAdjustableL = false;
					mediaController.isDistanceAdjustableByThumbstickL = false;
				}
				else
				{
					mediaController.isPositionAdjustableR = false;
					mediaController.isScaleAdjustableR = false;
					mediaController.isScaleAdjustableByThumbstickR = false;
					mediaController.isDistanceAdjustableR = false;
					mediaController.isDistanceAdjustableByThumbstickR = false;
				}
			}
			if (detectedCollider != null && detectedCollider.CompareTag("WebView"))
			{
				if (hand == Hand.LEFT)
				{
					mediaController.isWebViewScrollableL = true;
					if (!isRaycastingLineDrawing)
					{
						isRaycastingLineDrawing = true;
					}
				}
				else if (hand == Hand.RIGHT)
				{
					mediaController.isWebViewScrollableR = true;
					if (!isRaycastingLineDrawing)
					{
						isRaycastingLineDrawing = true;
					}
				}
			}
			else if (hand == Hand.LEFT)
			{
				mediaController.isWebViewScrollableL = false;
			}
			else if (hand == Hand.RIGHT)
			{
				mediaController.isWebViewScrollableR = false;
			}
		}
		else
		{
			if (isRaycastingLineDrawing)
			{
				isRaycastingLineDrawing = false;
			}
			if (mediaController.isPositionAdjustableL)
			{
				mediaController.isPositionAdjustableL = false;
			}
			if (mediaController.isPositionAdjustableR)
			{
				mediaController.isPositionAdjustableR = false;
			}
			if ((bool)uiMarker)
			{
				uiMarker.SetActive(value: false);
			}
			if (lineRenderer.enabled)
			{
				lineRenderer.enabled = false;
			}
			if (main.vrInputModule.useRaycaster)
			{
				main.vrInputModule.useRaycaster = false;
			}
		}
	}

	public bool detectFishingRod()
	{
		if (detectedCollider != null && detectedCollider.CompareTag("cradle"))
		{
			return true;
		}
		return false;
	}

	public bool DetectSmartPhone()
	{
		if (detectedCollider != null && detectedCollider.CompareTag("smartphone"))
		{
			return true;
		}
		return false;
	}

	public bool IsDistanceGrabbable()
	{
		if (detectedCollider != null && (bool)detectedCollider.GetComponent<RVRFGrabbable>() && detectedCollider.GetComponent<RVRFGrabbable>().isDistanceGrabbable)
		{
			return true;
		}
		return false;
	}

	public RVRFGrabbable DetectDistanceGrabbable()
	{
		if (detectedCollider != null && (bool)detectedCollider.GetComponent<RVRFGrabbable>())
		{
			return detectedCollider.GetComponent<RVRFGrabbable>();
		}
		return null;
	}

	public BranchStack DetectBranchStack()
	{
		if (detectedCollider != null && (bool)detectedCollider.GetComponent<BranchStack>())
		{
			return detectedCollider.GetComponent<BranchStack>();
		}
		return null;
	}

	private void UpdateLaserBeam(Vector3 start, Vector3 end)
	{
		if (pressed)
		{
			Reset();
			return;
		}
		if (hand == Hand.LEFT)
		{
			if (vrInputModule.raycasterStatusL == RaycasterStatus.None)
			{
				detectedObject = DetectObject.None;
				detectedCollider = null;
				if ((bool)uiMarker)
				{
					uiMarker.SetActive(value: false);
				}
				lineRenderer.enabled = false;
				isRaycastingLineDrawing = false;
				return;
			}
			if (vrInputModule.raycasterStatusL == RaycasterStatus.UI)
			{
				detectedObject = DetectObject.None;
				detectedCollider = null;
			}
		}
		else
		{
			if (vrInputModule.raycasterStatusR == RaycasterStatus.None)
			{
				detectedObject = DetectObject.None;
				detectedCollider = null;
				if ((bool)uiMarker)
				{
					uiMarker.SetActive(value: false);
				}
				lineRenderer.enabled = false;
				isRaycastingLineDrawing = false;
				return;
			}
			if (vrInputModule.raycasterStatusR == RaycasterStatus.UI)
			{
				detectedObject = DetectObject.None;
				detectedCollider = null;
			}
		}
		isRaycastingLineDrawing = true;
		lineRenderer.positionCount = 0;
		uiMarker.SetActive(value: true);
		uiMarker.transform.position = _endPoint;
		lineRenderer.enabled = true;
		lineMaterial.color = rightColor;
		lineRenderer.positionCount = 2;
		lineRenderer.SetPosition(0, start);
		lineRenderer.SetPosition(1, end);
		if (detectedCollider != null)
		{
			tempDetectedGrabbable = detectedCollider.GetComponent<RVRFGrabbable>();
			if (tempDetectedGrabbable != null)
			{
				tempDetectedGrabbable.isDetected = true;
			}
			DetectRaycaster(detectedCollider, isPushUp: true);
		}
	}

	private void DetectRaycaster(Collider collider, bool isPushUp)
	{
		if (collider.CompareTag("Drag"))
		{
			detectedCollider = collider;
		}
		else if ((bool)collider.GetComponent<RVRFGrabbable>())
		{
			lineRenderer.enabled = false;
		}
	}
}
public enum VRButton
{
	buttonA,
	buttonB,
	buttonX,
	buttonY,
	buttonBack,
	buttonMenu,
	buttonLeftTrigger,
	buttonRighttTrigger,
	buttonLeftGrab,
	buttonRighttGrab,
	buttonLeftTouchStick,
	buttonLeftTouchStickUp,
	buttonLeftTouchStickDown,
	buttonLeftTouchStickLeft,
	buttonLeftTouchStickRight,
	buttonRightTouchStick,
	buttonRightTouchStickUp,
	buttonRightTouchStickDown,
	buttonRightTouchStickLeft,
	buttonRightTouchStickRight,
	axisLeftDirection,
	axisRightDirection
}
public static class VRInput
{
	public enum eTouch
	{
		none,
		up,
		down,
		left,
		right
	}

	public enum eController
	{
		mainhand,
		subhand,
		bothhand
	}

	public enum Hand
	{
		LEFT,
		RIGHT
	}

	private static bool leftInputOnce = true;

	private static bool rightInputOnce = true;

	private static bool upInputOnce = true;

	private static bool downInputOnce = true;

	public static eTouch touch = eTouch.none;

	public static float goControllerTouchMin = 0.6f;

	private static float touchControllerStickMin = 0.4f;

	private static OVRInput.Button controllerClickButton = OVRInput.Button.PrimaryIndexTrigger;

	private static OVRInput.Button controllerSubClickButton = OVRInput.Button.SecondaryIndexTrigger;

	private static object A;

	private static object B;

	private static object X;

	private static object Y;

	private static object Back;

	private static object Menu;

	private static object LeftTrigger;

	private static object RightTrigger;

	private static object LeftGrab;

	private static object RightGrab;

	private static object LeftTouchClick;

	private static object LeftTouchUp;

	private static object LeftTouchDown;

	private static object LeftTouchLeft;

	private static object LeftTouchRight;

	private static object RightTouchClick;

	private static object RightTouchUp;

	private static object RightTouchDown;

	private static object RightTouchLeft;

	private static object RightTouchRight;

	private static object LeftAxis;

	private static object RightAxis;

	private static bool once = false;

	public static void RegisterKeys()
	{
		if (!once)
		{
			once = true;
			if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
			{
				A = OVRInput.Button.One;
				B = OVRInput.Button.Two;
				X = OVRInput.Button.Three;
				Y = OVRInput.Button.Four;
				Back = OVRInput.Button.Back;
				Menu = OVRInput.Button.Start;
				LeftTrigger = OVRInput.Button.PrimaryIndexTrigger;
				RightTrigger = OVRInput.Button.SecondaryIndexTrigger;
				LeftGrab = OVRInput.Button.PrimaryHandTrigger;
				RightGrab = OVRInput.Button.SecondaryHandTrigger;
				LeftTouchClick = OVRInput.Button.PrimaryThumbstick;
				LeftTouchUp = OVRInput.Button.PrimaryThumbstickUp;
				LeftTouchDown = OVRInput.Button.PrimaryThumbstickDown;
				LeftTouchLeft = OVRInput.Button.PrimaryThumbstickLeft;
				LeftTouchRight = OVRInput.Button.PrimaryThumbstickRight;
				RightTouchClick = OVRInput.Button.SecondaryThumbstick;
				RightTouchUp = OVRInput.Button.SecondaryThumbstickUp;
				RightTouchDown = OVRInput.Button.SecondaryThumbstickDown;
				RightTouchLeft = OVRInput.Button.SecondaryThumbstickLeft;
				RightTouchRight = OVRInput.Button.SecondaryThumbstickRight;
				LeftAxis = OVRInput.Axis2D.PrimaryThumbstick;
				RightAxis = OVRInput.Axis2D.SecondaryThumbstick;
			}
			else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT)
			{
				A = OVRInput.Button.One;
				B = OVRInput.Button.Two;
				X = OVRInput.Button.Three;
				Y = OVRInput.Button.Four;
				Back = OVRInput.Button.Back;
				Menu = OVRInput.Button.Start;
				LeftTrigger = OVRInput.Button.PrimaryIndexTrigger;
				RightTrigger = OVRInput.Button.SecondaryIndexTrigger;
				LeftGrab = OVRInput.Button.PrimaryHandTrigger;
				RightGrab = OVRInput.Button.SecondaryHandTrigger;
				LeftTouchClick = OVRInput.Button.PrimaryThumbstick;
				LeftTouchUp = OVRInput.Button.PrimaryThumbstickUp;
				LeftTouchDown = OVRInput.Button.PrimaryThumbstickDown;
				LeftTouchLeft = OVRInput.Button.PrimaryThumbstickLeft;
				LeftTouchRight = OVRInput.Button.PrimaryThumbstickRight;
				RightTouchClick = OVRInput.Button.SecondaryThumbstick;
				RightTouchUp = OVRInput.Button.SecondaryThumbstickUp;
				RightTouchDown = OVRInput.Button.SecondaryThumbstickDown;
				RightTouchLeft = OVRInput.Button.SecondaryThumbstickLeft;
				RightTouchRight = OVRInput.Button.SecondaryThumbstickRight;
				LeftAxis = OVRInput.Axis2D.PrimaryThumbstick;
				RightAxis = OVRInput.Axis2D.SecondaryThumbstick;
			}
			else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
			{
				Back = OVRInput.Button.Back;
				LeftTrigger = OVRInput.Button.PrimaryIndexTrigger;
				RightTrigger = OVRInput.Button.PrimaryIndexTrigger;
				LeftTouchClick = OVRInput.Button.PrimaryTouchpad;
				RightTouchClick = OVRInput.Button.PrimaryTouchpad;
				LeftAxis = OVRInput.Axis2D.PrimaryTouchpad;
				RightAxis = OVRInput.Axis2D.PrimaryTouchpad;
			}
		}
	}

	public static bool inputGet(object button)
	{
		RegisterKeys();
		if (button == null)
		{
			return false;
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT)
		{
			return OVRInput.Get((OVRInput.Button)button, OVRInput.Controller.Touch);
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			return OVRInput.Get((OVRInput.Button)button);
		}
		return false;
	}

	public static bool inputGetDown(object button)
	{
		RegisterKeys();
		if (button == null)
		{
			return false;
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT)
		{
			return OVRInput.GetDown((OVRInput.Button)button, OVRInput.Controller.Touch);
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			return OVRInput.GetDown((OVRInput.Button)button);
		}
		return false;
	}

	public static bool inputGetUp(object button)
	{
		RegisterKeys();
		if (button == null)
		{
			return false;
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT)
		{
			return OVRInput.GetUp((OVRInput.Button)button, OVRInput.Controller.Touch);
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			return OVRInput.GetUp((OVRInput.Button)button);
		}
		return false;
	}

	public static bool GetScreenButton()
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT)
		{
			return OVRInput.GetDown(OVRInput.Button.Start);
		}
		_ = Singleton<DataManager>.Instance.targetPlatform;
		return false;
	}

	public static Vector2 GetThumbstickData(eController handedness)
	{
		RegisterKeys();
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT)
		{
			switch (handedness)
			{
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					return OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch);
				}
				return OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch);
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					return OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch);
				}
				return OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch);
			default:
				return Vector2.zero;
			}
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			return handedness switch
			{
				eController.mainhand => OVRInput.Get(OVRInput.Axis2D.PrimaryTouchpad), 
				eController.subhand => OVRInput.Get(OVRInput.Axis2D.PrimaryTouchpad), 
				_ => Vector2.zero, 
			};
		}
		return Vector2.zero;
	}

	public static Vector3 GetLocalControllerAngularVelocity(eController handedness)
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT)
		{
			switch (handedness)
			{
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					return OVRInput.GetLocalControllerAngularVelocity(OVRInput.Controller.RTouch);
				}
				return OVRInput.GetLocalControllerAngularVelocity(OVRInput.Controller.LTouch);
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					return OVRInput.GetLocalControllerAngularVelocity(OVRInput.Controller.LTouch);
				}
				return OVRInput.GetLocalControllerAngularVelocity(OVRInput.Controller.RTouch);
			default:
				return Vector3.zero;
			}
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			switch (handedness)
			{
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					return OVRInput.GetLocalControllerAngularVelocity(OVRInput.Controller.RTouch);
				}
				return OVRInput.GetLocalControllerAngularVelocity(OVRInput.Controller.LTouch);
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					return OVRInput.GetLocalControllerAngularVelocity(OVRInput.Controller.LTouch);
				}
				return OVRInput.GetLocalControllerAngularVelocity(OVRInput.Controller.RTouch);
			default:
				return Vector3.zero;
			}
		}
		return Vector3.zero;
	}

	public static Vector3 GetLocalControllerAcceleration(eController handness)
	{
		switch (handness)
		{
		case eController.mainhand:
			if (Singleton<DataManager>.Instance.userData.rightHand)
			{
				return OVRInput.GetLocalControllerAcceleration(OVRInput.Controller.RTouch);
			}
			return OVRInput.GetLocalControllerAcceleration(OVRInput.Controller.LTouch);
		case eController.subhand:
			if (Singleton<DataManager>.Instance.userData.rightHand)
			{
				return OVRInput.GetLocalControllerAcceleration(OVRInput.Controller.LTouch);
			}
			return OVRInput.GetLocalControllerAcceleration(OVRInput.Controller.RTouch);
		default:
			return Vector3.zero;
		}
	}

	public static Vector3 GetLocalControllerVelocity(eController handness)
	{
		switch (handness)
		{
		case eController.mainhand:
			if (Singleton<DataManager>.Instance.userData.rightHand)
			{
				return OVRInput.GetLocalControllerVelocity(OVRInput.Controller.RTouch);
			}
			return OVRInput.GetLocalControllerVelocity(OVRInput.Controller.LTouch);
		case eController.subhand:
			if (Singleton<DataManager>.Instance.userData.rightHand)
			{
				return OVRInput.GetLocalControllerVelocity(OVRInput.Controller.LTouch);
			}
			return OVRInput.GetLocalControllerVelocity(OVRInput.Controller.RTouch);
		default:
			return Vector3.zero;
		}
	}

	public static bool bInputTrigger(eController handness)
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.Get(OVRInput.Button.PrimaryIndexTrigger))
			{
				return true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGet(RightTrigger) || inputGet(LeftTrigger))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGet(RightTrigger))
					{
						return true;
					}
				}
				else if (inputGet(LeftTrigger))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGet(LeftTrigger))
					{
						return true;
					}
				}
				else if (inputGet(RightTrigger))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool bInputTriggerDown(eController handness)
	{
		if (Singleton<DataManager>.Instance == null)
		{
			return false;
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.GetDown(OVRInput.Button.PrimaryIndexTrigger))
			{
				return true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGetDown(RightTrigger) || inputGetDown(LeftTrigger))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(RightTrigger))
					{
						return true;
					}
				}
				else if (inputGetDown(LeftTrigger))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(LeftTrigger))
					{
						return true;
					}
				}
				else if (inputGetDown(RightTrigger))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool bInputTriggerDown(Hand hand)
	{
		if (Singleton<DataManager>.Instance == null)
		{
			return false;
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.GetDown(OVRInput.Button.PrimaryIndexTrigger))
			{
				return true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			if (hand == Hand.LEFT)
			{
				if (inputGetDown(LeftTrigger))
				{
					return true;
				}
			}
			else if (inputGetDown(RightTrigger))
			{
				return true;
			}
		}
		return false;
	}

	public static bool bInputTriggerUp(eController handness)
	{
		if (Singleton<DataManager>.Instance == null)
		{
			return false;
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.GetUp(OVRInput.Button.PrimaryIndexTrigger))
			{
				return true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGetUp(RightTrigger) || inputGetUp(LeftTrigger))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetUp(RightTrigger))
					{
						return true;
					}
				}
				else if (inputGetUp(LeftTrigger))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetUp(LeftTrigger))
					{
						return true;
					}
				}
				else if (inputGetUp(RightTrigger))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool bInputBackDown()
	{
		bool result = false;
		if (OVRInput.GetDown(OVRInput.Button.Back) || OVRInput.GetDown(OVRInput.Button.Two) || OVRInput.GetDown(OVRInput.Button.Four))
		{
			result = true;
		}
		return result;
	}

	public static bool bInputGrabDown(Hand handness)
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case Hand.LEFT:
				if (inputGetDown(LeftGrab))
				{
					return true;
				}
				break;
			case Hand.RIGHT:
				if (inputGetDown(RightGrab))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool bInputGrab(eController handness)
	{
		if (Singleton<DataManager>.Instance.targetPlatform != 0 && (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST))
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGet(RightGrab) || inputGet(LeftGrab))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGet(RightGrab))
					{
						return true;
					}
				}
				else if (inputGet(LeftGrab))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGet(LeftGrab))
					{
						return true;
					}
				}
				else if (inputGet(RightGrab))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool bInputGrabDown(eController handness)
	{
		if (Singleton<DataManager>.Instance.targetPlatform != 0 && (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST))
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGetDown(RightGrab) || inputGetDown(LeftGrab))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(RightGrab))
					{
						return true;
					}
				}
				else if (inputGetDown(LeftGrab))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(LeftGrab))
					{
						return true;
					}
				}
				else if (inputGetDown(RightGrab))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool bInputGrabUp(eController handness)
	{
		if (Singleton<DataManager>.Instance.targetPlatform != 0 && (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST))
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGetUp(RightGrab) || inputGetUp(LeftGrab))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetUp(RightGrab))
					{
						return true;
					}
				}
				else if (inputGetUp(LeftGrab))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetUp(LeftGrab))
					{
						return true;
					}
				}
				else if (inputGetUp(RightGrab))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool bTouchLeft(eController handness)
	{
		bool flag = false;
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.GetDown(OVRInput.Button.One) && OVRInput.Get(OVRInput.Axis2D.PrimaryTouchpad).x <= 0f - goControllerTouchMin)
			{
				flag = true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
					{
						if (leftInputOnce)
						{
							leftInputOnce = false;
							flag = true;
						}
						else
						{
							flag = false;
						}
					}
					else
					{
						leftInputOnce = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
				{
					if (leftInputOnce)
					{
						leftInputOnce = false;
						flag = true;
					}
					else
					{
						flag = false;
					}
				}
				else
				{
					leftInputOnce = true;
				}
				break;
			case eController.subhand:
				if (!Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
					{
						if (leftInputOnce)
						{
							leftInputOnce = false;
							flag = true;
						}
						else
						{
							flag = false;
						}
					}
					else
					{
						leftInputOnce = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
				{
					if (leftInputOnce)
					{
						leftInputOnce = false;
						flag = true;
					}
					else
					{
						flag = false;
					}
				}
				else
				{
					leftInputOnce = true;
				}
				break;
			case eController.bothhand:
				if ((OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin) || (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin))
				{
					if (leftInputOnce)
					{
						leftInputOnce = false;
						flag = true;
					}
					else
					{
						flag = false;
					}
				}
				else
				{
					leftInputOnce = true;
				}
				break;
			}
		}
		if (flag)
		{
			touch = eTouch.left;
		}
		return flag;
	}

	public static bool bTouchLeftStay(eController handness)
	{
		bool flag = false;
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.Get(OVRInput.Button.One) && OVRInput.Get(OVRInput.Axis2D.PrimaryTouchpad).x <= 0f - goControllerTouchMin)
			{
				flag = true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
					{
						flag = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
				{
					flag = true;
				}
				break;
			case eController.subhand:
				if (!Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
					{
						flag = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
				{
					flag = true;
				}
				break;
			default:
				if ((OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin) || (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin))
				{
					flag = true;
				}
				break;
			}
		}
		if (flag)
		{
			touch = eTouch.left;
		}
		return flag;
	}

	public static bool bTouchRight(eController handness)
	{
		bool flag = false;
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.GetDown(OVRInput.Button.One) && OVRInput.Get(OVRInput.Axis2D.PrimaryTouchpad).x >= goControllerTouchMin)
			{
				flag = true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			if (Singleton<DataManager>.Instance.userData.rightHand == Singleton<DataManager>.Instance.userData.rightHand)
			{
				if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
				{
					if (rightInputOnce)
					{
						rightInputOnce = false;
						flag = true;
					}
					else
					{
						flag = false;
					}
				}
				else
				{
					rightInputOnce = true;
				}
			}
			else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
			{
				if (rightInputOnce)
				{
					rightInputOnce = false;
					flag = true;
				}
				else
				{
					flag = false;
				}
			}
			else
			{
				rightInputOnce = true;
			}
		}
		else
		{
			switch (handness)
			{
			case eController.subhand:
				if (!Singleton<DataManager>.Instance.userData.rightHand == Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
					{
						if (rightInputOnce)
						{
							rightInputOnce = false;
							flag = true;
						}
						else
						{
							flag = false;
						}
					}
					else
					{
						rightInputOnce = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
				{
					if (rightInputOnce)
					{
						rightInputOnce = false;
						flag = true;
					}
					else
					{
						flag = false;
					}
				}
				else
				{
					rightInputOnce = true;
				}
				break;
			case eController.bothhand:
				if ((OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin) || (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin))
				{
					if (rightInputOnce)
					{
						rightInputOnce = false;
						flag = true;
					}
					else
					{
						flag = false;
					}
				}
				else
				{
					rightInputOnce = true;
				}
				break;
			}
		}
		if (flag)
		{
			touch = eTouch.right;
		}
		return flag;
	}

	public static bool bTouchRightStay(eController handness)
	{
		bool flag = false;
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.Get(OVRInput.Button.One) && OVRInput.Get(OVRInput.Axis2D.PrimaryTouchpad).x >= goControllerTouchMin)
			{
				flag = true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
					{
						flag = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
				{
					flag = true;
				}
				break;
			case eController.subhand:
				if (!Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
					{
						flag = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin)
				{
					flag = true;
				}
				break;
			default:
				if ((OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin) || (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin))
				{
					flag = true;
				}
				break;
			}
		}
		if (flag)
		{
			touch = eTouch.right;
		}
		return flag;
	}

	public static bool bTouchUp(eController handness)
	{
		bool flag = false;
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.GetDown(OVRInput.Button.One) && OVRInput.Get(OVRInput.Axis2D.PrimaryTouchpad).y > goControllerTouchMin)
			{
				flag = true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
					{
						if (upInputOnce)
						{
							upInputOnce = false;
							flag = true;
						}
						else
						{
							flag = false;
						}
					}
					else
					{
						upInputOnce = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
				{
					if (upInputOnce)
					{
						upInputOnce = false;
						flag = true;
					}
					else
					{
						flag = false;
					}
				}
				else
				{
					upInputOnce = true;
				}
				break;
			case eController.subhand:
				if (!Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
					{
						if (upInputOnce)
						{
							upInputOnce = false;
							flag = true;
						}
						else
						{
							flag = false;
						}
					}
					else
					{
						upInputOnce = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
				{
					if (upInputOnce)
					{
						upInputOnce = false;
						flag = true;
					}
					else
					{
						flag = false;
					}
				}
				else
				{
					upInputOnce = true;
				}
				break;
			default:
				if ((OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f) || (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f))
				{
					if (upInputOnce)
					{
						upInputOnce = false;
						flag = true;
					}
					else
					{
						flag = false;
					}
				}
				else
				{
					upInputOnce = true;
				}
				break;
			}
		}
		if (flag)
		{
			touch = eTouch.up;
		}
		return flag;
	}

	public static bool bTouchUpStay(eController handness)
	{
		bool flag = false;
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.Get(OVRInput.Button.One) && OVRInput.Get(OVRInput.Axis2D.PrimaryTouchpad).y > 0f - goControllerTouchMin && OVRInput.Get(OVRInput.Axis2D.PrimaryTouchpad).x >= 0f - goControllerTouchMin && OVRInput.Get(OVRInput.Axis2D.PrimaryTouchpad).x <= goControllerTouchMin)
			{
				flag = true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
					{
						flag = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
				{
					flag = true;
				}
				break;
			case eController.subhand:
				if (!Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
					{
						flag = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
				{
					flag = true;
				}
				break;
			default:
				if ((OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f) || (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y >= touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f))
				{
					flag = true;
				}
				break;
			}
		}
		if (flag)
		{
			touch = eTouch.up;
		}
		return flag;
	}

	public static bool bTouchDown(eController handness)
	{
		bool flag = false;
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.GetDown(OVRInput.Button.One) && OVRInput.Get(OVRInput.Axis2D.PrimaryTouchpad).y <= 0f - goControllerTouchMin)
			{
				flag = true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
					{
						if (downInputOnce)
						{
							downInputOnce = false;
							flag = true;
						}
						else
						{
							flag = false;
						}
					}
					else
					{
						downInputOnce = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
				{
					if (downInputOnce)
					{
						downInputOnce = false;
						flag = true;
					}
					else
					{
						flag = false;
					}
				}
				else
				{
					downInputOnce = true;
				}
				break;
			case eController.subhand:
				if (!Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
					{
						if (downInputOnce)
						{
							downInputOnce = false;
							flag = true;
						}
						else
						{
							flag = false;
						}
					}
					else
					{
						downInputOnce = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
				{
					if (downInputOnce)
					{
						downInputOnce = false;
						flag = true;
					}
					else
					{
						flag = false;
					}
				}
				else
				{
					downInputOnce = true;
				}
				break;
			default:
				if ((OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f) || (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f))
				{
					if (downInputOnce)
					{
						downInputOnce = false;
						flag = true;
					}
					else
					{
						flag = false;
					}
				}
				else
				{
					downInputOnce = true;
				}
				break;
			}
		}
		if (flag)
		{
			touch = eTouch.down;
		}
		return flag;
	}

	public static bool bTouchDownStay(eController handness)
	{
		bool flag = false;
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.Get(OVRInput.Button.One) && OVRInput.Get(OVRInput.Axis2D.PrimaryTouchpad).y <= 0f - goControllerTouchMin)
			{
				flag = true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
					{
						flag = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
				{
					flag = true;
				}
				break;
			case eController.subhand:
				if (!Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
					{
						flag = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f)
				{
					flag = true;
				}
				break;
			default:
				if ((OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f) || (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y <= 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x >= (0f - touchControllerStickMin) * 1f && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x <= touchControllerStickMin * 1f))
				{
					flag = true;
				}
				break;
			}
		}
		if (flag)
		{
			touch = eTouch.down;
		}
		return flag;
	}

	public static bool bTouchClick(eController handness)
	{
		bool result = false;
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.GetDown(OVRInput.Button.PrimaryTouchpad))
			{
				result = true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.GetDown(OVRInput.Button.SecondaryThumbstick, OVRInput.Controller.Touch))
					{
						result = true;
					}
				}
				else if (OVRInput.GetDown(OVRInput.Button.PrimaryThumbstick, OVRInput.Controller.Touch))
				{
					result = true;
				}
				break;
			case eController.subhand:
				if (!Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.GetDown(OVRInput.Button.SecondaryThumbstick, OVRInput.Controller.Touch))
					{
						result = true;
					}
				}
				else if (OVRInput.GetDown(OVRInput.Button.PrimaryThumbstick, OVRInput.Controller.Touch))
				{
					result = true;
				}
				break;
			}
		}
		return result;
	}

	public static bool bTouchRelease(eController handness)
	{
		bool flag = false;
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.GetUp(OVRInput.Button.PrimaryTouchpad))
			{
				flag = true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x < touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin)
					{
						flag = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x < touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin)
				{
					flag = true;
				}
				break;
			case eController.subhand:
				if (!Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x < touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).x > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.SecondaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin)
					{
						flag = true;
					}
				}
				else if (OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x < touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).x > 0f - touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y < touchControllerStickMin && OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, OVRInput.Controller.Touch).y > 0f - touchControllerStickMin)
				{
					flag = true;
				}
				break;
			}
		}
		if (flag)
		{
			touch = eTouch.none;
		}
		return flag;
	}

	public static bool Touch_Click(eController handness)
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (handness == eController.bothhand && (inputGetDown(RightTouchClick) || inputGetDown(LeftTouchClick)))
			{
				return true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGetDown(RightTouchClick) || inputGetDown(LeftTouchClick))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(RightTouchClick))
					{
						return true;
					}
				}
				else if (inputGetDown(LeftTouchClick))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(LeftTouchClick))
					{
						return true;
					}
				}
				else if (inputGetDown(RightTouchClick))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool Touch_Release(eController handness)
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (handness == eController.bothhand && (inputGetUp(RightTouchClick) || inputGetUp(LeftTouchClick)))
			{
				return true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGetUp(RightTouchClick) || inputGetUp(LeftTouchClick))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetUp(RightTouchClick))
					{
						return true;
					}
				}
				else if (inputGetUp(LeftTouchClick))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetUp(LeftTouchClick))
					{
						return true;
					}
				}
				else if (inputGetUp(RightTouchClick))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool Touch_Up_Click(eController handness)
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			return bTouchUp(handness);
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGetDown(RightTouchUp) || inputGetDown(LeftTouchUp))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(RightTouchUp))
					{
						return true;
					}
				}
				else if (inputGetDown(LeftTouchUp))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(LeftTouchUp))
					{
						return true;
					}
				}
				else if (inputGetDown(RightTouchUp))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool Touch_Down_Click(eController handness)
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			return bTouchDown(handness);
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGetDown(RightTouchDown) || inputGetDown(LeftTouchDown))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(RightTouchDown))
					{
						return true;
					}
				}
				else if (inputGetDown(LeftTouchDown))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(LeftTouchDown))
					{
						return true;
					}
				}
				else if (inputGetDown(RightTouchDown))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool Touch_Left_Click(eController handness)
	{
		if (Singleton<DataManager>.Instance == null)
		{
			return false;
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			return bTouchLeft(handness);
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGetDown(RightTouchLeft) || inputGetDown(LeftTouchLeft))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(RightTouchLeft))
					{
						return true;
					}
				}
				else if (inputGetDown(LeftTouchLeft))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(LeftTouchLeft))
					{
						return true;
					}
				}
				else if (inputGetDown(RightTouchLeft))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool Touch_Right_Click(eController handness)
	{
		if (Singleton<DataManager>.Instance == null)
		{
			return false;
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			return bTouchRight(handness);
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGetDown(RightTouchRight) || inputGetDown(LeftTouchRight))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(RightTouchRight))
					{
						return true;
					}
				}
				else if (inputGetDown(LeftTouchRight))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(LeftTouchRight))
					{
						return true;
					}
				}
				else if (inputGetDown(RightTouchRight))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool Touch_Up_Stay(eController handness)
	{
		if (Singleton<DataManager>.Instance == null)
		{
			return false;
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			return bTouchUpStay(handness);
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGet(RightTouchUp) || inputGet(LeftTouchUp))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGet(RightTouchUp))
					{
						return true;
					}
				}
				else if (inputGet(LeftTouchUp))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGet(LeftTouchUp))
					{
						return true;
					}
				}
				else if (inputGet(RightTouchUp))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool Touch_Down_Stay(eController handness)
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			return bTouchDownStay(handness);
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGet(RightTouchDown) || inputGet(LeftTouchDown))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGet(RightTouchDown))
					{
						return true;
					}
				}
				else if (inputGet(LeftTouchDown))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGet(LeftTouchDown))
					{
						return true;
					}
				}
				else if (inputGet(RightTouchDown))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool Touch_Left_Stay(eController handness)
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			return bTouchLeftStay(handness);
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGet(RightTouchLeft) || inputGet(LeftTouchLeft))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGet(RightTouchLeft))
					{
						return true;
					}
				}
				else if (inputGet(LeftTouchLeft))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGet(LeftTouchLeft))
					{
						return true;
					}
				}
				else if (inputGet(RightTouchLeft))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool Touch_Right_Stay(eController handness)
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			return bTouchRightStay(handness);
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGet(RightTouchRight) || inputGet(LeftTouchRight))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGet(RightTouchRight))
					{
						return true;
					}
				}
				else if (inputGet(LeftTouchRight))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGet(LeftTouchRight))
					{
						return true;
					}
				}
				else if (inputGet(RightTouchRight))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool GetDownHeightButton()
	{
		if (!OVRInput.GetDown(OVRInput.Button.Two))
		{
			return OVRInput.GetDown(OVRInput.Button.Four);
		}
		return true;
	}

	public static bool Button_T_Click(eController handness)
	{
		if (Singleton<DataManager>.Instance == null)
		{
			return false;
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.Get(OVRInput.Button.Back))
			{
				return true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGetDown(B) || inputGetDown(Y))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(B))
					{
						return true;
					}
				}
				else if (inputGetDown(Y))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(Y))
					{
						return true;
					}
				}
				else if (inputGetDown(B))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool Button_B_Click(eController handness)
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.Get(OVRInput.Button.Back))
			{
				return true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (handness)
			{
			case eController.bothhand:
				if (inputGetDown(A) || inputGetDown(X))
				{
					return true;
				}
				break;
			case eController.mainhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(A))
					{
						return true;
					}
				}
				else if (inputGetDown(X))
				{
					return true;
				}
				break;
			case eController.subhand:
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					if (inputGetDown(X))
					{
						return true;
					}
				}
				else if (inputGetDown(A))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool InputTriggerDown(Hand hand)
	{
		if (Singleton<DataManager>.Instance == null)
		{
			return false;
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.GetDown(OVRInput.Button.PrimaryIndexTrigger))
			{
				return true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (hand)
			{
			case Hand.LEFT:
				if (inputGetDown(LeftTrigger))
				{
					return true;
				}
				break;
			case Hand.RIGHT:
				if (inputGetDown(RightTrigger))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool InputTrigger(Hand hand)
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.Get(OVRInput.Button.PrimaryIndexTrigger))
			{
				return true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (hand)
			{
			case Hand.LEFT:
				if (inputGet(LeftTrigger))
				{
					return true;
				}
				break;
			case Hand.RIGHT:
				if (inputGet(RightTrigger))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool InputTriggerUp(Hand hand)
	{
		if (Singleton<DataManager>.Instance == null)
		{
			return false;
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (OVRInput.GetUp(OVRInput.Button.PrimaryIndexTrigger))
			{
				return true;
			}
		}
		else if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			switch (hand)
			{
			case Hand.LEFT:
				if (inputGetUp(LeftTrigger))
				{
					return true;
				}
				break;
			case Hand.RIGHT:
				if (inputGetUp(RightTrigger))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool InputGrabDown(Hand hand)
	{
		if (Singleton<DataManager>.Instance.targetPlatform != 0 && (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST))
		{
			switch (hand)
			{
			case Hand.LEFT:
				if (inputGetDown(LeftGrab))
				{
					return true;
				}
				break;
			case Hand.RIGHT:
				if (inputGetDown(RightGrab))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool InputGrab(Hand hand)
	{
		if (Singleton<DataManager>.Instance.targetPlatform != 0 && (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST))
		{
			switch (hand)
			{
			case Hand.LEFT:
				if (inputGet(LeftGrab))
				{
					return true;
				}
				break;
			case Hand.RIGHT:
				if (inputGet(RightGrab))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static bool InputGrabUp(Hand hand)
	{
		if (Singleton<DataManager>.Instance.targetPlatform != 0 && (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST))
		{
			switch (hand)
			{
			case Hand.LEFT:
				if (inputGetUp(LeftGrab))
				{
					return true;
				}
				break;
			case Hand.RIGHT:
				if (inputGetUp(RightGrab))
				{
					return true;
				}
				break;
			}
		}
		return false;
	}

	public static Vector3 GetLocalControllerVelocity(Hand hand)
	{
		return hand switch
		{
			Hand.LEFT => OVRInput.GetLocalControllerVelocity(OVRInput.Controller.LTouch), 
			Hand.RIGHT => OVRInput.GetLocalControllerVelocity(OVRInput.Controller.RTouch), 
			_ => Vector3.zero, 
		};
	}

	public static Vector3 GetLocalControllerAngularVelocity(Hand hand)
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST || Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT)
		{
			return hand switch
			{
				Hand.LEFT => OVRInput.GetLocalControllerAngularVelocity(OVRInput.Controller.LTouch), 
				Hand.RIGHT => OVRInput.GetLocalControllerAngularVelocity(OVRInput.Controller.RTouch), 
				_ => Vector3.zero, 
			};
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			return OVRInput.GetLocalControllerAngularVelocity(OVRInput.Controller.Touch);
		}
		return Vector3.zero;
	}
}
public enum RaycasterStatus
{
	None,
	UI,
	Physics
}
public enum DetectObject
{
	None,
	Ignore,
	Floor,
	Porch,
	PorchChair,
	Deck,
	DeckChair,
	RoomChair,
	Control,
	Screen,
	Trophy,
	Trophyset,
	SaltwaterLobby,
	Lobby,
	DragArea,
	PrivateRoom,
	Mirror,
	Door,
	Window
}
public class VRLobbyPointer : VRPointerBase
{
	public enum Hand
	{
		LEFT,
		RIGHT
	}

	public Hand hand;

	public GameObject positionMarker;

	public TrophyManager trophyManager;

	public float angle = 5f;

	private int maxVertexcount = 50;

	public float strength = 10f;

	private float vertexDelta = 0.04f;

	private Vector3 velocity;

	public Vector3 hitPos;

	public VRPlayerController vrPlayerController;

	public LayerMask showLayers;

	private List<Vector3> vertexList = new List<Vector3>();

	public bool isTeleportLineDrawing;

	public bool isStopRaycasting;

	private RVRFGrabbable tempDetectedGrabbable;

	private DataManager dataManager;

	private MediaController mediaController;

	private Main main;

	public override void Awake()
	{
		base.Awake();
		dataManager = Singleton<DataManager>.Instance;
		mediaController = Singleton<MediaController>.Instance;
		main = Singleton<Main>.Instance;
		if ((bool)positionMarker)
		{
			positionMarker.SetActive(value: false);
		}
		isTeleportLineDrawing = false;
	}

	private void Start()
	{
	}

	public override void Reset()
	{
		base.Reset();
		if ((bool)positionMarker)
		{
			positionMarker.SetActive(value: false);
		}
		isTeleportLineDrawing = false;
	}

	public override void SetCursorStartDest(Vector3 start, Vector3 dest, Vector3 normal)
	{
		_startPoint = start;
		_endPoint = dest;
		_hitTarget = true;
	}

	public override void SetCursorStartDest(Vector3 start, Vector3 dest, Vector3 normal, RaycastHit result)
	{
		_startPoint = start;
		_endPoint = dest;
		detectedCollider = result.collider;
		_hitTarget = true;
	}

	public override void SetCursorRay(Transform t)
	{
		_startPoint = t.position;
		_forward = t.forward;
		_hitTarget = false;
	}

	private void Update()
	{
		if (detectedCollider == null && tempDetectedGrabbable != null)
		{
			tempDetectedGrabbable.isDetected = false;
			tempDetectedGrabbable = null;
		}
		else if (detectedCollider != null && tempDetectedGrabbable != null && detectedCollider.gameObject != tempDetectedGrabbable.gameObject)
		{
			tempDetectedGrabbable.isDetected = false;
		}
	}

	private void LateUpdate()
	{
		if (isRaycastingLineDrawing)
		{
			UpdateLaserBeam(_startPoint, _endPoint);
		}
		if (isTeleportLineDrawing)
		{
			UpdateTeleportLine();
		}
		if (VRInput.bInputTriggerDown(VRInput.eController.mainhand))
		{
			if (vrInputModule.gameObjectOverL != null || vrInputModule.gameObjectOverR != null)
			{
				if (!dataManager.userData.rightHand)
				{
					if (vrInputModule.gameObjectOverL != null && hand == Hand.LEFT)
					{
						if (vrInputModule.gameObjectOverL.name == "Button_Position")
						{
							mediaController.rotateAnchor = main.leftHandTransform;
							mediaController.isPositionAdjustableL = true;
							mediaController.isScaleAdjustableByThumbstickL = true;
							mediaController.isDistanceAdjustableByThumbstickL = true;
						}
						else if (vrInputModule.gameObjectOverL.name == "Button_Scale")
						{
							mediaController.isScaleAdjustableL = true;
							mediaController.isScaleAdjustableByThumbstickL = true;
						}
						else if (vrInputModule.gameObjectOverL.name == "Button_Distance")
						{
							mediaController.isDistanceAdjustableL = true;
							mediaController.isDistanceAdjustableByThumbstickL = true;
						}
						else if (vrInputModule.gameObjectOverL.CompareTag("DragConsole"))
						{
							Singleton<Console>.Instance.doDragingL();
						}
					}
				}
				else if (vrInputModule.gameObjectOverR != null && hand == Hand.RIGHT)
				{
					if (vrInputModule.gameObjectOverR.name == "Button_Position")
					{
						mediaController.rotateAnchor = main.rightHandTransform;
						mediaController.isPositionAdjustableR = true;
						mediaController.isScaleAdjustableByThumbstickR = true;
						mediaController.isDistanceAdjustableByThumbstickR = true;
					}
					else if (vrInputModule.gameObjectOverR.name == "Button_Scale")
					{
						mediaController.isScaleAdjustableR = true;
						mediaController.isScaleAdjustableByThumbstickR = true;
					}
					else if (vrInputModule.gameObjectOverR.name == "Button_Distance")
					{
						mediaController.isDistanceAdjustableR = true;
						mediaController.isDistanceAdjustableByThumbstickR = true;
					}
					else if (vrInputModule.gameObjectOverR.CompareTag("DragConsole"))
					{
						Singleton<Console>.Instance.doDragingR();
					}
				}
			}
			else if (hand == Hand.LEFT)
			{
				mediaController.isPositionAdjustableL = false;
				mediaController.isScaleAdjustableL = false;
				mediaController.isScaleAdjustableByThumbstickL = false;
				mediaController.isDistanceAdjustableL = false;
				mediaController.isDistanceAdjustableByThumbstickL = false;
			}
			else
			{
				mediaController.isPositionAdjustableR = false;
				mediaController.isScaleAdjustableR = false;
				mediaController.isScaleAdjustableByThumbstickR = false;
				mediaController.isDistanceAdjustableR = false;
				mediaController.isDistanceAdjustableByThumbstickR = false;
			}
			if (detectedCollider != null && detectedCollider.CompareTag("Drag"))
			{
				if (!dataManager.userData.rightHand)
				{
					if (hand == Hand.LEFT)
					{
						mediaController.rotateAnchor = main.leftHandTransform;
						mediaController.isPositionAdjustableL = true;
						mediaController.isScaleAdjustableByThumbstickL = true;
						mediaController.isDistanceAdjustableByThumbstickL = true;
					}
				}
				else if (hand == Hand.RIGHT)
				{
					mediaController.rotateAnchor = main.rightHandTransform;
					mediaController.isPositionAdjustableR = true;
					mediaController.isScaleAdjustableByThumbstickR = true;
					mediaController.isDistanceAdjustableByThumbstickR = true;
				}
			}
			if (detectedCollider != null && detectedCollider.CompareTag("portal"))
			{
				main.portalControl.stageMove();
			}
		}
		else if (VRInput.bInputTriggerDown(VRInput.eController.subhand))
		{
			if (vrInputModule.gameObjectOverL != null || vrInputModule.gameObjectOverR != null)
			{
				if (!dataManager.userData.rightHand)
				{
					if (vrInputModule.gameObjectOverR != null && hand == Hand.RIGHT)
					{
						if (vrInputModule.gameObjectOverR.name == "Button_Position")
						{
							mediaController.rotateAnchor = main.rightHandTransform;
							mediaController.isPositionAdjustableR = true;
							mediaController.isScaleAdjustableByThumbstickR = true;
							mediaController.isDistanceAdjustableByThumbstickR = true;
						}
						else if (vrInputModule.gameObjectOverR.name == "Button_Scale")
						{
							mediaController.isScaleAdjustableR = true;
							mediaController.isScaleAdjustableByThumbstickR = true;
						}
						else if (vrInputModule.gameObjectOverR.name == "Button_Distance")
						{
							mediaController.isDistanceAdjustableR = true;
							mediaController.isDistanceAdjustableByThumbstickR = true;
						}
						else if (vrInputModule.gameObjectOverR.CompareTag("DragConsole"))
						{
							Singleton<Console>.Instance.doDragingR();
						}
					}
				}
				else if (vrInputModule.gameObjectOverL != null && hand == Hand.LEFT)
				{
					if (vrInputModule.gameObjectOverL.name == "Button_Position")
					{
						mediaController.rotateAnchor = main.leftHandTransform;
						mediaController.isPositionAdjustableL = true;
						mediaController.isScaleAdjustableByThumbstickL = true;
						mediaController.isDistanceAdjustableByThumbstickL = true;
					}
					else if (vrInputModule.gameObjectOverL.name == "Button_Scale")
					{
						mediaController.isScaleAdjustableL = true;
						mediaController.isScaleAdjustableByThumbstickL = true;
					}
					else if (vrInputModule.gameObjectOverL.name == "Button_Distance")
					{
						mediaController.isDistanceAdjustableL = true;
						mediaController.isDistanceAdjustableByThumbstickL = true;
					}
					else if (vrInputModule.gameObjectOverL.CompareTag("DragConsole"))
					{
						Singleton<Console>.Instance.doDragingL();
					}
				}
			}
			else if (hand == Hand.LEFT)
			{
				mediaController.isPositionAdjustableL = false;
				mediaController.isScaleAdjustableL = false;
				mediaController.isScaleAdjustableByThumbstickL = false;
				mediaController.isDistanceAdjustableL = false;
				mediaController.isDistanceAdjustableByThumbstickL = false;
			}
			else
			{
				mediaController.isPositionAdjustableR = false;
				mediaController.isScaleAdjustableR = false;
				mediaController.isScaleAdjustableByThumbstickR = false;
				mediaController.isDistanceAdjustableR = false;
				mediaController.isDistanceAdjustableByThumbstickR = false;
			}
			if (detectedCollider != null && detectedCollider.CompareTag("Drag"))
			{
				if (!dataManager.userData.rightHand)
				{
					if (hand == Hand.RIGHT)
					{
						mediaController.rotateAnchor = main.rightHandTransform;
						mediaController.isPositionAdjustableR = true;
						mediaController.isScaleAdjustableByThumbstickR = true;
						mediaController.isDistanceAdjustableByThumbstickR = true;
					}
				}
				else if (hand == Hand.LEFT)
				{
					mediaController.rotateAnchor = main.leftHandTransform;
					mediaController.isPositionAdjustableL = true;
					mediaController.isScaleAdjustableByThumbstickL = true;
					mediaController.isDistanceAdjustableByThumbstickL = true;
				}
			}
			if (detectedCollider != null && detectedCollider.CompareTag("portal"))
			{
				main.portalControl.stageMove();
			}
		}
		if (VRInput.bInputTriggerUp(VRInput.eController.mainhand))
		{
			if (hand == Hand.LEFT)
			{
				mediaController.isPositionAdjustableL = false;
				mediaController.isScaleAdjustableL = false;
				mediaController.isScaleAdjustableByThumbstickL = false;
				mediaController.isDistanceAdjustableL = false;
				mediaController.isDistanceAdjustableByThumbstickL = false;
			}
			else
			{
				mediaController.isPositionAdjustableR = false;
				mediaController.isScaleAdjustableR = false;
				mediaController.isScaleAdjustableByThumbstickR = false;
				mediaController.isDistanceAdjustableR = false;
				mediaController.isDistanceAdjustableByThumbstickR = false;
			}
		}
		else if (VRInput.bInputTriggerUp(VRInput.eController.subhand))
		{
			if (hand == Hand.LEFT)
			{
				mediaController.isPositionAdjustableL = false;
				mediaController.isScaleAdjustableL = false;
				mediaController.isScaleAdjustableByThumbstickL = false;
				mediaController.isDistanceAdjustableL = false;
				mediaController.isDistanceAdjustableByThumbstickL = false;
			}
			else
			{
				mediaController.isPositionAdjustableR = false;
				mediaController.isScaleAdjustableR = false;
				mediaController.isScaleAdjustableByThumbstickR = false;
				mediaController.isDistanceAdjustableR = false;
				mediaController.isDistanceAdjustableByThumbstickR = false;
			}
		}
		if (detectedCollider != null && detectedCollider.CompareTag("WebView"))
		{
			if (hand == Hand.LEFT)
			{
				mediaController.isWebViewScrollableL = true;
				if (!isRaycastingLineDrawing)
				{
					isRaycastingLineDrawing = true;
				}
			}
			else if (hand == Hand.RIGHT)
			{
				mediaController.isWebViewScrollableR = true;
				if (!isRaycastingLineDrawing)
				{
					isRaycastingLineDrawing = true;
				}
			}
		}
		else if (hand == Hand.LEFT)
		{
			mediaController.isWebViewScrollableL = false;
		}
		else if (hand == Hand.RIGHT)
		{
			mediaController.isWebViewScrollableR = false;
		}
	}

	private void UpdateTeleportLine()
	{
		if (rayStartTransform == null)
		{
			return;
		}
		detectedObject = DetectObject.None;
		detectedCollider = null;
		vertexList.Clear();
		Vector3 vector = rayStartTransform.position;
		vertexList.Add(vector);
		lineRenderer.enabled = true;
		if (uiMarker != null)
		{
			uiMarker.SetActive(value: false);
		}
		velocity = Quaternion.AngleAxis(0f - angle, rayStartTransform.right) * rayStartTransform.forward * strength;
		while (detectedObject == DetectObject.None && vertexList.Count < maxVertexcount)
		{
			Vector3 vector2 = vector + velocity * vertexDelta + 0.5f * Physics.gravity * vertexDelta * vertexDelta;
			velocity += Physics.gravity * vertexDelta;
			vertexList.Add(vector2);
			if (Physics.Linecast(vector, vector2, out var hitInfo, showLayers))
			{
				hitPos = hitInfo.point;
				detectedCollider = hitInfo.collider;
				DetectTeleport(hitInfo);
			}
			else
			{
				positionMarker.SetActive(value: false);
				lineMaterial.color = wrongColor;
				detectedCollider = null;
				detectedObject = DetectObject.None;
			}
			vector = vector2;
		}
		lineRenderer.positionCount = vertexList.Count;
		lineRenderer.SetPositions(vertexList.ToArray());
	}

	private void UpdateLaserBeam(Vector3 start, Vector3 end)
	{
		if (vrInputModule.raycasterStatusR == RaycasterStatus.None && vrInputModule.raycasterStatusL == RaycasterStatus.None && trophyManager != null)
		{
			trophyManager.hideAll();
		}
		if (hand == Hand.LEFT)
		{
			if (vrInputModule.raycasterStatusL == RaycasterStatus.None)
			{
				detectedObject = DetectObject.None;
				detectedCollider = null;
				if ((bool)uiMarker)
				{
					uiMarker.SetActive(value: false);
				}
				lineRenderer.enabled = false;
				isRaycastingLineDrawing = false;
				return;
			}
			if (vrInputModule.raycasterStatusL == RaycasterStatus.UI)
			{
				detectedObject = DetectObject.None;
				detectedCollider = null;
				lineRenderer.enabled = true;
			}
		}
		else
		{
			if (vrInputModule.raycasterStatusR == RaycasterStatus.None)
			{
				detectedObject = DetectObject.None;
				detectedCollider = null;
				if ((bool)uiMarker)
				{
					uiMarker.SetActive(value: false);
				}
				lineRenderer.enabled = false;
				isRaycastingLineDrawing = false;
				return;
			}
			if (vrInputModule.raycasterStatusR == RaycasterStatus.UI)
			{
				detectedObject = DetectObject.None;
				detectedCollider = null;
				lineRenderer.enabled = true;
			}
		}
		lineRenderer.positionCount = 0;
		if (positionMarker != null)
		{
			positionMarker.SetActive(value: false);
		}
		uiMarker.SetActive(value: true);
		uiMarker.transform.position = _endPoint;
		lineMaterial.color = rightColor;
		lineRenderer.positionCount = 2;
		lineRenderer.SetPosition(0, start);
		lineRenderer.SetPosition(1, end);
		if (detectedCollider != null)
		{
			DetectRaycaster(detectedCollider, isPushUp: true);
		}
	}

	private void DetectRaycaster(Collider collider, bool isPushUp)
	{
		if (trophyManager != null)
		{
			trophyManager.hideAll();
		}
		if (collider.CompareTag("trophy"))
		{
			positionMarker.SetActive(value: false);
			uiMarker.SetActive(value: false);
			if (!(Vector3.Distance(base.transform.position, collider.transform.position) > 8f))
			{
				lineRenderer.enabled = true;
				lineMaterial.color = rightColor;
				detectedObject = DetectObject.Trophy;
				collider.GetComponent<control_trophy>().showInfo();
			}
		}
		else if (collider.CompareTag("Drag"))
		{
			detectedObject = DetectObject.DragArea;
		}
		else if ((bool)collider.GetComponent<RVRFGrabbable>())
		{
			lineRenderer.enabled = false;
		}
		else
		{
			lineRenderer.enabled = true;
		}
	}

	private void DetectTeleport(RaycastHit hit)
	{
		detectedObject = vrPlayerController.DetectCollider(hit);
		switch (detectedObject)
		{
		case DetectObject.Floor:
			lineMaterial.color = rightColor;
			positionMarker.SetActive(value: true);
			positionMarker.transform.rotation = Quaternion.identity;
			positionMarker.transform.position = hitPos;
			vrPlayerController.HideAreaAll();
			break;
		case DetectObject.Porch:
			lineMaterial.color = rightColor;
			positionMarker.SetActive(value: true);
			positionMarker.transform.rotation = Quaternion.identity;
			positionMarker.transform.position = hitPos;
			vrPlayerController.HideAreaAll();
			break;
		case DetectObject.PorchChair:
			lineMaterial.color = rightColor;
			positionMarker.SetActive(value: true);
			positionMarker.transform.rotation = Quaternion.identity;
			positionMarker.transform.position = detectedCollider.transform.position;
			vrPlayerController.HideAreaAll();
			break;
		case DetectObject.Deck:
			lineMaterial.color = rightColor;
			positionMarker.SetActive(value: true);
			positionMarker.transform.rotation = Quaternion.identity;
			positionMarker.transform.position = hitPos;
			vrPlayerController.HideAreaAll();
			break;
		case DetectObject.DeckChair:
			lineMaterial.color = rightColor;
			positionMarker.SetActive(value: true);
			positionMarker.transform.rotation = Quaternion.identity;
			positionMarker.transform.position = detectedCollider.transform.position;
			vrPlayerController.HideAreaAll();
			break;
		case DetectObject.RoomChair:
			lineMaterial.color = rightColor;
			positionMarker.SetActive(value: true);
			positionMarker.transform.rotation = Quaternion.identity;
			positionMarker.transform.position = detectedCollider.transform.position;
			vrPlayerController.HideAreaAll();
			break;
		case DetectObject.Screen:
			lineMaterial.color = rightColor;
			positionMarker.SetActive(value: false);
			vrPlayerController.screenArea.enabled = true;
			break;
		case DetectObject.Trophyset:
			lineMaterial.color = rightColor;
			positionMarker.SetActive(value: false);
			vrPlayerController.trophyArea.enabled = true;
			break;
		case DetectObject.SaltwaterLobby:
			if (dataManager.userData.rooms.Count > 0 && (dataManager.userData.rooms[dataManager.currentNation].items.Count <= 1 || dataManager.userData.rooms[dataManager.currentNation].items[1].purchased))
			{
				lineMaterial.color = rightColor;
				positionMarker.SetActive(value: false);
				vrPlayerController.saltWaterArea.enabled = true;
			}
			break;
		case DetectObject.Lobby:
			lineMaterial.color = rightColor;
			positionMarker.SetActive(value: false);
			vrPlayerController.lobbyArea.enabled = true;
			break;
		case DetectObject.PrivateRoom:
			lineMaterial.color = rightColor;
			vrPlayerController.privateRoomArea.enabled = true;
			break;
		case DetectObject.Mirror:
			lineMaterial.color = rightColor;
			positionMarker.SetActive(value: false);
			vrPlayerController.mirrorArea.enabled = true;
			break;
		case DetectObject.Ignore:
			lineMaterial.color = wrongColor;
			positionMarker.SetActive(value: false);
			vrPlayerController.HideAreaAll();
			break;
		case DetectObject.Door:
			lineMaterial.color = rightColor;
			vrPlayerController.HideAreaAll();
			vrPlayerController.mainEnterDoor.openDoor();
			break;
		case DetectObject.Window:
			lineMaterial.color = wrongColor;
			vrPlayerController.HideAreaAll();
			hit.transform.GetComponent<doorOpenClose>().openDoor();
			break;
		default:
			lineMaterial.color = wrongColor;
			detectedObject = DetectObject.None;
			positionMarker.SetActive(value: false);
			vrPlayerController.HideAreaAll();
			break;
		}
	}

	public bool IsDistanceGrabbable()
	{
		if (detectedCollider != null && (bool)detectedCollider.GetComponent<RVRFGrabbable>() && detectedCollider.GetComponent<RVRFGrabbable>().isDistanceGrabbable)
		{
			return true;
		}
		return false;
	}

	public RVRFGrabbable DetectDistanceGrabbable()
	{
		if (detectedCollider != null && (bool)detectedCollider.GetComponent<RVRFGrabbable>())
		{
			return detectedCollider.GetComponent<RVRFGrabbable>();
		}
		return null;
	}

	public BranchStack DetectBranchStack()
	{
		if (detectedCollider != null && (bool)detectedCollider.GetComponent<BranchStack>())
		{
			return detectedCollider.GetComponent<BranchStack>();
		}
		return null;
	}

	public RemoteAvatar DetectRemoteAvatar()
	{
		if (detectedCollider != null && detectedCollider.CompareTag("RemoteAvatar"))
		{
			return detectedCollider.GetComponent<RemoteAvatar>();
		}
		return null;
	}

	public bool DetectSmartPhone()
	{
		if (detectedCollider != null && detectedCollider.CompareTag("smartphone"))
		{
			return true;
		}
		return false;
	}
}
public enum CurrentMode
{
	None,
	Teleport,
	Walk,
	Raycaster,
	Both
}
public class VRPlayerBase : MonoBehaviour
{
	public CurrentMode currentMode;

	public VRInputModule vrInputModule;

	public VRPointerBase vrPointerL;

	public VRPointerBase vrPointerR;

	private void Awake()
	{
	}
}
public enum AudioMode
{
	Foot,
	Sit
}
public enum WalkDirection
{
	Foward,
	Back
}
public enum MoveMode
{
	Teleport,
	SlowWalk,
	FastWalk
}
public enum TurnMode
{
	Snap,
	Slow,
	Fast
}
public class VRPlayerController : VRPlayerBase
{
	public enum playerArea
	{
		room,
		porch,
		deck,
		privateroom
	}

	public playerArea curPlayerArea;

	private playerArea oldPlayerArea;

	public GameObject ovrCameraRig;

	public OVRManager ovrManager;

	public Transform playerTansform;

	public Transform trackingSpaceTransform;

	public Transform centerEyeTransform;

	public control_lobbyHand LeftHandAnchor;

	public control_lobbyHand RightHandAnchor;

	public Renderer screenArea;

	public Renderer trophyArea;

	public Renderer saltWaterArea;

	public Renderer saltWaterAreaGlow;

	public Renderer lobbyArea;

	public Renderer lobbyAreaGlow;

	public Renderer privateRoomArea;

	public Renderer privateRoomAreaGlow;

	public Renderer mirrorArea;

	public Transform tvTransform;

	public TrophyManager trophyManager;

	public doorOpenClose baseDoor;

	public doorOpenClose mainEnterDoor;

	public float turnAngle = 45f;

	public float cameraHeightPerStep = 0.1f;

	public float cameraMaxHeight = 0.6f;

	public float cameraHeightInStand = 1.6f;

	public float cameraHeightInSit = 1.3f;

	private float currentCameraHeight;

	public float firstRotation = 180f;

	public float secondRotation = 180f;

	private Vector3 lastTrackingPos;

	private bool isSit;

	private bool walkableQuest = true;

	[HideInInspector]
	public AudioSource audioSource;

	public AudioClip footClip;

	public AudioClip sitClip;

	private Vector3 normalDirection = Vector3.zero;

	private Vector3 direction = Vector3.zero;

	private Main main;

	private DataManager dataManager;

	public bool teleporting;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		audioSource = GetComponent<AudioSource>();
		centerEyeTransform = main.cameraTransform;
		if (main.lobbyId == 1)
		{
			firstRotation = 270f;
			ovrCameraRig.transform.eulerAngles = new Vector3(0f, 270f, 0f);
		}
		if (ovrManager != null)
		{
			if (dataManager.targetPlatform == DEVICE_TYPE.GO)
			{
				ovrManager.trackingOriginType = OVRManager.TrackingOrigin.EyeLevel;
			}
			else
			{
				ovrManager.trackingOriginType = OVRManager.TrackingOrigin.FloorLevel;
			}
		}
	}

	private void Start()
	{
		StartCoroutine(waitInit());
		if (!(MultiplayManager.Instance != null) || !PhotonNetwork.IsConnected || !PhotonNetwork.InRoom)
		{
			return;
		}
		ExitGames.Client.Photon.Hashtable hashtable = new ExitGames.Client.Photon.Hashtable();
		hashtable.Add("scene", "lobby");
		PhotonNetwork.LocalPlayer.SetCustomProperties(hashtable);
		if (privateRoomArea != null)
		{
			privateRoomArea.GetComponent<Collider>().enabled = false;
		}
		if (PhotonNetwork.IsMasterClient)
		{
			if (lobbyArea != null && lobbyAreaGlow != null)
			{
				lobbyArea.GetComponent<Collider>().enabled = true;
				lobbyAreaGlow.enabled = true;
			}
			if (saltWaterArea != null && saltWaterAreaGlow != null)
			{
				saltWaterArea.GetComponent<Collider>().enabled = true;
				saltWaterAreaGlow.enabled = false;
			}
		}
		else
		{
			if (lobbyArea != null && lobbyAreaGlow != null)
			{
				lobbyArea.GetComponent<Collider>().enabled = false;
				lobbyAreaGlow.enabled = false;
			}
			if (saltWaterArea != null && saltWaterAreaGlow != null)
			{
				saltWaterArea.GetComponent<Collider>().enabled = false;
				saltWaterAreaGlow.enabled = false;
			}
		}
	}

	private IEnumerator waitInit()
	{
		while (!dataManager.loaded)
		{
			yield return null;
		}
		Initilaize();
	}

	private void Initilaize()
	{
		SetCameraSettings();
		SetController();
		if (trophyArea != null)
		{
			trophyArea.enabled = false;
		}
		if (saltWaterArea != null)
		{
			saltWaterArea.enabled = false;
		}
		if (lobbyArea != null)
		{
			lobbyArea.enabled = false;
		}
	}

	private void SetCameraSettings()
	{
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			currentCameraHeight = cameraHeightInStand;
			ovrCameraRig.transform.localPosition = new Vector3(0f, currentCameraHeight, 0f);
		}
		else
		{
			ovrCameraRig.transform.localPosition = new Vector3(0f, dataManager.lobbyCamHeight, 0f);
		}
		if (!dataManager.lobbyOnces[main.lobbyId])
		{
			dataManager.lobbyOnces[main.lobbyId] = true;
			ovrCameraRig.transform.rotation = Quaternion.Euler(0f, firstRotation, 0f);
			return;
		}
		ovrCameraRig.transform.rotation = Quaternion.Euler(0f, secondRotation, 0f);
		if (main.scene == SceneState.LOBBY)
		{
			if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
			{
				SpawnPositionMultiplay();
			}
			else
			{
				MoveToTV();
			}
		}
	}

	public void SpawnPositionMultiplay()
	{
		if (!PhotonNetwork.LocalPlayer.IsMasterClient && main != null)
		{
			UnityEngine.Debug.Log("SpawnPositionMultiplay 에서 positionIndex는 ?" + MultiplayManager.Instance.positionIndex);
			Vector3 position = main.lobbyEnvController.multiplaySpawnPositions[MultiplayManager.Instance.positionIndex].position;
			main.vrPlayerController.transform.position = new Vector3(position.x, ovrCameraRig.transform.position.y, position.z);
		}
		MultiplayManager.Instance.localAvatar.isReady = true;
	}

	public void SetController()
	{
		if (dataManager.userData.bothHand)
		{
			if (dataManager.userData.rightHand)
			{
				RightHandAnchor.showHand(showController: true);
				LeftHandAnchor.showHand(showController: false);
			}
			else
			{
				RightHandAnchor.showHand(showController: false);
				LeftHandAnchor.showHand(showController: true);
			}
		}
		else if (dataManager.userData.rightHand)
		{
			RightHandAnchor.showHand(showController: true);
		}
		else
		{
			LeftHandAnchor.showHand(showController: true);
		}
	}

	private void LateUpdate()
	{
		if (Singleton<MediaController>.Instance.isDistanceAdjustableR || Singleton<MediaController>.Instance.isDistanceAdjustableL || Singleton<MediaController>.Instance.isPositionAdjustableL || Singleton<MediaController>.Instance.isPositionAdjustableR || Singleton<MediaController>.Instance.isScaleAdjustableR || Singleton<MediaController>.Instance.isScaleAdjustableL || Singleton<MediaController>.Instance.isWebViewScrollableL || Singleton<MediaController>.Instance.isWebViewScrollableR || Singleton<MediaController>.Instance.isAlphaAdjustable || Singleton<MediaController>.Instance.isColorAdjustable)
		{
			return;
		}
		if (dataManager.userData.walkCabin == 0)
		{
			if (VRInput.Touch_Up_Stay(VRInput.eController.mainhand) && dataManager.userData.rightHand)
			{
				((VRLobbyPointer)vrPointerR).isTeleportLineDrawing = true;
				teleporting = true;
			}
			else if (VRInput.Touch_Up_Stay(VRInput.eController.mainhand) && !dataManager.userData.rightHand)
			{
				((VRLobbyPointer)vrPointerL).isTeleportLineDrawing = true;
				teleporting = true;
			}
			if (((VRLobbyPointer)vrPointerR).isTeleportLineDrawing && VRInput.bTouchRelease(VRInput.eController.mainhand) && dataManager.userData.rightHand)
			{
				teleporting = false;
				Teleport(((VRLobbyPointer)vrPointerR).hitPos);
				ResetCameraPosition();
				vrPointerR.Reset();
			}
			else if (((VRLobbyPointer)vrPointerL).isTeleportLineDrawing && VRInput.bTouchRelease(VRInput.eController.mainhand) && !dataManager.userData.rightHand)
			{
				teleporting = false;
				Teleport(((VRLobbyPointer)vrPointerL).hitPos);
				ResetCameraPosition();
				vrPointerL.Reset();
			}
			if (teleporting)
			{
				return;
			}
			if (((VRLobbyPointer)vrPointerL).isStopRaycasting)
			{
				vrPointerL.isRaycastingLineDrawing = false;
				vrPointerL.lineRenderer.enabled = false;
			}
			else
			{
				vrPointerL.isRaycastingLineDrawing = true;
			}
			if (((VRLobbyPointer)vrPointerR).isStopRaycasting)
			{
				vrPointerR.isRaycastingLineDrawing = false;
				vrPointerR.lineRenderer.enabled = false;
			}
			else
			{
				vrPointerR.isRaycastingLineDrawing = true;
			}
		}
		else
		{
			((VRLobbyPointer)vrPointerR).isRaycastingLineDrawing = true;
			((VRLobbyPointer)vrPointerR).isTeleportLineDrawing = false;
			((VRLobbyPointer)vrPointerL).isRaycastingLineDrawing = true;
			((VRLobbyPointer)vrPointerL).isTeleportLineDrawing = false;
			if (dataManager.targetPlatform != 0)
			{
				if (VRInput.Touch_Up_Stay(VRInput.eController.mainhand))
				{
					ResetCameraPosition(isMove: true);
					walkableQuest = true;
				}
				if (VRInput.Touch_Down_Stay(VRInput.eController.mainhand))
				{
					ResetCameraPosition(isMove: true);
					walkableQuest = true;
				}
			}
			if (VRInput.Touch_Up_Stay(VRInput.eController.mainhand))
			{
				Walk(WalkDirection.Foward);
			}
			if (VRInput.Touch_Down_Stay(VRInput.eController.mainhand))
			{
				Walk(WalkDirection.Back);
			}
		}
		ProcessRotation();
	}

	private void ProcessRotation()
	{
		if (dataManager.userData.rotateCabin == 0)
		{
			if (VRInput.Touch_Right_Click(VRInput.eController.mainhand))
			{
				ResetCameraPosition(isMove: true);
				ovrCameraRig.transform.Rotate(0f, turnAngle, 0f);
				if (dataManager.userData.rightHand)
				{
					vrPointerR.Reset();
				}
				else
				{
					vrPointerL.Reset();
				}
			}
			if (VRInput.Touch_Left_Click(VRInput.eController.mainhand))
			{
				ResetCameraPosition(isMove: true);
				ovrCameraRig.transform.Rotate(0f, 0f - turnAngle, 0f);
				if (dataManager.userData.rightHand)
				{
					vrPointerR.Reset();
				}
				else
				{
					vrPointerL.Reset();
				}
			}
			return;
		}
		if (dataManager.targetPlatform != 0)
		{
			if (VRInput.Touch_Right_Click(VRInput.eController.mainhand))
			{
				ResetCameraPosition(isMove: true);
			}
			if (VRInput.Touch_Left_Click(VRInput.eController.mainhand))
			{
				ResetCameraPosition(isMove: true);
			}
		}
		if (VRInput.Touch_Right_Stay(VRInput.eController.mainhand))
		{
			ovrCameraRig.transform.Rotate(0f, turnAngle * Time.deltaTime * (float)dataManager.userData.rotateCabin * 1.5f, 0f);
			if (dataManager.userData.rightHand)
			{
				vrPointerR.Reset();
			}
			else
			{
				vrPointerL.Reset();
			}
		}
		if (VRInput.Touch_Left_Stay(VRInput.eController.mainhand))
		{
			ovrCameraRig.transform.Rotate(0f, (0f - turnAngle) * Time.deltaTime * (float)dataManager.userData.rotateCabin * 1.5f, 0f);
			if (dataManager.userData.rightHand)
			{
				vrPointerR.Reset();
			}
			else
			{
				vrPointerL.Reset();
			}
		}
	}

	private void ResetCameraPosition(bool isMove = false)
	{
		if (dataManager.targetPlatform != 0)
		{
			trackingSpaceTransform.parent = null;
			if (isMove)
			{
				playerTansform.position = new Vector3(centerEyeTransform.position.x, 0f, centerEyeTransform.position.z);
			}
			trackingSpaceTransform.parent = ovrCameraRig.transform;
		}
	}

	public void Teleport(Vector3 position)
	{
		if (vrPointerL.detectedObject == DetectObject.Floor || vrPointerR.detectedObject == DetectObject.Floor)
		{
			if (curPlayerArea == playerArea.deck)
			{
				mainEnterDoor.openDoor();
			}
			curPlayerArea = playerArea.room;
			currentMode = CurrentMode.Teleport;
			HideAreaAll();
			PlayAudio(AudioMode.Foot);
			playerTansform.position = new Vector3(position.x, 0f, position.z);
			ChangeHeight(cameraHeightInStand);
		}
		else if (vrPointerL.detectedObject == DetectObject.Porch || vrPointerR.detectedObject == DetectObject.Porch)
		{
			curPlayerArea = playerArea.porch;
			curPlayerArea = playerArea.porch;
			currentMode = CurrentMode.Teleport;
			HideAreaAll();
			PlayAudio(AudioMode.Foot);
			playerTansform.position = new Vector3(position.x, 0f, position.z);
			ChangeHeight(cameraHeightInStand);
		}
		else if (vrPointerL.detectedObject == DetectObject.PorchChair || vrPointerR.detectedObject == DetectObject.PorchChair)
		{
			curPlayerArea = playerArea.porch;
			currentMode = CurrentMode.Teleport;
			HideAreaAll();
			PlayAudio(AudioMode.Sit);
			if (dataManager.userData.rightHand)
			{
				playerTansform.position = new Vector3(vrPointerR.detectedCollider.transform.position.x, 0f, vrPointerR.detectedCollider.transform.position.z);
				RotateFront(vrPointerR.detectedCollider.transform);
			}
			else
			{
				playerTansform.position = new Vector3(vrPointerL.detectedCollider.transform.position.x, 0f, vrPointerL.detectedCollider.transform.position.z);
				RotateFront(vrPointerR.detectedCollider.transform);
			}
			ChangeHeight(cameraHeightInSit);
		}
		else if (vrPointerL.detectedObject == DetectObject.Deck || vrPointerR.detectedObject == DetectObject.Deck)
		{
			if (curPlayerArea == playerArea.room)
			{
				mainEnterDoor.openDoor();
			}
			curPlayerArea = playerArea.deck;
			currentMode = CurrentMode.Teleport;
			HideAreaAll();
			PlayAudio(AudioMode.Foot);
			playerTansform.position = new Vector3(position.x, 0f, position.z);
			ChangeHeight(cameraHeightInStand);
		}
		else if (vrPointerL.detectedObject == DetectObject.DeckChair || vrPointerR.detectedObject == DetectObject.DeckChair)
		{
			if (curPlayerArea == playerArea.room)
			{
				mainEnterDoor.openDoor();
			}
			else if (curPlayerArea == playerArea.porch)
			{
				mainEnterDoor.openDoor();
			}
			curPlayerArea = playerArea.deck;
			currentMode = CurrentMode.Teleport;
			HideAreaAll();
			PlayAudio(AudioMode.Sit);
			if (dataManager.userData.rightHand)
			{
				playerTansform.position = new Vector3(vrPointerR.detectedCollider.transform.position.x, 0f, vrPointerR.detectedCollider.transform.position.z);
				RotateFront(vrPointerR.detectedCollider.transform);
			}
			else
			{
				playerTansform.position = new Vector3(vrPointerL.detectedCollider.transform.position.x, 0f, vrPointerL.detectedCollider.transform.position.z);
				RotateFront(vrPointerR.detectedCollider.transform);
			}
			ChangeHeight(cameraHeightInSit);
		}
		else if (vrPointerL.detectedObject == DetectObject.RoomChair || vrPointerR.detectedObject == DetectObject.RoomChair)
		{
			if (curPlayerArea == playerArea.deck)
			{
				mainEnterDoor.openDoor();
			}
			curPlayerArea = playerArea.room;
			currentMode = CurrentMode.Both;
			HideAreaAll();
			PlayAudio(AudioMode.Sit);
			if (dataManager.userData.rightHand)
			{
				playerTansform.position = new Vector3(vrPointerR.detectedCollider.transform.position.x, 0f, vrPointerR.detectedCollider.transform.position.z);
				RotateFront(vrPointerR.detectedCollider.transform);
			}
			else
			{
				playerTansform.position = new Vector3(vrPointerL.detectedCollider.transform.position.x, 0f, vrPointerL.detectedCollider.transform.position.z);
				RotateFront(vrPointerL.detectedCollider.transform);
			}
			ChangeHeight(cameraHeightInSit);
		}
		else if (vrPointerL.detectedObject == DetectObject.Screen || vrPointerR.detectedObject == DetectObject.Screen)
		{
			if (curPlayerArea == playerArea.deck)
			{
				mainEnterDoor.openDoor();
			}
			curPlayerArea = playerArea.room;
			currentMode = CurrentMode.Both;
			if (screenArea != null)
			{
				screenArea.enabled = true;
			}
			if (trophyArea != null)
			{
				trophyArea.enabled = false;
			}
			if (saltWaterArea != null)
			{
				saltWaterArea.enabled = false;
			}
			if (lobbyArea != null)
			{
				lobbyArea.enabled = false;
			}
			PlayAudio(AudioMode.Foot);
			if (dataManager.userData.rightHand)
			{
				playerTansform.position = new Vector3(vrPointerR.detectedCollider.transform.position.x, 0f, vrPointerR.detectedCollider.transform.position.z);
				RotateFront(vrPointerR.detectedCollider.transform);
			}
			else
			{
				playerTansform.position = new Vector3(vrPointerL.detectedCollider.transform.position.x, 0f, vrPointerL.detectedCollider.transform.position.z);
				RotateFront(vrPointerL.detectedCollider.transform);
			}
			ChangeHeight(cameraHeightInStand);
			if (main.lobbyId == 0 && !dataManager.userData.ignoreTutorial)
			{
				main.startTutoController.tutorialStart();
			}
		}
		else if (vrPointerL.detectedObject == DetectObject.Trophyset || vrPointerR.detectedObject == DetectObject.Trophyset)
		{
			if (curPlayerArea == playerArea.deck)
			{
				mainEnterDoor.openDoor();
			}
			curPlayerArea = playerArea.room;
			currentMode = CurrentMode.Both;
			if (trophyArea != null)
			{
				trophyArea.enabled = true;
			}
			if (screenArea != null)
			{
				screenArea.enabled = false;
			}
			if (saltWaterArea != null)
			{
				saltWaterArea.enabled = false;
			}
			if (lobbyArea != null)
			{
				lobbyArea.enabled = false;
			}
			PlayAudio(AudioMode.Foot);
			if (dataManager.userData.rightHand)
			{
				playerTansform.position = new Vector3(vrPointerR.detectedCollider.transform.position.x, 0f, vrPointerR.detectedCollider.transform.position.z);
				RotateFront(vrPointerR.detectedCollider.transform);
			}
			else
			{
				playerTansform.position = new Vector3(vrPointerL.detectedCollider.transform.position.x, 0f, vrPointerL.detectedCollider.transform.position.z);
				RotateFront(vrPointerL.detectedCollider.transform);
			}
			ChangeHeight(cameraHeightInStand);
		}
		else if (vrPointerL.detectedObject == DetectObject.SaltwaterLobby || vrPointerR.detectedObject == DetectObject.SaltwaterLobby)
		{
			curPlayerArea = playerArea.room;
			staticLoading.Stage = "Lobby_KR_sea";
			if (PhotonNetwork.IsMasterClient && PhotonNetwork.InRoom)
			{
				MultiplayEventManager.Instance.GoFishingEvent();
			}
			else if (!PhotonNetwork.IsMasterClient && PhotonNetwork.InRoom)
			{
				return;
			}
			SceneManager.LoadScene("Loading");
		}
		else if (vrPointerL.detectedObject == DetectObject.Lobby || vrPointerR.detectedObject == DetectObject.Lobby)
		{
			curPlayerArea = playerArea.room;
			staticLoading.Stage = "Lobby";
			if (PhotonNetwork.IsMasterClient && PhotonNetwork.InRoom)
			{
				MultiplayEventManager.Instance.GoFishingEvent();
			}
			else if (!PhotonNetwork.IsMasterClient && PhotonNetwork.InRoom)
			{
				return;
			}
			SceneManager.LoadScene("Loading");
		}
		else if (vrPointerL.detectedObject == DetectObject.PrivateRoom || vrPointerR.detectedObject == DetectObject.PrivateRoom)
		{
			curPlayerArea = playerArea.room;
			staticLoading.Stage = "PrivateRoom";
			SceneManager.LoadScene("Loading");
		}
		else if (vrPointerL.detectedObject == DetectObject.Mirror || vrPointerR.detectedObject == DetectObject.Mirror)
		{
			curPlayerArea = playerArea.room;
			currentMode = CurrentMode.Both;
			if (mirrorArea != null)
			{
				mirrorArea.enabled = true;
			}
			if (trophyArea != null)
			{
				trophyArea.enabled = false;
			}
			if (saltWaterArea != null)
			{
				saltWaterArea.enabled = false;
			}
			if (lobbyArea != null)
			{
				lobbyArea.enabled = false;
			}
			PlayAudio(AudioMode.Foot);
			if (dataManager.userData.rightHand)
			{
				playerTansform.position = new Vector3(vrPointerR.detectedCollider.transform.position.x, 0f, vrPointerR.detectedCollider.transform.position.z);
				RotateFront(vrPointerR.detectedCollider.transform);
			}
			else
			{
				playerTansform.position = new Vector3(vrPointerL.detectedCollider.transform.position.x, 0f, vrPointerL.detectedCollider.transform.position.z);
				RotateFront(vrPointerL.detectedCollider.transform);
			}
			ChangeHeight(cameraHeightInStand);
		}
	}

	private void Walk(WalkDirection directionValue)
	{
		float num = ((directionValue == WalkDirection.Foward) ? 1f : (-0.5f));
		normalDirection = Vector3.Normalize(new Vector3(centerEyeTransform.forward.x, 0f, centerEyeTransform.forward.z));
		direction = num * normalDirection * 0.2f - Vector3.up;
		if (Physics.Raycast(new Ray(new Vector3(centerEyeTransform.position.x, 2f, centerEyeTransform.position.z), direction), out var hitInfo, 3f))
		{
			if (dataManager.targetPlatform != 0)
			{
				lastTrackingPos = centerEyeTransform.transform.position;
			}
			if (isSit)
			{
				return;
			}
			switch (DetectCollider(hitInfo))
			{
			case DetectObject.Floor:
				curPlayerArea = playerArea.room;
				if (main.lobbyId == 0 && trophyManager != null)
				{
					trophyManager.hideAll();
				}
				if (screenArea != null)
				{
					screenArea.enabled = true;
				}
				if (trophyArea != null)
				{
					trophyArea.enabled = false;
				}
				PlayAudio(AudioMode.Foot);
				base.transform.Translate(normalDirection * Time.deltaTime * dataManager.userData.walkCabin * 1.5f * num);
				ChangeHeight(cameraHeightInStand);
				break;
			case DetectObject.Porch:
				curPlayerArea = playerArea.porch;
				screenArea.enabled = false;
				trophyArea.enabled = false;
				PlayAudio(AudioMode.Foot);
				base.transform.Translate(normalDirection * Time.deltaTime * dataManager.userData.walkCabin * 1.5f * num);
				ChangeHeight(cameraHeightInStand);
				break;
			case DetectObject.PorchChair:
				curPlayerArea = playerArea.porch;
				screenArea.enabled = false;
				trophyArea.enabled = false;
				isSit = true;
				StartCoroutine(sitDelay());
				PlayAudio(AudioMode.Sit);
				playerTansform.position = new Vector3(hitInfo.collider.transform.position.x, 0f, hitInfo.collider.transform.position.z);
				RotateFront(hitInfo.collider.transform);
				ChangeHeight(cameraHeightInSit);
				break;
			case DetectObject.Deck:
				curPlayerArea = playerArea.deck;
				screenArea.enabled = false;
				trophyArea.enabled = false;
				PlayAudio(AudioMode.Foot);
				base.transform.Translate(normalDirection * Time.deltaTime * dataManager.userData.walkCabin * 1.5f * num);
				ChangeHeight(cameraHeightInStand);
				break;
			case DetectObject.DeckChair:
				curPlayerArea = playerArea.deck;
				screenArea.enabled = false;
				trophyArea.enabled = false;
				isSit = true;
				StartCoroutine(sitDelay());
				PlayAudio(AudioMode.Sit);
				playerTansform.position = new Vector3(hitInfo.collider.transform.position.x, 0f, hitInfo.collider.transform.position.z);
				RotateFront(hitInfo.collider.transform);
				ChangeHeight(cameraHeightInSit);
				break;
			case DetectObject.RoomChair:
				curPlayerArea = playerArea.room;
				screenArea.enabled = false;
				trophyArea.enabled = false;
				isSit = true;
				StartCoroutine(sitDelay());
				PlayAudio(AudioMode.Sit);
				playerTansform.position = new Vector3(hitInfo.collider.transform.position.x, 0f, hitInfo.collider.transform.position.z);
				RotateFront(hitInfo.collider.transform);
				ChangeHeight(cameraHeightInSit);
				break;
			case DetectObject.Screen:
				curPlayerArea = playerArea.room;
				screenArea.enabled = true;
				trophyArea.enabled = false;
				PlayAudio(AudioMode.Foot);
				base.transform.Translate(normalDirection * Time.deltaTime * dataManager.userData.walkCabin * 1.5f * num);
				ChangeHeight(cameraHeightInStand);
				break;
			case DetectObject.Door:
				PlayAudio(AudioMode.Foot);
				screenArea.enabled = false;
				trophyArea.enabled = false;
				hitInfo.collider.GetComponent<doorOpenClose>().openDoor();
				break;
			case DetectObject.Window:
				PlayAudio(AudioMode.Foot);
				screenArea.enabled = false;
				trophyArea.enabled = false;
				hitInfo.collider.GetComponent<doorOpenClose>().openDoor();
				break;
			case DetectObject.Trophyset:
				curPlayerArea = playerArea.room;
				screenArea.enabled = false;
				trophyArea.enabled = true;
				PlayAudio(AudioMode.Foot);
				base.transform.Translate(normalDirection * Time.deltaTime * dataManager.userData.walkCabin * 1.5f * num);
				ChangeHeight(cameraHeightInStand);
				break;
			case DetectObject.Mirror:
				curPlayerArea = playerArea.privateroom;
				mirrorArea.enabled = true;
				PlayAudio(AudioMode.Foot);
				base.transform.Translate(normalDirection * Time.deltaTime * dataManager.userData.walkCabin * 1.5f * num);
				ChangeHeight(cameraHeightInStand);
				break;
			case DetectObject.SaltwaterLobby:
				if (saltWaterArea != null)
				{
					saltWaterArea.enabled = true;
				}
				staticLoading.Stage = "Lobby_KR_sea";
				if (PhotonNetwork.InRoom && PhotonNetwork.IsMasterClient)
				{
					MultiplayEventManager.Instance.GoFishingEvent();
				}
				else if (PhotonNetwork.InRoom && !PhotonNetwork.IsMasterClient)
				{
					break;
				}
				SceneManager.LoadScene("Loading");
				break;
			case DetectObject.Lobby:
				if (lobbyArea != null)
				{
					lobbyArea.enabled = true;
				}
				staticLoading.Stage = "Lobby";
				if (PhotonNetwork.IsMasterClient && PhotonNetwork.InRoom)
				{
					MultiplayEventManager.Instance.GoFishingEvent();
				}
				else if (!PhotonNetwork.IsMasterClient && PhotonNetwork.InRoom)
				{
					break;
				}
				SceneManager.LoadScene("Loading");
				break;
			case DetectObject.PrivateRoom:
				curPlayerArea = playerArea.privateroom;
				if (lobbyArea != null)
				{
					lobbyArea.enabled = true;
				}
				staticLoading.Stage = "PrivateRoom";
				SceneManager.LoadScene("Loading");
				break;
			case DetectObject.Control:
			case DetectObject.Trophy:
			case DetectObject.DragArea:
				break;
			}
		}
		else if (dataManager.targetPlatform != 0 && walkableQuest)
		{
			ResetCameraPosition(isMove: true);
			playerTansform.position = new Vector3(lastTrackingPos.x, 0f, lastTrackingPos.z);
			walkableQuest = false;
		}
	}

	public void HideAreaAll()
	{
		if (screenArea != null)
		{
			screenArea.enabled = false;
		}
		if (trophyArea != null)
		{
			trophyArea.enabled = false;
		}
		if (saltWaterArea != null)
		{
			saltWaterArea.enabled = false;
		}
		if (lobbyArea != null)
		{
			lobbyArea.enabled = false;
		}
		if (privateRoomArea != null)
		{
			privateRoomArea.enabled = false;
		}
		if (mirrorArea != null)
		{
			mirrorArea.enabled = false;
		}
	}

	private IEnumerator sitDelay()
	{
		yield return new WaitForSeconds(1f);
		bool loop = true;
		while (loop)
		{
			if (VRInput.Touch_Up_Stay(VRInput.eController.mainhand))
			{
				PlayAudio(AudioMode.Sit);
				base.transform.Translate(normalDirection * Time.deltaTime * dataManager.userData.walkCabin * 1.5f);
				ChangeHeight(cameraHeightInStand);
			}
			if (Physics.Raycast(new Ray(new Vector3(centerEyeTransform.position.x, 2f, centerEyeTransform.position.z), direction), out var hitInfo, 3f) && (hitInfo.collider.CompareTag("floor") || hitInfo.collider.CompareTag("porch") || hitInfo.collider.CompareTag("control")))
			{
				loop = false;
				isSit = false;
			}
			yield return null;
		}
	}

	public void SetHeight(int num)
	{
		dataManager.lobbyCamHeight = cameraHeightPerStep * (float)num;
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			ovrCameraRig.transform.localPosition = new Vector3(0f, currentCameraHeight + dataManager.lobbyCamHeight, 0f);
		}
		else
		{
			ovrCameraRig.transform.localPosition = new Vector3(0f, dataManager.lobbyCamHeight, 0f);
		}
	}

	private void ChangeHeight(float height)
	{
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			currentCameraHeight = height;
			ovrCameraRig.transform.localPosition = new Vector3(0f, currentCameraHeight, 0f);
		}
	}

	private void RotateFront(Transform trans)
	{
		ovrCameraRig.transform.rotation = trans.rotation;
	}

	public void MoveToTV()
	{
		PlayAudio(AudioMode.Foot);
		if (main.lobbyId == 0 && !dataManager.userData.ignoreTutorial)
		{
			main.startTutoController.tutorialStart();
		}
		if (screenArea != null)
		{
			screenArea.enabled = true;
		}
		if (trophyArea != null)
		{
			trophyArea.enabled = false;
		}
		if (tvTransform != null)
		{
			playerTansform.position = new Vector3(tvTransform.position.x, 0f, tvTransform.position.z);
			RotateFront(tvTransform);
		}
		ChangeHeight(cameraHeightInStand);
	}

	private void PlayAudio(AudioMode audioMode)
	{
		if (audioMode == AudioMode.Foot)
		{
			audioSource.clip = footClip;
		}
		else
		{
			audioSource.clip = sitClip;
		}
		if (!audioSource.isPlaying)
		{
			audioSource.Play();
		}
	}

	public DetectObject DetectCollider(RaycastHit hit)
	{
		if (hit.collider.CompareTag("floor"))
		{
			return DetectObject.Floor;
		}
		if (hit.collider.CompareTag("porch"))
		{
			return DetectObject.Porch;
		}
		if (hit.collider.CompareTag("porchchair"))
		{
			return DetectObject.PorchChair;
		}
		if (hit.collider.CompareTag("deck"))
		{
			return DetectObject.Deck;
		}
		if (hit.collider.CompareTag("deckchair"))
		{
			return DetectObject.DeckChair;
		}
		if (hit.collider.CompareTag("chair"))
		{
			return DetectObject.RoomChair;
		}
		if (hit.collider.CompareTag("screen"))
		{
			return DetectObject.Screen;
		}
		if (hit.collider.CompareTag("trophyset"))
		{
			return DetectObject.Trophyset;
		}
		if (hit.collider.CompareTag("saltwaterLobby"))
		{
			return DetectObject.SaltwaterLobby;
		}
		if (hit.collider.CompareTag("lobby"))
		{
			return DetectObject.Lobby;
		}
		if (hit.collider.CompareTag("PrivateRoom"))
		{
			return DetectObject.PrivateRoom;
		}
		if (hit.collider.CompareTag("Mirror"))
		{
			return DetectObject.Mirror;
		}
		if (hit.collider.CompareTag("door"))
		{
			return DetectObject.Door;
		}
		if (hit.collider.CompareTag("window"))
		{
			return DetectObject.Window;
		}
		if (hit.collider.CompareTag("ignore"))
		{
			return DetectObject.Ignore;
		}
		return DetectObject.None;
	}
}
public abstract class VRPointerBase : MonoBehaviour
{
	[HideInInspector]
	public VRInputModule vrInputModule;

	public Transform rayStartTransform;

	public float maxLength = 10f;

	[HideInInspector]
	public LineRenderer lineRenderer;

	[HideInInspector]
	public Material lineMaterial;

	public Color rightColor = new Color(0.5019608f, 0.9568627f, 1f, 1f);

	public Color wrongColor = new Color(1f, 0.6627451f, 0f, 1f);

	public DetectObject detectedObject;

	public Collider detectedCollider;

	public GameObject uiMarker;

	public Vector3 _startPoint;

	public Vector3 _forward;

	public Vector3 _endPoint;

	private RaycastResult result;

	[HideInInspector]
	public bool _hitTarget;

	public bool isRaycastingLineDrawing;

	public abstract void SetCursorRay(Transform t);

	public abstract void SetCursorStartDest(Vector3 start, Vector3 dest, Vector3 normal);

	public abstract void SetCursorStartDest(Vector3 start, Vector3 dest, Vector3 normal, RaycastHit result);

	public virtual void Awake()
	{
		vrInputModule = UnityEngine.Object.FindObjectOfType<VRInputModule>();
		lineRenderer = GetComponent<LineRenderer>();
		lineMaterial = lineRenderer.material;
		lineRenderer.enabled = false;
		if ((bool)uiMarker)
		{
			uiMarker.SetActive(value: false);
		}
		isRaycastingLineDrawing = false;
	}

	public virtual void Reset()
	{
		if ((bool)uiMarker)
		{
			uiMarker.SetActive(value: false);
		}
		lineRenderer.enabled = false;
		detectedObject = DetectObject.None;
		isRaycastingLineDrawing = false;
	}
}
public class VRTeleportController : MonoBehaviour
{
	private void Start()
	{
	}

	private void Update()
	{
	}
}
[RequireComponent(typeof(Canvas))]
public class VRUIRaycaster : GraphicRaycaster, IPointerEnterHandler, IEventSystemHandler
{
	private struct RaycastHit
	{
		public Graphic graphic;

		public Vector3 worldPos;

		public bool fromMouse;
	}

	public int sortOrder = 21;

	public Camera centerCamera;

	[NonSerialized]
	private Canvas m_Canvas;

	public float distance = 4f;

	private DataManager dataManager;

	[NonSerialized]
	private List<RaycastHit> m_RaycastResults = new List<RaycastHit>();

	[NonSerialized]
	private static readonly List<RaycastHit> s_SortedGraphics = new List<RaycastHit>();

	private Canvas canvas
	{
		get
		{
			if (m_Canvas != null)
			{
				return m_Canvas;
			}
			m_Canvas = GetComponent<Canvas>();
			return m_Canvas;
		}
	}

	public override Camera eventCamera => canvas.worldCamera;

	public override int sortOrderPriority => sortOrder;

	protected override void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
	}

	protected override void Start()
	{
		if (!canvas.worldCamera)
		{
			if (dataManager.targetPlatform != DEVICE_TYPE.OTHERS)
			{
				OVRCameraRig oVRCameraRig = UnityEngine.Object.FindObjectOfType<OVRCameraRig>();
				canvas.worldCamera = oVRCameraRig.centerEyeAnchor.gameObject.GetComponent<Camera>();
			}
			else if (centerCamera != null)
			{
				canvas.worldCamera = centerCamera;
			}
		}
		else if (dataManager.targetPlatform != DEVICE_TYPE.OTHERS)
		{
			OVRCameraRig oVRCameraRig2 = UnityEngine.Object.FindObjectOfType<OVRCameraRig>();
			canvas.worldCamera = oVRCameraRig2.centerEyeAnchor.gameObject.GetComponent<Camera>();
		}
		else if (centerCamera != null)
		{
			canvas.worldCamera = centerCamera;
		}
	}

	private void Update()
	{
	}

	private void Raycast(PointerEventData eventData, List<RaycastResult> resultAppendList, Ray ray, bool checkForBlocking)
	{
		if (canvas == null)
		{
			return;
		}
		float num = distance + 1f;
		if (checkForBlocking && base.blockingObjects != 0)
		{
			float num2 = distance;
			if ((base.blockingObjects == BlockingObjects.ThreeD || base.blockingObjects == BlockingObjects.All) && Physics.Raycast(ray, out var hitInfo, num2, m_BlockingMask) && hitInfo.distance < num)
			{
				num = hitInfo.distance;
			}
			if (base.blockingObjects == BlockingObjects.TwoD || base.blockingObjects == BlockingObjects.All)
			{
				RaycastHit2D rayIntersection = Physics2D.GetRayIntersection(ray, num2, m_BlockingMask);
				if ((bool)rayIntersection && rayIntersection.fraction * num2 < num)
				{
					num = rayIntersection.fraction * num2;
				}
			}
		}
		m_RaycastResults.Clear();
		GraphicRaycast(canvas, ray, m_RaycastResults);
		for (int i = 0; i < m_RaycastResults.Count; i++)
		{
			GameObject gameObject = m_RaycastResults[i].graphic.gameObject;
			if (gameObject.GetComponent<Image>() != null && !gameObject.GetComponent<Image>().raycastTarget)
			{
				break;
			}
			bool flag = true;
			if (base.ignoreReversedGraphics)
			{
				Vector3 direction = ray.direction;
				Vector3 rhs = gameObject.transform.rotation * Vector3.forward;
				flag = Vector3.Dot(direction, rhs) > 0f;
			}
			if (eventCamera.transform.InverseTransformPoint(m_RaycastResults[i].worldPos).z <= 0f)
			{
				flag = false;
			}
			if (flag)
			{
				float num3 = Vector3.Distance(ray.origin, m_RaycastResults[i].worldPos);
				if (!(num3 >= num))
				{
					RaycastResult raycastResult = default(RaycastResult);
					raycastResult.gameObject = gameObject;
					raycastResult.module = this;
					raycastResult.distance = num3;
					raycastResult.index = resultAppendList.Count;
					raycastResult.depth = m_RaycastResults[i].graphic.depth;
					raycastResult.worldPosition = m_RaycastResults[i].worldPos;
					RaycastResult item = raycastResult;
					resultAppendList.Add(item);
				}
			}
		}
	}

	public override void Raycast(PointerEventData eventData, List<RaycastResult> resultAppendList)
	{
		if (eventData.isVRPointer())
		{
			Raycast(eventData, resultAppendList, eventData.GetRayData(), checkForBlocking: true);
		}
	}

	private void GraphicRaycast(Canvas canvas, Ray ray, List<RaycastHit> results)
	{
		IList<Graphic> graphicsForCanvas = GraphicRegistry.GetGraphicsForCanvas(canvas);
		s_SortedGraphics.Clear();
		RaycastHit item = default(RaycastHit);
		for (int i = 0; i < graphicsForCanvas.Count; i++)
		{
			Graphic graphic = graphicsForCanvas[i];
			if (graphic.depth != -1 && RayIntersectsRectTransform(graphic.rectTransform, ray, out var worldPos))
			{
				Vector2 sp = eventCamera.WorldToScreenPoint(worldPos);
				if (graphic.Raycast(sp, eventCamera))
				{
					item.graphic = graphic;
					item.worldPos = worldPos;
					item.fromMouse = false;
					s_SortedGraphics.Add(item);
				}
			}
		}
		s_SortedGraphics.Sort((RaycastHit g1, RaycastHit g2) => g2.graphic.depth.CompareTo(g1.graphic.depth));
		for (int j = 0; j < s_SortedGraphics.Count; j++)
		{
			results.Add(s_SortedGraphics[j]);
		}
	}

	public Vector2 GetScreenPosition(RaycastResult raycastResult)
	{
		return eventCamera.WorldToScreenPoint(raycastResult.worldPosition);
	}

	private static bool RayIntersectsRectTransform(RectTransform rectTransform, Ray ray, out Vector3 worldPos)
	{
		Vector3[] array = new Vector3[4];
		rectTransform.GetWorldCorners(array);
		if (!new Plane(array[0], array[1], array[2]).Raycast(ray, out var enter))
		{
			worldPos = Vector3.zero;
			return false;
		}
		Vector3 point = ray.GetPoint(enter);
		Vector3 vector = array[3] - array[0];
		Vector3 vector2 = array[1] - array[0];
		float num = Vector3.Dot(point - array[0], vector);
		float num2 = Vector3.Dot(point - array[0], vector2);
		if (num < vector.sqrMagnitude && num2 < vector2.sqrMagnitude && num >= 0f && num2 >= 0f)
		{
			worldPos = array[0] + num2 * vector2 / vector2.sqrMagnitude + num * vector / vector.sqrMagnitude;
			return true;
		}
		worldPos = Vector3.zero;
		return false;
	}

	public void OnPointerEnter(PointerEventData e)
	{
		if (e.isVRPointer())
		{
			VRInputModule vRInputModule = EventSystem.current.currentInputModule as VRInputModule;
			if (vRInputModule != null)
			{
				vRInputModule.activeGraphicRaycaster = this;
			}
		}
	}
}
public class InputAxis : MonoBehaviour
{
	[HideInInspector]
	public bool gotAxisLeft;

	[HideInInspector]
	public bool gotAxisRight;

	[HideInInspector]
	public bool gotAxisUp;

	[HideInInspector]
	public bool gotAxisDown;

	private void Start()
	{
	}

	public bool InputLeft()
	{
		if (Input.GetAxisRaw("Left_X_Axis") > 0.8f || Input.GetKeyDown("left") || Input.GetAxisRaw("DPadX") > 0.8f)
		{
			if (!gotAxisLeft)
			{
				gotAxisLeft = true;
				return true;
			}
		}
		else
		{
			gotAxisLeft = false;
		}
		return false;
	}

	public bool InputRight()
	{
		if (Input.GetAxisRaw("Left_X_Axis") < -0.8f || Input.GetKeyDown("right") || Input.GetAxisRaw("DPadX") < -0.8f)
		{
			if (!gotAxisRight)
			{
				gotAxisRight = true;
				return true;
			}
		}
		else
		{
			gotAxisRight = false;
		}
		return false;
	}

	public bool InputUp()
	{
		if (Input.GetAxisRaw("Left_Y_Axis") > 0.8f || Input.GetKeyDown("up") || Input.GetAxisRaw("DPadY") > 0.8f)
		{
			if (!gotAxisUp)
			{
				gotAxisUp = true;
				return true;
			}
		}
		else
		{
			gotAxisUp = false;
		}
		return false;
	}

	public bool InputDown()
	{
		if (Input.GetAxisRaw("Left_Y_Axis") < -0.8f || Input.GetKeyDown("down") || Input.GetAxisRaw("DPadY") < -0.8f)
		{
			if (!gotAxisDown)
			{
				gotAxisDown = true;
				return true;
			}
		}
		else
		{
			gotAxisDown = false;
		}
		return false;
	}
}
public class FurnitureManager : MonoBehaviour
{
	public bool isCreated;

	public GameObject furniturePanel;

	public GameObject furniturePrefab;

	public GameObject furnitureContent;

	public FurniturePopupContainer furniturePopup;

	public string furnitureInfoPopupText_store = "PURCHASE IT AT THE STORE TO ACTIVATE";

	public string furnitureInfoPopupText_achive = "UNLOCK ACHIEVEMENTS TO ACTIVATE";

	public GameObject[] furnitures;

	private DataManager dataManager;

	private Main main;

	public List<GameObject> furnitureUIItems = new List<GameObject>();

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		furniturePanel.SetActive(value: true);
	}

	private void Start()
	{
	}

	private void OnEnable()
	{
		CreateFurnitureItems();
	}

	private void CreateFurnitureItems()
	{
		foreach (GameObject furnitureUIItem in furnitureUIItems)
		{
			UnityEngine.Object.Destroy(furnitureUIItem);
		}
		furnitureUIItems.Clear();
		FurnitureDataList furnitureDataList = dataManager.userData.furnitures[main.nationId].rooms[main.lobbyId];
		for (int i = 0; i < furnitureDataList.items.Count; i++)
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(furniturePrefab, furnitureContent.transform);
			gameObject.GetComponent<InteriorFurnitureItem>().id = dataManager.ItemDatabase.dlcs[dataManager.currentNation].furnitureItems[i].ID;
			gameObject.GetComponent<InteriorFurnitureItem>().itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.dlcs[dataManager.currentNation].furnitureItems[i].nameKey);
			gameObject.GetComponent<InteriorFurnitureItem>().image.sprite = dataManager.ItemDatabase.dlcs[dataManager.currentNation].furnitureItems[i].descImage;
			gameObject.GetComponent<InteriorFurnitureItem>().achievementItem = dataManager.ItemDatabase.dlcs[dataManager.currentNation].furnitureItems[i].achievementItem;
			gameObject.GetComponent<InteriorFurnitureItem>().SetToggle(furnitureDataList.items[i].state);
			gameObject.GetComponent<InteriorFurnitureItem>().ShowToggle(furnitureDataList.items[i].purchased);
			furnitureUIItems.Add(gameObject);
		}
	}

	public void ShowFurniturePopup(bool isaAhievementItem)
	{
		if (!isaAhievementItem)
		{
			furniturePopup.SetText(furnitureInfoPopupText_store);
		}
		else
		{
			furniturePopup.SetText(furnitureInfoPopupText_achive);
		}
		furniturePopup.gameObject.SetActive(value: true);
	}

	public void HideFurniturePopup()
	{
		furniturePopup.gameObject.SetActive(value: false);
	}

	public void SetFurniture(int id, bool OnOff)
	{
		main.furnitureController.furniturePrefabs[id].SetActive(OnOff);
	}
}
public class FurniturePopupContainer : MonoBehaviour
{
	public Text desc;

	public void SetText(string text)
	{
		desc.text = text;
	}

	public void Close()
	{
		Singleton<Main>.Instance.furnitureManager.HideFurniturePopup();
	}
}
public class InteriorFurnitureItem : MonoBehaviour
{
	public int id;

	public Text itemName;

	public Image image;

	public Image toggle;

	public Sprite[] toggleImages;

	private bool On;

	public bool achievementItem;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	public void ShowToggle(bool value)
	{
		toggle.gameObject.SetActive(value);
	}

	public void SetToggle(bool value)
	{
		if (value)
		{
			On = true;
			toggle.sprite = toggleImages[1];
			dataManager.userData.furnitures[main.nationId].rooms[main.lobbyId].items[id].state = true;
			main.furnitureManager.SetFurniture(id, On);
		}
		else
		{
			On = false;
			toggle.sprite = toggleImages[0];
			dataManager.userData.furnitures[main.nationId].rooms[main.lobbyId].items[id].state = false;
			main.furnitureManager.SetFurniture(id, On);
		}
	}

	public void ToggleEvent()
	{
		On = !On;
		SetToggle(On);
		dataManager.SaveUserData();
	}

	public void OnPointerEnter(PointerEventData pointerEventData)
	{
		if (!toggle.gameObject.activeInHierarchy)
		{
			main.furnitureManager.ShowFurniturePopup(achievementItem);
		}
	}

	public void OnPointerExit(PointerEventData pointerEventData)
	{
		main.furnitureManager.HideFurniturePopup();
	}
}
public class InteriorManager : MonoBehaviour
{
	public List<ToggleTab> tabs;

	public List<GameObject> panels;

	public GameObject wallCategory;

	public GameObject decoCategory;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		if (main.lobbyId == 0)
		{
			tabs[1].gameObject.SetActive(value: false);
			return;
		}
		wallCategory.SetActive(value: false);
		decoCategory.SetActive(value: false);
	}

	private void OnEnable()
	{
		panels[0].SetActive(value: true);
	}

	public void ClickTab(int index)
	{
		tabs[index].ClickTab();
		UnClickTab(index);
		ShowItems(index);
	}

	public void UnClickTab(int index)
	{
		for (int i = 0; i < tabs.Count; i++)
		{
			if (i != index && tabs[i].gameObject.activeInHierarchy)
			{
				tabs[i].UnClickTab();
			}
		}
	}

	private void ShowItems(int index)
	{
		for (int i = 0; i < tabs.Count; i++)
		{
			if (i == index)
			{
				panels[i].SetActive(value: true);
			}
			else
			{
				panels[i].SetActive(value: false);
			}
		}
	}
}
public interface IProgress
{
	float Progress { get; }

	string Message { get; }
}
public class InventoryItem : MonoBehaviour, IPointerEnterHandler, IEventSystemHandler, IPointerExitHandler, IPointerClickHandler
{
	public int id;

	public InventoryUIManager uiInventoryManager;

	private void Awake()
	{
		GetComponent<Image>().sprite = Singleton<DataManager>.Instance.ItemDatabase.propItems[id].equipImage;
	}

	public void OnPointerEnter(PointerEventData eventData)
	{
		uiInventoryManager.OnEnterItem(id);
	}

	public void OnPointerExit(PointerEventData eventData)
	{
		uiInventoryManager.OnExitItem(id);
	}

	public void OnPointerClick(PointerEventData eventData)
	{
	}

	public void OnGrab(Transform HandTr)
	{
		uiInventoryManager.OnSelectItemByGrab(id, HandTr);
	}
}
public class InventoryUIManager : MonoBehaviour
{
	public Text overText;

	private void Awake()
	{
		overText.text = "";
	}

	private void Start()
	{
	}

	public void OnEnterItem(int index)
	{
		overText.gameObject.SetActive(value: true);
		overText.text = Singleton<DataManager>.Instance.ItemDatabase.propItems[index].ItemName;
	}

	public void OnExitItem(int index)
	{
		overText.gameObject.SetActive(value: false);
		overText.text = "";
	}

	public void OnSelectItem(int index)
	{
		GameObject prefab = Singleton<DataManager>.Instance.ItemDatabase.propItems[index].prefab;
		int num = -1;
		int num2 = -1;
		if (Singleton<Main>.Instance.vrInputModule.gameObjectClickL != null && Singleton<Main>.Instance.vrInputModule.gameObjectClickL.GetComponent<InventoryItem>() != null)
		{
			num = Singleton<Main>.Instance.vrInputModule.gameObjectClickL.GetComponent<InventoryItem>().id;
		}
		if (Singleton<Main>.Instance.vrInputModule.gameObjectClickR != null && Singleton<Main>.Instance.vrInputModule.gameObjectClickR.GetComponent<InventoryItem>() != null)
		{
			num2 = Singleton<Main>.Instance.vrInputModule.gameObjectClickR.GetComponent<InventoryItem>().id;
		}
		if (Singleton<Main>.Instance.vrInputModule.gameObjectClickL != null && num == index)
		{
			SelectItem(prefab, Singleton<Main>.Instance.leftHandTransform);
		}
		if (Singleton<Main>.Instance.vrInputModule.gameObjectClickR != null && num2 == index)
		{
			SelectItem(prefab, Singleton<Main>.Instance.rightHandTransform);
		}
	}

	public void OnSelectItemByGrab(int index, Transform handTr)
	{
		GameObject prefab = Singleton<DataManager>.Instance.ItemDatabase.propItems[index].prefab;
		SelectItem(prefab, handTr);
	}

	private void SelectItem(GameObject item, Transform handTr)
	{
		RVRFGrabber componentInChildren = handTr.GetComponentInChildren<RVRFGrabber>();
		if (!(componentInChildren.grabbedObject != null))
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(item, handTr);
			gameObject.transform.position = handTr.position;
			gameObject.GetComponent<RVRFGrabbable>().GrabBegin(componentInChildren, componentInChildren.GetComponent<Collider>());
			componentInChildren._grabbedObject = gameObject.GetComponent<RVRFGrabbable>();
		}
	}
}
[CreateAssetMenu(menuName = "Items/Animal Item")]
public class AnimalItem : ScriptableObject
{
	[SerializeField]
	private int id;

	public string ItemName;

	public AquariumType type;

	public bool achievementItem;

	public Sprite descImage;

	public string nameKey;

	public int ID => id;
}
public enum AquariumType
{
	WALL,
	DECORATION
}
[CreateAssetMenu(menuName = "Items/Aqua Item")]
public class AquaItem : Item
{
	public int nationId;

	public int lobbyId;

	public int price;

	public string info;

	public int unlocklv;

	public AquariumType type;

	public bool achievementItem;

	public bool defaultItem;

	public bool state;

	public string nameKey;

	public string descKey;
}
[CreateAssetMenu(menuName = "Items/Boat Item")]
public class BoatItem : Item
{
	public int price;

	public int grade;

	public string info;

	public int unlocklv;

	public string nameKey;

	public string descKey;
}
[CreateAssetMenu(menuName = "Items/Eyebrow Item")]
public class EyebrowItem : ScriptableObject
{
	[SerializeField]
	private int id;

	public string ItemName;

	public Sprite itemImage;

	public GameObject prefab;

	public int ID => id;
}
[CreateAssetMenu(menuName = "Items/Eye Item")]
public class EyeItem : ScriptableObject
{
	[SerializeField]
	private int id;

	public string ItemName;

	public Sprite itemImage;

	public GameObject prefab;

	public int ID => id;
}
[Serializable]
public class AgeTexture
{
	public Texture[] diffuseMap;

	public Texture[] normalMap;
}
[CreateAssetMenu(menuName = "Items/Face Item")]
public class FaceItem : ScriptableObject
{
	[SerializeField]
	private int id;

	public string ItemName;

	public Sprite itemImage;

	public GameObject prefab;

	public GameObject eyePrefab;

	public GameObject eyeShadowPrefab;

	public AgeTexture ageTexture;

	public int ID => id;
}
[CreateAssetMenu(menuName = "Items/Fish Item")]
public class FishItem : Item
{
	public float basicSize;

	public float minSize;

	public float maxSize;

	public int weight;

	public int grade;

	public float life;

	public float power;

	public float speed;

	public float redirect;

	public float recovery;

	public float bonus;

	public bool boss;

	public bool drag;

	public bool jump;

	public float jumpHeight = 1f;

	public float depthWater;

	public int[] fishbait;

	public int[] fishhabitat;

	public int fishRare;

	public List<int> rooms = new List<int> { 0 };

	public string nameKey;

	public string multiLineNameKey;

	public string descKey;
}
[CreateAssetMenu(menuName = "Items/Furniture Item")]
public class FurnitureItem : Item
{
	public int nationId;

	public int lobbyId;

	public int price;

	public string info;

	public int unlocklv;

	public bool achievementItem;

	public bool defaultItem;

	public bool state;

	public string nameKey;

	public string descKey;
}
[CreateAssetMenu(menuName = "Items/Glasses Item")]
public class GlassesItem : ScriptableObject
{
	[SerializeField]
	private int id;

	public string ItemName;

	public Sprite itemImage;

	public bool isPurchased;

	public GameObject prefab;

	public int ID => id;
}
[CreateAssetMenu(menuName = "Items/Glove Item")]
public class GloveItem : Item
{
	public int price;

	public int type;

	public int grade;

	public string info;

	public int unlocklv;

	public int seasonRewardNumber;

	public Texture mainTex;

	public Texture normalTex;

	public Texture specularTex;

	public string nameKey;

	public string descKey;
}
[CreateAssetMenu(menuName = "Items/Hair Item")]
public class HairItem : ScriptableObject
{
	[SerializeField]
	private int id;

	public string ItemName;

	public Sprite itemImage;

	public GameObject prefab;

	public int ID => id;
}
[CreateAssetMenu(menuName = "Items/Hat Item")]
public class HatItem : ScriptableObject
{
	[SerializeField]
	private int id;

	public string ItemName;

	public Sprite itemImage;

	public bool isPurchased;

	public GameObject prefab;

	public int ID => id;
}
[CreateAssetMenu(menuName = "Items/Innerfit Item")]
public class InnerfitItem : ScriptableObject
{
	[SerializeField]
	private int id;

	public string ItemName;

	public Sprite itemImage;

	public bool isPurchased;

	public GameObject prefab;

	public int ID => id;
}
public enum ItemType
{
	RodS,
	RodC,
	ReelS,
	ReelC,
	Lure,
	Line,
	Fish,
	Aquarium,
	Glove,
	Nation,
	Room,
	Furniture,
	Boat,
	Prop,
	Junk
}
[CreateAssetMenu(menuName = "Items/Item")]
public class Item : ScriptableObject
{
	[SerializeField]
	private int id;

	public string ItemName;

	public Sprite equipImage;

	public Sprite descImage;

	public Sprite shopIconImage;

	public ItemType itemType;

	protected static readonly StringBuilder descStrings = new StringBuilder();

	public bool isAchieveItem;

	public int ID => id;

	public virtual Item Get()
	{
		return this;
	}

	public virtual void Destroy()
	{
	}

	public virtual string GetItemType()
	{
		return itemType.ToString();
	}

	public virtual string GetDescription()
	{
		return "";
	}

	public virtual void Buy()
	{
	}

	public virtual void Remove()
	{
	}
}
[CreateAssetMenu(menuName = "Items/Line Item")]
public class LineItem : Item
{
	public int price;

	public int durability;
}
public enum LUREGRADE
{
	C,
	B,
	A
}
[CreateAssetMenu(menuName = "Items/Lure Item")]
public class LureItem : Item
{
	public int price;

	public int type;

	public LUREGRADE grade;

	public string target;

	public bool[] targetFish = new bool[4];

	public int range;

	public int stuck;

	public int[] fish;

	public string info;

	public int unlocklv;

	public string nameKey;

	public string descKey;
}
[CreateAssetMenu(menuName = "Items/Mustache Item")]
public class MustacheItem : ScriptableObject
{
	[SerializeField]
	private int id;

	public string ItemName;

	public Sprite itemImage;

	public GameObject prefab;

	public int ID => id;
}
[CreateAssetMenu(menuName = "Items/Nation Item")]
public class NationItem : Item
{
	public int price;

	public string info;

	public int unlocklv;

	public bool achievementItem;

	public string nameKey;
}
[CreateAssetMenu(menuName = "Items/Outfit Item")]
public class OutfitItem : ScriptableObject
{
	[SerializeField]
	private int id;

	public string ItemName;

	public Sprite itemImage;

	public bool isPurchased;

	public GameObject prefab;

	public int ID => id;
}
[CreateAssetMenu(menuName = "Items/Prop Item")]
public class PropItem : Item
{
	public int price;

	public string info;

	public int unlocklv;

	public bool isConsumable;

	public string nameKey;

	public string descKey;

	public GameObject prefab;
}
[CreateAssetMenu(menuName = "Items/Reel Item")]
public class ReelItem : Item
{
	public int price;

	public int grade;

	public int tension;

	public int power;

	public int length;

	public string info;

	public int unlocklv;

	public string nameKey;

	public string typeKey;

	public string descKey;

	public override Item Get()
	{
		return UnityEngine.Object.Instantiate(this);
	}

	public override void Destroy()
	{
		UnityEngine.Object.Destroy(this);
	}

	public override string GetDescription()
	{
		Item.descStrings.Length = 0;
		Item.descStrings.Append("아이템 설명");
		return Item.descStrings.ToString();
	}
}
[CreateAssetMenu(menuName = "Items/Rod Item")]
public class RodItem : Item
{
	public int price;

	public int grade;

	public int power;

	public int action;

	public int distance;

	public string info;

	public int unlocklv;

	public string nameKey;

	public string typeKey;

	public string descKey;
}
[CreateAssetMenu(menuName = "Items/Room Item")]
public class RoomItem : Item
{
	public int nationId;

	public string roomScene;

	public int price;

	public string info;

	public int unlocklv;

	public bool achievementItem;

	public bool defaultItem;

	public bool state;

	public string nameKey;

	public string multiLineNameKey;

	public string descKey;
}
public enum STAGETYPE
{
	LAKE,
	RIVER,
	BEACH,
	SEA
}
[CreateAssetMenu(menuName = "Items/Stage Item")]
public class StageItem : ScriptableObject
{
	public enum stageTimeType
	{
		real,
		day,
		sunset,
		night,
		rain
	}

	[Serializable]
	public class cStageFishType
	{
		public fishSetScript fishSet;

		public int catchRatio;
	}

	public int id;

	public string[] stageNameLanguages;

	public string[] stageTypenameLanguages;

	public int level;

	public string stageScene;

	public Sprite stageImage;

	public Sprite stageMap;

	public int stageType;

	public Sprite stageTypeImage;

	public int stageTime;

	public Sprite stageTimeImage;

	public float sharkRatio;

	public cStageFishType[] hugeFish;

	public cStageFishType[] largeFish;

	public cStageFishType[] middleFish;

	public cStageFishType[] smallFish;

	public float ratioStuff;

	public string nameKey;

	public string getStageName(bool addType)
	{
		if (addType)
		{
			return stageNameLanguages[Singleton<DataManager>.Instance.userData.language] + " " + stageTypenameLanguages[Singleton<DataManager>.Instance.userData.language];
		}
		return stageNameLanguages[Singleton<DataManager>.Instance.userData.language];
	}
}
[CreateAssetMenu(menuName = "Items/Toy Item")]
public class ToyItem : Item
{
	[Serializable]
	public class cStageStuffType
	{
		public fishSetScript fishSet;

		public int catchRatio;
	}

	public int price;

	public string info;

	public string nameKey;

	public string descKey;
}
[CreateAssetMenu(menuName = "Items/Watch Item")]
public class WatchItem : ScriptableObject
{
	[SerializeField]
	private int id;

	public string ItemName;

	public Sprite itemImage;

	public bool isPurchased;

	public GameObject prefab;

	public int ID => id;
}
public class Automata
{
	private const int startOfLetter = 4352;

	private const int startOfMedial = 4449;

	private const int startOfSyllable = 44032;

	private const int initialCount = 19;

	private const int medialCount = 21;

	private const int finalCount = 28;

	private const char medialInit = '.';

	private const char finalInit = '.';

	private string currentChar;

	private string result;

	private State state;

	private int initial;

	private int medial;

	private char medialFirst;

	private bool medialPossible;

	private int final;

	private char finalFirst;

	private char finalLast;

	private bool finalPossible;

	private int[] singleConsonants = new int[19]
	{
		12593, 12594, 12596, 12599, 12600, 12601, 12609, 12610, 12611, 12613,
		12614, 12615, 12616, 12617, 12618, 12619, 12620, 12621, 12622
	};

	private int[] singleVowels = new int[21]
	{
		12623, 12624, 12625, 12626, 12627, 12628, 12629, 12630, 12631, 12632,
		12633, 12634, 12635, 12636, 12637, 12638, 12639, 12640, 12641, 12642,
		12643
	};

	public bool UseSingleCharacter { get; set; }

	public Automata()
	{
		currentChar = string.Empty;
		result = string.Empty;
		state = State.Initial;
		initial = -1;
		medial = -1;
		medialFirst = '.';
		final = -1;
		finalFirst = '.';
		finalLast = '.';
	}

	private char GetSingleJa(int value)
	{
		byte[] bytes = BitConverter.GetBytes((short)(UseSingleCharacter ? singleConsonants[value] : (4352 + value)));
		return char.Parse(Encoding.Unicode.GetString(bytes));
	}

	private char GetSingleMo(int value)
	{
		byte[] bytes = BitConverter.GetBytes((short)(UseSingleCharacter ? singleVowels[value] : (4449 + value)));
		return char.Parse(Encoding.Unicode.GetString(bytes));
	}

	private char GetCompleteChar()
	{
		int num = 0;
		num = ((final >= 0) ? final : 0);
		byte[] bytes = BitConverter.GetBytes((short)(initial * 588 + medial * 28 + num + 44032));
		return char.Parse(Encoding.Unicode.GetString(bytes));
	}

	private char Filter(char ch)
	{
		if (ch == 'A')
		{
			ch = 'a';
		}
		if (ch == 'B')
		{
			ch = 'b';
		}
		if (ch == 'C')
		{
			ch = 'c';
		}
		if (ch == 'D')
		{
			ch = 'd';
		}
		if (ch == 'F')
		{
			ch = 'f';
		}
		if (ch == 'G')
		{
			ch = 'g';
		}
		if (ch == 'H')
		{
			ch = 'h';
		}
		if (ch == 'I')
		{
			ch = 'i';
		}
		if (ch == 'J')
		{
			ch = 'j';
		}
		if (ch == 'K')
		{
			ch = 'k';
		}
		if (ch == 'L')
		{
			ch = 'l';
		}
		if (ch == 'M')
		{
			ch = 'm';
		}
		if (ch == 'N')
		{
			ch = 'n';
		}
		if (ch == 'S')
		{
			ch = 's';
		}
		if (ch == 'U')
		{
			ch = 'u';
		}
		if (ch == 'V')
		{
			ch = 'v';
		}
		if (ch == 'X')
		{
			ch = 'x';
		}
		if (ch == 'Y')
		{
			ch = 'y';
		}
		if (ch == 'Z')
		{
			ch = 'z';
		}
		return ch;
	}

	public void Input(ref string source, char ch)
	{
		ch = Filter(ch);
		int num = ch;
		switch (num)
		{
		case 8:
			if (source.Length <= 0)
			{
				return;
			}
			if (state == State.Initial)
			{
				if (source.Length > 0)
				{
					source = source.Substring(0, source.Length - 1);
				}
			}
			else if (state == State.Medial && medialFirst.Equals('.'))
			{
				state = State.Initial;
				if (source.Length > 0)
				{
					source = source.Substring(0, source.Length - 1);
				}
			}
			else if (medialPossible && medial != 8 && medial != 13 && medial != 18 && finalFirst.Equals('.') && finalLast.Equals('.'))
			{
				state = State.Medial;
				if (source.Length > 0)
				{
					source = source.Substring(0, source.Length - 1);
				}
				medial = CheckMedial(medialFirst.ToString());
				final = -1;
				source += GetCompleteChar();
				medialPossible = true;
			}
			else if ((state == State.Final || state == State.Medial) && !medialFirst.Equals('.') && finalFirst.Equals('.') && finalLast.Equals('.'))
			{
				state = State.Medial;
				medialFirst = '.';
				medialPossible = false;
				medial = -1;
				if (source.Length > 0)
				{
					source = source.Substring(0, source.Length - 1);
				}
				source += GetSingleJa(initial);
			}
			else if (state == State.Final && !finalFirst.Equals('.') && !finalLast.Equals('.'))
			{
				state = State.Final;
				if (source.Length > 0)
				{
					source = source.Substring(0, source.Length - 1);
				}
				finalLast = '.';
				final = CheckFinal(finalFirst.ToString());
				source += GetCompleteChar();
				finalPossible = true;
			}
			else if (state == State.Final && !finalFirst.Equals('.'))
			{
				int num2 = CheckMedial(medialFirst.ToString());
				if (num2 == 8 || num2 == 13 || num2 == 18)
				{
					medialPossible = true;
					state = State.Medial;
				}
				else
				{
					state = State.Final;
				}
				if (source.Length > 0)
				{
					source = source.Substring(0, source.Length - 1);
				}
				final = -1;
				finalFirst = '.';
				source += GetCompleteChar();
			}
			return;
		default:
			if (num < 65 || num > 90)
			{
				initial = -1;
				medial = -1;
				final = -1;
				medialFirst = '.';
				finalFirst = '.';
				finalLast = '.';
				state = State.Initial;
				source += ch;
				return;
			}
			break;
		case 97:
		case 98:
		case 99:
		case 100:
		case 101:
		case 102:
		case 103:
		case 104:
		case 105:
		case 106:
		case 107:
		case 108:
		case 109:
		case 110:
		case 111:
		case 112:
		case 113:
		case 114:
		case 115:
		case 116:
		case 117:
		case 118:
		case 119:
		case 120:
		case 121:
		case 122:
			break;
		}
		if (state == State.Initial)
		{
			initial = CheckInitial(ch);
			if (initial >= 0)
			{
				state = State.Medial;
				source += GetSingleJa(initial);
			}
			else
			{
				state = State.Medial;
				Input(ref source, ch);
			}
		}
		else if (state == State.Medial)
		{
			if (medial < 0)
			{
				medial = CheckMedial(ch.ToString());
				if (medial < 0)
				{
					state = State.Initial;
					Input(ref source, ch);
					return;
				}
				if (initial < 0)
				{
					source += GetSingleMo(CheckMedial(ch.ToString()));
					state = State.Initial;
					medial = -1;
					return;
				}
				if (medial == 8 || medial == 13 || medial == 18)
				{
					medialPossible = true;
					state = State.Medial;
				}
				else
				{
					state = State.Final;
				}
				medialFirst = ch;
				if (source.Length > 0)
				{
					source = source.Substring(0, source.Length - 1);
				}
				source += GetCompleteChar();
				return;
			}
			string empty = string.Empty;
			empty += medialFirst;
			empty += ch;
			int num3 = CheckMedial(empty);
			if (num3 > 0)
			{
				medial = num3;
				if (source.Length > 0)
				{
					source = source.Substring(0, source.Length - 1);
				}
				source += GetCompleteChar();
				state = State.Final;
			}
			else
			{
				state = State.Final;
				Input(ref source, ch);
			}
		}
		else
		{
			if (state != State.Final)
			{
				return;
			}
			if (final < 0)
			{
				final = CheckFinal(ch.ToString());
				if (final > 0)
				{
					if (source.Length > 0)
					{
						source = source.Substring(0, source.Length - 1);
					}
					source += GetCompleteChar();
					finalFirst = ch;
					if (final == 1 || final == 4 || final == 8 || final == 17)
					{
						finalPossible = true;
					}
				}
				else if (CheckMedial(ch.ToString()) >= 0)
				{
					state = State.Medial;
					initial = -1;
					medial = -1;
					Input(ref source, ch);
				}
				else if (CheckInitial(ch) >= 0)
				{
					finalPossible = false;
					final = 0;
					Input(ref source, ch);
				}
				return;
			}
			if (finalPossible)
			{
				finalPossible = false;
				string empty2 = string.Empty;
				empty2 += finalFirst;
				empty2 += ch;
				int num4 = CheckFinal(empty2);
				if (num4 > 0)
				{
					finalLast = ch;
					final = num4;
					if (source.Length > 0)
					{
						source = source.Substring(0, source.Length - 1);
					}
					source += GetCompleteChar();
				}
				else
				{
					Input(ref source, ch);
				}
				return;
			}
			if (CheckInitial(ch) >= 0)
			{
				finalFirst = '.';
				finalLast = '.';
				state = State.Initial;
				medial = -1;
				final = -1;
				medialFirst = '.';
				medialPossible = false;
				Input(ref source, ch);
				return;
			}
			if (finalLast.Equals('.'))
			{
				if (source.Length > 0)
				{
					source = source.Substring(0, source.Length - 1);
				}
				final = 0;
				source += GetCompleteChar();
				initial = CheckInitial(finalFirst);
			}
			else
			{
				if (source.Length > 0)
				{
					source = source.Substring(0, source.Length - 1);
				}
				final = CheckFinal(finalFirst.ToString());
				source += GetCompleteChar();
				initial = CheckInitial(finalLast);
			}
			source += GetSingleJa(initial);
			finalFirst = '.';
			finalLast = '.';
			medialPossible = false;
			medial = -1;
			final = -1;
			state = State.Medial;
			Input(ref source, ch);
		}
	}

	private int CheckInitial(char ch)
	{
		foreach (Initial value in Enum.GetValues(typeof(Initial)))
		{
			if (value.ToString().Equals(ch.ToString()))
			{
				return (int)value;
			}
		}
		return -1;
	}

	private int CheckMedial(string ch)
	{
		foreach (Medial value in Enum.GetValues(typeof(Medial)))
		{
			if (ch.Equals(value.ToString()))
			{
				return (int)value;
			}
		}
		return -1;
	}

	private int CheckFinal(string ch)
	{
		foreach (Final value in Enum.GetValues(typeof(Final)))
		{
			if (ch.Equals(value.ToString()))
			{
				return (int)value;
			}
		}
		return -1;
	}

	public void InitState()
	{
		initial = -1;
		medial = -1;
		final = -1;
		state = State.Initial;
		medialPossible = false;
		finalPossible = false;
		medialFirst = '.';
		finalFirst = '.';
		finalLast = '.';
	}
}
public enum State
{
	Initial,
	Medial,
	Final
}
public enum Initial
{
	None = -1,
	r,
	R,
	s,
	e,
	E,
	f,
	a,
	q,
	Q,
	t,
	T,
	d,
	w,
	W,
	c,
	z,
	x,
	v,
	g
}
public enum Medial
{
	None = -1,
	k,
	o,
	i,
	O,
	j,
	p,
	u,
	P,
	h,
	hk,
	ho,
	hl,
	y,
	n,
	nj,
	np,
	nl,
	b,
	m,
	ml,
	l
}
public enum Final
{
	None = -1,
	r = 1,
	R = 2,
	rt = 3,
	s = 4,
	sw = 5,
	sg = 6,
	e = 7,
	f = 8,
	fr = 9,
	fa = 10,
	fq = 11,
	ft = 12,
	fx = 13,
	fv = 14,
	fg = 15,
	a = 16,
	q = 17,
	qt = 18,
	t = 19,
	T = 20,
	d = 21,
	w = 22,
	c = 23,
	z = 24,
	x = 25,
	v = 26,
	g = 27
}
public class Keyboard : MonoBehaviour
{
	public List<KeyboardLayout> keyboardLayouts = new List<KeyboardLayout>();

	public List<GameObject> rowRoots = new List<GameObject>();

	public List<KeyboardKey> keys = new List<KeyboardKey>();

	public GameObject keyPrefab;

	public bool IsShifted;

	public bool IsSpecial;

	public bool IsLanguage;

	[HideInInspector]
	public KeyboardState state;

	private KeyboardState statePrevious = KeyboardState.Special;

	public KeyboardKeyReceiveEvent KeyboardReceiveEvent;

	private void Awake()
	{
		CreateKeyboardLayout(0);
	}

	private void Start()
	{
		UpdateKeyLinks();
	}

	private void Update()
	{
		if (IsShifted)
		{
			state = KeyboardState.Shifted;
		}
		else
		{
			state = KeyboardState.Normal;
		}
		if (IsSpecial)
		{
			state = KeyboardState.Special;
		}
		if (statePrevious != state)
		{
			UpdateState();
		}
	}

	private void UpdateState()
	{
		statePrevious = state;
		switch (state)
		{
		case KeyboardState.Normal:
		{
			foreach (KeyboardKey key in keys)
			{
				if (key.normalText != null)
				{
					key.normalText.gameObject.SetActive(value: true);
				}
				if (key.shiftedText != null)
				{
					key.shiftedText.gameObject.SetActive(value: false);
				}
				if (key.specialText != null)
				{
					key.specialText.gameObject.SetActive(value: false);
				}
			}
			break;
		}
		case KeyboardState.Shifted:
		{
			foreach (KeyboardKey key2 in keys)
			{
				if (key2.normalText != null)
				{
					key2.normalText.gameObject.SetActive(value: false);
				}
				if (key2.shiftedText != null)
				{
					key2.shiftedText.gameObject.SetActive(value: true);
				}
				if (key2.specialText != null)
				{
					key2.specialText.gameObject.SetActive(value: false);
				}
			}
			break;
		}
		case KeyboardState.Special:
		{
			foreach (KeyboardKey key3 in keys)
			{
				if (key3.normalText != null)
				{
					key3.normalText.gameObject.SetActive(value: false);
				}
				if (key3.shiftedText != null)
				{
					key3.shiftedText.gameObject.SetActive(value: false);
				}
				if (key3.specialText != null)
				{
					key3.specialText.gameObject.SetActive(value: true);
				}
			}
			break;
		}
		}
	}

	public void UpdateKeyLinks()
	{
		foreach (KeyboardKey key in keys)
		{
			key.KeyboardKeyPressedEvent.RemoveListener(PressedKey);
		}
		foreach (KeyboardKey key2 in keys)
		{
			RegisterKey(key2);
		}
	}

	public void PressedKey(KeyboardKey key)
	{
		if (key.code == KeyCode.LeftShift || key.code == KeyCode.RightShift)
		{
			IsShifted = !IsShifted;
		}
		if (key.keyType == KeyboardKeyType.Language)
		{
			IsLanguage = !IsLanguage;
			if (!IsLanguage)
			{
				StartCoroutine(delayChangeKeyboard(0));
			}
			else
			{
				StartCoroutine(delayChangeKeyboard(Singleton<DataManager>.Instance.userData.language));
			}
		}
		if (key.keyType == KeyboardKeyType.Special)
		{
			IsSpecial = !IsSpecial;
			if (!IsSpecial)
			{
				key.specialText.text = "#+=";
			}
			else
			{
				key.specialText.text = "ABC";
			}
		}
		if (key.keyType == KeyboardKeyType.Character && KeyboardReceiveEvent != null)
		{
			switch (state)
			{
			case KeyboardState.Normal:
				KeyboardReceiveEvent.Invoke(key.normalString);
				break;
			case KeyboardState.Shifted:
				KeyboardReceiveEvent.Invoke(key.shiftedString);
				break;
			case KeyboardState.Special:
				KeyboardReceiveEvent.Invoke(key.specialString);
				break;
			}
		}
		if (key.keyType == KeyboardKeyType.Backspace && KeyboardReceiveEvent != null)
		{
			KeyboardReceiveEvent.Invoke("Backspace");
		}
		if (key.keyType != KeyboardKeyType.WhiteSpace)
		{
			return;
		}
		if (key.code == KeyCode.Return)
		{
			if (KeyboardReceiveEvent != null)
			{
				KeyboardReceiveEvent.Invoke("Enter");
			}
		}
		else if (key.code == KeyCode.Space && KeyboardReceiveEvent != null)
		{
			KeyboardReceiveEvent.Invoke(" ");
		}
	}

	public void RegisterKey(KeyboardKey key)
	{
		key.keyboard = this;
		key.KeyboardKeyPressedEvent.AddListener(PressedKey);
	}

	private IEnumerator delayChangeKeyboard(int index)
	{
		yield return new WaitForSeconds(0.2f);
		IsShifted = false;
		IsSpecial = false;
		ChangeKeyboard(index);
	}

	public void ChangeKeyboard(int index)
	{
		if (index > 3)
		{
			index = 0;
		}
		CreateKeyboardLayout(index);
		UpdateKeyLinks();
	}

	public void CreateKeyboardLayout(int index)
	{
		ClearAll();
		for (int i = 0; i < keyboardLayouts[index].Keys.Count; i++)
		{
			GameObject obj = UnityEngine.Object.Instantiate(keyPrefab, rowRoots[(int)keyboardLayouts[index].Keys[i].row].transform);
			obj.name = "Key_" + i;
			KeyboardKey component = obj.GetComponent<KeyboardKey>();
			component.keyType = keyboardLayouts[index].Keys[i].keyType;
			component.SetWidth(keyboardLayouts[index].Keys[i].width);
			component.code = keyboardLayouts[index].Keys[i].code;
			component.normalString = keyboardLayouts[index].Keys[i].normal;
			component.shiftedString = keyboardLayouts[index].Keys[i].shifted;
			component.specialString = keyboardLayouts[index].Keys[i].special;
			if (component.normalText != null)
			{
				if (component.keyType == KeyboardKeyType.Language)
				{
					Text normalText = component.normalText;
					NationCode nationCode = (NationCode)index;
					normalText.text = nationCode.ToString();
					Text shiftedText = component.shiftedText;
					nationCode = (NationCode)index;
					shiftedText.text = nationCode.ToString();
					Text specialText = component.specialText;
					nationCode = (NationCode)index;
					specialText.text = nationCode.ToString();
				}
				else
				{
					component.normalText.text = component.normalString;
				}
			}
			if (component.shiftedText != null && component.keyType != KeyboardKeyType.Language)
			{
				component.shiftedText.text = component.shiftedString;
			}
			if (component.specialString != null && component.keyType != KeyboardKeyType.Language)
			{
				component.specialText.text = component.specialString;
			}
			component.shiftedText.gameObject.SetActive(value: false);
			component.specialText.gameObject.SetActive(value: false);
			if (keyboardLayouts[index].Keys[i].icon != null)
			{
				if (component.icon != null)
				{
					component.icon.sprite = keyboardLayouts[index].Keys[i].icon;
				}
			}
			else
			{
				component.icon.gameObject.SetActive(value: false);
			}
			keys.Add(component);
		}
	}

	public void ClearAll()
	{
		keys.Clear();
		foreach (GameObject rowRoot in rowRoots)
		{
			Transform[] componentsInChildren = rowRoot.transform.GetComponentsInChildren<Transform>();
			foreach (Transform transform in componentsInChildren)
			{
				if (rowRoot != transform.gameObject)
				{
					UnityEngine.Object.Destroy(transform.gameObject);
				}
			}
		}
	}

	public void SetKey(string c)
	{
	}
}
public enum KeyboardKeyType
{
	Character,
	WhiteSpace,
	Modifier,
	Function,
	Delete,
	Backspace,
	Language,
	Special
}
public enum KeyboardState
{
	Normal,
	Shifted,
	Special
}
public enum Row
{
	ROW0,
	ROW1,
	ROW2,
	ROW3,
	ROW4
}
public enum NationCode
{
	EN,
	FR,
	ES,
	DE,
	KR,
	JP
}
[Serializable]
public class KeyboardKeyEvent : UnityEvent<KeyboardKey>
{
}
[Serializable]
public class KeyboardKeyReceiveEvent : UnityEvent<string>
{
}
public class KeyboardKey : MonoBehaviour, IPointerDownHandler, IEventSystemHandler, IPointerUpHandler
{
	[HideInInspector]
	public Keyboard keyboard;

	public KeyboardKeyType keyType;

	public bool parseKeyCode;

	[SerializeField]
	public Text normalText;

	[SerializeField]
	public Text shiftedText;

	[SerializeField]
	public Text specialText;

	public Image icon;

	[SerializeField]
	public string normalString;

	[SerializeField]
	public string shiftedString;

	[SerializeField]
	public string specialString;

	[SerializeField]
	public KeyCode code;

	private Button button;

	public float width = 58f;

	public float height = 58f;

	public KeyboardKeyEvent KeyboardKeyPressedEvent;

	private AudioSource soundKey;

	private bool once;

	private void Awake()
	{
		ValidateKeyboard();
	}

	private void Start()
	{
		soundKey = GetComponent<AudioSource>();
		ValidateKeyboard();
		_ = button != null;
	}

	public bool ValidateKeyboard()
	{
		button = GetComponent<Button>();
		if (keyboard == null)
		{
			keyboard = GetComponentInParent<Keyboard>();
		}
		if (code == KeyCode.Tab || code == KeyCode.Space)
		{
			parseKeyCode = true;
			DefaultFromCode(code);
		}
		return true;
	}

	public void SetWidth(float width)
	{
		GetComponent<RectTransform>().sizeDelta = new Vector2(width, height);
	}

	public void OnPointerDown(PointerEventData ped)
	{
		if (!once)
		{
			once = true;
			if (KeyboardKeyPressedEvent != null)
			{
				soundKey.Play();
				KeyboardKeyPressedEvent.Invoke(this);
			}
		}
	}

	public void OnPointerUp(PointerEventData ped)
	{
		once = false;
	}

	public KeyboardKeyType DefaultFromCode(KeyCode code)
	{
		KeyboardKeyType result = KeyboardKeyType.Character;
		this.code = code;
		switch (code)
		{
		case KeyCode.Space:
		case KeyCode.UpArrow:
		case KeyCode.DownArrow:
		case KeyCode.RightArrow:
		case KeyCode.LeftArrow:
			if (normalText != null)
			{
				normalText.text = "";
			}
			if (shiftedText != null)
			{
				shiftedText.text = "";
			}
			if (code == KeyCode.Space)
			{
				result = KeyboardKeyType.WhiteSpace;
				normalString = " ";
				shiftedString = " ";
			}
			else
			{
				result = KeyboardKeyType.Modifier;
				normalString = "";
				shiftedString = "";
			}
			break;
		default:
			if (code != KeyCode.LeftCommand && code != KeyCode.RightCommand && code != KeyCode.LeftControl && code != KeyCode.RightControl && code != KeyCode.LeftShift && code != KeyCode.RightShift && code != KeyCode.LeftWindows && code != KeyCode.RightWindows && code != KeyCode.KeypadEnter && code != KeyCode.Period && code != KeyCode.KeypadPeriod && code != KeyCode.Exclaim && code != KeyCode.LeftBracket && code != KeyCode.RightBracket && code != KeyCode.Hash && code != KeyCode.BackQuote && code != KeyCode.Alpha4 && code != KeyCode.Backslash && code != KeyCode.Less && code != KeyCode.Comma && code != KeyCode.Greater && code != KeyCode.Equals && code != KeyCode.Plus && code != KeyCode.KeypadDivide && code != KeyCode.Dollar && code != KeyCode.DoubleQuote && code != KeyCode.Colon && code != KeyCode.Semicolon && code != KeyCode.Question && code != KeyCode.Slash && code != KeyCode.Asterisk && code != KeyCode.KeypadMultiply && code != KeyCode.KeypadMinus && code != KeyCode.KeypadPlus && code != KeyCode.Quote && code != KeyCode.At && code != KeyCode.Minus && code != KeyCode.Underscore && code != KeyCode.Alpha0 && code != KeyCode.Alpha1 && code != KeyCode.Alpha2 && code != KeyCode.Alpha3 && code != KeyCode.Alpha4 && code != KeyCode.Alpha5 && code != KeyCode.Alpha6 && code != KeyCode.Alpha7 && code != KeyCode.Alpha8 && code != KeyCode.Alpha9 && code != 0)
			{
				result = KeyboardKeyType.Character;
				if (normalText != null)
				{
					normalText.text = normalString;
				}
				if (shiftedText != null)
				{
					shiftedText.text = shiftedString;
				}
				if (specialText != null)
				{
					specialText.text = specialString;
				}
			}
			break;
		case KeyCode.Backspace:
		case KeyCode.Tab:
		case KeyCode.Return:
		case KeyCode.Pause:
		case KeyCode.Escape:
		case KeyCode.Delete:
		case KeyCode.Insert:
		case KeyCode.Home:
		case KeyCode.End:
		case KeyCode.PageUp:
		case KeyCode.PageDown:
		case KeyCode.Numlock:
		case KeyCode.CapsLock:
		case KeyCode.ScrollLock:
		case KeyCode.RightAlt:
		case KeyCode.LeftAlt:
		case KeyCode.RightCommand:
		case KeyCode.LeftCommand:
		case KeyCode.AltGr:
		case KeyCode.Print:
		case KeyCode.SysReq:
		case KeyCode.Break:
		case KeyCode.Menu:
			break;
		}
		return result;
	}
}
[CreateAssetMenu(menuName = "Keyboard/KeyboardLayout")]
public class KeyboardLayout : ScriptableObject
{
	[Multiline]
	public string Notes;

	public List<KeyData> Keys;
}
public class KeyboardManager : MonoBehaviour
{
	public enum KeyboardType
	{
		Eng,
		Kr
	}

	public static KeyboardManager Instance;

	public GameObject keyboard;

	public CanvasWebViewPrefab canvasWebViewPrefab;

	public KeyboardType type;

	public Text messageText;

	public bool isSpecialMode;

	public bool isShifted;

	public KeyButton[] keys;

	public FavoriteController favoriteController;

	private void Awake()
	{
		Instance = this;
		favoriteController = Singleton<MediaController>.Instance.favoriteController;
	}

	public void SetSpecialMode(bool mode)
	{
		isSpecialMode = mode;
		KeyButton[] array;
		if (mode)
		{
			array = keys;
			foreach (KeyButton keyButton in array)
			{
				if (keyButton.isSpecialKey)
				{
					keyButton.text.text = keyButton.subText;
				}
			}
			return;
		}
		array = keys;
		foreach (KeyButton keyButton2 in array)
		{
			if (keyButton2.isSpecialKey)
			{
				keyButton2.text.text = keyButton2.mainText;
			}
		}
	}

	private void Start()
	{
		Init();
	}

	public void Init()
	{
		isShifted = false;
		isSpecialMode = false;
	}

	public void Show()
	{
		base.gameObject.SetActive(value: true);
	}

	public void Hide()
	{
		base.gameObject.SetActive(value: false);
	}

	public void SetLanguage()
	{
	}

	public void SetShiftButtons(bool bShift)
	{
		isShifted = bShift;
		KeyButton[] array = keys;
		for (int i = 0; i < array.Length; i++)
		{
			array[i].SetShift(bShift);
		}
	}

	public void SetBackspace()
	{
		if (favoriteController != null && favoriteController.selectedInputField != null && favoriteController.selectedInputField.isActiveAndEnabled)
		{
			string text = favoriteController.selectedInputField.text.Remove(favoriteController.selectedInputField.text.Length - 1, 1);
			favoriteController.selectedInputField.text = text;
		}
		if (canvasWebViewPrefab != null)
		{
			canvasWebViewPrefab.WebView.HandleKeyboardInput("Backspace");
		}
	}

	public void SetEnter()
	{
		canvasWebViewPrefab.WebView.HandleKeyboardInput("Enter");
	}

	public void SetTab()
	{
		canvasWebViewPrefab.WebView.HandleKeyboardInput("\t");
	}

	public void SetSpacebar()
	{
		canvasWebViewPrefab.WebView.HandleKeyboardInput(" ");
	}

	public void SetSpecial(string str, string str2)
	{
	}

	public void SetKey(string c)
	{
		if (favoriteController != null && favoriteController.selectedInputField != null && favoriteController.selectedInputField.IsActive())
		{
			favoriteController.selectedInputField.text += c;
		}
		if (canvasWebViewPrefab != null)
		{
			canvasWebViewPrefab.WebView.HandleKeyboardInput(c);
		}
		MonoBehaviour.print(c);
	}
}
public class KeyButton : MonoBehaviour
{
	public Text text;

	public string mainText;

	public string subText;

	public bool isCharKey = true;

	public bool isSpecialModeKey;

	public bool isBackSpaceKey;

	public bool isShiftKey;

	public bool isSpacebarKey;

	public bool isEnterKey;

	public bool isTabKey;

	public bool isLangKey;

	public bool isSpecialKey;

	private KeyboardManager keyboardManager;

	private void Awake()
	{
		Transform[] componentsInChildren = base.gameObject.GetComponentsInChildren<Transform>();
		foreach (Transform transform in componentsInChildren)
		{
			if (transform.name == "Text")
			{
				text = transform.GetComponent<Text>();
			}
		}
		if (GetComponent<Button>() != null)
		{
			GetComponent<Button>().onClick.AddListener(OnClickEvent);
		}
	}

	private void Start()
	{
		if (KeyboardManager.Instance != null)
		{
			keyboardManager = KeyboardManager.Instance;
		}
	}

	public void SetShift(bool isShift)
	{
		if (isShift && !keyboardManager.isSpecialMode)
		{
			if (!string.IsNullOrEmpty(mainText) && text != null)
			{
				text.text = mainText.ToUpper();
			}
		}
		else if (!string.IsNullOrEmpty(mainText) && text != null)
		{
			text.text = mainText.ToLower();
		}
	}

	public void OnClickEvent()
	{
		if (isCharKey)
		{
			keyboardManager.SetKey(text.text);
		}
	}
}
[Serializable]
public class KeyData
{
	public Row row;

	public KeyboardKeyType keyType;

	public string normal;

	public string shifted;

	public string special;

	public Sprite icon;

	public KeyCode code;

	public float width = 58f;

	public float height = 58f;
}
public class KeyProperties : MonoBehaviour, IPointerDownHandler, IEventSystemHandler
{
	public Text text_main;

	public Text text_sub;

	public string korText;

	public string korSsangText;

	public string engSmallText;

	public bool isBackSpaceKey;

	public bool isShiftKey;

	public bool isSpacebarKey;

	public bool isEnterKey;

	public bool isTabKey;

	public bool isLangKey;

	public bool isSpecialKey;

	public KeyboardManager keyboard;

	private void Awake()
	{
	}

	public void SetShift(bool bShift)
	{
		if (bShift)
		{
			if (keyboard.type == KeyboardManager.KeyboardType.Kr && !string.IsNullOrEmpty(korSsangText) && text_main != null)
			{
				text_main.text = korSsangText;
			}
			return;
		}
		if (isShiftKey)
		{
			GetComponent<Toggle>().isOn = false;
		}
		if (keyboard.type == KeyboardManager.KeyboardType.Kr && !string.IsNullOrEmpty(korText) && text_main != null)
		{
			text_main.text = korText;
		}
	}

	public void SetKeyboardText(int language)
	{
		switch (language)
		{
		case 0:
			if (!string.IsNullOrEmpty(korText))
			{
				if (text_main != null)
				{
					text_main.text = korText;
				}
				if (text_sub != null)
				{
					text_sub.text = engSmallText.ToUpper();
				}
			}
			break;
		case 1:
			if (!string.IsNullOrEmpty(engSmallText))
			{
				if (text_main != null)
				{
					text_main.text = engSmallText.ToUpper();
				}
				if (text_sub != null)
				{
					text_sub.text = korText;
				}
			}
			break;
		}
	}

	public void OnPointerDown(PointerEventData ped)
	{
		if (isBackSpaceKey)
		{
			keyboard.SetBackspace();
			return;
		}
		if (isEnterKey)
		{
			keyboard.SetEnter();
			return;
		}
		if (isTabKey)
		{
			keyboard.SetTab();
			return;
		}
		if (isShiftKey)
		{
			keyboard.SetShiftButtons(GetComponent<Toggle>().isOn);
			return;
		}
		if (isSpacebarKey)
		{
			keyboard.SetSpacebar();
			return;
		}
		if (isLangKey)
		{
			if (GetComponent<Toggle>().isOn)
			{
				text_main.color = new Color(0f, 234f, 255f);
				text_sub.color = new Color(255f, 255f, 255f);
			}
			else
			{
				text_main.color = new Color(255f, 255f, 255f);
				text_sub.color = new Color(0f, 234f, 255f);
			}
			return;
		}
		if (isSpecialKey)
		{
			keyboard.SetSpecial(korText, korSsangText);
			return;
		}
		switch ((int)keyboard.type)
		{
		case 0:
			if (!string.IsNullOrEmpty(engSmallText))
			{
				keyboard.SetKey(engSmallText);
			}
			break;
		case 1:
			if (!string.IsNullOrEmpty(engSmallText))
			{
				keyboard.SetKey(engSmallText);
			}
			break;
		}
	}
}
public class LeaderboardController : MonoBehaviour
{
	private DataManager dataManager;

	private Main main;

	public bool isConnected;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	private void OnEnable()
	{
		OnlineCheck.Check(delegate(bool isConnected, NetworkReachability b)
		{
			if (isConnected)
			{
				main.leaderboardManager.ShowCaution(bShow: true);
				main.leaderboardManager.rankList.Init();
			}
			else
			{
				main.leaderboardManager.rankList.Clear();
				main.leaderboardManager.ShowCaution(bShow: false);
			}
		});
	}

	private void OnDisable()
	{
		main.leaderboardManager.Reset();
	}
}
public class LeaderboardInfo : MonoBehaviour, IPointerEnterHandler, IEventSystemHandler, IPointerExitHandler
{
	public void OnPointerEnter(PointerEventData pointerEventData)
	{
		Singleton<Main>.Instance.leaderboardManager.ShowLeaderboardInfoPopup();
	}

	public void OnPointerExit(PointerEventData pointerEventData)
	{
		Singleton<Main>.Instance.leaderboardManager.HideLeaderboardInfoPopup();
	}
}
public class LeaderboardInfoPopupContainer : MonoBehaviour
{
	public Text desc;

	public void SetText(string text)
	{
		desc.text = text;
	}

	public void Close()
	{
		Singleton<Main>.Instance.leaderboardManager.HideLeaderboardInfoPopup();
	}
}
public class LeaderBoardManager : MonoBehaviour
{
	public int currentPage;

	public Text pageNumber;

	public Text category;

	public Text scoreLabel;

	public Text caution;

	public Text seasonEndDate;

	public Text loading;

	public RankList rankList;

	private int totalCategoryCount = 8;

	private int fishCountInCategory = 14;

	public List<string> categoryNames = new List<string>();

	public List<string> categoryKeys = new List<string>();

	public LeaderboardInfoPopupContainer leaderboardInfoPopup;

	private DataManager dataManager;

	private Main main;

	public bool uploaded;

	public bool isUploading;

	private Coroutine uploadCoroutine;

	private Coroutine seasonEndDateCoroutine;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		Initialize();
	}

	private void Initialize()
	{
		categoryNames.Add("SEASON SCORE");
		categoryKeys.Add("LodgeTVLeaderboard/0001");
		foreach (FishItem fishItem in dataManager.ItemDatabase.dlcs[dataManager.currentNation].fishItems)
		{
			if (main.lobbyId == 0)
			{
				if (fishItem.grade == 3)
				{
					categoryNames.Add(fishItem.ItemName);
					categoryKeys.Add(fishItem.nameKey);
				}
			}
			else if (main.lobbyId == 1 && fishItem.grade == 4)
			{
				categoryNames.Add(fishItem.ItemName);
				categoryKeys.Add(fishItem.nameKey);
			}
		}
	}

	private void Start()
	{
		StartCoroutine(waitLoaded());
	}

	private IEnumerator waitLoaded()
	{
		while (!dataManager.loaded)
		{
			yield return null;
		}
		UploadLeaderboard();
	}

	public void UploadLeaderboard()
	{
		OnlineCheck.Check(delegate(bool isConnected, NetworkReachability b)
		{
			if (isConnected && !dataManager.isBeta)
			{
				if (uploadCoroutine == null)
				{
					StartCoroutine(uploadLeaderboard());
				}
				else
				{
					StopCoroutine(uploadLeaderboard());
					StartCoroutine(uploadLeaderboard());
				}
			}
		});
	}

	private IEnumerator uploadLeaderboard()
	{
		isUploading = true;
		yield return StartCoroutine(Singleton<DBManager>.Instance.GetSeason(delegate
		{
			int season = Singleton<DBManager>.Instance.season;
			if (dataManager.userData.season < season)
			{
				dataManager.userData.totalScore = 0;
				dataManager.userData.season = season;
				dataManager.Save();
			}
		}));
		Leaderboards.GetEntries("seasonscore_" + dataManager.userData.season, 1, LeaderboardFilterType.None, LeaderboardStartAt.CenteredOnViewer).OnComplete(delegate(Message<LeaderboardEntryList> msg)
		{
			if (!msg.IsError)
			{
				LeaderboardEntry leaderboardEntry = msg.Data.FirstOrDefault();
				if (leaderboardEntry != null && dataManager.userData.totalScore < leaderboardEntry.Score)
				{
					dataManager.userData.totalScore = int.Parse(leaderboardEntry.Score.ToString());
				}
				MonoBehaviour.print("리더보드 시즌스코어 데이터 가져오기 성공");
			}
			else
			{
				MonoBehaviour.print("리더보드 물고기 데이터 가져오기 실패");
			}
		});
		bool completed = false;
		for (int i = 0; i < fishCountInCategory; i++)
		{
			GetMyFishDataFromLeaderboard(i, delegate(string result)
			{
				switch (result)
				{
				case "success":
					MonoBehaviour.print("리더보드 물고기 데이터 가져오기 성공");
					break;
				case "fail":
					MonoBehaviour.print("리더보드 물고기 데이터 가져오기 실패 또는 받을 데이터 없음");
					break;
				case "end":
					MonoBehaviour.print("리더보드 물고기 데이터 가져오기 루프 끝");
					completed = true;
					break;
				}
			});
		}
		while (!completed)
		{
			yield return null;
		}
		dataManager.Save();
		yield return StartCoroutine(uploadSeasonScore(delegate(string result)
		{
			if (result == "success")
			{
				MonoBehaviour.print("리더보드 시즌스코어 데이터 올리기 성공");
			}
			else if (result == "fail")
			{
				MonoBehaviour.print("리더보드 시즌스코어 데이터 가져오기 실패 또는 받을 데이터 없음");
			}
		}));
		yield return StartCoroutine(uploadFish());
		uploaded = true;
		isUploading = false;
	}

	public void GetMyFishDataFromLeaderboard(int i, Action<string> result)
	{
		Leaderboards.GetEntries("fish_0_" + i, 1, LeaderboardFilterType.None, LeaderboardStartAt.CenteredOnViewer).OnComplete(delegate(Message<LeaderboardEntryList> msg)
		{
			if (!msg.IsError)
			{
				LeaderboardEntry leaderboardEntry = msg.Data.FirstOrDefault();
				if (leaderboardEntry != null)
				{
					string text = leaderboardEntry.Score.ToString();
					if (i < 7)
					{
						float num = float.Parse(text.Insert(text.Length - 3, "."), CultureInfo.InvariantCulture);
						if (num > dataManager.userData.fishes[main.nationId].maxSize[i])
						{
							dataManager.userData.fishes[main.nationId].maxSize[i] = num;
						}
					}
					else
					{
						float num2 = float.Parse(text.Insert(text.Length - 3, "."), CultureInfo.InvariantCulture);
						if (num2 > dataManager.userData.fishes[main.nationId].maxSize[i + 18])
						{
							dataManager.userData.fishes[main.nationId].maxSize[i + 18] = num2;
						}
					}
					result("success");
				}
				else
				{
					result("fail");
				}
			}
			else
			{
				result("fail");
			}
			if (i == 13)
			{
				result("end");
			}
		});
	}

	private IEnumerator uploadSeasonScore(Action<string> callback)
	{
		yield return null;
		if (dataManager.userData.season == Singleton<DBManager>.Instance.season)
		{
			string leaderBoardName = "seasonscore_" + dataManager.userData.season;
			WriteEntry(leaderBoardName, dataManager.userData.totalScore, callback);
		}
	}

	private IEnumerator uploadFish()
	{
		int num = 0;
		int num2 = 0;
		if (main.lobbyId == 0)
		{
			num = 0;
			num2 = 7;
		}
		else if (main.lobbyId == 1)
		{
			num = 25;
			num2 = 32;
		}
		bool completed = false;
		for (int i = num; i < num2; i++)
		{
			if (dataManager.userData.fishes[dataManager.currentNation].maxSize[i] > 0f)
			{
				long score = long.Parse(dataManager.userData.fishes[dataManager.currentNation].maxSize[i].ToString("N3").Replace(".", ""), CultureInfo.InvariantCulture);
				if (main.lobbyId == 1)
				{
					WriteFishData(i, "fish_0_" + (i - 18), score, delegate(string result)
					{
						switch (result)
						{
						case "success":
							MonoBehaviour.print("리더보드 민물고기 데이터 올리기 성공");
							break;
						case "fail":
							MonoBehaviour.print("리더보드 민물고기 데이터 올리기 실패");
							break;
						case "end":
							completed = true;
							MonoBehaviour.print("리더보드 민물고기 데이터 올리기 루프 끝");
							break;
						}
					});
					continue;
				}
				WriteFishData(i, "fish_0_" + i, score, delegate(string result)
				{
					switch (result)
					{
					case "success":
						MonoBehaviour.print("리더보드 바다물고기 데이터 올리기 성공");
						break;
					case "fail":
						MonoBehaviour.print("리더보드 바다물고기 데이터 올리기 실패");
						break;
					case "end":
						completed = true;
						MonoBehaviour.print("리더보드 바다물고기 데이터 올리기 루프 끝");
						break;
					}
				});
			}
			else if (i == 6 || i == 31)
			{
				completed = true;
			}
		}
		while (!completed)
		{
			yield return null;
		}
	}

	public void WriteFishData(int id, string leaderBoardName, long score, Action<string> callback = null)
	{
		Leaderboards.WriteEntry(leaderBoardName, score).OnComplete(delegate(Message<bool> s)
		{
			if (!s.IsError)
			{
				if (callback != null)
				{
					callback("success");
				}
			}
			else if (callback != null)
			{
				callback("fail");
			}
			if (id == 6 || id == 31)
			{
				callback("end");
			}
		});
	}

	public void WriteEntry(string leaderBoardName, long score, Action<string> callback = null)
	{
		Leaderboards.WriteEntry(leaderBoardName, score).OnComplete(delegate(Message<bool> s)
		{
			if (!s.IsError)
			{
				if (callback != null)
				{
					callback("success");
				}
			}
			else if (callback != null)
			{
				callback("fail");
			}
		});
	}

	public void ShowCaution(bool bShow)
	{
		if (bShow && !dataManager.isBeta)
		{
			caution.gameObject.SetActive(value: false);
			StartCoroutine(Singleton<DBManager>.Instance.GetVersion(delegate(object response)
			{
				if (response != null)
				{
					Singleton<DBManager>.Instance.cloudVersion = response.ToString();
					if (float.Parse(Singleton<DBManager>.Instance.cloudVersion, CultureInfo.InvariantCulture) > float.Parse(UnityEngine.Application.version, CultureInfo.InvariantCulture))
					{
						StartCoroutine(Restart());
					}
					else
					{
						seasonEndDate.gameObject.SetActive(value: true);
						seasonEndDateCoroutine = StartCoroutine(Singleton<DBManager>.Instance.GetSeasonEndDate(delegate(object result)
						{
							if (result == null || result.ToString() == "0")
							{
								seasonEndDate.gameObject.SetActive(value: false);
							}
							else
							{
								seasonEndDate.text = "SEASON ENDS IN : " + result.ToString() + " D";
							}
						}));
					}
				}
			}));
		}
		else
		{
			caution.gameObject.SetActive(value: true);
			loading.gameObject.SetActive(value: false);
		}
	}

	private IEnumerator Restart()
	{
		Singleton<DataManager>.Instance.Save();
		yield return new WaitForSeconds(2f);
		UnityEngine.Object.Destroy(Singleton<DataManager>.Instance.gameObject);
		SceneManager.LoadScene(0);
	}

	[ContextMenu("Prev")]
	public void Prev()
	{
		if (dataManager.isBeta)
		{
			return;
		}
		if (currentPage > 0)
		{
			currentPage--;
		}
		else
		{
			currentPage = totalCategoryCount - 1;
		}
		pageNumber.text = currentPage + 1 + "/ " + totalCategoryCount;
		category.GetComponent<Localize>().SetKey(categoryKeys[currentPage]);
		OnlineCheck.Check(delegate(bool isConnected, NetworkReachability b)
		{
			if (isConnected)
			{
				ShowCaution(bShow: true);
				ShowLoadingMessage(bShow: true);
				if (main.lobbyId == 0)
				{
					if (currentPage > 0)
					{
						rankList.StartCoroutine(rankList.AddNewItem(currentPage - 1, isSeasonScore: false));
					}
					else
					{
						rankList.StartCoroutine(rankList.AddNewItem(currentPage, isSeasonScore: true));
					}
				}
				else if (main.lobbyId == 1)
				{
					if (currentPage > 0)
					{
						rankList.StartCoroutine(rankList.AddNewItem(currentPage + 6, isSeasonScore: false));
					}
					else
					{
						rankList.StartCoroutine(rankList.AddNewItem(currentPage, isSeasonScore: true));
					}
				}
			}
			else
			{
				ShowCaution(bShow: false);
				rankList.Clear();
			}
		});
	}

	[ContextMenu("Next")]
	public void Next()
	{
		if (dataManager.isBeta)
		{
			return;
		}
		if (currentPage < totalCategoryCount - 1)
		{
			currentPage++;
		}
		else
		{
			currentPage = 0;
		}
		pageNumber.text = currentPage + 1 + " / " + totalCategoryCount;
		category.GetComponent<Localize>().SetKey(categoryKeys[currentPage]);
		OnlineCheck.Check(delegate(bool isConnected, NetworkReachability b)
		{
			if (isConnected)
			{
				ShowCaution(bShow: true);
				ShowLoadingMessage(bShow: true);
				if (main.lobbyId == 0)
				{
					if (currentPage > 0)
					{
						rankList.StartCoroutine(rankList.AddNewItem(currentPage - 1, isSeasonScore: false));
					}
					else
					{
						rankList.StartCoroutine(rankList.AddNewItem(currentPage, isSeasonScore: true));
					}
				}
				else if (main.lobbyId == 1)
				{
					if (currentPage > 0)
					{
						rankList.StartCoroutine(rankList.AddNewItem(currentPage + 6, isSeasonScore: false));
					}
					else
					{
						rankList.StartCoroutine(rankList.AddNewItem(currentPage, isSeasonScore: true));
					}
				}
			}
			else
			{
				ShowCaution(bShow: false);
				rankList.Clear();
			}
		});
	}

	public void Reset()
	{
		if (!dataManager.isBeta)
		{
			currentPage = 0;
			pageNumber.text = " 1 / " + totalCategoryCount;
			category.GetComponent<Localize>().SetKey(categoryKeys[0]);
			if (seasonEndDateCoroutine != null)
			{
				StopCoroutine(seasonEndDateCoroutine);
			}
		}
	}

	public void ShowLoadingMessage(bool bShow)
	{
		loading.gameObject.SetActive(bShow);
	}

	public void ShowLeaderboardInfoPopup()
	{
		leaderboardInfoPopup.gameObject.SetActive(value: true);
	}

	public void HideLeaderboardInfoPopup()
	{
		leaderboardInfoPopup.gameObject.SetActive(value: false);
	}
}
public class RankList : MonoBehaviour
{
	public GameObject rankListItemPrefab;

	public Transform rankListItemParent;

	public List<RankListElement> rankListItems = new List<RankListElement>();

	public UnityEvent createdItemsEvent;

	private int[] gradeScores = new int[4] { 1, 2, 4, 7 };

	public Color lineColor;

	private DataManager dataManager;

	private Main main;

	private Coroutine processCoroutine;

	private void Awake()
	{
		createdItemsEvent = new UnityEvent();
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
	}

	private void OnEnable()
	{
	}

	public void Init()
	{
		if (!dataManager.isBeta)
		{
			main.leaderboardManager.ShowLoadingMessage(bShow: true);
			if (processCoroutine == null)
			{
				processCoroutine = StartCoroutine(process());
				return;
			}
			StopCoroutine(processCoroutine);
			processCoroutine = StartCoroutine(process());
		}
	}

	private IEnumerator process()
	{
		if (!main.leaderboardManager.isUploading && !main.leaderboardManager.uploaded)
		{
			main.leaderboardManager.UploadLeaderboard();
		}
		while (!main.leaderboardManager.uploaded)
		{
			yield return null;
		}
		StartCoroutine(AddNewItem(0, isSeasonScore: true));
	}

	public void OnDisable()
	{
		foreach (RankListElement rankListItem in rankListItems)
		{
			UnityEngine.Object.Destroy(rankListItem.gameObject);
		}
		rankListItems.Clear();
		if (processCoroutine != null)
		{
			StopCoroutine(processCoroutine);
		}
		main.leaderboardManager.Reset();
	}

	public void Clear()
	{
		foreach (RankListElement rankListItem in rankListItems)
		{
			UnityEngine.Object.Destroy(rankListItem.gameObject);
		}
		rankListItems.Clear();
	}

	public IEnumerator AddNewItem(int currentPage, bool isSeasonScore)
	{
		Clear();
		string leaderboardName = "";
		int result = (isSeasonScore ? currentPage : (currentPage + 1));
		if (main.lobbyId == 0)
		{
			if (main.leaderboardManager.currentPage != result)
			{
				yield break;
			}
		}
		else if (main.lobbyId == 1 && (isSeasonScore ? main.leaderboardManager.currentPage : (main.leaderboardManager.currentPage + 7)) != result)
		{
			yield break;
		}
		if (isSeasonScore)
		{
			leaderboardName = "seasonscore_" + dataManager.userData.season;
			main.leaderboardManager.scoreLabel.GetComponent<Localize>().SetKey("LodgeTVLeaderboard/0003");
		}
		else
		{
			leaderboardName = "fish_0_" + currentPage;
			if (dataManager.userData.unit == 0)
			{
				main.leaderboardManager.scoreLabel.GetComponent<Localize>().SetKey("LodgeTVLeaderboard/0004");
			}
			else
			{
				main.leaderboardManager.scoreLabel.GetComponent<Localize>().SetKey("LodgeTVLeaderboard/0005");
			}
		}
		int index = 1;
		bool isRanking = false;
		string score = "";
		Leaderboards.GetEntries(leaderboardName, 10, LeaderboardFilterType.None, LeaderboardStartAt.Top).OnComplete(delegate(Message<LeaderboardEntryList> msg)
		{
			if (main.lobbyId == 0)
			{
				if (main.leaderboardManager.currentPage != result)
				{
					return;
				}
			}
			else if (main.lobbyId == 1 && (isSeasonScore ? main.leaderboardManager.currentPage : (main.leaderboardManager.currentPage + 7)) != result)
			{
				return;
			}
			main.leaderboardManager.ShowLoadingMessage(bShow: false);
			if (!msg.IsError)
			{
				int num = 0;
				foreach (LeaderboardEntry datum in msg.Data)
				{
					GameObject gameObject = UnityEngine.Object.Instantiate(rankListItemPrefab, Vector3.zero, Quaternion.identity);
					gameObject.transform.SetParent(rankListItemParent);
					gameObject.transform.localPosition = Vector3.zero;
					gameObject.transform.localRotation = Quaternion.identity;
					gameObject.transform.localScale = Vector3.one;
					gameObject.name = "Item" + index;
					index++;
					if (num % 2 == 1)
					{
						gameObject.GetComponent<Image>().color = lineColor;
						gameObject.GetComponent<Image>().enabled = true;
					}
					num++;
					if (!isSeasonScore)
					{
						score = datum.Score.ToString();
						score = score.Insert(score.Length - 3, ".");
					}
					else
					{
						score = datum.Score.ToString();
					}
					gameObject.GetComponent<RankListElement>().SetRank(datum.Rank, datum.User.OculusID, score, isSeasonScore);
					rankListItems.Add(gameObject.GetComponent<RankListElement>());
					if (Singleton<OculusManager>.Instance.id == datum.User.ID)
					{
						isRanking = true;
						gameObject.GetComponent<Image>().color = new Color(0f, 71f / 85f, 0.7647059f, 1f);
						gameObject.GetComponent<Image>().enabled = true;
					}
				}
			}
			if (!isRanking)
			{
				Leaderboards.GetEntries(leaderboardName, 1, LeaderboardFilterType.None, LeaderboardStartAt.CenteredOnViewer).OnComplete(delegate(Message<LeaderboardEntryList> msg2)
				{
					if (main.lobbyId == 0)
					{
						if (main.leaderboardManager.currentPage != result)
						{
							return;
						}
					}
					else if (main.lobbyId == 1 && (isSeasonScore ? main.leaderboardManager.currentPage : (main.leaderboardManager.currentPage + 7)) != result)
					{
						return;
					}
					if (msg2.IsError)
					{
						MonoBehaviour.print("내 데이터 없음");
						GameObject gameObject2 = UnityEngine.Object.Instantiate(rankListItemPrefab, Vector3.zero, Quaternion.identity);
						gameObject2.transform.SetParent(rankListItemParent);
						gameObject2.transform.localPosition = Vector3.zero;
						gameObject2.transform.localRotation = Quaternion.identity;
						gameObject2.transform.localScale = Vector3.one;
						gameObject2.name = "Item" + index;
						score = "0";
						gameObject2.GetComponent<RankListElement>().SetRank(0, Singleton<OculusManager>.Instance.oculusID, score, isSeasonScore);
						rankListItems.Add(gameObject2.GetComponent<RankListElement>());
						gameObject2.GetComponent<Image>().enabled = true;
					}
					else
					{
						GameObject gameObject3 = UnityEngine.Object.Instantiate(rankListItemPrefab, Vector3.zero, Quaternion.identity);
						gameObject3.transform.SetParent(rankListItemParent);
						gameObject3.transform.localPosition = Vector3.zero;
						gameObject3.transform.localRotation = Quaternion.identity;
						gameObject3.transform.localScale = Vector3.one;
						gameObject3.name = "Item" + index;
						if (!isSeasonScore)
						{
							score = msg2.Data[0].Score.ToString();
							score = score.Insert(score.Length - 3, ".");
						}
						else
						{
							score = msg2.Data[0].Score.ToString();
						}
						gameObject3.GetComponent<RankListElement>().SetRank(msg2.Data[0].Rank, msg2.Data[0].User.OculusID, score, isSeasonScore);
						rankListItems.Add(gameObject3.GetComponent<RankListElement>());
						gameObject3.GetComponent<Image>().enabled = true;
					}
				});
			}
		});
	}
}
public class RankListElement : MonoBehaviour
{
	public Text rank;

	public Text nickName;

	public Text score;

	public int index = -1;

	public void SetRank(int rank, string nickName, string score, bool total)
	{
		if (rank == 0)
		{
			this.rank.text = "-";
		}
		else
		{
			this.rank.text = rank.ToString();
		}
		this.nickName.text = nickName;
		if (!total)
		{
			if (Singleton<DataManager>.Instance.userData.unit == 0)
			{
				this.score.text = ConvertCentimeterToInches(float.Parse(score, CultureInfo.InvariantCulture)).ToString("N3");
			}
			else
			{
				this.score.text = score.ToString();
			}
		}
		else
		{
			this.score.text = score;
		}
	}

	public float ConvertCentimeterToInches(float cm)
	{
		return cm / 2.54f;
	}
}
public class LerfPosRot : MonoBehaviour
{
	public Transform target;

	public float speed = 1f;

	private void Start()
	{
	}

	private void LateUpdate()
	{
		base.transform.position = target.position;
		base.transform.rotation = Quaternion.Slerp(base.transform.rotation, target.rotation, Time.deltaTime * speed);
	}
}
public class LoadingManager : MonoBehaviour
{
	[SerializeField]
	private string scene;

	public Text loadingTip;

	public Text loadingText;

	public float delayTime = 1f;

	public float loadingbarTime = 0.7f;

	private int textPointCount;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		Initialize();
	}

	private void Initialize()
	{
		loadingText.text = "";
	}

	private void Start()
	{
		StartCoroutine(textAction());
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			int num = UnityEngine.Random.Range(1, 19);
			if (num < 7)
			{
				loadingTip.GetComponent<Localize>().SetKey("LoadingOGo/00" + num.ToString("00"));
			}
			else
			{
				loadingTip.GetComponent<Localize>().SetKey("Loading/00" + num.ToString("00"));
			}
		}
		else
		{
			int num2 = UnityEngine.Random.Range(1, 19);
			loadingTip.GetComponent<Localize>().SetKey("Loading/00" + num2.ToString("00"));
		}
		scene = staticLoading.Stage;
		dataManager.SavePlaytime();
		if (dataManager.isBeta)
		{
			StartCoroutine(LoadNewScene());
			return;
		}
		OnlineCheck.Check(delegate(bool isConnected, NetworkReachability b)
		{
			if (isConnected)
			{
				StartCoroutine(Singleton<DBManager>.Instance.GetVersion(delegate(object response)
				{
					if (response == null)
					{
						StartCoroutine(LoadNewScene());
					}
					else
					{
						Singleton<DBManager>.Instance.cloudVersion = response.ToString();
						if (dataManager.checkVersion)
						{
							if (float.Parse(Singleton<DBManager>.Instance.cloudVersion, CultureInfo.InvariantCulture) > float.Parse(UnityEngine.Application.version, CultureInfo.InvariantCulture))
							{
								StartCoroutine(Restart());
							}
							else
							{
								StartCoroutine(LoadNewScene());
							}
						}
						else
						{
							StartCoroutine(LoadNewScene());
						}
					}
				}));
			}
			else
			{
				StartCoroutine(LoadNewScene());
			}
		});
	}

	private IEnumerator Restart()
	{
		yield return new WaitForSeconds(1f);
		UnityEngine.Object.Destroy(dataManager.gameObject);
		SceneManager.LoadScene(0);
	}

	private IEnumerator LoadNewScene()
	{
		yield return new WaitForSeconds(delayTime);
		UnityEngine.AsyncOperation async = SceneManager.LoadSceneAsync(scene);
		while (!async.isDone)
		{
			yield return null;
		}
	}

	private IEnumerator textAction()
	{
		string textPoint = "";
		string translator = loadingText.text;
		while (true)
		{
			textPoint += ".";
			loadingText.text = translator + textPoint;
			textPointCount++;
			if (textPointCount > 2)
			{
				textPointCount = 0;
				textPoint = "";
			}
			yield return new WaitForSeconds(loadingbarTime);
		}
	}
}
public static class staticLoading
{
	private static string stage;

	public static string Stage
	{
		get
		{
			return stage;
		}
		set
		{
			stage = value;
		}
	}
}
public class AquariumController : MonoBehaviour
{
	public GameObject[] aquaWall;

	public GameObject[] aquaDeco;

	public Material matAquaSand;

	public SchoolController[] fishSet;

	public int fishTankLimitStep = 10;

	public int fishTankMax = 50;

	public int fishCurCount;

	[Header("AWARD FISH")]
	public SchoolController awardFishSet;

	public int awardFishMax;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
		StartCoroutine(waitSetting());
	}

	private IEnumerator waitSetting()
	{
		while (!dataManager.loaded)
		{
			yield return null;
		}
		Setting();
		SettingFish();
	}

	public void Setting()
	{
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && !PhotonNetwork.IsMasterClient)
		{
			int[] array = new int[0];
			List<AquaItem> aquaItems = dataManager.ItemDatabase.dlcs[main.nationId].aquaItems;
			if (main.lobbyId == 0)
			{
				array = (int[])PhotonNetwork.CurrentRoom.CustomProperties["decorations_A"];
			}
			else if (main.lobbyId == 1)
			{
				array = (int[])PhotonNetwork.CurrentRoom.CustomProperties["decorations_B"];
			}
			for (int i = 0; i < array.Length; i++)
			{
				if (aquaItems[array[i]].type == AquariumType.WALL)
				{
					SettingWall(array[i]);
				}
				else if (aquaItems[array[i]].type == AquariumType.DECORATION)
				{
					SettingDeco(array[i], OnOff: true);
				}
			}
			return;
		}
		List<AquariumData> items = dataManager.userData.aquariums[main.nationId].rooms[main.lobbyId].items;
		List<AquaItem> aquaItems2 = dataManager.ItemDatabase.dlcs[main.nationId].aquaItems;
		for (int j = 0; j < items.Count; j++)
		{
			if (aquaItems2[j].type == AquariumType.WALL)
			{
				if (items[j].state)
				{
					SettingWall(j);
				}
			}
			else if (aquaItems2[j].type == AquariumType.DECORATION)
			{
				if (items[j].state)
				{
					SettingDeco(j, OnOff: true);
				}
				else
				{
					SettingDeco(j, OnOff: false);
				}
			}
		}
	}

	public void SettingFish()
	{
		for (int i = 0; i < fishSet.Length; i++)
		{
			UpdateFish(i);
		}
	}

	public void SettingWall(int wallId)
	{
		switch (wallId)
		{
		case 0:
			aquaWall[0].SetActive(value: true);
			aquaWall[1].SetActive(value: false);
			matAquaSand.SetFloat("_LightB1", 1f);
			break;
		case 1:
			aquaWall[0].SetActive(value: false);
			aquaWall[1].SetActive(value: true);
			matAquaSand.SetFloat("_LightB1", 1f);
			break;
		case 2:
			aquaWall[0].SetActive(value: false);
			aquaWall[1].SetActive(value: false);
			matAquaSand.SetFloat("_LightB1", 0f);
			break;
		}
	}

	public void SettingDeco(int id, bool OnOff)
	{
		aquaDeco[id - 3].SetActive(OnOff);
		if (OnOff)
		{
			matAquaSand.SetFloat("_Light" + id, 1f);
		}
		else
		{
			matAquaSand.SetFloat("_Light" + id, 0f);
		}
	}

	public void UpdateFish(int id)
	{
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && !PhotonNetwork.IsMasterClient)
		{
			int[] array = new int[0];
			if (main.lobbyId == 0)
			{
				array = (int[])PhotonNetwork.CurrentRoom.CustomProperties["fishCount_A"];
			}
			else if (main.lobbyId == 1)
			{
				array = (int[])PhotonNetwork.CurrentRoom.CustomProperties["fishCount_B"];
			}
			fishSet[id]._childAmount = array[id];
		}
		else
		{
			fishSet[id]._childAmount = dataManager.userData.aquariums[main.nationId].rooms[main.lobbyId].fishCount[id];
		}
		fishSet[id].UpdateFishAmount(fishSet[id]._childAmount, fishSet[id]._roamers.Count);
		fishSet[id].AutoRandomWaypointPosition();
	}

	public void AddFish(int id)
	{
		if (fishSet[id]._childAmount < dataManager.userData.aquariums[main.nationId].rooms[main.lobbyId].fishCount[id])
		{
			fishSet[id]._childAmount++;
			fishSet[id].AddFish(1);
		}
		if (fishSet[id]._childAmount > 0)
		{
			fishSet[id].AutoRandomWaypointPosition();
		}
	}

	public void AddAwardFish()
	{
		awardFishSet._childAmount = awardFishMax;
		awardFishSet.UpdateFishAmount(awardFishSet._childAmount, awardFishSet._roamers.Count);
		awardFishSet.AutoRandomWaypointPosition();
	}

	public void RemoveFish(int id)
	{
		if (fishSet[id]._childAmount > 0)
		{
			fishSet[id]._childAmount--;
			fishSet[id].RemoveFish();
		}
	}

	public void RemoveAwardFish()
	{
		awardFishSet._childAmount = 0;
		awardFishSet.UpdateFishAmount(awardFishSet._childAmount, awardFishSet._roamers.Count);
		awardFishSet.AutoRandomWaypointPosition();
	}

	public int GetCurrentFishCount()
	{
		int num = 0;
		foreach (int item in dataManager.userData.aquariums[main.nationId].rooms[main.lobbyId].fishCount)
		{
			num += item;
		}
		fishCurCount = num;
		return num;
	}

	public void CheckAchivementAqua(int currentFCount)
	{
		int num = 8;
		if (currentFCount > dataManager.userData.achievements[dataManager.currentNation].achievement[num])
		{
			Singleton<AchievementController>.Instance.checkUpgrade(num);
		}
	}
}
public class BoatsManager : MonoBehaviour
{
	public Transform[] boatPositions;

	public Control_boat[] boatControl;

	private Control_boat curBoatControl;

	private void Start()
	{
	}

	public void setMyBoat(Transform boatTrans)
	{
		int curBoat = Singleton<DataManager>.Instance.userData.curBoat;
		curBoatControl = UnityEngine.Object.Instantiate(boatControl[curBoat], boatTrans.position, boatTrans.rotation);
	}

	public void initMyBoat()
	{
		int count = Singleton<DataManager>.Instance.userData.boats.Count;
		for (int i = 0; i < count; i++)
		{
			setMyBoat(boatPositions[i]);
		}
	}
}
public class CamCullMirror : MonoBehaviour
{
	public CamFadeControl camFade;

	public float fadeTime = 0.1f;

	private bool fade;

	private void Start()
	{
	}

	private void Update()
	{
		if (!fade)
		{
			if (camFade.transform.position.x > base.transform.position.x)
			{
				fade = true;
				camFade.FadeSpeed(0f, 1f, fadeTime);
			}
		}
		else if (camFade.transform.position.x < base.transform.position.x)
		{
			fade = false;
			camFade.FadeSpeed(1f, 0f, fadeTime);
		}
	}
}
public enum CLOUDCHECKMODE
{
	SAVE,
	LOAD
}
public class CloudCheckWindow : MonoBehaviour
{
	public SettingManager settingManager;

	public Text desc;

	public void SetMode(CLOUDCHECKMODE mode)
	{
		switch (mode)
		{
		case CLOUDCHECKMODE.SAVE:
			desc.text = LocalizationManager.GetKeyTranslation("LodgeTVSettings/0046");
			break;
		case CLOUDCHECKMODE.LOAD:
			desc.text = LocalizationManager.GetKeyTranslation("LodgeTVSettings/0047");
			break;
		}
	}

	public void Success(CLOUDCHECKMODE mode)
	{
		MonoBehaviour.print("Suceess");
		switch (mode)
		{
		case CLOUDCHECKMODE.SAVE:
			desc.text = LocalizationManager.GetKeyTranslation("LodgeTVSettings/0058");
			break;
		case CLOUDCHECKMODE.LOAD:
			desc.text = LocalizationManager.GetKeyTranslation("LodgeTVSettings/0048");
			break;
		}
		StartCoroutine(settingManager.HideCheckWindow(2f));
	}

	public void Fail(int value)
	{
		MonoBehaviour.print("Fail");
		switch (value)
		{
		case 0:
			desc.text = LocalizationManager.GetKeyTranslation("LodgeTVSettings/0049");
			break;
		case 1:
			desc.text = LocalizationManager.GetKeyTranslation("LodgeTVSettings/0050");
			break;
		case 2:
			desc.text = LocalizationManager.GetKeyTranslation("LodgeTVSettings/0051");
			break;
		}
		StartCoroutine(settingManager.HideCheckWindow(2f));
	}
}
public enum CLOUDSELECTMODE
{
	UPLOAD,
	DOWNLOAD,
	RESET
}
public class CloudPopupWindow : MonoBehaviour
{
	public SettingManager settingManager;

	public Text desc;

	public CLOUDSELECTMODE mode;

	public void SetMode(CLOUDSELECTMODE mode)
	{
		this.mode = mode;
		switch (mode)
		{
		case CLOUDSELECTMODE.UPLOAD:
			desc.text = LocalizationManager.GetKeyTranslation("LodgeTVSettings/0052");
			break;
		case CLOUDSELECTMODE.DOWNLOAD:
			desc.text = LocalizationManager.GetKeyTranslation("LodgeTVSettings/0053");
			break;
		case CLOUDSELECTMODE.RESET:
			desc.text = LocalizationManager.GetKeyTranslation("LodgeTVSettings/0054");
			break;
		}
	}

	public void ClickYes()
	{
		switch (mode)
		{
		case CLOUDSELECTMODE.UPLOAD:
			settingManager.ShowCheckWindow(0);
			settingManager.HidePopupWindow();
			break;
		case CLOUDSELECTMODE.DOWNLOAD:
			settingManager.ShowCheckWindow(1);
			settingManager.HidePopupWindow();
			break;
		case CLOUDSELECTMODE.RESET:
			StartCoroutine(Singleton<VersionManager>.Instance.DeleteCurrentDataWithLoadScene());
			break;
		}
	}

	public void ClickNo()
	{
		base.gameObject.SetActive(value: false);
	}
}
public class control_lobbyHand : MonoBehaviour
{
	public GameObject hand;

	public GameObject controller_GO;

	public GameObject controller_Touch;

	public HandState handState;

	public Transform rayPosition;

	private void Awake()
	{
	}

	public void showHand(bool showController)
	{
	}

	public void setHandState(bool isGrab)
	{
		if (isGrab)
		{
			handState.ChangeState(2);
		}
		else
		{
			handState.ChangeState(1);
		}
	}
}
public class control_trophy : MonoBehaviour
{
	public int id;

	public TrophyManager trophySet;

	public GameObject[] trophyObj;

	public bool useThis = true;

	private MeshRenderer render;

	private bool complete;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		render = GetComponent<MeshRenderer>();
	}

	private void Start()
	{
		if (useThis)
		{
			checkTrophy();
		}
	}

	public void checkTrophy()
	{
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && !PhotonNetwork.IsMasterClient)
		{
			_ = (int[])PhotonNetwork.CurrentRoom.CustomProperties["achievements"];
			int[] array = (int[])PhotonNetwork.CurrentRoom.CustomProperties["grades"];
			for (int i = 0; i < trophyObj.Length; i++)
			{
				if (i == array[id] - 1)
				{
					trophyObj[i].SetActive(value: true);
				}
				else
				{
					trophyObj[i].SetActive(value: false);
				}
			}
			return;
		}
		for (int j = 0; j < trophyObj.Length; j++)
		{
			if (j == dataManager.userData.achievements[dataManager.currentNation].grade[id] - 1)
			{
				trophyObj[j].SetActive(value: true);
			}
			else
			{
				trophyObj[j].SetActive(value: false);
			}
		}
	}

	public void showInfo()
	{
		render.enabled = true;
		if (useThis)
		{
			trophySet.hideAll();
			render.enabled = true;
			trophySet.showInfo(id, base.transform.position);
		}
	}

	public void hide()
	{
		render.enabled = false;
	}
}
public class doorOpenClose : MonoBehaviour
{
	public bool isTypeSlide = true;

	public float openDirection = 1.7f;

	private float oriDirection;

	public float speed = 1f;

	private float openTime = 2f;

	private float pos;

	private bool isOpened;

	public AudioClip soundOpen;

	public AudioClip soundClose;

	private AudioSource audio;

	private void Start()
	{
		audio = GetComponent<AudioSource>();
		if (isTypeSlide)
		{
			oriDirection = base.transform.position.x;
		}
		else
		{
			oriDirection = base.transform.eulerAngles.y;
		}
	}

	public void openDoor()
	{
		if (!isOpened)
		{
			if (isTypeSlide)
			{
				StartCoroutine(cSlideOpenClose());
			}
			else
			{
				StartCoroutine(cRotateOpenClose());
			}
		}
	}

	private IEnumerator cSlideOpenClose()
	{
		isOpened = true;
		Singleton<Main>.Instance.lobbyEnvController.PlayEnvSound(isOpen: true);
		audio.clip = soundOpen;
		audio.Play();
		while (pos < 1f)
		{
			pos += Time.deltaTime * speed;
			base.transform.position = new Vector3(pos * openDirection, base.transform.position.y, base.transform.position.z);
			yield return null;
		}
		pos = 1f;
		base.transform.position = new Vector3(openDirection, base.transform.position.y, base.transform.position.z);
		yield return new WaitForSeconds(openTime);
		audio.clip = soundClose;
		audio.Play();
		while (pos > 0f)
		{
			pos -= Time.deltaTime * speed;
			base.transform.position = new Vector3(pos * openDirection, base.transform.position.y, base.transform.position.z);
			yield return null;
		}
		pos = 0f;
		base.transform.position = new Vector3(0f, base.transform.position.y, base.transform.position.z);
		isOpened = false;
		Singleton<Main>.Instance.lobbyEnvController.PlayEnvSound(isOpen: false);
	}

	private IEnumerator cRotateOpenClose()
	{
		isOpened = true;
		Singleton<Main>.Instance.lobbyEnvController.PlayEnvSound(isOpen: true);
		audio.clip = soundOpen;
		audio.Play();
		float direction = 1f;
		if (Singleton<Main>.Instance.vrPlayerController.transform.position.x < base.transform.position.x)
		{
			direction = -1f;
		}
		while (pos < 1f)
		{
			pos += Time.deltaTime * speed;
			base.transform.eulerAngles = new Vector3(0f, oriDirection + direction * pos * openDirection, 0f);
			yield return null;
		}
		pos = 1f;
		base.transform.eulerAngles = new Vector3(0f, oriDirection + direction * openDirection, 0f);
		yield return new WaitForSeconds(openTime);
		audio.clip = soundClose;
		audio.Play();
		while (pos > 0f)
		{
			pos -= Time.deltaTime * speed;
			base.transform.eulerAngles = new Vector3(0f, oriDirection + direction * pos * openDirection, 0f);
			yield return null;
		}
		pos = 0f;
		base.transform.eulerAngles = new Vector3(0f, oriDirection, 0f);
		isOpened = false;
		Singleton<Main>.Instance.lobbyEnvController.PlayEnvSound(isOpen: false);
	}
}
public class FurnitureController : MonoBehaviour
{
	public List<GameObject> furniturePrefabs;

	private DataManager dataManager;

	private Main main;

	private bool completed;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		StartCoroutine(waitInit());
	}

	private IEnumerator waitInit()
	{
		while (!dataManager.loaded)
		{
			yield return null;
		}
		SettingFurniture();
	}

	private void Start()
	{
	}

	public void SettingFurniture()
	{
		foreach (GameObject furniturePrefab in furniturePrefabs)
		{
			furniturePrefab.SetActive(value: false);
		}
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && !PhotonNetwork.IsMasterClient)
		{
			int[] array = new int[0];
			_ = dataManager.ItemDatabase.dlcs[main.nationId].furnitureItems;
			if (main.lobbyId == 0)
			{
				array = (int[])PhotonNetwork.CurrentRoom.CustomProperties["furnitures_A"];
			}
			else if (main.lobbyId == 1)
			{
				array = (int[])PhotonNetwork.CurrentRoom.CustomProperties["furnitures_B"];
			}
			for (int i = 0; i < array.Length; i++)
			{
				furniturePrefabs[array[i]].SetActive(value: true);
			}
			return;
		}
		List<FurnitureData> items = dataManager.userData.furnitures[main.nationId].rooms[main.lobbyId].items;
		_ = dataManager.ItemDatabase.dlcs[main.nationId].furnitureItems;
		for (int j = 0; j < items.Count; j++)
		{
			if (items[j].state)
			{
				furniturePrefabs[j].SetActive(value: true);
			}
		}
	}
}
public class LobbyEnvController : MonoBehaviour
{
	public bool enableEnvChange = true;

	public int testTime;

	private Main main;

	public LightingDataChanger lightmapChanger;

	public Renderer EnvObj;

	public Renderer LakeObj;

	public Material mEnvDay;

	public Material mEnvSunset;

	public Material mEnvNight;

	public Material mLakeDay;

	public Material mLakeSunset;

	public Material mLakeNight;

	public GameObject cloud_day;

	public GameObject cloud_sunset;

	public GameObject cloud_night;

	public GameObject sound_day;

	public GameObject sound_sunset;

	public GameObject sound_night;

	public GameObject sound_water;

	public GameObject sound_fire;

	public GameObject lightParticle;

	public GameObject reflectionProbeDay;

	public GameObject reflectionProbeSunset;

	public GameObject reflectionProbeNight;

	private GameObject soundTime;

	[HideInInspector]
	public int time;

	[HideInInspector]
	public int timeAddStage;

	public List<Transform> multiplaySpawnPositions;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		getTime();
		if (main.lobbyId == 0)
		{
			if (enableEnvChange)
			{
				sound_day.SetActive(value: false);
				sound_sunset.SetActive(value: false);
				sound_night.SetActive(value: false);
				sound_water.SetActive(value: false);
				changeEnv();
				BoatSetting();
			}
			else
			{
				time = testTime;
				sound_day.SetActive(value: false);
				sound_sunset.SetActive(value: false);
				sound_night.SetActive(value: false);
				sound_water.SetActive(value: false);
				changeEnv();
			}
		}
	}

	private void getTime()
	{
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && !PhotonNetwork.IsMasterClient)
		{
			time = (int)PhotonNetwork.CurrentRoom.CustomProperties["time"];
			return;
		}
		if (dataManager.userData.cabinTime == 0)
		{
			time = DateTime.Now.Hour;
		}
		else if (dataManager.userData.cabinTime == 1)
		{
			time = 12;
			timeAddStage = 0;
		}
		else if (dataManager.userData.cabinTime == 2)
		{
			time = 18;
			timeAddStage = 1;
		}
		else
		{
			time = 21;
			timeAddStage = 2;
		}
		if (time >= 17 && time <= 19)
		{
			timeAddStage = 1;
		}
		else if (time > 19 || time < 6)
		{
			timeAddStage = 2;
		}
		else
		{
			timeAddStage = 0;
		}
	}

	private void changeEnv()
	{
		if (time >= 17 && time <= 19)
		{
			if (main.lobbyId == 0)
			{
				lightmapChanger.ApplyLightingDataName("LodgeKoreaSunset");
				reflectionProbeSunset.SetActive(value: true);
				EnvObj.material = mEnvSunset;
				LakeObj.material = mLakeSunset;
				cloud_sunset.SetActive(value: true);
				soundTime = sound_sunset;
				lightParticle.SetActive(value: true);
			}
			timeAddStage = 1;
		}
		else if (time > 19 || time < 6)
		{
			if (main.lobbyId == 0)
			{
				lightmapChanger.ApplyLightingDataName("LodgeKoreaNight");
				reflectionProbeNight.SetActive(value: true);
				EnvObj.material = mEnvNight;
				LakeObj.material = mLakeNight;
				cloud_night.SetActive(value: true);
				soundTime = sound_night;
				lightParticle.SetActive(value: true);
			}
			timeAddStage = 2;
		}
		else
		{
			if (main.lobbyId == 0)
			{
				lightmapChanger.ApplyLightingDataName("LodgeKoreaDay");
				reflectionProbeDay.SetActive(value: true);
				EnvObj.material = mEnvDay;
				LakeObj.material = mLakeDay;
				cloud_day.SetActive(value: true);
				soundTime = sound_day;
				lightParticle.SetActive(value: false);
			}
			timeAddStage = 0;
		}
		envSoundVolumeSet();
	}

	public void envSound(bool isOut)
	{
		if (main.lobbyId == 0 && enableEnvChange)
		{
			if (isOut)
			{
				soundTime.SetActive(value: true);
				sound_water.SetActive(value: true);
				sound_fire.SetActive(value: false);
			}
			else
			{
				soundTime.SetActive(value: false);
				sound_water.SetActive(value: false);
				sound_fire.SetActive(value: true);
			}
		}
	}

	public void envSoundVolumeSet()
	{
		if (main.lobbyId == 0)
		{
			soundTime.GetComponent<AudioSource>().volume = (float)dataManager.userData.volumeAmbient * 0.1f;
			sound_water.GetComponent<AudioSource>().volume = (float)dataManager.userData.volumeAmbient * 0.1f;
			sound_fire.GetComponent<AudioSource>().volume = (float)dataManager.userData.volumeAmbient * 0.1f;
		}
	}

	public void BoatSetting()
	{
		if (main.lobbyId == 0)
		{
			dataManager.userData.boats.Contains(0);
		}
	}

	public void PlayEnvSound(bool isOpen)
	{
		if (isOpen)
		{
			main.lobbyEnvController.envSound(isOut: true);
		}
		else if (main.vrPlayerController.curPlayerArea == VRPlayerController.playerArea.room)
		{
			main.lobbyEnvController.envSound(isOut: false);
		}
		else
		{
			main.lobbyEnvController.envSound(isOut: true);
		}
	}
}
public class LobbyUIManager : LobbyUIManagerBase
{
	public Color selectedColor = new Color(0f, 0.7529413f, 0.6901961f, 1f);

	public Color unSelectedColor = new Color(0.6792453f, 0.6792453f, 0.6792453f, 1f);

	public Color uninteractiveColor = new Color(0.2138216f, 0.2924528f, 0.2858079f, 1f);

	[Header("UI IMAGES")]
	public Image[] uiVolumes;

	public Image[] uiAmbients;

	public Image[] uiQuality;

	public Image[] uiDifficulty;

	public Image[] uiUnit;

	public Image[] uiHand;

	public Image[] uiMove;

	public Image[] uiTurn;

	public Image[] uiEnvTime;

	public Image[] uiCloud;

	public Image[] uiLanguage;

	private Coroutine BlinkCoroutine;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	public override void Start()
	{
		base.Start();
		CheckTutorial();
	}

	private void CheckTutorial()
	{
		if (main.vrPlayerController != null)
		{
			main.vrPlayerController.screenArea.enabled = true;
		}
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
		{
			UnityEngine.Debug.Log("방에 있어서 리턴!");
		}
		else
		{
			Initialize();
		}
	}

	private void Initialize()
	{
		ClosePanels();
		HideLocationInfo();
		startButton.gameObject.SetActive(value: false);
		for (int i = 0; i < maps.Length; i++)
		{
			if (i == 0)
			{
				maps[0].SetActive(value: true);
			}
			else
			{
				maps[i].SetActive(value: false);
			}
		}
	}

	private int GetIDbySceneName(string sceneName)
	{
		return dataManager.ItemDatabase.dlcs[main.nationId].stageItems.Where((StageItem s) => s.stageScene == sceneName).First().id;
	}

	public void GoStage(string sceneName)
	{
		if (isPlayTutorial)
		{
			return;
		}
		HideLocationInfo();
		locationInfo.gameObject.SetActive(value: true);
		if (sceneName == "Stage15_hongchun")
		{
			if (main.lobbyEnvController.timeAddStage == 1)
			{
				stageID = GetIDbySceneName("Stage15_hongchun_sunset");
			}
			else if (main.lobbyEnvController.timeAddStage == 2)
			{
				stageID = GetIDbySceneName("Stage15_hongchun_night");
			}
			else
			{
				stageID = GetIDbySceneName("Stage15_hongchun");
			}
		}
		else
		{
			stageID = GetIDbySceneName(sceneName);
		}
		locationInfo.SetInfo(stageID);
		StageItem stageItem = dataManager.ItemDatabase.dlcs[main.nationId].stageItems[stageID];
		if (stageItem.level <= dataManager.userData.userLv)
		{
			if (stageItem.stageType < 2)
			{
				startButton.gameObject.SetActive(value: true);
				selectText.enabled = false;
			}
			else if (stageItem.stageType == 2)
			{
				startButton.gameObject.SetActive(value: true);
				selectText.enabled = false;
			}
			else if (stageItem.stageType == 3 && dataManager.userData.boats.Count > 0)
			{
				startButton.gameObject.SetActive(value: true);
				selectText.enabled = false;
			}
			else
			{
				startButton.gameObject.SetActive(value: false);
				selectText.enabled = true;
			}
		}
		else
		{
			startButton.gameObject.SetActive(value: false);
			selectText.enabled = true;
		}
	}

	private void HideStageButton()
	{
		HideLocationInfo();
		startButton.gameObject.SetActive(value: false);
	}

	private void HideLocationInfo()
	{
		locationInfo.gameObject.SetActive(value: false);
	}

	public void GoFishing()
	{
		main.vrLobbyPointerL.isStopRaycasting = true;
		main.vrLobbyPointerR.isStopRaycasting = true;
		dataManager.Save();
		StartCoroutine(startFishing());
	}

	private IEnumerator startFishing()
	{
		startButton.interactable = false;
		main.fadeCamera.FadeOut();
		yield return new WaitForSeconds(2.5f);
		staticLoading.Stage = dataManager.ItemDatabase.dlcs[0].stageItems[stageID].stageScene;
		SceneManager.LoadScene("Loading");
	}

	public void SelectNation(int nation)
	{
	}

	public void ChangeMap(int mapNum)
	{
		mapNumber = mapNum;
		if (mapNumber == 0)
		{
			HideStageButton();
		}
		for (int i = 0; i < maps.Length; i++)
		{
			if (i == mapNumber)
			{
				maps[mapNumber].SetActive(value: true);
			}
			else
			{
				maps[i].SetActive(value: false);
			}
		}
	}

	public void SelectMenu(int menuNum)
	{
		HideLocationInfo();
		if (!isPlayTutorial)
		{
			for (int i = 0; i < allMenus.Count; i++)
			{
				allMenus[i].enabled = true;
			}
			for (int j = 0; j < menuIcons.Count; j++)
			{
				if (j == menuNum)
				{
					if (menuIcons[j] != null)
					{
						menuIcons[j].color = selectedColor;
					}
				}
				else if (menuIcons[j] != null)
				{
					menuIcons[j].color = unSelectedColor;
				}
			}
			for (int k = 0; k < allPanels.Count; k++)
			{
				allPanels[k].SetActive(value: false);
			}
			allPanels[menuNum].SetActive(value: true);
			switch (menuNum)
			{
			case 0:
				ChangeMap(1);
				break;
			case 6:
				InitSettingWindow();
				break;
			case 7:
				tutorialManager.useTutorial = true;
				startTutorial();
				break;
			}
			if (menuNum >= 0 && menuNum <= 7 && PhotonNetwork.IsConnected)
			{
				PhotonNetwork.Disconnect();
			}
		}
		else
		{
			NextTutorial(menuNum);
		}
	}

	public void NextTutorial(int menuNum)
	{
		if (menuNum == 7)
		{
			startTutorial();
			return;
		}
		int nextpage = tutorialManager.getNextpage(menuNum);
		for (int i = 0; i < menuIcons.Count; i++)
		{
			if (i == menuNum)
			{
				if (menuIcons[i] != null)
				{
					menuIcons[i].color = selectedColor;
				}
			}
			else if (menuIcons[i] != null)
			{
				menuIcons[i].color = unSelectedColor;
			}
		}
		for (int j = 0; j < allPanels.Count; j++)
		{
			if (j == menuNum || j == 7)
			{
				allPanels[j].SetActive(value: true);
			}
			else
			{
				allPanels[j].SetActive(value: false);
			}
		}
		blinkTutorialButton(nextpage);
		if (nextpage == -1)
		{
			tutorialManager.closeBlock();
		}
		else
		{
			for (int k = 0; k < allMenus.Count; k++)
			{
				if (k == nextpage)
				{
					allMenus[k].enabled = true;
				}
				else
				{
					allMenus[k].enabled = false;
				}
			}
		}
		switch (menuNum)
		{
		case 0:
			ChangeMap(1);
			break;
		case 8:
			InitSettingWindow();
			break;
		}
	}

	public void startTutorial()
	{
		if (!tutorialManager.useTutorial)
		{
			return;
		}
		blinkTutorialButton(1);
		isPlayTutorial = true;
		for (int i = 0; i < menuIcons.Count; i++)
		{
			menuIcons[i].color = unSelectedColor;
		}
		for (int j = 0; j < allPanels.Count; j++)
		{
			allPanels[j].SetActive(value: false);
		}
		for (int k = 0; k < allMenus.Count; k++)
		{
			if (k == 1)
			{
				allMenus[k].enabled = true;
			}
			else
			{
				allMenus[k].enabled = false;
			}
		}
		allPanels[7].SetActive(value: true);
		panael_Notice.SetActive(value: true);
		tutorialManager.getNextpage(7);
	}

	public void InitSettingWindow()
	{
		for (int i = 0; i < uiVolumes.Length; i++)
		{
			if (dataManager.userData.volumeMusic >= i)
			{
				uiVolumes[i].color = selectedColor;
			}
			else
			{
				uiVolumes[i].color = unSelectedColor;
			}
		}
		for (int j = 0; j < uiAmbients.Length; j++)
		{
			if (dataManager.userData.volumeAmbient >= j)
			{
				uiAmbients[j].color = selectedColor;
			}
			else
			{
				uiAmbients[j].color = unSelectedColor;
			}
		}
		for (int k = 0; k < uiQuality.Length; k++)
		{
			if (dataManager.userData.graphicQuality == k)
			{
				uiQuality[k].color = selectedColor;
			}
			else
			{
				uiQuality[k].color = unSelectedColor;
			}
			if (dataManager.targetPlatform != 0)
			{
				uiQuality[uiQuality.Length - 1].gameObject.SetActive(value: false);
			}
			else if (dataManager.userData.bFrameRateHigh)
			{
				uiQuality[uiQuality.Length - 1].color = selectedColor;
			}
		}
		for (int l = 0; l < uiDifficulty.Length; l++)
		{
			if (dataManager.userData.gameDifficulty == l)
			{
				uiDifficulty[l].color = selectedColor;
			}
			else
			{
				uiDifficulty[l].color = unSelectedColor;
			}
		}
		for (int m = 0; m < uiUnit.Length; m++)
		{
			if (dataManager.userData.unit == m)
			{
				uiUnit[m].color = selectedColor;
			}
			else
			{
				uiUnit[m].color = unSelectedColor;
			}
		}
		if (dataManager.userData.rightHand)
		{
			uiHand[0].color = selectedColor;
			uiHand[1].color = unSelectedColor;
		}
		else
		{
			uiHand[0].color = unSelectedColor;
			uiHand[1].color = selectedColor;
		}
		if (dataManager.userData.bothHand)
		{
			uiHand[2].color = selectedColor;
		}
		else
		{
			uiHand[2].color = unSelectedColor;
		}
		for (int n = 0; n < uiMove.Length; n++)
		{
			if (dataManager.userData.walkCabin == n)
			{
				uiMove[n].color = selectedColor;
			}
			else
			{
				uiMove[n].color = unSelectedColor;
			}
		}
		for (int num = 0; num < uiTurn.Length; num++)
		{
			if (dataManager.userData.rotateCabin == num)
			{
				uiTurn[num].color = selectedColor;
			}
			else
			{
				uiTurn[num].color = unSelectedColor;
			}
		}
		for (int num2 = 0; num2 < uiEnvTime.Length; num2++)
		{
			if (dataManager.userData.cabinTime == num2)
			{
				uiEnvTime[num2].color = selectedColor;
			}
			else
			{
				uiEnvTime[num2].color = unSelectedColor;
			}
		}
		for (int num3 = 0; num3 < uiCloud.Length; num3++)
		{
			uiCloud[num3].color = selectedColor;
		}
		for (int num4 = 0; num4 < uiLanguage.Length; num4++)
		{
			if (dataManager.userData.language == num4)
			{
				uiLanguage[num4].color = selectedColor;
			}
			else
			{
				uiLanguage[num4].color = unSelectedColor;
			}
		}
	}

	public void SetMusicVolume(int num)
	{
		dataManager.userData.volumeMusic = num;
		MusicPlayerManager.Instance.SetVolume(num);
		dataManager.SaveUserData();
		InitSettingWindow();
	}

	public void SetAmbientVolume(int num)
	{
		dataManager.userData.volumeAmbient = num;
		main.lobbyEnvController.envSoundVolumeSet();
		dataManager.SaveUserData();
		InitSettingWindow();
	}

	public void SetQuality(int num)
	{
		dataManager.userData.graphicQuality = num;
		dataManager.SaveUserData();
		InitSettingWindow();
		main.settingController.qualityChange();
		staticLoading.Stage = SceneManager.GetActiveScene().name;
		SceneManager.LoadScene("Loading");
	}

	public void SetHighFrame()
	{
		bool bFrameRateHigh = dataManager.userData.bFrameRateHigh;
		dataManager.userData.bFrameRateHigh = !bFrameRateHigh;
		dataManager.SaveUserData();
		InitSettingWindow();
		main.settingController.qualityChange();
	}

	public void SetDifficulty(int num)
	{
		dataManager.userData.gameDifficulty = num;
		dataManager.SaveUserData();
		InitSettingWindow();
	}

	public void SetUnit(int num)
	{
		dataManager.userData.unit = num;
		dataManager.SaveUserData();
		InitSettingWindow();
	}

	public void SetHand(bool right)
	{
		dataManager.userData.rightHand = right;
		dataManager.SaveUserData();
		SceneManager.LoadScene(SceneManager.GetActiveScene().name);
		InitSettingWindow();
	}

	public void SetHandBoth()
	{
		dataManager.userData.bothHand = !dataManager.userData.bothHand;
		dataManager.SaveUserData();
		SceneManager.LoadScene(SceneManager.GetActiveScene().name);
		InitSettingWindow();
	}

	public void SetMoveCabin(int num)
	{
		dataManager.userData.walkCabin = num;
		dataManager.SaveUserData();
		InitSettingWindow();
	}

	public void SetTurnCabin(int num)
	{
		dataManager.userData.rotateCabin = num;
		dataManager.SaveUserData();
		InitSettingWindow();
	}

	public void SetCabinTime(int num)
	{
		if (dataManager.userData.cabinTime != num)
		{
			dataManager.userData.cabinTime = num;
			dataManager.SaveUserData();
			InitSettingWindow();
			SceneManager.LoadScene("Lobby");
		}
	}

	public void blinkTutorialButton(int menuNum)
	{
		stopBlink();
		if (menuNum != -1)
		{
			BlinkCoroutine = StartCoroutine(BlinkButton(menuNum));
		}
	}

	public void stopBlink()
	{
		if (BlinkCoroutine != null)
		{
			StopCoroutine(BlinkCoroutine);
		}
	}

	private IEnumerator BlinkButton(int num)
	{
		yield return new WaitForSeconds(tutorialManager.waitBlinkTime);
		float colorLerp = 0f;
		float lerpDirection = 1f;
		while (true)
		{
			colorLerp += Time.deltaTime * lerpDirection * tutorialManager.blinkSpeed;
			if (colorLerp >= 1f)
			{
				lerpDirection = -1f;
			}
			else if (colorLerp <= 0f)
			{
				lerpDirection = 1f;
			}
			menuIcons[num].color = Color.Lerp(unSelectedColor, tutorialManager.blinkColor, colorLerp);
			yield return null;
		}
	}

	public void GoTutorialScene(string sceneName)
	{
		HideLocationInfo();
		locationInfo.gameObject.SetActive(value: true);
		stageID = 22;
		locationInfo.SetInfo(stageID);
		StageItem tutorialStageItem = tutorialManager.tutorialStageItem;
		tutorialManager.HideTutorialContent();
		if (tutorialStageItem.level <= dataManager.userData.userLv)
		{
			if (tutorialStageItem.stageType < 2)
			{
				startButton.gameObject.SetActive(value: true);
				selectText.enabled = false;
			}
			else if (tutorialStageItem.stageType == 2)
			{
				startButton.gameObject.SetActive(value: true);
				selectText.enabled = false;
			}
			else if (tutorialStageItem.stageType == 3 && dataManager.userData.boats.Count > 0)
			{
				startButton.gameObject.SetActive(value: true);
				selectText.enabled = false;
			}
			else
			{
				startButton.gameObject.SetActive(value: false);
				selectText.enabled = true;
			}
		}
		else
		{
			startButton.gameObject.SetActive(value: false);
			selectText.enabled = true;
		}
	}
}
public class LobbyUIManagerBase : MonoBehaviour
{
	[Header("Reference")]
	public bool isPlayTutorial;

	public TutorialManager tutorialManager;

	public GameObject panael_Notice;

	[Header("Base Variables")]
	public int stageID;

	public int mapNumber;

	[Header("UI PANEL")]
	public List<GameObject> allPanels;

	public List<Button> allMenus;

	public List<Image> menuIcons;

	public LocationInfo locationInfo;

	public Text selectText;

	public Button startButton;

	public GameObject[] maps;

	private void Awake()
	{
	}

	public virtual void Start()
	{
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
		{
			UnityEngine.Debug.Log("방에 있어서 리턴!");
		}
		else
		{
			ClosePanels();
		}
	}

	public void ClosePanels()
	{
		for (int i = 0; i < allPanels.Count; i++)
		{
			allPanels[i].SetActive(value: false);
		}
	}
}
public class LocationInfo : MonoBehaviour
{
	public Text text_LocationName;

	public Text text_name;

	public Image image_stage;

	public Image image_fishAtHabit;

	public Image image_timeIcon;

	public Image image_unlockIcon;

	public Text text_unlock;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	public void OnLocalize()
	{
		MonoBehaviour.print("OnLocalize");
	}

	public void SetInfo(int id)
	{
		text_LocationName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.dlcs[main.nationId].nation.nameKey);
		StageItem stageItem = dataManager.ItemDatabase.dlcs[main.nationId].stageItems[id];
		text_name.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.dlcs[main.nationId].stageItems[id].nameKey);
		text_name.text = stageItem.level + ". " + text_name.GetComponent<Localize>().GetMainTargetsText();
		image_stage.sprite = dataManager.ItemDatabase.dlcs[main.nationId].stageItems[id].stageImage;
		image_fishAtHabit.sprite = dataManager.ItemDatabase.dlcs[main.nationId].stageItems[id].stageTypeImage;
		image_timeIcon.sprite = dataManager.ItemDatabase.dlcs[main.nationId].stageItems[id].stageTimeImage;
		if (dataManager.userData.userLv < stageItem.level)
		{
			image_unlockIcon.enabled = true;
			text_unlock.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
			text_unlock.text = text_unlock.GetComponent<Localize>().GetMainTargetsText() + " " + stageItem.level;
		}
		else if (stageItem.stageType > 2 && dataManager.userData.boats.Count == 0)
		{
			image_unlockIcon.enabled = true;
			text_unlock.GetComponent<Localize>().SetKey("LodgeTVMap/0007");
		}
		else
		{
			image_unlockIcon.enabled = false;
			text_unlock.text = "";
		}
	}
}
public class LodgeDoor : MonoBehaviour
{
	private bool isDoorOpen;

	public float openAngle = 90f;

	public float closeAngle;

	private void Start()
	{
	}

	private void Update()
	{
	}

	public void OpenDoor()
	{
	}

	public void CloseDoor()
	{
	}

	private IEnumerator doorRotate(bool open)
	{
		yield return null;
	}
}
public class MultimediaManager : MonoBehaviour
{
	public GameObject[] mediaButtons;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
	}

	private void Start()
	{
	}

	private void OnEnable()
	{
		for (int i = 0; i < mediaButtons.Length; i++)
		{
			mediaButtons[i].SetActive(value: false);
		}
		if (dataManager.userData.mediaState != 0)
		{
			mediaButtons[dataManager.userData.mediaState - 1].SetActive(value: true);
		}
	}

	public void SelectMedia(int _mediaState)
	{
		int mediaState = dataManager.userData.mediaState;
		if (mediaState == _mediaState)
		{
			mediaState = 0;
			for (int i = 0; i < mediaButtons.Length; i++)
			{
				mediaButtons[i].SetActive(value: false);
			}
			dataManager.userData.mediaState = 0;
		}
		else
		{
			mediaState = _mediaState;
			for (int j = 0; j < mediaButtons.Length; j++)
			{
				mediaButtons[j].SetActive(value: false);
			}
			mediaButtons[mediaState - 1].SetActive(value: true);
		}
		dataManager.userData.mediaState = mediaState;
		Singleton<MediaController>.Instance.SwitchMedia(mediaState);
	}
}
public class PortalControl : MonoBehaviour
{
	private enum portalState
	{
		hide,
		up,
		show,
		down
	}

	public bool isLodge = true;

	public bool useParticle = true;

	public GameObject particlePortal;

	public GameObject portalObject;

	public Transform detectSize;

	public float heightLimit = 2f;

	public float speed = 1f;

	private bool isPlayerIn;

	private Transform playerPos;

	private Animation anidoor;

	private portalState state;

	private float addHeight;

	private Collider col;

	private bool isMoving;

	private void Start()
	{
		portalObject.SetActive(value: false);
		particlePortal.SetActive(value: false);
		playerPos = Singleton<Main>.Instance.cameraTransform;
		col = GetComponent<Collider>();
		if (isLodge)
		{
			col.enabled = false;
			return;
		}
		col.enabled = true;
		particlePortal.SetActive(value: true);
	}

	private void Update()
	{
		if (!isLodge)
		{
			return;
		}
		if (playerPos.position.x > detectSize.transform.position.x - detectSize.localScale.x && playerPos.position.x < detectSize.transform.position.x + detectSize.localScale.x && playerPos.position.z > detectSize.transform.position.z - detectSize.localScale.z && playerPos.position.z < detectSize.transform.position.z + detectSize.localScale.z)
		{
			col.enabled = true;
			if (useParticle)
			{
				particlePortal.SetActive(value: true);
				return;
			}
			if (state == portalState.hide)
			{
				portalObject.SetActive(value: true);
			}
			doorShow();
		}
		else
		{
			col.enabled = false;
			if (useParticle)
			{
				particlePortal.SetActive(value: false);
			}
			else
			{
				doorHide();
			}
		}
	}

	public void CheckDetect(bool isDetect)
	{
		if (isDetect)
		{
			particlePortal.SetActive(value: true);
		}
		else
		{
			particlePortal.SetActive(value: false);
		}
	}

	public void stageMove()
	{
		if (Singleton<Main>.Instance.scene == SceneState.STAGE)
		{
			staticLoading.Stage = "Lobby_KR_sea";
			SceneManager.LoadScene("Loading");
		}
		else if (Singleton<Main>.Instance.scene == SceneState.LOBBY)
		{
			staticLoading.Stage = "Stage_OceanBreeze";
			SceneManager.LoadScene("Loading");
		}
	}

	public void doorShow()
	{
		if (state != portalState.show)
		{
			portalObject.transform.position = new Vector3(portalObject.transform.position.x, addHeight, portalObject.transform.position.z);
			addHeight += Time.deltaTime * speed;
			if (addHeight > heightLimit)
			{
				state = portalState.show;
			}
		}
	}

	public void doorHide()
	{
		if (state != 0)
		{
			portalObject.transform.position = new Vector3(portalObject.transform.position.x, addHeight, portalObject.transform.position.z);
			addHeight -= Time.deltaTime * speed;
			if (addHeight < 0f)
			{
				state = portalState.hide;
				portalObject.SetActive(value: false);
			}
		}
	}
}
public class RewardManager : MonoBehaviour
{
	public GameObject medalObj;

	public Texture[] medalRankTextures;

	public Transform[] medalPositions;

	public bool showGlove = true;

	public Material gloveMaterial;

	public LobbyEnvController lobbyEnvControl;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
	}

	private void Start()
	{
		StartCoroutine(waitSetting());
	}

	private IEnumerator waitSetting()
	{
		while (!dataManager.loaded)
		{
			yield return null;
		}
		Process();
	}

	public void Process()
	{
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && !PhotonNetwork.IsMasterClient)
		{
			int[] array = (int[])PhotonNetwork.CurrentRoom.CustomProperties["seasonRanks"];
			for (int i = 0; i < array.Length; i++)
			{
				if (array[i] > 10 || array[i] <= 0)
				{
					continue;
				}
				if (medalPositions != null)
				{
					Material material = UnityEngine.Object.Instantiate(medalObj, medalPositions[i].position, medalPositions[i].rotation).GetComponent<Renderer>().material;
					material.mainTexture = medalRankTextures[array[i] - 1];
					if (lobbyEnvControl.timeAddStage == 0)
					{
						material.SetColor("_Color", Color.white);
					}
					else
					{
						material.SetColor("_Color", Color.gray);
					}
				}
				for (int j = 0; j < dataManager.ItemDatabase.gloveItems.Length; j++)
				{
					if (i + 1 == dataManager.ItemDatabase.gloveItems[j].seasonRewardNumber && !dataManager.ItemDatabase.gloveItems[j].isAchieveItem && !dataManager.userData.gloves.Contains(dataManager.ItemDatabase.gloveItems[j].ID))
					{
						dataManager.userData.gloves.Add(dataManager.ItemDatabase.gloveItems[j].ID);
						dataManager.userData.gloves.Sort();
					}
				}
			}
		}
		else
		{
			for (int k = 0; k < dataManager.userData.seasonRank.Count; k++)
			{
				if (dataManager.userData.seasonRank[k] > 10 || dataManager.userData.seasonRank[k] <= 0)
				{
					continue;
				}
				if (medalPositions != null)
				{
					Material material2 = UnityEngine.Object.Instantiate(medalObj, medalPositions[k].position, medalPositions[k].rotation).GetComponent<Renderer>().material;
					material2.mainTexture = medalRankTextures[dataManager.userData.seasonRank[k] - 1];
					if (lobbyEnvControl.timeAddStage == 0)
					{
						material2.SetColor("_Color", Color.white);
					}
					else
					{
						material2.SetColor("_Color", Color.gray);
					}
				}
				for (int l = 0; l < dataManager.ItemDatabase.gloveItems.Length; l++)
				{
					if (k + 1 == dataManager.ItemDatabase.gloveItems[l].seasonRewardNumber && !dataManager.ItemDatabase.gloveItems[l].isAchieveItem && !dataManager.userData.gloves.Contains(dataManager.ItemDatabase.gloveItems[l].ID))
					{
						dataManager.userData.gloves.Add(dataManager.ItemDatabase.gloveItems[l].ID);
						dataManager.userData.gloves.Sort();
					}
				}
			}
		}
		if (showGlove)
		{
			ChangeGlove(dataManager.userData.curGlove);
		}
		else
		{
			gloveMaterial.shader = Shader.Find("Custom/invisible");
		}
	}

	public void ChangeGlove(int index)
	{
		gloveMaterial.shader = Shader.Find("Standard (Specular setup)");
		gloveMaterial.SetTexture("_MainTex", dataManager.ItemDatabase.gloveItems[index].mainTex);
		gloveMaterial.SetTexture("_BumpMap", dataManager.ItemDatabase.gloveItems[index].normalTex);
		gloveMaterial.SetTexture("_SpecGlossMap", dataManager.ItemDatabase.gloveItems[index].specularTex);
	}

	private void testMedal()
	{
		int[] array = new int[29]
		{
			1, 2, 3, 5, 1, 2, 3, 13, 123, 12,
			2, 1, 3, 5, 1, 2, 3, 56, 1, 2,
			3, 76, 87, 45, 3, 2, 1, 5, 6
		};
		for (int i = 0; i < array.Length; i++)
		{
			if (array[i] <= 10 && array[i] > 0 && medalPositions != null)
			{
				UnityEngine.Object.Instantiate(medalObj, medalPositions[i].position, medalPositions[i].rotation).GetComponent<Renderer>().material.mainTexture = medalRankTextures[array[i] - 1];
			}
		}
	}
}
public class SaltwaterAlert : MonoBehaviour
{
	private DataManager dataManager;

	private Main main;

	public GameObject area1;

	public GameObject area2;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
		if (dataManager.userData.userLv < 16)
		{
			base.gameObject.SetActive(value: false);
			area1.SetActive(value: false);
			area2.SetActive(value: false);
		}
		else if (dataManager.userData.rooms[main.nationId].items[1].purchased)
		{
			base.gameObject.SetActive(value: false);
			area1.SetActive(value: true);
			area2.SetActive(value: true);
		}
		else
		{
			base.gameObject.SetActive(value: true);
			area1.SetActive(value: false);
			area2.SetActive(value: false);
		}
	}

	public void Show(bool show)
	{
		base.gameObject.SetActive(show);
		area1.SetActive(value: true);
		area2.SetActive(value: true);
	}

	private void Update()
	{
	}
}
public class ScrollNotice : MonoBehaviour
{
	public ScrollRect MainScroll;

	public Camera uiCamera;

	public GameObject uiMarker;

	[InspectorButton("MoveTop")]
	public bool moveTop;

	[InspectorButton("MoveBottom")]
	public bool moveBottom;

	public void MoveTop()
	{
		MainScroll.verticalScrollbar.value -= 0.01f;
	}

	public void MoveBottom()
	{
		MainScroll.verticalScrollbar.value += 0.01f;
	}

	public void Update()
	{
	}
}
public class SettingManager : MonoBehaviour
{
	public GameObject popupWindow;

	public GameObject checkWindow;

	public GameObject settingHand;

	public GameObject setting72Hz;

	public GameObject graphicQualityArea;

	public GameObject cloudPanel;

	public bool isPopupWindow;

	public GameObject environmentPanel;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		HidePopupWindow();
		StartCoroutine(HideCheckWindow(0f));
	}

	private void Start()
	{
		if (main.lobbyId == 1 && environmentPanel != null)
		{
			environmentPanel.SetActive(value: false);
		}
		if (dataManager.isBeta)
		{
			cloudPanel.SetActive(value: false);
		}
	}

	private void OnEnable()
	{
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			settingHand.SetActive(value: false);
		}
		else
		{
			settingHand.SetActive(value: true);
		}
	}

	public void ShowPopupWindow(int value)
	{
		dataManager.Save();
		if (!dataManager.isBeta)
		{
			isPopupWindow = true;
			switch (value)
			{
			case 0:
				popupWindow.GetComponent<CloudPopupWindow>().SetMode(CLOUDSELECTMODE.UPLOAD);
				break;
			case 1:
				popupWindow.GetComponent<CloudPopupWindow>().SetMode(CLOUDSELECTMODE.DOWNLOAD);
				break;
			case 2:
				popupWindow.GetComponent<CloudPopupWindow>().SetMode(CLOUDSELECTMODE.RESET);
				break;
			}
			popupWindow.SetActive(value: true);
		}
	}

	public void HidePopupWindow()
	{
		isPopupWindow = false;
		popupWindow.SetActive(value: false);
	}

	public void ShowCheckWindow(int value)
	{
		if (value == 0)
		{
			checkWindow.GetComponent<CloudCheckWindow>().SetMode(CLOUDCHECKMODE.SAVE);
		}
		else if (value == 1)
		{
			checkWindow.GetComponent<CloudCheckWindow>().SetMode(CLOUDCHECKMODE.LOAD);
		}
		checkWindow.SetActive(value: true);
		OnlineCheck.Check(delegate(bool isConnected, NetworkReachability b)
		{
			if (isConnected)
			{
				if (value == 0)
				{
					Singleton<DBManager>.Instance.Upload(checkWindow.GetComponent<CloudCheckWindow>());
				}
				else
				{
					StartCoroutine(Singleton<DBManager>.Instance.GetUserDataID(dataManager.userData.id, delegate(object s)
					{
						if (s == null)
						{
							checkWindow.GetComponent<CloudCheckWindow>().Fail(2);
						}
						else if (Singleton<DBManager>.Instance.hasIDInUserData)
						{
							Singleton<DBManager>.Instance.StartCoroutine(Singleton<DBManager>.Instance.Download(checkWindow.GetComponent<CloudCheckWindow>()));
						}
						else
						{
							checkWindow.GetComponent<CloudCheckWindow>().Fail(2);
						}
					}));
				}
			}
			else
			{
				checkWindow.GetComponent<CloudCheckWindow>().Fail(0);
			}
		});
	}

	public IEnumerator HideCheckWindow(float delay)
	{
		yield return new WaitForSeconds(delay);
		checkWindow.SetActive(value: false);
	}

	public void ChangeLanguage(string language)
	{
		if (LocalizationManager.HasLanguage(language))
		{
			LocalizationManager.CurrentLanguage = language;
			dataManager.userData.language = (int)Enum.Parse(typeof(Languages), language);
			dataManager.Save();
			main.lobbyUIManager.InitSettingWindow();
		}
		else
		{
			MonoBehaviour.print("소스에 없는 언어입니다.");
		}
	}

	public void GoEditor()
	{
		if (Singleton<MediaController>.Instance != null)
		{
			UnityEngine.Object.Destroy(Singleton<MediaController>.Instance.gameObject);
		}
		if (dataManager != null)
		{
			UnityEngine.Object.Destroy(dataManager.gameObject);
		}
		UnityEngine.Object.Destroy(UnityEngine.Object.FindObjectOfType<CallbackRunner>().gameObject);
		SceneManager.LoadSceneAsync("SaveEditor");
	}
}
public class TackleDisplayManager : MonoBehaviour
{
	public Transform[] fishingRodPositions;

	public Transform[] fishingReelPositions;

	public Transform[] fishingLurePositions;

	public ListTackleObject tackleList;

	private DataManager datamanager;

	private int rodPosNum;

	private int reelPosNum;

	private void Awake()
	{
		datamanager = Singleton<DataManager>.Instance;
	}

	private void Start()
	{
		displayRod();
		displayReel();
	}

	private void Update()
	{
	}

	private void displayRod()
	{
		for (int i = 0; i < datamanager.userData.rodS.Count; i++)
		{
			tackleList.CreateRod(isSpinning: true, datamanager.userData.rodS[i], fishingRodPositions[rodPosNum]);
			rodPosNum++;
		}
		for (int j = 0; j < datamanager.userData.rodC.Count; j++)
		{
			tackleList.CreateRod(isSpinning: false, datamanager.userData.rodC[j], fishingRodPositions[rodPosNum]);
			rodPosNum++;
		}
	}

	private void displayReel()
	{
		for (int i = 0; i < datamanager.userData.reelS.Count; i++)
		{
			tackleList.CreateReel(isSpinning: true, datamanager.userData.reelS[i], fishingReelPositions[reelPosNum]);
			reelPosNum++;
		}
		for (int j = 0; j < datamanager.userData.reelC.Count; j++)
		{
			tackleList.CreateReel(isSpinning: false, datamanager.userData.reelC[j], fishingReelPositions[reelPosNum]);
			reelPosNum++;
		}
	}
}
public class TrophyManager : MonoBehaviour
{
	public control_trophy[] trophys;

	public GameObject UIpanel;

	public Text uiTitle;

	public Text uiContent;

	public Text uiRemainText;

	public Text uiRemainNumber;

	public Text uiRewardText;

	public Slider uiSlider;

	private DataManager dataManager;

	public bool once;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
	}

	private void Start()
	{
		UIpanel.SetActive(value: false);
		hideAll();
	}

	public void hideAll()
	{
		for (int i = 0; i < trophys.Length; i++)
		{
			trophys[i].hide();
		}
		UIpanel.SetActive(value: false);
	}

	public void trophyShow(int id)
	{
		trophys[id].checkTrophy();
	}

	public void showInfo(int id, Vector3 position)
	{
		UIpanel.SetActive(value: true);
		UIpanel.transform.position = position;
		uiTitle.GetComponent<Localize>().SetKey(Singleton<AchievementController>.Instance.achievements[id].nameKey);
		uiContent.GetComponent<Localize>().SetKey(Singleton<AchievementController>.Instance.achievements[id].descKey);
		if (Singleton<AchievementController>.Instance.achievements[id].reward == RewardType.GOLD)
		{
			uiRewardText.GetComponent<Localize>().SetKey(Singleton<AchievementController>.Instance.achievements[id].creditsKey);
			uiRewardText.text = Singleton<AchievementController>.Instance.achievements[id].rewardGold + "  " + uiRewardText.GetComponent<Localize>().GetMainTargetsText();
		}
		else
		{
			uiRewardText.GetComponent<Localize>().SetKey(Singleton<AchievementController>.Instance.achievements[id].decoNameKey);
		}
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && !PhotonNetwork.IsMasterClient)
		{
			int[] array = (int[])PhotonNetwork.CurrentRoom.CustomProperties["achievements"];
			int[] array2 = (int[])PhotonNetwork.CurrentRoom.CustomProperties["grades"];
			if (array2[id] != 5)
			{
				uiRemainText.GetComponent<Localize>().SetKey("AchievementDescription/0019");
				uiRemainNumber.text = array[id] + " / " + Singleton<AchievementController>.Instance.achievements[id].targetNumber[array2[id]];
			}
			else
			{
				uiRemainText.GetComponent<Localize>().SetKey("AchievementDescription/0020");
				uiRemainNumber.text = array[id].ToString();
			}
			uiSlider.value = array2[id];
		}
		else
		{
			if (dataManager.userData.achievements[dataManager.currentNation].grade[id] != 5)
			{
				uiRemainText.GetComponent<Localize>().SetKey("AchievementDescription/0019");
				uiRemainNumber.text = dataManager.userData.achievements[dataManager.currentNation].achievement[id] + " / " + Singleton<AchievementController>.Instance.achievements[id].targetNumber[dataManager.userData.achievements[dataManager.currentNation].grade[id]];
			}
			else
			{
				uiRemainText.GetComponent<Localize>().SetKey("AchievementDescription/0020");
				uiRemainNumber.text = dataManager.userData.achievements[dataManager.currentNation].achievement[id].ToString();
			}
			uiSlider.value = dataManager.userData.achievements[dataManager.currentNation].grade[id];
		}
	}
}
public class TutorialManager : MonoBehaviour
{
	public StageItem tutorialStageItem;

	public bool useTutorial;

	public LobbyUIManager uiManager;

	public Text tutorialText;

	private Localize localize;

	private int nextpage;

	public GameObject blockRay;

	public GameObject tutorialContent;

	public Color blinkColor = new Color(1f, 1f, 1f, 1f);

	public float blinkSpeed = 1f;

	public float waitBlinkTime = 2f;

	public GameObject tutorialStageButton;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		localize = tutorialText.GetComponent<Localize>();
	}

	private void OnEnable()
	{
		blockRay.SetActive(value: true);
		tutorialContent.SetActive(value: true);
		nextpage = 0;
		tutorialStageButton.SetActive(value: true);
	}

	private void OnDisable()
	{
	}

	public void tutorialSkip()
	{
		useTutorial = false;
		uiManager.isPlayTutorial = false;
		uiManager.stopBlink();
		uiManager.SelectMenu(0);
		tutorialStageButton.SetActive(value: false);
		Singleton<DataManager>.Instance.userData.ignoreTutorial = true;
	}

	public int getNextpage(int menu)
	{
		switch (menu)
		{
		case 0:
			if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
			{
				localize.SetKey("LodgeTutorialQuest/0010");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.GO)
			{
				localize.SetKey("LodgeTutorialQuest/0010");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
			{
				localize.SetKey("LodgeTutorialQuest/0010");
			}
			nextpage = -1;
			break;
		case 1:
			if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
			{
				localize.SetKey("LodgeTutorialQuest/0003");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.GO)
			{
				localize.SetKey("LodgeTutorialQuest/0003");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
			{
				localize.SetKey("LodgeTutorialQuest/0003");
			}
			nextpage = 2;
			break;
		case 2:
			if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
			{
				localize.SetKey("LodgeTutorialQuest/0004");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.GO)
			{
				localize.SetKey("LodgeTutorialQuest/0004");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
			{
				localize.SetKey("LodgeTutorialQuest/0004");
			}
			nextpage = 3;
			break;
		case 3:
			if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
			{
				localize.SetKey("LodgeTutorialQuest/0005");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.GO)
			{
				localize.SetKey("LodgeTutorialQuest/0005");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
			{
				localize.SetKey("LodgeTutorialQuest/0005");
			}
			nextpage = 4;
			break;
		case 4:
			if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
			{
				localize.SetKey("LodgeTutorialQuest/0006");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.GO)
			{
				localize.SetKey("LodgeTutorialQuest/0006");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
			{
				localize.SetKey("LodgeTutorialQuest/0006");
			}
			nextpage = 5;
			break;
		case 5:
			if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
			{
				localize.SetKey("LodgeTutorialQuest/0008");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.GO)
			{
				localize.SetKey("LodgeTutorialQuest/0008");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
			{
				localize.SetKey("LodgeTutorialQuest/0008");
			}
			nextpage = 6;
			break;
		case 6:
			if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
			{
				localize.SetKey("LodgeTutorialQuest/0009");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.GO)
			{
				localize.SetKey("LodgeTutorialQuest/0009");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
			{
				localize.SetKey("LodgeTutorialQuest/0009");
			}
			nextpage = 0;
			break;
		case 7:
			if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
			{
				localize.SetKey("LodgeTutorialQuest/0002");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.GO)
			{
				localize.SetKey("LodgeTutorialQuest/0002");
			}
			else if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
			{
				localize.SetKey("LodgeTutorialQuest/0002");
			}
			break;
		}
		return nextpage;
	}

	public void closeBlock()
	{
		blockRay.SetActive(value: false);
	}

	public void HideTutorialContent()
	{
		tutorialContent.SetActive(value: false);
	}
}
public class TutorialManagerLegacy : MonoBehaviour
{
	public List<TutorialItem> tutorials;

	public Image tutorialImage;

	public Text tutorialText;

	public GameObject buttonNext;

	public GameObject buttonPrevious;

	private int page;

	private int oldPage;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
	}

	private void OnEnable()
	{
		page = 0;
		updatePage(page);
		buttonNext.SetActive(value: true);
		buttonPrevious.SetActive(value: false);
	}

	private void OnDisable()
	{
		if (tutorialImage.sprite != null)
		{
			UnLoadTexture(tutorialImage.sprite);
		}
	}

	public void next()
	{
		if (page < tutorials.Count - 1)
		{
			page++;
		}
		UnLoadTexture(tutorialImage.sprite);
		updatePage(page);
	}

	public void previous()
	{
		if (page > 0)
		{
			page--;
		}
		UnLoadTexture(tutorialImage.sprite);
		updatePage(page);
	}

	public void UnLoadTexture(Sprite texture)
	{
		Resources.UnloadAsset(texture);
		tutorialImage.sprite = null;
	}

	public void updatePage(int pageNum)
	{
		if (page == 0)
		{
			buttonPrevious.SetActive(value: false);
		}
		else if (page == tutorials.Count - 1)
		{
			buttonNext.SetActive(value: false);
		}
		else
		{
			buttonPrevious.SetActive(value: true);
			buttonNext.SetActive(value: true);
		}
		tutorialImage.sprite = Resources.Load<Sprite>("Tutorials/Textures/" + tutorials[pageNum].imageFolderFileName);
		if (dataManager.targetPlatform == DEVICE_TYPE.GO)
		{
			tutorialText.text = tutorials[pageNum].tutorialGoLanguages[0];
		}
		else if (dataManager.targetPlatform == DEVICE_TYPE.QUEST)
		{
			tutorialText.text = tutorials[pageNum].tutorialQuestLanguages[0];
		}
		else if (dataManager.targetPlatform == DEVICE_TYPE.RIFT)
		{
			tutorialText.text = tutorials[pageNum].tutorialRiftLanguages[0];
		}
	}
}
public class Lobby_button_changeColor : MonoBehaviour
{
	public bool alwaysOn;

	private Button button;

	public int unlockUserLevel;

	private Color enableColor;

	private Color unableColor;

	private Image image;

	private Main main;

	private void Awake()
	{
		main = Singleton<Main>.Instance;
		image = GetComponent<Image>();
		enableColor = main.lobbyUIManager.selectedColor;
		unableColor = main.lobbyUIManager.unSelectedColor;
		button = GetComponent<Button>();
	}

	private void OnEnable()
	{
		if (main.lobbyUIManager.isPlayTutorial)
		{
			if (alwaysOn)
			{
				image.color = main.lobbyUIManager.tutorialManager.blinkColor;
				button.enabled = true;
			}
			else
			{
				image.color = unableColor;
				button.enabled = false;
			}
		}
		else
		{
			button.enabled = true;
			if (unlockUserLevel <= Singleton<DataManager>.Instance.userData.userLv)
			{
				image.color = enableColor;
			}
			else
			{
				image.color = unableColor;
			}
		}
	}
}
public enum Lagnuages
{
	English,
	French,
	Spanish,
	German,
	Korean,
	Japanese
}
public class test : MonoBehaviour
{
	private void Awake()
	{
	}

	public void SetLanguage(string text)
	{
		LocalizationManager.CurrentLanguage = text;
	}

	public void ChangeScene()
	{
		SceneManager.LoadSceneAsync(1);
	}

	private void Update()
	{
	}
}
public class test2 : MonoBehaviour
{
	private void Start()
	{
	}

	private void Update()
	{
	}
}
public class TestLocalization : MonoBehaviour
{
	public Localize localize;

	public int cnt = 1;

	public void SetKey()
	{
		localize.SetKey("LodgeTVMapStages/00" + cnt.ToString("00"));
		cnt++;
	}

	private void Start()
	{
	}

	private void Update()
	{
	}
}
public class logo : MonoBehaviour
{
	public float cor;

	private void Start()
	{
		Cursor.visible = false;
		Invoke("loadMain", 3.5f);
	}

	private void Update()
	{
		GetComponent<Renderer>().material.SetColor("_TintColor", new Color(cor, cor, cor));
		if (Input.GetKeyDown(KeyCode.Escape))
		{
			UnityEngine.Application.Quit();
		}
	}

	private void loadMain()
	{
		UnityEngine.Application.LoadLevel(1);
	}
}
public class lookAt : MonoBehaviour
{
	public GameObject targetObj;

	private Transform target;

	private void Start()
	{
		target = targetObj.transform;
	}

	private void Update()
	{
		Vector3 vector = base.transform.position - new Vector3(target.position.x, base.transform.position.y, target.position.z);
		if (vector != Vector3.zero)
		{
			base.transform.rotation = Quaternion.LookRotation(vector, Vector3.up);
		}
	}
}
public class lureLookFish : MonoBehaviour
{
	public Transform target;

	private void Start()
	{
	}

	private void Update()
	{
		if (target != null)
		{
			base.transform.rotation = target.rotation;
		}
		else
		{
			base.transform.localRotation = Quaternion.Euler(90f, 0f, 0f);
		}
	}
}
public class lurePhysic : MonoBehaviour
{
	public Transform lurePivot;

	private Rigidbody rb;

	private void Start()
	{
		rb = GetComponent<Rigidbody>();
	}

	private void LateUpdate()
	{
		rb.position = lurePivot.position;
	}
}
public class AnalyticsManager : Singleton<AnalyticsManager>
{
	private void Awake()
	{
		UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
	}

	public AnalyticsResult SendEvent(string eventName, Dictionary<string, object> parameters = null)
	{
		if (parameters != null)
		{
			return Analytics.CustomEvent(eventName, parameters);
		}
		return Analytics.CustomEvent(eventName);
	}

	public void SendTimeCompletingLevel(int level, int time)
	{
	}

	public void SendCreditCollected(int level, int money)
	{
	}

	public void SendAllCreditSpent()
	{
	}

	public void SendCreditSpentOnEquipment()
	{
	}

	public void SendPlayCountPerStage(int stage)
	{
	}

	public void SendAchievementGrade(int id)
	{
	}
}
public enum SceneState
{
	NONE,
	LOBBY,
	STAGE,
	ROOM
}
public class Main : Singleton<Main>
{
	public SceneState scene;

	public int nationId;

	public int lobbyId;

	[HideInInspector]
	public bool isMenuOn;

	[Header("Common ----------------------------------")]
	public SettingController settingController;

	public CamFadeControl fadeCamera;

	public Transform cameraTransform;

	public Transform rightHandTransform;

	public Transform leftHandTransform;

	public VRInputModule vrInputModule;

	public PortalControl portalControl;

	public ScreenShotManager captureControl;

	[Header("Lobby ----------------------------------")]
	public LobbyUIManager lobbyUIManager;

	public RewardManager rewardManager;

	public AquariumFishManager aquaFishManager;

	public AquariumManager aquariumManager;

	public FurnitureManager furnitureManager;

	public LeaderBoardManager leaderboardManager;

	public LobbyEnvController lobbyEnvController;

	public VRPlayerController vrPlayerController;

	public VRLobbyPointer vrLobbyPointerL;

	public VRLobbyPointer vrLobbyPointerR;

	public StartTutorialController startTutoController;

	public AquariumController aquariumController;

	public FurnitureController furnitureController;

	public control_lobbyHand lobbyLefthandController;

	public control_lobbyHand lobbyRighthandController;

	public SaltwaterAlert saltWaterAlert;

	public MultiplayUIManager multiplayUIManager;

	[Header("Stages ----------------------------------")]
	public bool useTutorial;

	public bool enableFishing = true;

	public bool isOceanBreezeStage;

	public control_Fishing fishingControl;

	public control_Lure lureControl;

	public control_fish fishControl;

	public control_gpoint gpointControl;

	public control_tackle tackleControl;

	public control_sound soundControl;

	public control_particle particleControl;

	public control_score scoreControl;

	public control_bait baitControl;

	public control_handselect handControl;

	public control_tutorial tutoControl;

	public control_fishFinder finderControl;

	public control_envrionment envControl;

	public Control_stuff stuffControl;

	public VRFishingPlayerController vrFishingPlayerController;

	public VRFishingPointer vrFishingPointerL;

	public VRFishingPointer vrFishingPointerR;

	[Header("PrivateRoom")]
	public CustomizingAvatarController customizingAvatarController;

	private void OnDestroy()
	{
		UnityEngine.Object.Destroy(this);
	}

	public Transform getMainhandTransform()
	{
		if (Singleton<DataManager>.Instance.userData.rightHand)
		{
			return rightHandTransform;
		}
		return leftHandTransform;
	}

	public Transform getLeftHandTransform()
	{
		return leftHandTransform;
	}

	public Transform getRightHandTransform()
	{
		return rightHandTransform;
	}
}
public class NotificationManager : Singleton<NotificationManager>
{
	public List<Canvas> canvases;

	public float y_distance = -0.5f;

	public float z_distance = 0.6f;

	public UnityEvent receiveMessage;

	public List<string> messages = new List<string>();

	private void Awake()
	{
		if (Singleton<NotificationManager>.Instance != null && Singleton<NotificationManager>.Instance != this)
		{
			UnityEngine.Object.Destroy(base.gameObject);
			return;
		}
		UnityEngine.Object.DontDestroyOnLoad(this);
		InitCanvases();
	}

	public void ShowUserJoined(Player player)
	{
		foreach (Canvas canvase in canvases)
		{
			if (canvase.gameObject.activeSelf)
			{
				canvase.gameObject.SetActive(value: false);
				continue;
			}
			canvase.transform.position = Camera.main.transform.TransformPoint(new Vector3(0f, y_distance, z_distance));
			canvase.transform.rotation = Quaternion.Euler(0f, Camera.main.transform.eulerAngles.y, 0f);
			string nickName = player.NickName;
			NotificationController component = canvase.GetComponent<NotificationController>();
			component.title.text = $"<color=orange>{nickName}</color> has joined the room";
			component.Content.text = "";
			canvase.gameObject.SetActive(value: true);
			StartCoroutine(HideCanvas(canvase.gameObject, 5f));
			messages.Add(component.title.text);
			receiveMessage.Invoke();
			break;
		}
	}

	public void ShowUserLeft(Player player)
	{
		foreach (Canvas canvase in canvases)
		{
			if (canvase.gameObject.activeSelf)
			{
				canvase.gameObject.SetActive(value: false);
				continue;
			}
			canvase.transform.position = Camera.main.transform.TransformPoint(new Vector3(0f, y_distance, z_distance));
			canvase.transform.rotation = Quaternion.Euler(0f, Camera.main.transform.eulerAngles.y, 0f);
			string nickName = player.NickName;
			NotificationController component = canvase.GetComponent<NotificationController>();
			component.title.text = $"<color=orange>{nickName}</color> has left the room";
			component.Content.text = "";
			canvase.gameObject.SetActive(value: true);
			StartCoroutine(HideCanvas(canvase.gameObject, 5f));
			messages.Add(component.title.text);
			receiveMessage.Invoke();
			break;
		}
	}

	public void ShowDisconnect()
	{
		foreach (Canvas canvase in canvases)
		{
			if (canvase.gameObject.activeSelf)
			{
				canvase.gameObject.SetActive(value: false);
				continue;
			}
			canvase.transform.position = Camera.main.transform.TransformPoint(new Vector3(0f, y_distance, z_distance));
			canvase.transform.rotation = Quaternion.Euler(0f, Camera.main.transform.eulerAngles.y, 0f);
			NotificationController component = canvase.GetComponent<NotificationController>();
			component.title.text = $"MULTIPLAY DISCONNECTED !";
			component.Content.text = "";
			canvase.gameObject.SetActive(value: true);
			StartCoroutine(HideCanvas(canvase.gameObject, 5f));
			break;
		}
	}

	public void ShowNotification(PhotonView avatarPv, int fishID, float fishLength, float fishWeight)
	{
		foreach (Canvas canvase in canvases)
		{
			if (canvase.gameObject.activeSelf)
			{
				canvase.gameObject.SetActive(value: false);
				continue;
			}
			canvase.transform.position = Camera.main.transform.TransformPoint(new Vector3(0f, y_distance, z_distance));
			canvase.transform.rotation = Quaternion.Euler(0f, Camera.main.transform.eulerAngles.y, 0f);
			string nickName = avatarPv.Owner.NickName;
			string itemName = Singleton<DataManager>.Instance.ItemDatabase.dlcs[Singleton<DataManager>.Instance.userData.curNation].fishItems[fishID].ItemName;
			NotificationController component = canvase.GetComponent<NotificationController>();
			component.title.text = $"<color=orange>{nickName}</color> just caught" + "\n" + itemName;
			string arg = "cm";
			float num;
			if (Singleton<DataManager>.Instance.userData.unit == 0)
			{
				num = Singleton<DataManager>.Instance.changeUnitLength(fishLength);
				arg = "in";
			}
			else
			{
				num = fishLength;
			}
			component.Content.text = string.Format("{0} {1}", num.ToString("N3"), arg);
			canvase.gameObject.SetActive(value: true);
			StartCoroutine(HideCanvas(canvase.gameObject, 5f));
			string text = $"<color=orange>{nickName}</color> just caught {itemName}";
			messages.Add(text + " " + component.Content.text);
			receiveMessage.Invoke();
			break;
		}
	}

	private void InitCanvases()
	{
		foreach (Canvas canvase in canvases)
		{
			canvase.gameObject.SetActive(value: false);
		}
	}

	private IEnumerator HideCanvas(GameObject go, float time)
	{
		yield return new WaitForSeconds(time);
		go.SetActive(value: false);
	}

	public void SaveMyFishInfo(int fishID, float fishLength, float fishWeight)
	{
		string itemName = Singleton<DataManager>.Instance.ItemDatabase.dlcs[Singleton<DataManager>.Instance.userData.curNation].fishItems[fishID].ItemName;
		string text = $"<color=white>{Singleton<DataManager>.Instance.userData.nickName}</color> just caught {itemName}";
		string arg = "cm";
		float num;
		if (Singleton<DataManager>.Instance.userData.unit == 0)
		{
			num = Singleton<DataManager>.Instance.changeUnitLength(fishLength);
			arg = "in";
		}
		else
		{
			num = fishLength;
		}
		string text2 = string.Format("{0} {1}", num.ToString("N3"), arg);
		messages.Add(text + " " + text2);
		receiveMessage.Invoke();
	}

	public void ShowKickOut()
	{
		foreach (Canvas canvase in canvases)
		{
			if (canvase.gameObject.activeSelf)
			{
				canvase.gameObject.SetActive(value: false);
				continue;
			}
			canvase.transform.position = Camera.main.transform.TransformPoint(new Vector3(0f, y_distance, z_distance));
			canvase.transform.rotation = Quaternion.Euler(0f, Camera.main.transform.eulerAngles.y, 0f);
			NotificationController component = canvase.GetComponent<NotificationController>();
			component.title.text = $"YOU HAVE BEEN KICKED BY THE HOST";
			component.Content.text = "";
			canvase.gameObject.SetActive(value: true);
			StartCoroutine(HideCanvas(canvase.gameObject, 5f));
			break;
		}
	}
}
public enum AvatarCategory
{
	RemoteAvatar,
	MyAvatar,
	DummyAvatar
}
public class AvatarController : MonoBehaviour
{
	public AvatarCategory avatarCategory;

	public GameObject lootAtEyeLRoot;

	public GameObject lootAtEyeRRoot;

	public ColorSetDatabase colorSet;

	public GameObject faceRoot;

	public GameObject hairRoot;

	public GameObject mustacheRoot;

	public GameObject eyebrowRoot;

	public GameObject clothRoot;

	public GameObject hatRoot;

	public GameObject glassesRoot;

	public GameObject watchRoot;

	public Dictionary<int, GameObject> facePool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> hairPool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> mustachePool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> eyebrowPool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> innerfitPool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> outerfitPool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> hatPool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> glassesPool = new Dictionary<int, GameObject>();

	public Dictionary<int, GameObject> watchPool = new Dictionary<int, GameObject>();

	private DataManager dataManager;

	private ItemDatabase itemDatabase;

	private Main main;

	private RemoteAvatar remoteAvatar;

	private MyAvatar dummyAvatar;

	private AvatarFlipCopyMirrorDummy avatarFlipDummy;

	public int curGender = -1;

	public int curFace = -1;

	public int curFaceColor = -1;

	public int curAge = -1;

	public int curEyeColor = -1;

	public int curHairShape = -1;

	public int curHairColor = -1;

	public int curEyebrowShape = -1;

	public int curEyebrowColor = -1;

	public int curMustacheShape = -1;

	public int curMustacheColor = -1;

	public int curInnerfit = -1;

	public int curInnerfitColor = -1;

	public int curOuterfit = -1;

	public int curOuterfitColor = -1;

	public int curHat = -1;

	public int curGlasses = -1;

	public int curGloves = -1;

	public Material gloveMaterial;

	public Renderer gloveR;

	public Renderer gloveL;

	public GameObject smartphoneHead;

	public void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		itemDatabase = dataManager.ItemDatabase;
		if (base.transform.parent.GetComponent<RemoteAvatar>() != null)
		{
			remoteAvatar = base.transform.parent.GetComponent<RemoteAvatar>();
		}
		if (base.transform.parent.GetComponent<MyAvatar>() != null)
		{
			dummyAvatar = base.transform.parent.GetComponent<MyAvatar>();
			avatarFlipDummy = base.transform.parent.GetComponent<AvatarFlipCopyMirrorDummy>();
		}
	}

	private void Start()
	{
	}

	private void Update()
	{
	}

	private void OnDestroy()
	{
	}

	public void ClearPool()
	{
		if (base.transform.parent.GetComponent<MyAvatar>() != null)
		{
			hairRoot.transform.SetParent(dummyAvatar.transform);
			mustacheRoot.transform.SetParent(dummyAvatar.transform);
			eyebrowRoot.transform.SetParent(dummyAvatar.transform);
			clothRoot.transform.SetParent(dummyAvatar.transform);
			hatRoot.transform.SetParent(dummyAvatar.transform);
			glassesRoot.transform.SetParent(dummyAvatar.transform);
			watchRoot.transform.SetParent(dummyAvatar.transform);
			lootAtEyeLRoot.transform.SetParent(dummyAvatar.transform);
			lootAtEyeRRoot.transform.SetParent(dummyAvatar.transform);
		}
		foreach (KeyValuePair<int, GameObject> item in facePool)
		{
			UnityEngine.Object.Destroy(item.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item2 in hairPool)
		{
			UnityEngine.Object.Destroy(item2.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item3 in eyebrowPool)
		{
			UnityEngine.Object.Destroy(item3.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item4 in mustachePool)
		{
			UnityEngine.Object.Destroy(item4.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item5 in hatPool)
		{
			UnityEngine.Object.Destroy(item5.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item6 in glassesPool)
		{
			UnityEngine.Object.Destroy(item6.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item7 in watchPool)
		{
			UnityEngine.Object.Destroy(item7.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item8 in innerfitPool)
		{
			UnityEngine.Object.Destroy(item8.Value.gameObject);
		}
		foreach (KeyValuePair<int, GameObject> item9 in outerfitPool)
		{
			UnityEngine.Object.Destroy(item9.Value.gameObject);
		}
		facePool.Clear();
		hairPool.Clear();
		eyebrowPool.Clear();
		mustachePool.Clear();
		innerfitPool.Clear();
		outerfitPool.Clear();
		hatPool.Clear();
		glassesPool.Clear();
		watchPool.Clear();
	}

	public void InitMyAavatar(int gender)
	{
		curGender = gender;
		AvatarData avatarData = dataManager.userData.avatars[curGender];
		curFace = avatarData.curFaceShape;
		curFaceColor = avatarData.curFaceColor;
		curAge = avatarData.curAge;
		curEyeColor = avatarData.curEyeColor;
		curHairShape = avatarData.curHairShape;
		curHairColor = avatarData.curHairColor;
		curEyebrowShape = avatarData.curEyebrowShape;
		curEyebrowColor = avatarData.curEyebrowColor;
		curMustacheShape = avatarData.curMustacheShape;
		curMustacheColor = avatarData.curMustacheColor;
		curInnerfit = avatarData.curInnerfit;
		curInnerfitColor = avatarData.curInnerfitColor;
		curOuterfit = avatarData.curOuterfit;
		curOuterfitColor = avatarData.curOuterfitColor;
		curHat = avatarData.curHat;
		curGlasses = avatarData.curGlasses;
		curGloves = dataManager.userData.curGlove;
		GameObject gameObject = null;
		GameObject original = null;
		GameObject original2 = null;
		GameObject original3 = null;
		GameObject original4 = null;
		GameObject original5 = null;
		GameObject original6 = null;
		GameObject original7 = null;
		GameObject original8 = null;
		if (curFace != -1)
		{
			gameObject = itemDatabase.avatars[gender].faceItems[curFace].prefab;
			original = itemDatabase.avatars[gender].faceItems[curFace].eyePrefab;
		}
		if (gameObject != null)
		{
			if (curHairShape != -1)
			{
				original2 = itemDatabase.avatars[gender].hairItems[curHairShape].prefab;
			}
			if (curEyebrowShape != -1)
			{
				original3 = itemDatabase.avatars[gender].eyebrowItems[curEyebrowShape].prefab;
			}
			if (curGender == 0 && curMustacheShape != -1)
			{
				original4 = itemDatabase.avatars[gender].mustacheItems[curMustacheShape].prefab;
			}
			if (curInnerfit != -1)
			{
				original5 = itemDatabase.avatars[gender].innerfitItems[curInnerfit].prefab;
			}
			if (curOuterfit != -1)
			{
				original6 = itemDatabase.avatars[gender].outfitItems[curOuterfit].prefab;
			}
			if (curHat != -1)
			{
				original7 = itemDatabase.avatars[gender].hatItems[curHat].prefab;
			}
			if (curGlasses != -1)
			{
				original8 = itemDatabase.avatars[gender].glassesItems[curGlasses].prefab;
			}
			if (curGloves != -1)
			{
				faceRoot = UnityEngine.Object.Instantiate(gameObject, base.transform);
			}
			faceRoot.GetComponent<AvatarRigCTRL>().eyeRootsLeftRight[0] = lootAtEyeLRoot.transform;
			faceRoot.GetComponent<AvatarRigCTRL>().eyeRootsLeftRight[1] = lootAtEyeRRoot.transform;
			faceRoot.GetComponent<AvatarRigCTRL>().dir = new Vector3(0f, 0f, 1f);
			FaceController component = faceRoot.GetComponent<FaceController>();
			SkinnedMeshRenderer skinnedMeshRenderer = component.skinnedMeshRenderer;
			facePool.Add(curFace, faceRoot);
			if (skinnedMeshRenderer != null && curFaceColor != -1)
			{
				skinnedMeshRenderer.material.color = colorSet.faceColorSet[curFaceColor];
			}
			if (skinnedMeshRenderer != null)
			{
				skinnedMeshRenderer.material.SetTexture("_MainTex", dataManager.ItemDatabase.avatars[curGender].faceItems[curFace].ageTexture.diffuseMap[curAge]);
				skinnedMeshRenderer.material.SetTexture("_Bumpmap", dataManager.ItemDatabase.avatars[curGender].faceItems[curFace].ageTexture.normalMap[curAge]);
			}
			if (lootAtEyeLRoot.GetComponentInChildren<AvatarEye>() == null)
			{
				GameObject obj = UnityEngine.Object.Instantiate(original, lootAtEyeLRoot.transform);
				lootAtEyeLRoot.transform.SetParent(faceRoot.transform);
				obj.transform.localPosition = Vector3.zero;
				UnityEngine.Object.Instantiate(original, lootAtEyeRRoot.transform).transform.localPosition = Vector3.zero;
				lootAtEyeRRoot.transform.SetParent(faceRoot.transform);
				Renderer component2 = lootAtEyeLRoot.GetComponentInChildren<AvatarEye>().innerEye.GetComponent<Renderer>();
				if (component2 != null)
				{
					component2.material.color = colorSet.eyeColorSet[curEyeColor];
				}
				Renderer component3 = lootAtEyeRRoot.GetComponentInChildren<AvatarEye>().innerEye.GetComponent<Renderer>();
				if (component3 != null)
				{
					component3.material.color = colorSet.eyeColorSet[curEyeColor];
				}
			}
			GameObject gameObject2 = UnityEngine.Object.Instantiate(original2, hairRoot.transform);
			hairRoot.transform.SetParent(faceRoot.transform);
			hairPool.Add(curHairShape, gameObject2);
			Renderer component4 = gameObject2.GetComponent<Renderer>();
			if (component4 != null && curHairColor != -1)
			{
				component4.material.color = colorSet.hairColorSet[curHairColor];
			}
			GameObject gameObject3 = UnityEngine.Object.Instantiate(original3, eyebrowRoot.transform);
			eyebrowRoot.transform.SetParent(faceRoot.transform);
			eyebrowPool.Add(curEyebrowShape, gameObject3);
			Renderer component5 = gameObject3.GetComponent<Renderer>();
			if (component5 != null && curEyebrowColor != -1)
			{
				component5.material.color = colorSet.eyebrowColorSet[curEyebrowColor];
			}
			GameObject gameObject4 = null;
			if (curGender == 0)
			{
				gameObject4 = UnityEngine.Object.Instantiate(original4, mustacheRoot.transform);
				mustacheRoot.transform.SetParent(faceRoot.transform);
				mustachePool.Add(curMustacheShape, gameObject4);
				Renderer component6 = gameObject4.GetComponent<Renderer>();
				if (component6 != null)
				{
					component6.material.color = colorSet.mustacheColorSet[curMustacheColor];
				}
			}
			clothRoot.transform.SetParent(component.neckBase.transform);
			GameObject gameObject5 = UnityEngine.Object.Instantiate(original5, clothRoot.transform);
			gameObject5.transform.localPosition = Vector3.zero;
			gameObject5.transform.localEulerAngles = Vector3.zero;
			gameObject5.transform.localScale = Vector3.one;
			Renderer component7 = gameObject5.GetComponent<Renderer>();
			if (component7 != null)
			{
				component7.material.color = colorSet.innerFitColorSet[curInnerfitColor];
			}
			innerfitPool.Add(curInnerfit, gameObject5);
			GameObject gameObject6 = UnityEngine.Object.Instantiate(original6, Vector3.zero, Quaternion.identity, clothRoot.transform);
			gameObject6.transform.localPosition = Vector3.zero;
			gameObject6.transform.localEulerAngles = Vector3.zero;
			gameObject6.transform.localScale = Vector3.one;
			outerfitPool.Add(curOuterfit, gameObject6);
			clothRoot.transform.localPosition = new Vector3(0f, 0.07075249f, 0.07075249f);
			clothRoot.transform.localEulerAngles = Vector3.zero;
			Renderer component8 = gameObject6.GetComponent<Renderer>();
			if (component8 != null)
			{
				component8.material.color = colorSet.outerFitColorSet[curOuterfitColor];
			}
			if (curHat != -1)
			{
				GameObject gameObject7 = UnityEngine.Object.Instantiate(original7, hatRoot.transform);
				AvatarHat component9 = gameObject7.GetComponent<AvatarHat>();
				if (component9 != null)
				{
					if (curHairShape == 0)
					{
						component9.ShowHairPrefab(show: false);
					}
					else
					{
						hairPool[curHairShape].SetActive(value: false);
						component9.ShowHairPrefab(show: true);
						component9.hairPrefab.GetComponent<Renderer>().material.color = colorSet.hairColorSet[curHairColor];
					}
				}
				hatRoot.transform.SetParent(faceRoot.transform);
				hatPool.Add(curHat, gameObject7);
			}
			if (curGlasses != -1)
			{
				GameObject value = UnityEngine.Object.Instantiate(original8, glassesRoot.transform);
				glassesRoot.transform.SetParent(faceRoot.transform);
				glassesPool.Add(curGlasses, value);
			}
		}
		if (avatarCategory == AvatarCategory.MyAvatar)
		{
			base.gameObject.layer = LayerMask.NameToLayer("MyAvatar");
			Transform[] componentsInChildren = GetComponentsInChildren<Transform>(includeInactive: true);
			for (int i = 0; i < componentsInChildren.Length; i++)
			{
				componentsInChildren[i].gameObject.layer = LayerMask.NameToLayer("MyAvatar");
			}
		}
	}

	public void InitRemoteAvatar(int gender, AvatarData avatar, int curGlove_remote)
	{
		curGender = gender;
		curFace = avatar.curFaceShape;
		curFaceColor = avatar.curFaceColor;
		curAge = avatar.curAge;
		curEyeColor = avatar.curEyeColor;
		curHairShape = avatar.curHairShape;
		curHairColor = avatar.curHairColor;
		curEyebrowShape = avatar.curEyebrowShape;
		curEyebrowColor = avatar.curEyebrowColor;
		curMustacheShape = avatar.curMustacheShape;
		curMustacheColor = avatar.curMustacheColor;
		curInnerfit = avatar.curInnerfit;
		curInnerfitColor = avatar.curInnerfitColor;
		curOuterfit = avatar.curOuterfit;
		curOuterfitColor = avatar.curOuterfitColor;
		curHat = avatar.curHat;
		curGlasses = avatar.curGlasses;
		curGloves = curGlove_remote;
		GameObject gameObject = null;
		GameObject original = null;
		GameObject original2 = null;
		GameObject original3 = null;
		GameObject original4 = null;
		GameObject original5 = null;
		GameObject original6 = null;
		GameObject original7 = null;
		GameObject original8 = null;
		if (curFace != -1)
		{
			gameObject = itemDatabase.avatars[gender].faceItems[curFace].prefab;
			original = itemDatabase.avatars[gender].faceItems[curFace].eyePrefab;
		}
		if (gameObject != null)
		{
			if (curHairShape != -1)
			{
				original2 = itemDatabase.avatars[gender].hairItems[curHairShape].prefab;
			}
			if (curEyebrowShape != -1)
			{
				original3 = itemDatabase.avatars[gender].eyebrowItems[curEyebrowShape].prefab;
			}
			if (curGender == 0 && curMustacheShape != -1)
			{
				original4 = itemDatabase.avatars[gender].mustacheItems[curMustacheShape].prefab;
			}
			if (curInnerfit != -1)
			{
				original5 = itemDatabase.avatars[gender].innerfitItems[curInnerfit].prefab;
			}
			if (curOuterfit != -1)
			{
				original6 = itemDatabase.avatars[gender].outfitItems[curOuterfit].prefab;
			}
			if (curHat != -1)
			{
				original7 = itemDatabase.avatars[gender].hatItems[curHat].prefab;
			}
			if (curGlasses != -1)
			{
				original8 = itemDatabase.avatars[gender].glassesItems[curGlasses].prefab;
			}
			GameObject gameObject2 = UnityEngine.Object.Instantiate(gameObject, base.transform);
			gameObject2.transform.localPosition = new Vector3(0f, -200f, 0f);
			faceRoot = gameObject2;
			gameObject2.transform.localPosition = Vector3.zero;
			gameObject2.GetComponent<AvatarRigCTRL>().eyeRootsLeftRight[0] = lootAtEyeLRoot.transform;
			gameObject2.GetComponent<AvatarRigCTRL>().eyeRootsLeftRight[1] = lootAtEyeRRoot.transform;
			base.transform.parent.GetComponent<RemoteAvatar>().head = gameObject2.transform;
			FaceController component = gameObject2.GetComponent<FaceController>();
			SkinnedMeshRenderer skinnedMeshRenderer = component.skinnedMeshRenderer;
			if (skinnedMeshRenderer != null && curFaceColor != -1)
			{
				skinnedMeshRenderer.material.color = colorSet.faceColorSet[curFaceColor];
			}
			if (skinnedMeshRenderer != null)
			{
				skinnedMeshRenderer.material.SetTexture("_MainTex", dataManager.ItemDatabase.avatars[curGender].faceItems[curFace].ageTexture.diffuseMap[curAge]);
				skinnedMeshRenderer.material.SetTexture("_Bumpmap", dataManager.ItemDatabase.avatars[curGender].faceItems[curFace].ageTexture.normalMap[curAge]);
			}
			base.transform.parent.GetComponent<RemoteAvatar>().skinnedMeshRenderer = skinnedMeshRenderer;
			if (lootAtEyeLRoot.GetComponentInChildren<AvatarEye>() == null)
			{
				GameObject obj = UnityEngine.Object.Instantiate(original, lootAtEyeLRoot.transform);
				lootAtEyeLRoot.transform.SetParent(gameObject2.transform);
				obj.transform.localPosition = Vector3.zero;
				UnityEngine.Object.Instantiate(original, lootAtEyeRRoot.transform).transform.localPosition = Vector3.zero;
				lootAtEyeRRoot.transform.SetParent(gameObject2.transform);
				Renderer component2 = lootAtEyeLRoot.GetComponentInChildren<AvatarEye>().innerEye.GetComponent<Renderer>();
				if (component2 != null)
				{
					component2.material.color = colorSet.eyeColorSet[curEyeColor];
				}
				Renderer component3 = lootAtEyeRRoot.GetComponentInChildren<AvatarEye>().innerEye.GetComponent<Renderer>();
				if (component3 != null)
				{
					component3.material.color = colorSet.eyeColorSet[curEyeColor];
				}
			}
			GameObject gameObject3 = UnityEngine.Object.Instantiate(original2, hairRoot.transform);
			hairRoot.transform.SetParent(gameObject2.transform);
			Renderer component4 = gameObject3.GetComponent<Renderer>();
			if (component4 != null && curHairColor != -1)
			{
				component4.material.color = colorSet.hairColorSet[curHairColor];
			}
			GameObject obj2 = UnityEngine.Object.Instantiate(original3, eyebrowRoot.transform);
			eyebrowRoot.transform.SetParent(gameObject2.transform);
			Renderer component5 = obj2.GetComponent<Renderer>();
			if (component5 != null && curEyebrowColor != -1)
			{
				component5.material.color = colorSet.eyebrowColorSet[curEyebrowColor];
			}
			if (curGender == 0)
			{
				GameObject obj3 = UnityEngine.Object.Instantiate(original4, mustacheRoot.transform);
				mustacheRoot.transform.SetParent(gameObject2.transform);
				Renderer component6 = obj3.GetComponent<Renderer>();
				if (component6 != null)
				{
					component6.material.color = colorSet.mustacheColorSet[curMustacheColor];
				}
			}
			GameObject obj4 = UnityEngine.Object.Instantiate(original5, clothRoot.transform);
			obj4.transform.localPosition = Vector3.zero;
			obj4.transform.eulerAngles = Vector3.zero;
			obj4.transform.localScale = Vector3.one;
			Renderer component7 = obj4.GetComponent<Renderer>();
			if (component7 != null && curInnerfitColor != -1)
			{
				component7.material.color = colorSet.innerFitColorSet[curInnerfitColor];
			}
			GameObject obj5 = UnityEngine.Object.Instantiate(original6, Vector3.zero, Quaternion.identity, clothRoot.transform);
			obj5.transform.localPosition = Vector3.zero;
			obj5.transform.eulerAngles = Vector3.zero;
			obj5.transform.localScale = Vector3.one;
			clothRoot.transform.SetParent(component.neckBase.transform);
			Renderer component8 = obj5.GetComponent<Renderer>();
			if (component8 != null && curOuterfitColor != -1)
			{
				component8.material.color = colorSet.outerFitColorSet[curOuterfitColor];
			}
			if (curHat != -1)
			{
				AvatarHat component9 = UnityEngine.Object.Instantiate(original7, hatRoot.transform).GetComponent<AvatarHat>();
				if (component9 != null)
				{
					if (curHairShape == 0)
					{
						component9.ShowHairPrefab(show: false);
					}
					else
					{
						gameObject3.SetActive(value: false);
						component9.ShowHairPrefab(show: true);
						component9.hairPrefab.GetComponent<Renderer>().material.color = colorSet.hairColorSet[curHairColor];
					}
				}
				hatRoot.transform.SetParent(gameObject2.transform);
			}
			if (curGlasses != -1)
			{
				UnityEngine.Object.Instantiate(original8, glassesRoot.transform);
				glassesRoot.transform.SetParent(gameObject2.transform);
			}
			if (gloveR != null)
			{
				gloveR.material.SetTexture("_MainTex", dataManager.ItemDatabase.gloveItems[curGloves].mainTex);
				gloveR.material.SetTexture("_BumpMap", dataManager.ItemDatabase.gloveItems[curGloves].normalTex);
				gloveR.material.SetTexture("_SpecGlossMap", dataManager.ItemDatabase.gloveItems[curGloves].specularTex);
			}
			if (gloveL != null)
			{
				gloveL.material.SetTexture("_MainTex", dataManager.ItemDatabase.gloveItems[curGloves].mainTex);
				gloveL.material.SetTexture("_BumpMap", dataManager.ItemDatabase.gloveItems[curGloves].normalTex);
				gloveL.material.SetTexture("_SpecGlossMap", dataManager.ItemDatabase.gloveItems[curGloves].specularTex);
			}
		}
		if (avatarCategory == AvatarCategory.RemoteAvatar)
		{
			base.gameObject.layer = LayerMask.NameToLayer("RemoteAvatar");
			Transform[] componentsInChildren = GetComponentsInChildren<Transform>(includeInactive: true);
			for (int i = 0; i < componentsInChildren.Length; i++)
			{
				componentsInChildren[i].gameObject.layer = LayerMask.NameToLayer("RemoteAvatar");
			}
		}
		if (avatarCategory == AvatarCategory.RemoteAvatar)
		{
			remoteAvatar.remoteAvatarCollider.gameObject.layer = LayerMask.NameToLayer("Physics");
			remoteAvatar.remoteAvatarCollider.transform.SetParent(faceRoot.transform);
			remoteAvatar.remoteAvatarCollider.transform.localPosition = Vector3.zero;
			remoteAvatar.remoteAvatarCollider.transform.localEulerAngles = Vector3.zero;
			remoteAvatar.userInfoPivot.transform.SetParent(faceRoot.transform);
			remoteAvatar.userInfoPivot.transform.localPosition = Vector3.zero;
			remoteAvatar.userInfoPivot.transform.localEulerAngles = Vector3.zero;
		}
		else
		{
			remoteAvatar.remoteAvatarCollider.gameObject.SetActive(value: false);
			remoteAvatar.userInfoPivot.SetActive(value: false);
		}
	}

	public void InitMyAvatar()
	{
	}

	public void ChangeItem(CustomizingCategory category, int id)
	{
		switch (category)
		{
		case CustomizingCategory.GENDER:
			ChangeGender(curGender);
			break;
		case CustomizingCategory.FACE:
			ChangeFaceShape(id);
			break;
		case CustomizingCategory.HAIR:
			ChangeHair(id);
			break;
		case CustomizingCategory.EYEBROW:
			ChangeEyebrow(id);
			break;
		case CustomizingCategory.MUSTACHE:
			ChangeMustache(id);
			break;
		case CustomizingCategory.INNERFIT:
			ChangeInnerFit(id);
			break;
		case CustomizingCategory.OUTERFIT:
			ChangeOuterFit(id);
			break;
		case CustomizingCategory.HAT:
			ChangeHat(id);
			break;
		case CustomizingCategory.GLASSES:
			ChangeGlasses(id);
			break;
		case CustomizingCategory.GLOVES:
			ChangeGlove(id);
			break;
		}
	}

	public void ChangeGender(int index)
	{
		ClearPool();
		InitMyAavatar(curGender);
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeGender(index);
	}

	public void ChangeFaceShape(int index)
	{
		curFace = index;
		hairRoot.transform.SetParent(dummyAvatar.transform);
		mustacheRoot.transform.SetParent(dummyAvatar.transform);
		eyebrowRoot.transform.SetParent(dummyAvatar.transform);
		clothRoot.transform.SetParent(dummyAvatar.transform);
		hatRoot.transform.SetParent(dummyAvatar.transform);
		glassesRoot.transform.SetParent(dummyAvatar.transform);
		watchRoot.transform.SetParent(dummyAvatar.transform);
		lootAtEyeLRoot.transform.SetParent(dummyAvatar.transform);
		lootAtEyeRRoot.transform.SetParent(dummyAvatar.transform);
		foreach (KeyValuePair<int, GameObject> item in facePool)
		{
			item.Value.SetActive(value: false);
		}
		GameObject gameObject = null;
		if (facePool.ContainsKey(index))
		{
			facePool[index].SetActive(value: true);
			gameObject = facePool[index];
		}
		else
		{
			gameObject = UnityEngine.Object.Instantiate(itemDatabase.avatars[curGender].faceItems[index].prefab, base.transform);
			facePool.Add(index, gameObject);
			gameObject.GetComponent<AvatarRigCTRL>().eyeRootsLeftRight[0] = lootAtEyeLRoot.transform;
			gameObject.GetComponent<AvatarRigCTRL>().eyeRootsLeftRight[1] = lootAtEyeRRoot.transform;
			ChangeFaceColor(curFaceColor, colorSet.faceColorSet[curFaceColor]);
		}
		ChangeLayer(gameObject);
		hairRoot.transform.SetParent(gameObject.transform);
		mustacheRoot.transform.SetParent(gameObject.transform);
		eyebrowRoot.transform.SetParent(gameObject.transform);
		clothRoot.transform.SetParent(facePool[curFace].GetComponent<FaceController>().neckBase.transform);
		clothRoot.transform.localPosition = new Vector3(0f, 0.07075249f, 0.07075249f);
		clothRoot.transform.localEulerAngles = Vector3.zero;
		hatRoot.transform.SetParent(gameObject.transform);
		glassesRoot.transform.SetParent(gameObject.transform);
		watchRoot.transform.SetParent(gameObject.transform);
		lootAtEyeLRoot.transform.SetParent(gameObject.transform);
		lootAtEyeRRoot.transform.SetParent(gameObject.transform);
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeFace(index);
	}

	public void ChangeFaceColor(int index, Color color)
	{
		curFaceColor = index;
		Renderer skinnedMeshRenderer = facePool[curFace].GetComponent<FaceController>().skinnedMeshRenderer;
		if (skinnedMeshRenderer != null)
		{
			skinnedMeshRenderer.material.color = color;
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeFaceColor(index, color);
	}

	public void ChangeHair(int index)
	{
		curHairShape = index;
		foreach (KeyValuePair<int, GameObject> item in hairPool)
		{
			item.Value.SetActive(value: false);
		}
		if (hairPool.ContainsKey(index))
		{
			hairPool[index].SetActive(value: true);
		}
		else
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(itemDatabase.avatars[curGender].hairItems[index].prefab, hairRoot.transform);
			hairPool.Add(index, gameObject);
			ChangeHairColor(curHairColor, colorSet.hairColorSet[curHairColor]);
			ChangeLayer(gameObject);
		}
		if (curHat != 0)
		{
			ChangeHat(0);
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeHair(index);
	}

	public void ChangeHairColor(int index, Color color)
	{
		curHairColor = index;
		Renderer component = hairPool[curHairShape].GetComponent<Renderer>();
		if (component != null)
		{
			component.material.color = color;
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeHairColor(index, color);
	}

	public void ChangeAge(int index)
	{
		curAge = index;
		Renderer skinnedMeshRenderer = facePool[curFace].GetComponent<FaceController>().skinnedMeshRenderer;
		if (skinnedMeshRenderer != null)
		{
			skinnedMeshRenderer.material.SetTexture("_MainTex", dataManager.ItemDatabase.avatars[curGender].faceItems[curFace].ageTexture.diffuseMap[curAge]);
			skinnedMeshRenderer.material.SetTexture("_Bumpmap", dataManager.ItemDatabase.avatars[curGender].faceItems[curFace].ageTexture.normalMap[curAge]);
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeAge(index);
	}

	public void ChangeEyebrow(int index)
	{
		curEyebrowShape = index;
		foreach (KeyValuePair<int, GameObject> item in eyebrowPool)
		{
			item.Value.SetActive(value: false);
		}
		if (eyebrowPool.ContainsKey(index))
		{
			eyebrowPool[index].SetActive(value: true);
		}
		else
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(itemDatabase.avatars[curGender].eyebrowItems[curEyebrowShape].prefab, faceRoot.transform);
			eyebrowPool.Add(index, gameObject);
			ChangeEyebrowColor(curEyebrowColor, colorSet.eyebrowColorSet[curEyebrowColor]);
			ChangeLayer(gameObject);
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeEyebrow(index);
	}

	public void ChangeEyebrowColor(int index, Color color)
	{
		curEyebrowColor = index;
		Renderer component = eyebrowPool[curEyebrowShape].GetComponent<Renderer>();
		if (component != null)
		{
			component.material.color = color;
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeEyebrowColor(index, color);
	}

	public void ChangeEyeColor(int index, Color color)
	{
		curEyeColor = index;
		Renderer component = lootAtEyeLRoot.GetComponentInChildren<AvatarEye>().innerEye.GetComponent<Renderer>();
		if (component != null)
		{
			component.material.color = color;
		}
		Renderer component2 = lootAtEyeRRoot.GetComponentInChildren<AvatarEye>().innerEye.GetComponent<Renderer>();
		if (component2 != null)
		{
			component2.material.color = color;
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeEyeColor(index, color);
	}

	public void ChangeMustache(int index)
	{
		curMustacheShape = index;
		foreach (KeyValuePair<int, GameObject> item in mustachePool)
		{
			item.Value.SetActive(value: false);
		}
		if (mustachePool.ContainsKey(index))
		{
			mustachePool[index].SetActive(value: true);
		}
		else
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(itemDatabase.avatars[curGender].mustacheItems[index].prefab, mustacheRoot.transform);
			mustachePool.Add(index, gameObject);
			ChangeMustacheColor(curMustacheColor, colorSet.mustacheColorSet[curMustacheColor]);
			ChangeLayer(gameObject);
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeMustache(index);
	}

	public void ChangeInnerFit(int index)
	{
		curInnerfit = index;
		foreach (KeyValuePair<int, GameObject> item in innerfitPool)
		{
			item.Value.SetActive(value: false);
		}
		if (innerfitPool.ContainsKey(index))
		{
			innerfitPool[index].SetActive(value: true);
		}
		else
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(itemDatabase.avatars[curGender].innerfitItems[index].prefab, clothRoot.transform);
			innerfitPool.Add(index, gameObject);
			ChangeLayer(gameObject);
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeInnerFit(index);
	}

	public void ChangeInnerfitColor(int index, Color color)
	{
		curInnerfitColor = index;
		Renderer component = innerfitPool[curInnerfit].GetComponent<Renderer>();
		if (component != null)
		{
			component.material.color = color;
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeInnerFitColor(index, color);
	}

	public void ChangeOuterFit(int index)
	{
		curOuterfit = index;
		foreach (KeyValuePair<int, GameObject> item in outerfitPool)
		{
			item.Value.SetActive(value: false);
		}
		if (outerfitPool.ContainsKey(index))
		{
			outerfitPool[index].SetActive(value: true);
		}
		else
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(itemDatabase.avatars[curGender].outfitItems[index].prefab, clothRoot.transform);
			outerfitPool.Add(index, gameObject);
			ChangeLayer(gameObject);
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeOuterFit(index);
	}

	public void ChangeOuterfitColor(int index, Color color)
	{
		curOuterfitColor = index;
		Renderer component = outerfitPool[curOuterfit].GetComponent<Renderer>();
		if (component != null)
		{
			component.material.color = color;
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeOuterFitColor(index, color);
	}

	public void ChangeMustacheColor(int index, Color color)
	{
		curMustacheColor = index;
		Renderer component = mustachePool[curMustacheShape].GetComponent<Renderer>();
		if (component != null)
		{
			component.material.color = color;
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeMustacheColor(index, color);
	}

	public void ChangeHat(int index)
	{
		curHat = index;
		foreach (KeyValuePair<int, GameObject> item in hatPool)
		{
			item.Value.SetActive(value: false);
		}
		if (hatPool.ContainsKey(index))
		{
			hatPool[index].SetActive(value: true);
		}
		else
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(itemDatabase.avatars[curGender].hatItems[index].prefab, hatRoot.transform);
			AvatarHat component = gameObject.GetComponent<AvatarHat>();
			if (component != null)
			{
				if (curHairShape == 0)
				{
					component.ShowHairPrefab(show: false);
				}
				else
				{
					hairPool[curHairShape].SetActive(value: false);
					component.ShowHairPrefab(show: true);
					component.hairPrefab.GetComponent<Renderer>().material.color = colorSet.hairColorSet[curHairColor];
				}
			}
			hatPool.Add(index, gameObject);
			ChangeLayer(gameObject);
		}
		if (index == 0)
		{
			hairPool[curHairShape].SetActive(value: true);
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeHat(index);
	}

	public void ChangeHatHairColor(int index, Color color)
	{
		curHairColor = index;
		if (curHat != 0)
		{
			Renderer component = hatPool[curHat].GetComponent<AvatarHat>().hairPrefab.GetComponent<Renderer>();
			if (component != null)
			{
				component.material.color = color;
			}
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeHatHairColor(index, color);
	}

	public void ChangeGlasses(int index)
	{
		curGlasses = index;
		foreach (KeyValuePair<int, GameObject> item in glassesPool)
		{
			item.Value.SetActive(value: false);
		}
		if (glassesPool.ContainsKey(index))
		{
			glassesPool[index].SetActive(value: true);
		}
		else
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(itemDatabase.avatars[curGender].glassesItems[index].prefab, glassesRoot.transform);
			glassesPool.Add(index, gameObject);
			ChangeLayer(gameObject);
		}
		avatarFlipDummy.avatarBody_duplicated.GetComponent<DummyAvatar>().ChangeGlasses(index);
	}

	public void ChangeGlove(int index)
	{
		curGloves = index;
		gloveMaterial.SetTexture("_MainTex", dataManager.ItemDatabase.gloveItems[index].mainTex);
		gloveMaterial.SetTexture("_BumpMap", dataManager.ItemDatabase.gloveItems[index].normalTex);
		gloveMaterial.SetTexture("_SpecGlossMap", dataManager.ItemDatabase.gloveItems[index].specularTex);
	}

	private void ChangeLayer(GameObject go)
	{
		switch (avatarCategory)
		{
		case AvatarCategory.MyAvatar:
			go.layer = LayerMask.NameToLayer("MyAvatar");
			break;
		case AvatarCategory.RemoteAvatar:
			go.layer = LayerMask.NameToLayer("RemoteAvatar");
			break;
		}
	}
}
public class ConsoleMultiplay : MonoBehaviour
{
	[Header("Console Buttons")]
	public Button button_Tackle;

	public Button button_CameraMove;

	public Button button_Setting;

	public Button button_Map;

	public Button button_Multiplay;

	[Header("Shadows")]
	public GameObject shadow_Multiplay;

	private void OnEnable()
	{
		if (PhotonNetwork.InRoom)
		{
			ShowMultiplayButton();
			if (PhotonNetwork.IsMasterClient)
			{
				button_Map.interactable = true;
			}
			else
			{
				button_Map.interactable = false;
			}
		}
		else
		{
			InitButtonInteractable();
		}
	}

	private void InitButtons()
	{
		button_Tackle.gameObject.SetActive(value: true);
		button_CameraMove.gameObject.SetActive(value: true);
		button_Setting.gameObject.SetActive(value: true);
		button_Map.gameObject.SetActive(value: true);
		button_Multiplay.gameObject.SetActive(value: true);
	}

	private void InitButtonInteractable()
	{
		button_Tackle.interactable = true;
		button_CameraMove.interactable = true;
		button_Setting.interactable = true;
		button_Map.interactable = true;
		button_Multiplay.interactable = true;
	}

	private void HideMultiplayButton()
	{
		button_Multiplay.gameObject.SetActive(value: false);
		shadow_Multiplay.SetActive(value: false);
	}

	private void ShowMultiplayButton()
	{
		button_Multiplay.gameObject.SetActive(value: true);
		shadow_Multiplay.SetActive(value: true);
	}
}
public class FaceController : MonoBehaviour
{
	public GameObject neckJointRoot;

	public SkinnedMeshRenderer skinnedMeshRenderer;

	public GameObject neckBase;
}
public class FishController : MonoBehaviour
{
	private LineRenderer lineRender;

	private GameObject lure;

	public Animator fishAni;

	public RemoteFish remoteFish;

	private void Start()
	{
		lineRender = GetComponent<LineRenderer>();
		PhotonView photonView = MultiplayManager.Instance.lureViews.Where((PhotonView s) => s.Owner == remoteFish.photonView.Owner).FirstOrDefault();
		if (photonView != null)
		{
			lure = photonView.gameObject;
		}
	}

	public void RemoveLine()
	{
		lure = null;
	}

	private void Update()
	{
		lineRender.SetPosition(0, base.transform.position);
		if (lure != null)
		{
			lineRender.SetPosition(1, lure.transform.position);
		}
		else
		{
			lineRender.SetPosition(1, base.transform.position);
		}
	}

	public void ChangeAni(FishState fishState)
	{
		switch (fishState)
		{
		case FishState.Swim:
			fishAni.Play("swim");
			UnityEngine.Debug.Log("물고기 animation swim");
			break;
		case FishState.Jump:
			fishAni.SetTrigger("jump");
			UnityEngine.Debug.Log("물고기 animation jump");
			break;
		case FishState.Struggle:
			fishAni.SetBool("struggle", value: true);
			UnityEngine.Debug.Log("물고기 animation struggle");
			break;
		case FishState.Landing:
			fishAni.SetBool("struggle", value: true);
			UnityEngine.Debug.Log("물고기 animation Landing");
			break;
		case FishState.Stay:
		case FishState.Keep:
		case FishState.Release:
		case FishState.Fail:
			break;
		}
	}
}
public class FriendElement : MonoBehaviour
{
	[HideInInspector]
	public ulong id;

	public Text nickName;

	[HideInInspector]
	public string inviteToken;

	public string roomId;

	public int currentPlayer;

	public int maxPlayer;

	[HideInInspector]
	public FriendListDisplay friendListDisplay;

	public Button button_Join;

	private void Awake()
	{
		button_Join.onClick.AddListener(JoinFriendRoom);
	}

	public void JoinFriendRoom()
	{
		button_Join.interactable = false;
		PhotonNetwork.JoinRoom(roomId);
	}

	private void OnDestroy()
	{
		button_Join.onClick.RemoveListener(JoinFriendRoom);
	}
}
public struct Friend
{
	public ulong id;

	public string nickName;

	public string inviteToken;
}
public class FriendListDisplay : MonoBehaviourPunCallbacks
{
	public GameObject friendElementPrefab;

	public GameObject content;

	private List<Friend> friends = new List<Friend>();

	public List<GameObject> onlineFriends;

	private List<GameObject> joinButons = new List<GameObject>();

	public override void OnEnable()
	{
		base.OnEnable();
		if (PhotonNetwork.IsConnectedAndReady)
		{
			GetFriends();
		}
	}

	public override void OnDisable()
	{
		base.OnDisable();
		ResetList();
	}

	public void GetFriends()
	{
		new Oculus.Platform.RoomOptions().SetExcludeRecentlyMet(value: true);
		Users.GetLoggedInUserFriends().OnComplete(delegate(Message<UserList> s)
		{
			if (!s.IsError)
			{
				if (s.GetUserList().Count > 0)
				{
					List<string> list = new List<string>();
					foreach (User datum in s.Data)
					{
						Friend item = default(Friend);
						item.id = datum.ID;
						item.nickName = datum.OculusID;
						item.inviteToken = datum.InviteToken;
						friends.Add(item);
						list.Add(datum.ID.ToString());
					}
					if (!PhotonNetwork.InRoom)
					{
						PhotonNetwork.FindFriends(list.ToArray());
					}
				}
				else
				{
					UnityEngine.Debug.Log("no logged in friends found");
				}
			}
		});
	}

	public override void OnFriendListUpdate(List<FriendInfo> friendList)
	{
		base.OnFriendListUpdate(friendList);
		ResetList();
		UnityEngine.Debug.Log("OnFriendListUpdate called by FindFriend");
		for (int i = 0; i < friendList.Count; i++)
		{
			if (friendList[i].IsOnline)
			{
				GameObject gameObject = UnityEngine.Object.Instantiate(friendElementPrefab);
				gameObject.transform.SetParent(content.transform);
				gameObject.transform.localPosition = Vector3.zero;
				gameObject.transform.localEulerAngles = Vector3.zero;
				gameObject.transform.localScale = Vector3.one;
				onlineFriends.Add(gameObject);
				FriendElement component = gameObject.GetComponent<FriendElement>();
				component.id = friends[i].id;
				component.nickName.text = friends[i].nickName;
				component.inviteToken = friends[i].inviteToken;
				if (friendList[i].IsInRoom)
				{
					component.button_Join.gameObject.SetActive(value: true);
					component.button_Join.GetComponent<Button>().interactable = true;
					component.roomId = friendList[i].Room;
				}
				else
				{
					component.button_Join.gameObject.SetActive(value: false);
				}
			}
		}
	}

	public void ResetList()
	{
		foreach (GameObject onlineFriend in onlineFriends)
		{
			UnityEngine.Object.Destroy(onlineFriend);
		}
		onlineFriends.Clear();
	}
}
public class LocalAvatar : MonoBehaviourPun, IPunObservable
{
	private Main main;

	private MultiplayManager multiplayManager;

	public bool enableWriting;

	[HideInInspector]
	public PhotonView pv;

	private Vector3 head_Direction;

	private Vector3 head_StoredPosition;

	private Vector3 leftHand_Direction;

	private Vector3 leftHand_StoredPosition;

	private Vector3 rightHand_Direction;

	private Vector3 rightHand_StoredPosition;

	private DataManager dataManager;

	private RVRFLipSyncContextMorphTarget rvrfLipSyncContextMorphTarget;

	public float[] lipSyncData;

	public bool[] fingerLSyncData = new bool[8];

	public bool[] fingerRSyncData = new bool[8];

	public Vector3 dummyValue = new Vector3(0f, -200f, 0f);

	public bool isReady;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
	}

	private void OnEnable()
	{
		SceneManager.sceneLoaded += OnSceneLoaded;
	}

	private void OnDisable()
	{
		SceneManager.sceneLoaded -= OnSceneLoaded;
	}

	private void Start()
	{
		main = Singleton<Main>.Instance;
		multiplayManager = MultiplayManager.Instance;
		rvrfLipSyncContextMorphTarget = GetComponent<RVRFLipSyncContextMorphTarget>();
	}

	private void OnSceneLoaded(Scene scene, LoadSceneMode mode)
	{
		if (scene.name != "Loading")
		{
			StartCoroutine(waitMain());
		}
	}

	private IEnumerator waitMain()
	{
		while (Singleton<Main>.Instance == null)
		{
			yield return null;
		}
		main = Singleton<Main>.Instance;
		if (main.scene == SceneState.LOBBY)
		{
			MultiplayManager.Instance.localLure.RemoveLure();
			MultiplayManager.Instance.localTackle.RemoveTackle();
			MultiplayManager.Instance.localFish.RemoveFish();
			foreach (PhotonView lureView in MultiplayManager.Instance.lureViews)
			{
				if (lureView != null)
				{
					UnityEngine.Object.Destroy(lureView.gameObject);
				}
			}
			foreach (PhotonView tackleView in MultiplayManager.Instance.tackleViews)
			{
				if (tackleView != null)
				{
					UnityEngine.Object.Destroy(tackleView.gameObject);
				}
			}
			MultiplayManager.Instance.lureViews.Clear();
			MultiplayManager.Instance.tackleViews.Clear();
			MultiplayManager.Instance.fishViews.Clear();
			head_StoredPosition = new Vector3(0f, -200f, 0f);
			leftHand_StoredPosition = main.vrPlayerController.LeftHandAnchor.transform.position;
			rightHand_StoredPosition = main.vrPlayerController.RightHandAnchor.transform.position;
			MultiplayEventManager.Instance.SendRemoveEvent(SenderEventCode.InstantiationTackle);
			MultiplayEventManager.Instance.SendRemoveEvent(SenderEventCode.InstantiationLure);
		}
		else if (main.scene == SceneState.STAGE)
		{
			if (MultiplayManager.Instance.localLure.pv == null)
			{
				MultiplayManager.Instance.localLure.SpawnLure();
			}
			if (MultiplayManager.Instance.localTackle.pv == null)
			{
				MultiplayManager.Instance.localTackle.SpawnTackle();
			}
			head_StoredPosition = new Vector3(0f, -200f, 0f);
			leftHand_StoredPosition = main.vrFishingPlayerController.LeftHandAnchor.transform.position;
			rightHand_StoredPosition = main.vrFishingPlayerController.RightHandAnchor.transform.position;
		}
	}

	public void SpawnPlayer()
	{
		pv = base.gameObject.AddComponent<PhotonView>();
		pv.ObservedComponents = new List<UnityEngine.Component>();
		pv.ObservedComponents.Add(this);
		pv.Synchronization = ViewSynchronization.UnreliableOnChange;
		enableWriting = true;
		if (PhotonNetwork.AllocateViewID(pv))
		{
			MultiplayEventManager.Instance.SendInstantiationAvatarEvent();
		}
		else
		{
			UnityEngine.Debug.LogError("Failed to allocate a ViewId.");
		}
	}

	public void RemovePlayer()
	{
		enableWriting = false;
		if (pv != null)
		{
			UnityEngine.Object.Destroy(pv);
		}
	}

	public void OnPhotonSerializeView(PhotonStream stream, PhotonMessageInfo info)
	{
		if (!enableWriting || !pv.IsMine || !stream.IsWriting || !(main != null) || !isReady)
		{
			return;
		}
		if (main.scene == SceneState.LOBBY)
		{
			head_Direction = main.vrPlayerController.centerEyeTransform.position - head_StoredPosition;
			head_StoredPosition = main.vrPlayerController.centerEyeTransform.position;
			stream.SendNext(main.vrPlayerController.centerEyeTransform.position);
			stream.SendNext(head_Direction);
			stream.SendNext(main.vrPlayerController.centerEyeTransform.rotation);
			if (dataManager.userData.bothHand)
			{
				leftHand_Direction = main.vrPlayerController.LeftHandAnchor.transform.position - leftHand_StoredPosition;
				leftHand_StoredPosition = main.vrPlayerController.LeftHandAnchor.transform.position;
				stream.SendNext(main.vrPlayerController.LeftHandAnchor.transform.position);
				stream.SendNext(leftHand_Direction);
				stream.SendNext(main.vrPlayerController.LeftHandAnchor.transform.rotation);
				rightHand_Direction = main.vrPlayerController.RightHandAnchor.transform.position - rightHand_StoredPosition;
				rightHand_StoredPosition = main.vrPlayerController.RightHandAnchor.transform.position;
				stream.SendNext(main.vrPlayerController.RightHandAnchor.transform.position);
				stream.SendNext(rightHand_Direction);
				stream.SendNext(main.vrPlayerController.RightHandAnchor.transform.rotation);
			}
			else if (!dataManager.userData.rightHand)
			{
				leftHand_Direction = main.vrPlayerController.LeftHandAnchor.transform.position - leftHand_StoredPosition;
				leftHand_StoredPosition = main.vrPlayerController.LeftHandAnchor.transform.position;
				stream.SendNext(main.vrPlayerController.LeftHandAnchor.transform.position);
				stream.SendNext(leftHand_Direction);
				stream.SendNext(main.vrPlayerController.LeftHandAnchor.transform.rotation);
			}
			else
			{
				rightHand_Direction = main.vrPlayerController.RightHandAnchor.transform.position - rightHand_StoredPosition;
				rightHand_StoredPosition = main.vrPlayerController.RightHandAnchor.transform.position;
				stream.SendNext(main.vrPlayerController.RightHandAnchor.transform.position);
				stream.SendNext(rightHand_Direction);
				stream.SendNext(main.vrPlayerController.RightHandAnchor.transform.rotation);
			}
		}
		else if (main.scene == SceneState.STAGE)
		{
			head_Direction = main.vrFishingPlayerController.ovrCameraTransform.position - head_StoredPosition;
			head_StoredPosition = main.vrFishingPlayerController.ovrCameraTransform.position;
			stream.SendNext(main.vrFishingPlayerController.ovrCameraTransform.position);
			stream.SendNext(head_Direction);
			stream.SendNext(main.vrFishingPlayerController.ovrCameraTransform.rotation);
			if (dataManager.userData.bothHand)
			{
				leftHand_Direction = main.vrFishingPlayerController.LeftHandAnchor.transform.position - leftHand_StoredPosition;
				leftHand_StoredPosition = main.vrFishingPlayerController.LeftHandAnchor.transform.position;
				stream.SendNext(main.vrFishingPlayerController.LeftHandAnchor.transform.position);
				stream.SendNext(leftHand_Direction);
				stream.SendNext(main.vrFishingPlayerController.LeftHandAnchor.transform.rotation);
				rightHand_Direction = main.vrFishingPlayerController.RightHandAnchor.transform.position - rightHand_StoredPosition;
				rightHand_StoredPosition = main.vrFishingPlayerController.RightHandAnchor.transform.position;
				stream.SendNext(main.vrFishingPlayerController.RightHandAnchor.transform.position);
				stream.SendNext(rightHand_Direction);
				stream.SendNext(main.vrFishingPlayerController.RightHandAnchor.transform.rotation);
			}
			else if (!dataManager.userData.rightHand)
			{
				leftHand_Direction = main.vrFishingPlayerController.LeftHandAnchor.transform.position - leftHand_StoredPosition;
				leftHand_StoredPosition = main.vrFishingPlayerController.LeftHandAnchor.transform.position;
				stream.SendNext(main.vrFishingPlayerController.LeftHandAnchor.transform.position);
				stream.SendNext(leftHand_Direction);
				stream.SendNext(main.vrFishingPlayerController.LeftHandAnchor.transform.rotation);
			}
			else
			{
				rightHand_Direction = main.vrFishingPlayerController.RightHandAnchor.transform.position - rightHand_StoredPosition;
				rightHand_StoredPosition = main.vrFishingPlayerController.RightHandAnchor.transform.position;
				stream.SendNext(main.vrFishingPlayerController.RightHandAnchor.transform.position);
				stream.SendNext(rightHand_Direction);
				stream.SendNext(main.vrFishingPlayerController.RightHandAnchor.transform.rotation);
			}
		}
		stream.SendNext(lipSyncData);
		stream.SendNext(fingerLSyncData);
		stream.SendNext(fingerRSyncData);
	}
}
public class LocalFish : MonoBehaviourPun, IPunObservable
{
	private Main main;

	public bool enableWriting;

	[HideInInspector]
	public PhotonView pv;

	private Vector3 m_Direction;

	private Vector3 m_StoredPosition;

	public int fishID = -1;

	private void Awake()
	{
	}

	private void OnDestroy()
	{
	}

	private void OnEnable()
	{
		SceneManager.sceneLoaded += OnSceneLoaded;
	}

	private void OnDisable()
	{
		SceneManager.sceneLoaded -= OnSceneLoaded;
	}

	private void Start()
	{
		main = Singleton<Main>.Instance;
	}

	private void OnSceneLoaded(Scene scene, LoadSceneMode mode)
	{
		if (scene.name != "Loading")
		{
			StartCoroutine(waitMain());
		}
	}

	private IEnumerator waitMain()
	{
		while (Singleton<Main>.Instance == null)
		{
			yield return null;
		}
		main = Singleton<Main>.Instance;
	}

	public void SpawnFish(int fishID)
	{
		MonoBehaviour.print("SpawnFish");
		if (!(pv != null))
		{
			pv = base.gameObject.AddComponent<PhotonView>();
			pv.ObservedComponents = new List<UnityEngine.Component>();
			pv.ObservedComponents.Add(this);
			pv.Synchronization = ViewSynchronization.UnreliableOnChange;
			enableWriting = true;
			if (PhotonNetwork.AllocateViewID(pv))
			{
				this.fishID = fishID;
				MultiplayEventManager.Instance.SendInstantiationFishEvent(fishID);
			}
			else
			{
				UnityEngine.Debug.LogError("Failed to allocate a ViewId.");
			}
			m_StoredPosition = main.fishControl.fishPivot.transform.position;
		}
	}

	public void RemoveFish()
	{
		fishID = -1;
		enableWriting = false;
		if (pv != null)
		{
			UnityEngine.Object.Destroy(pv);
		}
	}

	public void OnPhotonSerializeView(PhotonStream stream, PhotonMessageInfo info)
	{
		if (enableWriting && pv.IsMine && stream.IsWriting && main != null && main.scene == SceneState.STAGE)
		{
			m_Direction = main.fishControl.fishPivot.transform.position - m_StoredPosition;
			m_StoredPosition = main.fishControl.fishPivot.transform.position;
			stream.SendNext(main.fishControl.fishPivot.transform.position);
			stream.SendNext(m_Direction);
			stream.SendNext(main.fishControl.fishPivot.transform.rotation);
		}
	}
}
public class LocalLure : MonoBehaviourPun, IPunObservable
{
	private Main main;

	public bool enableWriting;

	[HideInInspector]
	public PhotonView pv;

	private Vector3 m_Direction;

	private Vector3 m_StoredPosition;

	private void Awake()
	{
		MonoBehaviour.print("SyncLure Awake instanceID : " + GetInstanceID());
	}

	private void OnDestroy()
	{
		MonoBehaviour.print("SyncLure OnDestroy instanceID : " + GetInstanceID());
	}

	private void OnEnable()
	{
		SceneManager.sceneLoaded += OnSceneLoaded;
	}

	private void OnDisable()
	{
		SceneManager.sceneLoaded -= OnSceneLoaded;
	}

	private void Start()
	{
		main = Singleton<Main>.Instance;
	}

	private void OnSceneLoaded(Scene scene, LoadSceneMode mode)
	{
		if (scene.name != "Loading")
		{
			StartCoroutine(waitMain());
		}
	}

	private IEnumerator waitMain()
	{
		while (Singleton<Main>.Instance == null)
		{
			yield return null;
		}
		main = Singleton<Main>.Instance;
	}

	public void SpawnLure()
	{
		MonoBehaviour.print("SpawnLure");
		if (!(pv != null))
		{
			pv = base.gameObject.AddComponent<PhotonView>();
			pv.ObservedComponents = new List<UnityEngine.Component>();
			pv.ObservedComponents.Add(this);
			pv.Synchronization = ViewSynchronization.UnreliableOnChange;
			enableWriting = true;
			if (PhotonNetwork.AllocateViewID(pv))
			{
				MultiplayEventManager.Instance.SendInstantiationLureEvent();
			}
			else
			{
				UnityEngine.Debug.LogError("Failed to allocate a ViewId.");
			}
			m_StoredPosition = main.baitControl.transform.position;
		}
	}

	public void RemoveLure()
	{
		enableWriting = false;
		if (pv != null)
		{
			UnityEngine.Object.Destroy(pv);
		}
	}

	public void OnPhotonSerializeView(PhotonStream stream, PhotonMessageInfo info)
	{
		if (enableWriting && pv.IsMine && stream.IsWriting && main != null && main.scene == SceneState.STAGE)
		{
			m_Direction = main.baitControl.transform.position - m_StoredPosition;
			m_StoredPosition = main.baitControl.transform.position;
			stream.SendNext(main.baitControl.transform.position);
			stream.SendNext(m_Direction);
			stream.SendNext(main.baitControl.transform.rotation);
		}
	}
}
public class LocalTackle : MonoBehaviourPun, IPunObservable
{
	private Main main;

	public bool enableWriting;

	[HideInInspector]
	public PhotonView pv;

	private void OnEnable()
	{
		SceneManager.sceneLoaded += OnSceneLoaded;
	}

	private void OnDisable()
	{
		SceneManager.sceneLoaded -= OnSceneLoaded;
	}

	private void Start()
	{
		main = Singleton<Main>.Instance;
	}

	private void OnSceneLoaded(Scene scene, LoadSceneMode mode)
	{
		if (scene.name != "Loading")
		{
			StartCoroutine(waitMain());
		}
	}

	private IEnumerator waitMain()
	{
		while (Singleton<Main>.Instance == null)
		{
			yield return null;
		}
		main = Singleton<Main>.Instance;
	}

	public void SpawnTackle()
	{
		MonoBehaviour.print("SpawnTackle");
		if (!(pv != null))
		{
			pv = base.gameObject.AddComponent<PhotonView>();
			pv.ObservedComponents = new List<UnityEngine.Component>();
			pv.ObservedComponents.Add(this);
			pv.Synchronization = ViewSynchronization.UnreliableOnChange;
			enableWriting = true;
			if (PhotonNetwork.AllocateViewID(pv))
			{
				MultiplayEventManager.Instance.SendInstantiationTackleEvent();
			}
			else
			{
				UnityEngine.Debug.LogError("Failed to allocate a ViewId.");
			}
		}
	}

	public void RemoveTackle()
	{
		enableWriting = false;
		if (pv != null)
		{
			UnityEngine.Object.Destroy(pv);
		}
	}

	public void OnPhotonSerializeView(PhotonStream stream, PhotonMessageInfo info)
	{
		if (enableWriting && pv.IsMine && stream.IsWriting && main != null && main.scene == SceneState.STAGE)
		{
			stream.SendNext(main.tackleControl.multiRodBending);
			stream.SendNext(main.tackleControl.multiReelAngle);
		}
	}
}
public class LureController : MonoBehaviour
{
	public List<LureItem> lureItems;

	public List<GameObject> lures;

	private int grade;

	private void Awake()
	{
		ChangeLureGrade();
	}

	private void Start()
	{
	}

	private void Update()
	{
	}

	public void ShowLure(bool show)
	{
		lures[grade].SetActive(show);
	}

	private void ChangeLureGrade()
	{
		for (int i = 0; i < lures.Count; i++)
		{
			if (i == 0)
			{
				lures[i].SetActive(value: true);
			}
			else
			{
				lures[i].SetActive(value: false);
			}
		}
	}
}
public class MessageElement : MonoBehaviour
{
	public Text message;
}
public class MessageListConsole : MonoBehaviourPunCallbacks
{
	public Dictionary<int, MessageElement> messagebox = new Dictionary<int, MessageElement>();

	public GameObject messageElementPrefab;

	public Transform content;

	public override void OnEnable()
	{
		base.OnEnable();
		if (PhotonNetwork.CurrentRoom != null)
		{
			Singleton<NotificationManager>.Instance.receiveMessage.AddListener(ReceivedMessage);
			UpdateMessageList();
		}
	}

	private void ReceivedMessage()
	{
		UpdateMessageList();
	}

	public override void OnDisable()
	{
		base.OnDisable();
		if (Singleton<NotificationManager>.Instance != null)
		{
			Singleton<NotificationManager>.Instance.receiveMessage.RemoveListener(ReceivedMessage);
		}
	}

	public void UpdateMessageList()
	{
		ResetMessageBox();
		for (int i = 0; i < Singleton<NotificationManager>.Instance.messages.Count; i++)
		{
			if (!messagebox.ContainsKey(i))
			{
				GameObject obj = UnityEngine.Object.Instantiate(messageElementPrefab, content.transform);
				MessageElement component = obj.GetComponent<MessageElement>();
				messagebox[i] = component;
				component.message.text = Singleton<NotificationManager>.Instance.messages[i];
				obj.transform.SetAsFirstSibling();
			}
		}
	}

	private void ResetMessageBox()
	{
		if (Singleton<NotificationManager>.Instance.messages.Count != 0)
		{
			return;
		}
		foreach (KeyValuePair<int, MessageElement> item in messagebox)
		{
			if (item.Value != null)
			{
				UnityEngine.Object.Destroy(item.Value.gameObject);
			}
		}
		messagebox.Clear();
	}
}
public enum Alert
{
	CONNECTING,
	CREATING_ROOM,
	JOINING_ROOM
}
public class MultiplayAlertPopup : MonoBehaviour
{
	public Text alertText;

	public string connectingMsg = "Connecting...";

	public string creaingRoomMsg = "Creating Room...";

	public string joingingRoomMsg = "Joining Room...";

	private void Start()
	{
	}

	private void Update()
	{
	}

	public void Show(Alert alert)
	{
		switch (alert)
		{
		case Alert.CONNECTING:
			alertText.text = connectingMsg;
			break;
		case Alert.CREATING_ROOM:
			alertText.text = creaingRoomMsg;
			break;
		case Alert.JOINING_ROOM:
			alertText.text = joingingRoomMsg;
			break;
		}
	}

	public void Hide()
	{
		base.gameObject.SetActive(value: false);
	}
}
[Serializable]
public class Region
{
	public string name;

	public string token;
}
public class MultiplayEntryUIManager : MonoBehaviour
{
	public Text serverName;

	public int currentIndex;

	public List<Region> regions;

	public RoomListDisplay roomList;

	private void OnEnable()
	{
		Region region = regions.Where((Region s) => s.token == Singleton<DataManager>.Instance.userData.serverRegion).FirstOrDefault();
		if (region != null)
		{
			serverName.text = region.name;
			currentIndex = regions.IndexOf(region);
		}
	}

	public void LeftButtonEvent()
	{
		if (currentIndex > 0)
		{
			currentIndex--;
		}
		else
		{
			currentIndex = regions.Count - 1;
		}
		Singleton<Main>.Instance.multiplayUIManager.PopUpConnecting(show: true);
		Singleton<DataManager>.Instance.userData.serverRegion = regions[currentIndex].token;
		Singleton<DataManager>.Instance.Save();
		serverName.text = regions[currentIndex].name;
		if (PhotonNetwork.IsConnected)
		{
			PhotonNetwork.Disconnect();
		}
		roomList.ResetList();
		MultiplayManager.Instance.ConnectToPhoton();
		LayoutRebuilder.ForceRebuildLayoutImmediate(serverName.rectTransform);
	}

	public void RightButtonEvent()
	{
		if (currentIndex < regions.Count - 1)
		{
			currentIndex++;
		}
		else
		{
			currentIndex = 0;
		}
		Singleton<Main>.Instance.multiplayUIManager.PopUpConnecting(show: true);
		Singleton<DataManager>.Instance.userData.serverRegion = regions[currentIndex].token;
		Singleton<DataManager>.Instance.Save();
		serverName.text = regions[currentIndex].name;
		if (PhotonNetwork.IsConnected)
		{
			PhotonNetwork.Disconnect();
		}
		roomList.ResetList();
		MultiplayManager.Instance.ConnectToPhoton();
		LayoutRebuilder.ForceRebuildLayoutImmediate(serverName.rectTransform);
	}

	private void Start()
	{
	}

	private void Update()
	{
	}
}
public enum SenderEventCode : byte
{
	InstantiationAvatar = 1,
	InstantiationLure = 2,
	InstantiationFish = 3,
	InstantiationTackle = 4,
	GoFishing = 5,
	GoLobby = 6,
	FishID = 7,
	RodID = 8,
	LureID = 9,
	ReelID = 16,
	FishState = 17,
	SelectStage = 18,
	Kick = 19,
	SmartPhone = 20
}
public enum FishState
{
	None,
	Holder,
	Casting,
	Hookset,
	Drag,
	Swim,
	Stay,
	Jump,
	Struggle,
	Landing,
	Keep,
	Release,
	Fail
}
public enum StageEventCode : byte
{
	Rainbow = 128,
	Firework,
	Rain,
	FireFly,
	CherryBlossom
}
public class MultiplayEventManager : MonoBehaviourPunCallbacks, IOnEventCallback
{
	public static MultiplayEventManager Instance;

	private FishState oldFishState;

	public control_fish oldControlFish;

	private void Awake()
	{
		Instance = this;
		UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
	}

	public override void OnEnable()
	{
		base.OnEnable();
	}

	public void SendInstantiationAvatarEvent()
	{
		PhotonView pv = MultiplayManager.Instance.localAvatar.pv;
		PhotonNetwork.LocalPlayer.SetCustomProperties(new ExitGames.Client.Photon.Hashtable { { "viewID", pv.ViewID } });
		int curGender = Singleton<DataManager>.Instance.userData.curGender;
		object[] eventContent = new object[21]
		{
			pv.ViewID,
			Singleton<DataManager>.Instance.userData.bothHand,
			Singleton<DataManager>.Instance.userData.rightHand,
			curGender,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curFaceShape,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curFaceColor,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curAge,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curEyeColor,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curHairShape,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curHairColor,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curMustacheShape,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curMustacheColor,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curEyebrowShape,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curEyebrowColor,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curInnerfit,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curInnerfitColor,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curOuterfit,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curOuterfitColor,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curHat,
			Singleton<DataManager>.Instance.userData.avatars[curGender].curGlasses,
			Singleton<DataManager>.Instance.userData.curGlove
		};
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions
		{
			Receivers = ReceiverGroup.Others,
			CachingOption = EventCaching.AddToRoomCache
		};
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent(1, eventContent, raiseEventOptions, sendOptions2);
	}

	public void SendInstantiationLureEvent()
	{
		PhotonView pv = MultiplayManager.Instance.localLure.pv;
		object[] eventContent = new object[2]
		{
			pv.ViewID,
			Singleton<DataManager>.Instance.userData.curLure
		};
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions
		{
			Receivers = ReceiverGroup.Others,
			CachingOption = EventCaching.AddToRoomCache
		};
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent(2, eventContent, raiseEventOptions, sendOptions2);
	}

	public void SendInstantiationTackleEvent()
	{
		PhotonView pv = MultiplayManager.Instance.localTackle.pv;
		bool rightHand = Singleton<DataManager>.Instance.userData.rightHand;
		bool bothHand = Singleton<DataManager>.Instance.userData.bothHand;
		int curType = Singleton<DataManager>.Instance.userData.curType;
		int num = ((curType == 0) ? Singleton<DataManager>.Instance.userData.curRodS : Singleton<DataManager>.Instance.userData.curRodC);
		int num2 = ((curType == 0) ? Singleton<DataManager>.Instance.userData.curReelS : Singleton<DataManager>.Instance.userData.curReelC);
		object[] eventContent = new object[6] { pv.ViewID, rightHand, bothHand, curType, num, num2 };
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions
		{
			Receivers = ReceiverGroup.Others,
			CachingOption = EventCaching.AddToRoomCache
		};
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent(4, eventContent, raiseEventOptions, sendOptions2);
	}

	public void SendRemoveEvent(SenderEventCode code)
	{
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions
		{
			Receivers = ReceiverGroup.All,
			CachingOption = EventCaching.RemoveFromRoomCache
		};
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent((byte)code, null, raiseEventOptions, sendOptions2);
	}

	public void SendInstantiationFishEvent(int index)
	{
		PhotonView pv = MultiplayManager.Instance.localFish.pv;
		object[] eventContent = new object[2] { pv.ViewID, index };
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions
		{
			Receivers = ReceiverGroup.Others,
			CachingOption = EventCaching.DoNotCache
		};
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent(3, eventContent, raiseEventOptions, sendOptions2);
	}

	public void SendInstantiationFishEvent(int actorID, int index)
	{
		PhotonView pv = MultiplayManager.Instance.localFish.pv;
		object[] eventContent = new object[2] { pv.ViewID, index };
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions();
		raiseEventOptions.CachingOption = EventCaching.DoNotCache;
		raiseEventOptions.TargetActors = new int[1] { actorID };
		RaiseEventOptions raiseEventOptions2 = raiseEventOptions;
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent(3, eventContent, raiseEventOptions2, sendOptions2);
	}

	public void SendLureIDEvent(int index)
	{
		PhotonView pv = MultiplayManager.Instance.localLure.pv;
		object[] eventContent = new object[2] { pv.ViewID, index };
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions
		{
			Receivers = ReceiverGroup.Others,
			CachingOption = EventCaching.DoNotCache
		};
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent(9, eventContent, raiseEventOptions, sendOptions2);
	}

	public void SendRodIDEvent()
	{
		PhotonView pv = MultiplayManager.Instance.localTackle.pv;
		int num = ((Singleton<DataManager>.Instance.userData.curType == 0) ? Singleton<DataManager>.Instance.userData.curRodS : Singleton<DataManager>.Instance.userData.curRodC);
		object[] eventContent = new object[4]
		{
			pv.ViewID,
			Singleton<DataManager>.Instance.userData.rightHand,
			Singleton<DataManager>.Instance.userData.curType,
			num
		};
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions
		{
			Receivers = ReceiverGroup.Others,
			CachingOption = EventCaching.DoNotCache
		};
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent(8, eventContent, raiseEventOptions, sendOptions2);
	}

	public void SendReelIDEvent()
	{
		PhotonView pv = MultiplayManager.Instance.localTackle.pv;
		int num = ((Singleton<DataManager>.Instance.userData.curType == 0) ? Singleton<DataManager>.Instance.userData.curReelS : Singleton<DataManager>.Instance.userData.curReelC);
		object[] eventContent = new object[4]
		{
			pv.ViewID,
			Singleton<DataManager>.Instance.userData.rightHand,
			Singleton<DataManager>.Instance.userData.curType,
			num
		};
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions
		{
			Receivers = ReceiverGroup.Others,
			CachingOption = EventCaching.DoNotCache
		};
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent(16, eventContent, raiseEventOptions, sendOptions2);
	}

	public void GoFishingEvent()
	{
		if (staticLoading.Stage != "Lobby" || staticLoading.Stage != "Lobby_KR_sea")
		{
			foreach (PhotonView i in MultiplayManager.Instance.tackleViews)
			{
				PhotonView photonView = MultiplayManager.Instance.avatarViews.Where((PhotonView s) => s.Owner == i.Owner).FirstOrDefault();
				if (photonView != null)
				{
					i.gameObject.transform.SetParent(photonView.transform);
				}
			}
		}
		MultiplayManager.Instance.fishViews.Clear();
		object[] eventContent = new object[1] { staticLoading.Stage };
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions
		{
			Receivers = ReceiverGroup.Others,
			CachingOption = EventCaching.AddToRoomCacheGlobal
		};
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent(5, eventContent, raiseEventOptions, sendOptions2);
	}

	public void GoLobbyEvent()
	{
		object[] eventContent = new object[0];
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions
		{
			Receivers = ReceiverGroup.Others,
			CachingOption = EventCaching.AddToRoomCacheGlobal
		};
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent(6, eventContent, raiseEventOptions, sendOptions2);
	}

	public void SendFishState(FishState fishState, control_fish controlFish = null)
	{
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && fishState != oldFishState)
		{
			oldFishState = fishState;
			PhotonView pv = MultiplayManager.Instance.localFish.pv;
			PhotonView pv2 = MultiplayManager.Instance.localTackle.pv;
			PhotonView pv3 = MultiplayManager.Instance.localAvatar.pv;
			int num = ((!(pv == null)) ? pv.ViewID : 0);
			int num2 = ((!(pv2 == null)) ? pv2.ViewID : 0);
			int num3 = ((!(pv3 == null)) ? pv3.ViewID : 0);
			object[] eventContent;
			if (controlFish != null)
			{
				oldControlFish = controlFish;
				eventContent = new object[7] { num, num2, num3, fishState, controlFish.fishID, controlFish.fishSize, controlFish.fishWeight };
			}
			else
			{
				oldControlFish = null;
				eventContent = new object[4] { num, num2, num3, fishState };
			}
			RaiseEventOptions raiseEventOptions = new RaiseEventOptions
			{
				Receivers = ReceiverGroup.Others,
				CachingOption = EventCaching.DoNotCache
			};
			SendOptions sendOptions = default(SendOptions);
			sendOptions.Reliability = true;
			SendOptions sendOptions2 = sendOptions;
			PhotonNetwork.RaiseEvent(17, eventContent, raiseEventOptions, sendOptions2);
			if (fishState == FishState.Keep || fishState == FishState.Release || fishState == FishState.Fail)
			{
				MultiplayManager.Instance.fishViews.Remove(pv);
				UnityEngine.Object.Destroy(pv);
			}
		}
	}

	public void SendFishCurrentState(int actorID)
	{
		PhotonView pv = MultiplayManager.Instance.localFish.pv;
		PhotonView pv2 = MultiplayManager.Instance.localTackle.pv;
		PhotonView pv3 = MultiplayManager.Instance.localAvatar.pv;
		int num = ((!(pv == null)) ? pv.ViewID : 0);
		int num2 = ((!(pv2 == null)) ? pv2.ViewID : 0);
		int num3 = ((!(pv3 == null)) ? pv3.ViewID : 0);
		object[] eventContent = ((!(oldControlFish != null)) ? new object[4] { num, num2, num3, oldFishState } : new object[7] { num, num2, num3, oldFishState, oldControlFish.fishID, oldControlFish.fishSize, oldControlFish.fishWeight });
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions();
		raiseEventOptions.CachingOption = EventCaching.DoNotCache;
		raiseEventOptions.TargetActors = new int[1] { actorID };
		RaiseEventOptions raiseEventOptions2 = raiseEventOptions;
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent(17, eventContent, raiseEventOptions2, sendOptions2);
		if (oldFishState == FishState.Keep || oldFishState == FishState.Release || oldFishState == FishState.Fail)
		{
			MultiplayManager.Instance.fishViews.Remove(pv);
			UnityEngine.Object.Destroy(pv);
		}
	}

	public void SelectStageEvent(int stageNum)
	{
		object[] eventContent = new object[1] { stageNum };
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions
		{
			Receivers = ReceiverGroup.Others,
			CachingOption = EventCaching.DoNotCache
		};
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent(18, eventContent, raiseEventOptions, sendOptions2);
	}

	public void SendKickMessage(int actorID)
	{
		object[] eventContent = null;
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions();
		raiseEventOptions.CachingOption = EventCaching.DoNotCache;
		raiseEventOptions.TargetActors = new int[1] { actorID };
		RaiseEventOptions raiseEventOptions2 = raiseEventOptions;
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent(19, eventContent, raiseEventOptions2, sendOptions2);
	}

	public void SendStageEventMessage(int actorID, StageEventCode stageEventCode)
	{
		object[] eventContent = null;
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions();
		raiseEventOptions.CachingOption = EventCaching.DoNotCache;
		if (actorID != 0)
		{
			raiseEventOptions.TargetActors = new int[1] { actorID };
		}
		else
		{
			raiseEventOptions.Receivers = ReceiverGroup.Others;
		}
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent((byte)stageEventCode, eventContent, raiseEventOptions, sendOptions2);
	}

	public void SendStageEndEventMessage(int actorID, StageEventCode stageEventCode)
	{
		object[] eventContent = null;
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions();
		raiseEventOptions.CachingOption = EventCaching.DoNotCache;
		if (actorID != 0)
		{
			raiseEventOptions.TargetActors = new int[1] { actorID };
		}
		else
		{
			raiseEventOptions.Receivers = ReceiverGroup.Others;
		}
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent((byte)stageEventCode, eventContent, raiseEventOptions, sendOptions2);
	}

	public void SendSmartphoneStatusEvent(int status)
	{
		PhotonView pv = MultiplayManager.Instance.localAvatar.pv;
		object[] eventContent = new object[2] { pv.ViewID, status };
		RaiseEventOptions raiseEventOptions = new RaiseEventOptions
		{
			Receivers = ReceiverGroup.Others,
			CachingOption = EventCaching.DoNotCache
		};
		SendOptions sendOptions = default(SendOptions);
		sendOptions.Reliability = true;
		SendOptions sendOptions2 = sendOptions;
		PhotonNetwork.RaiseEvent(20, eventContent, raiseEventOptions, sendOptions2);
	}

	public void OnEvent(EventData photonEvent)
	{
		switch (photonEvent.Code)
		{
		case 1:
			MultiplayManager.Instance.InstantiateRemoteAvatar(photonEvent);
			break;
		case 2:
			_ = (object[])photonEvent.CustomData;
			MultiplayManager.Instance.InstantiateRemoteLure(photonEvent);
			break;
		case 3:
		{
			object[] data = (object[])photonEvent.CustomData;
			PhotonView photonView8 = MultiplayManager.Instance.fishViews.Where((PhotonView s) => s.ViewID == (int)data[0]).FirstOrDefault();
			if (photonView8 != null)
			{
				photonView8.GetComponent<RemoteFish>().ShowFish((int)data[1]);
			}
			else
			{
				MultiplayManager.Instance.InstantiateRemoteFish(photonEvent);
			}
			MonoBehaviour.print("OnEvent SendFishID : " + (int)data[1]);
			break;
		}
		case 4:
			_ = (object[])photonEvent.CustomData;
			MultiplayManager.Instance.InstantiateRemoteTackle(photonEvent);
			break;
		case 5:
			if (MultiplayManager.Instance.localFish.pv != null)
			{
				MultiplayManager.Instance.localFish.RemoveFish();
			}
			staticLoading.Stage = (string)((object[])photonEvent.CustomData)[0];
			if (staticLoading.Stage != "Lobby" || staticLoading.Stage != "Lobby_KR_sea")
			{
				foreach (PhotonView i in MultiplayManager.Instance.tackleViews)
				{
					PhotonView photonView9 = MultiplayManager.Instance.avatarViews.Where((PhotonView s) => s.Owner == i.Owner).FirstOrDefault();
					if (photonView9 != null)
					{
						i.gameObject.transform.SetParent(photonView9.transform);
					}
				}
			}
			SceneManager.LoadScene("Loading");
			break;
		case 6:
			_ = (object[])photonEvent.CustomData;
			staticLoading.Stage = "Lobby";
			SceneManager.LoadScene("Loading");
			break;
		case 8:
		{
			object[] array2 = (object[])photonEvent.CustomData;
			int viewID = (int)array2[0];
			bool handendRight = (bool)array2[1];
			int num = (int)array2[2];
			int num2 = (int)array2[3];
			PhotonView photonView2 = MultiplayManager.Instance.tackleViews.Where((PhotonView s) => s.ViewID == viewID).FirstOrDefault();
			if (photonView2 != null)
			{
				MonoBehaviour.print("rodIndex : " + num2);
				photonView2.GetComponent<RemoteTackle>().rodID = num2;
				photonView2.GetComponent<RemoteTackle>().InitTackle(handendRight, num == 0);
			}
			break;
		}
		case 16:
		{
			object[] data3 = (object[])photonEvent.CustomData;
			bool handendRight2 = (bool)data3[1];
			int num3 = (int)data3[2];
			int reelID = (int)data3[3];
			PhotonView photonView4 = MultiplayManager.Instance.tackleViews.Where((PhotonView s) => s.ViewID == (int)data3[0]).FirstOrDefault();
			if (photonView4 != null)
			{
				photonView4.GetComponent<RemoteTackle>().reelID = reelID;
				photonView4.GetComponent<RemoteTackle>().InitTackle(handendRight2, num3 == 0);
			}
			break;
		}
		case 9:
		{
			object[] data4 = (object[])photonEvent.CustomData;
			PhotonView photonView3 = MultiplayManager.Instance.lureViews.Where((PhotonView s) => s.ViewID == (int)data4[0]).FirstOrDefault();
			if (photonView3 != null)
			{
				photonView3.GetComponent<RemoteLure>().ShowLure((int)data4[1]);
				MonoBehaviour.print("OnEvent SendLureID : " + (int)data4[1]);
			}
			break;
		}
		case 17:
		{
			object[] data2 = (object[])photonEvent.CustomData;
			PhotonView photonView5 = MultiplayManager.Instance.fishViews.Where((PhotonView s) => s.ViewID == (int)data2[0]).FirstOrDefault();
			if (photonView5 != null)
			{
				photonView5.GetComponent<RemoteFish>().ChangeFishState((FishState)data2[3]);
			}
			PhotonView photonView6 = MultiplayManager.Instance.tackleViews.Where((PhotonView s) => s.ViewID == (int)data2[1]).FirstOrDefault();
			if (photonView6 != null)
			{
				photonView6.GetComponent<RemoteTackle>().ChangeTackleState((FishState)data2[3]);
			}
			PhotonView pv3 = MultiplayManager.Instance.avatarViews.Where((PhotonView s) => s.ViewID == (int)data2[2]).FirstOrDefault();
			PhotonView photonView7 = MultiplayManager.Instance.lureViews.Where((PhotonView s) => s.Owner == pv3.Owner).FirstOrDefault();
			switch ((FishState)data2[3])
			{
			case FishState.Landing:
				if (pv3 != null)
				{
					pv3.GetComponent<RemoteAvatar>().DisplayPlayInfo((int)data2[4], (float)data2[5], (float)data2[6]);
					Singleton<NotificationManager>.Instance.ShowNotification(pv3, (int)data2[4], (float)data2[5], (float)data2[6]);
				}
				if (photonView7 != null)
				{
					photonView7.GetComponent<RemoteLure>().HideLure();
				}
				break;
			case FishState.Fail:
				if (photonView5 != null)
				{
					MultiplayManager.Instance.fishViews.Remove(photonView5);
					UnityEngine.Object.Destroy(photonView5.gameObject);
				}
				break;
			case FishState.Keep:
				if (photonView5 != null)
				{
					MultiplayManager.Instance.fishViews.Remove(photonView5);
					UnityEngine.Object.Destroy(photonView5.gameObject);
				}
				if (photonView7 != null)
				{
					photonView7.GetComponent<RemoteLure>().ShowLureWhenKeepOrRelease();
				}
				break;
			case FishState.Release:
				if (photonView5 != null)
				{
					MultiplayManager.Instance.fishViews.Remove(photonView5);
					UnityEngine.Object.Destroy(photonView5.gameObject);
				}
				if (photonView7 != null)
				{
					photonView7.GetComponent<RemoteLure>().ShowLureWhenKeepOrRelease();
				}
				break;
			}
			break;
		}
		case 18:
		{
			object[] array3 = (object[])photonEvent.CustomData;
			if (Singleton<Main>.Instance != null)
			{
				Singleton<Main>.Instance.multiplayUIManager.stageListDisplay.ChangeStage((int)array3[0]);
			}
			break;
		}
		case 19:
			Singleton<NotificationManager>.Instance.ShowKickOut();
			PhotonNetwork.LeaveRoom();
			break;
		case 128:
			MonoBehaviour.print("마스터가 이벤트 시작 신호 받기");
			if (PunSingleton<StageEventManager>.Instance != null)
			{
				PunSingleton<StageEventManager>.Instance.Play(StageEvent.Rainbow);
			}
			break;
		case 130:
			_ = (object[])photonEvent.CustomData;
			if (PunSingleton<StageEventManager>.Instance != null)
			{
				PunSingleton<StageEventManager>.Instance.Play(StageEvent.Rain);
			}
			break;
		case 129:
			_ = (object[])photonEvent.CustomData;
			if (PunSingleton<StageEventManager>.Instance != null)
			{
				PunSingleton<StageEventManager>.Instance.Play(StageEvent.Firework);
			}
			break;
		case 131:
			_ = (object[])photonEvent.CustomData;
			if (PunSingleton<StageEventManager>.Instance != null)
			{
				PunSingleton<StageEventManager>.Instance.Play(StageEvent.FireFly);
			}
			break;
		case 132:
			_ = (object[])photonEvent.CustomData;
			if (PunSingleton<StageEventManager>.Instance != null)
			{
				PunSingleton<StageEventManager>.Instance.Play(StageEvent.CherryBlossom);
			}
			break;
		case 20:
		{
			object[] array = (object[])photonEvent.CustomData;
			int viewID2 = (int)array[0];
			int positionNum = (int)array[1];
			PhotonView photonView = MultiplayManager.Instance.avatarViews.Where((PhotonView s) => s.ViewID == viewID2).FirstOrDefault();
			if (photonView != null)
			{
				photonView.GetComponent<RemoteAvatar>().smartPhoneSet(positionNum);
			}
			break;
		}
		}
	}
}
public class MultiplayManager : MonoBehaviourPunCallbacks
{
	public static MultiplayManager Instance;

	private string photonBetaAppID = "6a59a41f-470c-4b68-8e4e-467ab7106819";

	private string photonLiveAppID = "96b9c110-27c2-4838-87f3-4c332f91aafb";

	public bool isLive;

	[Header("Local")]
	public LocalAvatar localAvatar;

	public LocalFish localFish;

	public LocalLure localLure;

	public LocalTackle localTackle;

	public int positionIndex = -1;

	[Header("Remote Prefabs")]
	public GameObject remoteAvatarPrefab;

	public GameObject remoteLurePrefab;

	public GameObject remoteFishPrefab;

	public GameObject remoteTacklePrefab;

	[Header("Remote PhotonViews")]
	public List<PhotonView> avatarViews = new List<PhotonView>();

	public List<PhotonView> lureViews = new List<PhotonView>();

	public List<PhotonView> fishViews = new List<PhotonView>();

	public List<PhotonView> tackleViews = new List<PhotonView>();

	[Header("VOIP")]
	public VoiceChatManager voipManager;

	private VoipState currentState;

	public bool isMicOn = true;

	public ulong myID;

	public Dictionary<ulong, VoipRemoteUser> remoteUsers = new Dictionary<ulong, VoipRemoteUser>();

	private RVRFLipSyncMicInput micInput;

	private RVRFLipSyncContext lipsyncContext;

	private AudioSource audioSource;

	public AudioClip[] talkOnOFF;

	public AudioClip doorBell;

	[Header("MyCollider")]
	public GameObject myCollider;

	private GameObject myCol;

	private bool isAuthenticationing;

	private DataManager dataManager;

	private Main main;

	private float voiceCurrent;

	private void Awake()
	{
		if (Instance != null && Instance != this)
		{
			UnityEngine.Object.Destroy(base.gameObject);
			return;
		}
		Instance = this;
		UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		lipsyncContext = GetComponent<RVRFLipSyncContext>();
		micInput = GetComponent<RVRFLipSyncMicInput>();
		TransitionToState(VoipState.INITIALIZING);
		voipManager = new VoiceChatManager();
		audioSource = GetComponent<AudioSource>();
	}

	public override void OnEnable()
	{
		base.OnEnable();
		SceneManager.sceneLoaded += OnSceneLoaded;
		PlayerNumbering.OnPlayerNumberingChanged += OnPlayerNumebringChanged;
	}

	public override void OnDisable()
	{
		base.OnDisable();
		SceneManager.sceneLoaded -= OnSceneLoaded;
		PlayerNumbering.OnPlayerNumberingChanged -= OnPlayerNumebringChanged;
	}

	private void Update()
	{
		ProcessPushToTalk();
	}

	private void OnSceneLoaded(Scene scene, LoadSceneMode mode)
	{
		if (scene.name != "Loading")
		{
			StartCoroutine(waitMain());
		}
	}

	private IEnumerator waitMain()
	{
		while (Singleton<Main>.Instance == null)
		{
			yield return null;
		}
		main = Singleton<Main>.Instance;
		if (main.scene == SceneState.LOBBY && PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
		{
			for (int i = 0; i < main.lobbyUIManager.allPanels.Count; i++)
			{
				if (i != 8)
				{
					main.lobbyUIManager.allPanels[i].SetActive(value: false);
				}
				else
				{
					main.lobbyUIManager.allPanels[8].SetActive(value: true);
				}
			}
		}
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
		{
			OnPlayerNumebringChanged();
		}
	}

	private void OnPlayerNumebringChanged()
	{
		foreach (KeyValuePair<int, Player> player in PhotonNetwork.CurrentRoom.Players)
		{
			if (player.Value == PhotonNetwork.LocalPlayer && PhotonNetwork.LocalPlayer.GetPlayerNumber() != -1 && localAvatar != null)
			{
				positionIndex = PhotonNetwork.LocalPlayer.GetPlayerNumber();
				if (localAvatar.pv == null)
				{
					localAvatar.SpawnPlayer();
				}
				break;
			}
		}
	}

	private void ProcessPushToTalk()
	{
		if (PhotonNetwork.InRoom)
		{
			if (VRInput.Touch_Click(VRInput.eController.bothhand) && dataManager.userData.isPushToTalk)
			{
				voipManager.UnMute();
				audioSource.PlayOneShot(talkOnOFF[0]);
				UnityEngine.Debug.Log("PTT UnMute");
			}
			if (VRInput.Touch_Release(VRInput.eController.bothhand) && dataManager.userData.isPushToTalk)
			{
				voipManager.Mute();
				audioSource.PlayOneShot(talkOnOFF[1]);
				UnityEngine.Debug.Log("PTT Mute");
			}
		}
	}

	public void ConnectToPhoton()
	{
		if (isAuthenticationing)
		{
			return;
		}
		isAuthenticationing = true;
		Users.GetUserProof().OnComplete(delegate(Message<UserProof> s)
		{
			myID = Singleton<OculusManager>.Instance.id;
			Photon.Realtime.AuthenticationValues authenticationValues = new Photon.Realtime.AuthenticationValues();
			authenticationValues.UserId = Singleton<OculusManager>.Instance.id.ToString();
			authenticationValues.AuthType = Photon.Realtime.CustomAuthenticationType.Oculus;
			authenticationValues.AddAuthParameter("userid", Singleton<OculusManager>.Instance.id.ToString());
			authenticationValues.AddAuthParameter("nonce", s.Data.Value);
			PhotonNetwork.AuthValues = authenticationValues;
			if (isLive)
			{
				PhotonNetwork.PhotonServerSettings.AppSettings.AppIdRealtime = photonLiveAppID;
			}
			else
			{
				PhotonNetwork.PhotonServerSettings.AppSettings.AppIdRealtime = photonBetaAppID;
			}
			PhotonNetwork.PhotonServerSettings.AppSettings.UseNameServer = true;
			PhotonNetwork.PhotonServerSettings.AppSettings.Protocol = ConnectionProtocol.Udp;
			PhotonNetwork.PhotonServerSettings.AppSettings.FixedRegion = dataManager.userData.serverRegion;
			PhotonNetwork.PhotonServerSettings.AppSettings.AppVersion = "1.0";
			PhotonNetwork.PhotonServerSettings.RunInBackground = true;
			PhotonNetwork.ConnectUsingSettings();
			isAuthenticationing = false;
		});
	}

	public override void OnConnectedToMaster()
	{
		base.OnConnectedToMaster();
		PhotonNetwork.LocalPlayer.NickName = Singleton<OculusManager>.Instance.oculusID;
		JoinLobby();
		UnityEngine.Debug.Log("Welcome to PhotonNetwork  " + PhotonNetwork.LocalPlayer.NickName);
	}

	public void JoinLobby()
	{
		if (PhotonNetwork.NetworkClientState == ClientState.ConnectedToMasterServer)
		{
			PhotonNetwork.JoinLobby(TypedLobby.Default);
		}
	}

	public void CreateRoom(string displayname, string password, int maxPlayer, bool voiceChat)
	{
		string roomName = Singleton<OculusManager>.Instance.id + "_" + password;
		Photon.Realtime.RoomOptions roomOptions = new Photon.Realtime.RoomOptions();
		roomOptions.MaxPlayers = (byte)maxPlayer;
		roomOptions.PublishUserId = true;
		ExitGames.Client.Photon.Hashtable hashtable = new ExitGames.Client.Photon.Hashtable();
		hashtable.Add("nickName", Singleton<OculusManager>.Instance.oculusID);
		hashtable.Add("P0", false);
		hashtable.Add("P1", false);
		hashtable.Add("P2", false);
		hashtable.Add("P3", false);
		hashtable.Add("voiceChat", voiceChat);
		hashtable.Add("displayName", displayname);
		hashtable.Add("roomName", Singleton<OculusManager>.Instance.id.ToString());
		hashtable.Add("password", password);
		roomOptions.CustomRoomProperties = hashtable;
		roomOptions.CustomRoomPropertiesForLobby = new string[4] { "displayName", "password", "voiceChat", "roomName" };
		roomOptions.IsOpen = true;
		roomOptions.IsVisible = true;
		PhotonNetwork.CreateRoom(roomName, roomOptions, TypedLobby.Default);
	}

	public override void OnCreatedRoom()
	{
		base.OnCreatedRoom();
		staticLoading.Stage = SceneManager.GetActiveScene().name;
		if (PhotonNetwork.InRoom && PhotonNetwork.IsMasterClient)
		{
			localAvatar.isReady = true;
			MultiplayEventManager.Instance.GoFishingEvent();
		}
		SetRoomProperty();
	}

	public override void OnJoinedRoom()
	{
		MonoBehaviour.print("OnJoinedRoom success");
		LobbyColliderSetting(hasJoinedRoom: true);
		Voip.SetMicrophoneFilterCallback(MicFilter);
		if (dataManager.userData.isPushToTalk)
		{
			MonoBehaviour.print("isPushToTalk 켜져 있어서 Mute 시킴!");
			voipManager.Mute();
		}
		CreateMyCollider();
	}

	private void SetRoomProperty()
	{
		AquariumData[] array = dataManager.userData.aquariums[main.nationId].rooms[0].items.Where((AquariumData s) => s.state).ToArray();
		int[] value = new int[0];
		if (array != null)
		{
			value = array.Select((AquariumData s) => s.id).ToArray();
		}
		AquariumData[] array2 = dataManager.userData.aquariums[main.nationId].rooms[1].items.Where((AquariumData s) => s.state).ToArray();
		int[] value2 = new int[0];
		if (array2 != null)
		{
			value2 = array2.Select((AquariumData s) => s.id).ToArray();
		}
		int[] value3 = dataManager.userData.aquariums[main.nationId].rooms[0].fishCount.ToArray();
		int[] value4 = dataManager.userData.aquariums[main.nationId].rooms[1].fishCount.ToArray();
		int[] value5 = dataManager.userData.achievements[dataManager.currentNation].achievement.ToArray();
		int[] value6 = dataManager.userData.achievements[dataManager.currentNation].grade.ToArray();
		int[] value7 = dataManager.userData.seasonRank.ToArray();
		FurnitureData[] array3 = dataManager.userData.furnitures[main.nationId].rooms[0].items.Where((FurnitureData s) => s.state).ToArray();
		int[] value8 = new int[0];
		if (array3 != null)
		{
			value8 = array3.Select((FurnitureData s) => s.id).ToArray();
		}
		FurnitureData[] array4 = dataManager.userData.furnitures[main.nationId].rooms[1].items.Where((FurnitureData s) => s.state).ToArray();
		int[] value9 = new int[0];
		if (array4 != null)
		{
			value9 = array4.Select((FurnitureData s) => s.id).ToArray();
		}
		int time = GetTime();
		PhotonNetwork.CurrentRoom.SetCustomProperties(new ExitGames.Client.Photon.Hashtable
		{
			{ "decorations_A", value },
			{ "decorations_B", value2 },
			{ "fishCount_A", value3 },
			{ "fishCount_B", value4 },
			{ "achievements", value5 },
			{ "grades", value6 },
			{ "furnitures_A", value8 },
			{ "furnitures_B", value9 },
			{ "seasonRanks", value7 },
			{ "time", time }
		});
	}

	private int GetTime()
	{
		if (dataManager.userData.cabinTime == 0)
		{
			return DateTime.Now.Hour;
		}
		if (dataManager.userData.cabinTime == 1)
		{
			return 12;
		}
		if (dataManager.userData.cabinTime == 2)
		{
			return 18;
		}
		return 21;
	}

	private void LobbyColliderSetting(bool hasJoinedRoom)
	{
		if (hasJoinedRoom)
		{
			if (!(main != null) || main.scene != SceneState.LOBBY)
			{
				return;
			}
			if (main.vrPlayerController.privateRoomArea != null)
			{
				main.vrPlayerController.privateRoomArea.GetComponent<Collider>().enabled = false;
			}
			if (PhotonNetwork.IsMasterClient)
			{
				if (main.vrPlayerController.lobbyArea != null && main.vrPlayerController.lobbyAreaGlow != null)
				{
					main.vrPlayerController.lobbyArea.GetComponent<Collider>().enabled = true;
					main.vrPlayerController.lobbyAreaGlow.enabled = true;
				}
				if (main.vrPlayerController.saltWaterArea != null && main.vrPlayerController.saltWaterAreaGlow != null)
				{
					main.vrPlayerController.saltWaterArea.GetComponent<Collider>().enabled = true;
					main.vrPlayerController.saltWaterArea.enabled = false;
					main.vrPlayerController.saltWaterAreaGlow.enabled = false;
				}
			}
			else
			{
				if (main.vrPlayerController.lobbyArea != null && main.vrPlayerController.lobbyAreaGlow != null)
				{
					main.vrPlayerController.lobbyArea.GetComponent<Collider>().enabled = false;
					main.vrPlayerController.lobbyAreaGlow.enabled = false;
				}
				if (main.vrPlayerController.saltWaterArea != null && main.vrPlayerController.saltWaterAreaGlow != null)
				{
					main.vrPlayerController.saltWaterArea.GetComponent<Collider>().enabled = false;
					main.vrPlayerController.saltWaterArea.enabled = false;
					main.vrPlayerController.saltWaterAreaGlow.enabled = false;
				}
			}
		}
		else if (main != null && main.scene == SceneState.LOBBY)
		{
			if (main.vrPlayerController.privateRoomArea != null)
			{
				main.vrPlayerController.privateRoomArea.GetComponent<Collider>().enabled = true;
			}
			if (main.vrPlayerController.lobbyArea != null && main.vrPlayerController.lobbyAreaGlow != null)
			{
				main.vrPlayerController.lobbyArea.GetComponent<Collider>().enabled = true;
				main.vrPlayerController.lobbyAreaGlow.enabled = true;
			}
			if (main.vrPlayerController.saltWaterArea != null && main.vrPlayerController.saltWaterAreaGlow != null)
			{
				main.vrPlayerController.saltWaterArea.GetComponent<Collider>().enabled = true;
				main.vrPlayerController.saltWaterArea.enabled = true;
			}
		}
	}

	[MonoPInvokeCallback(typeof(Oculus.Platform.CAPI.FilterCallback))]
	public static void MicFilter(short[] pcmData, UIntPtr pcmDataLength, int frequency, int numChannels)
	{
		Instance.UpdateVoiceData(pcmData, numChannels);
	}

	public void UpdateVoiceData(short[] pcmData, int numChannels)
	{
		if (localAvatar != null)
		{
			UpdateVoiceData2(pcmData, numChannels);
		}
		float num = 0f;
		float[] array = new float[pcmData.Length];
		for (int i = 0; i < pcmData.Length; i++)
		{
			float num2 = (array[i] = (float)pcmData[i] / 32767f);
			if (num2 > num)
			{
				num = num2;
			}
		}
		voiceCurrent = num;
	}

	public void UpdateVoiceData2(short[] pcmData, int numChannels)
	{
		if (lipsyncContext != null && micInput == null)
		{
			lipsyncContext.ProcessAudioSamplesRaw(pcmData, numChannels);
		}
	}

	private void CreateMyCollider()
	{
		if (myCol == null)
		{
			myCol = UnityEngine.Object.Instantiate(myCollider, main.cameraTransform);
			myCol.transform.localPosition = Vector3.zero;
		}
	}

	public override void OnPlayerEnteredRoom(Player newPlayer)
	{
		Singleton<NotificationManager>.Instance.ShowUserJoined(newPlayer);
		if (main != null && main.scene == SceneState.LOBBY)
		{
			audioSource.PlayOneShot(doorBell);
		}
	}

	public override void OnPlayerLeftRoom(Player otherPlayer)
	{
		UnityEngine.Debug.Log("OnPlayerLeftRoom called from Multiplaymanager");
		RemoveVoipRemoteUser(ulong.Parse(otherPlayer.UserId));
		Singleton<NotificationManager>.Instance.ShowUserLeft(otherPlayer);
	}

	public override void OnJoinRoomFailed(short returnCode, string message)
	{
		MonoBehaviour.print("You failed to join a Room : " + message);
	}

	public override void OnLeftRoom()
	{
		positionIndex = -1;
		foreach (PhotonView avatarView in avatarViews)
		{
			UnityEngine.Object.Destroy(avatarView.gameObject);
		}
		foreach (PhotonView lureView in lureViews)
		{
			UnityEngine.Object.Destroy(lureView.gameObject);
		}
		foreach (PhotonView fishView in fishViews)
		{
			UnityEngine.Object.Destroy(fishView.gameObject);
		}
		foreach (PhotonView tackleView in tackleViews)
		{
			UnityEngine.Object.Destroy(tackleView.gameObject);
		}
		avatarViews.Clear();
		lureViews.Clear();
		fishViews.Clear();
		tackleViews.Clear();
		localAvatar.RemovePlayer();
		localFish.RemoveFish();
		localLure.RemoveLure();
		localTackle.RemoveTackle();
		foreach (KeyValuePair<ulong, VoipRemoteUser> remoteUser in remoteUsers)
		{
			voipManager.Disconnect(remoteUser.Key);
		}
		remoteUsers.Clear();
		if (Singleton<NotificationManager>.Instance != null && Singleton<NotificationManager>.Instance.messages != null)
		{
			Singleton<NotificationManager>.Instance.messages.Clear();
		}
		LobbyColliderSetting(hasJoinedRoom: false);
	}

	public override void OnMasterClientSwitched(Player newMasterClient)
	{
		base.OnMasterClientSwitched(newMasterClient);
		string value = newMasterClient.NickName + "'s ROOM";
		PhotonNetwork.CurrentRoom.SetCustomProperties(new ExitGames.Client.Photon.Hashtable
		{
			{ "nickName", newMasterClient.NickName },
			{ "displayName", value }
		});
		if (newMasterClient == PhotonNetwork.LocalPlayer)
		{
			SetRoomProperty();
		}
	}

	public void ExitRoom()
	{
		if (PhotonNetwork.InRoom)
		{
			PhotonNetwork.Disconnect();
		}
	}

	private void SetPositionIndex()
	{
	}

	private void ResetPositionIndex()
	{
		if (PhotonNetwork.CurrentRoom != null)
		{
			_ = PhotonNetwork.CurrentRoom.PlayerCount;
			_ = 1;
		}
	}

	private void OnApplicationQuit()
	{
		PhotonNetwork.Disconnect();
		foreach (KeyValuePair<ulong, VoipRemoteUser> remoteUser in remoteUsers)
		{
			voipManager.Disconnect(remoteUser.Key);
		}
	}

	public void InstantiateRemoteAvatar(EventData photonEvent)
	{
		object[] array = (object[])photonEvent.CustomData;
		int viewID = (int)array[0];
		bool isBothHand = (bool)array[1];
		bool isRightHand = (bool)array[2];
		int gender = (int)array[3];
		AvatarData avatarData = new AvatarData();
		avatarData.curFaceShape = (int)array[4];
		avatarData.curFaceColor = (int)array[5];
		avatarData.curAge = (int)array[6];
		avatarData.curEyeColor = (int)array[7];
		avatarData.curHairShape = (int)array[8];
		avatarData.curHairColor = (int)array[9];
		avatarData.curMustacheShape = (int)array[10];
		avatarData.curMustacheColor = (int)array[11];
		avatarData.curEyebrowShape = (int)array[12];
		avatarData.curEyebrowColor = (int)array[13];
		avatarData.curInnerfit = (int)array[14];
		avatarData.curInnerfitColor = (int)array[15];
		avatarData.curOuterfit = (int)array[16];
		avatarData.curOuterfitColor = (int)array[17];
		avatarData.curHat = (int)array[18];
		avatarData.curGlasses = (int)array[19];
		int curGlove_remote = (int)array[20];
		GameObject gameObject = null;
		gameObject = UnityEngine.Object.Instantiate(remoteAvatarPrefab, new Vector3(0f, 0f, 0f), Quaternion.identity);
		PhotonView photonView = gameObject.AddComponent<PhotonView>();
		photonView.ViewID = viewID;
		photonView.ObservedComponents = new List<UnityEngine.Component>();
		photonView.ObservedComponents.Add(photonView.GetComponent<RemoteAvatar>());
		photonView.GetComponent<RemoteAvatar>().ChangeHand(isBothHand, isRightHand);
		photonView.Synchronization = ViewSynchronization.UnreliableOnChange;
		avatarViews.Add(photonView);
		ulong num = ulong.Parse(photonView.Owner.UserId);
		VoipRemoteUser voipRemoteUser = new VoipRemoteUser();
		voipRemoteUser.remoteAvatar = gameObject.GetComponent<RemoteAvatar>();
		voipRemoteUser.remoteUserID = num;
		voipRemoteUser.voipSource = gameObject.AddComponent<VoipAudioSourceHiLevel>();
		voipRemoteUser.voipSource.senderID = num;
		remoteUsers.Add(num, voipRemoteUser);
		voipManager.ConnectTo(num);
		if (photonView != null)
		{
			photonView.GetComponent<RemoteAvatar>().avatarController.InitRemoteAvatar(gender, avatarData, curGlove_remote);
		}
		avatarData = null;
	}

	private IEnumerator delayInitRemoteAvatar(PhotonView pv, int curGender, AvatarData avatar, int curGlove)
	{
		yield return new WaitForSeconds(2f);
		pv.GetComponent<RemoteAvatar>().avatarController.InitRemoteAvatar(curGender, avatar, curGlove);
	}

	public void InstantiateRemoteLure(EventData photonEvent)
	{
		object[] array = (object[])photonEvent.CustomData;
		GameObject gameObject = UnityEngine.Object.Instantiate(remoteLurePrefab, Vector3.zero, Quaternion.identity);
		PhotonView pv = gameObject.AddComponent<PhotonView>();
		pv.ViewID = (int)array[0];
		PhotonView photonView = avatarViews.Where((PhotonView s) => s.Owner == pv.Owner).FirstOrDefault();
		if (photonView != null)
		{
			gameObject.transform.SetParent(photonView.transform);
		}
		pv.ObservedComponents = new List<UnityEngine.Component>();
		pv.ObservedComponents.Add(pv.GetComponent<RemoteLure>());
		pv.Synchronization = ViewSynchronization.UnreliableOnChange;
		pv.GetComponent<RemoteLure>().ShowLure((int)array[1]);
		lureViews.Add(pv);
		MonoBehaviour.print("InstantiateRemoteLure 들어옴");
		pv.GetComponent<RemoteLure>().positionIndex = photonView.GetComponent<RemoteAvatar>().positionIndex;
	}

	public void InstantiateRemoteFish(EventData photonEvent)
	{
		object[] array = (object[])photonEvent.CustomData;
		GameObject gameObject = UnityEngine.Object.Instantiate(remoteFishPrefab, Vector3.zero, Quaternion.identity);
		PhotonView pv = gameObject.AddComponent<PhotonView>();
		pv.ViewID = (int)array[0];
		PhotonView photonView = avatarViews.Where((PhotonView s) => s.Owner == pv.Owner).FirstOrDefault();
		pv.GetComponent<RemoteFish>().positionIndex = photonView.GetComponent<RemoteAvatar>().positionIndex;
		pv.ObservedComponents = new List<UnityEngine.Component>();
		pv.ObservedComponents.Add(pv.GetComponent<RemoteFish>());
		pv.Synchronization = ViewSynchronization.UnreliableOnChange;
		pv.GetComponent<RemoteFish>().ShowFish((int)array[1]);
		fishViews.Add(pv);
		MonoBehaviour.print("InstantiateRemoteFish 들어옴");
	}

	public void InstantiateRemoteTackle(EventData photonEvent)
	{
		object[] array = (object[])photonEvent.CustomData;
		int viewID = (int)array[0];
		bool flag = (bool)array[1];
		bool isBothHand = (bool)array[2];
		int num = (int)array[3];
		int rodID = (int)array[4];
		int reelID = (int)array[5];
		if (tackleViews.Where((PhotonView s) => s.ViewID == viewID).FirstOrDefault() != null)
		{
			return;
		}
		GameObject gameObject = UnityEngine.Object.Instantiate(remoteTacklePrefab, Vector3.zero, Quaternion.identity);
		gameObject.GetComponent<RemoteTackle>().rodID = rodID;
		gameObject.GetComponent<RemoteTackle>().reelID = reelID;
		gameObject.GetComponent<RemoteTackle>().isRightHand = flag;
		gameObject.GetComponent<RemoteTackle>().isBothHand = isBothHand;
		PhotonView pv = gameObject.AddComponent<PhotonView>();
		pv.ViewID = viewID;
		pv.ObservedComponents = new List<UnityEngine.Component>();
		pv.ObservedComponents.Add(pv.GetComponent<RemoteTackle>());
		pv.Synchronization = ViewSynchronization.UnreliableOnChange;
		PhotonView photonView = lureViews.Where((PhotonView s) => s.Owner == pv.Owner).FirstOrDefault();
		if (photonView != null)
		{
			gameObject.GetComponent<RemoteTackle>().lureTransform = photonView.transform;
		}
		PhotonView photonView2 = avatarViews.Where((PhotonView s) => s.Owner == pv.Owner).FirstOrDefault();
		if (photonView2 != null)
		{
			if (flag)
			{
				gameObject.transform.SetParent(photonView2.gameObject.GetComponent<RemoteAvatar>().rightHand);
			}
			else
			{
				gameObject.transform.SetParent(photonView2.gameObject.GetComponent<RemoteAvatar>().leftHand);
			}
			gameObject.transform.localPosition = Vector3.zero;
			gameObject.transform.localEulerAngles = Vector3.zero;
		}
		gameObject.GetComponent<RemoteTackle>().InitTackle(flag, num == 0);
		pv.GetComponent<RemoteTackle>().positionIndex = photonView2.GetComponent<RemoteAvatar>().positionIndex;
		tackleViews.Add(pv);
		MonoBehaviour.print("InstantiateRemoteTackle 들어옴");
	}

	public override void OnDisconnected(DisconnectCause cause)
	{
		base.OnDisconnected(cause);
		UnityEngine.Debug.Log("PhotonNetwork is Disconnected! caused by " + cause);
		switch (cause)
		{
		case DisconnectCause.ClientTimeout:
			if (main != null && main.scene == SceneState.LOBBY && main.multiplayUIManager.gameObject.activeSelf)
			{
				MonoBehaviour.print("Disconnected by ClientTimeout");
				main.multiplayUIManager.HideAllPanel();
				main.lobbyUIManager.SelectMenu(0);
			}
			Singleton<NotificationManager>.Instance.ShowDisconnect();
			break;
		case DisconnectCause.ServerTimeout:
			if (main != null && main.scene == SceneState.LOBBY && main.multiplayUIManager.gameObject.activeSelf)
			{
				MonoBehaviour.print("Disconnected by ClientTimeout");
				main.multiplayUIManager.HideAllPanel();
				main.lobbyUIManager.SelectMenu(0);
			}
			break;
		case DisconnectCause.AuthenticationTicketExpired:
			MonoBehaviour.print("Disconnected by AuthenticationTicketExpired");
			break;
		case DisconnectCause.ExceptionOnConnect:
			MonoBehaviour.print("Disconnected by ExceptionOnConnect");
			break;
		}
	}

	public void TransitionToState(VoipState newState)
	{
		UnityEngine.Debug.LogFormat("State {0} -> {1}", currentState, newState);
		if (currentState != newState)
		{
			currentState = newState;
			_ = 6;
		}
	}

	public static VoipRemoteUser GetRemoteUser(ulong userID)
	{
		VoipRemoteUser value = new VoipRemoteUser();
		if (Instance.remoteUsers.TryGetValue(userID, out value))
		{
			return value;
		}
		return null;
	}

	public static void RemoveVoipRemoteUser(ulong userID)
	{
		VoipRemoteUser value = new VoipRemoteUser();
		if (Instance.remoteUsers.TryGetValue(userID, out value))
		{
			Instance.remoteUsers.Remove(userID);
			Voip.Stop(userID);
			MonoBehaviour.print("Removing User " + userID);
		}
	}

	public int GetPositionIndex(Player player)
	{
		PhotonView photonView = avatarViews.Where((PhotonView s) => s.Owner == player).FirstOrDefault();
		if (photonView != null)
		{
			return photonView.GetComponent<RemoteAvatar>().positionIndex;
		}
		return -1;
	}

	public void KickUser(Player kickPlayer)
	{
		if (PhotonNetwork.IsMasterClient)
		{
			PhotonNetwork.CloseConnection(kickPlayer);
		}
	}

	public override void OnPlayerPropertiesUpdate(Player targetPlayer, ExitGames.Client.Photon.Hashtable changedProps)
	{
		if (targetPlayer != PhotonNetwork.LocalPlayer && main != null && main.scene == SceneState.STAGE && changedProps["scene"] != null && changedProps["scene"].ToString() == "stage")
		{
			if (localFish.pv != null)
			{
				MultiplayEventManager.Instance.SendInstantiationFishEvent(targetPlayer.ActorNumber, localFish.fishID);
			}
			MultiplayEventManager.Instance.SendFishCurrentState(targetPlayer.ActorNumber);
		}
	}
}
public class MultiplayPasswordUIManager : MonoBehaviour
{
	public RoomInfo roomInfo;

	public InputField passwordInputfield;

	public Text incorrectText;

	[HideInInspector]
	public InputField selectedInputField;

	private void OnEnable()
	{
		RegisterKeyboardEvent();
		incorrectText.gameObject.SetActive(value: false);
	}

	private void OnDisable()
	{
		RemoveKeyboardEvent();
		passwordInputfield.text = "";
		base.gameObject.SetActive(value: false);
	}

	private void Start()
	{
	}

	private void Update()
	{
	}

	public void Confirm()
	{
		Singleton<Main>.Instance.multiplayUIManager.JoinRoomByPassword(roomInfo, passwordInputfield.text);
		base.gameObject.SetActive(value: false);
	}

	public void Cancel()
	{
		base.gameObject.SetActive(value: false);
	}

	public void ShowKeyboardEvent()
	{
		selectedInputField = passwordInputfield;
		incorrectText.gameObject.SetActive(value: false);
		if (!Singleton<Main>.Instance.isMenuOn)
		{
			Singleton<Console>.Instance.ShowConsole();
		}
		Singleton<Console>.Instance.ClickMenu(-1);
		Singleton<Console>.Instance.ShowKeyboard();
	}

	private void RegisterKeyboardEvent()
	{
		Singleton<Console>.Instance.keyboard.KeyboardReceiveEvent.AddListener(KeyboardEvent);
	}

	private void RemoveKeyboardEvent()
	{
		Singleton<Console>.Instance.keyboard.KeyboardReceiveEvent.RemoveListener(KeyboardEvent);
	}

	private void KeyboardEvent(string s)
	{
		if (selectedInputField != null && selectedInputField.IsActive())
		{
			if (s == "Backspace")
			{
				BackspaceInputField();
			}
			else if (!(s == "Enter"))
			{
				selectedInputField.text += s;
			}
		}
	}

	private void BackspaceInputField()
	{
		if (selectedInputField.text.Length > 0)
		{
			string text = selectedInputField.text.Remove(selectedInputField.text.Length - 1, 1);
			selectedInputField.text = text;
		}
	}

	public void ShowCaution()
	{
		incorrectText.gameObject.SetActive(value: true);
	}
}
public class MultiplayRoomOption : MonoBehaviour
{
	public InputField roomNameInputField;

	public InputField passwordInputField;

	public Toggle voiceChatToggle;

	public Text maxPlayerText;

	public int maxPlayer = 4;

	[HideInInspector]
	public InputField selectedInputField;

	private void Start()
	{
		roomNameInputField.text = PhotonNetwork.LocalPlayer.NickName + "'s Room";
	}

	private void Update()
	{
	}

	private void OnEnable()
	{
		RegisterKeyboardEvent();
	}

	private void OnDisable()
	{
		RemoveKeyboardEvent();
		passwordInputField.text = "";
		base.gameObject.SetActive(value: false);
	}

	public void Cancel()
	{
		base.gameObject.SetActive(value: false);
	}

	public void Confrim()
	{
		Singleton<Main>.Instance.multiplayUIManager.PopUpCreatingRoom(show: true);
		MultiplayManager.Instance.CreateRoom(roomNameInputField.text, passwordInputField.text, maxPlayer, voiceChatToggle.isOn);
		base.gameObject.SetActive(value: false);
	}

	public void LeftButtonEvent()
	{
		if (maxPlayer > 2)
		{
			maxPlayer--;
			maxPlayerText.text = maxPlayer.ToString();
		}
	}

	public void RightButtonEvent()
	{
		if (maxPlayer < 4)
		{
			maxPlayer++;
			maxPlayerText.text = maxPlayer.ToString();
		}
	}

	public void ShowKeyboardEvent(int select)
	{
		if (select == 0)
		{
			selectedInputField = roomNameInputField;
		}
		else
		{
			selectedInputField = passwordInputField;
		}
		if (!Singleton<Main>.Instance.isMenuOn)
		{
			Singleton<Console>.Instance.ShowConsole();
		}
		Singleton<Console>.Instance.ClickMenu(-1);
		Singleton<Console>.Instance.ShowKeyboard();
	}

	private void RegisterKeyboardEvent()
	{
		Singleton<Console>.Instance.keyboard.KeyboardReceiveEvent.AddListener(KeyboardEvent);
	}

	private void RemoveKeyboardEvent()
	{
		Singleton<Console>.Instance.keyboard.KeyboardReceiveEvent.RemoveListener(KeyboardEvent);
	}

	private void KeyboardEvent(string s)
	{
		if (selectedInputField != null && selectedInputField.IsActive())
		{
			if (s == "Backspace")
			{
				BackspaceInputField();
			}
			else if (!(s == "Enter"))
			{
				selectedInputField.text += s;
			}
		}
	}

	private void BackspaceInputField()
	{
		if (selectedInputField.text.Length > 0)
		{
			string text = selectedInputField.text.Remove(selectedInputField.text.Length - 1, 1);
			selectedInputField.text = text;
		}
	}
}
public class MultiplayUIConsole : MonoBehaviourPunCallbacks
{
	private enum OptionType
	{
		USERINFO,
		VOICECHAT
	}

	public Text roomName;

	public GameObject playerCellPrefab;

	public GameObject playerList;

	[Header("Tabs")]
	public GameObject[] tabs;

	public Color selectedColor;

	public Color unSelectedColor;

	[Header("Panels")]
	public GameObject[] panels;

	public GameObject panel_NotConnected;

	[Header("Options")]
	public Button toggle_userInfo;

	public Button toggle_pushToTalk;

	public Sprite[] images_Toggle;

	public bool isUserInfoOn = true;

	public bool isPushToTalkOn;

	public GameObject panel_PushToTalkInfo;

	private MultiplayManager multiplayManager;

	private void Awake()
	{
		multiplayManager = MultiplayManager.Instance;
	}

	public override void OnEnable()
	{
		base.OnEnable();
		if (PhotonNetwork.IsConnectedAndReady)
		{
			if (panel_NotConnected.activeSelf)
			{
				panel_NotConnected.SetActive(value: false);
			}
			SwitchToggle(Singleton<DataManager>.Instance.userData.isUserInfoVisible, OptionType.USERINFO);
			SwitchToggle(Singleton<DataManager>.Instance.userData.isPushToTalk, OptionType.VOICECHAT);
			if (PhotonNetwork.InRoom)
			{
				EnableTabs(enabled: true, new List<int> { 0 });
				SelectTabEvent(1);
				DisplayRoomName();
			}
			else
			{
				EnableTabs(enabled: true);
				tabs[1].GetComponent<Button>().interactable = false;
				SelectTabEvent(0);
			}
		}
		else
		{
			EnableTabs(enabled: false);
			panel_NotConnected.SetActive(value: true);
		}
	}

	public override void OnDisable()
	{
		base.OnDisable();
	}

	private void EnableTabs(bool enabled, List<int> exceptionIndex = null)
	{
		for (int i = 0; i < tabs.Length; i++)
		{
			if (exceptionIndex != null)
			{
				if (!exceptionIndex.Contains(i))
				{
					tabs[i].GetComponent<Button>().interactable = enabled;
				}
				else
				{
					tabs[i].GetComponent<Button>().interactable = false;
				}
			}
			else
			{
				tabs[i].GetComponent<Button>().interactable = enabled;
			}
		}
	}

	private void DisplayRoomName()
	{
		roomName.text = PhotonNetwork.CurrentRoom.CustomProperties["nickName"].ToString() + " ROOM";
	}

	public void ExitRoomEvent()
	{
		multiplayManager.ExitRoom();
		staticLoading.Stage = "Lobby";
		SceneManager.LoadScene("Loading");
	}

	public void SelectTabEvent(int index)
	{
		for (int i = 0; i < panels.Length; i++)
		{
			if (i == index)
			{
				panels[i].SetActive(value: true);
				tabs[i].GetComponent<Image>().color = selectedColor;
			}
			else
			{
				panels[i].SetActive(value: false);
				tabs[i].GetComponent<Image>().color = unSelectedColor;
			}
		}
	}

	public void UserInfoToggleEvent()
	{
		isUserInfoOn = !isUserInfoOn;
		SwitchToggle(isUserInfoOn, OptionType.USERINFO);
	}

	private void SwitchToggle(bool isOn, OptionType optionType)
	{
		switch (optionType)
		{
		case OptionType.USERINFO:
			if (isOn)
			{
				toggle_userInfo.GetComponent<Image>().sprite = images_Toggle[1];
			}
			else
			{
				toggle_userInfo.GetComponent<Image>().sprite = images_Toggle[0];
			}
			TurnOnUserInfo(isOn);
			Singleton<DataManager>.Instance.userData.isUserInfoVisible = isOn;
			break;
		case OptionType.VOICECHAT:
			if (isOn)
			{
				isPushToTalkOn = true;
				toggle_pushToTalk.GetComponent<Image>().sprite = images_Toggle[1];
				Voip.SetMicrophoneMuted(VoipMuteState.Muted);
			}
			else
			{
				isPushToTalkOn = false;
				toggle_pushToTalk.GetComponent<Image>().sprite = images_Toggle[0];
				Voip.SetMicrophoneMuted(VoipMuteState.Unmuted);
			}
			Singleton<DataManager>.Instance.userData.isPushToTalk = isPushToTalkOn;
			break;
		}
		Singleton<DataManager>.Instance.Save();
	}

	private void TurnOnUserInfo(bool turnOn)
	{
		foreach (PhotonView avatarView in multiplayManager.avatarViews)
		{
			if (turnOn)
			{
				avatarView.GetComponent<RemoteAvatar>().DisplayUserInfo();
				avatarView.GetComponent<RemoteAvatar>().DisplayPlayInfo();
			}
			else
			{
				avatarView.GetComponent<RemoteAvatar>().HideUserInfo();
			}
		}
	}

	public void PushToTalkToggleEvent()
	{
		isPushToTalkOn = !isPushToTalkOn;
		SwitchToggle(isPushToTalkOn, OptionType.VOICECHAT);
	}

	public void ShowPushToTalkInfoPanelEvent()
	{
		if (!panel_PushToTalkInfo.activeSelf)
		{
			panel_PushToTalkInfo.SetActive(value: true);
		}
	}

	public void HidePushToTalkInfoPanelEvent()
	{
		if (panel_PushToTalkInfo.activeSelf)
		{
			panel_PushToTalkInfo.SetActive(value: false);
		}
	}
}
public class MultiplayUIManager : MonoBehaviourPunCallbacks
{
	private MultiplayManager multiplayManager;

	public GameObject caution;

	[Header("Panels")]
	public GameObject panel_MultiplayEntry;

	public GameObject panel_Password;

	public GameObject panel_RoomProperty;

	public GameObject panel_MyRoom;

	public MultiplayAlertPopup panel_Alert;

	[Header("TVUIMenus")]
	public Button[] disableMenus;

	[Header("RoomList")]
	public GameObject roomElementPrefab;

	public GameObject roomList;

	[Header("PlayerList")]
	public GameObject playerElementPrefab;

	public GameObject playerList;

	[HideInInspector]
	public PlayerListDisplay playerListDisplay;

	[Header("StageList")]
	public StageListDisplay stageListDisplay;

	public override void OnEnable()
	{
		base.OnEnable();
		HideAllPanel();
		OnlineCheck.Check(delegate(bool isConnected, NetworkReachability b)
		{
			if (isConnected && caution != null)
			{
				caution.SetActive(value: false);
				if (!PhotonNetwork.IsConnected && PhotonNetwork.NetworkClientState != ClientState.ConnectingToMasterServer)
				{
					PopUpConnecting(show: true);
					MultiplayManager.Instance.ConnectToPhoton();
				}
				else if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
				{
					DisplayMyRoomPanel();
					EnableUIMenus(enable: false);
				}
				else
				{
					DisplayMultiplayEntry();
					if (PhotonNetwork.InLobby)
					{
						PhotonNetwork.LeaveLobby();
					}
				}
			}
			else if (caution != null)
			{
				caution.SetActive(value: true);
			}
		});
	}

	public override void OnDisable()
	{
		base.OnDisable();
	}

	private void Start()
	{
		multiplayManager = MultiplayManager.Instance;
		playerListDisplay = playerList.GetComponent<PlayerListDisplay>();
	}

	public void SelectMultiplayMode(int modeIndex)
	{
		switch (modeIndex)
		{
		case 0:
			JoinLobby();
			break;
		case 1:
		case 2:
			break;
		}
	}

	public void JoinLobby()
	{
		multiplayManager.JoinLobby();
	}

	public void DisplayMultiplayEntry()
	{
		panel_MultiplayEntry.SetActive(value: true);
		if (panel_MyRoom.activeSelf)
		{
			panel_MyRoom.SetActive(value: false);
		}
	}

	public void DisplayRoomListPanel()
	{
		if (panel_MultiplayEntry.activeSelf)
		{
			panel_MultiplayEntry.SetActive(value: false);
		}
		if (panel_MyRoom.activeSelf)
		{
			panel_MyRoom.SetActive(value: false);
		}
	}

	public void CreateRoomEvent()
	{
		panel_RoomProperty.SetActive(value: true);
	}

	public void DisplayMyRoomPanel()
	{
		panel_MyRoom.SetActive(value: true);
		panel_MultiplayEntry.SetActive(value: false);
	}

	public void DisplayPasswordPanel()
	{
		panel_Password.SetActive(value: true);
	}

	public void ExitRoomEvent()
	{
		HideAllPanel();
		Singleton<Main>.Instance.lobbyUIManager.SelectMenu(0);
		EnableUIMenus(enable: true);
		multiplayManager.ExitRoom();
	}

	public void HideAllPanel()
	{
		panel_MultiplayEntry.SetActive(value: false);
		panel_Password.SetActive(value: false);
		panel_RoomProperty.SetActive(value: false);
		panel_MyRoom.SetActive(value: false);
		panel_Alert.gameObject.SetActive(value: false);
	}

	public void EnableUIMenus(bool enable)
	{
		for (int i = 0; i < disableMenus.Length; i++)
		{
			disableMenus[i].interactable = enable;
		}
	}

	public void PopUpConnecting(bool show)
	{
		if (show)
		{
			panel_Alert.gameObject.SetActive(value: true);
			panel_Alert.Show(Alert.CONNECTING);
		}
		else
		{
			panel_Alert.Hide();
		}
	}

	public void PopUpCreatingRoom(bool show)
	{
		if (show)
		{
			panel_Alert.gameObject.SetActive(value: true);
			panel_Alert.Show(Alert.CREATING_ROOM);
		}
		else
		{
			panel_Alert.Hide();
		}
	}

	public void PopUpJoiningRoom(bool show)
	{
		if (show)
		{
			panel_Alert.gameObject.SetActive(value: true);
			panel_Alert.Show(Alert.JOINING_ROOM);
		}
		else
		{
			panel_Alert.Hide();
		}
	}

	public void JoinRoomByPassword(RoomInfo roomInfo, string password)
	{
		string roomName = "";
		if (roomInfo.CustomProperties["roomName"] != null && !string.IsNullOrEmpty(roomInfo.CustomProperties["roomName"].ToString()))
		{
			roomName = roomInfo.CustomProperties["roomName"].ToString() + "_" + password;
		}
		HideAllPanel();
		PopUpJoiningRoom(show: true);
		PhotonNetwork.JoinRoom(roomName);
	}

	public override void OnJoinRoomFailed(short returnCode, string message)
	{
		base.OnJoinRoomFailed(returnCode, message);
		if (!panel_Password.activeSelf)
		{
			PopUpJoiningRoom(show: false);
			DisplayPasswordPanel();
			panel_Password.GetComponent<MultiplayPasswordUIManager>().ShowCaution();
		}
	}

	public override void OnConnectedToMaster()
	{
		PopUpConnecting(show: false);
		DisplayMultiplayEntry();
		EnableUIMenus(enable: true);
	}

	public override void OnDisconnected(DisconnectCause cause)
	{
		EnableUIMenus(enable: true);
	}

	public override void OnJoinedLobby()
	{
		base.OnJoinedLobby();
		MonoBehaviour.print("You enetered Lobby");
		EnableUIMenus(enable: true);
	}

	public override void OnCreatedRoom()
	{
		MonoBehaviour.print("Room Created");
		PopUpCreatingRoom(show: false);
	}

	public override void OnJoinedRoom()
	{
		PopUpJoiningRoom(show: false);
		DisplayMyRoomPanel();
		EnableUIMenus(enable: false);
	}

	public override void OnMasterClientSwitched(Player newMasterClient)
	{
		stageListDisplay.DisplayStageList();
	}
}
public class MyRoomUIManager : MonoBehaviourPunCallbacks
{
	[Header("Panel_Title")]
	public Text roomName;

	[Header("Panel_RoomProperties")]
	public Text roomNameText;

	public Text passwordText;

	public Text text_maxPlayer;

	public Toggle voiceChatToggle;

	public override void OnEnable()
	{
		base.OnEnable();
		roomName.text = PhotonNetwork.CurrentRoom.CustomProperties["nickName"].ToString() + " ROOM";
		roomNameText.text = PhotonNetwork.CurrentRoom.CustomProperties["displayName"].ToString();
		passwordText.text = PhotonNetwork.CurrentRoom.CustomProperties["password"].ToString();
		text_maxPlayer.text = PhotonNetwork.CurrentRoom.MaxPlayers.ToString();
		voiceChatToggle.isOn = (bool)PhotonNetwork.CurrentRoom.CustomProperties["voiceChat"];
	}

	public override void OnDisable()
	{
		base.OnDisable();
	}

	public override void OnRoomPropertiesUpdate(ExitGames.Client.Photon.Hashtable propertiesThatChanged)
	{
		base.OnRoomPropertiesUpdate(propertiesThatChanged);
		roomName.text = PhotonNetwork.CurrentRoom.CustomProperties["nickName"].ToString() + " ROOM";
		roomNameText.text = PhotonNetwork.CurrentRoom.CustomProperties["displayName"].ToString();
		passwordText.text = PhotonNetwork.CurrentRoom.CustomProperties["password"].ToString();
		text_maxPlayer.text = PhotonNetwork.CurrentRoom.MaxPlayers.ToString();
		voiceChatToggle.isOn = (bool)PhotonNetwork.CurrentRoom.CustomProperties["voiceChat"];
	}
}
public class NotificationController : MonoBehaviour
{
	public Text title;

	public Text Content;

	private void Start()
	{
	}

	private void Update()
	{
	}
}
public class PlayerCell : MonoBehaviour
{
	public GameObject image_Host;

	public Text playerName;

	public Button button_Mute;

	public Image mute;

	public List<Sprite> toggleImages;

	public Button button_KickOut;

	public Button button_AddFriend;

	[HideInInspector]
	public string userId;

	public Player player;

	private bool On = true;

	public void AddFriend()
	{
		UnityEngine.Debug.Log("Add Friend with ID = " + userId);
		Users.LaunchFriendRequestFlow(Convert.ToUInt64(userId)).OnComplete(delegate(Message<LaunchFriendRequestFlowResult> s)
		{
			UnityEngine.Debug.Log("is message sent? " + s.Data.DidSendRequest);
		});
	}

	public void ToggleEvent()
	{
		On = !On;
		SetToggle(On);
	}

	public void SetToggle(bool value)
	{
		if (value)
		{
			On = true;
			mute.sprite = toggleImages[1];
			UnMute();
		}
		else
		{
			On = false;
			mute.sprite = toggleImages[0];
			Mute();
		}
	}

	public void Mute()
	{
		if (player.IsLocal)
		{
			if (MultiplayManager.Instance != null)
			{
				MultiplayManager.Instance.voipManager.Mute();
			}
			return;
		}
		PhotonView photonView = MultiplayManager.Instance.avatarViews.Where((PhotonView s) => s.Owner == player).FirstOrDefault();
		if (photonView != null && photonView.gameObject.GetComponent<AudioSource>() != null)
		{
			photonView.gameObject.GetComponent<AudioSource>().mute = true;
		}
	}

	public void UnMute()
	{
		if (player.IsLocal)
		{
			if (MultiplayManager.Instance != null)
			{
				MultiplayManager.Instance.voipManager.UnMute();
			}
			return;
		}
		PhotonView photonView = MultiplayManager.Instance.avatarViews.Where((PhotonView s) => s.Owner == player).FirstOrDefault();
		if (photonView != null && photonView.gameObject.GetComponent<AudioSource>() != null)
		{
			photonView.gameObject.GetComponent<AudioSource>().mute = false;
		}
	}

	public void KickOutEvent()
	{
		button_KickOut.interactable = false;
		MultiplayEventManager.Instance.SendKickMessage(player.ActorNumber);
	}

	public void TurnOffAddFriend()
	{
		button_AddFriend.gameObject.SetActive(value: false);
	}
}
public class PlayerElement : MonoBehaviour
{
	public Image icon;

	public Text playerName;

	public Image mute;

	public Button kick;

	public Player player;

	public List<Sprite> icons;

	public List<Sprite> toggleImages;

	private bool On = true;

	public void Kick()
	{
		MultiplayEventManager.Instance.SendKickMessage(player.ActorNumber);
	}

	public void Mute()
	{
		if (player.IsLocal)
		{
			if (MultiplayManager.Instance != null)
			{
				MultiplayManager.Instance.voipManager.Mute();
			}
			return;
		}
		PhotonView photonView = MultiplayManager.Instance.avatarViews.Where((PhotonView s) => s.Owner == player).FirstOrDefault();
		if (photonView != null && photonView.gameObject.GetComponent<AudioSource>() != null)
		{
			photonView.gameObject.GetComponent<AudioSource>().mute = true;
		}
	}

	public void UnMute()
	{
		if (player.IsLocal)
		{
			if (MultiplayManager.Instance != null)
			{
				if (Singleton<DataManager>.Instance.userData.isPushToTalk)
				{
					MultiplayManager.Instance.voipManager.Mute();
				}
				else
				{
					MultiplayManager.Instance.voipManager.UnMute();
				}
			}
		}
		else
		{
			PhotonView photonView = MultiplayManager.Instance.avatarViews.Where((PhotonView s) => s.Owner == player).FirstOrDefault();
			if (photonView != null && photonView.gameObject.GetComponent<AudioSource>() != null)
			{
				photonView.gameObject.GetComponent<AudioSource>().mute = false;
			}
		}
	}

	public void ShowIcon()
	{
		if (PhotonNetwork.IsMasterClient)
		{
			if (player.IsMasterClient)
			{
				icon.enabled = true;
				icon.sprite = icons[0];
				kick.gameObject.SetActive(value: false);
			}
			else
			{
				icon.enabled = false;
				kick.gameObject.SetActive(value: true);
			}
		}
		else if (player.IsMasterClient)
		{
			icon.enabled = true;
			kick.gameObject.SetActive(value: false);
		}
		else
		{
			icon.enabled = false;
			kick.gameObject.SetActive(value: false);
		}
	}

	public void SetToggle(bool value)
	{
		if (value)
		{
			On = true;
			mute.sprite = toggleImages[1];
			UnMute();
		}
		else
		{
			On = false;
			mute.sprite = toggleImages[0];
			Mute();
		}
	}

	public void ToggleEvent()
	{
		On = !On;
		SetToggle(On);
	}
}
public class PlayerListConsole : MonoBehaviourPunCallbacks
{
	public MultiplayUIConsole multiplayUIConsole;

	private List<ulong> friendIds = new List<ulong>();

	private Dictionary<int, PlayerCell> playerCellList = new Dictionary<int, PlayerCell>();

	private bool isChangingList;

	public override void OnEnable()
	{
		base.OnEnable();
		if (PhotonNetwork.CurrentRoom != null)
		{
			GetFriends();
		}
	}

	public override void OnDisable()
	{
		base.OnDisable();
		friendIds.Clear();
	}

	public void GetFriends()
	{
		Users.GetLoggedInUserFriends().OnComplete(delegate(Message<UserList> s)
		{
			if (!s.IsError)
			{
				if (s.GetUserList().Count > 0)
				{
					foreach (User datum in s.Data)
					{
						friendIds.Add(datum.ID);
					}
				}
				UpdatePlayerList();
			}
		});
	}

	private void UpdatePlayerList()
	{
		isChangingList = true;
		KeyValuePair<int, Player> keyValuePair = PhotonNetwork.CurrentRoom.Players.Where((KeyValuePair<int, Player> s) => s.Value.IsMasterClient).FirstOrDefault();
		if (keyValuePair.Value != null)
		{
			if (!playerCellList.ContainsKey(keyValuePair.Key))
			{
				PlayerCell component = UnityEngine.Object.Instantiate(multiplayUIConsole.playerCellPrefab, base.transform).GetComponent<PlayerCell>();
				playerCellList[keyValuePair.Key] = component;
				component.userId = keyValuePair.Value.UserId;
				component.playerName.text = keyValuePair.Value.NickName;
				component.player = keyValuePair.Value;
			}
			playerCellList[keyValuePair.Key].gameObject.transform.SetAsFirstSibling();
			if (!playerCellList[keyValuePair.Key].image_Host.activeSelf)
			{
				playerCellList[keyValuePair.Key].image_Host.SetActive(value: true);
			}
			if (playerCellList[keyValuePair.Key].button_KickOut.gameObject.activeSelf)
			{
				playerCellList[keyValuePair.Key].button_KickOut.gameObject.SetActive(value: false);
			}
			if (friendIds.Contains(ulong.Parse(keyValuePair.Value.UserId)) || keyValuePair.Value == PhotonNetwork.LocalPlayer)
			{
				playerCellList[keyValuePair.Key].TurnOffAddFriend();
			}
		}
		foreach (KeyValuePair<int, Player> player in PhotonNetwork.CurrentRoom.Players)
		{
			if (!player.Value.IsMasterClient && !playerCellList.ContainsKey(player.Key))
			{
				PlayerCell component2 = UnityEngine.Object.Instantiate(multiplayUIConsole.playerCellPrefab, base.transform).GetComponent<PlayerCell>();
				playerCellList[player.Key] = component2;
				component2.userId = player.Value.UserId;
				component2.playerName.text = player.Value.NickName;
				component2.player = player.Value;
				component2.image_Host.SetActive(value: false);
				if (PhotonNetwork.LocalPlayer.IsMasterClient)
				{
					component2.button_KickOut.gameObject.SetActive(value: true);
				}
				else
				{
					component2.button_KickOut.gameObject.SetActive(value: false);
				}
				if (friendIds.Contains(ulong.Parse(player.Value.UserId)) || player.Value == PhotonNetwork.LocalPlayer)
				{
					playerCellList[player.Key].TurnOffAddFriend();
				}
			}
		}
		IEnumerable<KeyValuePair<int, PlayerCell>> enumerable = playerCellList.Where((KeyValuePair<int, PlayerCell> s) => !PhotonNetwork.CurrentRoom.Players.ContainsKey(s.Key));
		List<int> list = new List<int>();
		foreach (KeyValuePair<int, PlayerCell> item in enumerable)
		{
			UnityEngine.Object.Destroy(item.Value.gameObject);
			list.Add(item.Key);
		}
		foreach (int item2 in list)
		{
			playerCellList.Remove(item2);
		}
		list = null;
		isChangingList = false;
	}

	public void ResetList()
	{
		foreach (KeyValuePair<int, PlayerCell> playerCell in playerCellList)
		{
			if (playerCell.Value != null)
			{
				UnityEngine.Object.Destroy(playerCell.Value.gameObject);
			}
		}
		playerCellList.Clear();
	}

	public override void OnPlayerEnteredRoom(Player newPlayer)
	{
		UpdatePlayerList();
	}

	public override void OnPlayerLeftRoom(Player otherPlayer)
	{
		UpdatePlayerList();
	}

	public override void OnMasterClientSwitched(Player newMasterClient)
	{
		if (!isChangingList)
		{
			UpdatePlayerList();
		}
	}

	public override void OnLeftRoom()
	{
		base.OnLeftRoom();
		ResetList();
	}
}
public class PlayerListDisplay : MonoBehaviourPunCallbacks
{
	public MultiplayUIManager multiplayUIManager;

	public Dictionary<int, PlayerElement> playerElementList = new Dictionary<int, PlayerElement>();

	public override void OnEnable()
	{
		base.OnEnable();
		if (PhotonNetwork.CurrentRoom != null)
		{
			UpdateMultiplayerList();
		}
	}

	public override void OnDisable()
	{
		base.OnDisable();
		ResetList();
	}

	private void UpdateMultiplayerList()
	{
		KeyValuePair<int, Player> keyValuePair = PhotonNetwork.CurrentRoom.Players.Where((KeyValuePair<int, Player> s) => s.Value.IsMasterClient).FirstOrDefault();
		if (keyValuePair.Value != null)
		{
			if (playerElementList.ContainsKey(keyValuePair.Key))
			{
				return;
			}
			PlayerElement component = UnityEngine.Object.Instantiate(multiplayUIManager.playerElementPrefab, base.transform).GetComponent<PlayerElement>();
			component.player = keyValuePair.Value;
			playerElementList[keyValuePair.Key] = component;
			component.playerName.text = keyValuePair.Value.NickName;
			component.ShowIcon();
			UnityEngine.Debug.Log("Master playerelementPrefab instantiated");
		}
		foreach (KeyValuePair<int, Player> player in PhotonNetwork.CurrentRoom.Players)
		{
			if (!player.Value.IsMasterClient && !playerElementList.ContainsKey(player.Key))
			{
				PlayerElement component2 = UnityEngine.Object.Instantiate(multiplayUIManager.playerElementPrefab, base.transform).GetComponent<PlayerElement>();
				component2.player = player.Value;
				playerElementList[player.Key] = component2;
				component2.playerName.text = player.Value.NickName;
				component2.ShowIcon();
				UnityEngine.Debug.Log("playerelementPrefab instantiated");
			}
		}
		if (PhotonNetwork.CurrentRoom.CustomProperties["voiceChat"] == null)
		{
			return;
		}
		bool toggle = (bool)PhotonNetwork.CurrentRoom.CustomProperties["voiceChat"];
		foreach (KeyValuePair<int, PlayerElement> playerElement in multiplayUIManager.playerListDisplay.playerElementList)
		{
			playerElement.Value.SetToggle(toggle);
		}
	}

	public override void OnPlayerEnteredRoom(Player newPlayer)
	{
		MonoBehaviour.print(newPlayer.UserId + " has entered the room");
		if (!playerElementList.ContainsKey(newPlayer.ActorNumber))
		{
			playerElementList[newPlayer.ActorNumber] = UnityEngine.Object.Instantiate(multiplayUIManager.playerElementPrefab, base.transform).GetComponent<PlayerElement>();
			playerElementList[newPlayer.ActorNumber].playerName.text = newPlayer.NickName;
			playerElementList[newPlayer.ActorNumber].player = newPlayer;
			playerElementList[newPlayer.ActorNumber].ShowIcon();
		}
	}

	public override void OnPlayerLeftRoom(Player otherPlayer)
	{
		MonoBehaviour.print(otherPlayer.NickName + " has left the room");
		if (!PhotonNetwork.PlayerListOthers.Contains(otherPlayer))
		{
			UnityEngine.Object.Destroy(playerElementList[otherPlayer.ActorNumber].gameObject);
			playerElementList.Remove(otherPlayer.ActorNumber);
		}
	}

	public void ResetList()
	{
		foreach (KeyValuePair<int, PlayerElement> playerElement in playerElementList)
		{
			if (playerElement.Value != null)
			{
				UnityEngine.Object.Destroy(playerElement.Value.gameObject);
			}
		}
		playerElementList = new Dictionary<int, PlayerElement>();
	}

	public override void OnMasterClientSwitched(Player newMasterClient)
	{
		base.OnMasterClientSwitched(newMasterClient);
		foreach (KeyValuePair<int, PlayerElement> playerElement in playerElementList)
		{
			playerElement.Value.ShowIcon();
		}
	}
}
public enum CustomizingCategory
{
	GENDER,
	FACE,
	HAIR,
	MUSTACHE,
	EYEBROW,
	INNERFIT,
	OUTERFIT,
	HAT,
	GLASSES,
	GLOVES
}
public class RemoteAvatar : MonoBehaviourPunCallbacks, IPunObservable
{
	private enum Hand
	{
		LEFT,
		RIGHT
	}

	public ColorSetDatabase colorSet;

	private Main main;

	private DataManager dataManager;

	public AvatarController avatarController;

	public int positionIndex = -1;

	public Transform head;

	public Transform leftHand;

	public Transform rightHand;

	public RemoteHand leftHandControl;

	public RemoteHand rightHandControl;

	public GameObject smartPhone;

	private Vector3 photonHeadPos = new Vector3(0f, -200f, 0f);

	public Quaternion photonHeadRot;

	private Vector3 photonLeftHandPos = new Vector3(0f, -200f, 0f);

	public Quaternion photonLeftHandRot;

	private Vector3 photonRightHandPos = new Vector3(0f, -200f, 0f);

	public Quaternion photonRightHandRot;

	public Vector3 photonFishPos;

	public Quaternion photonFishRot;

	private Vector3 head_Direction;

	private Vector3 head_NetworkPosition;

	private Quaternion head_NetworkRotation;

	private float head_Distance;

	private float head_Angle;

	private bool head_FirstTake;

	private Vector3 rightHand_Direction;

	private Vector3 rightHand_NetworkPosition;

	private Quaternion rightHand_NetworkRotation;

	private float rightHand_Distance;

	private float rightHand_Angle;

	private bool rightHand_FirstTake;

	private Vector3 leftHand_Direction;

	private Vector3 leftHand_NetworkPosition;

	private Quaternion leftHand_NetworkRotation;

	private float leftHand_Distance;

	private float leftHand_Angle;

	private bool leftHand_FirstTake;

	private Vector3 dummyPos;

	private Quaternion dummyRot;

	public float speed = 0.5f;

	public Vector3 offset;

	public RemoteTackle remoteTackle;

	public RemoteLure remoteLure;

	private bool isBothHand = true;

	private bool isRightHand = true;

	public SkinnedMeshRenderer skinnedMeshRenderer;

	private float[] morphValues;

	[Header("UserInfo")]
	public GameObject userInfoPivot;

	public Canvas canvas_UserInfo;

	public Collider remoteAvatarCollider;

	public TextMeshProUGUI tmp_UserName;

	public GameObject hostImage;

	public TextMeshProUGUI tmp_PlayInfo;

	public float playInfoPeriod = 5f;

	public Color speakColor;

	public float speakingLimit = 0.9f;

	private Coroutine waitMainCoroutine;

	private void Awake()
	{
		main = Singleton<Main>.Instance;
		dataManager = Singleton<DataManager>.Instance;
		base.transform.position = new Vector3(0f, -200f, 0f);
		head_NetworkPosition = Vector3.zero;
		head_NetworkRotation = Quaternion.identity;
		leftHand_NetworkPosition = Vector3.zero;
		leftHand_NetworkRotation = Quaternion.identity;
		rightHand_NetworkPosition = Vector3.zero;
		rightHand_NetworkRotation = Quaternion.identity;
		UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
	}

	private void Start()
	{
		smartPhone = avatarController.smartphoneHead;
		FindOffset();
		SetUserInfo();
		InitPlayInfo();
	}

	public override void OnEnable()
	{
		base.OnEnable();
		head_FirstTake = true;
		leftHand_FirstTake = true;
		rightHand_FirstTake = true;
		SceneManager.sceneLoaded += OnSceneLoaded;
	}

	public override void OnDisable()
	{
		base.OnDisable();
		SceneManager.sceneLoaded -= OnSceneLoaded;
	}

	private void OnSceneLoaded(Scene scene, LoadSceneMode mode)
	{
		if (scene.name != "Loading")
		{
			waitMainCoroutine = StartCoroutine(waitMain());
		}
		else if (scene.name == "Loading")
		{
			head.position = new Vector3(0f, -200f, 0f);
			leftHand.position = new Vector3(0f, -200f, 0f);
			rightHand.position = new Vector3(0f, -200f, 0f);
		}
		smartPhoneSet(0);
	}

	private IEnumerator waitMain()
	{
		while (Singleton<Main>.Instance == null)
		{
			yield return null;
		}
		main = Singleton<Main>.Instance;
		if (main.scene == SceneState.LOBBY)
		{
			positionIndex = base.photonView.Owner.GetPlayerNumber();
			offset = Vector3.zero;
		}
		else if (main.scene == SceneState.STAGE)
		{
			positionIndex = base.photonView.Owner.GetPlayerNumber();
			if (positionIndex != -1)
			{
				offset = main.envControl.multiplayPositions[positionIndex].position;
				main.envControl.multiplayPositions[positionIndex].gameObject.SetActive(value: true);
			}
		}
	}

	public void ChangeHand(bool isBothHand, bool isRightHand)
	{
		this.isBothHand = isBothHand;
		this.isRightHand = isRightHand;
		if (!this.isBothHand)
		{
			if (this.isRightHand)
			{
				rightHand.gameObject.SetActive(value: true);
				leftHand.gameObject.SetActive(value: false);
			}
			else
			{
				rightHand.gameObject.SetActive(value: false);
				leftHand.gameObject.SetActive(value: true);
			}
		}
	}

	private void OnDestroy()
	{
		if (main != null && main.scene == SceneState.STAGE && main.envControl != null && positionIndex != -1)
		{
			main.envControl.multiplayPositions[positionIndex].gameObject.SetActive(value: false);
		}
		MonoBehaviour.print("Remote Avatar 현재 photonNetwork 상태 = " + PhotonNetwork.IsConnected + " 방 안에 있나? " + PhotonNetwork.InRoom);
		PhotonView photonView = MultiplayManager.Instance.avatarViews.Where((PhotonView s) => s.Owner == base.photonView.Owner).FirstOrDefault();
		if (photonView != null)
		{
			MultiplayManager.Instance.avatarViews.Remove(photonView);
		}
		if (waitMainCoroutine != null)
		{
			StopCoroutine(waitMainCoroutine);
		}
	}

	private void Update()
	{
		if (!base.photonView.IsMine && main != null && (main.scene == SceneState.LOBBY || main.scene == SceneState.STAGE))
		{
			head.position = Vector3.MoveTowards(head.position, head_NetworkPosition, head_Distance * (1f / (float)PhotonNetwork.SerializationRate));
			head.rotation = Quaternion.RotateTowards(head.rotation, head_NetworkRotation, head_Angle * (1f / (float)PhotonNetwork.SerializationRate));
			if (isBothHand)
			{
				leftHand.position = Vector3.MoveTowards(leftHand.position, leftHand_NetworkPosition, leftHand_Distance * (1f / (float)PhotonNetwork.SerializationRate));
				leftHand.rotation = Quaternion.RotateTowards(leftHand.rotation, leftHand_NetworkRotation, leftHand_Angle * (1f / (float)PhotonNetwork.SerializationRate));
				rightHand.position = Vector3.MoveTowards(rightHand.position, rightHand_NetworkPosition, rightHand_Distance * (1f / (float)PhotonNetwork.SerializationRate));
				rightHand.rotation = Quaternion.RotateTowards(rightHand.rotation, rightHand_NetworkRotation, rightHand_Angle * (1f / (float)PhotonNetwork.SerializationRate));
			}
			else if (!isRightHand)
			{
				leftHand.position = Vector3.MoveTowards(leftHand.position, leftHand_NetworkPosition, leftHand_Distance * (1f / (float)PhotonNetwork.SerializationRate));
				leftHand.rotation = Quaternion.RotateTowards(leftHand.rotation, leftHand_NetworkRotation, leftHand_Angle * (1f / (float)PhotonNetwork.SerializationRate));
			}
			else
			{
				rightHand.position = Vector3.MoveTowards(rightHand.position, rightHand_NetworkPosition, rightHand_Distance * (1f / (float)PhotonNetwork.SerializationRate));
				rightHand.rotation = Quaternion.RotateTowards(rightHand.rotation, rightHand_NetworkRotation, rightHand_Angle * (1f / (float)PhotonNetwork.SerializationRate));
			}
		}
		ProcessSpeaking();
		ProcessUserInfo();
	}

	public void OnPhotonSerializeView(PhotonStream stream, PhotonMessageInfo info)
	{
		if (stream.IsReading && main != null && (main.scene == SceneState.LOBBY || main.scene == SceneState.STAGE))
		{
			head_NetworkPosition = (Vector3)stream.ReceiveNext() + offset;
			head_Direction = (Vector3)stream.ReceiveNext();
			if (head_FirstTake)
			{
				head.position = head_NetworkPosition;
				head_Distance = 0f;
			}
			else
			{
				float num = Mathf.Abs((float)(PhotonNetwork.Time - info.SentServerTime));
				head_NetworkPosition += head_Direction * num;
				head_Distance = Vector3.Distance(head.position, head_NetworkPosition);
			}
			head_NetworkRotation = (Quaternion)stream.ReceiveNext();
			if (head_FirstTake)
			{
				head_Angle = 0f;
				head.rotation = head_NetworkRotation;
			}
			else
			{
				head_Angle = Quaternion.Angle(head.rotation, head_NetworkRotation);
			}
			if (head_FirstTake)
			{
				head_FirstTake = false;
			}
			if (isBothHand)
			{
				ProcessHand(Hand.LEFT, stream, info);
				ProcessHand(Hand.RIGHT, stream, info);
			}
			else if (!isRightHand)
			{
				ProcessHand(Hand.LEFT, stream, info);
			}
			else
			{
				ProcessHand(Hand.RIGHT, stream, info);
			}
			morphValues = (float[])stream.ReceiveNext();
			for (int i = 1; i < morphValues.Length; i++)
			{
				skinnedMeshRenderer.SetBlendShapeWeight(i - 1, morphValues[i] * 100f);
			}
			bool[] fingerState = (bool[])stream.ReceiveNext();
			bool[] fingerState2 = (bool[])stream.ReceiveNext();
			leftHandControl.ChangeState(fingerState);
			rightHandControl.ChangeState(fingerState2);
		}
	}

	public void FindOffset()
	{
		if (main != null)
		{
			if (main.scene == SceneState.LOBBY)
			{
				positionIndex = base.photonView.Owner.GetPlayerNumber();
				offset = Vector3.zero;
			}
			else if (main.scene == SceneState.STAGE)
			{
				positionIndex = base.photonView.Owner.GetPlayerNumber();
				offset = main.envControl.multiplayPositions[positionIndex].position;
				main.envControl.multiplayPositions[positionIndex].gameObject.SetActive(value: true);
			}
		}
	}

	public void SetUserInfo()
	{
		if (canvas_UserInfo.worldCamera == null)
		{
			canvas_UserInfo.worldCamera = Camera.main;
		}
		tmp_UserName.text = base.photonView.Owner.NickName;
		CheckHost();
	}

	private void CheckHost()
	{
		if (!(base.photonView != null))
		{
			return;
		}
		if (base.photonView.Owner.IsMasterClient)
		{
			if (!hostImage.activeSelf)
			{
				hostImage.SetActive(value: true);
			}
		}
		else if (hostImage.activeSelf)
		{
			hostImage.SetActive(value: false);
		}
	}

	public void InitPlayInfo()
	{
		tmp_PlayInfo.text = "";
	}

	public void DisplayUserInfo()
	{
		if (!userInfoPivot.activeSelf)
		{
			userInfoPivot.SetActive(value: true);
		}
	}

	public void HideUserInfo()
	{
		if (userInfoPivot.activeSelf)
		{
			userInfoPivot.SetActive(value: false);
		}
	}

	public void DisplayPlayInfo(int fishID, float fishLength, float fishWeight)
	{
		if (!tmp_PlayInfo.gameObject.activeSelf)
		{
			tmp_PlayInfo.gameObject.SetActive(value: true);
		}
		string itemName = Singleton<DataManager>.Instance.ItemDatabase.dlcs[Singleton<DataManager>.Instance.userData.curNation].fishItems[fishID].ItemName;
		string arg = "cm";
		float num;
		if (dataManager.userData.unit == 0)
		{
			num = dataManager.changeUnitLength(fishLength);
			arg = "in";
		}
		else
		{
			num = fishLength;
		}
		num = Mathf.Round(num * 1000f) / 1000f;
		tmp_PlayInfo.text = $"{itemName}\n{num} {arg}";
		StartCoroutine(HidePlayInfo());
	}

	public void DisplayPlayInfo()
	{
		if (!tmp_PlayInfo.gameObject.activeSelf)
		{
			tmp_PlayInfo.gameObject.SetActive(value: true);
		}
	}

	public IEnumerator HidePlayInfo()
	{
		yield return new WaitForSeconds(playInfoPeriod);
		InitPlayInfo();
		if (tmp_PlayInfo.gameObject.activeSelf)
		{
			tmp_PlayInfo.gameObject.SetActive(value: false);
		}
	}

	private void ProcessUserInfo()
	{
		if (dataManager.userData.isUserInfoVisible || !(main != null))
		{
			return;
		}
		if (main.scene == SceneState.LOBBY)
		{
			if (main.vrLobbyPointerL.detectedCollider == remoteAvatarCollider || main.vrLobbyPointerR.detectedCollider == remoteAvatarCollider)
			{
				DisplayUserInfo();
			}
			else
			{
				HideUserInfo();
			}
		}
		else if (main.scene == SceneState.STAGE)
		{
			if (main.vrFishingPointerL.detectedCollider == remoteAvatarCollider || main.vrFishingPointerR.detectedCollider == remoteAvatarCollider)
			{
				DisplayUserInfo();
			}
			else
			{
				HideUserInfo();
			}
		}
	}

	private void ProcessSpeaking()
	{
		if (morphValues != null)
		{
			if (morphValues[0] < speakingLimit)
			{
				tmp_UserName.color = speakColor;
				tmp_UserName.fontSize = 105f;
			}
			else
			{
				tmp_UserName.color = Color.white;
				tmp_UserName.fontSize = 100f;
			}
		}
		else
		{
			tmp_UserName.color = Color.white;
			tmp_UserName.fontSize = 100f;
		}
	}

	public override void OnMasterClientSwitched(Player newMasterClient)
	{
		PhotonView photonView = MultiplayManager.Instance.avatarViews.Where((PhotonView s) => s.Owner == newMasterClient).FirstOrDefault();
		if (photonView != null)
		{
			photonView.GetComponent<RemoteAvatar>().hostImage.SetActive(value: true);
		}
	}

	private void ProcessHand(Hand hand, PhotonStream stream, PhotonMessageInfo info)
	{
		if (hand == Hand.LEFT)
		{
			leftHand_NetworkPosition = (Vector3)stream.ReceiveNext() + offset;
			leftHand_Direction = (Vector3)stream.ReceiveNext();
			if (leftHand_FirstTake)
			{
				leftHand.position = leftHand_NetworkPosition;
				leftHand_Distance = 0f;
			}
			else
			{
				float num = Mathf.Abs((float)(PhotonNetwork.Time - info.SentServerTime));
				leftHand_NetworkPosition += leftHand_Direction * num;
				leftHand_Distance = Vector3.Distance(leftHand.position, leftHand_NetworkPosition);
			}
			leftHand_NetworkRotation = (Quaternion)stream.ReceiveNext();
			if (leftHand_FirstTake)
			{
				leftHand_Angle = 0f;
				leftHand.rotation = leftHand_NetworkRotation;
			}
			else
			{
				leftHand_Angle = Quaternion.Angle(leftHand.rotation, leftHand_NetworkRotation);
			}
			if (leftHand_FirstTake)
			{
				leftHand_FirstTake = false;
			}
		}
		else
		{
			rightHand_NetworkPosition = (Vector3)stream.ReceiveNext() + offset;
			rightHand_Direction = (Vector3)stream.ReceiveNext();
			if (rightHand_FirstTake)
			{
				rightHand.position = rightHand_NetworkPosition;
				rightHand_Distance = 0f;
			}
			else
			{
				float num2 = Mathf.Abs((float)(PhotonNetwork.Time - info.SentServerTime));
				rightHand_NetworkPosition += rightHand_Direction * num2;
				rightHand_Distance = Vector3.Distance(rightHand.position, rightHand_NetworkPosition);
			}
			rightHand_NetworkRotation = (Quaternion)stream.ReceiveNext();
			if (rightHand_FirstTake)
			{
				rightHand_Angle = 0f;
				rightHand.rotation = rightHand_NetworkRotation;
			}
			else
			{
				rightHand_Angle = Quaternion.Angle(rightHand.rotation, rightHand_NetworkRotation);
			}
			if (rightHand_FirstTake)
			{
				rightHand_FirstTake = false;
			}
		}
	}

	public void smartPhoneSet(int positionNum)
	{
		switch (positionNum)
		{
		case 0:
			smartPhone.SetActive(value: false);
			leftHandControl.smartPhone.SetActive(value: false);
			rightHandControl.smartPhone.SetActive(value: false);
			break;
		case 1:
			smartPhone.SetActive(value: true);
			leftHandControl.smartPhone.SetActive(value: false);
			rightHandControl.smartPhone.SetActive(value: false);
			break;
		case 2:
			smartPhone.SetActive(value: false);
			leftHandControl.smartPhone.SetActive(value: true);
			rightHandControl.smartPhone.SetActive(value: false);
			break;
		case 3:
			smartPhone.SetActive(value: false);
			leftHandControl.smartPhone.SetActive(value: false);
			rightHandControl.smartPhone.SetActive(value: true);
			break;
		default:
			smartPhone.SetActive(value: false);
			leftHandControl.smartPhone.SetActive(value: false);
			rightHandControl.smartPhone.SetActive(value: false);
			break;
		}
	}
}
public class RemoteFish : MonoBehaviourPunCallbacks, IPunObservable
{
	public Animation jumpAnimation;

	public Transform jumpLocalPivot;

	public float JumpAni;

	public int positionIndex = -1;

	public Vector3 offset;

	public float speed = 0.5f;

	public List<FishController> fishControllers;

	public FishController selectedFish;

	public AudioClip[] soundFishClips;

	public ParticleSystem particleSwim;

	public GameObject particleJump;

	private AudioSource soundFish;

	private Main main;

	private Vector3 m_Direction;

	private Vector3 m_NetworkPosition;

	private Quaternion m_NetworkRotation;

	private float m_Distance;

	private float m_Angle;

	private bool m_firstTake;

	private float particleScale = 1f;

	public float particleSize = 0.85f;

	private void Awake()
	{
		main = Singleton<Main>.Instance;
		soundFish = GetComponent<AudioSource>();
		m_NetworkPosition = Vector3.zero;
		m_NetworkRotation = Quaternion.identity;
	}

	private void Start()
	{
		positionIndex = base.photonView.Owner.GetPlayerNumber();
	}

	public override void OnEnable()
	{
		base.OnEnable();
		m_firstTake = true;
	}

	private void Update()
	{
		if (!base.photonView.IsMine && main != null)
		{
			base.transform.position = Vector3.MoveTowards(base.transform.position, m_NetworkPosition, m_Distance * (1f / (float)PhotonNetwork.SerializationRate));
			base.transform.rotation = Quaternion.RotateTowards(base.transform.rotation, m_NetworkRotation, m_Angle * (1f / (float)PhotonNetwork.SerializationRate));
			if (particleSwim != null)
			{
				particleSwim.transform.position = new Vector3(base.transform.position.x, main.envControl.water_Height, base.transform.position.z);
			}
			jumpLocalPivot.localPosition = new Vector3(0f, JumpAni, 0f);
		}
	}

	private void OnDestroy()
	{
		MonoBehaviour.print("Remote Fish 현재 photonNetwork 상태 = " + PhotonNetwork.IsConnected + " 방 안에 있나? " + PhotonNetwork.InRoom);
		PhotonView photonView = MultiplayManager.Instance.fishViews.Where((PhotonView s) => s.Owner == base.photonView.Owner).FirstOrDefault();
		if (photonView != null)
		{
			MultiplayManager.Instance.fishViews.Remove(photonView);
		}
	}

	public void OnPhotonSerializeView(PhotonStream stream, PhotonMessageInfo info)
	{
		if (stream.IsReading && main != null)
		{
			m_NetworkPosition = (Vector3)stream.ReceiveNext() + main.envControl.multiplayPositions[positionIndex].position;
			m_Direction = (Vector3)stream.ReceiveNext();
			if (m_firstTake)
			{
				base.transform.position = m_NetworkPosition;
				m_Distance = 0f;
			}
			else
			{
				float num = Mathf.Abs((float)(PhotonNetwork.Time - info.SentServerTime));
				m_NetworkPosition += m_Direction * num;
				m_Distance = Vector3.Distance(base.transform.position, m_NetworkPosition);
			}
			m_NetworkRotation = (Quaternion)stream.ReceiveNext();
			if (m_firstTake)
			{
				m_Angle = 0f;
				base.transform.rotation = m_NetworkRotation;
			}
			else
			{
				m_Angle = Quaternion.Angle(base.transform.rotation, m_NetworkRotation);
			}
			if (m_firstTake)
			{
				m_firstTake = false;
			}
		}
	}

	public void ShowFish(int index)
	{
		MonoBehaviour.print("ShowFish : " + index);
		particleScale = Singleton<DataManager>.Instance.ItemDatabase.dlcs[0].fishItems[index].grade;
		for (int i = 0; i < fishControllers.Count; i++)
		{
			if (i == index)
			{
				selectedFish = fishControllers[i];
				fishControllers[i].gameObject.SetActive(value: true);
			}
			else
			{
				fishControllers[i].gameObject.SetActive(value: false);
			}
		}
	}

	public void ChangeFishState(FishState fishState)
	{
		if (selectedFish != null)
		{
			selectedFish.ChangeAni(fishState);
			PlayFishSound(fishState);
			CreateParitcle(fishState);
		}
	}

	private void PlayFishSound(FishState fishState)
	{
		switch (fishState)
		{
		case FishState.None:
			soundFish.Stop();
			break;
		case FishState.Hookset:
			soundFish.loop = false;
			soundFish.clip = soundFishClips[0];
			soundFish.Play();
			break;
		case FishState.Drag:
			soundFish.loop = false;
			soundFish.clip = soundFishClips[3];
			soundFish.Play();
			break;
		case FishState.Swim:
			soundFish.loop = true;
			soundFish.clip = soundFishClips[1];
			soundFish.Play();
			break;
		case FishState.Stay:
			soundFish.loop = false;
			break;
		case FishState.Jump:
			soundFish.loop = false;
			soundFish.clip = soundFishClips[2];
			soundFish.Play();
			break;
		case FishState.Fail:
			soundFish.loop = false;
			soundFish.Stop();
			break;
		case FishState.Struggle:
			soundFish.loop = false;
			break;
		case FishState.Landing:
			soundFish.loop = false;
			soundFish.Stop();
			break;
		case FishState.Release:
			soundFish.loop = false;
			break;
		default:
			soundFish.loop = false;
			soundFish.Stop();
			break;
		}
	}

	private void CreateParitcle(FishState fishState)
	{
		ParticleSystem.MainModule mainModule = particleSwim.main;
		mainModule.startSize = particleSize + particleSize * 0.2f * particleScale;
		switch (fishState)
		{
		case FishState.None:
			particleSwim.Stop(withChildren: true, ParticleSystemStopBehavior.StopEmitting);
			break;
		case FishState.Hookset:
			particleSwim.Play();
			break;
		case FishState.Drag:
			particleSwim.Play();
			break;
		case FishState.Swim:
			particleSwim.Play();
			break;
		case FishState.Stay:
			particleSwim.Stop(withChildren: true, ParticleSystemStopBehavior.StopEmitting);
			break;
		case FishState.Jump:
			particleSwim.Stop(withChildren: true, ParticleSystemStopBehavior.StopEmitting);
			createParticle(delay: true);
			break;
		case FishState.Fail:
			particleSwim.Stop(withChildren: true, ParticleSystemStopBehavior.StopEmitting);
			createParticle(delay: false);
			break;
		case FishState.Struggle:
			particleSwim.Play();
			break;
		case FishState.Landing:
			particleSwim.Stop(withChildren: true, ParticleSystemStopBehavior.StopEmitting);
			createParticle(delay: false);
			break;
		case FishState.Release:
			particleSwim.Stop(withChildren: true, ParticleSystemStopBehavior.StopEmitting);
			break;
		default:
			particleSwim.Stop(withChildren: true, ParticleSystemStopBehavior.StopEmitting);
			break;
		}
	}

	private IEnumerator delayParticle()
	{
		yield return new WaitForSeconds(1f);
		UnityEngine.Object.Instantiate(particleJump, new Vector3(base.transform.position.x, main.envControl.water_Height, base.transform.position.z), Quaternion.identity).transform.localScale = Vector3.one * particleScale * 0.3f;
	}

	private void createParticle(bool delay)
	{
		if (delay)
		{
			StartCoroutine(delayParticle());
		}
		else
		{
			UnityEngine.Object.Instantiate(particleJump, new Vector3(base.transform.position.x, main.envControl.water_Height, base.transform.position.z), Quaternion.identity).transform.localScale = Vector3.one * particleScale * 0.4f;
		}
	}
}
public class RemoteHand : MonoBehaviour
{
	public GameObject smartPhone;

	private GameObject handObject;

	private Animator ani;

	private float thumb;

	private float index;

	private float middle;

	private bool[] multiFingerState = new bool[8];

	private void Awake()
	{
		handObject = GetComponent<GameObject>();
		ani = GetComponent<Animator>();
		if (smartPhone != null)
		{
			smartPhone.SetActive(value: false);
		}
	}

	private void Update()
	{
		if (multiFingerState[4])
		{
			if (multiFingerState[1])
			{
				thumb = Mathf.Lerp(thumb, 1f, 0.5f);
			}
			else
			{
				thumb = Mathf.Lerp(thumb, 0f, 0.5f);
			}
			if (multiFingerState[2])
			{
				index = Mathf.Lerp(index, 1f, 0.5f);
			}
			else
			{
				index = Mathf.Lerp(index, 0f, 0.5f);
			}
			if (multiFingerState[3])
			{
				middle = Mathf.Lerp(middle, 1f, 0.5f);
			}
			else
			{
				middle = Mathf.Lerp(middle, 0f, 0.5f);
			}
		}
		else
		{
			thumb = 0f;
			index = 0f;
			middle = 0f;
		}
		ani.SetFloat("thumb", thumb);
		ani.SetFloat("index", index);
		ani.SetFloat("middle", middle);
	}

	public void ChangeState(bool[] fingerState)
	{
		multiFingerState = fingerState;
		ani.SetBool("normal", multiFingerState[4]);
		ani.SetBool("grab", multiFingerState[5]);
		ani.SetBool("spinning", multiFingerState[6]);
		ani.SetBool("casting", multiFingerState[7]);
	}
}
public class RemoteLure : MonoBehaviourPunCallbacks, IPunObservable
{
	public Vector3 photonLurePos;

	public Quaternion photonLureRot;

	public int positionIndex = -1;

	public Vector3 offset;

	public float speed = 0.5f;

	public List<LureController> lureControllers;

	private Vector3 m_Direction;

	private Vector3 m_NetworkPosition;

	private Quaternion m_NetworkRotation;

	private float m_Distance;

	private float m_Angle;

	private bool m_firstTake;

	private Main main;

	public int selectedID = -1;

	private void Awake()
	{
		m_NetworkPosition = Vector3.zero;
		m_NetworkRotation = Quaternion.identity;
	}

	public override void OnEnable()
	{
		base.OnEnable();
		m_firstTake = true;
		SceneManager.sceneLoaded += OnSceneLoaded;
		PlayerNumbering.OnPlayerNumberingChanged += OnPlayerNumberingChanged;
	}

	public override void OnDisable()
	{
		base.OnDisable();
		SceneManager.sceneLoaded -= OnSceneLoaded;
		PlayerNumbering.OnPlayerNumberingChanged -= OnPlayerNumberingChanged;
	}

	private void Start()
	{
		StartCoroutine(waitMain());
	}

	private void OnSceneLoaded(Scene scene, LoadSceneMode mode)
	{
		if (scene.name != "Loading")
		{
			StartCoroutine(waitMain());
		}
	}

	private IEnumerator waitMain()
	{
		while (Singleton<Main>.Instance == null)
		{
			yield return null;
		}
		main = Singleton<Main>.Instance;
		if (main.scene == SceneState.LOBBY)
		{
			positionIndex = base.photonView.Owner.GetPlayerNumber();
			offset = Vector3.zero;
		}
		else if (main.scene == SceneState.STAGE)
		{
			positionIndex = base.photonView.Owner.GetPlayerNumber();
			if (positionIndex != -1)
			{
				offset = main.envControl.multiplayPositions[positionIndex].position;
			}
		}
	}

	private void OnPlayerNumberingChanged()
	{
		positionIndex = base.photonView.Owner.GetPlayerNumber();
	}

	public void ShowLure(int index)
	{
		selectedID = index;
		MonoBehaviour.print("ShowLure : " + index);
		for (int i = 0; i < lureControllers.Count; i++)
		{
			if (i == index)
			{
				lureControllers[i].ShowLure(show: true);
			}
			else
			{
				lureControllers[i].ShowLure(show: false);
			}
		}
	}

	public void ShowLureWhenKeepOrRelease()
	{
		ShowLure(selectedID);
	}

	public void HideLure()
	{
		for (int i = 0; i < lureControllers.Count; i++)
		{
			if (lureControllers[i].gameObject.activeSelf)
			{
				lureControllers[i].ShowLure(show: false);
			}
		}
	}

	private void OnDestroy()
	{
		MonoBehaviour.print("Remote Lure 현재 photonNetwork 상태 = " + PhotonNetwork.IsConnected + " 방 안에 있나? " + PhotonNetwork.InRoom);
		PhotonView photonView = MultiplayManager.Instance.lureViews.Where((PhotonView s) => s.Owner == base.photonView.Owner).FirstOrDefault();
		if (photonView != null)
		{
			MultiplayManager.Instance.lureViews.Remove(photonView);
		}
	}

	private void Update()
	{
		if (!base.photonView.IsMine && main != null)
		{
			base.transform.position = Vector3.MoveTowards(base.transform.position, m_NetworkPosition, m_Distance * (1f / (float)PhotonNetwork.SerializationRate));
			base.transform.rotation = Quaternion.RotateTowards(base.transform.rotation, m_NetworkRotation, m_Angle * (1f / (float)PhotonNetwork.SerializationRate));
		}
	}

	public void OnPhotonSerializeView(PhotonStream stream, PhotonMessageInfo info)
	{
		if (stream.IsReading && main != null)
		{
			m_NetworkPosition = (Vector3)stream.ReceiveNext() + offset;
			m_Direction = (Vector3)stream.ReceiveNext();
			if (m_firstTake)
			{
				base.transform.position = m_NetworkPosition;
				m_Distance = 0f;
			}
			else
			{
				float num = Mathf.Abs((float)(PhotonNetwork.Time - info.SentServerTime));
				m_NetworkPosition += m_Direction * num;
				m_Distance = Vector3.Distance(base.transform.position, m_NetworkPosition);
			}
			m_NetworkRotation = (Quaternion)stream.ReceiveNext();
			if (m_firstTake)
			{
				m_Angle = 0f;
				base.transform.rotation = m_NetworkRotation;
			}
			else
			{
				m_Angle = Quaternion.Angle(base.transform.rotation, m_NetworkRotation);
			}
			if (m_firstTake)
			{
				m_firstTake = false;
			}
		}
	}
}
public class RemoteTackle : MonoBehaviourPunCallbacks, IPunObservable
{
	private Vector3[] fishingLinePos = new Vector3[10];

	private bool isSpinning = true;

	private bool isReady;

	public int reelID;

	public int rodID;

	public bool isRightHand;

	public bool isBothHand;

	public control_item_reel[] reelS;

	public control_item_reel[] reelC;

	public control_item_rod[] rodS;

	public control_item_rod[] rodC;

	public Transform lureTransform;

	[HideInInspector]
	public int positionIndex = -1;

	public float multiRodBend;

	public float multiReelRot;

	private LineRenderer fishingLine;

	public AudioClip[] soundTackleClip;

	private AudioSource soundTackle;

	private Main main;

	private void Awake()
	{
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
		fishingLine = GetComponent<LineRenderer>();
		soundTackle = GetComponent<AudioSource>();
		StartCoroutine(waitMain());
	}

	private void OnSceneLoaded(Scene scene, LoadSceneMode mode)
	{
		if (scene.name != "Loading")
		{
			StartCoroutine(waitMain());
		}
	}

	public override void OnEnable()
	{
		base.OnEnable();
		SceneManager.sceneLoaded += OnSceneLoaded;
	}

	public override void OnDisable()
	{
		base.OnDisable();
		SceneManager.sceneLoaded -= OnSceneLoaded;
	}

	private IEnumerator waitMain()
	{
		while (Singleton<Main>.Instance == null)
		{
			yield return null;
		}
		main = Singleton<Main>.Instance;
		if (main.scene == SceneState.STAGE)
		{
			MoveHand();
		}
	}

	public void InitTackle(bool handendRight, bool bSpinning)
	{
		isSpinning = bSpinning;
		isReady = true;
		for (int i = 0; i < reelS.Length; i++)
		{
			reelS[i].gameObject.SetActive(value: false);
		}
		for (int j = 0; j < reelC.Length; j++)
		{
			reelC[j].gameObject.SetActive(value: false);
		}
		for (int k = 0; k < rodS.Length; k++)
		{
			rodS[k].gameObject.SetActive(value: false);
		}
		for (int l = 0; l < rodC.Length; l++)
		{
			rodC[l].gameObject.SetActive(value: false);
		}
		if (isSpinning)
		{
			rodS[rodID].gameObject.SetActive(value: true);
			reelS[reelID].gameObject.SetActive(value: true);
			reelS[reelID].reelAni.Play("AniReel", 0, 0f);
			reelS[reelID].ShowReelHanded(handendRight);
		}
		else
		{
			rodC[rodID].gameObject.SetActive(value: true);
			reelC[reelID].gameObject.SetActive(value: true);
			reelC[reelID].reelAni.Play("AniReel", 0, 0f);
			reelC[reelID].ShowReelHanded(handendRight);
		}
	}

	private void OnDestroy()
	{
		MonoBehaviour.print("Remote Tackle 현재 photonNetwork 상태 = " + PhotonNetwork.IsConnected + " 방 안에 있나? " + PhotonNetwork.InRoom);
		PhotonView photonView = MultiplayManager.Instance.tackleViews.Where((PhotonView s) => s.Owner == base.photonView.Owner).FirstOrDefault();
		if (photonView != null)
		{
			MultiplayManager.Instance.tackleViews.Remove(photonView);
		}
	}

	private void LateUpdate()
	{
		if (isReady)
		{
			renderLine();
			reelRotate();
			rodBending();
		}
	}

	private void renderLine()
	{
		if (isSpinning)
		{
			fishingLinePos[0] = reelS[reelID].reellineWindPos[0].position;
			fishingLinePos[1] = reelS[reelID].reellineWindPos[1].position;
			for (int i = 0; i < rodS[rodID].rodlinePos.Length; i++)
			{
				fishingLinePos[i + 2] = rodS[rodID].rodlinePos[i].position;
			}
		}
		else
		{
			fishingLinePos[0] = reelC[reelID].reellineWindPos[0].position;
			fishingLinePos[1] = reelC[reelID].reellineWindPos[1].position;
			for (int j = 0; j < rodC[rodID].rodlinePos.Length; j++)
			{
				fishingLinePos[j + 2] = rodC[rodID].rodlinePos[j].position;
			}
		}
		if (lureTransform == null)
		{
			fishingLinePos[9] = fishingLinePos[8];
		}
		else
		{
			fishingLinePos[9] = lureTransform.position;
		}
		for (int k = 0; k < fishingLinePos.Length; k++)
		{
			fishingLine.SetPosition(k, fishingLinePos[k]);
		}
	}

	private void reelRotate()
	{
		if (isSpinning)
		{
			reelS[reelID].reelAni.Play("AniReel", 0, multiReelRot);
			reelS[reelID].reelAni.SetFloat("speed", 0f);
			reelS[reelID].reelAni.SetFloat("frame", multiReelRot);
		}
		else
		{
			reelC[reelID].reelAni.Play("AniReel", 0, multiReelRot);
			reelC[reelID].reelAni.SetFloat("speed", 0f);
			reelC[reelID].reelAni.SetFloat("frame", multiReelRot);
		}
	}

	private void rodBending()
	{
		if (!(lureTransform != null))
		{
			return;
		}
		if (isSpinning)
		{
			int num = rodS[rodID].rodBonesPos.Length;
			Vector3 forward = base.transform.forward;
			Vector3 b = Vector3.Normalize(lureTransform.position - rodS[rodID].rodBonesPos[num - 1].position);
			for (int i = 0; i < num; i++)
			{
				Quaternion quaternion = Quaternion.LookRotation(Vector3.Lerp(forward, b, 1f / (float)num * (float)i * multiRodBend), base.transform.up);
				rodS[rodID].rodBonesPos[i].rotation = quaternion * Quaternion.Euler(180f, 90f, 0f);
			}
		}
		else
		{
			int num2 = rodC[rodID].rodBonesPos.Length;
			Vector3 forward2 = base.transform.forward;
			Vector3 b2 = Vector3.Normalize(lureTransform.position - rodC[rodID].rodBonesPos[num2 - 1].position);
			for (int j = 0; j < num2; j++)
			{
				Quaternion quaternion2 = Quaternion.LookRotation(Vector3.Lerp(forward2, b2, 1f / (float)num2 * (float)j * multiRodBend), base.transform.up);
				rodC[rodID].rodBonesPos[j].rotation = quaternion2 * Quaternion.Euler(180f, 90f, 0f);
			}
		}
	}

	public void ChangeTackleState(FishState fishState)
	{
		switch (fishState)
		{
		case FishState.None:
			MoveHand();
			break;
		case FishState.Holder:
			MoveHolder();
			break;
		case FishState.Casting:
			soundTackle.clip = soundTackleClip[0];
			soundTackle.loop = false;
			soundTackle.Play();
			break;
		case FishState.Drag:
			soundTackle.clip = soundTackleClip[1];
			soundTackle.loop = true;
			soundTackle.Play();
			break;
		case FishState.Swim:
			soundTackle.loop = false;
			soundTackle.Stop();
			break;
		default:
			soundTackle.loop = false;
			soundTackle.Stop();
			break;
		}
	}

	public void OnPhotonSerializeView(PhotonStream stream, PhotonMessageInfo info)
	{
		if (stream.IsReading && main != null && main.scene == SceneState.STAGE)
		{
			multiRodBend = (float)stream.ReceiveNext();
			multiReelRot = (float)stream.ReceiveNext();
		}
	}

	public void MoveHolder()
	{
		if (main != null)
		{
			MultiplayManager.Instance.avatarViews.Where((PhotonView s) => s.Owner == base.photonView.Owner).FirstOrDefault();
			if (base.photonView != null)
			{
				base.transform.SetParent(main.envControl.multiHolderPositions[MultiplayManager.Instance.GetPositionIndex(base.photonView.Owner)].transform);
			}
			base.transform.localPosition = Vector3.zero;
			base.transform.localEulerAngles = Vector3.zero;
		}
	}

	public void MoveHand()
	{
		PhotonView photonView = MultiplayManager.Instance.avatarViews.Where((PhotonView s) => s.Owner == base.photonView.Owner).FirstOrDefault();
		if (main != null && photonView != null)
		{
			if (!isRightHand)
			{
				base.transform.SetParent(photonView.GetComponent<RemoteAvatar>().leftHand);
				base.transform.localPosition = Vector3.zero;
				base.transform.localRotation = Quaternion.identity;
			}
			else
			{
				base.transform.SetParent(photonView.GetComponent<RemoteAvatar>().rightHand);
				base.transform.localPosition = Vector3.zero;
				base.transform.localRotation = Quaternion.identity;
			}
		}
	}
}
public class RoomElement : MonoBehaviour
{
	public Text txt_roomName;

	public Text txt_playerCounts;

	public GameObject button_Join;

	public string roomId;

	public int maxPlayer;

	public int currentPlayer;

	public int stage;

	public RoomInfo roomInfo;

	[HideInInspector]
	public MultiplayUIManager multiplayUIManager;

	private void Start()
	{
		txt_playerCounts.text = $"{currentPlayer} / {maxPlayer}";
	}

	public void JoinRoom()
	{
		if (currentPlayer < maxPlayer)
		{
			if (!string.IsNullOrEmpty(roomInfo.CustomProperties["password"].ToString()))
			{
				Singleton<Main>.Instance.multiplayUIManager.DisplayPasswordPanel();
				Singleton<Main>.Instance.multiplayUIManager.panel_Password.GetComponent<MultiplayPasswordUIManager>().roomInfo = roomInfo;
			}
			else
			{
				multiplayUIManager.HideAllPanel();
				multiplayUIManager.PopUpJoiningRoom(show: true);
				PhotonNetwork.JoinRoom(roomId);
			}
		}
	}

	public void RefreshInfo(RoomInfo updateinfo)
	{
		UnityEngine.Debug.Log("RefreshRoomInfo");
		roomInfo = updateinfo;
		txt_roomName.text = updateinfo.CustomProperties["displayName"].ToString();
		maxPlayer = updateinfo.MaxPlayers;
		currentPlayer = updateinfo.PlayerCount;
		txt_playerCounts.text = $"{currentPlayer} / {maxPlayer}";
	}
}
public class RoomListDisplay : MonoBehaviourPunCallbacks
{
	public MultiplayUIManager multiplayUIManager;

	public GameObject roomElementPrefab;

	public GameObject content;

	private Dictionary<string, RoomElement> roomElementList = new Dictionary<string, RoomElement>();

	public override void OnEnable()
	{
		base.OnEnable();
		ResetList();
	}

	public override void OnDisable()
	{
		base.OnDisable();
	}

	public void ResetList()
	{
		foreach (KeyValuePair<string, RoomElement> roomElement in roomElementList)
		{
			if (roomElement.Value != null)
			{
				UnityEngine.Object.Destroy(roomElement.Value.gameObject);
			}
		}
		roomElementList = new Dictionary<string, RoomElement>();
	}

	public override void OnRoomListUpdate(List<RoomInfo> roomList)
	{
		if (roomList.Count == 0 && !PhotonNetwork.InLobby)
		{
			UnityEngine.Debug.Log("No Room found in Lobby");
		}
		foreach (RoomInfo room in roomList)
		{
			if (roomElementList.ContainsKey(room.Name))
			{
				if (room.RemovedFromList)
				{
					UnityEngine.Object.Destroy(roomElementList[room.Name].gameObject);
					roomElementList.Remove(room.Name);
				}
				else
				{
					roomElementList[room.Name].RefreshInfo(room);
				}
			}
			else if (!room.RemovedFromList)
			{
				RoomElement component = UnityEngine.Object.Instantiate(roomElementPrefab, content.transform).GetComponent<RoomElement>();
				roomElementList[room.Name] = component;
				roomElementList[room.Name].multiplayUIManager = multiplayUIManager;
				roomElementList[room.Name].txt_roomName.text = room.CustomProperties["displayName"].ToString();
				roomElementList[room.Name].roomId = room.Name;
				roomElementList[room.Name].maxPlayer = room.MaxPlayers;
				roomElementList[room.Name].currentPlayer = room.PlayerCount;
				roomElementList[room.Name].roomInfo = room;
				if (room.PlayerCount < room.MaxPlayers)
				{
					component.button_Join.GetComponent<Button>().interactable = true;
				}
				else if (room.PlayerCount == room.MaxPlayers)
				{
					component.button_Join.GetComponent<Button>().interactable = false;
				}
			}
		}
	}
}
[RequireComponent(typeof(AudioSource))]
public class RVRFLipSyncContext : RVRFLipSyncContextBase
{
	[Tooltip("Allow capturing of keyboard input to control operation.")]
	public bool enableKeyboardInput;

	[Tooltip("Play input audio back through audio output.")]
	public bool audioLoopback;

	[Tooltip("Key to toggle audio loopback.")]
	public KeyCode loopbackKey = KeyCode.L;

	[Tooltip("Skip data from the Audio Source. Use if you intend to pass audio data in manually.")]
	public bool skipAudioSource;

	[Tooltip("Adjust the linear audio gain multiplier before processing lipsync")]
	public float gain = 1f;

	public bool showLaughter;

	public float laughterScore;

	private void Start()
	{
	}

	private void HandleKeyboard()
	{
		if (Input.GetKeyDown(loopbackKey))
		{
			ToggleAudioLoopback();
		}
		else if (Input.GetKeyDown(KeyCode.LeftArrow))
		{
			gain -= 1f;
			if (gain < 1f)
			{
				gain = 1f;
			}
			_ = "LINEAR GAIN: " + gain;
		}
		else if (Input.GetKeyDown(KeyCode.RightArrow))
		{
			gain += 1f;
			if (gain > 15f)
			{
				gain = 15f;
			}
			_ = "LINEAR GAIN: " + gain;
		}
	}

	private void Update()
	{
		if (enableKeyboardInput)
		{
			HandleKeyboard();
		}
		laughterScore = base.Frame.laughterScore;
	}

	public void PreprocessAudioSamples(float[] data, int channels)
	{
		for (int i = 0; i < data.Length; i++)
		{
			data[i] *= gain;
		}
	}

	public void PostprocessAudioSamples(float[] data, int channels)
	{
		if (!audioLoopback)
		{
			for (int i = 0; i < data.Length; i++)
			{
				data[i] *= 0f;
			}
		}
	}

	public void ProcessAudioSamplesRaw(float[] data, int channels)
	{
		lock (this)
		{
			if (base.Context != 0 && OVRLipSync.IsInitialized() == OVRLipSync.Result.Success)
			{
				OVRLipSync.Frame frame = base.Frame;
				OVRLipSync.ProcessFrame(base.Context, data, frame, channels == 2);
			}
		}
	}

	public void ProcessAudioSamplesRaw(short[] data, int channels)
	{
		lock (this)
		{
			if (base.Context != 0 && OVRLipSync.IsInitialized() == OVRLipSync.Result.Success)
			{
				OVRLipSync.Frame frame = base.Frame;
				OVRLipSync.ProcessFrame(base.Context, data, frame, channels == 2);
			}
		}
	}

	public void ProcessAudioSamples(float[] data, int channels)
	{
		if (OVRLipSync.IsInitialized() == OVRLipSync.Result.Success && !(audioSource == null))
		{
			PreprocessAudioSamples(data, channels);
			ProcessAudioSamplesRaw(data, channels);
			PostprocessAudioSamples(data, channels);
		}
	}

	private void OnAudioFilterRead(float[] data, int channels)
	{
		if (!skipAudioSource)
		{
			ProcessAudioSamples(data, channels);
		}
	}

	private void ToggleAudioLoopback()
	{
		audioLoopback = !audioLoopback;
	}

	private void LocalTouchEventCallback(OVRTouchpad.TouchEvent touchEvent)
	{
		string text = "LINEAR GAIN: ";
		switch (touchEvent)
		{
		case OVRTouchpad.TouchEvent.SingleTap:
			ToggleAudioLoopback();
			break;
		case OVRTouchpad.TouchEvent.Up:
			gain += 1f;
			if (gain > 15f)
			{
				gain = 15f;
			}
			text += gain;
			break;
		case OVRTouchpad.TouchEvent.Down:
			gain -= 1f;
			if (gain < 1f)
			{
				gain = 1f;
			}
			text += gain;
			break;
		}
	}
}
[RequireComponent(typeof(AudioSource))]
public class RVRFLipSyncContextBase : MonoBehaviour
{
	public AudioSource audioSource;

	[Tooltip("Which lip sync provider to use for viseme computation.")]
	public OVRLipSync.ContextProviders provider = OVRLipSync.ContextProviders.Enhanced;

	[Tooltip("Enable DSP offload on supported Android devices.")]
	public bool enableAcceleration = true;

	private OVRLipSync.Frame frame = new OVRLipSync.Frame();

	private uint context;

	private int _smoothing;

	public int Smoothing
	{
		get
		{
			return _smoothing;
		}
		set
		{
			switch (OVRLipSync.SendSignal(context, OVRLipSync.Signals.VisemeSmoothing, value, 0))
			{
			case OVRLipSync.Result.InvalidParam:
				UnityEngine.Debug.LogError("OVRLipSyncContextBase.SetSmoothing: A viseme smoothing parameter is invalid, it should be between 1 and 100!");
				break;
			default:
				UnityEngine.Debug.LogError("OVRLipSyncContextBase.SetSmoothing: An unexpected error occured.");
				break;
			case OVRLipSync.Result.Success:
				break;
			}
			_smoothing = value;
		}
	}

	public uint Context => context;

	protected OVRLipSync.Frame Frame => frame;

	private void Awake()
	{
		if (!audioSource)
		{
			audioSource = GetComponent<AudioSource>();
		}
		lock (this)
		{
			if (context == 0 && OVRLipSync.CreateContext(ref context, provider, 0, enableAcceleration) != 0)
			{
				UnityEngine.Debug.LogError("OVRLipSyncContextBase.Start ERROR: Could not create Phoneme context.");
			}
		}
	}

	private void OnDestroy()
	{
		lock (this)
		{
			if (context != 0 && OVRLipSync.DestroyContext(context) != 0)
			{
				UnityEngine.Debug.LogError("OVRLipSyncContextBase.OnDestroy ERROR: Could not delete Phoneme context.");
			}
		}
	}

	public OVRLipSync.Frame GetCurrentPhonemeFrame()
	{
		return frame;
	}

	public void SetVisemeBlend(int viseme, int amount)
	{
		switch (OVRLipSync.SendSignal(context, OVRLipSync.Signals.VisemeAmount, viseme, amount))
		{
		case OVRLipSync.Result.InvalidParam:
			UnityEngine.Debug.LogError("OVRLipSyncContextBase.SetVisemeBlend: Viseme ID is invalid.");
			break;
		default:
			UnityEngine.Debug.LogError("OVRLipSyncContextBase.SetVisemeBlend: An unexpected error occured.");
			break;
		case OVRLipSync.Result.Success:
			break;
		}
	}

	public void SetLaughterBlend(int amount)
	{
		if (OVRLipSync.SendSignal(context, OVRLipSync.Signals.LaughterAmount, amount, 0) != 0)
		{
			UnityEngine.Debug.LogError("OVRLipSyncContextBase.SetLaughterBlend: An unexpected error occured.");
		}
	}

	public OVRLipSync.Result ResetContext()
	{
		frame.Reset();
		return OVRLipSync.ResetContext(context);
	}
}
public class RVRFLipSyncContextMorphTarget : MonoBehaviour
{
	[Tooltip("Skinned Mesh Rendered target to be driven by Oculus Lipsync")]
	public SkinnedMeshRenderer skinnedMeshRenderer;

	[Tooltip("Blendshape index to trigger for each viseme.")]
	public int[] visemeToBlendTargets = Enumerable.Range(0, OVRLipSync.VisemeCount).ToArray();

	[Tooltip("Enable using the test keys defined below to manually trigger each viseme.")]
	public bool enableVisemeTestKeys;

	[Tooltip("Test keys used to manually trigger an individual viseme - by default the QWERTY row of a US keyboard.")]
	public KeyCode[] visemeTestKeys = new KeyCode[15]
	{
		KeyCode.BackQuote,
		KeyCode.Tab,
		KeyCode.Q,
		KeyCode.W,
		KeyCode.E,
		KeyCode.R,
		KeyCode.T,
		KeyCode.Y,
		KeyCode.U,
		KeyCode.I,
		KeyCode.O,
		KeyCode.P,
		KeyCode.LeftBracket,
		KeyCode.RightBracket,
		KeyCode.Backslash
	};

	[Tooltip("Test key used to manually trigger laughter and visualise the results")]
	public KeyCode laughterKey = KeyCode.CapsLock;

	[Tooltip("Blendshape index to trigger for laughter")]
	public int laughterBlendTarget = OVRLipSync.VisemeCount;

	[Range(0f, 1f)]
	[Tooltip("Laughter probability threshold above which the laughter blendshape will be activated")]
	public float laughterThreshold = 0.5f;

	[Range(0f, 3f)]
	[Tooltip("Laughter animation linear multiplier, the final output will be clamped to 1.0")]
	public float laughterMultiplier = 1.5f;

	[Range(1f, 100f)]
	[Tooltip("Smoothing of 1 will yield only the current predicted viseme, 100 will yield an extremely smooth viseme response.")]
	public int smoothAmount = 70;

	private RVRFLipSyncContextBase lipsyncContext;

	public float[] visemeValues;

	private MultiplayManager multiplayManager;

	private float[] sendLipSyncData = new float[6];

	private void Start()
	{
		multiplayManager = GetComponent<MultiplayManager>();
		if (skinnedMeshRenderer == null)
		{
			UnityEngine.Debug.LogError("LipSyncContextMorphTarget.Start Error: Please set the target Skinned Mesh Renderer to be controlled!");
			return;
		}
		lipsyncContext = GetComponent<RVRFLipSyncContextBase>();
		if (lipsyncContext == null)
		{
			UnityEngine.Debug.LogError("LipSyncContextMorphTarget.Start Error: No OVRLipSyncContext component on this object!");
		}
		else
		{
			lipsyncContext.Smoothing = smoothAmount;
		}
		visemeValues = new float[OVRLipSync.VisemeCount];
	}

	private void Update()
	{
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && lipsyncContext != null && skinnedMeshRenderer != null)
		{
			OVRLipSync.Frame currentPhonemeFrame = lipsyncContext.GetCurrentPhonemeFrame();
			if (currentPhonemeFrame != null)
			{
				SetVisemeToMorphTarget(currentPhonemeFrame);
			}
			if (smoothAmount != lipsyncContext.Smoothing)
			{
				lipsyncContext.Smoothing = smoothAmount;
			}
		}
	}

	private void CheckForKeys()
	{
		if (enableVisemeTestKeys)
		{
			for (int i = 0; i < OVRLipSync.VisemeCount; i++)
			{
				CheckVisemeKey(visemeTestKeys[i], i, 100);
			}
		}
		CheckLaughterKey();
	}

	private void SetVisemeToMorphTarget(OVRLipSync.Frame frame)
	{
		if (multiplayManager.isMicOn)
		{
			sendLipSyncData[0] = frame.Visemes[0];
			sendLipSyncData[1] = frame.Visemes[10];
			sendLipSyncData[2] = frame.Visemes[11];
			sendLipSyncData[3] = frame.Visemes[12];
			sendLipSyncData[4] = frame.Visemes[13];
			sendLipSyncData[5] = frame.Visemes[14];
		}
		else
		{
			sendLipSyncData = new float[6] { 1f, 0f, 0f, 0f, 0f, 0f };
		}
		MultiplayManager.Instance.localAvatar.lipSyncData = sendLipSyncData;
	}

	private void SetLaughterToMorphTarget(OVRLipSync.Frame frame)
	{
		if (laughterBlendTarget != -1)
		{
			float laughterScore = frame.laughterScore;
			laughterScore = ((laughterScore < laughterThreshold) ? 0f : (laughterScore - laughterThreshold));
			laughterScore = Mathf.Min(laughterScore * laughterMultiplier, 1f);
			laughterScore *= 1f / laughterThreshold;
			skinnedMeshRenderer.SetBlendShapeWeight(laughterBlendTarget, laughterScore * 100f);
		}
	}

	private void CheckVisemeKey(KeyCode key, int viseme, int amount)
	{
		if (Input.GetKeyDown(key))
		{
			lipsyncContext.SetVisemeBlend(visemeToBlendTargets[viseme], amount);
		}
		if (Input.GetKeyUp(key))
		{
			lipsyncContext.SetVisemeBlend(visemeToBlendTargets[viseme], 0);
		}
	}

	private void CheckLaughterKey()
	{
		if (Input.GetKeyDown(laughterKey))
		{
			lipsyncContext.SetLaughterBlend(100);
		}
		if (Input.GetKeyUp(laughterKey))
		{
			lipsyncContext.SetLaughterBlend(0);
		}
	}
}
[RequireComponent(typeof(AudioSource))]
public class RVRFLipSyncMicInput : MonoBehaviour
{
	public enum micActivation
	{
		HoldToSpeak,
		PushToSpeak,
		ConstantSpeak
	}

	[Tooltip("Manual specification of Audio Source - by default will use any attached to the same object.")]
	public AudioSource audioSource;

	[SerializeField]
	[Range(0f, 100f)]
	[Tooltip("Microphone input volume control.")]
	private float micInputVolume = 100f;

	[SerializeField]
	[Tooltip("Requested microphone input frequency")]
	private int micFrequency = 48000;

	[Tooltip("Microphone input control method. Hold To Speak and Push To Speak are driven with the Mic Activation Key.")]
	public micActivation micControl = micActivation.ConstantSpeak;

	[Tooltip("Will contain the string name of the selected microphone device - read only.")]
	public string selectedDevice;

	private bool micSelected;

	private int minFreq;

	private int maxFreq;

	private bool focused = true;

	private bool initialized;

	public float MicFrequency
	{
		get
		{
			return micFrequency;
		}
		set
		{
			micFrequency = (int)Mathf.Clamp(value, 0f, 96000f);
		}
	}

	private void Awake()
	{
		if (!audioSource)
		{
			audioSource = GetComponent<AudioSource>();
		}
		_ = (bool)audioSource;
	}

	private void Start()
	{
		audioSource.loop = true;
		audioSource.mute = false;
		InitializeMicrophone();
	}

	private void InitializeMicrophone()
	{
		if (!initialized && Microphone.devices.Length != 0)
		{
			selectedDevice = Microphone.devices[0].ToString();
			micSelected = true;
			GetMicCaps();
			initialized = true;
		}
	}

	private void Update()
	{
		if (!focused)
		{
			if (Microphone.IsRecording(selectedDevice))
			{
				StopMicrophone();
			}
			return;
		}
		if (!UnityEngine.Application.isPlaying)
		{
			StopMicrophone();
			return;
		}
		if (!initialized)
		{
			InitializeMicrophone();
		}
		audioSource.volume = micInputVolume / 100f;
		if (micControl == micActivation.ConstantSpeak && !Microphone.IsRecording(selectedDevice))
		{
			StartMicrophone();
		}
	}

	private void OnApplicationFocus(bool focus)
	{
		focused = focus;
		if (!focused)
		{
			StopMicrophone();
		}
	}

	private void OnApplicationPause(bool pauseStatus)
	{
		focused = !pauseStatus;
		if (!focused)
		{
			StopMicrophone();
		}
	}

	private void OnDisable()
	{
		StopMicrophone();
	}

	public void GetMicCaps()
	{
		if (micSelected)
		{
			Microphone.GetDeviceCaps(selectedDevice, out minFreq, out maxFreq);
			if (minFreq == 0 && maxFreq == 0)
			{
				UnityEngine.Debug.LogWarning("GetMicCaps warning:: min and max frequencies are 0");
				minFreq = 44100;
				maxFreq = 44100;
			}
			if (micFrequency > maxFreq)
			{
				micFrequency = maxFreq;
			}
		}
	}

	public void StartMicrophone()
	{
		if (micSelected)
		{
			audioSource.clip = Microphone.Start(selectedDevice, loop: true, 1, micFrequency);
			Stopwatch stopwatch = Stopwatch.StartNew();
			while (Microphone.GetPosition(selectedDevice) <= 0 && stopwatch.Elapsed.TotalMilliseconds < 1000.0)
			{
				Thread.Sleep(50);
			}
			if (Microphone.GetPosition(selectedDevice) <= 0)
			{
				throw new Exception("Timeout initializing microphone " + selectedDevice);
			}
			audioSource.Play();
		}
	}

	public void StopMicrophone()
	{
		if (micSelected)
		{
			if (audioSource != null && audioSource.clip != null && audioSource.clip.name == "Microphone")
			{
				audioSource.Stop();
			}
			GetComponent<RVRFLipSyncContext>().ResetContext();
			Microphone.End(selectedDevice);
		}
	}

	private float GetAveragedVolume()
	{
		return 0f;
	}
}
public class StageListDisplay : MonoBehaviour
{
	public Button[] stageButtons;

	public Image[] stageButtonImages;

	public Color selectedColor;

	public Color unselectedColor;

	public Color unableColor;

	[Header("Panel_SelectStage")]
	public GameObject panel_stageInfo;

	public Image stageImage;

	public Text stageName;

	public Image stageType;

	public Image stageTime;

	public GameObject button_goFishing;

	private DataManager dataManager;

	private Main main;

	private string selectedStage = "";

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	private void OnEnable()
	{
		DisplayStageList();
	}

	public void DisplayStageList()
	{
		panel_stageInfo.SetActive(value: false);
		button_goFishing.GetComponent<Image>().color = unselectedColor;
		button_goFishing.GetComponent<Button>().interactable = false;
		if (PhotonNetwork.IsMasterClient)
		{
			InitButtons();
			if (!button_goFishing.activeSelf)
			{
				button_goFishing.SetActive(value: true);
			}
			return;
		}
		button_goFishing.SetActive(value: false);
		for (int i = 0; i < stageButtons.Length; i++)
		{
			stageButtons[i].interactable = false;
			stageButtonImages[i].color = unselectedColor;
		}
	}

	private void InitButtons()
	{
		_ = dataManager.userData.rooms[dataManager.currentNation];
		_ = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems;
		for (int i = 0; i < stageButtons.Length; i++)
		{
			if (i <= dataManager.userData.userLv - 1)
			{
				stageButtonImages[i].color = unselectedColor;
				stageButtons[i].interactable = true;
			}
			else if (i > dataManager.userData.userLv - 1)
			{
				stageButtonImages[i].color = unselectedColor;
				stageButtons[i].interactable = false;
			}
		}
		if (dataManager.userData.boats.Count == 0)
		{
			stageButtonImages[17].color = unselectedColor;
			stageButtons[17].interactable = false;
			stageButtonImages[18].color = unselectedColor;
			stageButtons[18].interactable = false;
			stageButtonImages[19].color = unselectedColor;
			stageButtons[19].interactable = false;
		}
	}

	public void SelectStage(string sceneName)
	{
		int iDbySceneName = GetIDbySceneName(sceneName);
		List<StageItem> stageItems = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems;
		_ = dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems;
		_ = dataManager.userData.rooms[dataManager.currentNation];
		selectedStage = stageItems[iDbySceneName].stageScene;
		if (sceneName == "Stage15_hongchun")
		{
			if (checkHongchunTime() == 1)
			{
				iDbySceneName = GetIDbySceneName("Stage15_hongchun_sunset");
			}
			else if (checkHongchunTime() == 2)
			{
				iDbySceneName = GetIDbySceneName("Stage15_hongchun");
			}
		}
		panel_stageInfo.SetActive(value: true);
		stageName.GetComponent<Localize>().SetKey(stageItems[iDbySceneName].nameKey);
		stageImage.sprite = dataManager.ItemDatabase.dlcs[main.nationId].stageItems[iDbySceneName].stageImage;
		stageType.sprite = stageItems[iDbySceneName].stageTypeImage;
		stageTime.sprite = stageItems[iDbySceneName].stageTimeImage;
		for (int i = 0; i < stageButtons.Length; i++)
		{
			if (i == stageItems[iDbySceneName].level - 1)
			{
				stageButtonImages[i].color = selectedColor;
				stageButtonImages[i].color = selectedColor;
			}
			else
			{
				stageButtonImages[i].color = unselectedColor;
			}
		}
		button_goFishing.GetComponent<Image>().color = selectedColor;
		button_goFishing.GetComponent<Button>().interactable = true;
		MultiplayEventManager.Instance.SelectStageEvent(iDbySceneName);
	}

	private int checkHongchunTime()
	{
		int result = 0;
		if (dataManager.userData.cabinTime == 0)
		{
			int hour = DateTime.Now.Hour;
			if (hour >= 17 && hour <= 19)
			{
				result = 1;
			}
			else if (hour > 19 || hour < 6)
			{
				result = 2;
			}
		}
		else if (dataManager.userData.cabinTime == 1)
		{
			result = 0;
		}
		else if (dataManager.userData.cabinTime == 2)
		{
			result = 1;
		}
		else if (dataManager.userData.cabinTime == 3)
		{
			result = 2;
		}
		return result;
	}

	public void movetoStage()
	{
		dataManager.SaveUserData();
		staticLoading.Stage = selectedStage;
		if (PhotonNetwork.IsMasterClient && PhotonNetwork.InRoom)
		{
			MultiplayEventManager.Instance.GoFishingEvent();
		}
		SceneManager.LoadScene("Loading");
	}

	private int GetIDbySceneName(string sceneName)
	{
		return dataManager.ItemDatabase.dlcs[main.nationId].stageItems.Where((StageItem s) => s.stageScene == sceneName).First().id;
	}

	public void ChangeStage(int itemNum)
	{
		if (!panel_stageInfo.activeSelf)
		{
			panel_stageInfo.SetActive(value: true);
		}
		List<StageItem> stageItems = dataManager.ItemDatabase.dlcs[dataManager.currentNation].stageItems;
		stageImage.sprite = dataManager.ItemDatabase.dlcs[main.nationId].stageItems[itemNum].stageImage;
		stageType.sprite = stageItems[itemNum].stageTypeImage;
		stageTime.sprite = stageItems[itemNum].stageTimeImage;
		stageName.GetComponent<Localize>().SetKey(stageItems[itemNum].nameKey);
	}
}
public class VoipRemoteUser
{
	public ulong remoteUserID;

	public PeerConnectionState voipConnectionState;

	public RemoteAvatar remoteAvatar;

	public VoipAudioSourceHiLevel voipSource;
}
public enum VoipState
{
	INITIALIZING,
	CREATING_A_ROOM,
	WATING_IN_A_ROOM,
	JOINING_A_ROOM,
	CONNECTED_IN_A_ROOM,
	LEAVING_A_ROOM,
	SHUTDOWN
}
public class VoiceChatManager
{
	private PeerConnectionState m_state;

	private GameObject remoteHead;

	public VoiceChatManager()
	{
		Voip.SetVoipStateChangeCallback(VoipStateChangedCallback);
		Voip.SetVoipConnectRequestCallback(VoipConnectRequestCallback);
	}

	public void ConnectTo(ulong userID)
	{
		if (MultiplayManager.Instance.myID < userID)
		{
			Voip.Start(userID);
			UnityEngine.Debug.Log("Voip connect to " + userID);
		}
	}

	public void Disconnect(ulong userID)
	{
		if (userID != 0L)
		{
			Voip.Stop(userID);
			VoipRemoteUser remoteUser = MultiplayManager.GetRemoteUser(userID);
			if (remoteUser != null)
			{
				remoteUser.voipConnectionState = PeerConnectionState.Unknown;
			}
		}
	}

	private void VoipConnectRequestCallback(Message<NetworkingPeer> msg)
	{
		UnityEngine.Debug.Log("Voip request from " + msg.Data.ID);
		if (MultiplayManager.GetRemoteUser(msg.Data.ID) != null)
		{
			UnityEngine.Debug.Log("Voip request accepted from " + msg.Data.ID);
			Voip.Accept(msg.Data.ID);
		}
	}

	private void VoipStateChangedCallback(Message<NetworkingPeer> msg)
	{
		UnityEngine.Debug.LogFormat("Voip state to {0} changed to {1}", msg.Data.ID, msg.Data.State);
		if (MultiplayManager.GetRemoteUser(msg.Data.ID) != null)
		{
			m_state = msg.Data.State;
			if (m_state == PeerConnectionState.Timeout && Singleton<OculusManager>.Instance.id < msg.Data.ID)
			{
				Voip.Start(msg.Data.ID);
			}
		}
	}

	public void Mute()
	{
		Voip.SetMicrophoneMuted(VoipMuteState.Muted);
		MultiplayManager.Instance.isMicOn = false;
	}

	public void UnMute()
	{
		Voip.SetMicrophoneMuted(VoipMuteState.Unmuted);
		MultiplayManager.Instance.isMicOn = true;
	}
}
public class CommonUtil : MonoBehaviour
{
	public static string TimeToString(float time)
	{
		int num = (int)(time / 60f);
		int num2 = (int)(time % 60f);
		string text = "";
		string text2 = "";
		if (num < 10)
		{
			text += "0";
		}
		if (num2 < 10)
		{
			text2 += "0";
		}
		text += num;
		text2 += num2;
		return $"{text}:{text2}";
	}

	public static int TrueFalseBoolToZeroOne(bool value)
	{
		if (value)
		{
			return 1;
		}
		return 0;
	}

	public static bool ZeroOneToTrueFalseBool(int value)
	{
		if (value == 1)
		{
			return true;
		}
		return false;
	}
}
public class MusicInfo : MonoBehaviour, IPointerEnterHandler, IEventSystemHandler, IPointerExitHandler
{
	public GameObject popup;

	public void OnPointerEnter(PointerEventData pointerEventData)
	{
	}

	public void OnPointerExit(PointerEventData pointerEventData)
	{
	}

	public void Show(bool b)
	{
		popup.SetActive(b);
	}
}
public class MusicInfoPopupContainer : MonoBehaviour
{
	public Text desc;

	public void SetText(string text)
	{
		desc.text = text;
	}

	public void Close()
	{
	}
}
[Serializable]
public class MusicFileInfo
{
	public string fileName;

	public string path;

	public float length;
}
public class MusicPlayerManager : MonoBehaviour
{
	public static MusicPlayerManager Instance;

	public MusicController musicController;

	public PlayListV1 playList;

	public AudioSource audioSource;

	[SerializeField]
	public List<MusicFileInfo> fileInfos = new List<MusicFileInfo>();

	public int selectedIndex = -1;

	public int currentClipIndex;

	public bool loop;

	public bool shuffle;

	public bool playOnStart;

	public string pathPC = "c:\\music";

	private int volume = 5;

	private bool continuePlay;

	[Header("Status")]
	public bool isCollectingFiles;

	public bool lockNext;

	[Header("UI Refferences")]
	public Text audioTime;

	public Text audioClipNumber;

	public Text currentMusicName;

	public Image playPauseButtonImage;

	public Image prevPlayButtonImage;

	public Image nextPlayButtonImage;

	public Image loopButtonImage;

	public Image shuffleButtonImage;

	public Image rewindButtonImage;

	public Image forwardButtonImage;

	public Sprite[] playIcons;

	public Sprite[] loopIcons;

	public Sprite[] shuffleIcons;

	public Sprite[] soundVolumeIcons;

	public Sprite[] autoIcons;

	public Slider progress;

	public Toggle[] togglePages;

	public UnityEvent completedReadfileEvent;

	private Coroutine playCoroutine;

	private Coroutine playRandomCoroutine;

	private Coroutine playContiCoroutine;

	private DataManager dataManager;

	private Main main;

	private float continueTime;

	public bool IsPlaying => audioSource.isPlaying;

	private void Awake()
	{
		if (Instance == null)
		{
			Instance = this;
		}
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		if (playList == null)
		{
			playList = GetComponent<PlayListV1>();
		}
		completedReadfileEvent = new UnityEvent();
		if (!isCollectingFiles)
		{
			StartCoroutine(collectFileInfos());
		}
		StartCoroutine(waitInit());
	}

	private IEnumerator waitInit()
	{
		while (!dataManager.loaded)
		{
			yield return null;
		}
		Initialize();
	}

	private void Start()
	{
		SetLoopIcon();
		SetShuffleIcon();
		playList.createdItemsEvent.AddListener(CreatedItemsEvent);
	}

	private void Initialize()
	{
		volume = dataManager.userData.volumeMusic;
		playOnStart = dataManager.userData.playOn;
		shuffle = dataManager.userData.shuffleOn;
		loop = dataManager.userData.loopOn;
		audioSource.volume = (float)volume * 0.1f;
	}

	private void CreatedItemsEvent()
	{
		StartCoroutine(waitContinuePlay());
	}

	private IEnumerator waitContinuePlay()
	{
		while (!dataManager.loaded)
		{
			yield return null;
		}
		ContinuePlay();
	}

	private void ContinuePlay()
	{
		if (dataManager.userData.selectedAudioNumber != -1 && fileInfos.Count > dataManager.userData.selectedAudioNumber && dataManager.userData.selectedAudioTime != -1f && dataManager.userData.playOn)
		{
			lockNext = false;
			continuePlay = true;
			Play(dataManager.userData.selectedAudioNumber, dataManager.userData.selectedAudioTime);
		}
	}

	public void OnEnable()
	{
		musicController.OnAudioPlayTimeUpdate += onAudioPlayTimeUpdate;
		musicController.OnPlaybackEnd += onPlaybackEnd;
		musicController.OnAudioStart += onAudioStart;
		musicController.OnPlaybackStart += onPlaybackStart;
	}

	public void onAudioPlayTimeUpdate(Record record, float playtime)
	{
		SetTime(playtime, CommonUtil.TimeToString(record.Duration));
		if (playtime < record.Duration - 1f)
		{
			dataManager.userData.selectedAudioTime = playtime;
		}
		if (!progress.GetComponent<MusicSlider>().clicked)
		{
			progress.value = playtime / record.Duration;
		}
	}

	public void onPlaybackStart(Record record)
	{
	}

	public void onPlaybackEnd(Record record)
	{
		if (lockNext)
		{
			Next();
		}
	}

	public void onAudioStart(Record record)
	{
		if (continuePlay)
		{
			float num = continueTime / musicController.Duration;
			musicController.Position = num;
			progress.value = num;
			Invoke("unMute", 1f);
			continuePlay = false;
		}
	}

	private void unMute()
	{
		musicController.UnMute();
	}

	public IEnumerator collectFileInfos(bool refresh = false)
	{
		isCollectingFiles = true;
		if (refresh)
		{
			Stop();
		}
		if (audioSource.clip != null)
		{
			UnityEngine.Object.Destroy(audioSource.clip);
		}
		fileInfos.Clear();
		FileInfo[] files = new DirectoryInfo(GetDownloadFolder()).GetFiles("*.mp3", SearchOption.AllDirectories);
		foreach (FileInfo fileInfo in files)
		{
			string fullName = fileInfo.FullName;
			fullName = fullName.Replace(" ", "%20");
			fullName = fullName.Replace("#", "%23");
			fileInfos.Add(new MusicFileInfo
			{
				fileName = fileInfo.Name,
				path = fullName
			});
		}
		yield return new WaitForSeconds(2f);
		MonoBehaviour.print("completedReadfileEvent.Invoke");
		completedReadfileEvent.Invoke();
		isCollectingFiles = false;
	}

	private IEnumerator GetFileLengths(int index)
	{
		using WWW www = new WWW(fileInfos[index].path);
		yield return www;
		AudioClip audioClip = www.GetAudioClip(threeD: false, stream: true);
		fileInfos[index].length = audioClip.length;
		UnityEngine.Object.Destroy(audioClip);
	}

	public static string GetRootFolder()
	{
		return UnityEngine.Application.persistentDataPath.Replace("Android", "").Split(new string[1] { "//" }, StringSplitOptions.None)[0];
	}

	public static string GetDownloadFolder()
	{
		return UnityEngine.Application.persistentDataPath.Replace("Android", "").Split(new string[1] { "//" }, StringSplitOptions.None)[0] + "/Music";
	}

	public void UnPause()
	{
		playPauseButtonImage.sprite = playIcons[1];
		musicController.UnPause();
		dataManager.isPlayingMusic = true;
		for (int i = 0; i < fileInfos.Count; i++)
		{
			if (i == currentClipIndex)
			{
				playList.SetPauseIcon(currentClipIndex);
			}
			else
			{
				playList.SetPlayIcon(i);
			}
		}
	}

	public void Play(int index = 0)
	{
		if (playCoroutine != null)
		{
			StopCoroutine(playCoroutine);
		}
		playCoroutine = StartCoroutine(play(index));
	}

	public IEnumerator play(int index)
	{
		if (fileInfos.Count <= 0 || index >= fileInfos.Count)
		{
			yield break;
		}
		playList.UnSelectItem(currentClipIndex);
		currentClipIndex = index;
		SetMusicInfo();
		SetAudioClipNumber(index);
		yield return new WaitForSeconds(0.3f);
		dataManager.userData.selectedAudioNumber = index;
		playPauseButtonImage.sprite = playIcons[1];
		string path = fileInfos[index].path;
		path = path.Replace("%20", " ");
		path = path.Replace("%23", "#");
		Record record = new Record();
		record.FilePath = path;
		record.Name = fileInfos[index].fileName;
		musicController.Record = record;
		playPauseButtonImage.sprite = playIcons[1];
		musicController.Play();
		playList.SelectItem(index);
		dataManager.isPlayingMusic = true;
		for (int i = 0; i < fileInfos.Count; i++)
		{
			if (i == currentClipIndex)
			{
				playList.SetPauseIcon(currentClipIndex);
			}
			else
			{
				playList.SetPlayIcon(i);
			}
		}
		lockNext = true;
	}

	public void Play(int index, float time)
	{
		if (playContiCoroutine != null)
		{
			StopCoroutine(playContiCoroutine);
		}
		playContiCoroutine = StartCoroutine(play(index, time));
	}

	public IEnumerator play(int index, float time)
	{
		if (fileInfos.Count <= 0 || index >= fileInfos.Count)
		{
			yield break;
		}
		currentClipIndex = index;
		SetMusicInfo();
		continueTime = time;
		SetAudioClipNumber(index);
		yield return new WaitForSeconds(0.3f);
		dataManager.userData.selectedAudioNumber = index;
		playPauseButtonImage.sprite = playIcons[1];
		string path = fileInfos[index].path;
		path = path.Replace("%20", " ");
		path = path.Replace("%23", "#");
		Record record = new Record();
		record.FilePath = path;
		record.Name = fileInfos[index].fileName;
		musicController.Record = record;
		playPauseButtonImage.sprite = playIcons[1];
		if (!continuePlay)
		{
			musicController.Play();
		}
		else
		{
			musicController.Play();
			musicController.Mute();
		}
		playList.SelectItem(index);
		dataManager.isPlayingMusic = true;
		for (int i = 0; i < fileInfos.Count; i++)
		{
			if (i == currentClipIndex)
			{
				playList.SetPauseIcon(currentClipIndex);
			}
			else
			{
				playList.SetPlayIcon(i);
			}
		}
		lockNext = true;
	}

	public void PlayRandom()
	{
		if (playRandomCoroutine != null)
		{
			StopCoroutine(playRandomCoroutine);
		}
		playRandomCoroutine = StartCoroutine(playRandom());
	}

	public IEnumerator playRandom()
	{
		_ = musicController.isPaused;
		yield return null;
		int randomMusicClipIndex = GetRandomMusicClipIndex();
		if (randomMusicClipIndex != -1)
		{
			Play(randomMusicClipIndex);
			playList.CheckPage(currentClipIndex + 1);
			lockNext = true;
		}
	}

	public int GetRandomMusicClipIndex()
	{
		int result = -1;
		List<int> list = new List<int>();
		for (int i = 0; i < fileInfos.Count; i++)
		{
			if (currentClipIndex != i)
			{
				list.Add(i);
			}
		}
		if (list.Count != 0)
		{
			result = list[UnityEngine.Random.Range(0, list.Count)];
		}
		return result;
	}

	public void Pause()
	{
		playPauseButtonImage.sprite = playIcons[0];
		musicController.Pause();
		dataManager.isPlayingMusic = false;
		playList.SetPlayIcon(currentClipIndex);
	}

	public void Stop()
	{
		playPauseButtonImage.sprite = playIcons[0];
		musicController.Stop();
		dataManager.isPlayingMusic = false;
		dataManager.userData.selectedAudioNumber = -1;
		dataManager.userData.selectedAudioTime = -1f;
	}

	public void SetMusicInfo()
	{
		if (currentClipIndex >= 0 && currentClipIndex < fileInfos.Count)
		{
			ApplyInfo(currentClipIndex);
		}
	}

	private void ApplyInfo(int index)
	{
		if (index >= 0 && index < fileInfos.Count)
		{
			int num = fileInfos[index].fileName.LastIndexOf(".");
			if (num >= 0)
			{
				string text = fileInfos[index].fileName.Substring(0, num);
				currentMusicName.text = text;
			}
		}
	}

	public void SetAudioClipNumber(int index)
	{
		audioClipNumber.text = index + 1 + "/" + fileInfos.Count;
	}

	public void ToggleLoop()
	{
		loop = !loop;
		dataManager.userData.loopOn = loop;
		SetLoopIcon();
		if (shuffle)
		{
			shuffle = !shuffle;
			SetShuffleIcon();
			dataManager.userData.shuffleOn = shuffle;
		}
	}

	private void SetLoopIcon()
	{
		if (loop)
		{
			loopButtonImage.sprite = loopIcons[1];
		}
		else
		{
			loopButtonImage.sprite = loopIcons[0];
		}
	}

	private void SetShuffleIcon()
	{
		if (shuffle)
		{
			shuffleButtonImage.sprite = shuffleIcons[1];
		}
		else
		{
			shuffleButtonImage.sprite = shuffleIcons[0];
		}
	}

	public void ToggleShuffle()
	{
		shuffle = !shuffle;
		dataManager.userData.shuffleOn = shuffle;
		SetShuffleIcon();
		if (loop)
		{
			loop = !loop;
			SetLoopIcon();
			dataManager.userData.loopOn = loop;
		}
	}

	public void PreviousPlay()
	{
		lockNext = false;
		musicController.Stop();
		if (loop)
		{
			ToggleLoop();
		}
		if (shuffle)
		{
			PlayRandom();
		}
		else if (currentClipIndex == 0)
		{
			playList.CheckPage(fileInfos.Count);
			Play(fileInfos.Count - 1);
		}
		else if (currentClipIndex - 1 >= 0)
		{
			playList.CheckPage(currentClipIndex);
			Play(currentClipIndex - 1);
		}
	}

	public void NextPlay()
	{
		lockNext = false;
		musicController.Stop();
		if (loop)
		{
			Loop();
		}
		else if (shuffle)
		{
			PlayRandom();
		}
		else if (currentClipIndex == fileInfos.Count - 1)
		{
			Play();
			playList.CheckPage(1);
		}
		else if (currentClipIndex + 1 < fileInfos.Count)
		{
			Play(currentClipIndex + 1);
			playList.CheckPage(currentClipIndex + 1);
		}
		else
		{
			Stop();
		}
	}

	public void SetTime(float time, string totalTime)
	{
		if (!(audioTime == null))
		{
			audioTime.text = CommonUtil.TimeToString(time) + " / " + totalTime;
		}
	}

	public void Loop()
	{
		Play(currentClipIndex);
	}

	public void Next()
	{
		lockNext = false;
		musicController.Stop();
		if (loop)
		{
			Loop();
		}
		else if (shuffle)
		{
			PlayRandom();
		}
		else if (currentClipIndex == fileInfos.Count - 1)
		{
			Play();
		}
		else if (currentClipIndex + 1 < fileInfos.Count)
		{
			Play(currentClipIndex + 1);
		}
		else
		{
			Stop();
		}
	}

	public void SetVolume(int num)
	{
		volume = num;
		audioSource.volume = (float)volume * 0.1f;
	}

	public void PlayButtonEvent()
	{
		if (IsPlaying)
		{
			Pause();
			playOnStart = false;
		}
		else
		{
			if (musicController.isPaused)
			{
				UnPause();
			}
			else
			{
				Play();
			}
			playOnStart = true;
		}
		dataManager.userData.playOn = playOnStart;
		SetMusicInfo();
	}

	public void RefreshEvent()
	{
		if (!isCollectingFiles)
		{
			StartCoroutine(collectFileInfos(refresh: true));
		}
	}

	public void RewindButtonEvent()
	{
		if (audioSource.clip == null)
		{
			return;
		}
		_ = audioSource.clip.length;
		_ = audioSource.time;
		if (IsPlaying)
		{
			if (musicController.Position * musicController.Duration - 10f > 0f)
			{
				musicController.Position = (musicController.Position * musicController.Duration - 10f) / musicController.Duration;
			}
			else
			{
				audioSource.time = 0f;
			}
		}
	}

	public void ForwardButtonEvent()
	{
		if (!(audioSource.clip == null) && IsPlaying)
		{
			if (musicController.Position * musicController.Duration + 10f < musicController.Duration)
			{
				musicController.Position = (musicController.Position * musicController.Duration + 10f) / musicController.Duration;
			}
			else
			{
				NextPlay();
			}
		}
	}

	public void StopButtonEvent()
	{
		Instance.Stop();
	}

	public void LoopTypeButtonEvent()
	{
		ToggleLoop();
	}

	public void ShuffleButtonEvent()
	{
		ToggleShuffle();
	}

	public void NextPlayButtonEvent()
	{
		if (!isCollectingFiles)
		{
			NextPlay();
		}
	}

	public void PreviousPlayButtonEvent()
	{
		if (!isCollectingFiles)
		{
			PreviousPlay();
		}
	}

	public void NextPageButtonEvent()
	{
		if (!isCollectingFiles)
		{
			playList.NextPage();
		}
	}

	public void PrevPageButtonEvent()
	{
		if (!isCollectingFiles)
		{
			playList.PrevPage();
		}
	}
}
public class MusicSlider : MonoBehaviour, IPointerDownHandler, IEventSystemHandler, IPointerUpHandler
{
	public bool clicked;

	private Slider slider;

	private void Awake()
	{
		slider = GetComponent<Slider>();
	}

	private void Start()
	{
	}

	public void OnPointerDown(PointerEventData eventData)
	{
		MonoBehaviour.print("OnPointerDown");
		clicked = true;
	}

	public void OnPointerUp(PointerEventData eventData)
	{
		clicked = false;
		if (!(MusicPlayerManager.Instance.audioSource.clip == null))
		{
			if (slider.value >= 0.999f)
			{
				slider.value = 0.999f;
			}
			if (MusicPlayerManager.Instance.musicController.isAudioPlaying)
			{
				MusicPlayerManager.Instance.progress.value = slider.value;
				MusicPlayerManager.Instance.musicController.Position = slider.value;
			}
		}
	}

	public void ChangeValue(float value)
	{
	}

	public void OnClick()
	{
		MonoBehaviour.print("OnClick");
	}

	public void OnPointerClick(PointerEventData pointerEventData)
	{
		MonoBehaviour.print("OnPointerClick");
	}

	private void Update()
	{
	}
}
public class PlayListElement : MonoBehaviour
{
	public Text itemNumber;

	public Text itemName;

	public Text itemLength;

	public Image playButtonImage;

	public int index = -1;

	private MusicPlayerManager musicPlayerManager;

	private Image overImage;

	public bool isError;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		if (MusicPlayerManager.Instance != null)
		{
			musicPlayerManager = MusicPlayerManager.Instance;
		}
		else
		{
			musicPlayerManager = UnityEngine.Object.FindObjectOfType<MusicPlayerManager>();
		}
		overImage = GetComponent<Image>();
	}

	public void PlayButtonEvent()
	{
		musicPlayerManager.lockNext = false;
		musicPlayerManager.musicController.Stop();
		musicPlayerManager.playOnStart = true;
		dataManager.userData.playOn = musicPlayerManager.playOnStart;
		musicPlayerManager.Play(index);
		musicPlayerManager.playList.UnOverAllItems();
		SetOver();
	}

	public void SetName(string value)
	{
		itemName.text = value;
	}

	public void SetLength(string value)
	{
		itemLength.text = value;
	}

	public void SetPlayIcon()
	{
		if (musicPlayerManager.fileInfos[index] != null)
		{
			playButtonImage.sprite = musicPlayerManager.playIcons[0];
		}
	}

	public void SetPauseIcon()
	{
		if (musicPlayerManager.fileInfos[index] != null)
		{
			playButtonImage.sprite = musicPlayerManager.playIcons[1];
		}
	}

	public void SetSelected()
	{
		SetPauseIcon();
		itemName.color = Color.black;
		itemLength.color = Color.black;
		SetOver();
	}

	public void SetUnSelected()
	{
		SetPlayIcon();
		itemName.color = Color.white;
		itemLength.color = Color.white;
		SetUnOver();
	}

	public void SetOver()
	{
		overImage.enabled = true;
	}

	public void SetUnOver()
	{
		overImage.enabled = false;
	}
}
public class PlayListV1 : MonoBehaviour
{
	public GameObject playListItemPrefab;

	public Transform playListItemParent;

	public List<PlayListElement> playListItems = new List<PlayListElement>();

	public int currentPageNum;

	public int totalPageNum;

	public int pagePerItemNum = 10;

	public UnityEvent createdItemsEvent;

	private MusicPlayerManager musicPlayerManager;

	private void Awake()
	{
		if (MusicPlayerManager.Instance != null)
		{
			musicPlayerManager = MusicPlayerManager.Instance;
		}
		createdItemsEvent = new UnityEvent();
	}

	private void OnDestroy()
	{
	}

	private void completed()
	{
		musicPlayerManager = MusicPlayerManager.Instance;
		for (int i = 0; i < playListItems.Count; i++)
		{
			UnityEngine.Object.Destroy(playListItems[i].gameObject);
		}
		playListItems.Clear();
		totalPageNum = Mathf.CeilToInt((float)musicPlayerManager.fileInfos.Count / (float)pagePerItemNum);
		currentPageNum = 1;
		for (int j = 0; j < musicPlayerManager.fileInfos.Count; j++)
		{
			AddNewItem(j);
		}
		for (int k = 0; k < musicPlayerManager.fileInfos.Count; k++)
		{
			if (k < currentPageNum * pagePerItemNum)
			{
				playListItems[k].gameObject.SetActive(value: true);
			}
			else
			{
				playListItems[k].gameObject.SetActive(value: false);
			}
		}
		createdItemsEvent.Invoke();
	}

	public void SetPage(int page)
	{
		if (page > totalPageNum)
		{
			return;
		}
		currentPageNum = page;
		int num = (page - 1) * pagePerItemNum;
		int num2 = ((page != totalPageNum) ? (page * pagePerItemNum) : musicPlayerManager.fileInfos.Count);
		for (int i = 0; i < musicPlayerManager.fileInfos.Count; i++)
		{
			if (i >= num && num2 > i)
			{
				playListItems[i].gameObject.SetActive(value: true);
			}
			else
			{
				playListItems[i].gameObject.SetActive(value: false);
			}
		}
	}

	public int GetPage(int songNum)
	{
		return Mathf.CeilToInt((float)songNum / (float)pagePerItemNum);
	}

	public void CheckPage(int songNum)
	{
		if (songNum <= playListItems.Count && songNum > 0)
		{
			int page = GetPage(songNum);
			if (currentPageNum != page)
			{
				SetPage(page);
			}
		}
	}

	public void NextPage()
	{
		if (currentPageNum + 1 <= totalPageNum)
		{
			UnOverItem(musicPlayerManager.selectedIndex);
			SetPage(currentPageNum + 1);
		}
	}

	public void PrevPage()
	{
		if (currentPageNum - 1 > 0)
		{
			UnOverItem(musicPlayerManager.selectedIndex);
			SetPage(currentPageNum - 1);
		}
	}

	private void Start()
	{
		MusicPlayerManager.Instance.completedReadfileEvent.AddListener(completed);
	}

	private void Update()
	{
	}

	public void AddNewItem(int index)
	{
		GameObject obj = UnityEngine.Object.Instantiate(playListItemPrefab, Vector3.zero, Quaternion.identity);
		obj.transform.SetParent(playListItemParent);
		obj.transform.localPosition = Vector3.zero;
		obj.transform.localRotation = Quaternion.identity;
		obj.transform.localScale = Vector3.one;
		obj.name = "Item" + index;
		PlayListElement component = obj.GetComponent<PlayListElement>();
		component.SetName(System.IO.Path.GetFileNameWithoutExtension(MusicPlayerManager.Instance.fileInfos[index].fileName));
		component.index = index;
		playListItems.Add(component);
	}

	public void SetPauseIcon(int index)
	{
		playListItems[index].SetPauseIcon();
	}

	public void SetPlayIcon(int index)
	{
		playListItems[index].SetPlayIcon();
	}

	public void SelectItem(int index)
	{
		playListItems[index].SetSelected();
	}

	public void UnSelectItem(int index)
	{
		if (!playListItems[index].isError)
		{
			playListItems[index].SetUnSelected();
		}
	}

	public void OverItem(int index)
	{
		playListItems[index].SetOver();
	}

	public void UnOverItem(int index)
	{
		playListItems[index].SetUnOver();
	}

	public void UnOverAllItems()
	{
		foreach (PlayListElement playListItem in playListItems)
		{
			playListItem.SetUnOver();
		}
	}
}
public class VolumeContainer : MonoBehaviour
{
	public List<GameObject> volumes;

	public void SetVolume(int volume)
	{
		foreach (GameObject volume2 in volumes)
		{
			_ = volume2;
		}
	}

	private void Start()
	{
	}

	private void Update()
	{
	}
}
public class npcFishingAni : MonoBehaviour
{
	private Animator anim;

	public float castingTime = 2f;

	public float idleTime = 10f;

	public float reelingTime = 5f;

	private void Start()
	{
		anim = GetComponent<Animator>();
		StartCoroutine(stateChange());
	}

	private IEnumerator stateChange()
	{
		while (true)
		{
			yield return new WaitForSeconds(idleTime + UnityEngine.Random.Range(0f, idleTime));
			anim.SetInteger("state", 2);
			yield return new WaitForSeconds(reelingTime);
			anim.SetInteger("state", 0);
			yield return new WaitForSeconds(castingTime);
			anim.SetInteger("state", 1);
		}
	}
}
public class OpenItembox : MonoBehaviour
{
	private fishSetScript fishset;

	private Collider col;

	private Main main;

	private void Start()
	{
		main = Singleton<Main>.Instance;
		col = GetComponent<Collider>();
		fishset = GetComponent<fishSetScript>();
	}

	private void OnTriggerEnter(Collider other)
	{
		if (fishset.isCatched && other.CompareTag("hand"))
		{
			col.enabled = false;
			main.stuffControl.createStuff(base.transform.position);
			UnityEngine.Object.Destroy(base.gameObject);
		}
	}
}
public class openUI : MonoBehaviour
{
	public float speed = 1f;

	private float scaleY;

	private void Start()
	{
		base.transform.localScale = new Vector3(base.transform.localScale.x, scaleY, base.transform.localScale.z);
	}

	private void Update()
	{
		if (scaleY < 1f)
		{
			scaleY += Time.deltaTime * speed;
		}
		else
		{
			scaleY = 1f;
		}
		base.transform.localScale = new Vector3(base.transform.localScale.x, scaleY, base.transform.localScale.z);
	}
}
public class PanelFade : MonoBehaviour
{
	public Material m;

	public float _colorSpeed = 0.01f;

	private Color c;

	private bool runFadeOut;

	private bool runFadeIn;

	private string levelName = "";

	private void Start()
	{
		FadeOut();
	}

	private void Update()
	{
		if (runFadeIn)
		{
			if (c.a < 1f)
			{
				c.a += _colorSpeed;
			}
			else
			{
				runFadeIn = false;
				if (levelName != "")
				{
					SceneManager.LoadScene(levelName);
				}
			}
			m.color = c;
		}
		if (runFadeOut)
		{
			if (c.a > 0f)
			{
				c.a -= _colorSpeed;
			}
			else
			{
				runFadeOut = false;
			}
			m.color = c;
		}
	}

	public void FadeIn()
	{
		c = m.color;
		c.a = 0f;
		runFadeIn = true;
	}

	public void FadeOut()
	{
		c = m.color;
		c.a = 1f;
		runFadeOut = true;
	}

	public void loadLevel(string _levelName)
	{
		levelName = _levelName;
		FadeIn();
	}
}
public class randomAni : MonoBehaviour
{
	private Animation ani;

	private void Start()
	{
		ani = GetComponent<Animation>();
		randomPlay();
	}

	private void randomPlay()
	{
		float time = UnityEngine.Random.Range(0f, 5f);
		ani["Take 001"].time = time;
		ani["Take 001"].speed = 1f;
		ani.Play("Take 001");
	}
}
public class rawtextureScroll : MonoBehaviour
{
	public float scrollSpeed = 1f;

	public float scrollSpeedY;

	private RawImage rawImage;

	private void Start()
	{
		rawImage = GetComponent<RawImage>();
	}

	private void Update()
	{
		rawImage.material.SetTextureOffset("_MainTex", new Vector2(Time.time * scrollSpeed, Time.time * scrollSpeedY));
	}
}
public class resetPosition : MonoBehaviour
{
	public control_Fishing control;

	public GameObject player;

	private void Start()
	{
	}

	private void Update()
	{
	}
}
public class resultUser : MonoBehaviour
{
	public float xDistance = 250f;

	public Sprite[] userPics;

	public Text userName;

	public Image userPic;

	public Text userScore;

	public GameObject myPlayer;

	public GameObject winner;

	private void Awake()
	{
		winner.SetActive(value: false);
		myPlayer.SetActive(value: false);
	}

	private void Start()
	{
	}

	public float setResult(int totalUser, int ID, string Name, int Score, bool isMyine, bool win)
	{
		userPic.sprite = userPics[ID - 1];
		userName.text = Name.ToString();
		userScore.text = Score.ToString("n0");
		if (isMyine)
		{
			myPlayer.SetActive(value: true);
		}
		if (win)
		{
			MonoBehaviour.print("you are win");
			winner.SetActive(value: true);
		}
		return ((float)(ID - 1) - (float)(totalUser - 1) * 0.5f) * xDistance;
	}
}
public class Rope2 : MonoBehaviour
{
	[Serializable]
	public class TentacleData
	{
		public float length;

		public float radius;

		public float spacing;

		public float friction;

		public List<Node> nodes;

		public TentacleData(float _length, float _radius, float _spacing, float _friction)
		{
			length = _length;
			radius = _radius;
			spacing = _spacing;
			friction = _friction;
			nodes = new List<Node>();
			for (int i = 0; (float)i < _length; i++)
			{
				nodes.Add(new Node());
			}
		}

		public void Move(Vector2 _position)
		{
			nodes[0].x = _position.x;
			nodes[0].y = _position.y;
		}

		public void Update(float _radius, float _length, float _friction, float _wind, float _gravity)
		{
			int num = 0;
			int num2 = 0;
			float num3 = 0f;
			float num4 = 0f;
			float num5 = 0f;
			float num6 = 0f;
			Node node = new Node();
			Node node2 = nodes[0];
			_radius = radius * _radius;
			float num7 = _radius / length;
			num2 = 0;
			num = 1;
			while ((float)num < length)
			{
				node = nodes[num];
				node.x += node.vx;
				node.y += node.vy;
				num3 = node2.x - node.x;
				num4 = Mathf.Atan2(node2.y - node.y, num3);
				num5 = node.x + Mathf.Cos(num4) * spacing * _length;
				num6 = node.y + Mathf.Sin(num4) * spacing * _length;
				node.x = node2.x - (num5 - node.x);
				node.y = node2.y - (num6 - node.y);
				node.vx = node.x - node.ox;
				node.vy = node.y - node.oy;
				node.vx *= friction * (1f - _friction);
				node.vy *= friction * (1f - _friction);
				node.vx += _wind;
				node.vy += _gravity;
				node.ox = node.x;
				node.oy = node.y;
				Mathf.Sin(num4 + (float)Math.PI / 2f);
				Mathf.Cos(num4 + (float)Math.PI / 2f);
				radius -= num7;
				node2 = node;
				num++;
				num2++;
			}
		}
	}

	[Serializable]
	public class Node
	{
		public float x;

		public float y;

		public float ox;

		public float oy;

		public float vx;

		public float vy;

		public Node(float _x, float _y)
		{
			x = _x;
			y = _y;
			ox = _x;
			oy = _y;
		}

		public Node()
		{
		}

		public Vector2 GetVec()
		{
			return new Vector2(x, y);
		}
	}

	[Serializable]
	public class Setting
	{
		public float length;

		public float radius;

		public float gravity;

		public float wind;

		public float friction;

		public float thickness;

		public Setting(float _length, float _radius, float _gravity, float _wind, float _friction, float _thickness)
		{
			length = _length;
			radius = _radius;
			gravity = _gravity;
			wind = _wind;
			friction = _friction;
			thickness = _thickness;
		}
	}

	public float CustomLength;

	public TentacleData _tentacleData;

	public GameObject origin;

	public Setting _setting;

	private void Start()
	{
		_setting = new Setting(10f, 5f, 0.5f, -0.5f, 0.02f, 2f);
		_tentacleData = new TentacleData(20f, 2f, 0.5f, 0.2f);
	}

	private void Update()
	{
		_tentacleData.Move(origin.transform.position);
		_tentacleData.Update(_setting.radius, _setting.length, _setting.friction, _setting.wind, _setting.gravity);
	}

	private void OnDrawGizmos()
	{
		Gizmos.color = Color.cyan;
		for (int i = 0; i < _tentacleData.nodes.Count - 1; i++)
		{
			Gizmos.DrawLine(_tentacleData.nodes[i].GetVec(), _tentacleData.nodes[i + 1].GetVec());
		}
	}
}
public class RopeGeneratorScript : MonoBehaviour
{
	private LineRenderer line;

	private List<GameObject> joints;

	public int vertexCount;

	private float NTDistance;

	public GameObject emptyPrefab;

	public GameObject StartPos;

	public GameObject EndPos;

	private void Start()
	{
		joints = new List<GameObject>();
		line = GetComponent<LineRenderer>();
		line.SetWidth(0.05f, 0.05f);
		line.SetColors(Color.black, Color.blue);
		for (int i = 0; i < vertexCount; i++)
		{
			float x = StartPos.transform.position.x + (EndPos.transform.position.x - StartPos.transform.position.x) / (float)vertexCount * (float)i;
			float y = StartPos.transform.position.y + (EndPos.transform.position.y - StartPos.transform.position.y) / (float)vertexCount * (float)i;
			float z = StartPos.transform.position.z + (EndPos.transform.position.z - StartPos.transform.position.z) / (float)vertexCount * (float)i;
			joints.Add(UnityEngine.Object.Instantiate(emptyPrefab, new Vector3(x, y, z), Quaternion.identity));
		}
		for (int j = 0; j < joints.Count - 1; j++)
		{
			joints[j].transform.parent = base.transform;
			joints[j].GetComponent<HingeJoint>().connectedBody = joints[j + 1].GetComponent<Rigidbody>();
		}
		joints[joints.Count - 1].transform.parent = base.transform;
		joints[0].AddComponent<HingeJoint>().connectedBody = StartPos.GetComponent<Rigidbody>();
		joints[0].transform.parent = base.transform;
		joints[vertexCount - 1].GetComponent<HingeJoint>().connectedBody = EndPos.GetComponent<Rigidbody>();
	}

	private void Update()
	{
		line.SetVertexCount(joints.Count);
		for (int i = 0; i < joints.Count; i++)
		{
			line.SetPosition(i, joints[i].transform.position);
		}
	}
}
[RequireComponent(typeof(Rigidbody))]
[RequireComponent(typeof(LineRenderer))]
public class RopeScript : MonoBehaviour
{
	public Transform target;

	public float resolution = 0.5f;

	public float ropeDrag = 0.1f;

	public float ropeMass = 0.1f;

	public float ropeColRadius = 0.5f;

	private Vector3[] segmentPos;

	private GameObject[] joints;

	private LineRenderer line;

	private int segments;

	private bool rope;

	public Vector3 swingAxis = new Vector3(1f, 1f, 1f);

	public float lowTwistLimit = -100f;

	public float highTwistLimit = 100f;

	public float swing1Limit = 20f;

	private void Awake()
	{
		BuildRope();
	}

	private void Update()
	{
		if (rope && Input.GetKeyDown("d"))
		{
			DestroyRope();
		}
		if (!rope && Input.GetKeyDown("r"))
		{
			BuildRope();
		}
	}

	private void LateUpdate()
	{
		if (rope)
		{
			for (int i = 0; i < segments; i++)
			{
				if (i == 0)
				{
					line.SetPosition(i, base.transform.position);
				}
				else if (i == segments - 1)
				{
					line.SetPosition(i, target.transform.position);
				}
				else
				{
					line.SetPosition(i, joints[i].transform.position);
				}
			}
			line.enabled = true;
		}
		else
		{
			line.enabled = false;
		}
	}

	private void BuildRope()
	{
		line = base.gameObject.GetComponent<LineRenderer>();
		segments = (int)(Vector3.Distance(base.transform.position, target.position) * resolution);
		line.SetVertexCount(segments);
		segmentPos = new Vector3[segments];
		joints = new GameObject[segments];
		segmentPos[0] = base.transform.position;
		segmentPos[segments - 1] = target.position;
		int num = segments - 1;
		Vector3 vector = (target.position - base.transform.position) / num;
		for (int i = 1; i < segments; i++)
		{
			Vector3 vector2 = vector * i + base.transform.position;
			segmentPos[i] = vector2;
			AddJointPhysics(i);
		}
		CharacterJoint characterJoint = target.gameObject.AddComponent<CharacterJoint>();
		characterJoint.connectedBody = joints[joints.Length - 1].transform.GetComponent<Rigidbody>();
		characterJoint.swingAxis = swingAxis;
		SoftJointLimit softJointLimit = characterJoint.lowTwistLimit;
		softJointLimit.limit = lowTwistLimit;
		characterJoint.lowTwistLimit = softJointLimit;
		softJointLimit = characterJoint.highTwistLimit;
		softJointLimit.limit = highTwistLimit;
		characterJoint.highTwistLimit = softJointLimit;
		softJointLimit = characterJoint.swing1Limit;
		softJointLimit.limit = swing1Limit;
		characterJoint.swing1Limit = softJointLimit;
		target.parent = base.transform;
		rope = true;
	}

	private void AddJointPhysics(int n)
	{
		joints[n] = new GameObject("Joint_" + n);
		joints[n].transform.parent = base.transform;
		Rigidbody rigidbody = joints[n].AddComponent<Rigidbody>();
		SphereCollider sphereCollider = joints[n].AddComponent<SphereCollider>();
		CharacterJoint characterJoint = joints[n].AddComponent<CharacterJoint>();
		characterJoint.swingAxis = swingAxis;
		SoftJointLimit softJointLimit = characterJoint.lowTwistLimit;
		softJointLimit.limit = lowTwistLimit;
		characterJoint.lowTwistLimit = softJointLimit;
		softJointLimit = characterJoint.highTwistLimit;
		softJointLimit.limit = highTwistLimit;
		characterJoint.highTwistLimit = softJointLimit;
		softJointLimit = characterJoint.swing1Limit;
		softJointLimit.limit = swing1Limit;
		characterJoint.swing1Limit = softJointLimit;
		joints[n].transform.position = segmentPos[n];
		rigidbody.drag = ropeDrag;
		rigidbody.mass = ropeMass;
		sphereCollider.radius = ropeColRadius;
		if (n == 1)
		{
			characterJoint.connectedBody = base.transform.GetComponent<Rigidbody>();
		}
		else
		{
			characterJoint.connectedBody = joints[n - 1].GetComponent<Rigidbody>();
		}
	}

	private void DestroyRope()
	{
		rope = false;
		for (int i = 0; i < joints.Length - 1; i++)
		{
			UnityEngine.Object.Destroy(joints[i]);
		}
		segmentPos = new Vector3[0];
		joints = new GameObject[0];
		segments = 0;
	}
}
[RequireComponent(typeof(Rigidbody))]
[RequireComponent(typeof(LineRenderer))]
public class RopeScript2 : MonoBehaviour
{
	public Transform target;

	public float resolution = 0.5f;

	public float ropeDrag = 0.1f;

	public float ropeMass = 0.1f;

	public float ropeColRadius = 0.5f;

	private Vector3[] segmentPos;

	private GameObject[] joints;

	private LineRenderer line;

	private int segments;

	private bool rope;

	public Vector3 swingAxis = new Vector3(1f, 1f, 1f);

	public float lowTwistLimit = -100f;

	public float highTwistLimit = 100f;

	public float swing1Limit = 20f;

	private void Awake()
	{
		BuildRope();
	}

	private void Update()
	{
		if (rope && Input.GetKeyDown("d"))
		{
			DestroyRope();
		}
		if (!rope && Input.GetKeyDown("r"))
		{
			BuildRope();
		}
	}

	private void LateUpdate()
	{
		if (rope)
		{
			for (int i = 0; i < segments; i++)
			{
				if (i == 0)
				{
					line.SetPosition(i, base.transform.position);
				}
				else if (i == segments - 1)
				{
					line.SetPosition(i, target.transform.position);
				}
				else
				{
					line.SetPosition(i, joints[i].transform.position);
				}
			}
			line.enabled = true;
		}
		else
		{
			line.enabled = false;
		}
	}

	private void BuildRope()
	{
		line = base.gameObject.GetComponent<LineRenderer>();
		segments = (int)(Vector3.Distance(base.transform.position, target.position) * resolution);
		line.SetVertexCount(segments);
		segmentPos = new Vector3[segments];
		joints = new GameObject[segments];
		segmentPos[0] = base.transform.position;
		segmentPos[segments - 1] = target.position;
		int num = segments - 1;
		Vector3 vector = (target.position - base.transform.position) / num;
		for (int i = 1; i < segments; i++)
		{
			Vector3 vector2 = vector * i + base.transform.position;
			segmentPos[i] = vector2;
			AddJointPhysics(i);
		}
		CharacterJoint characterJoint = target.gameObject.AddComponent<CharacterJoint>();
		characterJoint.connectedBody = joints[joints.Length - 1].transform.GetComponent<Rigidbody>();
		characterJoint.swingAxis = swingAxis;
		SoftJointLimit softJointLimit = characterJoint.lowTwistLimit;
		softJointLimit.limit = lowTwistLimit;
		characterJoint.lowTwistLimit = softJointLimit;
		softJointLimit = characterJoint.highTwistLimit;
		softJointLimit.limit = highTwistLimit;
		characterJoint.highTwistLimit = softJointLimit;
		softJointLimit = characterJoint.swing1Limit;
		softJointLimit.limit = swing1Limit;
		characterJoint.swing1Limit = softJointLimit;
		target.parent = base.transform;
		rope = true;
	}

	private void AddJointPhysics(int n)
	{
		joints[n] = new GameObject("Joint_" + n);
		joints[n].transform.parent = base.transform;
		Rigidbody rigidbody = joints[n].AddComponent<Rigidbody>();
		SphereCollider sphereCollider = joints[n].AddComponent<SphereCollider>();
		CharacterJoint characterJoint = joints[n].AddComponent<CharacterJoint>();
		characterJoint.swingAxis = swingAxis;
		SoftJointLimit softJointLimit = characterJoint.lowTwistLimit;
		softJointLimit.limit = lowTwistLimit;
		characterJoint.lowTwistLimit = softJointLimit;
		softJointLimit = characterJoint.highTwistLimit;
		softJointLimit.limit = highTwistLimit;
		characterJoint.highTwistLimit = softJointLimit;
		softJointLimit = characterJoint.swing1Limit;
		softJointLimit.limit = swing1Limit;
		characterJoint.swing1Limit = softJointLimit;
		joints[n].transform.position = segmentPos[n];
		rigidbody.drag = ropeDrag;
		rigidbody.mass = ropeMass;
		sphereCollider.radius = ropeColRadius;
		if (n == 1)
		{
			characterJoint.connectedBody = base.transform.GetComponent<Rigidbody>();
		}
		else
		{
			characterJoint.connectedBody = joints[n - 1].GetComponent<Rigidbody>();
		}
	}

	private void DestroyRope()
	{
		rope = false;
		for (int i = 0; i < joints.Length - 1; i++)
		{
			UnityEngine.Object.Destroy(joints[i]);
		}
		segmentPos = new Vector3[0];
		joints = new GameObject[0];
		segments = 0;
	}
}
public class rotate : MonoBehaviour
{
	public float speed = 1f;

	private void Start()
	{
	}

	private void Update()
	{
		base.transform.Rotate(Vector3.forward * speed * Time.deltaTime);
	}
}
public class rotateLockAxis : MonoBehaviour
{
	public Transform target;

	public Transform parent;

	private void Start()
	{
	}

	private void Update()
	{
		base.transform.position = parent.position;
		Quaternion quaternion = Quaternion.LookRotation(target.position - base.transform.position, parent.up);
		base.transform.rotation = Quaternion.Euler(quaternion.x, 0f, 0f);
	}
}
public class ScreenFadeControl : MonoBehaviour
{
	public Material fadeMaterial;

	private void OnCustomPostRender()
	{
		fadeMaterial.SetPass(0);
		GL.PushMatrix();
		GL.LoadOrtho();
		GL.Color(fadeMaterial.color);
		GL.Begin(7);
		GL.Vertex3(0f, 0f, -12f);
		GL.Vertex3(0f, 1f, -12f);
		GL.Vertex3(1f, 1f, -12f);
		GL.Vertex3(1f, 0f, -12f);
		GL.End();
		GL.PopMatrix();
	}
}
public class ScreenFader : MonoBehaviour
{
	public bool fadeIn = true;

	public float fadeTime = 2f;

	public Color fadeColor = new Color(0f, 0f, 0f, 1f);

	public Material fadeMaterial;

	public GameObject fader;

	public IEnumerator FadeOut()
	{
		fader.SetActive(value: true);
		float elapsedTime = 0f;
		Color color = fadeColor;
		color.a = 0f;
		fadeMaterial.color = color;
		while (elapsedTime < fadeTime)
		{
			yield return new WaitForEndOfFrame();
			elapsedTime += Time.deltaTime;
			color.a = Mathf.Clamp01(elapsedTime / fadeTime);
			fadeMaterial.color = color;
		}
	}

	public IEnumerator FadeIn()
	{
		float elapsedTime = 0f;
		Color color3 = (fadeMaterial.color = fadeColor);
		Color color = color3;
		while (elapsedTime < fadeTime)
		{
			yield return new WaitForEndOfFrame();
			elapsedTime += Time.deltaTime;
			color.a = 1f - Mathf.Clamp01(elapsedTime / fadeTime);
			fadeMaterial.color = color;
		}
		fader.SetActive(value: false);
	}
}
public enum AESBits
{
	BITS128,
	BITS192,
	BITS256
}
public class AESEncryptor
{
	private string secretKey;

	private AESBits encryptionBits;

	private byte[] salt = new byte[15]
	{
		0, 1, 2, 28, 29, 30, 3, 4, 5, 15,
		32, 33, 173, 175, 164
	};

	public AESEncryptor(string password, AESBits encryptionBits)
	{
		switch (Singleton<DataManager>.Instance.targetPlatform)
		{
		case DEVICE_TYPE.GO:
			secretKey = "castian2";
			break;
		case DEVICE_TYPE.QUEST:
			secretKey = "castian2";
			break;
		case DEVICE_TYPE.RIFT:
			secretKey = "castian2r";
			break;
		case DEVICE_TYPE.OTHERS:
			secretKey = "castian2";
			break;
		}
		this.encryptionBits = encryptionBits;
	}

	public byte[] Encrypt(byte[] data)
	{
		Rfc2898DeriveBytes rfc2898DeriveBytes = new Rfc2898DeriveBytes(secretKey, salt, 50);
		return encryptionBits switch
		{
			AESBits.BITS128 => Encrypt(data, rfc2898DeriveBytes.GetBytes(16), rfc2898DeriveBytes.GetBytes(16)), 
			AESBits.BITS192 => Encrypt(data, rfc2898DeriveBytes.GetBytes(24), rfc2898DeriveBytes.GetBytes(16)), 
			AESBits.BITS256 => Encrypt(data, rfc2898DeriveBytes.GetBytes(32), rfc2898DeriveBytes.GetBytes(16)), 
			_ => null, 
		};
	}

	public string Encrypt(string data)
	{
		Rfc2898DeriveBytes rfc2898DeriveBytes = new Rfc2898DeriveBytes(secretKey, salt, 50);
		return encryptionBits switch
		{
			AESBits.BITS128 => Encrypt(data, rfc2898DeriveBytes.GetBytes(16), rfc2898DeriveBytes.GetBytes(16)), 
			AESBits.BITS192 => Encrypt(data, rfc2898DeriveBytes.GetBytes(24), rfc2898DeriveBytes.GetBytes(16)), 
			AESBits.BITS256 => Encrypt(data, rfc2898DeriveBytes.GetBytes(32), rfc2898DeriveBytes.GetBytes(16)), 
			_ => null, 
		};
	}

	private byte[] Encrypt(byte[] data, byte[] key, byte[] iV)
	{
		MemoryStream memoryStream = new MemoryStream();
		CryptoStream cryptoStream = new CryptoStream(memoryStream, new RijndaelManaged
		{
			Key = key,
			IV = iV
		}.CreateEncryptor(), CryptoStreamMode.Write);
		cryptoStream.Write(data, 0, data.Length);
		cryptoStream.Dispose();
		return memoryStream.ToArray();
	}

	public byte[] Decrypt(byte[] data)
	{
		Rfc2898DeriveBytes rfc2898DeriveBytes = new Rfc2898DeriveBytes(secretKey, salt, 50);
		return encryptionBits switch
		{
			AESBits.BITS128 => Decrypt(data, rfc2898DeriveBytes.GetBytes(16), rfc2898DeriveBytes.GetBytes(16)), 
			AESBits.BITS192 => Decrypt(data, rfc2898DeriveBytes.GetBytes(24), rfc2898DeriveBytes.GetBytes(16)), 
			AESBits.BITS256 => Decrypt(data, rfc2898DeriveBytes.GetBytes(32), rfc2898DeriveBytes.GetBytes(16)), 
			_ => null, 
		};
	}

	public string Decrypt(string data)
	{
		Rfc2898DeriveBytes rfc2898DeriveBytes = new Rfc2898DeriveBytes(secretKey, salt, 50);
		return encryptionBits switch
		{
			AESBits.BITS128 => Decrypt(data, rfc2898DeriveBytes.GetBytes(16), rfc2898DeriveBytes.GetBytes(16)), 
			AESBits.BITS192 => Decrypt(data, rfc2898DeriveBytes.GetBytes(24), rfc2898DeriveBytes.GetBytes(16)), 
			AESBits.BITS256 => Decrypt(data, rfc2898DeriveBytes.GetBytes(32), rfc2898DeriveBytes.GetBytes(16)), 
			_ => null, 
		};
	}

	private byte[] Decrypt(byte[] data, byte[] key, byte[] iv)
	{
		MemoryStream memoryStream = new MemoryStream();
		CryptoStream cryptoStream = new CryptoStream(memoryStream, new RijndaelManaged
		{
			Key = key,
			IV = iv
		}.CreateDecryptor(), CryptoStreamMode.Write);
		cryptoStream.Write(data, 0, data.Length);
		cryptoStream.Dispose();
		return memoryStream.ToArray();
	}

	public string Decrypt(string data, byte[] key, byte[] iv)
	{
		RijndaelManaged obj = new RijndaelManaged
		{
			Mode = CipherMode.CBC,
			Padding = PaddingMode.PKCS7
		};
		byte[] array = Convert.FromBase64String(data);
		obj.Key = key;
		obj.IV = iv;
		byte[] bytes = obj.CreateDecryptor().TransformFinalBlock(array, 0, array.Length);
		return Encoding.UTF8.GetString(bytes);
	}

	public string Encrypt(string data, byte[] key, byte[] iv)
	{
		ICryptoTransform cryptoTransform = new RijndaelManaged
		{
			Mode = CipherMode.CBC,
			Padding = PaddingMode.PKCS7,
			Key = key,
			IV = iv
		}.CreateEncryptor();
		byte[] bytes = Encoding.UTF8.GetBytes(data);
		return Convert.ToBase64String(cryptoTransform.TransformFinalBlock(bytes, 0, bytes.Length));
	}
}
public class SelfDestruct : MonoBehaviour
{
	public float selfdestruct_in = 4f;

	private void Start()
	{
		if (selfdestruct_in != 0f)
		{
			UnityEngine.Object.Destroy(base.gameObject, selfdestruct_in);
		}
	}

	private void OnDisable()
	{
		UnityEngine.Object.Destroy(base.gameObject);
	}
}
public class DetailPropContainer : DetailContainerBase
{
	public Text gradeValue;

	private void Start()
	{
		infos = new string[3];
		infos[0] = "You can quickly lower fish's stamina";
		infos[1] = "You can quickly fill the gauge";
		infos[2] = "Casting distance will increase";
	}
}
public class PurchaseControl : MonoBehaviour
{
	private void Start()
	{
	}

	private void Update()
	{
	}
}
public class ShopAquaItem : MonoBehaviour
{
	public int ID;

	public Text itemName;

	public Image image;

	private void Start()
	{
	}

	public void ApplyProperties()
	{
	}

	public void Select()
	{
		ShopManager.Instance.SetDescription(ItemType.Aquarium, ID);
	}
}
public class ShopBoatItem : MonoBehaviour
{
	public int ID;

	public ItemType shipType;

	public Text itemName;

	public Image image;

	public void ApplyProperties()
	{
	}

	public void Select()
	{
		ShopManager.Instance.SetDescription(ItemType.Boat, ID);
	}
}
public class ShopDetailRodContainer : MonoBehaviour
{
	public Text equipName;

	public Text typeValue;

	public Text gradeValue;

	public Text powerValue;

	public Text actionValue;

	public Text distanceValue;

	public Slider powerSlider;

	public Image descImage;

	private void Start()
	{
	}

	private void Update()
	{
	}
}
public class ShopFurnitureItem : MonoBehaviour
{
	public int ID;

	public Text itemName;

	public Image image;

	public ItemType type;

	private void Start()
	{
	}

	public void ApplyProperties()
	{
	}

	public void Select()
	{
		ShopManager.Instance.SetDescription(type, ID);
	}
}
public class ShopInteriorItem : MonoBehaviour
{
	public int ID;

	public Text itemName;

	public Image image;

	public ItemType type;

	private void Start()
	{
	}

	public void ApplyProperties()
	{
	}

	public void Select()
	{
		ShopManager.Instance.SetDescription(type, ID);
	}
}
public class ShopLineItem : MonoBehaviour
{
	public int ID;

	public Text itemName;

	public Image image;

	private void Start()
	{
	}

	public void ApplyProperties()
	{
	}

	public void Select()
	{
		ShopManager.Instance.SetDescription(ItemType.Line, ID);
	}
}
public class ShopLureItem : MonoBehaviour
{
	public int ID;

	public Text itemName;

	public Image image;

	public void ApplyProperties()
	{
	}

	public void Select()
	{
		ShopManager.Instance.SetDescription(ItemType.Lure, ID);
	}
}
public class ShopManager : MonoBehaviour
{
	public static ShopManager Instance;

	private Color color_buttonSelected;

	private Color color_buttonUnSelected;

	private Color color_buttonUnInteractive;

	public Text level;

	public Slider levelSlider;

	public Text expMaxText;

	public Text gold;

	public GameObject shopRodItemPrefab;

	public GameObject shopReelItemPrefab;

	public GameObject shopLureItemPrefab;

	public GameObject shopAquaItemPrefab;

	public GameObject shopRoomItemPrefab;

	public GameObject shopFurnitureItemPrefab;

	public GameObject shopBoatItemPrefab;

	public GameObject shopPropItemPrefab;

	public List<GameObject> rodItems;

	public List<GameObject> reelItems;

	public List<GameObject> lureItems;

	public List<GameObject> aquaItems;

	public List<GameObject> interiorItems;

	public List<GameObject> furnitureItems;

	public List<GameObject> boatItems;

	public List<GameObject> propItems;

	public int selectedTabIndex;

	public GameObject ItemContent;

	public ToggleTab[] tabs;

	public List<List<GameObject>> items = new List<List<GameObject>>();

	public bool isCreated;

	public List<DetailContainerBase> detailContainers;

	private AudioSource audios;

	public ItemType currenItemType;

	public DetailContainerBase currentDetail;

	public GameObject itemsPanel;

	public GameObject categoriesPanel;

	public int currentCategory;

	public int currentPageNum;

	public int totalPageNum;

	public int pagePerItemNum = 6;

	public GameObject prevBtn;

	public GameObject nextBtn;

	public Text pageNum;

	public Text cagegoryName;

	private List<string> categories = new List<string> { "RODS", "REELS", "LURES", "AQUARIUM", "ROOMS", "FURNITURE", "BOATS", "PROPS" };

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		Instance = this;
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
		audios = GetComponent<AudioSource>();
		color_buttonSelected = Singleton<AchievementController>.Instance.color_buttonSelected;
		color_buttonUnSelected = Singleton<AchievementController>.Instance.color_buttonUnSelected;
		color_buttonUnInteractive = Singleton<AchievementController>.Instance.color_buttonUninteractive;
	}

	private void UpdateStatus()
	{
		level.text = dataManager.userData.userLv.ToString();
		if (dataManager.userData.userLv == dataManager.maxLevel)
		{
			expMaxText.enabled = true;
			levelSlider.gameObject.SetActive(value: false);
		}
		else
		{
			expMaxText.enabled = false;
			levelSlider.gameObject.SetActive(value: true);
			levelSlider.value = dataManager.userExpBar;
		}
		gold.text = dataManager.userData.userGold.ToString();
	}

	private void OnEnable()
	{
		if (!isCreated)
		{
			CreateItems(0);
		}
		UpdateStatus();
		ShowCategoriesPanel(show: true);
		ShowItemsPanel(show: false);
		HideDetailWindowAll();
		totalPageNum = Mathf.CeilToInt((float)items[currentCategory].Count / (float)pagePerItemNum);
		SetPage(1);
	}

	public void ShowDetailWindow(int index)
	{
		for (int i = 0; i < detailContainers.Count; i++)
		{
			if (index == i && detailContainers[i] != null)
			{
				currentDetail = detailContainers[i];
				detailContainers[i].gameObject.SetActive(value: true);
			}
			else if (detailContainers[i] != null && currentDetail != detailContainers[i])
			{
				detailContainers[i].gameObject.SetActive(value: false);
			}
		}
	}

	public void HideDetailWindowAll()
	{
		foreach (DetailContainerBase detailContainer in detailContainers)
		{
			if (detailContainer != null)
			{
				detailContainer.gameObject.SetActive(value: false);
			}
		}
	}

	private void CreateItems(int index)
	{
		RodItem[] rodSItems = dataManager.ItemDatabase.rodSItems;
		foreach (RodItem rodItem in rodSItems)
		{
			GameObject gameObject = UnityEngine.Object.Instantiate(shopRodItemPrefab, ItemContent.transform);
			gameObject.GetComponent<ShopRodItem>().rodType = ItemType.RodS;
			gameObject.GetComponent<ShopRodItem>().ID = rodItem.ID;
			gameObject.GetComponent<ShopRodItem>().itemName.GetComponent<Localize>().SetKey(rodItem.nameKey);
			gameObject.GetComponent<ShopRodItem>().image.sprite = rodItem.shopIconImage;
			rodItems.Add(gameObject);
		}
		rodSItems = dataManager.ItemDatabase.rodCItems;
		foreach (RodItem rodItem2 in rodSItems)
		{
			GameObject gameObject2 = UnityEngine.Object.Instantiate(shopRodItemPrefab, ItemContent.transform);
			gameObject2.GetComponent<ShopRodItem>().rodType = ItemType.RodC;
			gameObject2.GetComponent<ShopRodItem>().ID = rodItem2.ID;
			gameObject2.GetComponent<ShopRodItem>().itemName.GetComponent<Localize>().SetKey(rodItem2.nameKey);
			gameObject2.GetComponent<ShopRodItem>().image.sprite = rodItem2.shopIconImage;
			rodItems.Add(gameObject2);
		}
		ReelItem[] reelSItems = dataManager.ItemDatabase.reelSItems;
		foreach (ReelItem reelItem in reelSItems)
		{
			GameObject gameObject3 = UnityEngine.Object.Instantiate(shopReelItemPrefab, ItemContent.transform);
			gameObject3.GetComponent<ShopReelItem>().reelType = ItemType.ReelS;
			gameObject3.GetComponent<ShopReelItem>().ID = reelItem.ID;
			gameObject3.GetComponent<ShopReelItem>().itemName.GetComponent<Localize>().SetKey(reelItem.nameKey);
			gameObject3.GetComponent<ShopReelItem>().image.sprite = reelItem.shopIconImage;
			reelItems.Add(gameObject3);
		}
		reelSItems = dataManager.ItemDatabase.reelCItems;
		foreach (ReelItem reelItem2 in reelSItems)
		{
			GameObject gameObject4 = UnityEngine.Object.Instantiate(shopReelItemPrefab, ItemContent.transform);
			gameObject4.GetComponent<ShopReelItem>().reelType = ItemType.ReelC;
			gameObject4.GetComponent<ShopReelItem>().ID = reelItem2.ID;
			gameObject4.GetComponent<ShopReelItem>().itemName.GetComponent<Localize>().SetKey(reelItem2.nameKey);
			gameObject4.GetComponent<ShopReelItem>().image.sprite = reelItem2.shopIconImage;
			reelItems.Add(gameObject4);
		}
		LureItem[] array = dataManager.ItemDatabase.lureItems;
		foreach (LureItem lureItem in array)
		{
			GameObject gameObject5 = UnityEngine.Object.Instantiate(shopLureItemPrefab, ItemContent.transform);
			gameObject5.GetComponent<ShopLureItem>().ID = lureItem.ID;
			gameObject5.GetComponent<ShopLureItem>().itemName.GetComponent<Localize>().SetKey(lureItem.nameKey);
			gameObject5.GetComponent<ShopLureItem>().image.sprite = lureItem.shopIconImage;
			lureItems.Add(gameObject5);
		}
		foreach (AquaItem aquaItem in dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems)
		{
			if (main.nationId == aquaItem.nationId && main.lobbyId == aquaItem.lobbyId && !aquaItem.defaultItem && !aquaItem.achievementItem)
			{
				GameObject gameObject6 = UnityEngine.Object.Instantiate(shopAquaItemPrefab, ItemContent.transform);
				gameObject6.GetComponent<ShopAquaItem>().ID = aquaItem.ID;
				gameObject6.GetComponent<ShopAquaItem>().itemName.GetComponent<Localize>().SetKey(aquaItem.nameKey);
				gameObject6.GetComponent<ShopAquaItem>().image.sprite = aquaItem.shopIconImage;
				aquaItems.Add(gameObject6);
			}
		}
		foreach (RoomItem roomItem in dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems)
		{
			if (!roomItem.defaultItem && dataManager.currentNation == roomItem.nationId)
			{
				GameObject gameObject7 = UnityEngine.Object.Instantiate(shopRoomItemPrefab, ItemContent.transform);
				gameObject7.GetComponent<ShopInteriorItem>().ID = roomItem.ID;
				gameObject7.GetComponent<ShopInteriorItem>().type = ItemType.Room;
				gameObject7.GetComponent<ShopInteriorItem>().itemName.GetComponent<Localize>().SetKey(roomItem.multiLineNameKey);
				gameObject7.GetComponent<ShopInteriorItem>().image.sprite = roomItem.shopIconImage;
				interiorItems.Add(gameObject7);
			}
		}
		foreach (FurnitureItem furnitureItem in dataManager.ItemDatabase.dlcs[dataManager.currentNation].furnitureItems)
		{
			if (main.nationId == furnitureItem.nationId && main.lobbyId == furnitureItem.lobbyId && dataManager.userData.rooms[main.nationId].items[furnitureItem.lobbyId].purchased)
			{
				GameObject gameObject8 = UnityEngine.Object.Instantiate(shopFurnitureItemPrefab, ItemContent.transform);
				gameObject8.GetComponent<ShopFurnitureItem>().ID = furnitureItem.ID;
				gameObject8.GetComponent<ShopFurnitureItem>().type = ItemType.Furniture;
				gameObject8.GetComponent<ShopFurnitureItem>().itemName.GetComponent<Localize>().SetKey(furnitureItem.nameKey);
				gameObject8.GetComponent<ShopFurnitureItem>().image.sprite = furnitureItem.shopIconImage;
				furnitureItems.Add(gameObject8);
			}
		}
		BoatItem[] array2 = dataManager.ItemDatabase.boatItems;
		foreach (BoatItem boatItem in array2)
		{
			GameObject gameObject9 = UnityEngine.Object.Instantiate(shopBoatItemPrefab, ItemContent.transform);
			gameObject9.GetComponent<ShopBoatItem>().shipType = ItemType.Boat;
			gameObject9.GetComponent<ShopBoatItem>().ID = boatItem.ID;
			gameObject9.GetComponent<ShopBoatItem>().itemName.GetComponent<Localize>().SetKey(boatItem.nameKey);
			gameObject9.GetComponent<ShopBoatItem>().image.sprite = boatItem.shopIconImage;
			boatItems.Add(gameObject9);
		}
		PropItem[] array3 = dataManager.ItemDatabase.propItems;
		foreach (PropItem propItem in array3)
		{
			GameObject gameObject10 = UnityEngine.Object.Instantiate(shopPropItemPrefab, ItemContent.transform);
			gameObject10.GetComponent<ShopPropItem>().itemType = ItemType.Prop;
			gameObject10.GetComponent<ShopPropItem>().ID = propItem.ID;
			gameObject10.GetComponent<ShopPropItem>().itemName.text = propItem.ItemName;
			gameObject10.GetComponent<ShopPropItem>().image.sprite = propItem.shopIconImage;
			propItems.Add(gameObject10);
		}
		items.Add(rodItems);
		items.Add(reelItems);
		items.Add(lureItems);
		items.Add(aquaItems);
		items.Add(interiorItems);
		items.Add(furnitureItems);
		items.Add(boatItems);
		items.Add(propItems);
		ShowItems(0);
		isCreated = true;
	}

	public void ReloadItems(Action done)
	{
		totalPageNum = Mathf.CeilToInt((float)items[currentCategory].Count / (float)pagePerItemNum);
		if (totalPageNum > 1)
		{
			prevBtn.SetActive(value: true);
			nextBtn.SetActive(value: true);
			pageNum.gameObject.SetActive(value: true);
		}
		else
		{
			prevBtn.SetActive(value: false);
			nextBtn.SetActive(value: false);
			pageNum.gameObject.SetActive(value: false);
		}
		currentPageNum = 1;
		rodItems.Clear();
		reelItems.Clear();
		lureItems.Clear();
		aquaItems.Clear();
		interiorItems.Clear();
		furnitureItems.Clear();
		boatItems.Clear();
		propItems.Clear();
		items.Clear();
		Transform[] componentsInChildren = ItemContent.GetComponentsInChildren<Transform>(includeInactive: true);
		foreach (Transform transform in componentsInChildren)
		{
			if (transform.gameObject != ItemContent)
			{
				UnityEngine.Object.Destroy(transform.gameObject);
			}
		}
		CreateItems(0);
		done?.Invoke();
	}

	private IEnumerator DelayShow()
	{
		yield return new WaitForSeconds(2f);
		ShowItems(0);
	}

	private void ShowItems(int index)
	{
		int num = tabs.Count();
		for (int i = 0; i < num; i++)
		{
			if (i == index)
			{
				foreach (GameObject item in items[index])
				{
					item.SetActive(value: true);
				}
				continue;
			}
			foreach (GameObject item2 in items[i])
			{
				item2.SetActive(value: false);
			}
		}
		SetPage(currentPageNum);
	}

	public void ShowCategoriesPanel(bool show)
	{
		categoriesPanel.SetActive(show);
	}

	public void ShowItemsPanel(bool show)
	{
		itemsPanel.SetActive(show);
	}

	public void ClickTab(int index)
	{
		currentCategory = index;
		cagegoryName.text = "CATEGORIES : " + categories[index];
		ShowItemsPanel(show: true);
		ShowCategoriesPanel(show: false);
		tabs[index].ClickTab();
		UnClickTab(index);
		ReloadItems(delegate
		{
			ShowItems(index);
		});
		HideDetailWindowAll();
	}

	public void UnClickTab(int index)
	{
		for (int i = 0; i < tabs.Length; i++)
		{
			if (i != index)
			{
				tabs[i].UnClickTab();
			}
		}
	}

	public void SetDescription(ItemType itemType, int index)
	{
		currenItemType = itemType;
		ShowDetailWindow((int)currenItemType);
		detailContainers[(int)currenItemType].itemType = currenItemType;
		switch (currenItemType)
		{
		case ItemType.RodS:
			detailContainers[(int)currenItemType].selectedId = dataManager.ItemDatabase.rodSItems[index].ID;
			detailContainers[(int)currenItemType].itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.rodSItems[index].nameKey);
			detailContainers[(int)currenItemType].typeValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.rodSItems[index].typeKey);
			((DetailRodContainer)detailContainers[(int)currenItemType]).gradeValue.text = dataManager.ItemDatabase.rodSItems[index].grade.ToString();
			((DetailRodContainer)detailContainers[(int)currenItemType]).powerValue.text = dataManager.ItemDatabase.rodSItems[index].power.ToString();
			((DetailRodContainer)detailContainers[(int)currenItemType]).powerSlider.value = dataManager.ItemDatabase.rodSItems[index].power;
			((DetailRodContainer)detailContainers[(int)currenItemType]).actionValue.text = dataManager.ItemDatabase.rodSItems[index].action.ToString();
			((DetailRodContainer)detailContainers[(int)currenItemType]).actionSlider.value = dataManager.ItemDatabase.rodSItems[index].action;
			((DetailRodContainer)detailContainers[(int)currenItemType]).distanceValue.text = dataManager.ItemDatabase.rodSItems[index].distance.ToString();
			((DetailRodContainer)detailContainers[(int)currenItemType]).distanceSlider.value = dataManager.ItemDatabase.rodSItems[index].distance;
			detailContainers[(int)currenItemType].descImage.sprite = dataManager.ItemDatabase.rodSItems[index].descImage;
			detailContainers[(int)currenItemType].infoValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.rodSItems[index].descKey);
			detailContainers[(int)currenItemType].price.text = dataManager.ItemDatabase.rodSItems[index].price.ToString("N0");
			detailContainers[(int)currenItemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
			detailContainers[(int)currenItemType].unlockLv.text = detailContainers[(int)currenItemType].unlockLv.text + dataManager.ItemDatabase.rodSItems[index].unlocklv;
			break;
		case ItemType.RodC:
			detailContainers[(int)currenItemType].selectedId = dataManager.ItemDatabase.rodCItems[index].ID;
			detailContainers[(int)currenItemType].itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.rodCItems[index].nameKey);
			detailContainers[(int)currenItemType].typeValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.rodCItems[index].typeKey);
			((DetailRodContainer)detailContainers[(int)currenItemType]).gradeValue.text = dataManager.ItemDatabase.rodCItems[index].grade.ToString();
			((DetailRodContainer)detailContainers[(int)currenItemType]).powerValue.text = dataManager.ItemDatabase.rodCItems[index].power.ToString();
			((DetailRodContainer)detailContainers[(int)currenItemType]).powerSlider.value = dataManager.ItemDatabase.rodCItems[index].power;
			((DetailRodContainer)detailContainers[(int)currenItemType]).actionValue.text = dataManager.ItemDatabase.rodCItems[index].action.ToString();
			((DetailRodContainer)detailContainers[(int)currenItemType]).actionSlider.value = dataManager.ItemDatabase.rodCItems[index].action;
			((DetailRodContainer)detailContainers[(int)currenItemType]).distanceValue.text = dataManager.ItemDatabase.rodCItems[index].distance.ToString();
			((DetailRodContainer)detailContainers[(int)currenItemType]).distanceSlider.value = dataManager.ItemDatabase.rodCItems[index].distance;
			detailContainers[(int)currenItemType].descImage.sprite = dataManager.ItemDatabase.rodCItems[index].descImage;
			detailContainers[(int)currenItemType].infoValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.rodCItems[index].descKey);
			detailContainers[(int)currenItemType].price.text = dataManager.ItemDatabase.rodCItems[index].price.ToString("N0");
			detailContainers[(int)currenItemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
			detailContainers[(int)currenItemType].unlockLv.text = detailContainers[(int)currenItemType].unlockLv.text + dataManager.ItemDatabase.rodCItems[index].unlocklv;
			break;
		case ItemType.ReelS:
			detailContainers[(int)currenItemType].selectedId = dataManager.ItemDatabase.reelSItems[index].ID;
			detailContainers[(int)currenItemType].itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.reelSItems[index].nameKey);
			detailContainers[(int)currenItemType].typeValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.reelSItems[index].typeKey);
			((DetailReelContainer)detailContainers[(int)currenItemType]).gradeValue.text = dataManager.ItemDatabase.reelSItems[index].grade.ToString();
			((DetailReelContainer)detailContainers[(int)currenItemType]).speedValue.text = dataManager.ItemDatabase.reelSItems[index].tension.ToString();
			((DetailReelContainer)detailContainers[(int)currenItemType]).speedSlider.value = dataManager.ItemDatabase.reelSItems[index].tension;
			((DetailReelContainer)detailContainers[(int)currenItemType]).powerValue.text = dataManager.ItemDatabase.reelSItems[index].power.ToString();
			((DetailReelContainer)detailContainers[(int)currenItemType]).powerSlider.value = dataManager.ItemDatabase.reelSItems[index].power;
			((DetailReelContainer)detailContainers[(int)currenItemType]).lengthValue.text = dataManager.ItemDatabase.reelSItems[index].length.ToString();
			((DetailReelContainer)detailContainers[(int)currenItemType]).lengthSlider.value = dataManager.ItemDatabase.reelSItems[index].length;
			detailContainers[(int)currenItemType].descImage.sprite = dataManager.ItemDatabase.reelSItems[index].descImage;
			detailContainers[(int)currenItemType].infoValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.reelSItems[index].descKey);
			detailContainers[(int)currenItemType].price.text = dataManager.ItemDatabase.reelSItems[index].price.ToString("N0");
			detailContainers[(int)currenItemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
			detailContainers[(int)currenItemType].unlockLv.text = detailContainers[(int)currenItemType].unlockLv.text + dataManager.ItemDatabase.reelSItems[index].unlocklv;
			break;
		case ItemType.ReelC:
			detailContainers[(int)currenItemType].selectedId = dataManager.ItemDatabase.reelCItems[index].ID;
			detailContainers[(int)currenItemType].itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.reelCItems[index].nameKey);
			detailContainers[(int)currenItemType].typeValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.reelCItems[index].typeKey);
			((DetailReelContainer)detailContainers[(int)currenItemType]).gradeValue.text = dataManager.ItemDatabase.reelCItems[index].grade.ToString();
			((DetailReelContainer)detailContainers[(int)currenItemType]).speedValue.text = dataManager.ItemDatabase.reelCItems[index].tension.ToString();
			((DetailReelContainer)detailContainers[(int)currenItemType]).speedSlider.value = dataManager.ItemDatabase.reelCItems[index].tension;
			((DetailReelContainer)detailContainers[(int)currenItemType]).powerValue.text = dataManager.ItemDatabase.reelCItems[index].power.ToString();
			((DetailReelContainer)detailContainers[(int)currenItemType]).powerSlider.value = dataManager.ItemDatabase.reelCItems[index].power;
			((DetailReelContainer)detailContainers[(int)currenItemType]).lengthValue.text = dataManager.ItemDatabase.reelCItems[index].length.ToString();
			((DetailReelContainer)detailContainers[(int)currenItemType]).lengthSlider.value = dataManager.ItemDatabase.reelCItems[index].length;
			detailContainers[(int)currenItemType].descImage.sprite = dataManager.ItemDatabase.reelCItems[index].descImage;
			detailContainers[(int)currenItemType].infoValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.reelCItems[index].descKey);
			detailContainers[(int)currenItemType].price.text = dataManager.ItemDatabase.reelCItems[index].price.ToString("N0");
			if (dataManager.userData.rodC.Count == 0)
			{
				ShowUnlockButton((int)currenItemType);
				detailContainers[(int)currenItemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVStore/0022");
			}
			else
			{
				detailContainers[(int)currenItemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
				detailContainers[(int)currenItemType].unlockLv.text = detailContainers[(int)currenItemType].unlockLv.text + dataManager.ItemDatabase.reelCItems[index].unlocklv;
			}
			break;
		case ItemType.Lure:
			detailContainers[(int)currenItemType].selectedId = dataManager.ItemDatabase.lureItems[index].ID;
			detailContainers[(int)currenItemType].itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.lureItems[index].nameKey);
			((DetailLureContainer)detailContainers[(int)currenItemType]).gradeValue.text = dataManager.ItemDatabase.lureItems[index].grade.ToString();
			((DetailLureContainer)detailContainers[(int)currenItemType]).targetValue.text = GetTargetName(index);
			((DetailLureContainer)detailContainers[(int)currenItemType]).rangeValue.text = dataManager.ItemDatabase.lureItems[index].range.ToString();
			((DetailLureContainer)detailContainers[(int)currenItemType]).RangeSlider.value = dataManager.ItemDatabase.lureItems[index].range;
			((DetailLureContainer)detailContainers[(int)currenItemType]).stuckValue.text = dataManager.ItemDatabase.lureItems[index].stuck.ToString();
			((DetailLureContainer)detailContainers[(int)currenItemType]).StuckSlider.value = dataManager.ItemDatabase.lureItems[index].stuck;
			detailContainers[(int)currenItemType].descImage.sprite = dataManager.ItemDatabase.lureItems[index].descImage;
			detailContainers[(int)currenItemType].infoValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.lureItems[index].descKey);
			detailContainers[(int)currenItemType].price.text = dataManager.ItemDatabase.lureItems[index].price.ToString("N0");
			detailContainers[(int)currenItemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
			detailContainers[(int)currenItemType].unlockLv.text = detailContainers[(int)currenItemType].unlockLv.text + dataManager.ItemDatabase.lureItems[index].unlocklv;
			break;
		case ItemType.Aquarium:
			detailContainers[(int)currenItemType].selectedId = dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[index].ID;
			detailContainers[(int)currenItemType].itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[index].nameKey);
			detailContainers[(int)currenItemType].descImage.sprite = dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[index].descImage;
			detailContainers[(int)currenItemType].infoValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[index].descKey);
			detailContainers[(int)currenItemType].price.text = dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[index].price.ToString("N0");
			detailContainers[(int)currenItemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
			detailContainers[(int)currenItemType].unlockLv.text = detailContainers[(int)currenItemType].unlockLv.text + dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[index].unlocklv;
			break;
		case ItemType.Room:
			detailContainers[(int)currenItemType].selectedId = dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems[index].ID;
			detailContainers[(int)currenItemType].itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems[index].nameKey);
			detailContainers[(int)currenItemType].descImage.sprite = dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems[index].descImage;
			detailContainers[(int)currenItemType].price.text = dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems[index].price.ToString("N0");
			detailContainers[(int)currenItemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
			detailContainers[(int)currenItemType].unlockLv.text = detailContainers[(int)currenItemType].unlockLv.text + dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems[index].unlocklv;
			break;
		case ItemType.Furniture:
			detailContainers[(int)currenItemType].selectedId = dataManager.ItemDatabase.dlcs[dataManager.currentNation].furnitureItems[index].ID;
			detailContainers[(int)currenItemType].itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.dlcs[dataManager.currentNation].furnitureItems[index].nameKey);
			detailContainers[(int)currenItemType].descImage.sprite = dataManager.ItemDatabase.dlcs[dataManager.currentNation].furnitureItems[index].descImage;
			detailContainers[(int)currenItemType].price.text = dataManager.ItemDatabase.dlcs[dataManager.currentNation].furnitureItems[index].price.ToString("N0");
			detailContainers[(int)currenItemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
			detailContainers[(int)currenItemType].unlockLv.text = detailContainers[(int)currenItemType].unlockLv.text + dataManager.ItemDatabase.dlcs[dataManager.currentNation].furnitureItems[index].unlocklv;
			break;
		case ItemType.Boat:
			detailContainers[(int)currenItemType].selectedId = dataManager.ItemDatabase.boatItems[index].ID;
			detailContainers[(int)currenItemType].itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.boatItems[index].nameKey);
			((DetailBoatContainer)detailContainers[(int)currenItemType]).gradeValue.text = dataManager.ItemDatabase.boatItems[index].grade.ToString();
			detailContainers[(int)currenItemType].descImage.sprite = dataManager.ItemDatabase.boatItems[index].descImage;
			detailContainers[(int)currenItemType].infoValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.boatItems[index].descKey);
			detailContainers[(int)currenItemType].price.text = dataManager.ItemDatabase.boatItems[index].price.ToString("N0");
			detailContainers[(int)currenItemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
			detailContainers[(int)currenItemType].unlockLv.text = detailContainers[(int)currenItemType].unlockLv.text + dataManager.ItemDatabase.boatItems[index].unlocklv;
			break;
		case ItemType.Prop:
			detailContainers[(int)currenItemType].selectedId = dataManager.ItemDatabase.propItems[index].ID;
			detailContainers[(int)currenItemType].itemName.text = dataManager.ItemDatabase.propItems[index].ItemName;
			detailContainers[(int)currenItemType].descImage.sprite = dataManager.ItemDatabase.propItems[index].descImage;
			detailContainers[(int)currenItemType].price.text = dataManager.ItemDatabase.propItems[index].price.ToString("N0");
			break;
		}
		CheckPurchase((int)currenItemType);
	}

	public string GetTargetName(int index)
	{
		string text = "";
		bool[] targetFish = dataManager.ItemDatabase.lureItems[index].targetFish;
		string keyTranslation = LocalizationManager.GetKeyTranslation("LodgeTVStore/0018");
		string keyTranslation2 = LocalizationManager.GetKeyTranslation("LodgeTVStore/0019");
		string keyTranslation3 = LocalizationManager.GetKeyTranslation("LodgeTVStore/0020");
		string keyTranslation4 = LocalizationManager.GetKeyTranslation("LodgeTVStore/0021");
		if (targetFish[0])
		{
			text += keyTranslation;
		}
		if (targetFish[1])
		{
			if (text.Length > 0)
			{
				text += ", ";
			}
			text += keyTranslation2;
		}
		if (targetFish[2])
		{
			if (text.Length > 0)
			{
				text += ", ";
			}
			text += keyTranslation3;
		}
		if (targetFish[3])
		{
			if (text.Length > 0)
			{
				text += ", ";
			}
			text += keyTranslation4;
		}
		return text;
	}

	public void ShowSoldButton(int index)
	{
		detailContainers[index].panel_Unlock.SetActive(value: false);
		detailContainers[index].panel_NoGold.SetActive(value: false);
		detailContainers[index].panel_Sold.SetActive(value: true);
		detailContainers[index].panel_Buy.SetActive(value: false);
	}

	public void ShowUnlockButton(int index)
	{
		detailContainers[index].panel_Unlock.SetActive(value: true);
		detailContainers[index].panel_NoGold.SetActive(value: false);
		detailContainers[index].panel_Sold.SetActive(value: false);
		detailContainers[index].panel_Buy.SetActive(value: false);
	}

	public void ShowNoGoldButton(int index)
	{
		detailContainers[index].panel_Unlock.SetActive(value: false);
		detailContainers[index].panel_NoGold.SetActive(value: true);
		detailContainers[index].panel_Sold.SetActive(value: false);
		detailContainers[index].panel_Buy.SetActive(value: false);
	}

	public void ShowBuyButton(int index)
	{
		detailContainers[index].panel_Unlock.SetActive(value: false);
		detailContainers[index].panel_NoGold.SetActive(value: false);
		detailContainers[index].panel_Sold.SetActive(value: false);
		detailContainers[index].panel_Buy.SetActive(value: true);
	}

	private void CheckPurchase(int itemType)
	{
		switch (itemType)
		{
		case 0:
		{
			int iD5 = dataManager.ItemDatabase.rodSItems[detailContainers[itemType].selectedId].ID;
			if (dataManager.userData.rodS.Contains(iD5))
			{
				ShowSoldButton(itemType);
			}
			else if (dataManager.userData.userLv < dataManager.ItemDatabase.rodSItems[iD5].unlocklv)
			{
				ShowUnlockButton(itemType);
				detailContainers[itemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
				detailContainers[itemType].unlockLv.text = detailContainers[itemType].unlockLv.text + dataManager.ItemDatabase.rodSItems[iD5].unlocklv;
			}
			else if (dataManager.userData.userGold < dataManager.ItemDatabase.rodSItems[iD5].price)
			{
				ShowNoGoldButton(itemType);
			}
			else
			{
				ShowBuyButton(itemType);
			}
			break;
		}
		case 1:
		{
			int iD3 = dataManager.ItemDatabase.rodCItems[detailContainers[itemType].selectedId].ID;
			if (dataManager.userData.rodC.Contains(iD3))
			{
				ShowSoldButton(itemType);
			}
			else if (dataManager.userData.userLv < dataManager.ItemDatabase.rodCItems[iD3].unlocklv)
			{
				ShowUnlockButton(itemType);
				detailContainers[itemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
				detailContainers[itemType].unlockLv.text = detailContainers[itemType].unlockLv.text + dataManager.ItemDatabase.rodCItems[iD3].unlocklv;
			}
			else if (dataManager.userData.userGold < dataManager.ItemDatabase.rodCItems[iD3].price)
			{
				ShowNoGoldButton(itemType);
			}
			else
			{
				ShowBuyButton(itemType);
			}
			break;
		}
		case 2:
		{
			int iD4 = dataManager.ItemDatabase.reelSItems[detailContainers[itemType].selectedId].ID;
			if (dataManager.userData.reelS.Contains(iD4))
			{
				ShowSoldButton(itemType);
			}
			else if (dataManager.userData.userLv < dataManager.ItemDatabase.reelSItems[iD4].unlocklv)
			{
				ShowUnlockButton(itemType);
				detailContainers[itemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
				detailContainers[itemType].unlockLv.text = detailContainers[itemType].unlockLv.text + dataManager.ItemDatabase.reelSItems[iD4].unlocklv;
			}
			else if (dataManager.userData.userGold < dataManager.ItemDatabase.reelSItems[iD4].price)
			{
				ShowNoGoldButton(itemType);
			}
			else
			{
				ShowBuyButton(itemType);
			}
			break;
		}
		case 3:
		{
			int iD6 = dataManager.ItemDatabase.reelCItems[detailContainers[itemType].selectedId].ID;
			if (dataManager.userData.reelC.Contains(iD6))
			{
				ShowSoldButton(itemType);
			}
			else if (dataManager.userData.rodC.Count == 0)
			{
				ShowUnlockButton(itemType);
				detailContainers[itemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVStore/0022");
			}
			else if (dataManager.userData.userGold < dataManager.ItemDatabase.reelCItems[iD6].price)
			{
				ShowNoGoldButton(itemType);
			}
			else
			{
				ShowBuyButton(itemType);
			}
			break;
		}
		case 4:
		{
			int iD2 = dataManager.ItemDatabase.lureItems[detailContainers[itemType].selectedId].ID;
			if (dataManager.userData.lure.Contains(iD2))
			{
				ShowSoldButton(itemType);
			}
			else if (dataManager.userData.userLv < dataManager.ItemDatabase.lureItems[iD2].unlocklv)
			{
				ShowUnlockButton(itemType);
				detailContainers[itemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
				detailContainers[itemType].unlockLv.text = detailContainers[itemType].unlockLv.text + dataManager.ItemDatabase.lureItems[iD2].unlocklv;
			}
			else if (dataManager.userData.userGold < dataManager.ItemDatabase.lureItems[iD2].price)
			{
				ShowNoGoldButton(itemType);
			}
			else
			{
				ShowBuyButton(itemType);
			}
			break;
		}
		case 7:
		{
			int iD = dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[detailContainers[itemType].selectedId].ID;
			int lobbyId = dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[iD].lobbyId;
			if (dataManager.userData.aquariums[dataManager.currentNation].rooms[lobbyId].items[iD].purchased)
			{
				ShowSoldButton(itemType);
			}
			else if (dataManager.userData.userLv < dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[iD].unlocklv)
			{
				ShowUnlockButton(itemType);
				detailContainers[itemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
				detailContainers[itemType].unlockLv.text = detailContainers[itemType].unlockLv.text + dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[iD].unlocklv;
			}
			else if (dataManager.userData.userGold < dataManager.ItemDatabase.dlcs[dataManager.currentNation].aquaItems[iD].price)
			{
				ShowNoGoldButton(itemType);
			}
			else
			{
				ShowBuyButton(itemType);
			}
			break;
		}
		case 10:
		{
			int iD8 = dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems[detailContainers[itemType].selectedId].ID;
			if (dataManager.userData.rooms[dataManager.currentNation].items[iD8].purchased)
			{
				ShowSoldButton(itemType);
			}
			else if (dataManager.userData.userLv < dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems[iD8].unlocklv)
			{
				ShowUnlockButton(itemType);
				detailContainers[itemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
				detailContainers[itemType].unlockLv.text = detailContainers[itemType].unlockLv.text + dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems[iD8].unlocklv;
			}
			else if (dataManager.userData.userGold < dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems[iD8].price)
			{
				ShowNoGoldButton(itemType);
			}
			else
			{
				ShowBuyButton(itemType);
			}
			break;
		}
		case 11:
		{
			int iD7 = dataManager.ItemDatabase.dlcs[dataManager.currentNation].furnitureItems[detailContainers[itemType].selectedId].ID;
			int lobbyId2 = dataManager.ItemDatabase.dlcs[dataManager.currentNation].furnitureItems[iD7].lobbyId;
			if (dataManager.userData.furnitures[dataManager.currentNation].rooms[lobbyId2].items[iD7].purchased)
			{
				if (dataManager.userData.furnitures[dataManager.currentNation].rooms[lobbyId2].items[iD7].purchased)
				{
					ShowSoldButton(itemType);
				}
			}
			else if (dataManager.userData.userLv < dataManager.ItemDatabase.dlcs[dataManager.currentNation].furnitureItems[iD7].unlocklv)
			{
				ShowUnlockButton(itemType);
				detailContainers[itemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
				detailContainers[itemType].unlockLv.text = detailContainers[itemType].unlockLv.text + dataManager.ItemDatabase.dlcs[dataManager.currentNation].furnitureItems[iD7].unlocklv;
			}
			else if (dataManager.userData.userGold < dataManager.ItemDatabase.dlcs[dataManager.currentNation].furnitureItems[iD7].price)
			{
				ShowNoGoldButton(itemType);
			}
			else
			{
				ShowBuyButton(itemType);
			}
			break;
		}
		case 12:
		{
			int iD9 = dataManager.ItemDatabase.boatItems[detailContainers[itemType].selectedId].ID;
			if (dataManager.userData.boats.Contains(iD9))
			{
				ShowSoldButton(itemType);
			}
			else if (dataManager.userData.userLv < dataManager.ItemDatabase.boatItems[iD9].unlocklv)
			{
				ShowUnlockButton(itemType);
				detailContainers[itemType].unlockLv.GetComponent<Localize>().SetKey("LodgeTVMap/0006");
				detailContainers[itemType].unlockLv.text = detailContainers[itemType].unlockLv.text + dataManager.ItemDatabase.boatItems[iD9].unlocklv;
			}
			else if (dataManager.userData.userGold < dataManager.ItemDatabase.boatItems[iD9].price)
			{
				ShowNoGoldButton(itemType);
			}
			else
			{
				ShowBuyButton(itemType);
			}
			break;
		}
		case 13:
		{
			int id = dataManager.ItemDatabase.propItems[detailContainers[itemType].selectedId].ID;
			PropData propData = dataManager.userData.props.Where((PropData s) => s.id == id).FirstOrDefault();
			if (propData != null && propData.count != 0 && !dataManager.ItemDatabase.propItems[detailContainers[itemType].selectedId].isConsumable)
			{
				ShowSoldButton(itemType);
			}
			else if (dataManager.userData.userLv < dataManager.ItemDatabase.propItems[id].unlocklv)
			{
				ShowUnlockButton(itemType);
			}
			else if (dataManager.userData.userGold < dataManager.ItemDatabase.propItems[id].price)
			{
				ShowNoGoldButton(itemType);
			}
			else
			{
				ShowBuyButton(itemType);
			}
			break;
		}
		case 5:
		case 6:
		case 8:
		case 9:
			break;
		}
	}

	public void Buy(int itemType)
	{
		switch (currenItemType)
		{
		case ItemType.RodS:
		{
			int iD2 = dataManager.ItemDatabase.rodSItems[detailContainers[(int)currenItemType].selectedId].ID;
			int price3 = dataManager.ItemDatabase.rodSItems[detailContainers[(int)currenItemType].selectedId].price;
			if (CheckAvailabilityPurchase(price3))
			{
				dataManager.userData.rodS.Add(iD2);
				dataManager.userData.rodS.Sort();
				dataManager.userData.curRodS = iD2;
				dataManager.userData.userGold -= price3;
				dataManager.SaveUserData();
				audios.Play();
				Singleton<AchievementController>.Instance.checkUpgrade(1);
				CheckPurchase((int)currenItemType);
			}
			break;
		}
		case ItemType.RodC:
		{
			int iD8 = dataManager.ItemDatabase.rodCItems[detailContainers[(int)currenItemType].selectedId].ID;
			int price9 = dataManager.ItemDatabase.rodCItems[detailContainers[(int)currenItemType].selectedId].price;
			if (CheckAvailabilityPurchase(price9))
			{
				dataManager.userData.rodC.Add(iD8);
				dataManager.userData.rodC.Sort();
				dataManager.userData.curRodC = iD8;
				dataManager.userData.userGold -= price9;
				dataManager.SaveUserData();
				audios.Play();
				Singleton<AchievementController>.Instance.checkUpgrade(1);
				CheckPurchase((int)currenItemType);
			}
			break;
		}
		case ItemType.ReelS:
		{
			int iD7 = dataManager.ItemDatabase.reelSItems[detailContainers[(int)currenItemType].selectedId].ID;
			int price8 = dataManager.ItemDatabase.reelSItems[detailContainers[(int)currenItemType].selectedId].price;
			if (CheckAvailabilityPurchase(price8))
			{
				dataManager.userData.reelS.Add(iD7);
				dataManager.userData.reelS.Sort();
				dataManager.userData.curReelS = iD7;
				dataManager.userData.userGold -= price8;
				audios.Play();
				Singleton<AchievementController>.Instance.checkUpgrade(1);
				CheckPurchase((int)currenItemType);
			}
			break;
		}
		case ItemType.ReelC:
		{
			int iD3 = dataManager.ItemDatabase.reelCItems[detailContainers[(int)currenItemType].selectedId].ID;
			int price4 = dataManager.ItemDatabase.reelCItems[detailContainers[(int)currenItemType].selectedId].price;
			if (CheckAvailabilityPurchase(price4))
			{
				dataManager.userData.reelC.Add(iD3);
				dataManager.userData.reelC.Sort();
				dataManager.userData.curReelC = iD3;
				dataManager.userData.userGold -= price4;
				audios.Play();
				Singleton<AchievementController>.Instance.checkUpgrade(1);
				CheckPurchase((int)currenItemType);
			}
			break;
		}
		case ItemType.Lure:
		{
			int iD9 = dataManager.ItemDatabase.lureItems[detailContainers[(int)currenItemType].selectedId].ID;
			int price10 = dataManager.ItemDatabase.lureItems[detailContainers[(int)currenItemType].selectedId].price;
			if (CheckAvailabilityPurchase(price10))
			{
				dataManager.userData.lure.Add(iD9);
				dataManager.userData.lure.Sort();
				dataManager.userData.curLure = iD9;
				dataManager.userData.userGold -= price10;
				audios.Play();
				Singleton<AchievementController>.Instance.checkUpgrade(1);
				CheckPurchase((int)currenItemType);
			}
			break;
		}
		case ItemType.Aquarium:
		{
			int iD6 = dataManager.ItemDatabase.dlcs[main.nationId].aquaItems[detailContainers[(int)currenItemType].selectedId].ID;
			int price7 = dataManager.ItemDatabase.dlcs[main.nationId].aquaItems[detailContainers[(int)currenItemType].selectedId].price;
			if (CheckAvailabilityPurchase(price7))
			{
				dataManager.userData.aquariums[main.nationId].rooms[main.lobbyId].items[iD6].purchased = true;
				dataManager.userData.userGold -= price7;
				audios.Play();
				CheckPurchase((int)currenItemType);
			}
			break;
		}
		case ItemType.Room:
		{
			int iD5 = dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems[detailContainers[(int)currenItemType].selectedId].ID;
			int price6 = dataManager.ItemDatabase.dlcs[dataManager.currentNation].roomItems[detailContainers[(int)currenItemType].selectedId].price;
			if (CheckAvailabilityPurchase(price6))
			{
				dataManager.userData.rooms[dataManager.currentNation].items[iD5].purchased = true;
				main.saltWaterAlert.Show(show: false);
				dataManager.userData.userGold -= price6;
				audios.Play();
				CheckPurchase((int)currenItemType);
			}
			break;
		}
		case ItemType.Furniture:
		{
			int iD4 = dataManager.ItemDatabase.dlcs[main.nationId].furnitureItems[detailContainers[(int)currenItemType].selectedId].ID;
			int price5 = dataManager.ItemDatabase.dlcs[main.nationId].furnitureItems[detailContainers[(int)currenItemType].selectedId].price;
			if (CheckAvailabilityPurchase(price5))
			{
				int lobbyId = dataManager.ItemDatabase.dlcs[main.nationId].furnitureItems[detailContainers[(int)currenItemType].selectedId].lobbyId;
				dataManager.userData.furnitures[main.nationId].rooms[lobbyId].items[iD4].purchased = true;
				dataManager.userData.furnitures[main.nationId].rooms[lobbyId].items[iD4].state = true;
				SetFurniture(iD4, OnOff: true);
				dataManager.userData.userGold -= price5;
				audios.Play();
				CheckPurchase((int)currenItemType);
			}
			break;
		}
		case ItemType.Boat:
		{
			int iD = dataManager.ItemDatabase.boatItems[detailContainers[(int)currenItemType].selectedId].ID;
			int price2 = dataManager.ItemDatabase.boatItems[detailContainers[(int)currenItemType].selectedId].price;
			if (CheckAvailabilityPurchase(price2))
			{
				dataManager.userData.boats.Add(iD);
				dataManager.userData.boats.Sort();
				dataManager.userData.curBoat = iD;
				main.lobbyEnvController.BoatSetting();
				dataManager.userData.userGold -= price2;
				dataManager.SaveUserData();
				audios.Play();
				CheckPurchase((int)currenItemType);
			}
			break;
		}
		case ItemType.Prop:
		{
			int id = dataManager.ItemDatabase.propItems[detailContainers[(int)currenItemType].selectedId].ID;
			int price = dataManager.ItemDatabase.propItems[detailContainers[(int)currenItemType].selectedId].price;
			_ = dataManager.ItemDatabase.propItems[detailContainers[(int)currenItemType].selectedId].ItemName;
			bool isConsumable = dataManager.ItemDatabase.propItems[detailContainers[(int)currenItemType].selectedId].isConsumable;
			PropData propData = dataManager.userData.props.Where((PropData s) => s.id == id).FirstOrDefault();
			bool flag = false;
			int index = -1;
			if (propData != null && propData.count > 0)
			{
				flag = true;
				index = dataManager.userData.props.IndexOf(propData);
			}
			if (!CheckAvailabilityPurchase(price))
			{
				break;
			}
			if (isConsumable)
			{
				if (flag)
				{
					dataManager.userData.props[index].count++;
				}
				else
				{
					PropData propData2 = new PropData();
					propData2.id = id;
					dataManager.userData.props.Add(propData2);
					propData2 = null;
				}
			}
			else if (!flag)
			{
				PropData propData3 = new PropData();
				propData3.id = id;
				dataManager.userData.props.Add(propData3);
				propData3 = null;
			}
			dataManager.userData.userGold -= price;
			dataManager.SaveUserData();
			audios.Play();
			CheckPurchase((int)currenItemType);
			break;
		}
		}
		UpdateStatus();
		dataManager.SaveUserData();
	}

	public void SetFurniture(int id, bool OnOff)
	{
		main.furnitureController.furniturePrefabs[id].SetActive(OnOff);
	}

	private bool CheckAvailabilityPurchase(int price)
	{
		if (dataManager.userData.userGold >= price)
		{
			return true;
		}
		return false;
	}

	public void ShowItemInfo(int index)
	{
		switch (currenItemType)
		{
		case ItemType.RodS:
			detailContainers[(int)currenItemType].infoValue.GetComponent<Localize>().SetKey("LodgeTVStoreDescription/00" + (index + 1).ToString("00"));
			break;
		case ItemType.RodC:
			detailContainers[(int)currenItemType].infoValue.GetComponent<Localize>().SetKey("LodgeTVStoreDescription/00" + (index + 1).ToString("00"));
			break;
		case ItemType.ReelS:
			detailContainers[(int)currenItemType].infoValue.GetComponent<Localize>().SetKey("LodgeTVStoreDescription/00" + (index + 4).ToString("00"));
			break;
		case ItemType.ReelC:
			detailContainers[(int)currenItemType].infoValue.GetComponent<Localize>().SetKey("LodgeTVStoreDescription/00" + (index + 4).ToString("00"));
			break;
		case ItemType.Lure:
			detailContainers[(int)currenItemType].infoValue.GetComponent<Localize>().SetKey("LodgeTVStoreDescription/00" + (index + 7).ToString("00"));
			break;
		case ItemType.Glove:
			detailContainers[(int)currenItemType].infoValue.GetComponent<Localize>().SetKey("GlovesDescription/00" + (index + 1).ToString("00"));
			break;
		case ItemType.Line:
		case ItemType.Fish:
		case ItemType.Aquarium:
			break;
		}
	}

	public void SetPage(int page)
	{
		if (page > totalPageNum)
		{
			return;
		}
		currentPageNum = page;
		pageNum.text = currentPageNum + " / " + totalPageNum;
		int num = (page - 1) * pagePerItemNum;
		int num2 = ((page != totalPageNum) ? (page * pagePerItemNum) : items[currentCategory].Count);
		for (int i = 0; i < items[currentCategory].Count; i++)
		{
			if (i >= num && num2 > i)
			{
				items[currentCategory][i].gameObject.SetActive(value: true);
			}
			else
			{
				items[currentCategory][i].gameObject.SetActive(value: false);
			}
		}
	}

	public int GetPage(int index)
	{
		return Mathf.CeilToInt((float)index / (float)pagePerItemNum);
	}

	public void CheckPage(int index)
	{
		if (index <= items[currentCategory].Count && index > 0)
		{
			int page = GetPage(index);
			if (currentPageNum != page)
			{
				SetPage(page);
			}
		}
	}

	public void NextPageButtonEvent()
	{
		if (currentPageNum + 1 <= totalPageNum)
		{
			SetPage(currentPageNum + 1);
		}
	}

	public void PrevPageButtonEvent()
	{
		if (currentPageNum - 1 > 0)
		{
			SetPage(currentPageNum - 1);
		}
	}

	public void BackButtonEvent()
	{
		ShowItemsPanel(show: false);
		ShowCategoriesPanel(show: true);
		HideDetailWindowAll();
	}
}
public class ShopPropItem : MonoBehaviour
{
	public int ID;

	public ItemType itemType;

	public Text itemName;

	public Image image;

	public void ApplyProperties()
	{
	}

	public void Select()
	{
		if (itemType == ItemType.Prop)
		{
			ShopManager.Instance.SetDescription(ItemType.Prop, ID);
		}
		else
		{
			ShopManager.Instance.SetDescription(ItemType.Prop, ID);
		}
	}
}
public class ShopReelItem : MonoBehaviour
{
	public int ID;

	public ItemType reelType;

	public Text itemName;

	public Image image;

	public void ApplyProperties()
	{
	}

	public void Select()
	{
		if (reelType == ItemType.ReelS)
		{
			ShopManager.Instance.SetDescription(ItemType.ReelS, ID);
		}
		else
		{
			ShopManager.Instance.SetDescription(ItemType.ReelC, ID);
		}
	}
}
public class ShopRodItem : MonoBehaviour
{
	public int ID;

	public ItemType rodType;

	public Text itemName;

	public Image image;

	public void ApplyProperties()
	{
	}

	public void Select()
	{
		if (rodType == ItemType.RodS)
		{
			ShopManager.Instance.SetDescription(ItemType.RodS, ID);
		}
		else
		{
			ShopManager.Instance.SetDescription(ItemType.RodC, ID);
		}
	}
}
public class ShopToggleManager : MonoBehaviour
{
	private void Start()
	{
	}

	private void Update()
	{
	}
}
public class ToggleTab : MonoBehaviour
{
	public Image bg;

	public new Text name;

	private Color32 normalColor;

	private Color32 clickedColor;

	public float width = 45f;

	public float normalHeight = 13f;

	public float clickedHeight = 15f;

	public bool isMainColor;

	public bool isToggle = true;

	public void ClickTab()
	{
		if (isToggle)
		{
			bg.rectTransform.sizeDelta = new Vector2(width, clickedHeight);
			bg.color = clickedColor;
		}
	}

	public void UnClickTab()
	{
		if (isToggle)
		{
			bg.rectTransform.sizeDelta = new Vector2(width, normalHeight);
			bg.color = normalColor;
		}
	}

	private void Start()
	{
		clickedColor = Singleton<AchievementController>.Instance.color_buttonSelected;
		normalColor = Singleton<AchievementController>.Instance.color_buttonUnSelected;
		if (isMainColor)
		{
			ClickTab();
		}
		else
		{
			UnClickTab();
		}
	}
}
public class smoothRotateFromCam : MonoBehaviour
{
	public float speed = 1f;

	public Transform camTrans;

	public bool lookDown;

	public float lookDownAngle = 30f;

	private float slookDown;

	private void Start()
	{
	}

	private void Update()
	{
		base.transform.rotation = Quaternion.Lerp(base.transform.rotation, camTrans.rotation, Time.deltaTime * speed);
		if (lookDown)
		{
			slookDown += Time.deltaTime * speed * 50f;
			if (slookDown > lookDownAngle)
			{
				lookDown = false;
				slookDown = lookDownAngle;
			}
		}
		base.transform.eulerAngles = new Vector3(slookDown, base.transform.eulerAngles.y, 0f);
	}
}
public class soundRandom : MonoBehaviour
{
	public AudioClip[] sounds;

	private AudioSource audios;

	private void Start()
	{
		_ = sounds.Length;
		audios = GetComponent<AudioSource>();
		int num = UnityEngine.Random.Range(0, sounds.Length);
		audios.clip = sounds[num];
		audios.Play();
	}
}
public class SpriteSheet : MonoBehaviour
{
	public int _uvTieX = 1;

	public int _uvTieY = 1;

	public int _fps = 10;

	private Vector2 _size;

	private Renderer _myRenderer;

	private int _lastIndex = -1;

	private void Start()
	{
		_size = new Vector2(1f / (float)_uvTieX, 1f / (float)_uvTieY);
		_myRenderer = GetComponent<Renderer>();
		if (_myRenderer == null)
		{
			base.enabled = false;
		}
	}

	private void Update()
	{
		int num = (int)(Time.timeSinceLevelLoad * (float)_fps) % (_uvTieX * _uvTieY);
		if (num != _lastIndex)
		{
			int num2 = num % _uvTieX;
			int num3 = num / _uvTieY;
			Vector2 value = new Vector2((float)num2 * _size.x, 1f - _size.y - (float)num3 * _size.y);
			_myRenderer.material.SetTextureOffset("_MainTex", value);
			_myRenderer.material.SetTextureScale("_MainTex", _size);
			_lastIndex = num;
		}
	}
}
public class CherryBlossomEvent : StageEventBase
{
	private ParticleSystem particle;

	private ParticleSystem.EmissionModule emissionModule;

	public float emissionStop = 15f;

	public float emissionMax = 30f;

	private float emissionRate = 15f;

	private void Awake()
	{
		stored_startMinTime = startMinTime;
		stored_startMaxTime = startMaxTime;
		stored_durationMinTime = durationMinTime;
		stored_durationMaxTime = durationMaxTime;
		stored_restartWaitTime = restartWaitTime;
		Initialize();
	}

	private void Initialize()
	{
		particle = GetComponent<ParticleSystem>();
		emissionModule = particle.emission;
	}

	private void Start()
	{
		if ((!PhotonNetwork.IsConnected || PhotonNetwork.IsMasterClient) && onStart)
		{
			Play(isReceive: false);
		}
	}

	public override void Play(bool isReceive, Action action = null)
	{
		if (isReceive)
		{
			startMinTime = 0f;
			startMaxTime = 0f;
			StartCoroutine(loopEvent());
			return;
		}
		base.Play(isReceive, delegate
		{
			StartCoroutine(loopEvent());
			if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && PhotonNetwork.IsMasterClient)
			{
				MultiplayEventManager.Instance.SendStageEventMessage(0, StageEventCode.CherryBlossom);
				PhotonNetwork.CurrentRoom.SetCustomProperties(new ExitGames.Client.Photon.Hashtable { 
				{
					"event" + id,
					true
				} });
			}
		});
	}

	private IEnumerator loopEvent()
	{
		yield return new WaitForSeconds(durationTime);
		emissionModule.rateOverTime = emissionRate;
		emissionRate = UnityEngine.Random.Range(0f, 35f);
		if (emissionRate > emissionMax)
		{
			emissionRate = emissionMax;
		}
		else if (emissionRate < emissionStop)
		{
			emissionRate = 0f;
		}
		emissionModule.rateOverTime = emissionRate;
		StartCoroutine(loopEvent());
	}

	public override void Stop(bool isReceive, Action action = null)
	{
		if (isReceive)
		{
			emissionModule.rateOverTime = 0f;
			return;
		}
		base.Stop(isReceive, delegate
		{
			emissionModule.rateOverTime = 0f;
			if (!isReceive)
			{
				finished = true;
			}
		});
	}
}
public class FireFlyEvent : StageEventBase
{
	private ParticleSystem particleFirefly;

	private ParticleSystem.EmissionModule emissionMudoule;

	private void Awake()
	{
		stored_startMinTime = startMinTime;
		stored_startMaxTime = startMaxTime;
		stored_durationMinTime = durationMinTime;
		stored_durationMaxTime = durationMaxTime;
		stored_restartWaitTime = restartWaitTime;
		particleFirefly = GetComponent<ParticleSystem>();
		emissionMudoule = particleFirefly.emission;
		emissionMudoule.rateOverTime = 0f;
	}

	private void Start()
	{
		if ((!PhotonNetwork.IsConnected || PhotonNetwork.IsMasterClient) && onStart)
		{
			Play(isReceive: false);
		}
	}

	public override void Play(bool isReceive, Action action = null)
	{
		if (isReceive)
		{
			startMinTime = 0f;
			startMaxTime = 0f;
			ParticleSystem.ShapeModule shape = particleFirefly.shape;
			shape.scale = new Vector3(UnityEngine.Random.Range(5f, 20f), 2f, 2f);
			int num = UnityEngine.Random.Range(5, 30);
			emissionMudoule.rateOverTime = num;
			particleFirefly.Play();
			return;
		}
		base.Play(isReceive, delegate
		{
			ParticleSystem.ShapeModule shape2 = particleFirefly.shape;
			shape2.scale = new Vector3(UnityEngine.Random.Range(5f, 20f), 2f, 2f);
			int num2 = UnityEngine.Random.Range(5, 30);
			emissionMudoule.rateOverTime = num2;
			particleFirefly.Play();
			if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && PhotonNetwork.IsMasterClient)
			{
				MultiplayEventManager.Instance.SendStageEventMessage(0, StageEventCode.FireFly);
				PhotonNetwork.CurrentRoom.SetCustomProperties(new ExitGames.Client.Photon.Hashtable { 
				{
					"event" + id,
					true
				} });
			}
		});
	}

	public override void Stop(bool isReceive, Action action = null)
	{
		if (isReceive)
		{
			particleFirefly.Stop();
			return;
		}
		base.Stop(isReceive, delegate
		{
			particleFirefly.Stop();
			if (!isReceive)
			{
				finished = true;
			}
		});
	}
}
public class FireworkEvent : StageEventBase
{
	public ParticleSystem[] fireWork;

	private void Awake()
	{
		stored_startMinTime = startMinTime;
		stored_startMaxTime = startMaxTime;
		stored_durationMinTime = durationMinTime;
		stored_durationMaxTime = durationMaxTime;
		stored_restartWaitTime = restartWaitTime;
		for (int i = 0; i < fireWork.Length; i++)
		{
			fireWork[i].Stop();
		}
	}

	private void Start()
	{
		if ((!PhotonNetwork.IsConnected || PhotonNetwork.IsMasterClient) && onStart)
		{
			Play(isReceive: false);
		}
	}

	public override void Play(bool isReceive, Action action = null)
	{
		if (isReceive)
		{
			startMinTime = 0f;
			startMaxTime = 0f;
			for (int i = 0; i < fireWork.Length; i++)
			{
				fireWork[i].Play();
			}
			return;
		}
		base.Play(isReceive, delegate
		{
			for (int j = 0; j < fireWork.Length; j++)
			{
				fireWork[j].Play();
			}
			if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && PhotonNetwork.IsMasterClient)
			{
				MonoBehaviour.print("마스터가 이벤트 시작 신호 보내기");
				MultiplayEventManager.Instance.SendStageEventMessage(0, StageEventCode.Firework);
				PhotonNetwork.CurrentRoom.SetCustomProperties(new ExitGames.Client.Photon.Hashtable { 
				{
					"event" + id,
					true
				} });
			}
		});
	}

	public override void Stop(bool isReceive, Action action = null)
	{
		if (isReceive)
		{
			for (int i = 0; i < fireWork.Length; i++)
			{
				fireWork[i].Stop();
			}
			return;
		}
		base.Stop(isReceive, delegate
		{
			for (int j = 0; j < fireWork.Length; j++)
			{
				fireWork[j].Stop();
			}
			if (!isReceive)
			{
				finished = true;
			}
		});
	}
}
public class RainbowEvent : StageEventBase
{
	public GameObject rainbow;

	private Material rainbowMat;

	public float time = 1f;

	private void Awake()
	{
		stored_startMinTime = startMinTime;
		stored_startMaxTime = startMaxTime;
		stored_durationMinTime = durationMinTime;
		stored_durationMaxTime = durationMaxTime;
		stored_restartWaitTime = restartWaitTime;
		rainbow.SetActive(value: false);
		rainbowMat = rainbow.GetComponent<Renderer>().material;
	}

	private void Start()
	{
		if ((!PhotonNetwork.IsConnected || PhotonNetwork.IsMasterClient) && onStart)
		{
			Play(isReceive: false);
		}
	}

	public override void Play(bool isReceive, Action action = null)
	{
		if (isReceive)
		{
			startMinTime = 0f;
			startMaxTime = 0f;
			rainbowMat.SetColor("_Color", new Color(0f, 0f, 0f, 1f));
			rainbow.SetActive(value: true);
			rainbowMat.DOColor(new Color(1f, 1f, 1f, 1f), time);
			return;
		}
		base.Play(isReceive, delegate
		{
			rainbowMat.SetColor("_Color", new Color(0f, 0f, 0f, 1f));
			rainbow.SetActive(value: true);
			rainbowMat.DOColor(new Color(1f, 1f, 1f, 1f), time);
			if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && PhotonNetwork.IsMasterClient)
			{
				MonoBehaviour.print("마스터가 이벤트 시작 신호 보내기");
				MultiplayEventManager.Instance.SendStageEventMessage(0, StageEventCode.Rainbow);
				PhotonNetwork.CurrentRoom.SetCustomProperties(new ExitGames.Client.Photon.Hashtable { 
				{
					"event" + id,
					true
				} });
			}
		});
	}

	public override void Stop(bool isReceive, Action action = null)
	{
		if (isReceive)
		{
			rainbowMat.DOColor(new Color(0f, 0f, 0f, 1f), time).OnComplete(delegate
			{
				rainbow.SetActive(value: false);
			});
			return;
		}
		base.Stop(isReceive, delegate
		{
			rainbowMat.DOColor(new Color(0f, 0f, 0f, 1f), time).OnComplete(delegate
			{
				rainbow.SetActive(value: false);
				if (!isReceive)
				{
					finished = true;
				}
			});
		});
	}
}
public class RainEvent : StageEventBase
{
	public GameObject rain;

	public ParticleSystem rainParticle;

	public ParticleSystem.EmissionModule rainParticleEmit;

	public ParticleSystem rainWater;

	private ParticleSystem.EmissionModule rainWaterEmit;

	public Renderer rainPlane;

	public AudioSource soundRain;

	public float rainMainPower = 1f;

	private Material rainPlaneMat;

	public float rainShowTime = 5f;

	public int rainRateMax = 100;

	public int waterRateMax = 200;

	private float rainPlanePower = 1f;

	private float waitTime;

	private float rainwaterPower;

	private DataManager dataManager;

	private void Awake()
	{
		stored_startMinTime = startMinTime;
		stored_startMaxTime = startMaxTime;
		stored_durationMinTime = durationMinTime;
		stored_durationMaxTime = durationMaxTime;
		stored_restartWaitTime = restartWaitTime;
		dataManager = Singleton<DataManager>.Instance;
		Initilize();
	}

	private void Start()
	{
		if ((!PhotonNetwork.IsConnected || PhotonNetwork.IsMasterClient) && onStart)
		{
			Play(isReceive: false);
		}
	}

	private void Initilize()
	{
		rainParticleEmit = rainParticle.emission;
		rainWaterEmit = rainWater.emission;
		waitTime = rainShowTime / (float)rainRateMax;
		rainwaterPower = waterRateMax / rainRateMax;
		rainPlaneMat = rainPlane.material;
		rainPlaneMat.SetColor("_TintColor", new Color(1f, 1f, 1f, 0f));
		soundRain.volume = 0f;
		rainParticleEmit.rateOverTime = 0f;
		rainWaterEmit.rateOverTime = 0f;
	}

	public override void Play(bool isReceive, Action action = null)
	{
		if (isReceive)
		{
			startMinTime = 0f;
			startMaxTime = 0f;
			StartCoroutine(playRain());
			return;
		}
		base.Play(isReceive, delegate
		{
			StartCoroutine(playRain());
			if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && PhotonNetwork.IsMasterClient)
			{
				MonoBehaviour.print("마스터가 이벤트 시작 신호 보내기");
				MultiplayEventManager.Instance.SendStageEventMessage(0, StageEventCode.Rain);
				PhotonNetwork.CurrentRoom.SetCustomProperties(new ExitGames.Client.Photon.Hashtable { 
				{
					"event" + id,
					true
				} });
			}
		});
	}

	private IEnumerator playRain()
	{
		MonoBehaviour.print("비 시작 : " + Time.time);
		rainPlanePower = UnityEngine.Random.Range(0.5f, 1f);
		rain.SetActive(value: true);
		int power = 0;
		rainParticle.Play();
		rainWater.Play();
		soundRain.Play();
		while (power <= 100)
		{
			power += 10;
			rainParticleEmit.rateOverTime = (float)power * rainMainPower;
			rainWaterEmit.rateOverTime = (float)power * rainwaterPower * rainMainPower;
			rainPlaneMat.SetColor("_TintColor", new Color(1f, 1f, 1f, (float)power * 0.01f * rainPlanePower * rainMainPower));
			soundRain.volume = (float)power * 0.01f * rainMainPower * (float)dataManager.userData.volumeAmbient * 0.1f;
			yield return new WaitForSeconds(waitTime * 100f);
		}
	}

	public override void Stop(bool isReceive, Action action = null)
	{
		if (isReceive)
		{
			StartCoroutine(stopRain(isReceive));
			return;
		}
		base.Stop(isReceive, delegate
		{
			StartCoroutine(stopRain(isReceive));
		});
	}

	private IEnumerator stopRain(bool isReceive)
	{
		if (isReceive)
		{
			rainParticle.Stop();
			rainWater.Stop();
			soundRain.Stop();
			rain.SetActive(value: false);
		}
		else
		{
			int power = 100;
			while (power > 0)
			{
				power -= 10;
				rainParticleEmit.rateOverTime = (float)power * rainMainPower;
				rainWaterEmit.rateOverTime = (float)power * rainwaterPower * rainMainPower;
				rainPlaneMat.SetColor("_TintColor", new Color(1f, 1f, 1f, (float)power * 0.01f * rainPlanePower * rainMainPower));
				soundRain.volume = (float)power * 0.01f * rainMainPower * (float)dataManager.userData.volumeAmbient * 0.1f;
				yield return new WaitForSeconds(waitTime * 100f);
			}
			rainParticle.Stop();
			rainWater.Stop();
			soundRain.Stop();
			rain.SetActive(value: false);
			finished = true;
		}
		MonoBehaviour.print("비 끝 : " + Time.time);
	}
}
public enum StageEvent
{
	None,
	Rainbow,
	Rain,
	Firework,
	FireFly,
	CherryBlossom
}
[Serializable]
public class StageEventBase : MonoBehaviour
{
	public int id = -1;

	public bool envEvent = true;

	public bool onStart;

	public bool loop;

	public float ratio = 10f;

	public float startMinTime = 100f;

	public float startMaxTime = 200f;

	public float durationMinTime = 100f;

	public float durationMaxTime = 200f;

	public float restartWaitTime = 200f;

	public bool finished;

	private bool once = true;

	public StageEvent stageEvent;

	public float startDelayTime;

	public float durationTime;

	public float stored_startMinTime;

	public float stored_startMaxTime;

	public float stored_durationMinTime;

	public float stored_durationMaxTime;

	public float stored_restartWaitTime;

	private void Awake()
	{
	}

	public void Init()
	{
		startMinTime = stored_startMinTime;
		startMaxTime = stored_startMaxTime;
		durationMinTime = stored_durationMinTime;
		durationMaxTime = stored_durationMaxTime;
		restartWaitTime = stored_restartWaitTime;
	}

	public virtual void Play(bool isReceive, Action action = null)
	{
		StartCoroutine(startDelay(isReceive, action));
	}

	private IEnumerator startDelay(bool isReceive, Action action = null)
	{
		startDelayTime = UnityEngine.Random.Range(startMinTime, startMaxTime);
		durationTime = UnityEngine.Random.Range(durationMinTime, durationMaxTime);
		if (!isReceive)
		{
			if (loop && !once)
			{
				finished = false;
				once = true;
				yield return new WaitForSeconds(restartWaitTime);
			}
			once = false;
		}
		if (onStart)
		{
			yield return new WaitForSeconds(0f);
		}
		else
		{
			yield return new WaitForSeconds(startDelayTime);
		}
		action?.Invoke();
		Stop(isReceive);
	}

	public virtual void Stop(bool isReceive, Action action = null)
	{
		StopCoroutine(startDelay(isReceive));
		StartCoroutine(endDelay(isReceive, action));
	}

	private IEnumerator endDelay(bool isReceive, Action action)
	{
		if (!isReceive)
		{
			yield return new WaitForSeconds(durationTime);
		}
		if (action != null)
		{
			action();
			if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && PhotonNetwork.IsMasterClient)
			{
				PhotonNetwork.CurrentRoom.SetCustomProperties(new ExitGames.Client.Photon.Hashtable { 
				{
					"event" + id,
					false
				} });
			}
		}
		if (loop && !isReceive)
		{
			while (!finished)
			{
				yield return null;
			}
			Play(isReceive: false);
		}
	}
}
public class starMove : MonoBehaviour
{
	public float waitTime = 2f;

	public float speed = 1f;

	public float destroyTime = 3f;

	public float starScale = 0.015f;

	public GameObject particle;

	private IEnumerator moveCoroutine;

	private Vector3 targetPos;

	private void Start()
	{
		base.transform.localScale = Vector3.zero;
	}

	private void Update()
	{
		base.transform.localScale = Vector3.Lerp(base.transform.localScale, new Vector3(starScale, starScale, starScale), Time.deltaTime * 10f);
	}

	public void move(Vector3 target)
	{
		targetPos = target;
		moveCoroutine = iMove();
		StartCoroutine(moveCoroutine);
	}

	public IEnumerator iMove()
	{
		float sTime = 0f;
		yield return new WaitForSeconds(waitTime);
		while (sTime < 2f)
		{
			sTime += Time.deltaTime;
			base.transform.position = Vector3.Lerp(base.transform.position, targetPos, Time.deltaTime * speed);
			yield return null;
		}
		destory();
	}

	private void destory()
	{
		StopCoroutine(moveCoroutine);
		UnityEngine.Object.Destroy(base.gameObject);
	}

	private void OnTriggerEnter(Collider other)
	{
		if (other.CompareTag("water"))
		{
			other.SendMessage("starAdd");
		}
		if (particle != null)
		{
			UnityEngine.Object.Instantiate(particle, base.transform.position, Quaternion.identity);
		}
		StopCoroutine(moveCoroutine);
		UnityEngine.Object.Destroy(base.gameObject);
	}
}
public class starPoint : MonoBehaviour
{
	public GameObject yellowStar;

	public GameObject whiteStar;

	public int point;

	public float distance = 0.2f;

	private void Start()
	{
		for (int i = 0; i < point; i++)
		{
			GameObject obj = UnityEngine.Object.Instantiate(yellowStar, new Vector3(0f, 0f, 0f), base.transform.rotation);
			obj.transform.parent = base.transform;
			obj.transform.localPosition = new Vector3((float)i * distance, 0f, 0f);
		}
		for (int j = 0; j < 5 - point; j++)
		{
			GameObject obj2 = UnityEngine.Object.Instantiate(whiteStar, new Vector3(0f, 0f, 0f), base.transform.rotation);
			obj2.transform.parent = base.transform;
			obj2.transform.localPosition = new Vector3((float)point * distance + (float)j * distance, 0f, 0f);
		}
	}
}
public class stuff_timeController : MonoBehaviour
{
	public float maxAngle = 45f;

	public float maxSpeed = 2f;

	public TimeColorChange timeController;

	private void Start()
	{
	}

	private void OnTriggerStay(Collider other)
	{
		if (other.CompareTag("hand") && VRInput.bInputGrab(VRInput.eController.bothhand))
		{
			float num = other.transform.eulerAngles.y;
			if (num > 180f)
			{
				num -= 360f;
			}
			if (num > maxAngle)
			{
				num = maxAngle;
			}
			else if (num < 0f - maxAngle)
			{
				num = 0f - maxAngle;
			}
			base.transform.localEulerAngles = new Vector3(0f, num, 0f);
			timeController.timeSpeed = num / maxAngle * maxSpeed;
		}
	}
}
public class sunflareRotate : MonoBehaviour
{
	public Transform camTrans;

	private void Update()
	{
		base.transform.localEulerAngles = new Vector3(base.transform.localEulerAngles.x, base.transform.localEulerAngles.y, camTrans.eulerAngles.z);
	}
}
public class tabletControl : MonoBehaviour
{
	public Transform playerPos;

	public Transform radarDir;

	public Transform radarTrans;

	public control_Fishing control;

	public float heightFromCam = 0.5f;

	public float speedRot = 1f;

	public GameObject tablet;

	public GameObject sonar;

	public bool bUp;

	private Animation tabletAni;

	private Coroutine iHide;

	private void Start()
	{
		tablet.SetActive(value: false);
		sonar.SetActive(value: false);
		tabletAni = tablet.GetComponent<Animation>();
	}

	private void LateUpdate()
	{
		base.transform.position = new Vector3(playerPos.position.x, playerPos.position.y - heightFromCam, playerPos.position.z);
		base.transform.rotation = Quaternion.Lerp(base.transform.rotation, Quaternion.Euler(0f, playerPos.eulerAngles.y, 0f), Time.deltaTime * speedRot);
		radarDir.localRotation = Quaternion.Euler(0f, 0f, radarTrans.eulerAngles.y);
	}

	public void showTablet()
	{
		if (iHide != null)
		{
			StopCoroutine(iHide);
		}
		sonar.SetActive(value: true);
		sonar.GetComponent<AudioSource>().Play();
	}

	public void hideTablet()
	{
		tabletAni.Stop();
		tabletAni.Play("tabletAniDown");
		sonar.SetActive(value: false);
		if (iHide != null)
		{
			StopCoroutine(iHide);
		}
		iHide = StartCoroutine(hide());
	}

	private IEnumerator hide()
	{
		float sTime = 0f;
		while (sTime < 0.5f)
		{
			sTime += Time.deltaTime;
			yield return null;
		}
		tablet.SetActive(value: false);
	}
}
public class DetailAquaContainer : DetailContainerBase
{
}
public class DetailBoatContainer : DetailContainerBase
{
	public Text gradeValue;

	private void Start()
	{
		infos = new string[3];
		infos[0] = "You can quickly lower fish's stamina";
		infos[1] = "You can quickly fill the gauge";
		infos[2] = "Casting distance will increase";
	}
}
public class DetailContainerBase : MonoBehaviour
{
	public Text itemName;

	public int selectedId;

	public Image descImage;

	public Text infoValue;

	public Text unlockLv;

	public Text price;

	public GameObject panel_Unlock;

	public GameObject panel_NoGold;

	public GameObject panel_Buy;

	public GameObject panel_Sold;

	public ItemType itemType;

	public Text typeValue;

	[HideInInspector]
	public string[] infos;
}
public class DetailFurnitureContainer : DetailContainerBase
{
}
public class DetailGloveContainer : DetailContainerBase
{
	private void Start()
	{
	}
}
public class DetailInteriorContainer : DetailContainerBase
{
}
public class DetailLureContainer : DetailContainerBase
{
	public Text gradeValue;

	public Text targetValue;

	public Text rangeValue;

	public Text stuckValue;

	public Slider RangeSlider;

	public Slider StuckSlider;

	private void Start()
	{
	}
}
public class DetailReelContainer : DetailContainerBase
{
	public Text gradeValue;

	public Text speedValue;

	public Text powerValue;

	public Text lengthValue;

	public Slider speedSlider;

	public Slider powerSlider;

	public Slider lengthSlider;

	private void Start()
	{
	}
}
public class DetailRodContainer : DetailContainerBase
{
	public Text gradeValue;

	public Text powerValue;

	public Text actionValue;

	public Text distanceValue;

	public Slider powerSlider;

	public Slider actionSlider;

	public Slider distanceSlider;

	private void Start()
	{
	}
}
public enum SELECTEDTACKLE
{
	ROD,
	REEL,
	LURE,
	GLOVE,
	LINE
}
public class TackleSet
{
	public int index;

	public Sprite slotImage;
}
public class TackleController : MonoBehaviour
{
	public bool isLodge;

	private Color colorSelected;

	private Color colorUnSelected;

	public Text level;

	public Slider expSlider;

	public Text textExpMax;

	public Text gold;

	public Image rodSlot;

	public Image reelSlot;

	public Image lureSlot;

	public Image glovesSlot;

	public Image buttonSpinning;

	public Image buttonCasting;

	public SELECTEDTACKLE selectedTackle;

	public DetailRodContainer detailRodContainer;

	public DetailReelContainer detailReelContainer;

	public DetailLureContainer detailLureContainer;

	public DetailGloveContainer detailGloveContainer;

	public GameObject buttonGloveRight;

	public GameObject buttonGloveLeft;

	private bool rotateChange = true;

	private ItemDatabase itemDatabase;

	private DataManager dataManager;

	private Main main;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		main = Singleton<Main>.Instance;
		itemDatabase = dataManager.ItemDatabase;
		detailRodContainer.gameObject.SetActive(value: false);
		detailReelContainer.gameObject.SetActive(value: false);
		detailLureContainer.gameObject.SetActive(value: false);
		colorSelected = Singleton<AchievementController>.Instance.color_buttonSelected;
		colorUnSelected = Singleton<AchievementController>.Instance.color_buttonUnSelected;
	}

	private void OnEnable()
	{
		if (dataManager == null)
		{
			dataManager = Singleton<DataManager>.Instance;
		}
		Load();
		SetStatus();
	}

	private void Load()
	{
		if (dataManager.userData.curType == 0)
		{
			rodSlot.sprite = itemDatabase.rodSItems[dataManager.userData.rodS[dataManager.userData.rodS.IndexOf(dataManager.userData.curRodS)]].equipImage;
			reelSlot.sprite = itemDatabase.reelSItems[dataManager.userData.reelS[dataManager.userData.reelS.IndexOf(dataManager.userData.curReelS)]].equipImage;
		}
		else
		{
			rodSlot.sprite = itemDatabase.rodCItems[dataManager.userData.rodC[dataManager.userData.rodC.IndexOf(dataManager.userData.curRodC)]].equipImage;
			reelSlot.sprite = itemDatabase.reelCItems[dataManager.userData.reelC[dataManager.userData.reelC.IndexOf(dataManager.userData.curReelC)]].equipImage;
		}
		lureSlot.sprite = itemDatabase.lureItems[dataManager.userData.curLure].equipImage;
	}

	public void SetStatus()
	{
		level.text = dataManager.userData.userLv.ToString();
		if (dataManager.userData.userLv == dataManager.maxLevel)
		{
			expSlider.gameObject.SetActive(value: false);
			textExpMax.enabled = true;
		}
		else
		{
			expSlider.gameObject.SetActive(value: true);
			expSlider.value = dataManager.userExpBar;
			textExpMax.enabled = false;
		}
		gold.text = dataManager.userData.userGold.ToString();
		SetCurrentType(dataManager.userData.curType);
	}

	[ContextMenu("RodLeft")]
	public void SelectRodLeftButtonEvent()
	{
		int curType = dataManager.userData.curType;
		selectedTackle = SELECTEDTACKLE.ROD;
		if (curType == 0)
		{
			int num = dataManager.userData.rodS.IndexOf(dataManager.userData.curRodS);
			int index = num - 1;
			if (num > 0)
			{
				int num2 = dataManager.userData.rodS[index];
				rodSlot.sprite = itemDatabase.rodSItems[num2].equipImage;
				dataManager.userData.curRodS = num2;
				SetDescription(ItemType.RodS, num2);
			}
			else if (rotateChange)
			{
				int num3 = dataManager.userData.rodS.Last();
				rodSlot.sprite = itemDatabase.rodSItems[num3].equipImage;
				dataManager.userData.curRodS = num3;
				SetDescription(ItemType.RodS, num3);
			}
		}
		else
		{
			int num4 = dataManager.userData.rodC.IndexOf(dataManager.userData.curRodC);
			int index2 = num4 - 1;
			if (num4 > 0)
			{
				int num5 = dataManager.userData.rodC[index2];
				rodSlot.sprite = itemDatabase.rodCItems[num5].equipImage;
				dataManager.userData.curRodC = num5;
				SetDescription(ItemType.RodC, num5);
			}
			else if (rotateChange)
			{
				int num6 = dataManager.userData.rodC.Last();
				rodSlot.sprite = itemDatabase.rodCItems[num6].equipImage;
				dataManager.userData.curRodC = num6;
				SetDescription(ItemType.RodC, num6);
			}
		}
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
		{
			MultiplayEventManager.Instance.SendRodIDEvent();
		}
	}

	[ContextMenu("RodRight")]
	public void SelectRodRightButtonEvent()
	{
		int curType = dataManager.userData.curType;
		selectedTackle = SELECTEDTACKLE.ROD;
		if (curType == 0)
		{
			int num = dataManager.userData.rodS.IndexOf(dataManager.userData.curRodS);
			int index = num + 1;
			if (num < dataManager.userData.rodS.Count - 1)
			{
				int num2 = dataManager.userData.rodS[index];
				rodSlot.sprite = itemDatabase.rodSItems[num2].equipImage;
				dataManager.userData.curRodS = dataManager.userData.rodS[index];
				SetDescription(ItemType.RodS, num2);
			}
			else if (rotateChange)
			{
				int num3 = dataManager.userData.rodS[0];
				rodSlot.sprite = itemDatabase.rodSItems[num3].equipImage;
				dataManager.userData.curRodS = 0;
				SetDescription(ItemType.RodS, num3);
			}
		}
		else
		{
			int num4 = dataManager.userData.rodC.IndexOf(dataManager.userData.curRodC);
			int index2 = num4 + 1;
			if (num4 < dataManager.userData.rodC.Count - 1)
			{
				int num5 = dataManager.userData.rodC[index2];
				rodSlot.sprite = itemDatabase.rodCItems[num5].equipImage;
				dataManager.userData.curRodC = dataManager.userData.rodC[index2];
				SetDescription(ItemType.RodC, num5);
			}
			else if (rotateChange)
			{
				int num6 = dataManager.userData.rodC[0];
				rodSlot.sprite = itemDatabase.rodCItems[num6].equipImage;
				dataManager.userData.curRodC = 0;
				SetDescription(ItemType.RodC, num6);
			}
		}
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
		{
			MultiplayEventManager.Instance.SendRodIDEvent();
		}
	}

	public void SelectReelLeftButtonEvent()
	{
		selectedTackle = SELECTEDTACKLE.REEL;
		if (dataManager.userData.curType == 0)
		{
			int num = dataManager.userData.reelS.IndexOf(dataManager.userData.curReelS);
			int index = num - 1;
			if (num > 0)
			{
				int num2 = dataManager.userData.reelS[index];
				reelSlot.sprite = itemDatabase.reelSItems[num2].equipImage;
				dataManager.userData.curReelS = num2;
				SetDescription(ItemType.ReelS, num2);
			}
			else if (rotateChange)
			{
				int num3 = dataManager.userData.reelS.Last();
				reelSlot.sprite = itemDatabase.reelSItems[num3].equipImage;
				dataManager.userData.curReelS = num3;
				SetDescription(ItemType.ReelS, num3);
			}
		}
		else
		{
			int num4 = dataManager.userData.reelC.IndexOf(dataManager.userData.curReelC);
			int index2 = num4 - 1;
			if (num4 > 0)
			{
				int num5 = dataManager.userData.reelC[index2];
				reelSlot.sprite = itemDatabase.reelCItems[num5].equipImage;
				dataManager.userData.curReelC = num5;
				SetDescription(ItemType.ReelC, num5);
			}
			else if (rotateChange)
			{
				int num6 = dataManager.userData.reelC.Last();
				reelSlot.sprite = itemDatabase.reelCItems[num6].equipImage;
				dataManager.userData.curReelC = num6;
				SetDescription(ItemType.ReelC, num6);
			}
		}
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
		{
			MultiplayEventManager.Instance.SendReelIDEvent();
		}
	}

	public void SelectReelRightButtonEvent()
	{
		selectedTackle = SELECTEDTACKLE.REEL;
		if (dataManager.userData.curType == 0)
		{
			int num = dataManager.userData.reelS.IndexOf(dataManager.userData.curReelS);
			int index = num + 1;
			if (num < dataManager.userData.reelS.Count - 1)
			{
				int num2 = dataManager.userData.reelS[index];
				reelSlot.sprite = itemDatabase.reelSItems[num2].equipImage;
				dataManager.userData.curReelS = dataManager.userData.reelS[index];
				SetDescription(ItemType.ReelS, num2);
			}
			else if (rotateChange)
			{
				int num3 = dataManager.userData.reelS[0];
				reelSlot.sprite = itemDatabase.reelSItems[num3].equipImage;
				dataManager.userData.curReelS = 0;
				SetDescription(ItemType.ReelS, num3);
			}
		}
		else
		{
			int num4 = dataManager.userData.reelC.IndexOf(dataManager.userData.curReelC);
			int index2 = num4 + 1;
			if (num4 < dataManager.userData.reelC.Count - 1)
			{
				int num5 = dataManager.userData.reelC[index2];
				reelSlot.sprite = itemDatabase.reelCItems[num5].equipImage;
				dataManager.userData.curReelC = dataManager.userData.reelC[index2];
				SetDescription(ItemType.ReelC, num5);
			}
			else if (rotateChange)
			{
				int num6 = dataManager.userData.reelC[0];
				reelSlot.sprite = itemDatabase.reelCItems[num6].equipImage;
				dataManager.userData.curReelC = 0;
				SetDescription(ItemType.ReelC, num6);
			}
		}
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom)
		{
			MultiplayEventManager.Instance.SendReelIDEvent();
		}
	}

	public void SelectLureLeftButtonEvent()
	{
		selectedTackle = SELECTEDTACKLE.LURE;
		int num = dataManager.userData.lure.IndexOf(dataManager.userData.curLure);
		int index = num - 1;
		if (num > 0)
		{
			int num2 = dataManager.userData.lure[index];
			lureSlot.sprite = itemDatabase.lureItems[num2].equipImage;
			dataManager.userData.curLure = num2;
			SetDescription(ItemType.Lure, num2);
		}
		else if (rotateChange)
		{
			int num3 = dataManager.userData.lure.Last();
			lureSlot.sprite = itemDatabase.lureItems[num3].equipImage;
			dataManager.userData.curLure = num3;
			SetDescription(ItemType.Lure, num3);
		}
	}

	public void SelectLureRightButtonEvent()
	{
		selectedTackle = SELECTEDTACKLE.LURE;
		int num = dataManager.userData.lure.IndexOf(dataManager.userData.curLure);
		int index = num + 1;
		if (num < dataManager.userData.lure.Count - 1)
		{
			int num2 = dataManager.userData.lure[index];
			lureSlot.sprite = itemDatabase.lureItems[num2].equipImage;
			dataManager.userData.curLure = num2;
			SetDescription(ItemType.Lure, num2);
		}
		else if (rotateChange)
		{
			int num3 = dataManager.userData.lure[0];
			lureSlot.sprite = itemDatabase.lureItems[num3].equipImage;
			dataManager.userData.curLure = num3;
			SetDescription(ItemType.Lure, 0);
		}
	}

	public void SelectGloveLeftButtonEvent()
	{
		selectedTackle = SELECTEDTACKLE.GLOVE;
		int num = dataManager.userData.gloves.IndexOf(dataManager.userData.curGlove);
		int index = num - 1;
		if (num > 0)
		{
			int num2 = dataManager.userData.gloves[index];
			glovesSlot.sprite = itemDatabase.gloveItems[num2].equipImage;
			dataManager.userData.curGlove = num2;
			SetDescription(ItemType.Glove, num2);
		}
		else if (rotateChange)
		{
			int num3 = dataManager.userData.gloves.Last();
			glovesSlot.sprite = itemDatabase.gloveItems[num3].equipImage;
			dataManager.userData.curGlove = num3;
			SetDescription(ItemType.Glove, num3);
		}
		main.rewardManager.ChangeGlove(dataManager.userData.curGlove);
	}

	public void SelectGloveRightButtonEvent()
	{
		selectedTackle = SELECTEDTACKLE.GLOVE;
		int num = dataManager.userData.gloves.IndexOf(dataManager.userData.curGlove);
		int index = num + 1;
		if (num < dataManager.userData.gloves.Count - 1)
		{
			int num2 = dataManager.userData.gloves[index];
			if (num2 < itemDatabase.gloveItems.Length)
			{
				glovesSlot.sprite = itemDatabase.gloveItems[num2].equipImage;
				dataManager.userData.curGlove = num2;
				SetDescription(ItemType.Glove, num2);
			}
		}
		else if (rotateChange)
		{
			int num3 = dataManager.userData.gloves[0];
			glovesSlot.sprite = itemDatabase.gloveItems[num3].equipImage;
			dataManager.userData.curGlove = num3;
			SetDescription(ItemType.Glove, 0);
		}
		main.rewardManager.ChangeGlove(dataManager.userData.curGlove);
	}

	public void SetDescription(ItemType itemType, int index)
	{
		switch (itemType)
		{
		case ItemType.RodS:
			detailRodContainer.gameObject.SetActive(value: true);
			detailReelContainer.gameObject.SetActive(value: false);
			detailLureContainer.gameObject.SetActive(value: false);
			detailRodContainer.itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.rodSItems[index].nameKey);
			if (detailRodContainer.price != null)
			{
				detailRodContainer.price.text = dataManager.ItemDatabase.rodSItems[index].price.ToString();
			}
			detailRodContainer.typeValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.rodSItems[index].typeKey);
			detailRodContainer.gradeValue.text = dataManager.ItemDatabase.rodSItems[index].grade.ToString();
			detailRodContainer.powerValue.text = dataManager.ItemDatabase.rodSItems[index].power.ToString();
			if (detailRodContainer.powerSlider != null)
			{
				detailRodContainer.powerSlider.value = dataManager.ItemDatabase.rodSItems[index].power;
			}
			detailRodContainer.actionValue.text = dataManager.ItemDatabase.rodSItems[index].action.ToString();
			if (detailRodContainer.actionSlider != null)
			{
				detailRodContainer.actionSlider.value = dataManager.ItemDatabase.rodSItems[index].action;
			}
			detailRodContainer.distanceValue.text = dataManager.ItemDatabase.rodSItems[index].distance.ToString();
			if (detailRodContainer.distanceSlider != null)
			{
				detailRodContainer.distanceSlider.value = dataManager.ItemDatabase.rodSItems[index].distance;
			}
			if (detailRodContainer.descImage != null)
			{
				detailRodContainer.descImage.sprite = dataManager.ItemDatabase.rodSItems[index].descImage;
			}
			if (detailRodContainer.infoValue != null)
			{
				detailRodContainer.infoValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.rodSItems[index].descKey);
			}
			break;
		case ItemType.RodC:
			detailRodContainer.gameObject.SetActive(value: true);
			detailReelContainer.gameObject.SetActive(value: false);
			detailLureContainer.gameObject.SetActive(value: false);
			detailRodContainer.itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.rodCItems[index].nameKey);
			if (detailRodContainer.price != null)
			{
				detailRodContainer.price.text = dataManager.ItemDatabase.rodCItems[index].price.ToString();
			}
			detailRodContainer.typeValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.rodCItems[index].typeKey);
			detailRodContainer.gradeValue.text = dataManager.ItemDatabase.rodCItems[index].grade.ToString();
			detailRodContainer.powerValue.text = dataManager.ItemDatabase.rodCItems[index].power.ToString();
			if (detailRodContainer.powerSlider != null)
			{
				detailRodContainer.powerSlider.value = dataManager.ItemDatabase.rodCItems[index].power;
			}
			detailRodContainer.actionValue.text = dataManager.ItemDatabase.rodCItems[index].action.ToString();
			if (detailRodContainer.actionSlider != null)
			{
				detailRodContainer.actionSlider.value = dataManager.ItemDatabase.rodCItems[index].action;
			}
			detailRodContainer.distanceValue.text = dataManager.ItemDatabase.rodCItems[index].distance.ToString();
			if (detailRodContainer.distanceSlider != null)
			{
				detailRodContainer.distanceSlider.value = dataManager.ItemDatabase.rodCItems[index].distance;
			}
			if (detailRodContainer.descImage != null)
			{
				detailRodContainer.descImage.sprite = dataManager.ItemDatabase.rodCItems[index].descImage;
			}
			if (detailRodContainer.infoValue != null)
			{
				detailRodContainer.infoValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.rodCItems[index].descKey);
			}
			break;
		case ItemType.ReelS:
			detailRodContainer.gameObject.SetActive(value: false);
			detailReelContainer.gameObject.SetActive(value: true);
			detailLureContainer.gameObject.SetActive(value: false);
			detailReelContainer.itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.reelSItems[index].nameKey);
			if (detailReelContainer.price != null)
			{
				detailReelContainer.price.text = dataManager.ItemDatabase.reelSItems[index].price.ToString();
			}
			detailReelContainer.typeValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.reelSItems[index].typeKey);
			detailReelContainer.gradeValue.text = dataManager.ItemDatabase.reelSItems[index].grade.ToString();
			detailReelContainer.speedValue.text = dataManager.ItemDatabase.reelSItems[index].tension.ToString();
			if (detailReelContainer.speedSlider != null)
			{
				detailReelContainer.speedSlider.value = dataManager.ItemDatabase.reelSItems[index].tension;
			}
			detailReelContainer.powerValue.text = dataManager.ItemDatabase.reelSItems[index].power.ToString();
			if (detailReelContainer.powerSlider != null)
			{
				detailReelContainer.powerSlider.value = dataManager.ItemDatabase.reelSItems[index].power;
			}
			detailReelContainer.lengthValue.text = dataManager.ItemDatabase.reelSItems[index].length.ToString();
			if (detailReelContainer.lengthSlider != null)
			{
				detailReelContainer.lengthSlider.value = dataManager.ItemDatabase.reelSItems[index].length;
			}
			if (detailReelContainer.descImage != null)
			{
				detailReelContainer.descImage.sprite = dataManager.ItemDatabase.reelSItems[index].descImage;
			}
			if (detailReelContainer.infoValue != null)
			{
				detailReelContainer.infoValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.reelSItems[index].descKey);
			}
			break;
		case ItemType.ReelC:
			detailRodContainer.gameObject.SetActive(value: false);
			detailReelContainer.gameObject.SetActive(value: true);
			detailLureContainer.gameObject.SetActive(value: false);
			detailReelContainer.itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.reelCItems[index].nameKey);
			if (detailReelContainer.price != null)
			{
				detailReelContainer.price.text = dataManager.ItemDatabase.reelCItems[index].price.ToString();
			}
			detailReelContainer.typeValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.reelCItems[index].typeKey);
			detailReelContainer.gradeValue.text = dataManager.ItemDatabase.reelCItems[index].grade.ToString();
			detailReelContainer.speedValue.text = dataManager.ItemDatabase.reelCItems[index].tension.ToString();
			if (detailReelContainer.speedSlider != null)
			{
				detailReelContainer.speedSlider.value = dataManager.ItemDatabase.reelCItems[index].tension;
			}
			detailReelContainer.powerValue.text = dataManager.ItemDatabase.reelCItems[index].power.ToString();
			if (detailReelContainer.powerSlider != null)
			{
				detailReelContainer.powerSlider.value = dataManager.ItemDatabase.reelCItems[index].power;
			}
			detailReelContainer.lengthValue.text = dataManager.ItemDatabase.reelCItems[index].length.ToString();
			if (detailReelContainer.lengthSlider != null)
			{
				detailReelContainer.lengthSlider.value = dataManager.ItemDatabase.reelCItems[index].length;
			}
			if (detailReelContainer.descImage != null)
			{
				detailReelContainer.descImage.sprite = dataManager.ItemDatabase.reelCItems[index].descImage;
			}
			if (detailReelContainer.infoValue != null)
			{
				detailReelContainer.infoValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.reelCItems[index].descKey);
			}
			break;
		case ItemType.Lure:
			detailRodContainer.gameObject.SetActive(value: false);
			detailReelContainer.gameObject.SetActive(value: false);
			detailLureContainer.gameObject.SetActive(value: true);
			detailLureContainer.itemName.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.lureItems[index].nameKey);
			if (detailLureContainer.price != null)
			{
				detailLureContainer.price.text = dataManager.ItemDatabase.lureItems[index].price.ToString();
			}
			detailLureContainer.gradeValue.text = dataManager.ItemDatabase.lureItems[index].grade.ToString();
			detailLureContainer.targetValue.text = GetTargetName(index);
			detailLureContainer.rangeValue.text = dataManager.ItemDatabase.lureItems[index].range.ToString();
			if (detailLureContainer.RangeSlider != null)
			{
				detailLureContainer.RangeSlider.value = dataManager.ItemDatabase.lureItems[index].range;
			}
			detailLureContainer.stuckValue.text = dataManager.ItemDatabase.lureItems[index].stuck.ToString();
			if (detailLureContainer.StuckSlider != null)
			{
				detailLureContainer.StuckSlider.value = dataManager.ItemDatabase.lureItems[index].stuck;
			}
			if (detailLureContainer.descImage != null)
			{
				detailLureContainer.descImage.sprite = dataManager.ItemDatabase.lureItems[index].descImage;
			}
			if (detailLureContainer.infoValue != null)
			{
				detailLureContainer.infoValue.GetComponent<Localize>().SetKey(dataManager.ItemDatabase.lureItems[index].descKey);
			}
			break;
		case ItemType.Line:
		case ItemType.Fish:
		case ItemType.Aquarium:
		case ItemType.Glove:
			break;
		}
	}

	public string GetTargetName(int index)
	{
		string text = "";
		bool[] targetFish = dataManager.ItemDatabase.lureItems[index].targetFish;
		string keyTranslation = LocalizationManager.GetKeyTranslation("LodgeTVStore/0018");
		string keyTranslation2 = LocalizationManager.GetKeyTranslation("LodgeTVStore/0019");
		string keyTranslation3 = LocalizationManager.GetKeyTranslation("LodgeTVStore/0020");
		string keyTranslation4 = LocalizationManager.GetKeyTranslation("LodgeTVStore/0021");
		if (targetFish[0])
		{
			text += keyTranslation;
		}
		if (targetFish[1])
		{
			if (text.Length > 0)
			{
				text += ", ";
			}
			text += keyTranslation2;
		}
		if (targetFish[2])
		{
			if (text.Length > 0)
			{
				text += ", ";
			}
			text += keyTranslation3;
		}
		if (targetFish[3])
		{
			if (text.Length > 0)
			{
				text += ", ";
			}
			text += keyTranslation4;
		}
		return text;
	}

	public void SetDescriptionEvent(int type)
	{
		int index;
		ItemType itemType;
		switch (type)
		{
		case 0:
			if (dataManager.userData.curType == 0)
			{
				index = dataManager.userData.curRodS;
				itemType = ItemType.RodS;
			}
			else
			{
				index = dataManager.userData.curRodC;
				itemType = ItemType.RodC;
			}
			break;
		case 1:
			if (dataManager.userData.curType == 0)
			{
				index = dataManager.userData.curReelS;
				itemType = ItemType.ReelS;
			}
			else
			{
				index = dataManager.userData.curReelC;
				itemType = ItemType.ReelC;
			}
			break;
		case 2:
			index = dataManager.userData.curLure;
			itemType = ItemType.Lure;
			break;
		case 3:
			index = dataManager.userData.curGlove;
			itemType = ItemType.Glove;
			break;
		default:
			index = 0;
			itemType = ItemType.RodS;
			break;
		}
		SetDescription(itemType, index);
	}

	public void showRodInfo(int index)
	{
		detailRodContainer.infoValue.GetComponent<Localize>().SetKey("LodgeTVFishingTackleDescription/00" + (index + 1).ToString("00"));
	}

	public void showReelInfo(int index)
	{
		detailReelContainer.infoValue.GetComponent<Localize>().SetKey("LodgeTVFishingTackleDescription/00" + (index + 4).ToString("00"));
	}

	public void showLureInfo(int index)
	{
		detailLureContainer.infoValue.GetComponent<Localize>().SetKey("LodgeTVFishingTackleDescription/00" + (index + 7).ToString("00"));
	}

	public void showGloveInfo(int index)
	{
		if (isLodge)
		{
			detailGloveContainer.infoValue.GetComponent<Localize>().SetKey("GlovesDescription/00" + (index + 1).ToString("00"));
		}
	}

	public void SetCurrentType(int type)
	{
		if (type == 0)
		{
			dataManager.userData.curType = type;
			buttonSpinning.color = colorSelected;
			buttonCasting.color = colorUnSelected;
			SetDescription(ItemType.RodS, dataManager.userData.rodS[dataManager.userData.rodS.IndexOf(dataManager.userData.curRodS)]);
			SetDescription(ItemType.ReelS, dataManager.userData.reelS[dataManager.userData.reelS.IndexOf(dataManager.userData.curReelS)]);
			Load();
		}
		else if (dataManager.userData.rodC.Count != 0 && dataManager.userData.reelC.Count != 0)
		{
			dataManager.userData.curType = type;
			buttonSpinning.color = colorUnSelected;
			buttonCasting.color = colorSelected;
			SetDescription(ItemType.RodC, dataManager.userData.rodC[dataManager.userData.rodC.IndexOf(dataManager.userData.curRodC)]);
			SetDescription(ItemType.ReelC, dataManager.userData.reelC[dataManager.userData.reelC.IndexOf(dataManager.userData.curReelC)]);
			Load();
		}
	}
}
public class textureAni : MonoBehaviour
{
	public int _uvTieX = 1;

	public int _uvTieY = 1;

	public float frameTime = 0.1f;

	private Vector2 _size;

	private Renderer _myRenderer;

	private int _lastIndex = -1;

	private float time;

	private bool bOffset = true;

	private void Awake()
	{
		_myRenderer = GetComponent<Renderer>();
	}

	private void Update()
	{
		time += Time.deltaTime;
		if (time > frameTime)
		{
			time = 0f;
			bOffset = !bOffset;
			if (bOffset)
			{
				_myRenderer.material.SetTextureOffset("_MainTex", new Vector2(0f, 0f));
			}
			else
			{
				_myRenderer.material.SetTextureOffset("_MainTex", new Vector2(0.5f, 0f));
			}
		}
	}
}
public class textureAnimation : MonoBehaviour
{
	public int _uvTieX = 1;

	public int _uvTieY = 1;

	public float frameTime = 0.1f;

	private Vector2 _size;

	private Renderer _myRenderer;

	private void Start()
	{
		_size = new Vector2(1f / (float)_uvTieX, 1f / (float)_uvTieY);
		_myRenderer = GetComponent<Renderer>();
		_myRenderer.material.SetTextureScale("_MainTex", _size);
		_myRenderer.enabled = false;
	}

	public void startAni()
	{
		StartCoroutine(particleHook());
	}

	private IEnumerator particleHook()
	{
		_myRenderer.enabled = true;
		int count = 0;
		int totalTile = _uvTieX * _uvTieY;
		while (count < totalTile)
		{
			int num = count % totalTile;
			int num2 = num % _uvTieX;
			int num3 = num / _uvTieY;
			Vector2 value = new Vector2((float)num2 * _size.x, 1f - _size.y - (float)num3 * _size.y);
			_myRenderer.material.SetTextureOffset("_MainTex", value);
			count++;
			yield return new WaitForSeconds(frameTime);
		}
		_myRenderer.enabled = false;
	}
}
public class textureScroll : MonoBehaviour
{
	public float scrollSpeed = 1f;

	public float scrollSpeedY;

	private Renderer render;

	private void Start()
	{
		render = GetComponent<Renderer>();
	}

	private void Update()
	{
		render.material.SetTextureOffset("_MainTex", new Vector2(Time.time * scrollSpeed, Time.time * scrollSpeedY));
	}
}
public class textureScroll_alpha : MonoBehaviour
{
	public float scrollSpeed = 1f;

	public float scrollSpeedY;

	private Renderer render;

	private void Start()
	{
		render = GetComponent<Renderer>();
		StartCoroutine(scroll());
	}

	private IEnumerator scroll()
	{
		while (true)
		{
			render.material.SetTextureOffset("_TintTex", new Vector2(Time.time * scrollSpeed, Time.time * scrollSpeedY));
			yield return null;
		}
	}
}
public class throwPoint : MonoBehaviour
{
	public Transform pointPos;

	private Main main;

	private float waterHeight;

	private void Awake()
	{
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
		waterHeight = main.envControl.water_Height;
	}

	private void LateUpdate()
	{
		base.transform.position = new Vector3(pointPos.position.x, waterHeight + 0.01f, pointPos.position.z);
	}
}
public class TitleManager : MonoBehaviour
{
	public Text loadingText;

	public Text versionText;

	public GameObject updatePopup;

	public float loadingbarTime = 0.7f;

	private int textPointCount;

	private DataManager dataManager;

	private void Awake()
	{
		dataManager = Singleton<DataManager>.Instance;
		if (dataManager != null)
		{
			dataManager.loadCompleted.AddListener(Completed);
		}
		Initialize();
	}

	private void Start()
	{
		XRSettings.eyeTextureResolutionScale = 1.3f;
		StartCoroutine(textAction());
	}

	private void Initialize()
	{
		if (versionText != null)
		{
			versionText.text = "";
		}
	}

	private void Completed()
	{
		StartCoroutine(LoadNewScene());
	}

	private IEnumerator LoadNewScene()
	{
		UnityEngine.AsyncOperation async = SceneManager.LoadSceneAsync("Lobby");
		while (!async.isDone)
		{
			yield return null;
		}
	}

	private IEnumerator textAction()
	{
		string textPoint = "";
		while (true)
		{
			textPoint += ".";
			loadingText.text = LocalizationManager.GetKeyTranslation("StartScene/0002") + textPoint;
			textPointCount++;
			if (textPointCount > 2)
			{
				textPointCount = 0;
				textPoint = "";
			}
			if (versionText != null && !string.IsNullOrEmpty(dataManager.userData.version))
			{
				versionText.text = "VERSION " + dataManager.userData.version;
			}
			yield return new WaitForSeconds(loadingbarTime);
		}
	}
}
public class touchBlink : MonoBehaviour
{
	public float blinkTime = 0.5f;

	private void Start()
	{
	}

	private void OnEnable()
	{
		StartCoroutine(blink());
	}

	private IEnumerator blink()
	{
		float direction = 1f;
		while (true)
		{
			direction *= -1f;
			base.transform.localScale = new Vector3(10f * direction, 10f, 10f);
			yield return new WaitForSeconds(blinkTime);
		}
	}
}
public class treeAnimation : MonoBehaviour
{
	private void Start()
	{
		GetComponent<Animation>()["wind"].time = UnityEngine.Random.Range(0f, 2f);
		GetComponent<Animation>().Play();
	}

	private void Update()
	{
	}
}
public class OnOffUIPlatform : MonoBehaviour
{
	public bool supportQuest = true;

	public bool supportRift = true;

	public bool supportGo = true;

	private void Start()
	{
	}

	private void OnEnable()
	{
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.QUEST)
		{
			if (supportQuest)
			{
				base.gameObject.SetActive(value: true);
			}
			else
			{
				base.gameObject.SetActive(value: false);
			}
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.RIFT)
		{
			if (supportRift)
			{
				base.gameObject.SetActive(value: true);
			}
			else
			{
				base.gameObject.SetActive(value: false);
			}
		}
		if (Singleton<DataManager>.Instance.targetPlatform == DEVICE_TYPE.GO)
		{
			if (supportGo)
			{
				base.gameObject.SetActive(value: true);
			}
			else
			{
				base.gameObject.SetActive(value: false);
			}
		}
	}
}
public class ui_arcControl : MonoBehaviour
{
	public Transform getTrans;

	private void Start()
	{
	}

	private void LateUpdate()
	{
		base.transform.position = getTrans.position;
		Quaternion quaternion = Quaternion.LookRotation(getTrans.forward * 0.5f - getTrans.up);
		base.transform.rotation = Quaternion.Euler(0f, quaternion.eulerAngles.y, 0f);
	}
}
public class ui_hook_textureOffset : MonoBehaviour
{
	public control_Fishing control;

	public float arrowTexSpeed = 1f;

	public float timeLimit = 2f;

	private Renderer render;

	private float sTime;

	private bool bScroll;

	private void Start()
	{
		render = GetComponent<Renderer>();
	}

	private void Update()
	{
		if (bScroll)
		{
			if (sTime < timeLimit)
			{
				sTime += Time.deltaTime;
				render.material.SetTextureOffset("_MainTex", new Vector2(sTime * arrowTexSpeed, 0f));
				render.material.SetTextureOffset("_BackTex", new Vector2(0.5f - sTime * timeLimit * 0.25f, 0f));
			}
			else
			{
				reset();
			}
		}
	}

	public void jump()
	{
		bScroll = true;
	}

	public void reset()
	{
		sTime = 0f;
		bScroll = false;
	}
}
public class ui_lookat_distance : MonoBehaviour
{
	public float sizeControl = 1f;

	public float sizeAdd = 1f;

	public float zSetback = 0.5f;

	private float waterHeight;

	private Camera cam;

	private Main main;

	private void Awake()
	{
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
		waterHeight = main.envControl.water_Height;
		cam = main.fishingControl.cam;
	}

	private void LateUpdate()
	{
		float num = Vector3.Distance(base.transform.position, Vector3.zero) * sizeControl + sizeAdd;
		base.transform.position = new Vector3(base.transform.position.x, waterHeight, base.transform.position.z);
		base.transform.localScale = new Vector3(num, num, num);
		base.transform.LookAt(cam.transform.position);
	}
}
public class ui_scale_distance : MonoBehaviour
{
	public float sizeControl = 1f;

	public float sizeAdd = 1f;

	public bool bUseWaterHeight = true;

	private float waterHeight;

	private Main main;

	private void Awake()
	{
		main = Singleton<Main>.Instance;
	}

	private void Start()
	{
		waterHeight = main.envControl.water_Height;
		StartCoroutine(scaleChange());
	}

	private IEnumerator scaleChange()
	{
		while (true)
		{
			float num = base.transform.position.z * sizeControl + sizeAdd;
			base.transform.localScale = new Vector3(num, num, num);
			if (bUseWaterHeight)
			{
				base.transform.position = new Vector3(base.transform.position.x, waterHeight, base.transform.position.z);
			}
			yield return null;
		}
	}
}
public class uiCircleOn : MonoBehaviour
{
	[HideInInspector]
	public bool onOff;

	private float regenTime = 3.1f;

	private float fTime;

	private void Start()
	{
		GetComponent<Renderer>().enabled = false;
		GetComponent<Collider>().enabled = false;
	}

	private void Update()
	{
		if (onOff)
		{
			if (fTime > regenTime)
			{
				fTime = 0f;
				onOff = false;
				GetComponent<Renderer>().enabled = false;
				GetComponent<Collider>().enabled = false;
			}
			else
			{
				fTime += Time.deltaTime;
			}
		}
	}

	public void turnOn()
	{
		onOff = true;
		GetComponent<Renderer>().enabled = true;
		GetComponent<Collider>().enabled = true;
	}

	public void turnOff()
	{
	}
}
public class uicontroller : MonoBehaviour
{
	public GameObject heart;

	public GameObject circle;

	public GameObject playerAni;

	public Transform heartPosition;

	public float heartDistance = 1f;

	public float regenTime = 1f;

	public int maxLife = 5;

	public GameObject fishLife;

	public GameObject ui;

	public GameObject fish;

	public GameObject cci;

	private float fishLifeScale = 1f;

	[HideInInspector]
	public int Life = 5;

	private float fTime;

	private float cciTime;

	public GameObject[] regenPosition;

	public GameObject[] hearts;

	private int gameState;

	private int rndPosition;

	private void Start()
	{
		Life = hearts.Length;
	}

	private void Update()
	{
		if (fTime > regenTime)
		{
			fTime = 0f;
			rndPosition = UnityEngine.Random.Range(0, 9);
			regenPosition[rndPosition].GetComponent<uiCircleOn>().turnOn();
		}
		else
		{
			fTime += Time.deltaTime;
		}
		if (gameState == 0)
		{
			if (Input.GetKeyDown("z") || Input.GetButtonDown("Button A"))
			{
				throwCci();
			}
		}
		else if (gameState == 1)
		{
			cciTime += Time.deltaTime * UnityEngine.Random.Range(1f, 3f);
			if (cciTime > 10f)
			{
				cci.GetComponent<Animation>().Play("cciSelect");
				if (Input.GetKeyDown("z") || Input.GetButtonDown("Button A"))
				{
					startFish();
				}
			}
		}
		else if (gameState == 3 && (Input.GetKeyDown("z") || Input.GetButtonDown("Button A")))
		{
			reset();
		}
	}

	public void HeartRender()
	{
		for (int i = 0; i < hearts.Length; i++)
		{
			if (i < Life)
			{
				hearts[i].GetComponent<Renderer>().enabled = true;
			}
			else
			{
				hearts[i].GetComponent<Renderer>().enabled = false;
			}
		}
	}

	public void LifeLose()
	{
		Life--;
		if (Life < 0)
		{
			Life = 0;
		}
		HeartRender();
		MonoBehaviour.print("fail");
	}

	public void FishLifeDown()
	{
		fishLifeScale -= 0.2f;
		if (fishLifeScale < 0f)
		{
			fishLifeScale = 0f;
			getFish();
		}
		fishLife.transform.localScale = new Vector3(fishLifeScale, 1f, 1f);
	}

	public void FishLifeReset()
	{
		fishLifeScale = 1f;
		fishLife.transform.localScale = new Vector3(fishLifeScale, 1f, 1f);
	}

	private void reset()
	{
		gameState = 0;
		fish.SetActive(value: false);
		FishLifeReset();
		circle.SetActive(value: true);
	}

	private void throwCci()
	{
		circle.SetActive(value: false);
		cci.SetActive(value: true);
		playerAni.GetComponent<Animation>().Play("choice");
		cci.GetComponent<Animation>().Play("cciAni");
		gameState = 1;
	}

	private void startFish()
	{
		cciTime = 0f;
		ui.SetActive(value: true);
		cci.SetActive(value: false);
		Life = hearts.Length;
		HeartRender();
		gameState = 2;
		GetComponent<AudioSource>().Play();
	}

	private void getFish()
	{
		GetComponent<AudioSource>().Stop();
		ui.SetActive(value: false);
		fish.SetActive(value: true);
		gameState = 3;
		playerAni.GetComponent<Animation>().Stop();
		playerAni.GetComponent<Animation>().Play("jump");
	}
}
public class uiFishGauge : MonoBehaviour
{
	[HideInInspector]
	public float fishGauge;

	private void Start()
	{
	}

	private void LateUpdate()
	{
	}
}
public class uiFishIconControl : MonoBehaviour
{
	public GameObject uiFishIconObj;

	public float turnSpeed = 1f;

	public Material mFishIcon1;

	public Material mFishIcon2;

	public Texture2D tFishFight;

	public Texture2D tFishMove;

	public Texture2D tFishAngry;

	public Texture2D tFishGroggy;

	private float angle;

	private float sTime;

	private bool bIconNext;

	private IEnumerator coroutin;

	private Animation ani;

	private AudioSource audio;

	public AudioClip hitSplash1;

	public AudioClip hitSplash2;

	public AudioClip hitSplash3;

	private void Awake()
	{
		ani = uiFishIconObj.GetComponent<Animation>();
		audio = uiFishIconObj.GetComponent<AudioSource>();
	}

	public void uiShow()
	{
		reset();
		uiFishIconObj.SetActive(value: true);
	}

	public void iconChange(int index)
	{
		coroutin = spin(delay: false);
		StartCoroutine(coroutin);
		bIconNext = !bIconNext;
		switch (index)
		{
		case 0:
			if (bIconNext)
			{
				mFishIcon2.SetTexture("_MainTex", tFishFight);
			}
			else
			{
				mFishIcon1.SetTexture("_MainTex", tFishFight);
			}
			break;
		case 1:
			if (bIconNext)
			{
				mFishIcon2.SetTexture("_MainTex", tFishMove);
			}
			else
			{
				mFishIcon1.SetTexture("_MainTex", tFishMove);
			}
			break;
		case 2:
			if (bIconNext)
			{
				mFishIcon2.SetTexture("_MainTex", tFishGroggy);
			}
			else
			{
				mFishIcon1.SetTexture("_MainTex", tFishGroggy);
			}
			break;
		case 3:
			if (bIconNext)
			{
				mFishIcon2.SetTexture("_MainTex", tFishAngry);
			}
			else
			{
				mFishIcon1.SetTexture("_MainTex", tFishAngry);
			}
			break;
		}
	}

	public void reset()
	{
		if (coroutin != null)
		{
			StopCoroutine(coroutin);
		}
		angle = 0f;
		uiFishIconObj.transform.localRotation = Quaternion.Euler(0f, 0f, 0f);
		uiFishIconObj.transform.localRotation = Quaternion.identity;
		mFishIcon1.SetTexture("_MainTex", tFishFight);
		ani.Stop();
		bIconNext = false;
	}

	private IEnumerator spin(bool delay)
	{
		angle += 180f;
		sTime = 0f;
		if (delay)
		{
			delay = false;
			yield return new WaitForSeconds(0.3f);
		}
		while (sTime < 1f)
		{
			sTime += Time.deltaTime * turnSpeed;
			uiFishIconObj.transform.localRotation = Quaternion.Slerp(uiFishIconObj.transform.localRotation, Quaternion.Euler(0f, angle, 0f), sTime);
			yield return null;
		}
		sTime = 0f;
	}

	public void hit()
	{
		ani.Play("uiShake");
	}

	public void hitContinue(int hitNum)
	{
		switch (hitNum)
		{
		case 1:
			ani.Play("uiHit1");
			audio.clip = hitSplash1;
			audio.Play();
			break;
		case 2:
			ani.Play("uiHit2");
			audio.clip = hitSplash2;
			audio.Play();
			break;
		case 3:
			ani.Play("uiHit3");
			audio.clip = hitSplash3;
			audio.Play();
			break;
		}
	}
}
public class uiFishMoving : MonoBehaviour
{
	public float maxDistance = 10f;

	public float movingSpeed = 1f;

	public float height = 1f;

	public GameObject fish;

	public GameObject shadow;

	public uicontroller controller;

	public AudioClip rightSound;

	public AudioClip wrongSound;

	public GameObject playerAni;

	private float fPosition;

	private float direction = -1f;

	private bool hitted;

	private void Start()
	{
		fish.GetComponent<Renderer>().material.SetColor("_Color", new Color(0.7f, 1f, 0.7f));
	}

	private void FixedUpdate()
	{
		fPosition += movingSpeed * Time.deltaTime * direction;
		if (fPosition > maxDistance)
		{
			direction = -1f;
		}
		else if (fPosition < 0f - maxDistance)
		{
			direction = 1f;
		}
		base.transform.localPosition = new Vector3(fPosition, Mathf.Sin(Time.time * movingSpeed) * height - 1.5f, base.transform.localPosition.z);
		if (direction == 1f)
		{
			base.transform.localRotation = Quaternion.Euler(0f, 180f, 0f);
		}
		else
		{
			base.transform.localRotation = Quaternion.Euler(0f, 0f, 0f);
		}
	}

	private void Update()
	{
		if (Input.GetKeyDown("z") || Input.GetButtonDown("Button A"))
		{
			GetComponent<AudioSource>().Play();
			if (hitted)
			{
				fish.GetComponent<Renderer>().material.SetColor("_Color", new Color(1f, 0f, 0f));
				controller.FishLifeDown();
				MonoBehaviour.print("hit");
				GetComponent<AudioSource>().PlayOneShot(rightSound);
			}
			else
			{
				controller.LifeLose();
				GetComponent<AudioSource>().PlayOneShot(wrongSound);
				playerAni.GetComponent<Animation>().Play("touchHip");
			}
		}
	}

	private void OnTriggerStay(Collider other)
	{
		if (other.CompareTag("ui"))
		{
			hitted = true;
		}
	}

	private void OnTriggerExit()
	{
		fish.GetComponent<Renderer>().material.SetColor("_Color", new Color(0.5f, 1f, 0.5f));
		hitted = false;
	}
}
public class uiGuide : MonoBehaviour
{
	public enum eGuide
	{
		ready,
		casting,
		retrieve,
		hookset,
		reeling,
		node,
		jump,
		groggy,
		landing,
		restart
	}

	public bool bGuideOn = true;

	public control_Fishing control;

	public control_Lure lureControl;

	[HideInInspector]
	public bool bGuidePause;

	public AudioClip[] guideVoice;

	private AudioSource audioG;

	public float[] guideTime;

	public Texture2D[] guideImages;

	public eGuide guideState;

	public GameObject tabletG;

	public Material screenMaterial;

	public GameObject tabletScreen;

	private void Start()
	{
		audioG = GetComponent<AudioSource>();
		screenMaterial.SetTexture("_MainTex", guideImages[0]);
		if (bGuideOn)
		{
			control_Fishing.bPause = true;
			tabletG.SetActive(value: true);
		}
		else
		{
			control_Fishing.bPause = false;
			tabletG.SetActive(value: false);
		}
	}

	private void Update()
	{
	}

	public void nextPlay(int state)
	{
		StartCoroutine(guideWait(state));
	}

	private IEnumerator guideWait(int state)
	{
		switch (state)
		{
		case 1:
			MonoBehaviour.print("casting");
			guideState = eGuide.casting;
			audioG.clip = guideVoice[0];
			audioG.Play();
			screenMaterial.SetTexture("_MainTex", guideImages[1]);
			yield return new WaitForSeconds(guideTime[0]);
			screenMaterial.SetTexture("_MainTex", guideImages[2]);
			control_Fishing.bPause = false;
			break;
		case 2:
			MonoBehaviour.print("retrive");
			screenMaterial.SetTexture("_MainTex", guideImages[3]);
			guideState = eGuide.retrieve;
			audioG.clip = guideVoice[1];
			audioG.Play();
			control_Fishing.bPause = true;
			yield return new WaitForSeconds(guideTime[1]);
			screenMaterial.SetTexture("_MainTex", guideImages[4]);
			control_Fishing.bPause = false;
			break;
		case 3:
			MonoBehaviour.print("hookset");
			guideState = eGuide.hookset;
			audioG.clip = guideVoice[2];
			audioG.Play();
			control_Fishing.bPause = true;
			yield return new WaitForSeconds(guideTime[2]);
			screenMaterial.SetTexture("_MainTex", guideImages[5]);
			control_Fishing.bPause = false;
			break;
		case 4:
			MonoBehaviour.print("reeling");
			audioG.Stop();
			guideState = eGuide.reeling;
			audioG.clip = guideVoice[3];
			audioG.Play();
			screenMaterial.SetTexture("_MainTex", guideImages[6]);
			yield return new WaitForSeconds(guideTime[3]);
			guideState = eGuide.node;
			lureControl.guideMoving();
			StartCoroutine(guideWait(5));
			break;
		case 5:
			MonoBehaviour.print("node");
			audioG.clip = guideVoice[4];
			audioG.Play();
			screenMaterial.SetTexture("_MainTex", guideImages[7]);
			yield return new WaitForSeconds(guideTime[4]);
			audioG.clip = guideVoice[5];
			audioG.Play();
			yield return new WaitForSeconds(guideTime[5]);
			screenMaterial.SetTexture("_MainTex", guideImages[8]);
			StartCoroutine(guideWait(6));
			break;
		case 6:
			MonoBehaviour.print("jump");
			guideState = eGuide.jump;
			break;
		case 7:
			MonoBehaviour.print("groggy");
			guideState = eGuide.groggy;
			screenMaterial.SetTexture("_MainTex", guideImages[9]);
			yield return new WaitForSeconds(guideTime[6]);
			audioG.clip = guideVoice[6];
			audioG.Play();
			break;
		case 8:
			MonoBehaviour.print("landing");
			guideState = eGuide.landing;
			audioG.clip = guideVoice[7];
			audioG.Play();
			screenMaterial.SetTexture("_MainTex", guideImages[10]);
			yield return new WaitForSeconds(guideTime[7]);
			control_Fishing.bPause = true;
			StartCoroutine(guideWait(9));
			break;
		case 9:
			MonoBehaviour.print("restart");
			guideState = eGuide.restart;
			audioG.clip = guideVoice[8];
			audioG.Play();
			tabletG.SetActive(value: false);
			control_Fishing.bPause = false;
			bGuideOn = false;
			break;
		}
		yield return null;
	}
}
public class uiHoverCheck : MonoBehaviour, IPointerEnterHandler, IEventSystemHandler, IPointerExitHandler
{
	public Text text;

	public void OnPointerEnter(PointerEventData pointerEventData)
	{
		if (text != null && !text.gameObject.activeSelf)
		{
			text.gameObject.SetActive(value: true);
		}
	}

	public void OnPointerExit(PointerEventData pointerEventData)
	{
		if (text != null && text.gameObject.activeSelf)
		{
			text.gameObject.SetActive(value: false);
		}
	}
}
public class uiObjOnTiming : MonoBehaviour
{
	public Text textUI;

	public GameObject uiObj;

	public int showTextNum;

	private void Start()
	{
	}

	public void hideAll()
	{
		textUI.enabled = false;
		uiObj.SetActive(value: false);
	}

	public void showTextUI()
	{
		textUI.enabled = true;
	}

	public void showLastUI()
	{
		uiObj.SetActive(value: true);
	}
}
public class uiScrollTexture : MonoBehaviour
{
	public float speed = 1f;

	public float limitX = -0.5f;

	private Material material;

	private float x;

	private void Start()
	{
		material = GetComponent<Renderer>().material;
		StartCoroutine(scroll());
	}

	private IEnumerator scroll()
	{
		while (true)
		{
			if (x >= limitX)
			{
				x -= Time.deltaTime * speed;
			}
			material.SetTextureOffset("_MainTex", new Vector3(x, 0f));
			yield return null;
		}
	}
}
public class uiStatePosition : MonoBehaviour
{
	public Transform camPos;

	public float speed = 1f;

	public bool useHeightCam;

	private void Start()
	{
	}

	private void LateUpdate()
	{
		if (useHeightCam)
		{
			base.transform.position = Vector3.Lerp(base.transform.position, camPos.position, Time.deltaTime * speed);
			base.transform.rotation = Quaternion.Lerp(base.transform.rotation, Quaternion.Euler(0f, camPos.eulerAngles.y, 0f), Time.deltaTime * speed);
		}
		else
		{
			base.transform.position = Vector3.Lerp(base.transform.position, new Vector3(camPos.position.x, 0f, camPos.position.z), Time.deltaTime * speed);
		}
	}
}
public class CheckInternet : MonoBehaviour
{
	public Text internetStatus;

	public string success = "CONNECTED INTERNET";

	public string fail = "INTERNET NOT CONNECTED";

	private void Awake()
	{
		internetStatus.text = "";
		OnlineCheck.Check(delegate(bool isConnected, NetworkReachability b)
		{
			if (!isConnected)
			{
				GetComponent<Localize>().SetKey("StartScene_0004");
			}
			else
			{
				GetComponent<Localize>().SetKey("StartScene_0003");
			}
		});
	}

	private void Start()
	{
	}
}
public class CreateDecryptionFile : MonoBehaviour
{
	public Text filename;

	private string savePath = "/Saves";

	private void Awake()
	{
	}

	private void Update()
	{
	}

	public void DecrytionButtonEvent()
	{
		string data = File.ReadAllText(UnityEngine.Application.persistentDataPath + savePath + "/" + filename.text + ".json");
		string contents = new AESEncryptor("castian2", AESBits.BITS128).Decrypt(data);
		File.WriteAllText(UnityEngine.Application.persistentDataPath + savePath + "/" + filename.text + "_descryt.json", contents);
	}
}
[AttributeUsage(AttributeTargets.Field, Inherited = false)]
public class NonDBAttribute : Attribute
{
}
[AttributeUsage(AttributeTargets.Field, Inherited = false)]
public class DataVersion : Attribute
{
	public readonly string version;

	public DataVersion(string version)
	{
		this.version = version;
	}
}
public class InternetStatus : MonoBehaviour
{
	private Text internetStatusText;

	private Localize localize;

	private void Awake()
	{
		internetStatusText = GetComponent<Text>();
		localize = GetComponent<Localize>();
		internetStatusText.text = "";
	}

	private void Start()
	{
		OnlineCheck.Check(delegate(bool isConnected, NetworkReachability b)
		{
			if (!isConnected)
			{
				localize.SetKey("StartScene/0004");
			}
			else
			{
				localize.SetKey("StartScene/0003");
			}
		});
	}

	private void OnEnable()
	{
	}

	private void OnDisable()
	{
	}
}
public class LoadManager : MonoBehaviour
{
	private void Start()
	{
	}

	private void Update()
	{
	}
}
public class PunSingleton<T> : MonoBehaviourPunCallbacks where T : MonoBehaviourPunCallbacks
{
	private static T _instance;

	private static object _lock = new object();

	private static bool applicationIsQuitting = false;

	public static T Instance
	{
		get
		{
			if (applicationIsQuitting)
			{
				UnityEngine.Debug.LogWarning(string.Concat("[PunSingleton] Instance '", typeof(T), "' 프로그램을 종료 할 때 이미 파괴되었습니다. 다시 생성하지 않고 null을 반환합니다."));
				return null;
			}
			lock (_lock)
			{
				if (_instance == null)
				{
					_instance = (T)UnityEngine.Object.FindObjectOfType(typeof(T));
					if (UnityEngine.Object.FindObjectsOfType(typeof(T)).Length > 1)
					{
						UnityEngine.Debug.LogError(string.Concat(_instance, " Many Instances"));
						return _instance;
					}
				}
				return _instance;
			}
		}
	}

	public void OnApplicationQuit()
	{
		applicationIsQuitting = true;
	}
}
public class SaveEditorManager : MonoBehaviour
{
	public ItemDatabase ItemDatabase;

	public UserData userData = new UserData();

	private string savePath = "/Saves";

	public string saveFilename = "userData.json";

	private bool isLoading;

	public List<Button> buttons;

	public Text message;

	private string secretKey;

	public DEVICE_TYPE targetPlatform = DEVICE_TYPE.QUEST;

	private AESBits encryptionBits;

	private byte[] salt = new byte[15]
	{
		0, 1, 2, 28, 29, 30, 3, 4, 5, 15,
		32, 33, 173, 175, 164
	};

	private void Awake()
	{
		foreach (Button button in buttons)
		{
			button.interactable = false;
		}
	}

	private IEnumerator Start()
	{
		yield return StartCoroutine(Load());
		yield return null;
		CreateDynamicData();
		foreach (Button button in buttons)
		{
			button.interactable = true;
		}
	}

	public void ActionAchieve0001()
	{
		message.text = "Processing...";
		userData.userLv = 8;
		userData.userExp = 835;
		Save();
	}

	public void ActionAchieve0002()
	{
		message.text = "Processing...";
		userData.userGold = 90000;
		Save();
	}

	public void ActionAchieve0003()
	{
		message.text = "Processing...";
		userData.achievements[0].achievement[2] = 29;
		userData.achievements[0].grade[2] = 2;
		Save();
	}

	public void ActionAchieve0004()
	{
		message.text = "Processing...";
		userData.achievements[0].achievement[3] = 29;
		userData.achievements[0].grade[3] = 2;
		Save();
	}

	public void ActionAchieve0005()
	{
		message.text = "Processing...";
		userData.achievements[0].achievement[4] = 29;
		userData.achievements[0].grade[4] = 2;
		Save();
	}

	public void ActionAchieve0006()
	{
		message.text = "Processing...";
		userData.achievements[0].achievement[5] = 29;
		userData.achievements[0].grade[5] = 2;
		Save();
	}

	public void ActionAchieve0007()
	{
		message.text = "Processing...";
		userData.achievements[0].achievement[6] = 119;
		userData.achievements[0].grade[6] = 2;
		Save();
	}

	public void ActionAchieve0008()
	{
		message.text = "Processing...";
		userData.achievements[0].achievement[7] = 299;
		userData.achievements[0].grade[7] = 2;
		Save();
	}

	public void ActionAchieve0009()
	{
		message.text = "Processing...";
		userData.fishes[0].fishCount[0] = 30;
		Save();
	}

	public void ActionAchieve0010()
	{
		message.text = "Processing...";
		userData.achievements[0].achievement[9] = 59;
		userData.achievements[0].grade[9] = 2;
		Save();
	}

	public void ActionAchieve0011()
	{
		message.text = "Processing...";
		userData.userGold = 5999;
		userData.achievements[0].achievement[10] = 5999;
		userData.achievements[0].grade[10] = 2;
		Save();
	}

	public void ActionAchieve0012()
	{
		message.text = "Processing...";
		userData.achievements[0].achievement[11] = 14;
		userData.achievements[0].grade[11] = 2;
		Save();
	}

	public void ChangeLevel(int level)
	{
		message.text = "Processing...";
		userData.userLv = level;
		Save();
	}

	public void ChangeCredits(int credit)
	{
		message.text = "Processing...";
		userData.userGold = credit;
		Save();
	}

	public void PurchaseDecorationItems()
	{
		message.text = "Processing...";
		foreach (AquariumData item in userData.aquariums[0].rooms[0].items)
		{
			item.purchased = true;
			item.state = true;
		}
		foreach (FurnitureData item2 in userData.furnitures[0].rooms[1].items)
		{
			item2.purchased = true;
			item2.state = true;
		}
		Save();
	}

	public void ResetSaveData()
	{
		message.text = "Processing...";
		userData = new UserData();
		CreateDynamicData();
		Save();
	}

	public void Restart()
	{
		message.text = "Processing...";
		if (Singleton<DataManager>.Instance != null)
		{
			UnityEngine.Object.Destroy(Singleton<DataManager>.Instance.gameObject);
		}
		SceneManager.LoadSceneAsync("Title");
	}

	public IEnumerator Load()
	{
		isLoading = true;
		string path = UnityEngine.Application.persistentDataPath + "/Saves/" + saveFilename;
		if (File.Exists(path))
		{
			try
			{
				string data = File.ReadAllText(path);
				AESEncryptor("castian2", AESBits.BITS128);
				string text = Decrypt(data);
				if (!string.IsNullOrEmpty(text))
				{
					Parse(text);
				}
			}
			catch (Exception ex)
			{
				MonoBehaviour.print("Load Exception : " + ex);
				isLoading = false;
			}
		}
		while (isLoading)
		{
			yield return null;
		}
		yield return true;
	}

	private void AESEncryptor(string password, AESBits encryptionBits)
	{
		switch (targetPlatform)
		{
		case DEVICE_TYPE.GO:
			secretKey = "castian2";
			break;
		case DEVICE_TYPE.QUEST:
			secretKey = "castian2";
			break;
		case DEVICE_TYPE.RIFT:
			secretKey = "castian2r";
			break;
		case DEVICE_TYPE.OTHERS:
			secretKey = "castian2";
			break;
		}
		this.encryptionBits = encryptionBits;
	}

	public string Decrypt(string data)
	{
		Rfc2898DeriveBytes rfc2898DeriveBytes = new Rfc2898DeriveBytes(secretKey, salt, 50);
		return encryptionBits switch
		{
			AESBits.BITS128 => Decrypt(data, rfc2898DeriveBytes.GetBytes(16), rfc2898DeriveBytes.GetBytes(16)), 
			AESBits.BITS192 => Decrypt(data, rfc2898DeriveBytes.GetBytes(24), rfc2898DeriveBytes.GetBytes(16)), 
			AESBits.BITS256 => Decrypt(data, rfc2898DeriveBytes.GetBytes(32), rfc2898DeriveBytes.GetBytes(16)), 
			_ => null, 
		};
	}

	public string Decrypt(string data, byte[] key, byte[] iv)
	{
		RijndaelManaged obj = new RijndaelManaged
		{
			Mode = CipherMode.CBC,
			Padding = PaddingMode.PKCS7
		};
		byte[] array = Convert.FromBase64String(data);
		obj.Key = key;
		obj.IV = iv;
		byte[] bytes = obj.CreateDecryptor().TransformFinalBlock(array, 0, array.Length);
		return Encoding.UTF8.GetString(bytes);
	}

	private byte[] Decrypt(byte[] data, byte[] key, byte[] iv)
	{
		MemoryStream memoryStream = new MemoryStream();
		CryptoStream cryptoStream = new CryptoStream(memoryStream, new RijndaelManaged
		{
			Key = key,
			IV = iv
		}.CreateDecryptor(), CryptoStreamMode.Write);
		cryptoStream.Write(data, 0, data.Length);
		cryptoStream.Dispose();
		return memoryStream.ToArray();
	}

	public void Parse(string data)
	{
		if (JObject.Parse(data)["version"] != null)
		{
			userData.version = (string)JObject.Parse(data).GetValue("version");
		}
		if (JObject.Parse(data)["nickName"] != null)
		{
			userData.nickName = (string)JObject.Parse(data).GetValue("nickName");
		}
		if (JObject.Parse(data)["id"] != null)
		{
			userData.id = (ulong)JObject.Parse(data).GetValue("id");
		}
		if (JObject.Parse(data)["userLv"] != null)
		{
			userData.userLv = (int)JObject.Parse(data).GetValue("userLv");
		}
		if (JObject.Parse(data)["userExp"] != null)
		{
			userData.userExp = (int)JObject.Parse(data).GetValue("userExp");
		}
		if (JObject.Parse(data)["userGold"] != null)
		{
			userData.userGold = (int)JObject.Parse(data).GetValue("userGold");
		}
		if (JObject.Parse(data)["userConnectedCount"] != null)
		{
			userData.userConnectedCount = (int)JObject.Parse(data).GetValue("userConnectedCount");
		}
		if (JObject.Parse(data)["playtime"] != null)
		{
			userData.playtime = (int)JObject.Parse(data).GetValue("playtime");
		}
		if (JObject.Parse(data)["curRodS"] != null)
		{
			userData.curRodS = (int)JObject.Parse(data).GetValue("curRodS");
		}
		if (JObject.Parse(data)["curRodC"] != null)
		{
			userData.curRodC = (int)JObject.Parse(data).GetValue("curRodC");
		}
		if (JObject.Parse(data)["curReelS"] != null)
		{
			userData.curReelS = (int)JObject.Parse(data).GetValue("curReelS");
		}
		if (JObject.Parse(data)["curReelC"] != null)
		{
			userData.curReelC = (int)JObject.Parse(data).GetValue("curReelC");
		}
		if (JObject.Parse(data)["curLure"] != null)
		{
			userData.curLure = (int)JObject.Parse(data).GetValue("curLure");
		}
		if (JObject.Parse(data)["curGlove"] != null)
		{
			userData.curGlove = (int)JObject.Parse(data).GetValue("curGlove");
		}
		if (JObject.Parse(data)["curBoat"] != null)
		{
			userData.curBoat = (int)JObject.Parse(data).GetValue("curBoat");
		}
		if (JObject.Parse(data)["curNation"] != null)
		{
			userData.curNation = (int)JObject.Parse(data).GetValue("curNation");
		}
		if (JObject.Parse(data)["rodS"] != null)
		{
			userData.rodS = JObject.Parse(data).Value<JArray>("rodS").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["rodC"] != null)
		{
			userData.rodC = JObject.Parse(data).Value<JArray>("rodC").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["rodSDurability"] != null)
		{
			userData.rodSDurability = JObject.Parse(data).Value<JArray>("rodSDurability").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["rodCDurability"] != null)
		{
			userData.rodCDurability = JObject.Parse(data).Value<JArray>("rodCDurability").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["reelS"] != null)
		{
			userData.reelS = JObject.Parse(data).Value<JArray>("reelS").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["reelC"] != null)
		{
			userData.reelC = JObject.Parse(data).Value<JArray>("reelC").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["reelSDurability"] != null)
		{
			userData.reelSDurability = JObject.Parse(data).Value<JArray>("reelSDurability").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["reelCDurability"] != null)
		{
			userData.reelCDurability = JObject.Parse(data).Value<JArray>("reelCDurability").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["curType"] != null)
		{
			userData.curType = (int)JObject.Parse(data).GetValue("curType");
		}
		if (JObject.Parse(data)["lure"] != null)
		{
			userData.lure = JObject.Parse(data).Value<JArray>("lure").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["lureDurability"] != null)
		{
			userData.lureDurability = JObject.Parse(data).Value<JArray>("lureDurability").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["line"] != null)
		{
			userData.line = JObject.Parse(data).Value<JArray>("line").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["lineDurability"] != null)
		{
			userData.lineDurability = JObject.Parse(data).Value<JArray>("lineDurability").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["gloves"] != null)
		{
			userData.gloves = JObject.Parse(data).Value<JArray>("gloves").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["boats"] != null)
		{
			userData.boats = JObject.Parse(data).Value<JArray>("boats").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["spotCount"] != null)
		{
			userData.spotCount = JObject.Parse(data).Value<JArray>("spotCount").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["fishTotal"] != null)
		{
			userData.fishTotal = (int)JObject.Parse(data).GetValue("fishTotal");
		}
		if (JObject.Parse(data)["season"] != null)
		{
			userData.season = (int)JObject.Parse(data).GetValue("season");
		}
		if (JObject.Parse(data)["totalScore"] != null)
		{
			userData.totalScore = (int)JObject.Parse(data).GetValue("totalScore");
		}
		if (JObject.Parse(data)["seasonRank"] != null)
		{
			userData.seasonRank = JObject.Parse(data).Value<JArray>("seasonRank").ToObject<List<int>>();
		}
		if (JObject.Parse(data)["nations"] != null)
		{
			List<NationData> nations = JObject.Parse(data).Value<JArray>("nations").ToObject<List<NationData>>();
			userData.nations = nations;
		}
		if (JObject.Parse(data)["rooms"] != null)
		{
			List<RoomList> rooms = JObject.Parse(data).Value<JArray>("rooms").ToObject<List<RoomList>>();
			userData.rooms = rooms;
		}
		if (JObject.Parse(data)["furnitures"] != null)
		{
			List<FurnitureRoomList> furnitures = JObject.Parse(data).Value<JArray>("furnitures").ToObject<List<FurnitureRoomList>>();
			userData.furnitures = furnitures;
		}
		if (JObject.Parse(data)["aquariums"] != null)
		{
			List<AquariumRoomList> aquariums = JObject.Parse(data).Value<JArray>("aquariums").ToObject<List<AquariumRoomList>>();
			userData.aquariums = aquariums;
		}
		if (JObject.Parse(data)["fishes"] != null)
		{
			List<FishNationList> fishes = JObject.Parse(data).Value<JArray>("fishes").ToObject<List<FishNationList>>();
			userData.fishes = fishes;
		}
		if (JObject.Parse(data)["achievements"] != null)
		{
			List<AchieveNationList> achievements = JObject.Parse(data).Value<JArray>("achievements").ToObject<List<AchieveNationList>>();
			userData.achievements = achievements;
		}
		int count = userData.rodS.Count;
		int count2 = userData.rodC.Count;
		int count3 = userData.reelS.Count;
		int count4 = userData.reelC.Count;
		int count5 = userData.lure.Count;
		int num = count + count2 + count3 + count4 + count5;
		if (num != userData.achievements[0].achievement[1])
		{
			userData.achievements[0].achievement[1] = num;
			for (int i = 0; i < ItemDatabase.dlcs[0].achieveItems[1].targetNumber.Count(); i++)
			{
				if (ItemDatabase.dlcs[0].achieveItems[1].targetNumber[i] <= num)
				{
					userData.achievements[0].grade[1] = i + 1;
				}
			}
		}
		if (JObject.Parse(data)["selectedAudioNumber"] != null)
		{
			userData.selectedAudioNumber = (int)JObject.Parse(data).GetValue("selectedAudioNumber");
		}
		if (JObject.Parse(data)["selectedAudioTime"] != null)
		{
			userData.selectedAudioTime = (float)JObject.Parse(data).GetValue("selectedAudioTime");
		}
		if (JObject.Parse(data)["playOn"] != null)
		{
			userData.playOn = (bool)JObject.Parse(data).GetValue("playOn");
		}
		if (JObject.Parse(data)["loopOn"] != null)
		{
			userData.loopOn = (bool)JObject.Parse(data).GetValue("loopOn");
		}
		if (JObject.Parse(data)["shuffleOn"] != null)
		{
			userData.shuffleOn = (bool)JObject.Parse(data).GetValue("shuffleOn");
		}
		if (JObject.Parse(data)["volumeMusic"] != null)
		{
			userData.volumeMusic = (int)JObject.Parse(data).GetValue("volumeMusic");
		}
		if (JObject.Parse(data)["volumeAmbient"] != null)
		{
			userData.volumeAmbient = (int)JObject.Parse(data).GetValue("volumeAmbient");
		}
		if (JObject.Parse(data)["graphicQuality"] != null)
		{
			userData.graphicQuality = (int)JObject.Parse(data).GetValue("graphicQuality");
		}
		if (JObject.Parse(data)["bFrameRateHigh"] != null)
		{
			userData.bFrameRateHigh = (bool)JObject.Parse(data).GetValue("bFrameRateHigh");
		}
		if (JObject.Parse(data)["gameDifficulty"] != null)
		{
			userData.gameDifficulty = (int)JObject.Parse(data).GetValue("gameDifficulty");
		}
		if (JObject.Parse(data)["walkCabin"] != null)
		{
			userData.walkCabin = (int)JObject.Parse(data).GetValue("walkCabin");
		}
		if (JObject.Parse(data)["rotateCabin"] != null)
		{
			userData.rotateCabin = (int)JObject.Parse(data).GetValue("rotateCabin");
		}
		if (JObject.Parse(data)["rightHand"] != null)
		{
			userData.rightHand = (bool)JObject.Parse(data).GetValue("rightHand");
		}
		if (JObject.Parse(data)["bothHand"] != null)
		{
			userData.bothHand = (bool)JObject.Parse(data).GetValue("bothHand");
		}
		if (JObject.Parse(data)["deviceType"] != null)
		{
			userData.deviceType = (int)JObject.Parse(data).GetValue("deviceType");
		}
		if (JObject.Parse(data)["position"] != null)
		{
			userData.position = JObject.Parse(data)["position"].ToObject<SerializableVector3>();
		}
		if (JObject.Parse(data)["lastConnect"] != null)
		{
			userData.lastConnect = (string)JObject.Parse(data).GetValue("lastConnect");
		}
		if (JObject.Parse(data)["language"] != null)
		{
			userData.language = (int)JObject.Parse(data).GetValue("language");
		}
		if (JObject.Parse(data)["cabinTime"] != null)
		{
			userData.cabinTime = (int)JObject.Parse(data).GetValue("cabinTime");
		}
		if (JObject.Parse(data)["controlType"] != null)
		{
			userData.controlType = (int)JObject.Parse(data).GetValue("controlType");
		}
		if (JObject.Parse(data)["unit"] != null)
		{
			userData.unit = (int)JObject.Parse(data).GetValue("unit");
		}
		if (JObject.Parse(data)["lineEffect"] != null)
		{
			userData.rightHand = (bool)JObject.Parse(data).GetValue("lineEffect");
		}
		if (JObject.Parse(data)["autoSave"] != null)
		{
			userData.autoSave = (bool)JObject.Parse(data).GetValue("autoSave");
		}
		isLoading = false;
	}

	public bool Save()
	{
		try
		{
			userData.version = UnityEngine.Application.version;
			string text = null;
			string data = JsonConvert.SerializeObject(userData, Formatting.Indented);
			AESEncryptor("castian2", AESBits.BITS128);
			text = Encrypt(data);
			_ = UnityEngine.Application.persistentDataPath + savePath + "/" + saveFilename;
			File.WriteAllText(UnityEngine.Application.persistentDataPath + savePath + "/" + saveFilename, text);
			UnityEngine.Debug.Log("Success SaveUserData");
			message.text = "Success Save";
			return true;
		}
		catch (Exception ex)
		{
			UnityEngine.Debug.Log("Exception SaveUserData : " + ex);
			message.text = "Exception Save";
			return false;
		}
	}

	public string Encrypt(string data)
	{
		Rfc2898DeriveBytes rfc2898DeriveBytes = new Rfc2898DeriveBytes(secretKey, salt, 50);
		return encryptionBits switch
		{
			AESBits.BITS128 => Encrypt(data, rfc2898DeriveBytes.GetBytes(16), rfc2898DeriveBytes.GetBytes(16)), 
			AESBits.BITS192 => Encrypt(data, rfc2898DeriveBytes.GetBytes(24), rfc2898DeriveBytes.GetBytes(16)), 
			AESBits.BITS256 => Encrypt(data, rfc2898DeriveBytes.GetBytes(32), rfc2898DeriveBytes.GetBytes(16)), 
			_ => null, 
		};
	}

	private byte[] Encrypt(byte[] data, byte[] key, byte[] iV)
	{
		MemoryStream memoryStream = new MemoryStream();
		CryptoStream cryptoStream = new CryptoStream(memoryStream, new RijndaelManaged
		{
			Key = key,
			IV = iV
		}.CreateEncryptor(), CryptoStreamMode.Write);
		cryptoStream.Write(data, 0, data.Length);
		cryptoStream.Dispose();
		return memoryStream.ToArray();
	}

	public string Encrypt(string data, byte[] key, byte[] iv)
	{
		ICryptoTransform cryptoTransform = new RijndaelManaged
		{
			Mode = CipherMode.CBC,
			Padding = PaddingMode.PKCS7,
			Key = key,
			IV = iv
		}.CreateEncryptor();
		byte[] bytes = Encoding.UTF8.GetBytes(data);
		return Convert.ToBase64String(cryptoTransform.TransformFinalBlock(bytes, 0, bytes.Length));
	}

	public void CreateDynamicData()
	{
		List<DLC> nationItems = ItemDatabase.dlcs;
		int i;
		for (i = 0; i < nationItems.Count; i++)
		{
			if (!userData.nations.Any((NationData s) => s.id == nationItems[i].nation.ID))
			{
				userData.nations.Add(new NationData
				{
					id = nationItems[i].nation.ID,
					name = nationItems[i].nation.ItemName,
					purchased = nationItems[i].purchased
				});
			}
		}
		CreateRooms();
	}

	public void CreateRooms()
	{
		List<DLC> nationItems = ItemDatabase.dlcs;
		for (int i = 0; i < nationItems.Count; i++)
		{
			if (userData.rooms.Count < nationItems.Count)
			{
				userData.rooms.Add(new RoomList
				{
					nationName = nationItems[i].nation.ItemName
				});
			}
			int j;
			for (j = 0; j < nationItems[i].roomItems.Count; j++)
			{
				if (!userData.rooms[i].items.Any((RoomData s) => s.id == nationItems[i].roomItems[j].ID))
				{
					bool defaultItem = nationItems[i].roomItems[j].defaultItem;
					userData.rooms[i].items.Add(new RoomData
					{
						id = nationItems[i].roomItems[j].ID,
						name = nationItems[i].roomItems[j].ItemName,
						purchased = defaultItem
					});
				}
			}
		}
		CreateFishes();
		CreateAchieve();
		CreateFurnitures();
		CreateAquariums();
	}

	public void CreateAchieve()
	{
		List<DLC> dlcs = ItemDatabase.dlcs;
		for (int i = 0; i < dlcs.Count; i++)
		{
			if (userData.achievements.Count < dlcs.Count)
			{
				userData.achievements.Add(new AchieveNationList
				{
					nationName = dlcs[i].nation.ItemName
				});
			}
			for (int j = 0; j < ItemDatabase.dlcs[i].achieveItems.Count(); j++)
			{
				if (userData.achievements[i].achievement.Count < ItemDatabase.dlcs[i].achieveItems.Count())
				{
					userData.achievements[i].achievement.Add(0);
					userData.achievements[i].grade.Add(0);
				}
			}
		}
	}

	public void CreateFishes()
	{
		List<DLC> dlcs = ItemDatabase.dlcs;
		for (int i = 0; i < dlcs.Count; i++)
		{
			if (userData.fishes.Count < dlcs.Count)
			{
				userData.fishes.Add(new FishNationList
				{
					nationName = dlcs[i].nation.ItemName
				});
			}
			for (int j = 0; j < dlcs[i].fishItems.Count; j++)
			{
				if (userData.fishes[i].fishCount.Count < dlcs[i].fishItems.Count)
				{
					userData.fishes[i].fishCount.Add(0);
					userData.fishes[i].maxSize.Add(0f);
					userData.fishes[i].maxWeight.Add(0f);
				}
			}
		}
	}

	public void CreateFurnitures()
	{
		List<DLC> nationItems = ItemDatabase.dlcs;
		for (int i = 0; i < nationItems.Count; i++)
		{
			if (userData.furnitures.Count < nationItems.Count)
			{
				userData.furnitures.Add(new FurnitureRoomList
				{
					nationName = nationItems[i].nation.ItemName
				});
			}
			for (int k = 0; k < nationItems[i].roomItems.Count; k++)
			{
				if (userData.furnitures[i].rooms.Count < nationItems[i].roomItems.Count)
				{
					userData.furnitures[i].rooms.Add(new FurnitureDataList
					{
						roomName = "Room_" + k
					});
				}
				int j;
				for (j = 0; j < nationItems[i].furnitureItems.Count; j++)
				{
					if (nationItems[i].furnitureItems[j].nationId == i && nationItems[i].furnitureItems[j].lobbyId == k && !userData.furnitures[i].rooms[k].items.Any((FurnitureData s) => s.id == nationItems[i].furnitureItems[j].ID))
					{
						bool defaultItem = nationItems[i].furnitureItems[j].defaultItem;
						bool state = nationItems[i].furnitureItems[j].state;
						userData.furnitures[i].rooms[k].items.Add(new FurnitureData
						{
							id = nationItems[i].furnitureItems[j].ID,
							name = nationItems[i].furnitureItems[j].ItemName,
							purchased = defaultItem,
							state = state
						});
					}
				}
			}
		}
	}

	public void CreateAquariums()
	{
		List<DLC> nationItems = ItemDatabase.dlcs;
		int num = 25;
		int num2 = 22;
		for (int i = 0; i < nationItems.Count; i++)
		{
			if (userData.aquariums.Count < nationItems.Count)
			{
				userData.aquariums.Add(new AquariumRoomList
				{
					nationName = nationItems[i].nation.ItemName
				});
			}
			for (int k = 0; k < nationItems[i].roomItems.Count; k++)
			{
				if (userData.aquariums[i].rooms.Count < nationItems[i].roomItems.Count)
				{
					userData.aquariums[i].rooms.Add(new AquariumDataList
					{
						roomName = "Room_" + k
					});
				}
				int j;
				for (j = 0; j < nationItems[i].aquaItems.Count(); j++)
				{
					if (nationItems[i].aquaItems[j].nationId == i && nationItems[i].aquaItems[j].lobbyId == k && !userData.aquariums[i].rooms[k].items.Any((AquariumData s) => s.id == nationItems[i].aquaItems[j].ID))
					{
						bool defaultItem = nationItems[i].aquaItems[j].defaultItem;
						bool state = nationItems[i].aquaItems[j].state;
						userData.aquariums[i].rooms[k].items.Add(new AquariumData
						{
							id = nationItems[i].aquaItems[j].ID,
							name = nationItems[i].aquaItems[j].ItemName,
							purchased = defaultItem,
							state = state
						});
					}
				}
				int num3 = 0;
				num3 = ((k != 0) ? num2 : num);
				for (int l = 0; l < num3; l++)
				{
					if (userData.aquariums[i].rooms[k].fishCount.Count < num3)
					{
						userData.aquariums[i].rooms[k].fishCount.Add(0);
					}
				}
			}
		}
	}
}
public class ScreenFlash : MonoBehaviour
{
	private AudioSource flashSound;

	[Tooltip("Fade duration")]
	public float fadeTime = 2f;

	public float maxAlpha = 0.2f;

	[Tooltip("Screen color at maximum fade")]
	public Color fadeColor = new Color(0.01f, 0.01f, 0.01f, 1f);

	public int renderQueue = 5000;

	private float uiFadeAlpha;

	private MeshRenderer fadeRenderer;

	private MeshFilter fadeMesh;

	private Material fadeMaterial;

	private bool isFading;

	public float currentAlpha { get; private set; }

	private void Awake()
	{
		flashSound = GetComponent<AudioSource>();
		fadeMaterial = new Material(Shader.Find("Oculus/Unlit Transparent Color"));
		fadeMesh = base.gameObject.AddComponent<MeshFilter>();
		fadeRenderer = base.gameObject.AddComponent<MeshRenderer>();
		Mesh mesh = new Mesh();
		fadeMesh.mesh = mesh;
		Vector3[] array = new Vector3[4];
		float num = 2f;
		float num2 = 2f;
		float z = 1f;
		array[0] = new Vector3(0f - num, 0f - num2, z);
		array[1] = new Vector3(num, 0f - num2, z);
		array[2] = new Vector3(0f - num, num2, z);
		array[3] = new Vector3(num, num2, z);
		mesh.vertices = array;
		mesh.triangles = new int[6] { 0, 2, 1, 2, 3, 1 };
		mesh.normals = new Vector3[4]
		{
			-Vector3.forward,
			-Vector3.forward,
			-Vector3.forward,
			-Vector3.forward
		};
		mesh.uv = new Vector2[4]
		{
			new Vector2(0f, 0f),
			new Vector2(1f, 0f),
			new Vector2(0f, 1f),
			new Vector2(1f, 1f)
		};
		SetFadeLevel(0f);
	}

	private void OnDestroy()
	{
		if (fadeRenderer != null)
		{
			UnityEngine.Object.Destroy(fadeRenderer);
		}
		if (fadeMaterial != null)
		{
			UnityEngine.Object.Destroy(fadeMaterial);
		}
		if (fadeMesh != null)
		{
			UnityEngine.Object.Destroy(fadeMesh);
		}
	}

	public void doFlash()
	{
		StartCoroutine(Fade());
	}

	public void SetUIFade(float level)
	{
		uiFadeAlpha = Mathf.Clamp01(level);
		SetMaterialAlpha();
	}

	public void SetFadeLevel(float level)
	{
		currentAlpha = level;
		SetMaterialAlpha();
	}

	private IEnumerator Fade()
	{
		yield return new WaitForSeconds(0.5f);
		flashSound.Play();
		float elapsedTime2 = 0f;
		while (elapsedTime2 < fadeTime)
		{
			elapsedTime2 += Time.deltaTime;
			currentAlpha = Mathf.Lerp(0f, maxAlpha, Mathf.Clamp01(elapsedTime2 / fadeTime));
			SetMaterialAlpha();
			yield return new WaitForEndOfFrame();
		}
		elapsedTime2 = 0f;
		while (elapsedTime2 < fadeTime)
		{
			elapsedTime2 += Time.deltaTime;
			currentAlpha = Mathf.Lerp(maxAlpha, 0f, Mathf.Clamp01(elapsedTime2 / fadeTime));
			SetMaterialAlpha();
			yield return new WaitForEndOfFrame();
		}
	}

	private void SetMaterialAlpha()
	{
		Color color = fadeColor;
		color.a = Mathf.Max(currentAlpha, uiFadeAlpha);
		isFading = color.a > 0f;
		if (fadeMaterial != null)
		{
			fadeMaterial.color = color;
			fadeMaterial.renderQueue = renderQueue;
			fadeRenderer.material = fadeMaterial;
			fadeRenderer.enabled = isFading;
		}
	}
}
public class ScreenShotManager : MonoBehaviour
{
	private enum eCaptureState
	{
		none,
		front,
		selfie
	}

	private enum eHandphoneState
	{
		none,
		front,
		lefthand,
		righthand
	}

	public RenderTexture camRT;

	public GameObject screenObj;

	public Transform camPivot;

	public Transform centerPivot;

	public Transform leftPivot;

	public Transform rightPivot;

	private ScreenFlash flashEffect;

	private string savePath = "/Screenshots";

	private string fileName = "RVF_";

	private string fullPath;

	private string path = "";

	public Camera cam;

	public bool customResolution = true;

	public int cWidth = 1920;

	public int cHeight = 1080;

	private bool isReady = true;

	public float camDistance = 0.5f;

	public float selfieDistance = 0.8f;

	public float shotIdleTime = 0.5f;

	private float pushedTime;

	private GameObject tempGetwebView;

	private Shader stereoShader;

	private Shader cpatureShader;

	private AudioSource camSound;

	public CanvasGroup manualCanvas;

	private eCaptureState captureState;

	private eHandphoneState phoneState;

	private Vector3 screenScale;

	private IEnumerator coroutineHide;

	private Main main;

	private void Awake()
	{
		main = Singleton<Main>.Instance;
		screenScale = screenObj.transform.localScale;
		captureState = eCaptureState.none;
		camPivot.gameObject.SetActive(value: false);
		cam.enabled = false;
		camSound = GetComponent<AudioSource>();
		coroutineHide = hideCanava();
		if (cam == null)
		{
			cam = GameObject.Find("CenterEyeAnchor").GetComponent<Camera>();
		}
		try
		{
			path = GetScreentShotFolder();
			if (!Directory.Exists(path))
			{
				Directory.CreateDirectory(path);
			}
		}
		catch (IOException ex)
		{
			MonoBehaviour.print(ex.Message);
		}
		stereoShader = Shader.Find("Vuplex/Android Single Pass Stereo Viewport Shader");
		cpatureShader = Shader.Find("Vuplex/Android Viewport Shader");
	}

	private void Update()
	{
		CaptureCamShow();
		CheckGrabSmartphone();
	}

	private void LateUpdate()
	{
		SetPosition();
	}

	public void CheckGrabSmartphone()
	{
		if (main.scene == SceneState.STAGE)
		{
			if (VRInput.bInputGrabDown(VRInput.Hand.LEFT) && main.vrFishingPointerL.DetectSmartPhone())
			{
				if (main.fishingControl.gameState != control_Fishing.EfishingState.catching || !Singleton<DataManager>.Instance.userData.rightHand)
				{
					MovetoHand(isRight: false);
					main.handControl.setTackleGround(handReset: false);
				}
			}
			else if (VRInput.bInputGrabDown(VRInput.Hand.RIGHT) && main.vrFishingPointerR.DetectSmartPhone() && (main.fishingControl.gameState != control_Fishing.EfishingState.catching || Singleton<DataManager>.Instance.userData.rightHand))
			{
				MovetoHand(isRight: true);
				main.handControl.setTackleGround(handReset: false);
			}
			return;
		}
		if (VRInput.bInputGrabDown(VRInput.Hand.LEFT) && main.vrLobbyPointerL.DetectSmartPhone())
		{
			MovetoHand(isRight: false);
			main.lobbyLefthandController.setHandState(isGrab: true);
			main.lobbyRighthandController.setHandState(isGrab: false);
		}
		if (VRInput.bInputGrabDown(VRInput.Hand.RIGHT) && main.vrLobbyPointerR.DetectSmartPhone())
		{
			MovetoHand(isRight: true);
			main.lobbyLefthandController.setHandState(isGrab: false);
			main.lobbyRighthandController.setHandState(isGrab: true);
		}
	}

	public void MovetoHand(bool isRight)
	{
		if (main.scene == SceneState.STAGE)
		{
			if (isRight)
			{
				if (main.fishingControl.gameState != control_Fishing.EfishingState.catching)
				{
					main.handControl.lefthandControl.setHandState(control_hand.eHandState.normal);
				}
				phoneState = eHandphoneState.righthand;
				main.handControl.righthandControl.setHandState(control_hand.eHandState.grab);
				camPivot.parent = rightPivot;
				MultiPhonePosEvent(3);
			}
			else
			{
				if (main.fishingControl.gameState != control_Fishing.EfishingState.catching)
				{
					main.handControl.righthandControl.setHandState(control_hand.eHandState.normal);
				}
				phoneState = eHandphoneState.lefthand;
				main.handControl.lefthandControl.setHandState(control_hand.eHandState.grab);
				camPivot.parent = leftPivot;
				MultiPhonePosEvent(2);
			}
		}
		else if (isRight)
		{
			phoneState = eHandphoneState.righthand;
			main.lobbyLefthandController.setHandState(isGrab: false);
			main.lobbyRighthandController.setHandState(isGrab: true);
			camPivot.parent = rightPivot;
			MultiPhonePosEvent(3);
		}
		else
		{
			phoneState = eHandphoneState.lefthand;
			main.lobbyLefthandController.setHandState(isGrab: true);
			main.lobbyRighthandController.setHandState(isGrab: false);
			camPivot.parent = leftPivot;
			MultiPhonePosEvent(2);
		}
		camPivot.localPosition = Vector3.zero;
		camPivot.localRotation = Quaternion.identity;
	}

	public void MovetoCenter()
	{
		MultiPhonePosEvent(1);
		phoneState = eHandphoneState.front;
		camPivot.parent = centerPivot;
		camPivot.localPosition = Vector3.zero;
		camPivot.localRotation = Quaternion.identity;
	}

	public void CaptureCamShow()
	{
		if (Singleton<DataManager>.Instance == null)
		{
			return;
		}
		if (VRInput.Button_B_Click(VRInput.eController.bothhand))
		{
			switch (captureState)
			{
			case eCaptureState.none:
				if (coroutineHide != null)
				{
					StopCoroutine(coroutineHide);
				}
				manualCanvas.alpha = 1f;
				coroutineHide = hideCanava();
				StartCoroutine(coroutineHide);
				MovetoCenter();
				captureState = eCaptureState.front;
				camPivot.gameObject.SetActive(value: true);
				cam.enabled = true;
				cam.transform.localEulerAngles = Vector3.zero;
				if (phoneState == eHandphoneState.lefthand || phoneState == eHandphoneState.righthand)
				{
					camPivot.transform.localPosition = new Vector3(0f, 0f, 0f);
				}
				else
				{
					camPivot.transform.localPosition = new Vector3(0f, 0f, camDistance);
				}
				screenObj.transform.localScale = screenScale;
				MultiPhonePosEvent(1);
				break;
			case eCaptureState.front:
				captureState = eCaptureState.selfie;
				camPivot.gameObject.SetActive(value: true);
				cam.enabled = true;
				cam.transform.localEulerAngles = new Vector3(0f, 180f, 0f);
				if (phoneState == eHandphoneState.lefthand || phoneState == eHandphoneState.righthand)
				{
					camPivot.transform.localPosition = new Vector3(0f, 0f, 0f);
				}
				else
				{
					camPivot.transform.localPosition = new Vector3(0f, 0f, selfieDistance);
				}
				screenObj.transform.localScale = new Vector3(0f - screenScale.x, screenScale.y, screenScale.z);
				break;
			case eCaptureState.selfie:
				Reset(handReset: true);
				break;
			}
		}
		if (!isReady || captureState == eCaptureState.none)
		{
			return;
		}
		if (phoneState == eHandphoneState.front)
		{
			if (VRInput.bInputTriggerDown(VRInput.eController.bothhand))
			{
				StartCoroutine(Shot(path));
			}
		}
		else if (phoneState == eHandphoneState.lefthand)
		{
			if (VRInput.bInputTriggerDown(VRInput.Hand.LEFT))
			{
				StartCoroutine(Shot(path));
			}
		}
		else if (phoneState == eHandphoneState.righthand && VRInput.bInputTriggerDown(VRInput.Hand.RIGHT))
		{
			StartCoroutine(Shot(path));
		}
	}

	private IEnumerator hideCanava()
	{
		yield return new WaitForSeconds(3f);
		float alpha = 1f;
		while (alpha > 0f)
		{
			alpha -= Time.deltaTime * 2f;
			manualCanvas.alpha = alpha;
			yield return null;
		}
		manualCanvas.alpha = 0f;
	}

	private void SetPosition()
	{
		if (phoneState == eHandphoneState.righthand)
		{
			base.transform.SetPositionAndRotation(main.rightHandTransform.position, main.rightHandTransform.rotation);
		}
		else if (phoneState == eHandphoneState.lefthand)
		{
			base.transform.SetPositionAndRotation(main.leftHandTransform.position, main.leftHandTransform.rotation);
		}
		else
		{
			base.transform.SetPositionAndRotation(Singleton<Main>.Instance.cameraTransform.position, Singleton<Main>.Instance.cameraTransform.rotation);
		}
	}

	public void GrabRod()
	{
		if (Singleton<DataManager>.Instance.userData.rightHand)
		{
			if (phoneState == eHandphoneState.lefthand)
			{
				main.handControl.lefthandControl.setHandState(control_hand.eHandState.normal);
			}
		}
		else if (phoneState == eHandphoneState.righthand)
		{
			main.handControl.righthandControl.setHandState(control_hand.eHandState.normal);
		}
		Reset(handReset: false);
	}

	public void Reset(bool handReset)
	{
		if (main.scene == SceneState.STAGE)
		{
			if (handReset)
			{
				if (phoneState == eHandphoneState.lefthand)
				{
					main.handControl.lefthandControl.setHandState(control_hand.eHandState.normal);
				}
				else if (phoneState == eHandphoneState.righthand)
				{
					main.handControl.righthandControl.setHandState(control_hand.eHandState.normal);
				}
			}
		}
		else
		{
			main.lobbyLefthandController.setHandState(isGrab: false);
			main.lobbyRighthandController.setHandState(isGrab: false);
		}
		MultiPhonePosEvent(0);
		captureState = eCaptureState.none;
		phoneState = eHandphoneState.none;
		camPivot.gameObject.SetActive(value: false);
		isReady = true;
		cam.enabled = false;
	}

	public void MultiPhonePosEvent(int number)
	{
		if (PhotonNetwork.IsConnected && PhotonNetwork.InRoom && MultiplayEventManager.Instance != null)
		{
			MultiplayEventManager.Instance.SendSmartphoneStatusEvent(number);
		}
	}

	public string GetScreentShotFolder()
	{
		return UnityEngine.Application.persistentDataPath.Replace("Android", "").Split(new string[1] { "//" }, StringSplitOptions.None)[0] + savePath;
	}

	public IEnumerator Shot(string path)
	{
		isReady = false;
		yield return new WaitForEndOfFrame();
		if (!Permission.HasUserAuthorizedPermission("android.permission.WRITE_EXTERNAL_STORAGE"))
		{
			Permission.HasUserAuthorizedPermission("android.permission.WRITE_EXTERNAL_STORAGE");
		}
		yield return new WaitForSeconds(0.2f);
		yield return new WaitUntil(() => UnityEngine.Application.isFocused);
		int width;
		int height;
		if (customResolution)
		{
			width = cWidth;
			height = cHeight;
		}
		else
		{
			width = Screen.width;
			height = Screen.height;
		}
		if ((bool)GameObject.FindGameObjectWithTag("WebView"))
		{
			tempGetwebView = GameObject.FindGameObjectWithTag("WebView");
			tempGetwebView.GetComponent<Renderer>().sharedMaterial.shader = cpatureShader;
		}
		RenderTexture renderTexture = new RenderTexture(width, height, 24);
		Texture2D screenShot = new Texture2D(width, height, TextureFormat.RGB24, mipChain: false);
		renderTexture.antiAliasing = 2;
		cam.targetTexture = renderTexture;
		cam.RenderDontRestore();
		cam.targetTexture = camRT;
		RenderTexture.active = renderTexture;
		screenShot.ReadPixels(new Rect(0f, 0f, width, height), 0, 0);
		RenderTexture.active = null;
		UnityEngine.Object.Destroy(renderTexture);
		if (tempGetwebView != null)
		{
			tempGetwebView.GetComponent<Renderer>().sharedMaterial.shader = stereoShader;
		}
		yield return 0;
		byte[] bytes = screenShot.EncodeToPNG();
		fullPath = path + "/" + fileName + DateTime.Now.ToString("yyyyMMddHHmmss") + ".png";
		File.WriteAllBytes(fullPath, bytes);
		AndroidJavaObject @static = new AndroidJavaClass("com.unity3d.player.UnityPlayer").GetStatic<AndroidJavaObject>("currentActivity");
		AndroidJavaClass androidJavaClass = new AndroidJavaClass("android.net.Uri");
		AndroidJavaObject androidJavaObject = new AndroidJavaObject("android.content.Intent", "android.intent.action.MEDIA_SCANNER_SCAN_FILE", androidJavaClass.CallStatic<AndroidJavaObject>("parse", new object[1] { "file://" + fullPath }));
		@static.Call("sendBroadcast", androidJavaObject);
		camSound.Play();
		yield return new WaitForSeconds(shotIdleTime);
		isReady = true;
	}
}
public class Singleton<T> : MonoBehaviour where T : MonoBehaviour
{
	private static T _instance;

	private static object _lock = new object();

	private static bool applicationIsQuitting = false;

	public static T Instance
	{
		get
		{
			if (applicationIsQuitting)
			{
				UnityEngine.Debug.LogWarning(string.Concat("[Singleton] Instance '", typeof(T), "' 프로그램을 종료 할 때 이미 파괴되었습니다. 다시 생성하지 않고 null을 반환합니다."));
				return null;
			}
			lock (_lock)
			{
				if (_instance == null)
				{
					_instance = (T)UnityEngine.Object.FindObjectOfType(typeof(T));
					if (UnityEngine.Object.FindObjectsOfType(typeof(T)).Length > 1)
					{
						UnityEngine.Debug.LogError(string.Concat(_instance, " Many Instances"));
						return _instance;
					}
				}
				return _instance;
			}
		}
	}

	public void OnApplicationQuit()
	{
		applicationIsQuitting = true;
	}
}
internal class MyWebClient : WebClient
{
	protected override WebRequest GetWebRequest(Uri address)
	{
		WebRequest webRequest = base.GetWebRequest(address);
		webRequest.Timeout = 1000;
		return webRequest;
	}
}
public enum INTERNETSTATUS
{
	NOT,
	DATA,
	WIFI
}
public static class StringExtension
{
	public static string RemoveSpecialCharacters(string str)
	{
		StringBuilder stringBuilder = new StringBuilder();
		foreach (char c in str)
		{
			if (c != '.')
			{
				stringBuilder.Append(c);
			}
		}
		return stringBuilder.ToString();
	}
}
public class Network
{
	public static bool IsInternetConnected()
	{
		try
		{
			if (new MyWebClient().DownloadString(Singleton<DBManager>.Instance.server) == null)
			{
				return false;
			}
		}
		catch (Exception)
		{
			return false;
		}
		return true;
	}

	public static bool CheckConnection(string ip, int port)
	{
		try
		{
			if (new MyWebClient().DownloadString(ip) != "success")
			{
				return false;
			}
		}
		catch (Exception)
		{
			return false;
		}
		return true;
	}

	public static string GetMacAddress()
	{
		IPGlobalProperties.GetIPGlobalProperties();
		NetworkInterface[] allNetworkInterfaces = NetworkInterface.GetAllNetworkInterfaces();
		string text = "";
		NetworkInterface[] array = allNetworkInterfaces;
		for (int i = 0; i < array.Length; i++)
		{
			byte[] addressBytes = array[i].GetPhysicalAddress().GetAddressBytes();
			string text2 = null;
			for (int j = 0; j < addressBytes.Length; j++)
			{
				text2 = string.Concat(text2 + string.Format("{0}", addressBytes[j].ToString("X2")));
				if (j != addressBytes.Length - 1)
				{
					text2 = string.Concat(text2 + "-");
				}
			}
			text = text + text2 + "\n";
			text += "\n";
		}
		return text;
	}

	public static string LocalIPAddress()
	{
		string result = "0.0.0.0";
		IPAddress[] addressList = Dns.GetHostEntry(Dns.GetHostName()).AddressList;
		foreach (IPAddress iPAddress in addressList)
		{
			if (iPAddress.AddressFamily == AddressFamily.InterNetwork)
			{
				result = iPAddress.ToString();
				break;
			}
		}
		return result;
	}
}
[Serializable]
public struct SerializableVector3
{
	public float x;

	public float y;

	public float z;

	public SerializableVector3(float x, float y, float z)
	{
		this.x = x;
		this.y = y;
		this.z = z;
	}

	public override string ToString()
	{
		return $"[{x}, {y}, {z}]";
	}

	public static implicit operator Vector3(SerializableVector3 value)
	{
		return new Vector3(value.x, value.y, value.z);
	}

	public static implicit operator SerializableVector3(Vector3 value)
	{
		return new SerializableVector3(value.x, value.y, value.z);
	}
}
internal class OculusWebView : MonoBehaviour
{
	[HideInInspector]
	public WebViewPrefab _webViewPrefab;

	public Transform webViewPos_temp;

	public float webView_width = 1.2f;

	public float webView_height = 0.8f;

	private void Awake()
	{
		UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
	}

	private void Start()
	{
		_webViewPrefab = WebViewPrefab.Instantiate(webView_width, webView_height);
		_webViewPrefab.transform.parent = base.transform;
		_webViewPrefab.transform.position = webViewPos_temp.position;
		_webViewPrefab.transform.localEulerAngles = new Vector3(0f, 180f, 0f);
		_webViewPrefab.Initialized += delegate
		{
			_webViewPrefab.WebView.LoadUrl("https://app.www.calm.com/homepage");
		};
	}

	private void Update()
	{
	}

	private void ResizeWebView()
	{
		UnityEngine.Debug.Log("WebView resize!!!");
		_webViewPrefab.WebView.Resize(webView_width / 3f, webView_height / 3f);
	}
}
public class TimeColorChange : MonoBehaviour
{
	public enum enumTimeState
	{
		night,
		dawn,
		day,
		sunset
	}

	public float timeSpeed = 2f;

	public float gameTime;

	private int timeState = 1;

	public enumTimeState tState;

	public Color[] colorEnvironment;

	public Color[] colorSun;

	public Color[] colorCloud;

	public Color[] colorSea;

	public Color[] colorFlare;

	private Material envMat;

	private Material cloudMat;

	private Material waterMat;

	private Material flareMat;

	public float timeInterval = 1f;

	public float timeStartDay = 5f;

	public float timeStartNight = 8f;

	public float timeSunShow = 6f;

	public float timeSunHide = 16f;

	public float flareSpeed = 2f;

	public Vector4 cloudScroll = Vector4.zero;

	public GameObject envObj;

	public GameObject water;

	public GameObject cloud;

	public GameObject sunObj;

	public GameObject flareObj;

	public Light sunLight;

	private Color curEnvColor;

	private Color curSunColor;

	private Color curCloudColor;

	private Color curSeaColor;

	public bool sunRised;

	public float cloudDistance = 1f;

	public float cloudSpeed = 1f;

	private Vector4 cloudShaderSpeed;

	private float lerpTime;

	private void Start()
	{
		envMat = envObj.GetComponent<Renderer>().material;
		cloudMat = cloud.GetComponent<Renderer>().material;
		waterMat = water.GetComponent<Renderer>().material;
		flareMat = flareObj.GetComponent<Renderer>().material;
		cloudShaderSpeed = cloudMat.GetVector("_Speed");
		init();
	}

	private void Update()
	{
		timeChange();
		setSunShader();
	}

	private void init()
	{
		if (gameTime > timeSunHide || gameTime < timeSunShow)
		{
			sunRised = false;
			flareMat.SetColor("_TintColor", colorFlare[0]);
			cloudMat.SetColor("_StarColor", colorFlare[1]);
		}
		else
		{
			sunRised = true;
			flareMat.SetColor("_TintColor", colorFlare[1]);
			cloudMat.SetColor("_StarColor", colorFlare[0]);
		}
		if (gameTime > timeStartDay && gameTime < 12f)
		{
			tState = enumTimeState.dawn;
		}
		if (gameTime > timeStartDay + timeInterval)
		{
			tState = enumTimeState.day;
		}
		if (gameTime > timeStartNight)
		{
			tState = enumTimeState.sunset;
		}
		if (gameTime > timeStartNight + timeInterval)
		{
			tState = enumTimeState.night;
		}
		curEnvColor = colorEnvironment[(int)tState];
		envMat.color = curEnvColor;
		cloudMat.SetColor("_CloudColor", colorCloud[(int)tState]);
		waterMat.SetColor("_Color", curEnvColor);
		waterMat.SetColor("_CubeColor", curEnvColor);
		waterMat.SetColor("_ShoreFormingColor", colorSea[(int)tState]);
		RenderSettings.ambientLight = curEnvColor;
		sunLight.color = colorSun[(int)tState];
		cloudMat.SetVector("_Speed", cloudScroll);
		sunObj.transform.eulerAngles = new Vector3(gameTime * 15f, 0f, 0f);
	}

	private void timeChange()
	{
		gameTime += Time.deltaTime * timeSpeed;
		if (gameTime > 24f)
		{
			gameTime = 0f;
		}
		if (gameTime < 0f)
		{
			gameTime = 24f;
		}
		sunObj.transform.eulerAngles = new Vector3(gameTime * 15f, 0f, 0f);
		cloudMat.SetVector("_Speed", cloudShaderSpeed * timeSpeed * cloudSpeed);
		if (gameTime > timeSunShow && gameTime <= timeSunShow + flareSpeed)
		{
			flareChange(On: true, (gameTime - timeSunShow) / flareSpeed);
		}
		else if (gameTime > timeSunShow + flareSpeed && gameTime <= timeSunHide)
		{
			flareChange(On: true, 1f);
		}
		else if (gameTime > timeSunHide && gameTime <= timeSunHide + flareSpeed)
		{
			flareChange(On: false, gameTime - timeSunHide / flareSpeed);
		}
		else
		{
			flareChange(On: false, 1f);
		}
		if (gameTime >= timeStartNight + timeInterval || gameTime < timeStartDay - timeInterval)
		{
			tState = enumTimeState.night;
			colorChange(0, 0, 0f);
		}
		else if (gameTime >= timeStartDay - timeInterval && gameTime < timeStartDay)
		{
			tState = enumTimeState.dawn;
			colorChange(0, 1, gameTime - (timeStartDay - timeInterval));
			starChange(On: false, gameTime - (timeStartDay - timeInterval));
		}
		else if (gameTime >= timeStartDay && gameTime < timeStartDay + timeInterval)
		{
			tState = enumTimeState.dawn;
			colorChange(1, 2, gameTime - timeStartDay);
		}
		else if (gameTime >= timeStartDay + timeInterval && gameTime < timeStartNight - timeInterval)
		{
			tState = enumTimeState.day;
			colorChange(2, 2, 0f);
		}
		else if (gameTime >= timeStartNight - timeInterval && gameTime < timeStartNight)
		{
			tState = enumTimeState.sunset;
			colorChange(2, 3, gameTime - (timeStartNight - timeInterval));
		}
		else if (gameTime >= timeStartNight && gameTime < timeStartNight + timeInterval)
		{
			tState = enumTimeState.sunset;
			colorChange(3, 0, gameTime - timeStartNight);
			starChange(On: true, gameTime - timeStartNight);
		}
	}

	private void colorChange(int startTime, int endTime, float sTime)
	{
		curEnvColor = Color.Lerp(colorEnvironment[startTime], colorEnvironment[endTime], sTime);
		sunLight.color = Color.Lerp(colorSun[startTime], colorSun[endTime], sTime);
		envMat.color = curEnvColor;
		cloudMat.SetColor("_CloudColor", Color.Lerp(colorCloud[startTime], colorCloud[endTime], sTime));
		waterMat.SetColor("_Color", curEnvColor);
		waterMat.SetColor("_CubeColor", curEnvColor);
		waterMat.SetColor("_ShoreFormingColor", Color.Lerp(colorSea[startTime], colorSea[endTime], sTime));
		RenderSettings.ambientLight = curEnvColor;
	}

	private void flareChange(bool On, float sTime)
	{
		if (sTime >= 0f && sTime <= 1f)
		{
			if (On)
			{
				flareMat.SetColor("_TintColor", Color.Lerp(colorFlare[0], colorFlare[1], sTime));
			}
			else
			{
				flareMat.SetColor("_TintColor", Color.Lerp(colorFlare[1], colorFlare[0], sTime));
			}
		}
	}

	private void starChange(bool On, float sTime)
	{
		if (On)
		{
			cloudMat.SetColor("_StarColor", Color.Lerp(colorFlare[0], colorFlare[1], sTime));
		}
		else
		{
			cloudMat.SetColor("_StarColor", Color.Lerp(colorFlare[1], colorFlare[0], sTime));
		}
	}

	private void setSunShader()
	{
		Vector2 vector = new Vector2(sunLight.transform.position.x, sunLight.transform.position.z) * 0.005f * cloudDistance;
		cloudMat.SetVector("_SunVector", vector);
	}
}
public class PlayPlayerSound : MonoBehaviour
{
	public float[] myVolume = new float[1] { 1f };

	public AudioClip[] myClips;

	public Vector3 camPos = new Vector3(3f, 6.5f, -3f);

	private void Start()
	{
	}

	private void Update()
	{
	}

	private void playAudio01()
	{
		AudioSource.PlayClipAtPoint(myClips[0], camPos, myVolume[0]);
	}

	private void playAudio02()
	{
		AudioSource.PlayClipAtPoint(myClips[1], camPos, myVolume[1]);
	}

	private void playAudio03()
	{
		AudioSource.PlayClipAtPoint(myClips[2], camPos, myVolume[2]);
	}

	private void playAudio04()
	{
		AudioSource.PlayClipAtPoint(myClips[3], camPos, myVolume[3]);
	}

	private void playAudio05()
	{
		AudioSource.PlayClipAtPoint(myClips[4], camPos, myVolume[4]);
	}

	private void playAudio06()
	{
		AudioSource.PlayClipAtPoint(myClips[5], camPos, myVolume[5]);
	}

	private void playAudio07()
	{
		AudioSource.PlayClipAtPoint(myClips[6], camPos, myVolume[6]);
	}

	private void playAudio08()
	{
		AudioSource.PlayClipAtPoint(myClips[7], camPos, myVolume[7]);
	}

	private void playAudio09()
	{
		AudioSource.PlayClipAtPoint(myClips[8], camPos, myVolume[8]);
	}

	private void playAudio10()
	{
		AudioSource.PlayClipAtPoint(myClips[9], camPos, myVolume[9]);
	}

	private void playAudio11()
	{
		AudioSource.PlayClipAtPoint(myClips[10], camPos, myVolume[10]);
	}

	private void playAudio12()
	{
		AudioSource.PlayClipAtPoint(myClips[11], camPos, myVolume[11]);
	}

	private void playAudio13()
	{
		AudioSource.PlayClipAtPoint(myClips[12], camPos, myVolume[12]);
	}

	private void playAudio14()
	{
		AudioSource.PlayClipAtPoint(myClips[13], camPos, myVolume[13]);
	}

	private void playAudio15()
	{
		AudioSource.PlayClipAtPoint(myClips[14], camPos, myVolume[14]);
	}

	private void playAudio16()
	{
		AudioSource.PlayClipAtPoint(myClips[15], camPos, myVolume[15]);
	}
}
public class RotateObject : MonoBehaviour
{
	public GameObject rotateObj;

	public Vector3 mySpeed;

	private void Update()
	{
		rotateObj.transform.Rotate(mySpeed);
	}
}
public class RandomMaterial : MonoBehaviour
{
	public Renderer targetRenderer;

	public Material[] materials;

	public void Start()
	{
		ChangeMaterial();
	}

	public void ChangeMaterial()
	{
		targetRenderer.sharedMaterial = materials[UnityEngine.Random.Range(0, materials.Length)];
	}
}
public class UnluckDistanceDisabler : MonoBehaviour
{
	public int _distanceDisable = 1000;

	public Transform _distanceFrom;

	public bool _distanceFromMainCam;

	public float _disableCheckInterval = 10f;

	public float _enableCheckInterval = 1f;

	public bool _disableOnStart;

	public void Start()
	{
		if (_distanceFromMainCam)
		{
			_distanceFrom = Camera.main.transform;
		}
		InvokeRepeating("CheckDisable", _disableCheckInterval + UnityEngine.Random.value * _disableCheckInterval, _disableCheckInterval);
		InvokeRepeating("CheckEnable", _enableCheckInterval + UnityEngine.Random.value * _enableCheckInterval, _enableCheckInterval);
		Invoke("DisableOnStart", 0.01f);
	}

	public void DisableOnStart()
	{
		if (_disableOnStart)
		{
			base.gameObject.SetActive(value: false);
		}
	}

	public void CheckDisable()
	{
		if (base.gameObject.activeInHierarchy && (base.transform.position - _distanceFrom.position).sqrMagnitude > (float)(_distanceDisable * _distanceDisable))
		{
			base.gameObject.SetActive(value: false);
		}
	}

	public void CheckEnable()
	{
		if (!base.gameObject.activeInHierarchy && (base.transform.position - _distanceFrom.position).sqrMagnitude < (float)(_distanceDisable * _distanceDisable))
		{
			base.gameObject.SetActive(value: true);
		}
	}
}
public class LookAtCamera : MonoBehaviour
{
	public Camera lookAtCamera;

	public bool lookOnlyOnAwake;

	public void Start()
	{
		if (lookAtCamera == null)
		{
			lookAtCamera = Camera.main;
		}
		if (lookOnlyOnAwake)
		{
			LookCam();
		}
	}

	public void Update()
	{
		if (!lookOnlyOnAwake)
		{
			LookCam();
		}
	}

	public void LookCam()
	{
		base.transform.LookAt(lookAtCamera.transform);
	}
}
[AddComponentMenu("Camera-Control/Smooth Mouse Orbit - Unluck Software")]
public class SmoothCameraOrbit : MonoBehaviour
{
	public Transform target;

	public Vector3 targetOffset;

	public float distance = 5f;

	public float maxDistance = 20f;

	public float minDistance = 0.6f;

	public float xSpeed = 200f;

	public float ySpeed = 200f;

	public int yMinLimit = -80;

	public int yMaxLimit = 80;

	public int zoomRate = 40;

	public float panSpeed = 0.3f;

	public float zoomDampening = 5f;

	public float autoRotate = 1f;

	public float autoRotateSpeed = 0.1f;

	private float xDeg;

	private float yDeg;

	private float currentDistance;

	private float desiredDistance;

	private Quaternion currentRotation;

	private Quaternion desiredRotation;

	private Quaternion rotation;

	private Vector3 position;

	private float idleTimer;

	private float idleSmooth;

	private void Start()
	{
		Init();
	}

	private void OnEnable()
	{
		Init();
	}

	public void Init()
	{
		if (!target)
		{
			GameObject gameObject = new GameObject("Cam Target");
			gameObject.transform.position = base.transform.position + base.transform.forward * distance;
			target = gameObject.transform;
		}
		currentDistance = distance;
		desiredDistance = distance;
		position = base.transform.position;
		rotation = base.transform.rotation;
		currentRotation = base.transform.rotation;
		desiredRotation = base.transform.rotation;
		xDeg = Vector3.Angle(Vector3.right, base.transform.right);
		yDeg = Vector3.Angle(Vector3.up, base.transform.up);
		position = target.position - (rotation * Vector3.forward * currentDistance + targetOffset);
	}

	private void LateUpdate()
	{
		if (Input.GetMouseButton(2) && Input.GetKey(KeyCode.LeftAlt) && Input.GetKey(KeyCode.LeftControl))
		{
			desiredDistance -= Input.GetAxis("Mouse Y") * 0.02f * (float)zoomRate * 0.125f * Mathf.Abs(desiredDistance);
		}
		else if (Input.GetMouseButton(0))
		{
			xDeg += Input.GetAxis("Mouse X") * xSpeed * 0.02f;
			yDeg -= Input.GetAxis("Mouse Y") * ySpeed * 0.02f;
			yDeg = ClampAngle(yDeg, yMinLimit, yMaxLimit);
			desiredRotation = Quaternion.Euler(yDeg, xDeg, 0f);
			currentRotation = base.transform.rotation;
			rotation = Quaternion.Lerp(currentRotation, desiredRotation, 0.02f * zoomDampening);
			base.transform.rotation = rotation;
			idleTimer = 0f;
			idleSmooth = 0f;
		}
		else
		{
			idleTimer += 0.02f;
			if (idleTimer > autoRotate && autoRotate > 0f)
			{
				idleSmooth += (0.02f + idleSmooth) * 0.005f;
				idleSmooth = Mathf.Clamp(idleSmooth, 0f, 1f);
				xDeg += xSpeed * Time.deltaTime * idleSmooth * autoRotateSpeed;
			}
			yDeg = ClampAngle(yDeg, yMinLimit, yMaxLimit);
			desiredRotation = Quaternion.Euler(yDeg, xDeg, 0f);
			currentRotation = base.transform.rotation;
			rotation = Quaternion.Lerp(currentRotation, desiredRotation, 0.02f * zoomDampening * 2f);
			base.transform.rotation = rotation;
		}
		desiredDistance -= Input.GetAxis("Mouse ScrollWheel") * 0.02f * (float)zoomRate * Mathf.Abs(desiredDistance);
		desiredDistance = Mathf.Clamp(desiredDistance, minDistance, maxDistance);
		currentDistance = Mathf.Lerp(currentDistance, desiredDistance, 0.02f * zoomDampening);
		position = target.position - (rotation * Vector3.forward * currentDistance + targetOffset);
		base.transform.position = position;
	}

	private static float ClampAngle(float angle, float min, float max)
	{
		if (angle < -360f)
		{
			angle += 360f;
		}
		if (angle > 360f)
		{
			angle -= 360f;
		}
		return Mathf.Clamp(angle, min, max);
	}
}
[RequireComponent(typeof(AudioSource))]
public class FlockChildSound : MonoBehaviour
{
	public AudioClip[] _idleSounds;

	public float _idleSoundRandomChance = 0.05f;

	public AudioClip[] _flightSounds;

	public float _flightSoundRandomChance = 0.05f;

	public AudioClip[] _scareSounds;

	public float _pitchMin = 0.85f;

	public float _pitchMax = 1f;

	public float _volumeMin = 0.6f;

	public float _volumeMax = 0.8f;

	private FlockChild _flockChild;

	private AudioSource _audio;

	private bool _hasLanded;

	public void Start()
	{
		_flockChild = GetComponent<FlockChild>();
		_audio = GetComponent<AudioSource>();
		InvokeRepeating("PlayRandomSound", UnityEngine.Random.value + 1f, 1f);
		if (_scareSounds.Length != 0)
		{
			InvokeRepeating("ScareSound", 1f, 0.01f);
		}
	}

	public void PlayRandomSound()
	{
		if (base.gameObject.activeInHierarchy)
		{
			if (!_audio.isPlaying && _flightSounds.Length != 0 && _flightSoundRandomChance > UnityEngine.Random.value && !_flockChild._landing)
			{
				_audio.clip = _flightSounds[UnityEngine.Random.Range(0, _flightSounds.Length)];
				_audio.pitch = UnityEngine.Random.Range(_pitchMin, _pitchMax);
				_audio.volume = UnityEngine.Random.Range(_volumeMin, _volumeMax);
				_audio.Play();
			}
			else if (!_audio.isPlaying && _idleSounds.Length != 0 && _idleSoundRandomChance > UnityEngine.Random.value && _flockChild._landing)
			{
				_audio.clip = _idleSounds[UnityEngine.Random.Range(0, _idleSounds.Length)];
				_audio.pitch = UnityEngine.Random.Range(_pitchMin, _pitchMax);
				_audio.volume = UnityEngine.Random.Range(_volumeMin, _volumeMax);
				_audio.Play();
				_hasLanded = true;
			}
		}
	}

	public void ScareSound()
	{
		if (base.gameObject.activeInHierarchy && _hasLanded && !_flockChild._landing && _idleSoundRandomChance * 2f > UnityEngine.Random.value)
		{
			_audio.clip = _scareSounds[UnityEngine.Random.Range(0, _scareSounds.Length)];
			_audio.volume = UnityEngine.Random.Range(_volumeMin, _volumeMax);
			_audio.PlayDelayed(UnityEngine.Random.value * 0.2f);
			_hasLanded = false;
		}
	}
}
public class FlockScare : MonoBehaviour
{
	public LandingSpotController[] landingSpotControllers;

	public float scareInterval = 0.1f;

	public float distanceToScare = 2f;

	public int checkEveryNthLandingSpot = 1;

	public int InvokeAmounts = 1;

	private int lsc;

	private int ls;

	private LandingSpotController currentController;

	private void CheckProximityToLandingSpots()
	{
		IterateLandingSpots();
		if (currentController._activeLandingSpots > 0 && CheckDistanceToLandingSpot(landingSpotControllers[lsc]))
		{
			landingSpotControllers[lsc].ScareAll();
		}
		Invoke("CheckProximityToLandingSpots", scareInterval);
	}

	private void IterateLandingSpots()
	{
		ls += checkEveryNthLandingSpot;
		currentController = landingSpotControllers[lsc];
		int childCount = currentController.transform.childCount;
		if (ls > childCount - 1)
		{
			ls -= childCount;
			if (lsc < landingSpotControllers.Length - 1)
			{
				lsc++;
			}
			else
			{
				lsc = 0;
			}
		}
	}

	private bool CheckDistanceToLandingSpot(LandingSpotController lc)
	{
		Transform child = lc.transform.GetChild(ls);
		if (child.GetComponent<LandingSpot>().landingChild != null && (child.position - base.transform.position).sqrMagnitude < distanceToScare * distanceToScare)
		{
			return true;
		}
		return false;
	}

	private void Invoker()
	{
		for (int i = 0; i < InvokeAmounts; i++)
		{
			float num = scareInterval / (float)InvokeAmounts * (float)i;
			Invoke("CheckProximityToLandingSpots", scareInterval + num);
		}
	}

	private void OnEnable()
	{
		CancelInvoke("CheckProximityToLandingSpots");
		if (landingSpotControllers.Length != 0)
		{
			Invoker();
		}
	}

	private void OnDisable()
	{
		CancelInvoke("CheckProximityToLandingSpots");
	}
}
public class FlockWaypointTrigger : MonoBehaviour
{
	public float _timer = 1f;

	public FlockChild _flockChild;

	public void Start()
	{
		if (_flockChild == null)
		{
			_flockChild = base.transform.parent.GetComponent<FlockChild>();
		}
		float num = UnityEngine.Random.Range(_timer, _timer * 3f);
		InvokeRepeating("Trigger", num, num);
	}

	public void Trigger()
	{
		_flockChild.Wander(0f);
	}
}
public class LandingButtons : MonoBehaviour
{
	public LandingSpotController _landingSpotController;

	public FlockController _flockController;

	public float hSliderValue = 250f;

	public void OnGUI()
	{
		GUI.Label(new Rect(20f, 20f, 125f, 18f), "Landing Spots: " + _landingSpotController.transform.childCount);
		if (GUI.Button(new Rect(20f, 40f, 125f, 18f), "Scare All"))
		{
			_landingSpotController.ScareAll();
		}
		if (GUI.Button(new Rect(20f, 60f, 125f, 18f), "Land In Reach"))
		{
			_landingSpotController.LandAll();
		}
		if (GUI.Button(new Rect(20f, 80f, 125f, 18f), "Land Instant"))
		{
			StartCoroutine(_landingSpotController.InstantLand(0.01f));
		}
		if (GUI.Button(new Rect(20f, 100f, 125f, 18f), "Destroy"))
		{
			_flockController.destroyBirds();
		}
		GUI.Label(new Rect(20f, 120f, 125f, 18f), "Bird Amount: " + _flockController._childAmount);
		_flockController._childAmount = (int)GUI.HorizontalSlider(new Rect(20f, 140f, 125f, 18f), _flockController._childAmount, 0f, 250f);
	}
}
public class LandingSpot : MonoBehaviour
{
	[HideInInspector]
	public FlockChild landingChild;

	[HideInInspector]
	public bool landing;

	private int lerpCounter;

	[HideInInspector]
	public LandingSpotController _controller;

	private bool _idle;

	public Transform _thisT;

	public bool _gotcha;

	public void Start()
	{
		if (_thisT == null)
		{
			_thisT = base.transform;
		}
		if (_controller == null)
		{
			_controller = _thisT.parent.GetComponent<LandingSpotController>();
		}
		if (_controller._autoCatchDelay.x > 0f)
		{
			StartCoroutine(GetFlockChild(_controller._autoCatchDelay.x, _controller._autoCatchDelay.y));
		}
	}

	public void OnDrawGizmos()
	{
		if (_thisT == null)
		{
			_thisT = base.transform;
		}
		if (_controller == null)
		{
			_controller = _thisT.parent.GetComponent<LandingSpotController>();
		}
		Gizmos.color = Color.yellow;
		if (landingChild != null && landing)
		{
			Gizmos.DrawLine(_thisT.position, landingChild._thisT.position);
		}
		if (_thisT.rotation.eulerAngles.x != 0f || _thisT.rotation.eulerAngles.z != 0f)
		{
			_thisT.eulerAngles = new Vector3(0f, _thisT.eulerAngles.y, 0f);
		}
		Gizmos.DrawCube(new Vector3(_thisT.position.x, _thisT.position.y, _thisT.position.z), Vector3.one * _controller._gizmoSize);
		Gizmos.DrawCube(_thisT.position + _thisT.forward * _controller._gizmoSize, Vector3.one * _controller._gizmoSize * 0.5f);
		Gizmos.color = new Color(1f, 1f, 0f, 0.05f);
		Gizmos.DrawWireSphere(_thisT.position, _controller._maxBirdDistance);
	}

	public void LateUpdate()
	{
		if (landingChild == null)
		{
			_gotcha = false;
			_idle = false;
			lerpCounter = 0;
			return;
		}
		if (_gotcha)
		{
			landingChild.transform.position = _thisT.position + landingChild._landingPosOffset;
			RotateBird();
			return;
		}
		if (_controller._flock.gameObject.activeInHierarchy && landing && landingChild != null)
		{
			if (!landingChild.gameObject.activeInHierarchy)
			{
				Invoke("ReleaseFlockChild", 0f);
			}
			float num = Vector3.Distance(landingChild._thisT.position, _thisT.position + landingChild._landingPosOffset);
			if (num < 5f && num > 0.5f)
			{
				if (_controller._soarLand)
				{
					landingChild._model.GetComponent<Animation>().CrossFade(landingChild._spawner._soarAnimation, 0.5f);
					if (num < 2f)
					{
						landingChild._model.GetComponent<Animation>().CrossFade(landingChild._spawner._flapAnimation, 0.5f);
					}
				}
				landingChild._targetSpeed = landingChild._spawner._maxSpeed * _controller._landingSpeedModifier;
				landingChild._wayPoint = _thisT.position + landingChild._landingPosOffset;
				landingChild._damping = _controller._landingTurnSpeedModifier;
				landingChild._avoid = false;
			}
			else if (num <= 0.5f)
			{
				landingChild._wayPoint = _thisT.position + landingChild._landingPosOffset;
				if (num < _controller._snapLandDistance && !_idle)
				{
					_idle = true;
					landingChild._model.GetComponent<Animation>().CrossFade(landingChild._spawner._idleAnimation, 0.55f);
				}
				if (num > _controller._snapLandDistance)
				{
					landingChild._targetSpeed = landingChild._spawner._minSpeed * _controller._landingSpeedModifier;
					landingChild._thisT.position += (_thisT.position + landingChild._landingPosOffset - landingChild._thisT.position) * Time.deltaTime * landingChild._speed * _controller._landingSpeedModifier * 2f;
				}
				else
				{
					_gotcha = true;
				}
				landingChild._move = false;
				RotateBird();
			}
			else
			{
				landingChild._wayPoint = _thisT.position + landingChild._landingPosOffset;
			}
			landingChild._damping += 0.01f;
		}
		StraightenBird();
	}

	public void StraightenBird()
	{
		if (landingChild._thisT.eulerAngles.x != 0f)
		{
			Vector3 eulerAngles = landingChild._thisT.eulerAngles;
			eulerAngles.z = 0f;
			landingChild._thisT.eulerAngles = eulerAngles;
		}
	}

	public void RotateBird()
	{
		if (!_controller._randomRotate || !_idle)
		{
			lerpCounter++;
			Quaternion rotation = landingChild._thisT.rotation;
			Vector3 eulerAngles = rotation.eulerAngles;
			eulerAngles.y = Mathf.LerpAngle(landingChild._thisT.rotation.eulerAngles.y, _thisT.rotation.eulerAngles.y, (float)lerpCounter * Time.deltaTime * _controller._landedRotateSpeed);
			rotation.eulerAngles = eulerAngles;
			landingChild._thisT.rotation = rotation;
		}
	}

	public IEnumerator GetFlockChild(float minDelay, float maxDelay)
	{
		yield return new WaitForSeconds(UnityEngine.Random.Range(minDelay, maxDelay));
		if (!_controller._flock.gameObject.activeInHierarchy || !(landingChild == null))
		{
			yield break;
		}
		FlockChild flockChild = null;
		for (int i = 0; i < _controller._flock._roamers.Count; i++)
		{
			FlockChild flockChild2 = _controller._flock._roamers[i];
			if (flockChild2._landing || flockChild2._dived)
			{
				continue;
			}
			if (!_controller._onlyBirdsAbove)
			{
				if (flockChild == null && _controller._maxBirdDistance > Vector3.Distance(flockChild2._thisT.position, _thisT.position) && _controller._minBirdDistance < Vector3.Distance(flockChild2._thisT.position, _thisT.position))
				{
					flockChild = flockChild2;
					if (!_controller._takeClosest)
					{
						break;
					}
				}
				else if (flockChild != null && Vector3.Distance(flockChild._thisT.position, _thisT.position) > Vector3.Distance(flockChild2._thisT.position, _thisT.position))
				{
					flockChild = flockChild2;
				}
			}
			else if (flockChild == null && flockChild2._thisT.position.y > _thisT.position.y && _controller._maxBirdDistance > Vector3.Distance(flockChild2._thisT.position, _thisT.position) && _controller._minBirdDistance < Vector3.Distance(flockChild2._thisT.position, _thisT.position))
			{
				flockChild = flockChild2;
				if (!_controller._takeClosest)
				{
					break;
				}
			}
			else if (flockChild != null && flockChild2._thisT.position.y > _thisT.position.y && Vector3.Distance(flockChild._thisT.position, _thisT.position) > Vector3.Distance(flockChild2._thisT.position, _thisT.position))
			{
				flockChild = flockChild2;
			}
		}
		if (flockChild != null)
		{
			landingChild = flockChild;
			landing = true;
			landingChild._landing = true;
			if (_controller._autoDismountDelay.x > 0f)
			{
				Invoke("ReleaseFlockChild", UnityEngine.Random.Range(_controller._autoDismountDelay.x, _controller._autoDismountDelay.y));
			}
			_controller._activeLandingSpots++;
		}
		else if (_controller._autoCatchDelay.x > 0f)
		{
			StartCoroutine(GetFlockChild(_controller._autoCatchDelay.x, _controller._autoCatchDelay.y));
		}
	}

	public void InstantLand()
	{
		if (!_controller._flock.gameObject.activeInHierarchy || !(landingChild == null))
		{
			return;
		}
		FlockChild flockChild = null;
		for (int i = 0; i < _controller._flock._roamers.Count; i++)
		{
			FlockChild flockChild2 = _controller._flock._roamers[i];
			if (!flockChild2._landing && !flockChild2._dived)
			{
				flockChild = flockChild2;
			}
		}
		if (flockChild != null)
		{
			landingChild = flockChild;
			landing = true;
			_controller._activeLandingSpots++;
			landingChild._landing = true;
			landingChild._thisT.position = _thisT.position + landingChild._landingPosOffset;
			landingChild._model.GetComponent<Animation>().Play(landingChild._spawner._idleAnimation);
			landingChild._thisT.Rotate(Vector3.up, UnityEngine.Random.Range(0f, 360f));
			if (_controller._autoDismountDelay.x > 0f)
			{
				Invoke("ReleaseFlockChild", UnityEngine.Random.Range(_controller._autoDismountDelay.x, _controller._autoDismountDelay.y));
			}
		}
		else if (_controller._autoCatchDelay.x > 0f)
		{
			StartCoroutine(GetFlockChild(_controller._autoCatchDelay.x, _controller._autoCatchDelay.y));
		}
	}

	public void ReleaseFlockChild()
	{
		if (_controller._flock.gameObject.activeInHierarchy && landingChild != null)
		{
			_gotcha = false;
			lerpCounter = 0;
			if (_controller._featherPS != null)
			{
				_controller._featherPS.position = landingChild._thisT.position;
				_controller._featherPS.GetComponent<ParticleSystem>().Emit(UnityEngine.Random.Range(0, 3));
			}
			landing = false;
			_idle = false;
			landingChild._avoid = true;
			landingChild._damping = landingChild._spawner._maxDamping;
			landingChild._model.GetComponent<Animation>().CrossFade(landingChild._spawner._flapAnimation, 0.2f);
			landingChild._dived = true;
			landingChild._speed = 0f;
			landingChild._move = true;
			landingChild._landing = false;
			landingChild.Flap();
			landingChild._wayPoint = new Vector3(landingChild._wayPoint.x, _thisT.position.y + 10f, landingChild._wayPoint.z);
			if (_controller._autoCatchDelay.x > 0f)
			{
				StartCoroutine(GetFlockChild(_controller._autoCatchDelay.x + 0.1f, _controller._autoCatchDelay.y + 0.1f));
			}
			landingChild = null;
			_controller._activeLandingSpots--;
		}
	}
}
public class LandingSpotController : MonoBehaviour
{
	public bool _randomRotate = true;

	public Vector2 _autoCatchDelay = new Vector2(10f, 20f);

	public Vector2 _autoDismountDelay = new Vector2(10f, 20f);

	public float _maxBirdDistance = 20f;

	public float _minBirdDistance = 5f;

	public bool _takeClosest;

	public FlockController _flock;

	public bool _landOnStart;

	public bool _soarLand = true;

	public bool _onlyBirdsAbove;

	public float _landingSpeedModifier = 0.5f;

	public float _landingTurnSpeedModifier = 5f;

	public Transform _featherPS;

	public Transform _thisT;

	public int _activeLandingSpots;

	public float _snapLandDistance = 0.1f;

	public float _landedRotateSpeed = 0.01f;

	public float _gizmoSize = 0.2f;

	public void Start()
	{
		if (_thisT == null)
		{
			_thisT = base.transform;
		}
		if (_flock == null)
		{
			_flock = (FlockController)UnityEngine.Object.FindObjectOfType(typeof(FlockController));
			UnityEngine.Debug.Log(string.Concat(this, " has no assigned FlockController, a random FlockController has been assigned"));
		}
		if (_landOnStart)
		{
			StartCoroutine(InstantLandOnStart(0.1f));
		}
	}

	public void ScareAll()
	{
		ScareAll(0f, 1f);
	}

	public void ScareAll(float minDelay, float maxDelay)
	{
		for (int i = 0; i < _thisT.childCount; i++)
		{
			if (_thisT.GetChild(i).GetComponent<LandingSpot>() != null)
			{
				_thisT.GetChild(i).GetComponent<LandingSpot>().Invoke("ReleaseFlockChild", UnityEngine.Random.Range(minDelay, maxDelay));
			}
		}
	}

	public void LandAll()
	{
		for (int i = 0; i < _thisT.childCount; i++)
		{
			if (_thisT.GetChild(i).GetComponent<LandingSpot>() != null)
			{
				LandingSpot component = _thisT.GetChild(i).GetComponent<LandingSpot>();
				StartCoroutine(component.GetFlockChild(0f, 2f));
			}
		}
	}

	public IEnumerator InstantLandOnStart(float delay)
	{
		yield return new WaitForSeconds(delay);
		for (int i = 0; i < _thisT.childCount; i++)
		{
			if (_thisT.GetChild(i).GetComponent<LandingSpot>() != null)
			{
				_thisT.GetChild(i).GetComponent<LandingSpot>().InstantLand();
			}
		}
	}

	public IEnumerator InstantLand(float delay)
	{
		yield return new WaitForSeconds(delay);
		for (int i = 0; i < _thisT.childCount; i++)
		{
			if (_thisT.GetChild(i).GetComponent<LandingSpot>() != null)
			{
				_thisT.GetChild(i).GetComponent<LandingSpot>().InstantLand();
			}
		}
	}
}
public class fxController : MonoBehaviour
{
	public int idType;

	public int idColor;

	public int idAnim;

	public int idPoint;

	public int idCircle;

	public int idBox;

	public int idArea;

	public Text prefabNameTxt;

	public GameObject[] pointObjs;

	public GameObject[] circleObjs;

	public GameObject[] boxObjs;

	public GameObject[] areaObjs;

	public GameObject[] DesFxObjs;

	private void Start()
	{
		SetupFx();
	}

	public void TypesChanged(int i)
	{
		idType = i;
		SetupFx();
	}

	public void AnimsChanged(int i)
	{
		idAnim = i;
		SetupFx();
	}

	public void ColorsChanged(int i)
	{
		idColor = i;
		SetupFx();
	}

	public void SetupFx()
	{
		DesFxObjs = GameObject.FindGameObjectsWithTag("Effects");
		GameObject[] desFxObjs = DesFxObjs;
		for (int i = 0; i < desFxObjs.Length; i++)
		{
			UnityEngine.Object.Destroy(desFxObjs[i].gameObject);
		}
		switch (idType)
		{
		case 0:
			PointPrefabs();
			break;
		case 1:
			CirclePrefabs();
			break;
		case 2:
			BoxPrefabs();
			break;
		case 3:
			AreaPrefabs();
			break;
		}
	}

	public void PointPrefabs()
	{
		switch (idAnim)
		{
		case 0:
			switch (idColor)
			{
			case 0:
				idPoint = 0;
				break;
			case 1:
				idPoint = 1;
				break;
			case 2:
				idPoint = 2;
				break;
			case 3:
				idPoint = 3;
				break;
			case 4:
				idPoint = 4;
				break;
			}
			break;
		case 1:
			switch (idColor)
			{
			case 0:
				idPoint = 5;
				break;
			case 1:
				idPoint = 6;
				break;
			case 2:
				idPoint = 7;
				break;
			case 3:
				idPoint = 8;
				break;
			case 4:
				idPoint = 9;
				break;
			}
			break;
		case 2:
			switch (idColor)
			{
			case 0:
				idPoint = 10;
				break;
			case 1:
				idPoint = 11;
				break;
			case 2:
				idPoint = 12;
				break;
			case 3:
				idPoint = 13;
				break;
			case 4:
				idPoint = 14;
				break;
			}
			break;
		case 3:
			switch (idColor)
			{
			case 0:
				idPoint = 15;
				break;
			case 1:
				idPoint = 16;
				break;
			case 2:
				idPoint = 17;
				break;
			case 3:
				idPoint = 18;
				break;
			case 4:
				idPoint = 19;
				break;
			}
			break;
		}
		UnityEngine.Object.Instantiate(pointObjs[idPoint]);
		prefabNameTxt.text = "File name : " + pointObjs[idPoint].gameObject.name;
	}

	public void CirclePrefabs()
	{
		switch (idAnim)
		{
		case 0:
			switch (idColor)
			{
			case 0:
				idCircle = 0;
				break;
			case 1:
				idCircle = 1;
				break;
			case 2:
				idCircle = 2;
				break;
			case 3:
				idCircle = 3;
				break;
			case 4:
				idCircle = 4;
				break;
			}
			break;
		case 1:
			switch (idColor)
			{
			case 0:
				idCircle = 5;
				break;
			case 1:
				idCircle = 6;
				break;
			case 2:
				idCircle = 7;
				break;
			case 3:
				idCircle = 8;
				break;
			case 4:
				idCircle = 9;
				break;
			}
			break;
		case 2:
			switch (idColor)
			{
			case 0:
				idCircle = 10;
				break;
			case 1:
				idCircle = 11;
				break;
			case 2:
				idCircle = 12;
				break;
			case 3:
				idCircle = 13;
				break;
			case 4:
				idCircle = 14;
				break;
			}
			break;
		case 3:
			switch (idColor)
			{
			case 0:
				idCircle = 15;
				break;
			case 1:
				idCircle = 16;
				break;
			case 2:
				idCircle = 17;
				break;
			case 3:
				idCircle = 18;
				break;
			case 4:
				idCircle = 19;
				break;
			}
			break;
		}
		UnityEngine.Object.Instantiate(circleObjs[idCircle]);
		prefabNameTxt.text = "File name : " + circleObjs[idCircle].gameObject.name;
	}

	public void BoxPrefabs()
	{
		switch (idAnim)
		{
		case 0:
			switch (idColor)
			{
			case 0:
				idBox = 0;
				break;
			case 1:
				idBox = 1;
				break;
			case 2:
				idBox = 2;
				break;
			case 3:
				idBox = 3;
				break;
			case 4:
				idBox = 4;
				break;
			}
			break;
		case 1:
			switch (idColor)
			{
			case 0:
				idBox = 5;
				break;
			case 1:
				idBox = 6;
				break;
			case 2:
				idBox = 7;
				break;
			case 3:
				idBox = 8;
				break;
			case 4:
				idBox = 9;
				break;
			}
			break;
		case 2:
			switch (idColor)
			{
			case 0:
				idBox = 10;
				break;
			case 1:
				idBox = 11;
				break;
			case 2:
				idBox = 12;
				break;
			case 3:
				idBox = 13;
				break;
			case 4:
				idBox = 14;
				break;
			}
			break;
		case 3:
			switch (idColor)
			{
			case 0:
				idBox = 15;
				break;
			case 1:
				idBox = 16;
				break;
			case 2:
				idBox = 17;
				break;
			case 3:
				idBox = 18;
				break;
			case 4:
				idBox = 19;
				break;
			}
			break;
		}
		UnityEngine.Object.Instantiate(boxObjs[idBox]);
		prefabNameTxt.text = "File name : " + boxObjs[idBox].gameObject.name;
	}

	public void AreaPrefabs()
	{
		switch (idAnim)
		{
		case 0:
			switch (idColor)
			{
			case 0:
				idArea = 0;
				break;
			case 1:
				idArea = 1;
				break;
			case 2:
				idArea = 2;
				break;
			case 3:
				idArea = 3;
				break;
			case 4:
				idArea = 4;
				break;
			}
			break;
		case 1:
			switch (idColor)
			{
			case 0:
				idArea = 5;
				break;
			case 1:
				idArea = 6;
				break;
			case 2:
				idArea = 7;
				break;
			case 3:
				idArea = 8;
				break;
			case 4:
				idArea = 9;
				break;
			}
			break;
		case 2:
			switch (idColor)
			{
			case 0:
				idArea = 10;
				break;
			case 1:
				idArea = 11;
				break;
			case 2:
				idArea = 12;
				break;
			case 3:
				idArea = 13;
				break;
			case 4:
				idArea = 14;
				break;
			}
			break;
		case 3:
			switch (idColor)
			{
			case 0:
				idArea = 15;
				break;
			case 1:
				idArea = 16;
				break;
			case 2:
				idArea = 17;
				break;
			case 3:
				idArea = 18;
				break;
			case 4:
				idArea = 19;
				break;
			}
			break;
		}
		UnityEngine.Object.Instantiate(areaObjs[idArea]);
		prefabNameTxt.text = "File name : " + areaObjs[idArea].gameObject.name;
	}
}
public class ManualScripts : MonoBehaviour
{
	public GameObject[] PageObj;

	public int currentPage;

	public int minPage = 1;

	public int maxPage = 5;

	public Text txtPage;

	private void Start()
	{
		for (int i = 0; i <= maxPage; i++)
		{
			PageObj[i].SetActive(value: false);
		}
		PageObj[minPage].SetActive(value: true);
		currentPage = minPage;
		txtPage.text = "PAGE " + currentPage + " / " + maxPage;
	}

	public void ChangedPage(int i)
	{
		currentPage = Mathf.Clamp(currentPage + i, minPage, maxPage);
		for (int j = 0; j <= maxPage; j++)
		{
			PageObj[j].SetActive(value: false);
		}
		PageObj[currentPage].SetActive(value: true);
		txtPage.text = "PAGE " + currentPage + " / " + maxPage;
	}
}
public class rotateCamera : MonoBehaviour
{
	public float turnSpeed = 10f;

	private void Update()
	{
		base.transform.Rotate(Vector3.up, (0f - turnSpeed) * Time.deltaTime);
	}
}
public class GameObjectSpawner : MonoBehaviour
{
	public GameObject[] particles;

	public Material[] materials;

	public Color[] cameraColors;

	public int maxButtons = 10;

	public bool spawnOnAwake = true;

	public bool showInfo;

	public string removeTextFromButton;

	public string removeTextFromMaterialButton;

	public float autoChangeDelay;

	public GUITexture image;

	private int page;

	private int pages;

	private string currentGOInfo;

	private GameObject currentGO;

	private Color currentColor;

	private bool isPS;

	private Material material;

	private bool _active = true;

	private int counter = -1;

	private int matCounter = -1;

	private int colorCounter;

	public GUIStyle bigStyle;

	public void Start()
	{
		pages = (int)Mathf.Ceil((particles.Length - 1) / maxButtons);
		if (spawnOnAwake)
		{
			counter = 0;
			ReplaceGO(particles[counter]);
			Info(particles[counter], counter);
		}
		if (autoChangeDelay > 0f)
		{
			InvokeRepeating("NextModel", autoChangeDelay, autoChangeDelay);
		}
	}

	public void Update()
	{
		if (Input.GetKeyDown(KeyCode.Space))
		{
			if (_active)
			{
				_active = false;
				if (image != null)
				{
					image.enabled = false;
				}
			}
			else
			{
				_active = true;
				if (image != null)
				{
					image.enabled = true;
				}
			}
		}
		if (Input.GetKeyDown(KeyCode.RightArrow))
		{
			NextModel();
		}
		if (Input.GetKeyDown(KeyCode.LeftArrow))
		{
			counter--;
			if (counter < 0)
			{
				counter = particles.Length - 1;
			}
			ReplaceGO(particles[counter]);
			Info(particles[counter], counter + 1);
		}
		if (Input.GetKeyDown(KeyCode.UpArrow) && materials.Length != 0)
		{
			matCounter++;
			if (matCounter > materials.Length - 1)
			{
				matCounter = 0;
			}
			material = materials[matCounter];
			if (currentGO != null)
			{
				currentGO.GetComponent<Renderer>().sharedMaterial = material;
			}
		}
		if (Input.GetKeyDown(KeyCode.DownArrow) && materials.Length != 0)
		{
			matCounter--;
			if (matCounter < 0)
			{
				matCounter = materials.Length - 1;
			}
			material = materials[matCounter];
			if (currentGO != null)
			{
				currentGO.GetComponent<Renderer>().sharedMaterial = material;
			}
		}
		if (Input.GetKeyDown(KeyCode.B))
		{
			colorCounter++;
			if (colorCounter > cameraColors.Length - 1)
			{
				colorCounter = 0;
			}
		}
		Camera.main.backgroundColor = Color.Lerp(Camera.main.backgroundColor, cameraColors[colorCounter], Time.deltaTime * 3f);
	}

	public void NextModel()
	{
		counter++;
		if (counter > particles.Length - 1)
		{
			counter = 0;
		}
		ReplaceGO(particles[counter]);
		Info(particles[counter], counter + 1);
	}

	public void OnGUI()
	{
		if (showInfo)
		{
			GUI.Label(new Rect((float)Screen.width * 0.5f - 250f, 20f, 500f, 500f), currentGOInfo, bigStyle);
		}
		if (_active)
		{
			if (particles.Length > maxButtons)
			{
				if (GUI.Button(new Rect(20f, (maxButtons + 1) * 18, 75f, 18f), "Prev"))
				{
					if (page > 0)
					{
						page--;
					}
					else
					{
						page = pages;
					}
				}
				if (GUI.Button(new Rect(95f, (maxButtons + 1) * 18, 75f, 18f), "Next"))
				{
					if (page < pages)
					{
						page++;
					}
					else
					{
						page = 0;
					}
				}
				GUI.Label(new Rect(60f, (maxButtons + 2) * 18, 150f, 22f), "Page" + (page + 1) + " / " + (pages + 1));
			}
			showInfo = GUI.Toggle(new Rect(185f, 20f, 75f, 25f), showInfo, "Info");
			int num = particles.Length - page * maxButtons;
			if (num > maxButtons)
			{
				num = maxButtons;
			}
			for (int i = 0; i < num; i++)
			{
				string text = particles[i + page * maxButtons].transform.name;
				if (removeTextFromButton != "")
				{
					text = text.Replace(removeTextFromButton, "");
				}
				if (GUI.Button(new Rect(20f, i * 18 + 18, 150f, 18f), text))
				{
					if (currentGO != null)
					{
						UnityEngine.Object.Destroy(currentGO);
					}
					GameObject gameObject = (currentGO = UnityEngine.Object.Instantiate(particles[i + page * maxButtons]));
					counter = i + page * maxButtons;
					if (material != null)
					{
						gameObject.GetComponent<Renderer>().sharedMaterial = material;
					}
					Info(gameObject, i + page * maxButtons + 1);
				}
			}
			for (int j = 0; j < materials.Length; j++)
			{
				string text2 = materials[j].name;
				if (removeTextFromMaterialButton != "")
				{
					text2 = text2.Replace(removeTextFromMaterialButton, "");
				}
				if (GUI.Button(new Rect(20f, (maxButtons + j + 4) * 18, 150f, 18f), text2))
				{
					material = materials[j];
					if (currentGO != null)
					{
						currentGO.GetComponent<Renderer>().sharedMaterial = material;
					}
				}
			}
		}
		if (image != null)
		{
			Rect pixelInset = image.pixelInset;
			pixelInset.x = Screen.width - image.texture.width;
			image.pixelInset = pixelInset;
		}
	}

	public void Info(GameObject go, int i)
	{
		if (go.GetComponent<ParticleSystem>() != null)
		{
			PlayPS(go.GetComponent<ParticleSystem>(), i);
			InfoPS(go.GetComponent<ParticleSystem>(), i);
		}
		else
		{
			InfoGO(go, i);
		}
	}

	public void ReplaceGO(GameObject _go)
	{
		if (currentGO != null)
		{
			UnityEngine.Object.Destroy(currentGO);
		}
		GameObject gameObject = (currentGO = UnityEngine.Object.Instantiate(_go));
		if (material != null)
		{
			gameObject.GetComponent<Renderer>().sharedMaterial = material;
		}
	}

	public void PlayPS(ParticleSystem _ps, int _nr)
	{
		Time.timeScale = 1f;
		_ps.Play();
	}

	public void InfoGO(GameObject _ps, int _nr)
	{
		currentGOInfo = _nr + "/" + particles.Length + "\n" + _ps.gameObject.name + "\n" + _ps.GetComponent<MeshFilter>().sharedMesh.triangles.Length / 3 + " Tris";
		currentGOInfo = currentGOInfo.Replace("_", " ");
	}

	public void Instructions()
	{
		currentGOInfo += "\n\nUse mouse wheel to zoom \nClick and hold to rotate\nPress Space to show or hide menu\nPress Up and Down arrows to cycle materials\nPress B to cycle background colors";
		currentGOInfo = currentGOInfo.Replace("(Clone)", "");
	}

	public void InfoPS(ParticleSystem _ps, int _nr)
	{
		currentGOInfo = "System: " + _nr + "/" + particles.Length + "\n" + _ps.gameObject.name + "\n\n";
		currentGOInfo = currentGOInfo.Replace("_", " ");
		currentGOInfo = currentGOInfo.Replace("(Clone)", "");
	}
}
public class ParticleSystemSound : MonoBehaviour
{
	public AudioClip[] _shootSound;

	public float _shootPitchMax = 1.25f;

	public float _shootPitchMin = 0.75f;

	public float _shootVolumeMax = 0.75f;

	public float _shootVolumeMin = 0.25f;

	public AudioClip[] _explosionSound;

	public float _explosionPitchMax = 1.25f;

	public float _explosionPitchMin = 0.75f;

	public float _explosionVolumeMax = 0.75f;

	public float _explosionVolumeMin = 0.25f;

	public AudioClip[] _crackleSound;

	public float _crackleDelay = 0.25f;

	public int _crackleMultiplier = 3;

	public float _cracklePitchMax = 1.25f;

	public float _cracklePitchMin = 0.75f;

	public float _crackleVolumeMax = 0.75f;

	public float _crackleVolumeMin = 0.25f;

	public void LateUpdate()
	{
		ParticleSystem.Particle[] array = new ParticleSystem.Particle[GetComponent<ParticleSystem>().particleCount];
		int particles = GetComponent<ParticleSystem>().GetParticles(array);
		for (int i = 0; i < particles; i++)
		{
			if (_explosionSound.Length != 0 && array[i].remainingLifetime < Time.deltaTime)
			{
				SoundController.instance.Play(_explosionSound[UnityEngine.Random.Range(0, _explosionSound.Length)], UnityEngine.Random.Range(_explosionVolumeMax, _explosionVolumeMin), UnityEngine.Random.Range(_explosionPitchMin, _explosionPitchMax), array[i].position);
				if (_crackleSound.Length != 0)
				{
					for (int j = 0; j < _crackleMultiplier; j++)
					{
						StartCoroutine(Crackle(array[i].position, _crackleDelay + (float)j * 0.1f));
					}
				}
			}
			if (_shootSound.Length != 0 && array[i].remainingLifetime >= array[i].startLifetime - Time.deltaTime)
			{
				SoundController.instance.Play(_shootSound[UnityEngine.Random.Range(0, _shootSound.Length)], UnityEngine.Random.Range(_shootVolumeMax, _shootVolumeMin), UnityEngine.Random.Range(_shootPitchMin, _shootPitchMax), array[i].position);
			}
		}
	}

	public IEnumerator Crackle(Vector3 pos, float delay)
	{
		yield return new WaitForSeconds(delay);
		SoundController.instance.Play(_crackleSound[UnityEngine.Random.Range(0, _crackleSound.Length)], UnityEngine.Random.Range(_crackleVolumeMax, _crackleVolumeMin), UnityEngine.Random.Range(_cracklePitchMax, _cracklePitchMin), pos);
	}
}
public class SoundController : MonoBehaviour
{
	public AudioClip[] _audioClips;

	public int _audioChannels = 10;

	public float _masterVol = 0.5f;

	public float _soundVol = 1f;

	public bool _linearRollOff;

	public AudioSource[] channels;

	public int channel;

	public static SoundController instance;

	public void OnApplicationQuit()
	{
		instance = null;
	}

	public void Start()
	{
		if (instance != null)
		{
			UnityEngine.Object.Destroy(base.gameObject);
		}
		else
		{
			instance = this;
			UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
		}
		AddChannels();
		UnityEngine.Object.DontDestroyOnLoad(base.transform.gameObject);
	}

	public void AddChannels()
	{
		channels = new AudioSource[_audioChannels];
		if (channels.Length > _audioChannels)
		{
			return;
		}
		for (int i = 0; i < _audioChannels; i++)
		{
			GameObject gameObject = new GameObject();
			gameObject.AddComponent<AudioSource>();
			gameObject.name = "AudioChannel " + i;
			gameObject.transform.parent = base.transform;
			channels[i] = gameObject.GetComponent<AudioSource>();
			if (_linearRollOff)
			{
				channels[i].rolloffMode = AudioRolloffMode.Linear;
			}
		}
	}

	public void Play(int audioClipIndex, float volume, float pitch)
	{
		if (channel < channels.Length - 1)
		{
			channel++;
		}
		else
		{
			channel = 0;
		}
		if (audioClipIndex < _audioClips.Length)
		{
			channels[channel].clip = _audioClips[audioClipIndex];
			channels[channel].GetComponent<AudioSource>().volume = volume * _masterVol * _soundVol;
			channels[channel].GetComponent<AudioSource>().pitch = pitch;
			channels[channel].GetComponent<AudioSource>().Play();
		}
	}

	public void Play(AudioClip clip, float volume, float pitch, Vector3 position)
	{
		if (channel < channels.Length - 1)
		{
			channel++;
		}
		else
		{
			channel = 0;
		}
		channels[channel].clip = clip;
		channels[channel].GetComponent<AudioSource>().volume = volume * _masterVol * _soundVol;
		channels[channel].GetComponent<AudioSource>().pitch = pitch;
		channels[channel].transform.position = position;
		channels[channel].GetComponent<AudioSource>().Play();
	}

	public void Play(AudioClip clip, float volume, float pitch)
	{
		if (channel < channels.Length - 1)
		{
			channel++;
		}
		else
		{
			channel = 0;
		}
		channels[channel].clip = clip;
		channels[channel].GetComponent<AudioSource>().volume = volume * _masterVol * _soundVol;
		channels[channel].GetComponent<AudioSource>().pitch = pitch;
		channels[channel].GetComponent<AudioSource>().Play();
	}

	public void StopAll()
	{
		for (int i = 0; i < channels.Length; i++)
		{
			channels[i].Stop();
		}
	}
}
public class Blinker : MonoBehaviour
{
	public Color highlightColor;

	private Renderer rend;

	private Color original;

	private void Awake()
	{
		rend = GetComponent<Renderer>();
		original = rend.material.color;
	}

	public void Blink()
	{
		rend.material.color = highlightColor;
	}

	private void LateUpdate()
	{
		rend.material.color += (original - rend.material.color) * Time.deltaTime * 5f;
	}
}
public class CharacterControl2D : MonoBehaviour
{
	public float acceleration = 10f;

	public float maxSpeed = 8f;

	public float jumpPower = 2f;

	private Rigidbody unityRigidbody;

	public void Awake()
	{
		unityRigidbody = GetComponent<Rigidbody>();
	}

	private void FixedUpdate()
	{
		unityRigidbody.AddForce(new Vector3(Input.GetAxis("Horizontal") * acceleration, 0f, 0f));
		unityRigidbody.velocity = Vector3.ClampMagnitude(unityRigidbody.velocity, maxSpeed);
		if (Input.GetButtonDown("Jump"))
		{
			unityRigidbody.AddForce(Vector3.up * jumpPower, ForceMode.VelocityChange);
		}
	}
}
[RequireComponent(typeof(ObiSolver))]
public class ColliderHighlighter : MonoBehaviour
{
	private ObiSolver solver;

	private void Awake()
	{
		solver = GetComponent<ObiSolver>();
	}

	private void OnEnable()
	{
		solver.OnCollision += Solver_OnCollision;
	}

	private void OnDisable()
	{
		solver.OnCollision -= Solver_OnCollision;
	}

	private void Solver_OnCollision(object sender, ObiSolver.ObiCollisionEventArgs e)
	{
		Oni.Contact[] data = e.contacts.Data;
		for (int i = 0; i < e.contacts.Count; i++)
		{
			Oni.Contact contact = data[i];
			if (!(contact.distance < 0.01f))
			{
				continue;
			}
			Collider collider = ObiColliderBase.idToCollider[contact.other] as Collider;
			if (collider != null)
			{
				Blinker component = collider.GetComponent<Blinker>();
				if ((bool)component)
				{
					component.Blink();
				}
			}
		}
	}
}
[RequireComponent(typeof(ObiSolver))]
public class CollisionEventHandler : MonoBehaviour
{
	private ObiSolver solver;

	private ObiSolver.ObiCollisionEventArgs frame;

	private void Awake()
	{
		solver = GetComponent<ObiSolver>();
	}

	private void OnEnable()
	{
		solver.OnCollision += Solver_OnCollision;
	}

	private void OnDisable()
	{
		solver.OnCollision -= Solver_OnCollision;
	}

	private void Solver_OnCollision(object sender, ObiSolver.ObiCollisionEventArgs e)
	{
		frame = e;
	}

	private void OnDrawGizmos()
	{
		if (!(solver == null) && frame != null && frame.contacts != null)
		{
			for (int i = 0; i < frame.contacts.Count; i++)
			{
				Gizmos.color = ((frame.contacts.Data[i].distance < 0.01f) ? Color.red : Color.green);
				Vector3 vector = frame.contacts.Data[i].point;
				Vector3 vector2 = frame.contacts.Data[i].normal;
				Gizmos.DrawSphere(vector, 0.025f);
				Gizmos.DrawRay(vector, vector2.normalized * 0.1f);
			}
		}
	}
}
public class CraneController : MonoBehaviour
{
	private ObiRopeCursor cursor;

	private ObiRope rope;

	private void Start()
	{
		cursor = GetComponentInChildren<ObiRopeCursor>();
		rope = cursor.GetComponent<ObiRope>();
	}

	private void Update()
	{
		if (Input.GetKey(KeyCode.W) && rope.RestLength > 6.5f)
		{
			cursor.ChangeLength(rope.RestLength - 1f * Time.deltaTime);
		}
		if (Input.GetKey(KeyCode.S))
		{
			cursor.ChangeLength(rope.RestLength + 1f * Time.deltaTime);
		}
		if (Input.GetKey(KeyCode.A))
		{
			base.transform.Rotate(0f, Time.deltaTime * 15f, 0f);
		}
		if (Input.GetKey(KeyCode.D))
		{
			base.transform.Rotate(0f, (0f - Time.deltaTime) * 15f, 0f);
		}
	}
}
public class CursorController : MonoBehaviour
{
	private ObiRopeCursor cursor;

	private ObiRope rope;

	public float minLength = 0.1f;

	private void Start()
	{
		cursor = GetComponentInChildren<ObiRopeCursor>();
		rope = cursor.GetComponent<ObiRope>();
	}

	private void Update()
	{
		if (Input.GetKey(KeyCode.W) && rope.RestLength > minLength)
		{
			cursor.ChangeLength(rope.RestLength - 1f * Time.deltaTime);
		}
		if (Input.GetKey(KeyCode.S))
		{
			cursor.ChangeLength(rope.RestLength + 1f * Time.deltaTime);
		}
		if (Input.GetKey(KeyCode.A))
		{
			rope.transform.Translate(Vector3.left * Time.deltaTime, Space.World);
		}
		if (Input.GetKey(KeyCode.D))
		{
			rope.transform.Translate(Vector3.right * Time.deltaTime, Space.World);
		}
	}
}
public class FirstPersonLauncher : MonoBehaviour
{
	public GameObject prefab;

	public float power = 2f;

	private void Update()
	{
		if (Input.GetMouseButtonDown(0))
		{
			Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition);
			Rigidbody component = UnityEngine.Object.Instantiate(prefab, ray.origin, Quaternion.identity).GetComponent<Rigidbody>();
			if (component != null)
			{
				component.velocity = ray.direction * power;
			}
		}
	}
}
public class GrapplingHook : MonoBehaviour
{
	public ObiCollider character;

	public float hookExtendRetractSpeed = 2f;

	public Material material;

	private ObiRope rope;

	private ObiCatmullRomCurve curve;

	private ObiSolver solver;

	private ObiRopeCursor cursor;

	private RaycastHit hookAttachment;

	private bool attached;

	private void Awake()
	{
		rope = base.gameObject.AddComponent<ObiRope>();
		curve = base.gameObject.AddComponent<ObiCatmullRomCurve>();
		solver = base.gameObject.AddComponent<ObiSolver>();
		rope.Solver = solver;
		rope.ropePath = curve;
		rope.GetComponent<MeshRenderer>().material = material;
		rope.resolution = 0.1f;
		rope.BendingConstraints.stiffness = 0.2f;
		rope.uvScale = new Vector2(1f, 5f);
		rope.normalizeV = false;
		rope.uvAnchor = 1f;
		solver.substeps = 3u;
		solver.distanceConstraintParameters.iterations = 5;
		solver.pinConstraintParameters.iterations = 5;
		solver.bendingConstraintParameters.iterations = 1;
		solver.particleCollisionConstraintParameters.enabled = false;
		solver.volumeConstraintParameters.enabled = false;
		solver.densityConstraintParameters.enabled = false;
		solver.stitchConstraintParameters.enabled = false;
		solver.skinConstraintParameters.enabled = false;
		solver.tetherConstraintParameters.enabled = false;
		cursor = rope.gameObject.AddComponent<ObiRopeCursor>();
		cursor.normalizedCoord = 0f;
		cursor.direction = true;
	}

	private void LaunchHook()
	{
		Vector3 mousePosition = Input.mousePosition;
		mousePosition.z = base.transform.position.z - Camera.main.transform.position.z;
		Vector3 vector = Camera.main.ScreenToWorldPoint(mousePosition);
		if (Physics.Raycast(new Ray(base.transform.position, vector - base.transform.position), out hookAttachment))
		{
			StartCoroutine(AttachHook());
		}
	}

	private IEnumerator AttachHook()
	{
		Vector3 item = curve.transform.InverseTransformPoint(hookAttachment.point);
		curve.controlPoints.Clear();
		curve.controlPoints.Add(Vector3.zero);
		curve.controlPoints.Add(Vector3.zero);
		curve.controlPoints.Add(item);
		curve.controlPoints.Add(item);
		yield return rope.GeneratePhysicRepresentationForMesh();
		ObiPinConstraintBatch firstBatch = rope.PinConstraints.GetFirstBatch();
		firstBatch.AddConstraint(0, character, base.transform.localPosition, 0f);
		firstBatch.AddConstraint(rope.UsedParticles - 1, hookAttachment.collider.GetComponent<ObiColliderBase>(), hookAttachment.collider.transform.InverseTransformPoint(hookAttachment.point), 0f);
		rope.AddToSolver(null);
		rope.GetComponent<MeshRenderer>().enabled = true;
		attached = true;
	}

	private void DetachHook()
	{
		rope.RemoveFromSolver(null);
		rope.GetComponent<MeshRenderer>().enabled = false;
		attached = false;
	}

	private void Update()
	{
		if (Input.GetMouseButtonDown(0))
		{
			if (!attached)
			{
				LaunchHook();
			}
			else
			{
				DetachHook();
			}
		}
		if (Input.GetKey(KeyCode.W))
		{
			cursor.ChangeLength(rope.RestLength - hookExtendRetractSpeed * Time.deltaTime);
		}
		if (Input.GetKey(KeyCode.S))
		{
			cursor.ChangeLength(rope.RestLength + hookExtendRetractSpeed * Time.deltaTime);
		}
	}
}
public class ObiActorTeleport : MonoBehaviour
{
	public ObiActor actor;

	private void Update()
	{
		if (Input.anyKeyDown)
		{
			StartCoroutine(Teleport());
		}
	}

	private IEnumerator Teleport()
	{
		actor.enabled = false;
		actor.transform.position = UnityEngine.Random.insideUnitSphere * 2f;
		yield return new WaitForFixedUpdate();
		actor.enabled = true;
	}
}
public class ObjectDragger : MonoBehaviour
{
	private Vector3 screenPoint;

	private Vector3 offset;

	private void OnMouseDown()
	{
		screenPoint = Camera.main.WorldToScreenPoint(base.gameObject.transform.position);
		offset = base.gameObject.transform.position - Camera.main.ScreenToWorldPoint(new Vector3(Input.mousePosition.x, Input.mousePosition.y, screenPoint.z));
	}

	private void OnMouseDrag()
	{
		Vector3 position = new Vector3(Input.mousePosition.x, Input.mousePosition.y, screenPoint.z);
		base.transform.position = Camera.main.ScreenToWorldPoint(position) + offset;
	}
}
public class ObjectLimit : MonoBehaviour
{
	public float minX;

	public float maxX = 1f;

	public float minY;

	public float maxY = 1f;

	public float minZ;

	public float maxZ = 1f;

	private void Update()
	{
		base.transform.localPosition = new Vector3(Mathf.Clamp(base.gameObject.transform.localPosition.x, minX, maxX), Mathf.Clamp(base.gameObject.transform.localPosition.y, minY, maxY), Mathf.Clamp(base.gameObject.transform.localPosition.z, minZ, maxZ));
	}
}
public class RobotArmController : MonoBehaviour
{
	public Transform section1;

	public Transform section2;

	public Transform actuator;

	public float speed = 40f;

	private void Update()
	{
		if (Input.GetKey(KeyCode.A))
		{
			section1.Rotate(0f, speed * Time.deltaTime, 0f, Space.World);
		}
		if (Input.GetKey(KeyCode.D))
		{
			section1.Rotate(0f, (0f - speed) * Time.deltaTime, 0f, Space.World);
		}
		if (Input.GetKey(KeyCode.W))
		{
			section1.Rotate(0f, speed * Time.deltaTime, 0f, Space.Self);
		}
		if (Input.GetKey(KeyCode.S))
		{
			section1.Rotate(0f, (0f - speed) * Time.deltaTime, 0f, Space.Self);
		}
		if (Input.GetKey(KeyCode.T))
		{
			section2.Rotate(0f, speed * Time.deltaTime, 0f, Space.Self);
		}
		if (Input.GetKey(KeyCode.G))
		{
			section2.Rotate(0f, (0f - speed) * Time.deltaTime, 0f, Space.Self);
		}
		if (Input.GetKey(KeyCode.Y))
		{
			actuator.Rotate(0f, speed * Time.deltaTime, 0f, Space.Self);
		}
		if (Input.GetKey(KeyCode.H))
		{
			actuator.Rotate(0f, (0f - speed) * Time.deltaTime, 0f, Space.Self);
		}
	}
}
public class RuntimeRopeGenerator
{
	private ObiRope rope;

	private ObiRopeCursor cursor;

	private ObiSolver solver;

	private int pinnedParticle = -1;

	public IEnumerator MakeRope(Transform anchoredTo, Vector3 attachmentOffset, float ropeLength)
	{
		GameObject gameObject = new GameObject("rope", typeof(ObiSolver), typeof(ObiRope), typeof(ObiCatmullRomCurve), typeof(ObiRopeCursor));
		rope = gameObject.GetComponent<ObiRope>();
		cursor = gameObject.GetComponent<ObiRopeCursor>();
		solver = gameObject.GetComponent<ObiSolver>();
		ObiCatmullRomCurve component = gameObject.GetComponent<ObiCatmullRomCurve>();
		rope.Solver = solver;
		rope.ropePath = component;
		rope.section = Resources.Load<ObiRopeSection>("DefaultRopeSection");
		component.controlPoints.Clear();
		component.controlPoints.Add(Vector3.zero);
		component.controlPoints.Add(Vector3.zero);
		component.controlPoints.Add(Vector3.down * ropeLength);
		component.controlPoints.Add(Vector3.down * ropeLength);
		rope.pooledParticles = 2000;
		rope.transform.SetParent(anchoredTo, worldPositionStays: false);
		rope.transform.localPosition = attachmentOffset;
		yield return rope.StartCoroutine(rope.GeneratePhysicRepresentationForMesh());
		rope.AddToSolver(null);
		pinnedParticle = rope.UsedParticles - 1;
		ObiTetherConstraintBatch batch = new ObiTetherConstraintBatch(cooked: true, sharesParticles: false, 0f, 1f);
		rope.TetherConstraints.AddBatch(batch);
		rope.invMasses[0] = 0f;
		Oni.SetParticleInverseMasses(solver.OniSolver, new float[1], 1, rope.particleIndices[0]);
	}

	public void AddPendulum(ObiCollider pendulum, Vector3 attachmentOffset)
	{
		rope.PinConstraints.RemoveFromSolver(null);
		rope.PinConstraints.GetFirstBatch().AddConstraint(pinnedParticle, pendulum, attachmentOffset, 1f);
		rope.PinConstraints.AddToSolver(null);
	}

	public void RemovePendulum()
	{
		rope.PinConstraints.RemoveFromSolver(null);
		rope.PinConstraints.GetFirstBatch().Clear();
		rope.PinConstraints.AddToSolver(null);
	}

	public void ChangeRopeLength(float changeAmount)
	{
		cursor.ChangeLength(rope.RestLength + changeAmount);
	}

	private void UpdateTethers()
	{
		rope.TetherConstraints.RemoveFromSolver(null);
		ObiTetherConstraintBatch firstBatch = rope.TetherConstraints.GetFirstBatch();
		firstBatch.Clear();
		ObiDistanceConstraintBatch firstBatch2 = rope.DistanceConstraints.GetFirstBatch();
		for (int i = 0; i < firstBatch2.ConstraintCount; i++)
		{
			firstBatch.AddConstraint(0, firstBatch2.springIndices[i * 2 + 1], rope.InterparticleDistance * (float)i, 1f, 1f);
		}
		firstBatch.Cook();
		rope.TetherConstraints.AddToSolver(null);
	}
}
public class RuntimeRopeGeneratorUse : MonoBehaviour
{
	public ObiCollider pendulum;

	private RuntimeRopeGenerator rg;

	public IEnumerator Start()
	{
		rg = new RuntimeRopeGenerator();
		yield return rg.MakeRope(base.transform, Vector3.zero, 1f);
		rg.AddPendulum(pendulum, Vector3.up * 0.5f);
	}

	public void Update()
	{
		if (Input.GetKey(KeyCode.W))
		{
			rg.ChangeRopeLength(0f - Time.deltaTime);
		}
		if (Input.GetKey(KeyCode.S))
		{
			rg.ChangeRopeLength(Time.deltaTime);
		}
	}
}
public class SlowmoToggler : MonoBehaviour
{
	public void Slowmo(bool slowmo)
	{
		Time.timeScale = (slowmo ? 0.25f : 1f);
	}
}
[AttributeUsage(AttributeTargets.Field)]
public class InspectorButtonAttribute : PropertyAttribute
{
	public static float kDefaultButtonWidth = 80f;

	public readonly string MethodName;

	private float _buttonWidth = kDefaultButtonWidth;

	public float ButtonWidth
	{
		get
		{
			return _buttonWidth;
		}
		set
		{
			_buttonWidth = value;
		}
	}

	public InspectorButtonAttribute(string MethodName)
	{
		this.MethodName = MethodName;
	}
}
public static class Oni
{
	public enum ConstraintType
	{
		Tether,
		Volume,
		Bending,
		Distance,
		Pin,
		ParticleCollision,
		Density,
		Collision,
		Skin,
		Aerodynamics,
		Stitch,
		ShapeMatching
	}

	public enum ParticlePhase
	{
		SelfCollide = 0x1000000,
		Fluid = 0x2000000
	}

	public enum ShapeType
	{
		Sphere,
		Box,
		Capsule,
		Heightmap,
		TriangleMesh,
		EdgeMesh,
		SignedDistanceField
	}

	public enum MaterialCombineMode
	{
		Average,
		Minimium,
		Multiply,
		Maximum
	}

	public enum NormalsUpdate
	{
		Recalculate,
		Skin
	}

	public enum ProfileMask : uint
	{
		ThreadIdMask = 4294901760u,
		TypeMask = 255u,
		StackLevelMask = 65280u
	}

	public struct ProfileInfo
	{
		public double start;

		public double end;

		public uint info;

		public int pad;

		[MarshalAs(UnmanagedType.ByValTStr, SizeConst = 64)]
		public string name;
	}

	public struct GridCell
	{
		public Vector3 center;

		public Vector3 size;

		public int count;
	}

	[Serializable]
	public struct SolverParameters
	{
		public enum Interpolation
		{
			None,
			Interpolate
		}

		public enum Mode
		{
			Mode3D,
			Mode2D
		}

		[Tooltip("In 2D mode, particles are simulated on the XY plane only. For use in conjunction with Unity's 2D mode.")]
		public Mode mode;

		[Tooltip("Same as Rigidbody.interpolation. Set to INTERPOLATE for cloth that is applied on a main character or closely followed by a camera. NONE for everything else.")]
		public Interpolation interpolation;

		public Vector3 gravity;

		[Tooltip("Percentage of velocity lost per second, between 0% (0) and 100% (1).")]
		[Range(0f, 1f)]
		public float damping;

		[Tooltip("Max ratio between a particle's longest and shortest axis. Use 1 for isotropic (completely round) particles.")]
		[Range(1f, 5f)]
		public float maxAnisotropy;

		[Tooltip("Radius of diffuse particle advection. Large values yield better quality but are more expensive.")]
		public float advectionRadius;

		[Tooltip("Kinetic energy below which particle positions arent updated. Energy values are mass-normalized, so all particles in the solver have the same threshold.")]
		public float sleepThreshold;

		public SolverParameters(Interpolation interpolation, Vector4 gravity)
		{
			mode = Mode.Mode3D;
			this.gravity = gravity;
			this.interpolation = interpolation;
			damping = 0f;
			maxAnisotropy = 3f;
			advectionRadius = 0.5f;
			sleepThreshold = 0.001f;
		}
	}

	[Serializable]
	public struct ConstraintParameters
	{
		public enum EvaluationOrder
		{
			Sequential,
			Parallel
		}

		[Tooltip("Order in which constraints are evaluated. SEQUENTIAL converges faster but is not very stable. PARALLEL is very stable but converges slowly, requiring more iterations to achieve the same result.")]
		public EvaluationOrder evaluationOrder;

		[Tooltip("Number of relaxation iterations performed by the constraint solver. A low number of iterations will perform better, but be less accurate.")]
		public int iterations;

		[Tooltip("Over (or under if < 1) relaxation factor used. At 1, no overrelaxation is performed. At 2, constraints double their relaxation rate. High values reduce stability but improve convergence.")]
		[Range(0.1f, 2f)]
		public float SORFactor;

		[MarshalAs(UnmanagedType.I1)]
		[Tooltip("Whether this constraint group is solved or not.")]
		public bool enabled;

		public ConstraintParameters(bool enabled, EvaluationOrder order, int iterations)
		{
			this.enabled = enabled;
			this.iterations = iterations;
			evaluationOrder = order;
			SORFactor = 1f;
		}
	}

	[StructLayout(LayoutKind.Sequential, Size = 112)]
	public struct Contact
	{
		public Vector4 point;

		public Vector4 normal;

		public Vector4 tangent;

		public Vector4 bitangent;

		public float distance;

		public float normalImpulse;

		public float tangentImpulse;

		public float bitangentImpulse;

		public float stickImpulse;

		public int particle;

		public int other;
	}

	public struct BoneWeights
	{
		public int bone0;

		public int bone1;

		public int bone2;

		public int bone3;

		public float weight0;

		public float weight1;

		public float weight2;

		public float weight3;

		public BoneWeights(BoneWeight weight)
		{
			bone0 = weight.boneIndex0;
			bone1 = weight.boneIndex1;
			bone2 = weight.boneIndex2;
			bone3 = weight.boneIndex3;
			weight0 = weight.weight0;
			weight1 = weight.weight1;
			weight2 = weight.weight2;
			weight3 = weight.weight3;
		}
	}

	[Serializable]
	public struct Rigidbody
	{
		public Quaternion rotation;

		public Vector3 linearVelocity;

		public Vector3 angularVelocity;

		public Vector3 centerOfMass;

		public Vector3 inertiaTensor;

		public float inverseMass;

		public void Set(UnityEngine.Rigidbody source, bool kinematicForParticles)
		{
			bool flag = !UnityEngine.Application.isPlaying || source.isKinematic || kinematicForParticles;
			rotation = source.rotation;
			linearVelocity = (kinematicForParticles ? Vector3.zero : source.velocity);
			angularVelocity = (kinematicForParticles ? Vector3.zero : source.angularVelocity);
			centerOfMass = source.transform.position + source.transform.rotation * source.centerOfMass;
			Vector3 vector = new Vector3(((source.constraints & RigidbodyConstraints.FreezeRotationX) != 0) ? 0f : (1f / source.inertiaTensor.x), ((source.constraints & RigidbodyConstraints.FreezeRotationY) != 0) ? 0f : (1f / source.inertiaTensor.y), ((source.constraints & RigidbodyConstraints.FreezeRotationZ) != 0) ? 0f : (1f / source.inertiaTensor.z));
			inertiaTensor = (flag ? Vector3.zero : (source.inertiaTensorRotation * vector));
			inverseMass = (flag ? 0f : (1f / source.mass));
		}

		public void Set(Rigidbody2D source, bool kinematicForParticles)
		{
			bool flag = !UnityEngine.Application.isPlaying || source.isKinematic || kinematicForParticles;
			rotation = Quaternion.AngleAxis(source.rotation, Vector3.forward);
			linearVelocity = source.velocity;
			angularVelocity = new Vector4(0f, 0f, source.angularVelocity * ((float)Math.PI / 180f), 0f);
			centerOfMass = source.transform.position + source.transform.rotation * source.centerOfMass;
			inertiaTensor = (flag ? Vector3.zero : new Vector3(0f, 0f, ((source.constraints & RigidbodyConstraints2D.FreezeRotation) != 0) ? 0f : (1f / source.inertia)));
			inverseMass = (flag ? 0f : (1f / source.mass));
		}
	}

	[Serializable]
	public struct RigidbodyVelocities
	{
		public Vector3 linearVelocity;

		public Vector3 angularVelocity;
	}

	[Serializable]
	public struct Collider
	{
		public Quaternion rotation;

		public Vector3 translation;

		public Vector3 scale;

		public Vector3 boundsMin;

		public Vector3 boundsMax;

		public int id;

		public float contactOffset;

		public int collisionGroup;

		[MarshalAs(UnmanagedType.I1)]
		public bool trigger;

		public void Set(UnityEngine.Collider source, int phase, float thickness)
		{
			boundsMin = source.bounds.min - Vector3.one * (thickness + source.contactOffset);
			boundsMax = source.bounds.max + Vector3.one * (thickness + source.contactOffset);
			translation = source.transform.position;
			rotation = source.transform.rotation;
			scale = source.transform.lossyScale;
			contactOffset = thickness;
			collisionGroup = phase;
			trigger = source.isTrigger;
			id = source.GetInstanceID();
		}

		public void Set(Collider2D source, int phase, float thickness)
		{
			boundsMin = source.bounds.min - Vector3.one * (thickness + 0.01f);
			boundsMax = source.bounds.max + Vector3.one * (thickness + 0.01f);
			translation = source.transform.position;
			rotation = source.transform.rotation;
			scale = source.transform.lossyScale;
			contactOffset = thickness;
			collisionGroup = phase;
			trigger = source.isTrigger;
			id = source.GetInstanceID();
		}
	}

	[Serializable]
	public struct Shape
	{
		public Vector3 center;

		public Vector3 size;

		public IntPtr data;

		public IntPtr indices;

		public int dataCount;

		public int indexCount;

		public int resolutionU;

		public int resolutionV;

		[MarshalAs(UnmanagedType.I1)]
		public bool is2D;

		public void Set(Vector3 center, float radius)
		{
			this.center = center;
			size = Vector3.one * radius;
		}

		public void Set(Vector3 center, Vector3 size)
		{
			this.center = center;
			this.size = size;
		}

		public void Set(Vector3 center, float radius, float height, int direction)
		{
			this.center = center;
			size = new Vector3(radius, height, direction);
		}

		public void Set(Vector3 size, int resolutionU, int resolutionV, IntPtr data)
		{
			this.size = size;
			this.resolutionU = resolutionU;
			this.resolutionV = resolutionV;
			this.data = data;
			dataCount = resolutionU * resolutionV;
		}

		public void Set(IntPtr data, IntPtr indices, int dataCount, int indicesCount)
		{
			this.data = data;
			this.indices = indices;
			this.dataCount = dataCount;
			indexCount = indicesCount;
		}
	}

	[Serializable]
	public struct CollisionMaterial
	{
		public float friction;

		public float stickiness;

		public float stickDistance;

		public MaterialCombineMode frictionCombine;

		public MaterialCombineMode stickinessCombine;
	}

	[Serializable]
	public struct FluidMaterial
	{
		public float smoothingRadius;

		public float restDensity;

		public float viscosity;

		public float surfaceTension;

		public float buoyancy;

		public float atmosphericDrag;

		public float atmosphericPressure;

		public float vorticity;

		public float elasticRange;

		public float plasticCreep;

		public float plasticThreshold;
	}

	[Serializable]
	[StructLayout(LayoutKind.Sequential, Size = 64)]
	public struct DFNode
	{
		public Vector4 distancesA;

		public Vector4 distancesB;

		public Vector4 center;

		public int firstChild;
	}

	[Serializable]
	public struct HalfEdge
	{
		public int index;

		public int indexInFace;

		public int face;

		public int nextHalfEdge;

		public int pair;

		public int endVertex;

		public HalfEdge(int index)
		{
			this.index = index;
			indexInFace = -1;
			face = -1;
			nextHalfEdge = -1;
			pair = -1;
			endVertex = -1;
		}
	}

	[Serializable]
	public struct Vertex
	{
		public int index;

		public int halfEdge;

		public Vector3 position;

		public Vertex(Vector3 position, int index, int halfEdge)
		{
			this.index = index;
			this.halfEdge = halfEdge;
			this.position = position;
		}
	}

	[Serializable]
	public struct Face
	{
		public int index;

		public int halfEdge;

		public Face(int index)
		{
			this.index = index;
			halfEdge = -1;
		}
	}

	[Serializable]
	public struct MeshInformation
	{
		public float volume;

		public float area;

		public int borderEdgeCount;

		[MarshalAs(UnmanagedType.I1)]
		public bool closed;

		[MarshalAs(UnmanagedType.I1)]
		public bool nonManifold;
	}

	public struct Anisotropy
	{
		public Vector4 b1;

		public Vector4 b2;

		public Vector4 b3;
	}

	public const int ConstraintTypeCount = 12;

	private const string LIBNAME = "Oni";

	public static GCHandle PinMemory(object data)
	{
		return GCHandle.Alloc(data, GCHandleType.Pinned);
	}

	public static void UnpinMemory(GCHandle handle)
	{
		if (handle.IsAllocated)
		{
			handle.Free();
		}
	}

	[DllImport("Oni")]
	public static extern IntPtr CreateCollider();

	[DllImport("Oni")]
	public static extern void DestroyCollider(IntPtr collider);

	[DllImport("Oni")]
	public static extern IntPtr CreateShape(ShapeType shapeType);

	[DllImport("Oni")]
	public static extern void DestroyShape(IntPtr shape);

	[DllImport("Oni")]
	public static extern IntPtr CreateRigidbody();

	[DllImport("Oni")]
	public static extern void DestroyRigidbody(IntPtr rigidbody);

	[DllImport("Oni")]
	public static extern void UpdateCollider(IntPtr collider, ref Collider adaptor);

	[DllImport("Oni")]
	public static extern void UpdateShape(IntPtr shape, ref Shape adaptor);

	[DllImport("Oni")]
	public static extern void UpdateRigidbody(IntPtr rigidbody, ref Rigidbody adaptor);

	[DllImport("Oni")]
	public static extern void GetRigidbodyVelocity(IntPtr rigidbody, ref RigidbodyVelocities velocities);

	[DllImport("Oni")]
	public static extern IntPtr CreateDistanceField();

	[DllImport("Oni")]
	public static extern void DestroyDistanceField(IntPtr df);

	[DllImport("Oni")]
	public static extern void StartBuildingDistanceField(IntPtr df, float maxError, int maxDepth, Vector3[] vertexPos, int[] triIndices, int numVertices, int numTriangles);

	[DllImport("Oni")]
	public static extern bool ContinueBuildingDistanceField(IntPtr df);

	[DllImport("Oni")]
	public static extern float SampleDistanceField(IntPtr df, float x, float y, float z);

	[DllImport("Oni")]
	public static extern int GetDistanceFieldNodeCount(IntPtr df);

	[DllImport("Oni")]
	public static extern void GetDistanceFieldNodes(IntPtr df, DFNode[] nodes);

	[DllImport("Oni")]
	public static extern void SetDistanceFieldNodes(IntPtr df, DFNode[] nodes, int num);

	[DllImport("Oni")]
	public static extern void SetShapeDistanceField(IntPtr shape, IntPtr distanceField);

	[DllImport("Oni")]
	public static extern void SetColliderShape(IntPtr collider, IntPtr shape);

	[DllImport("Oni")]
	public static extern void SetColliderRigidbody(IntPtr collider, IntPtr rigidbody);

	[DllImport("Oni")]
	public static extern void SetColliderMaterial(IntPtr collider, IntPtr material);

	[DllImport("Oni")]
	public static extern IntPtr CreateCollisionMaterial();

	[DllImport("Oni")]
	public static extern void DestroyCollisionMaterial(IntPtr material);

	[DllImport("Oni")]
	public static extern void UpdateCollisionMaterial(IntPtr material, ref CollisionMaterial adaptor);

	[DllImport("Oni")]
	public static extern IntPtr CreateSolver(int maxParticles, int maxNeighbours);

	[DllImport("Oni")]
	public static extern void DestroySolver(IntPtr solver);

	[DllImport("Oni")]
	public static extern void InitializeFrame(IntPtr solver, ref Vector4 translation, ref Vector4 scale, ref Quaternion rotation);

	[DllImport("Oni")]
	public static extern void UpdateFrame(IntPtr solver, ref Vector4 translation, ref Vector4 scale, ref Quaternion rotation, float dt);

	[DllImport("Oni")]
	public static extern void ApplyFrame(IntPtr solver, float linearVelocityScale, float angularVelocityScale, float linearInertiaScale, float angularInertiaScale, float dt);

	[DllImport("Oni")]
	public static extern void AddCollider(IntPtr collider);

	[DllImport("Oni")]
	public static extern void RemoveCollider(IntPtr collider);

	[DllImport("Oni")]
	public static extern void GetBounds(IntPtr solver, ref Vector3 min, ref Vector3 max);

	[DllImport("Oni")]
	public static extern int GetParticleGridSize(IntPtr solver);

	[DllImport("Oni")]
	public static extern void GetParticleGrid(IntPtr solver, GridCell[] cells);

	[DllImport("Oni")]
	public static extern void SetSolverParameters(IntPtr solver, ref SolverParameters parameters);

	[DllImport("Oni")]
	public static extern void GetSolverParameters(IntPtr solver, ref SolverParameters parameters);

	[DllImport("Oni")]
	public static extern int SetActiveParticles(IntPtr solver, int[] active, int num);

	[DllImport("Oni")]
	public static extern void AddSimulationTime(IntPtr solver, float time);

	[DllImport("Oni")]
	public static extern void ResetSimulationTime(IntPtr solver);

	[DllImport("Oni")]
	public static extern void UpdateSolver(IntPtr solver, uint substeps, float substep_dt);

	[DllImport("Oni")]
	public static extern void ApplyPositionInterpolation(IntPtr solver, float step_dt);

	[DllImport("Oni")]
	public static extern void UpdateSkeletalAnimation(IntPtr solver);

	[DllImport("Oni")]
	public static extern int GetConstraintCount(IntPtr solver, int type);

	[DllImport("Oni")]
	public static extern void GetActiveConstraintIndices(IntPtr solver, int[] indices, int num, int type);

	[DllImport("Oni")]
	public static extern int SetRenderableParticlePositions(IntPtr solver, Vector4[] positions, int num, int destOffset);

	[DllImport("Oni")]
	public static extern int GetRenderableParticlePositions(IntPtr solver, Vector4[] positions, int num, int sourceOffset);

	[DllImport("Oni")]
	public static extern int SetParticlePhases(IntPtr solver, int[] phases, int num, int destOffset);

	[DllImport("Oni")]
	public static extern int SetParticlePositions(IntPtr solver, Vector4[] positions, int num, int destOffset);

	[DllImport("Oni")]
	public static extern int GetParticlePositions(IntPtr solver, Vector4[] positions, int num, int sourceOffset);

	[DllImport("Oni")]
	public static extern int SetParticleOrientations(IntPtr solver, Quaternion[] orientations, int num, int destOffset);

	[DllImport("Oni")]
	public static extern int GetParticleOrientations(IntPtr solver, Quaternion[] orientations, int num, int sourceOffset);

	[DllImport("Oni")]
	public static extern int SetParticleInverseMasses(IntPtr solver, float[] invMasses, int num, int destOffset);

	[DllImport("Oni")]
	public static extern int SetParticleSolidRadii(IntPtr solver, float[] radii, int num, int destOffset);

	[DllImport("Oni")]
	public static extern int SetParticlePrincipalRadii(IntPtr solver, Vector2[] principalRadii, int num, int destOffset);

	[DllImport("Oni")]
	public static extern int SetParticleVelocities(IntPtr solver, Vector4[] velocities, int num, int destOffset);

	[DllImport("Oni")]
	public static extern int GetParticleVelocities(IntPtr solver, Vector4[] velocities, int num, int sourceOffset);

	[DllImport("Oni")]
	public static extern int SetParticleAngularVelocities(IntPtr solver, Vector4[] angularVelocities, int num, int destOffset);

	[DllImport("Oni")]
	public static extern int GetParticleAngularVelocities(IntPtr solver, Vector4[] angularVelocities, int num, int sourceOffset);

	[DllImport("Oni")]
	public static extern void AddParticleExternalForces(IntPtr solver, Vector4[] forces, int[] indices, int num);

	[DllImport("Oni")]
	public static extern void AddParticleExternalForce(IntPtr solver, ref Vector4 force, int[] indices, int num);

	[DllImport("Oni")]
	public static extern void AddParticleExternalTorques(IntPtr solver, Vector4[] torques, int[] indices, int num);

	[DllImport("Oni")]
	public static extern void AddParticleExternalTorque(IntPtr solver, ref Vector4 torque, int[] indices, int num);

	[DllImport("Oni")]
	public static extern void AddParticleWinds(IntPtr solver, Vector4[] winds, int[] indices, int num);

	[DllImport("Oni")]
	public static extern void AddParticleWind(IntPtr solver, ref Vector4 wind, int[] indices, int num);

	[DllImport("Oni")]
	public static extern int GetParticleVorticities(IntPtr solver, Vector4[] vorticities, int num, int sourceOffset);

	[DllImport("Oni")]
	public static extern int GetParticleDensities(IntPtr solver, float[] densities, int num, int sourceOffset);

	[DllImport("Oni")]
	public static extern int GetParticleAnisotropies(IntPtr solver, Anisotropy[] anisotropies, int num, int sourceOffset);

	[DllImport("Oni")]
	public static extern int GetDeformableTriangleCount(IntPtr solver);

	[DllImport("Oni")]
	public static extern void SetDeformableTriangles(IntPtr solver, int[] indices, int num, int destOffset);

	[DllImport("Oni")]
	public static extern int RemoveDeformableTriangles(IntPtr solver, int num, int sourceOffset);

	[DllImport("Oni")]
	public static extern void SetConstraintGroupParameters(IntPtr solver, int type, ref ConstraintParameters parameters);

	[DllImport("Oni")]
	public static extern void GetConstraintGroupParameters(IntPtr solver, int type, ref ConstraintParameters parameters);

	[DllImport("Oni")]
	public static extern void SetCollisionMaterials(IntPtr solver, IntPtr[] materials, int[] indices, int num);

	[DllImport("Oni")]
	public static extern int SetRestPositions(IntPtr solver, Vector4[] positions, int num, int destOffset);

	[DllImport("Oni")]
	public static extern void SetFluidMaterials(IntPtr solver, FluidMaterial[] materials, int num, int destOffset);

	[DllImport("Oni")]
	public static extern int SetFluidMaterialIndices(IntPtr solver, int[] indices, int num, int destOffset);

	[DllImport("Oni")]
	public static extern IntPtr CreateDeformableMesh(IntPtr solver, IntPtr halfEdge, IntPtr skinConstraintBatch, [MarshalAs(UnmanagedType.LPArray, SizeConst = 16)] float[] worldToLocal, IntPtr particleIndices, int vertexCapacity, int vertexCount);

	[DllImport("Oni")]
	public static extern void DestroyDeformableMesh(IntPtr solver, IntPtr mesh);

	[DllImport("Oni")]
	public static extern bool TearDeformableMeshAtVertex(IntPtr mesh, int vertexIndex, ref Vector3 planePoint, ref Vector3 planeNormal, int[] updated_edges, ref int num_edges);

	[DllImport("Oni")]
	public static extern void SetDeformableMeshTBNUpdate(IntPtr mesh, NormalsUpdate normalsUpdate, [MarshalAs(UnmanagedType.I1)] bool skinTangents);

	[DllImport("Oni")]
	public static extern void SetDeformableMeshTransform(IntPtr mesh, [MarshalAs(UnmanagedType.LPArray, SizeConst = 16)] float[] worldToLocal);

	[DllImport("Oni")]
	public static extern void SetDeformableMeshSkinMap(IntPtr mesh, IntPtr sourceMesh, IntPtr triangleSkinMap);

	[DllImport("Oni")]
	public static extern void SetDeformableMeshParticleIndices(IntPtr mesh, IntPtr particleIndices);

	[DllImport("Oni")]
	public static extern void SetDeformableMeshData(IntPtr mesh, IntPtr triangles, IntPtr vertices, IntPtr normals, IntPtr tangents, IntPtr colors, IntPtr uv1, IntPtr uv2, IntPtr uv3, IntPtr uv4);

	[DllImport("Oni")]
	public static extern void SetDeformableMeshAnimationData(IntPtr mesh, float[] bindPoses, BoneWeights[] weights, int numBones);

	[DllImport("Oni")]
	public static extern void SetDeformableMeshBoneTransforms(IntPtr mesh, float[] boneTransforms);

	[DllImport("Oni")]
	public static extern void ForceDeformableMeshSkeletalSkinning(IntPtr mesh);

	[DllImport("Oni")]
	public static extern IntPtr CreateBatch(int type, [MarshalAs(UnmanagedType.I1)] bool cooked);

	[DllImport("Oni")]
	public static extern void DestroyBatch(IntPtr batch);

	[DllImport("Oni")]
	public static extern IntPtr AddBatch(IntPtr solver, IntPtr batch, [MarshalAs(UnmanagedType.I1)] bool sharesParticles);

	[DllImport("Oni")]
	public static extern void RemoveBatch(IntPtr solver, IntPtr batch);

	[DllImport("Oni")]
	public static extern bool EnableBatch(IntPtr batch, [MarshalAs(UnmanagedType.I1)] bool enabled);

	[DllImport("Oni")]
	public static extern int GetBatchConstraintCount(IntPtr batch);

	[DllImport("Oni")]
	public static extern int GetBatchConstraintForces(IntPtr batch, float[] forces, int num, int destOffset);

	[DllImport("Oni")]
	public static extern int GetBatchPhaseCount(IntPtr batch);

	[DllImport("Oni")]
	public static extern void GetBatchPhaseSizes(IntPtr batch, int[] phaseSizes);

	[DllImport("Oni")]
	public static extern void SetBatchPhaseSizes(IntPtr batch, int[] phaseSizes, int num);

	[DllImport("Oni")]
	public static extern bool CookBatch(IntPtr batch);

	[DllImport("Oni")]
	public static extern int SetActiveConstraints(IntPtr batch, int[] active, int num);

	[DllImport("Oni")]
	public static extern void SetDistanceConstraints(IntPtr batch, int[] indices, float[] restLengths, Vector2[] stiffnesses, int num);

	[DllImport("Oni")]
	public static extern void GetDistanceConstraints(IntPtr batch, int[] indices, float[] restLengths, Vector2[] stiffnesses);

	[DllImport("Oni")]
	public static extern void SetBendingConstraints(IntPtr batch, int[] indices, float[] restBends, Vector2[] bendingStiffnesses, int num);

	[DllImport("Oni")]
	public static extern void GetBendingConstraints(IntPtr batch, int[] indices, float[] restBends, Vector2[] bendingStiffnesses);

	[DllImport("Oni")]
	public static extern void SetSkinConstraints(IntPtr batch, int[] indices, Vector4[] points, Vector4[] normals, float[] radiiBackstops, float[] stiffnesses, int num);

	[DllImport("Oni")]
	public static extern void GetSkinConstraints(IntPtr batch, int[] indices, Vector4[] points, Vector4[] normals, float[] radiiBackstops, float[] stiffnesses);

	[DllImport("Oni")]
	public static extern void SetAerodynamicConstraints(IntPtr batch, int[] particleIndices, float[] aerodynamicCoeffs, int num);

	[DllImport("Oni")]
	public static extern void SetVolumeConstraints(IntPtr batch, int[] triangleIndices, int[] firstTriangle, int[] numTriangles, float[] restVolumes, Vector2[] pressureStiffnesses, int num);

	[DllImport("Oni")]
	public static extern void SetShapeMatchingConstraints(IntPtr batch, int[] shapeIndices, int[] firstIndex, int[] numIndices, float[] shapeStiffnesses, int num);

	[DllImport("Oni")]
	public static extern void CalculateRestShapeMatching(IntPtr solver, IntPtr batch);

	[DllImport("Oni")]
	public static extern void SetTetherConstraints(IntPtr batch, int[] indices, Vector2[] maxLenghtsScales, float[] stiffnesses, int num);

	[DllImport("Oni")]
	public static extern void GetTetherConstraints(IntPtr batch, int[] indices, Vector2[] maxLenghtsScales, float[] stiffnesses);

	[DllImport("Oni")]
	public static extern void SetPinConstraints(IntPtr batch, int[] indices, Vector4[] pinOffsets, IntPtr[] colliders, float[] stiffnesses, int num);

	[DllImport("Oni")]
	public static extern void SetStitchConstraints(IntPtr batch, int[] indices, float[] stiffnesses, int num);

	[DllImport("Oni")]
	public static extern void GetCollisionContacts(IntPtr solver, Contact[] contacts, int n);

	[DllImport("Oni")]
	public static extern void ClearDiffuseParticles(IntPtr solver);

	[DllImport("Oni")]
	public static extern int SetDiffuseParticles(IntPtr solver, Vector4[] positions, int num);

	[DllImport("Oni")]
	public static extern int GetDiffuseParticleVelocities(IntPtr solver, Vector4[] velocities, int num, int sourceOffset);

	[DllImport("Oni")]
	public static extern void SetDiffuseParticleNeighbourCounts(IntPtr solver, IntPtr neighbourCounts);

	[DllImport("Oni")]
	public static extern IntPtr CreateHalfEdgeMesh();

	[DllImport("Oni")]
	public static extern void DestroyHalfEdgeMesh(IntPtr mesh);

	[DllImport("Oni")]
	public static extern void SetVertices(IntPtr mesh, IntPtr vertices, int n);

	[DllImport("Oni")]
	public static extern void SetHalfEdges(IntPtr mesh, IntPtr halfedges, int n);

	[DllImport("Oni")]
	public static extern void SetFaces(IntPtr mesh, IntPtr faces, int n);

	[DllImport("Oni")]
	public static extern void SetNormals(IntPtr mesh, IntPtr normals);

	[DllImport("Oni")]
	public static extern void SetTangents(IntPtr mesh, IntPtr tangents);

	[DllImport("Oni")]
	public static extern void SetInverseOrientations(IntPtr mesh, IntPtr orientations);

	[DllImport("Oni")]
	public static extern void SetVisualMap(IntPtr mesh, IntPtr map);

	[DllImport("Oni")]
	public static extern int GetVertexCount(IntPtr mesh);

	[DllImport("Oni")]
	public static extern int GetHalfEdgeCount(IntPtr mesh);

	[DllImport("Oni")]
	public static extern int GetFaceCount(IntPtr mesh);

	[DllImport("Oni")]
	public static extern int GetHalfEdgeMeshInfo(IntPtr mesh, ref MeshInformation meshInfo);

	[DllImport("Oni")]
	public static extern void CalculatePrimitiveCounts(IntPtr mesh, Vector3[] vertices, int[] triangles, int vertexCount, int triangleCount);

	[DllImport("Oni")]
	public static extern void Generate(IntPtr mesh, Vector3[] vertices, int[] triangles, int vertexCount, int triangleCount, ref Vector3 scale);

	[DllImport("Oni")]
	public static extern void GetPointCloudAnisotropy(Vector3[] points, int count, float maxAnisotropy, float radius, ref Quaternion orientation, ref Vector3 principalValues);

	[DllImport("Oni")]
	public static extern int MakePhase(int group, ParticlePhase flags);

	[DllImport("Oni")]
	public static extern int GetGroupFromPhase(int phase);

	[DllImport("Oni")]
	public static extern float BendingConstraintRest(float[] constraintCoordinates);

	[DllImport("Oni")]
	public static extern IntPtr CreateTriangleSkinMap();

	[DllImport("Oni")]
	public static extern void DestroyTriangleSkinMap(IntPtr skinmap);

	[DllImport("Oni")]
	public static extern void Bind(IntPtr skinmap, IntPtr sourcemesh, IntPtr targetmesh, uint[] sourceMasterFlags, uint[] targetSlaveFlags);

	[DllImport("Oni")]
	public static extern int GetSkinnedVertexCount(IntPtr skinmap);

	[DllImport("Oni")]
	public static extern void GetSkinInfo(IntPtr skinmap, int[] skinIndices, int[] sourceTriIndices, Vector3[] baryPositions, Vector3[] baryNormals, Vector3[] baryTangents);

	[DllImport("Oni")]
	public static extern void SetSkinInfo(IntPtr skinmap, int[] skinIndices, int[] sourceTriIndices, Vector3[] baryPositions, Vector3[] baryNormals, Vector3[] baryTangents, int num);

	[DllImport("Oni")]
	public static extern void WaitForAllTasks();

	[DllImport("Oni")]
	public static extern void ClearTasks();

	[DllImport("Oni")]
	public static extern int GetMaxSystemConcurrency();

	[DllImport("Oni")]
	public static extern void SignalFrameStart();

	[DllImport("Oni")]
	public static extern double SignalFrameEnd();

	[DllImport("Oni")]
	public static extern void EnableProfiler([MarshalAs(UnmanagedType.I1)] bool cooked);

	[DllImport("Oni")]
	public static extern int GetProfilingInfoCount();

	[DllImport("Oni")]
	public static extern void GetProfilingInfo([Out] ProfileInfo[] info, int num);
}
[RequireComponent(typeof(Rigidbody))]
public class ObiKinematicVelocities : MonoBehaviour
{
	private Quaternion prevRotation;

	private Vector3 prevPosition;

	private Rigidbody unityRigidbody;

	private void Awake()
	{
		unityRigidbody = GetComponent<Rigidbody>();
		prevPosition = base.transform.position;
		prevRotation = base.transform.rotation;
	}

	private void LateUpdate()
	{
		if (unityRigidbody.isKinematic)
		{
			unityRigidbody.velocity = (base.transform.position - prevPosition) / Time.deltaTime;
			Quaternion quaternion = base.transform.rotation * Quaternion.Inverse(prevRotation);
			unityRigidbody.angularVelocity = new Vector3(quaternion.x, quaternion.y, quaternion.z) * 2f / Time.deltaTime;
		}
		prevPosition = base.transform.position;
		prevRotation = base.transform.rotation;
	}
}
public class Wander : MonoBehaviour
{
	public float m_radius = 20f;

	public float m_minHeight;

	public float m_maxHeight = 3f;

	public float m_minSpeed = 0.2f;

	public float m_maxSpeed = 2f;

	public float m_arrivedDistance = 0.1f;

	public int m_randomSeed = 1763;

	private Vector3 m_targetPosition;

	private bool m_hasArrived;

	private float m_speed = 1f;

	private Vector3 oriPosition;

	private void Start()
	{
		oriPosition = base.transform.localPosition;
		UnityEngine.Random.InitState(m_randomSeed);
		m_targetPosition = PickANewTargetPosition();
		InvokeRepeating("CheckDistance", 0f, 0.5f);
	}

	private void Update()
	{
		if (!m_hasArrived)
		{
			base.transform.localPosition = Vector3.Lerp(base.transform.localPosition, m_targetPosition, Time.deltaTime * m_speed);
		}
	}

	private void CheckDistance()
	{
		if (Vector3.Distance(m_targetPosition, base.transform.localPosition) < m_arrivedDistance)
		{
			m_hasArrived = true;
			m_targetPosition = PickANewTargetPosition();
			m_hasArrived = false;
		}
		if (UnityEngine.Random.Range(0f, 1f) < 0.5f)
		{
			m_speed = UnityEngine.Random.Range(m_minSpeed, m_maxSpeed);
		}
	}

	private Vector3 PickANewTargetPosition()
	{
		Vector3 vector = UnityEngine.Random.insideUnitSphere * m_radius;
		return new Vector3(vector.x, UnityEngine.Random.Range(m_minHeight, m_maxHeight), vector.z);
	}
}
public enum WebPluginType
{
	Android,
	AndroidGecko,
	iOS,
	Mac,
	Windows
}
namespace Vuplex.WebView
{
	internal class AndroidGeckoByteArrayCallback : AndroidJavaProxy
	{
		private Action<byte[]> _callback;

		public AndroidGeckoByteArrayCallback(Action<byte[]> callback)
			: base("com.vuplex.webview.gecko.ByteArrayCallback")
		{
			_callback = callback;
		}

		public void callback(AndroidJavaObject result)
		{
			AndroidJavaObject androidJavaObject = result.Get<AndroidJavaObject>("value");
			byte[] obj = AndroidJNIHelper.ConvertFromJNIArray<byte[]>(androidJavaObject.GetRawObject());
			androidJavaObject.Dispose();
			_callback(obj);
			_callback = null;
		}
	}
	internal struct GeckoTextureCreatorInvocation
	{
		public int id;

		public int nativeWidth;

		public int nativeHeight;

		public Action<Texture2D> callback;
	}
	public class AndroidGeckoTextureCreator : MonoBehaviour
	{
		private static AndroidGeckoTextureCreator _instance;

		private List<GeckoTextureCreatorInvocation> _pendingInvocations = new List<GeckoTextureCreatorInvocation>();

		private List<int> _invocationIdsToTrigger = new List<int>();

		public static AndroidGeckoTextureCreator Instance
		{
			get
			{
				if (!_instance)
				{
					_instance = new GameObject("AndroidGeckoTextureCreator").AddComponent<AndroidGeckoTextureCreator>();
				}
				return _instance;
			}
		}

		public void CreateTexture(float width, float height, Action<Texture2D> callback)
		{
			GeckoTextureCreatorInvocation geckoTextureCreatorInvocation = default(GeckoTextureCreatorInvocation);
			geckoTextureCreatorInvocation.id = int.Parse(Guid.NewGuid().ToString().Split('-')[0], NumberStyles.HexNumber);
			geckoTextureCreatorInvocation.nativeWidth = _convertUnityUnitsToPixels(width);
			geckoTextureCreatorInvocation.nativeHeight = _convertUnityUnitsToPixels(height);
			geckoTextureCreatorInvocation.callback = callback;
			GeckoTextureCreatorInvocation item = geckoTextureCreatorInvocation;
			_pendingInvocations.Add(item);
			_invocationIdsToTrigger.Add(item.id);
			WebView_addCreateTextureInvocation(item.id, item.nativeWidth, item.nativeHeight);
		}

		public void HandleTextureCreated(string parameterString)
		{
			string[] array = parameterString.Split(';');
			int invocationId = int.Parse(array[0]);
			IntPtr nativeTex = new IntPtr(int.Parse(array[1]));
			GeckoTextureCreatorInvocation item = _pendingInvocations.Find((GeckoTextureCreatorInvocation i) => i.id == invocationId);
			_pendingInvocations.Remove(item);
			Texture2D obj = Texture2D.CreateExternalTexture(item.nativeWidth, item.nativeHeight, TextureFormat.RGBA32, mipChain: false, linear: false, nativeTex);
			item.callback(obj);
		}

		private IEnumerator Start()
		{
			yield return StartCoroutine("CallPluginAtEndOfFrames");
		}

		private IEnumerator CallPluginAtEndOfFrames()
		{
			while (true)
			{
				yield return new WaitForEndOfFrame();
				if (_invocationIdsToTrigger.Count <= 0)
				{
					continue;
				}
				foreach (int item in _invocationIdsToTrigger)
				{
					GL.IssuePluginEvent(WebView_getCreateTextureFunction(), item);
				}
				_invocationIdsToTrigger.Clear();
			}
		}

		private int _convertUnityUnitsToPixels(float unityUnits)
		{
			return (int)(unityUnits * 1300f);
		}

		[DllImport("VuplexWebViewAndroidGecko")]
		private static extern void WebView_addCreateTextureInvocation(int invocationId, int width, int height);

		[DllImport("VuplexWebViewAndroidGecko")]
		private static extern IntPtr WebView_getCreateTextureFunction();
	}
	internal class AndroidGeckoWebPlugin : MonoBehaviour, IWebPlugin
	{
		private static AndroidGeckoWebPlugin _instance;

		public static AndroidGeckoWebPlugin Instance
		{
			get
			{
				if (_instance == null)
				{
					_instance = new GameObject("AndroidGeckoWebPlugin").AddComponent<AndroidGeckoWebPlugin>();
					UnityEngine.Object.DontDestroyOnLoad(_instance.gameObject);
				}
				return _instance;
			}
		}

		public void ClearAllData()
		{
			AndroidGeckoWebView.ClearAllData();
		}

		public void CreateTexture(float width, float height, Action<Texture2D> callback)
		{
			AndroidGeckoTextureCreator.Instance.CreateTexture(width, height, callback);
		}

		public void CreateMaterial(Action<Material> callback)
		{
			CreateTexture(1f, 1f, delegate(Texture2D texture)
			{
				string path = "AndroidViewportMaterial";
				if (XRSettings.enabled && XRSettings.eyeTextureDesc.vrUsage == VRTextureUsage.TwoEyes)
				{
					path = "AndroidSinglePassViewportMaterial";
				}
				Material material = Resources.Load<Material>(path);
				_enableGammaCorrectionIfNeeded(material);
				material.mainTexture = texture;
				callback(material);
			});
		}

		public void CreateVideoMaterial(Action<Material> callback)
		{
			callback(null);
		}

		public virtual IWebView CreateWebView()
		{
			return AndroidGeckoWebView.Instantiate();
		}

		public void SetStorageEnabled(bool enabled)
		{
			AndroidGeckoWebView.SetStorageEnabled(enabled);
		}

		public void SetUserAgent(bool mobile)
		{
			AndroidGeckoWebView.GloballySetUserAgent(mobile);
		}

		public void SetUserAgent(string userAgent)
		{
			AndroidGeckoWebView.GloballySetUserAgent(userAgent);
		}

		private static void _enableGammaCorrectionIfNeeded(Material material)
		{
			if (QualitySettings.activeColorSpace == ColorSpace.Linear)
			{
				material.SetFloat("_EnableGammaCorrection", 1f);
			}
		}
	}
	internal class AndroidGeckoWebPluginRegistrant
	{
		[RuntimeInitializeOnLoadMethod(RuntimeInitializeLoadType.BeforeSceneLoad)]
		private static void _registerPlugin()
		{
			WebPluginFactory.RegisterAndroidGeckoPlugin(AndroidGeckoWebPlugin.Instance);
		}
	}
	public class AndroidGeckoWebView : BaseWebView, IWebView
	{
		internal static AndroidJavaClass _class = new AndroidJavaClass("com.vuplex.webview.gecko.GeckoWebView");

		protected new const string _dllName = "VuplexWebViewAndroidGecko";

		private const string FULL_CLASS_NAME = "com.vuplex.webview.gecko.GeckoWebView";

		private ScreenOrientation _previousOrientation = Screen.orientation;

		private const string REMOTE_DEBUGGING_EXCEPTION_MESSAGE = "Unable to enable remote debugging, because a webview has already been created. EnableRemoteDebugging() can only be called prior to creating any webviews.";

		internal AndroidJavaObject _webView;

		private static bool? _webViewPackageIsAvailable = null;

		public static AndroidGeckoWebView Instantiate()
		{
			GameObject obj = new GameObject();
			obj.transform.parent = Singleton<MediaController>.Instance.transform;
			return obj.AddComponent<AndroidGeckoWebView>();
		}

		public override void Init(Texture2D viewportTexture, float width, float height, Texture2D videoTexture)
		{
			base.Init(viewportTexture, width, height, videoTexture);
			_webView = new AndroidJavaObject("com.vuplex.webview.gecko.GeckoWebView", base.gameObject.name, viewportTexture.GetNativeTexturePtr().ToInt32(), base._nativeWidth, base._nativeHeight);
		}

		public override void Blur()
		{
			if (!_isDisposed)
			{
				_webView.Call("blur");
			}
		}

		public override void CanGoBack(Action<bool> callback)
		{
			bool obj = _webView.Call<bool>("canGoBack", Array.Empty<object>());
			callback(obj);
		}

		public override void CanGoForward(Action<bool> callback)
		{
			bool obj = _webView.Call<bool>("canGoForward", Array.Empty<object>());
			callback(obj);
		}

		public override void CaptureScreenshot(Action<byte[]> callback)
		{
			if (_isDisposed)
			{
				callback(new byte[0]);
				return;
			}
			_webView.Call("captureScreenshot", new AndroidGeckoByteArrayCallback(callback));
		}

		public static void ClearAllData()
		{
			_class.CallStatic("clearAllData");
		}

		public override void Click(Vector2 point)
		{
			if (!_isDisposed)
			{
				int num = (int)(point.x * (float)base._nativeWidth);
				int num2 = (int)(point.y * (float)base._nativeHeight);
				_webView.Call("click", num, num2);
			}
		}

		public override void DisableViewUpdates()
		{
			_webView.Call("disableViewUpdates");
			_viewUpdatesAreEnabled = false;
		}

		public override void Dispose()
		{
			if (!_isDisposed)
			{
				WebView_removePointer(_webView.GetRawObject());
				_isDisposed = true;
				_webView.Call("destroy");
				_webView.Dispose();
				UnityEngine.Object.Destroy(base.gameObject);
			}
		}

		public static void EnableRemoteDebugging()
		{
			if (!_class.CallStatic<bool>("enableRemoteDebugging", Array.Empty<object>()))
			{
				throw new InvalidOperationException("Unable to enable remote debugging, because a webview has already been created. EnableRemoteDebugging() can only be called prior to creating any webviews.");
			}
		}

		public override void EnableViewUpdates()
		{
			_webView.Call("enableViewUpdates");
			_viewUpdatesAreEnabled = true;
		}

		public override void ExecuteJavaScript(string javaScript, Action<string> callback)
		{
			if (_isDisposed)
			{
				callback?.Invoke("");
				return;
			}
			string text = null;
			if (callback != null)
			{
				text = Guid.NewGuid().ToString();
				_pendingJavaScriptResultCallbacks[text] = callback;
			}
			_webView.Call("executeJavaScript", javaScript, text);
		}

		public override void Focus()
		{
			if (!_isDisposed)
			{
				_webView.Call("focus");
			}
		}

		public override void GetRawTextureData(Action<byte[]> callback)
		{
			if (_isDisposed)
			{
				callback(new byte[0]);
				return;
			}
			_webView.Call("getRawTextureData", new AndroidGeckoByteArrayCallback(callback));
		}

		public new static void GloballySetUserAgent(bool mobile)
		{
			_class.CallStatic("globallySetUserAgent", mobile);
		}

		public new static void GloballySetUserAgent(string userAgent)
		{
			_class.CallStatic("globallySetUserAgent", userAgent);
		}

		public override void GoBack()
		{
			_webView.Call("goBack");
		}

		public override void GoForward()
		{
			_webView.Call("goForward");
		}

		public override void HandleKeyboardInput(string input)
		{
			if (!_isDisposed)
			{
				_webView.Call("handleKeyboardInput", input);
			}
		}

		public override void LoadHtml(string html)
		{
			if (!_isDisposed)
			{
				if (html == null)
				{
					throw new ArgumentException("parameter 'html' cannot be null");
				}
				if (html.Substring(0, 500) == "<!DOCTYPE html><html lang=\"en\"><head><meta charset=\"utf-8\"><meta name=\"transparent\" content=\"true\"><meta name=\"viewport\" content=\"viewport-fit=cover,width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0\"><meta name=\"theme-color\" content=\"#000000\"><link rel=\"manifest\" href=\"./manifest.json\"><link rel=\"shortcut icon\" href=\"./favicon.ico\"><title>Unity Keyboard</title><style>html{width:100vw;height:100vh}body{margin:0;padding:0;font-family:Helvetica,Ariel,sans-serif;font-size:20px}#root,body{width:100%;height:100%}.key-component{display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center;border-radius:.5rem}.key-component>img,.key-component div,.key-component span{pointer-events:none}.key-component.hover,.key-component:hover{background-color:#485a63}.key-component.key-down{background-color:#a2b3bc}.key-component.key-up{-webkit-animation:highlight 1s;animation:highlight 1s}@-webkit-keyframes highlight{0%{background-color:#a2b3bc}to{background-color:auto}}@keyframes highlight{0%{background-color:#a2b3bc}to{background-color:auto}}.center-board{background-color:#283237;color:#fff;height:100%;width:100%;border-radius:.6rem;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.center-board .key-area{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;width:95%;height:90%}.center-board .key-area .key-row{display:-webkit-flex;display:flex;-webkit-justify-content:space-around;justify-content:space-around;-webkit-flex:1 1 auto;flex:1 1 auto}.center-board .key-area .key-row .key{-webkit-flex:2 0 auto;flex:2 0 auto}.center-board .key-area .key-row .key-offset-margin{-webkit-flex:1 0 auto;flex:1 0 auto}.center-board .key-area .key-row .spacebar-container{-webkit-flex:12 0 auto;flex:12 0 auto;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.center-board .key-area .key-row .spacebar-container .spacebar{width:98%;height:80%;background-color:#3d4d55;border-radius:.6rem;color:#a6a6a6}.center-board .key-area .key-row .spacebar-container .spacebar.hover,.center-board .key-area .key-row .spacebar-container .spacebar:hover{background-color:#485a63}.center-board .key-area .key-row .spacebar-container .spacebar:active{background-color:#688390}.shift-key-icon{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;justify-conten:center;-webkit-align-items:center;align-items:center}.shift-key-icon .shift-arrow-triangle{width:0;height:0;border-left:.45em solid transparent;border-bottom:.45em solid #fff;border-right:.45em solid transparent}.shift-key-icon .shift-arrow-triangle.shift-arrow-colored{border-bottom-color:#4fbea0}.shift-key-icon .regular-arrow-line{height:.6em;width:.35em;background-color:#fff}.shift-key-icon .regular-arrow-line.shift-arrow-colored{background-color:#4fbea0}.shift-key-icon .caps-lock-arrow-line .caps-lock-line-top{height:.3em;width:.35em;background-color:#4fbea0}.shift-key-icon .caps-lock-arrow-line .caps-lock-line-middle{height:.2em}.shift-key-icon .caps-lock-arrow-line .caps-lock-line-bottom{height:.1em;width:.35em;background-color:#4fbea0}.num-pad{width:100%;height:100%;border-radius:.6rem;background-color:#283237;color:#fff;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.num-pad,.num-pad .key-area{display:-webkit-flex;display:flex}.num-pad .key-area{-webkit-flex-direction:column;flex-direction:column;width:85%;height:90%}.num-pad .key-area .key-row{display:-webkit-flex;display:flex;-webkit-justify-content:space-around;justify-content:space-around;-webkit-flex:1 1 auto;flex:1 1 auto}.num-pad .key-area .key-row .key{-webkit-flex:1 0 auto;flex:1 0 auto}.right-pad{width:100%;height:100%;background-color:#283237;border-radius:.6rem;color:#fff;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.right-pad,.right-pad .key-area{display:-webkit-flex;display:flex}.right-pad .key-area{width:90%;height:75%;-webkit-justify-content:space-between;justify-content:space-between}.right-pad .right-key-area{-webkit-flex:0 0 100%;flex:0 0 100%;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;-webkit-justify-content:center;justify-content:center}.right-pad .right-key-area .arrow-pad{width:90%;height:3.75em;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;font-size:1.25em}.right-pad .right-key-area .arrow-pad .arrow-pad-row{-webkit-flex:1 1 auto;flex:1 1 auto;width:100%;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.right-pad .right-key-area .arrow-pad .arrow-pad-row.arrow-pad-middle{-webkit-justify-content:space-between;justify-content:space-between}.voice-button{width:100%;padding-top:100%;position:relative;border-radius:50%;background-color:#a6a6a6}.voice-button .voice-button-icon{position:absolute;top:0;right:0;bottom:0;left:0;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center;pointer-events:none}.voice-button .voice-button-icon>div{width:50%;height:50%}.voice-button .voice-button-icon>div img{width:100%;height:100%}.voice-button svg{position:absolute;top:-224px;left:-224px;-webkit-transform:scale(.05);transform:scale(.05);fill:rgba(0,0,0,.5);pointer-events:none}.voice-button.hover,.voice-button:hover{background-color:#62c5aa}.voice-button.hover svg,.voice-button:hover svg{fill:#283237}@-webkit-keyframes recordingBackground{0%{background:#f30}50%{background:#ff8000}to{background:#f30}}@keyframes recordingBackground{0%{background:#f30}50%{background:#ff8000}to{background:#f30}}.voice-button.voice-button-active{-webkit-animation:recordingBackground 5s infinite;animation:recordingBackground 5s infinite}.voice-button.voice-button-active svg{fill:#fff}.keyboard{width:100%;height:100%;display:-webkit-flex;display:flex;-webkit-justify-content:space-between;justify-content:space-between}.keyboard .num-pad-container{-webkit-flex:1 1 15%;flex:1 1 15%}.keyboard .center-board-container{-webkit-flex:1 1 55%;flex:1 1 55%}.keyboard .right-pad-container{-webkit-flex:1 1 15%;flex:1 1 15%}.keyboard .board-margin{-webkit-flex:1 1 2.5%;flex:1 1 2.5%}.keyboard .enter-key-area{height:100%;-webkit-flex:1 1 10%;flex:1 1 10%;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.keyboard .enter-key-area .backspace-icon{width:60%;border-radius:.5rem}.keyboard .enter-key-area .backspace-icon:hover{background-color:#dde4e7}.keyboard .enter-key-area .backspace-icon img{width:100%}.keyboard .enter-key-area .return-key-container{width:60%;padding-top:10px}.keyboard .enter-key-area .return-key-container .return-key-component{border-radius:50%;background-color:#09f}.keyboard .enter-key-area .return-key-container .return-key-component.hover,.keyboard .enter-key-area .return-key-container .return-key-component:hover{background-color:#008ae6}.keyboard .enter-key-area .return-key-container .return-key{width:100%;padding-top:100%;position:relative;border-radius:50%;pointer-events:none}.keyboard .enter-key-area .voice-button-container{width:60%;padding-top:15px}.keyboard .enter-key-area .return-key-text{position:absolute;top:0;left:0;bottom:0;right:0;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center;font-size:45px;font-weight:700}.keyboard .enter-key-area .return-key-text img{width:60%}/*# sourceMappingURL=main.047c931b.chunk.css.map */</style></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id=\"root\"></div><script>!function(l){function e(e){for(var r,t,n=e[0],o=e[1],u=e[2],f=0,i=[];f<n.length;f++)t=n[f],p[t]&&i.push(p[t][0]),p[t]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(l[r]=o[r]);for(s&&s(e);i.length;)i.shift()();return c.push.apply(c,u||[]),a()}function a(){for(var e,r=0;r<c.length;r++){for(var t=c[r],n=!0,o=1;o<t.length;o++){var u=t[o];0!==p[u]&&(n=!1)}n&&(c.splice(r--,1),e=f(f.s=t[0]))}return e}var t={},p={2:0},c=[];function f(e){if(t[e])return t[e].exports;var r=t[e]={i:e,l:!1,exports:{}};return l[e].call(r.exports,r,r.exports,f),r.l=!0,r.exports}f.m=l,f.c=t,f.d=function(e,r,t){f.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},f.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},f.t=function(r,e){if(1&e&&(r=f(r)),8&e)return r;if(4&e&&\"object\"==typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(f.r(t),Object.defineProperty(t,\"default\",{enumerable:!0,value:r}),2&e&&\"string\"!=typeof r)for(var n in r)f.d(t,n,function(e){return r[e]}.bind(null,n));return t},f.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(r,\"a\",r),r},f.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},f.p=\"\";var r=window.webpackJsonp=window.webpackJsonp||[],n=r.push.bind(r);r.push=e,r=r.slice();for(var o=0;o<r.length;o++)e(r[o]);var s=n;a()}([])</script><script>(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[function(e,t,n){\"use strict\";e.exports=n(18)},function(e,t,n){\"use strict\";function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,\"a\",function(){return r})},function(e,t,n){\"use strict\";function r(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}n.d(t,\"a\",function(){return r})},function(e,t,n){\"use strict\";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,\"a\",function(){return i})},function(e,t,n){\"use strict\";function r(e){return(r=\"function\"===typeof Symbol&&\"symbol\"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function i(e){return(i=\"function\"===typeof Symbol&&\"symbol\"===r(Symbol.iterator)?function(e){return r(e)}:function(e){return e&&\"function\"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":r(e)})(e)}var l=n(7);function o(e,t){return!t||\"object\"!==i(t)&&\"function\"!==typeof t?Object(l.a)(e):t}n.d(t,\"a\",function(){return o})},function(e,t,n){\"use strict\";function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e,t){if(\"function\"!==typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}n.d(t,\"a\",function(){return i})},function(e,t,n){\"use strict\";var r=n(1);function i(e,t,n){return(i=\"undefined\"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Object(r.a)(e)););return e}(e,t);if(i){var l=Object.getOwnPropertyDescriptor(i,t);return l.get?l.get.call(n):l.value}})(e,t,n||e)}n.d(t,\"a\",function(){return i})},function(e,t,n){\"use strict\";function r(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}n.d(t,\"a\",function(){return r})},function(e,t,n){\"use strict\";function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}()}n.d(t,\"a\",function(){return r})},function(e,t,n){\"use strict\";var r,i=\"object\"===typeof Reflect?Reflect:null,l=i&&\"function\"===typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&\"function\"===typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!==e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var u=10;function c(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function s(e,t,n,r){var i,l,o,a;if(\"function\"!==typeof n)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof n);if(void 0===(l=e._events)?(l=e._events=Object.create(null),e._eventsCount=0):(void 0!==l.newListener&&(e.emit(\"newListener\",t,n.listener?n.listener:n),l=e._events),o=l[t]),void 0===o)o=l[t]=n,++e._eventsCount;else if(\"function\"===typeof o?o=l[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=c(e))>0&&o.length>i&&!o.warned){o.warned=!0;var u=new Error(\"Possible EventEmitter memory leak detected. \"+o.length+\" \"+String(t)+\" listeners added. Use emitter.setMaxListeners() to increase limit\");u.name=\"MaxListenersExceededWarning\",u.emitter=e,u.type=t,u.count=o.length,a=u,console&&console.warn&&console.warn(a)}return e}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,l(this.listener,this.target,e))}.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:\"function\"===typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):m(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if(\"function\"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(a,\"defaultMaxListeners\",{enumerable:!0,get:function(){return u},set:function(e){if(\"number\"!==typeof e||e<0||o(e))throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received '+e+\".\");u=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if(\"number\"!==typeof e||e<0||o(e))throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received '+e+\".\");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r=\"error\"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error(\"Unhandled error.\"+(o?\" (\"+o.message+\")\":\"\"));throw a.context=o,a}var u=i[e];if(void 0===u)return!1;if(\"function\"===typeof u)l(u,this,t);else{var c=u.length,s=m(u,c);for(n=0;n<c;++n)l(s[n],this,t)}return!0},a.prototype.addListener=function(e,t){return s(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return s(this,e,t,!0)},a.prototype.once=function(e,t){if(\"function\"!==typeof t)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof t);return this.on(e,f(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if(\"function\"!==typeof t)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,f(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,l,o;if(\"function\"!==typeof t)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit(\"removeListener\",e,n.listener||t));else if(\"function\"!==typeof n){for(i=-1,l=n.length-1;l>=0;l--)if(n[l]===t||n[l].listener===t){o=n[l].listener,i=l;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit(\"removeListener\",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,l=Object.keys(n);for(r=0;r<l.length;++r)\"removeListener\"!==(i=l[r])&&this.removeAllListeners(i);return this.removeAllListeners(\"removeListener\"),this._events=Object.create(null),this._eventsCount=0,this}if(\"function\"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return d(this,e,!0)},a.prototype.rawListeners=function(e){return d(this,e,!1)},a.listenerCount=function(e,t){return\"function\"===typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){\"use strict\";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String(\"abc\");if(e[5]=\"de\",\"5\"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t[\"_\"+String.fromCharCode(n)]=n;if(\"0123456789\"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(\"\"))return!1;var r={};return\"abcdefghijklmnopqrst\".split(\"\").forEach(function(e){r[e]=e}),\"abcdefghijklmnopqrst\"===Object.keys(Object.assign({},r)).join(\"\")}catch(i){return!1}}()?Object.assign:function(e,t){for(var n,o,a=function(e){if(null===e||void 0===e)throw new TypeError(\"Object.assign cannot be called with null or undefined\");return Object(e)}(e),u=1;u<arguments.length;u++){for(var c in n=Object(arguments[u]))i.call(n,c)&&(a[c]=n[c]);if(r){o=r(n);for(var s=0;s<o.length;s++)l.call(n,o[s])&&(a[o[s]]=n[o[s]])}}return a}},function(e,t,n){\"use strict\";!function e(){if(\"undefined\"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&\"function\"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(19)},,,,,function(e,t,n){\"use strict\";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,l=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(u){i=!0,l=u}finally{try{r||null==a.return||a.return()}finally{if(i)throw l}}return n}(e,t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}()}n.d(t,\"a\",function(){return r})},,function(e,t,n){\"use strict\";var r=n(10),i=\"function\"===typeof Symbol&&Symbol.for,l=i?Symbol.for(\"react.element\"):60103,o=i?Symbol.for(\"react.portal\"):60106,a=i?Symbol.for(\"react.fragment\"):60107,u=i?Symbol.for(\"react.strict_mode\"):60108,c=i?Symbol.for(\"react.profiler\"):60114,s=i?Symbol.for(\"react.provider\"):60109,f=i?Symbol.for(\"react.context\"):60110,d=i?Symbol.for(\"react.concurrent_mode\"):60111,p=i?Symbol.for(\"react.forward_ref\"):60112,m=i?Symbol.for(\"react.suspense\"):60113,h=i?Symbol.for(\"react.memo\"):60115,v=i?Symbol.for(\"react.lazy\"):60116,y=\"function\"===typeof Symbol&&Symbol.iterator;function g(e){for(var t=arguments.length-1,n=\"https://reactjs.org/docs/error-decoder.html?invariant=\"+e,r=0;r<t;r++)n+=\"&args[]=\"+encodeURIComponent(arguments[r+1]);!function(e,t,n,r,i,l,o,a){if(!e){if(e=void 0,void 0===t)e=Error(\"Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.\");else{var u=[n,r,i,l,o,a],c=0;(e=Error(t.replace(/%s/g,function(){return u[c++]}))).name=\"Invariant Violation\"}throw e.framesToPop=1,e}}(!1,\"Minified React error #\"+e+\"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. \",n)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w={};function k(e,t,n){this.props=e,this.context=t,this.refs=w,this.updater=n||b}function x(){}function T(e,t,n){this.props=e,this.context=t,this.refs=w,this.updater=n||b}k.prototype.isReactComponent={},k.prototype.setState=function(e,t){\"object\"!==typeof e&&\"function\"!==typeof e&&null!=e&&g(\"85\"),this.updater.enqueueSetState(this,e,t,\"setState\")},k.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,\"forceUpdate\")},x.prototype=k.prototype;var _=T.prototype=new x;_.constructor=T,r(_,k.prototype),_.isPureReactComponent=!0;var S={current:null},E={current:null},C=Object.prototype.hasOwnProperty,P={key:!0,ref:!0,__self:!0,__source:!0};function N(e,t,n){var r=void 0,i={},o=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=\"\"+t.key),t)C.call(t,r)&&!P.hasOwnProperty(r)&&(i[r]=t[r]);var u=arguments.length-2;if(1===u)i.children=n;else if(1<u){for(var c=Array(u),s=0;s<u;s++)c[s]=arguments[s+2];i.children=c}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===i[r]&&(i[r]=u[r]);return{$$typeof:l,type:e,key:o,ref:a,props:i,_owner:E.current}}function O(e){return\"object\"===typeof e&&null!==e&&e.$$typeof===l}var R=/\\/+/g,L=[];function M(e,t,n,r){if(L.length){var i=L.pop();return i.result=e,i.keyPrefix=t,i.func=n,i.context=r,i.count=0,i}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function z(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>L.length&&L.push(e)}function I(e,t,n){return null==e?0:function e(t,n,r,i){var a=typeof t;\"undefined\"!==a&&\"boolean\"!==a||(t=null);var u=!1;if(null===t)u=!0;else switch(a){case\"string\":case\"number\":u=!0;break;case\"object\":switch(t.$$typeof){case l:case o:u=!0}}if(u)return r(i,t,\"\"===n?\".\"+U(t,0):n),1;if(u=0,n=\"\"===n?\".\":n+\":\",Array.isArray(t))for(var c=0;c<t.length;c++){var s=n+U(a=t[c],c);u+=e(a,s,r,i)}else if(s=null===t||\"object\"!==typeof t?null:\"function\"===typeof(s=y&&t[y]||t[\"@@iterator\"])?s:null,\"function\"===typeof s)for(t=s.call(t),c=0;!(a=t.next()).done;)u+=e(a=a.value,s=n+U(a,c++),r,i);else\"object\"===a&&g(\"31\",\"[object Object]\"===(r=\"\"+t)?\"object with keys {\"+Object.keys(t).join(\", \")+\"}\":r,\"\");return u}(e,\"\",t,n)}function U(e,t){return\"object\"===typeof e&&null!==e&&null!=e.key?function(e){var t={\"=\":\"=0\",\":\":\"=2\"};return\"$\"+(\"\"+e).replace(/[=:]/g,function(e){return t[e]})}(e.key):t.toString(36)}function F(e,t){e.func.call(e.context,t,e.count++)}function D(e,t,n){var r=e.result,i=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?A(e,r,n,function(e){return e}):null!=e&&(O(e)&&(e=function(e,t){return{$$typeof:l,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,i+(!e.key||t&&t.key===e.key?\"\":(\"\"+e.key).replace(R,\"$&/\")+\"/\")+n)),r.push(e))}function A(e,t,n,r,i){var l=\"\";null!=n&&(l=(\"\"+n).replace(R,\"$&/\")+\"/\"),I(e,D,t=M(t,l,r,i)),z(t)}function j(){var e=S.current;return null===e&&g(\"307\"),e}var W={Children:{map:function(e,t,n){if(null==e)return e;var r=[];return A(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;I(e,F,t=M(null,null,t,n)),z(t)},count:function(e){return I(e,function(){return null},null)},toArray:function(e){var t=[];return A(e,t,null,function(e){return e}),t},only:function(e){return O(e)||g(\"143\"),e}},createRef:function(){return{current:null}},Component:k,PureComponent:T,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:f,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},forwardRef:function(e){return{$$typeof:p,render:e}},lazy:function(e){return{$$typeof:v,_ctor:e,_status:-1,_result:null}},memo:function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},useCallback:function(e,t){return j().useCallback(e,t)},useContext:function(e,t){return j().useContext(e,t)},useEffect:function(e,t){return j().useEffect(e,t)},useImperativeHandle:function(e,t,n){return j().useImperativeHandle(e,t,n)},useDebugValue:function(){},useLayoutEffect:function(e,t){return j().useLayoutEffect(e,t)},useMemo:function(e,t){return j().useMemo(e,t)},useReducer:function(e,t,n){return j().useReducer(e,t,n)},useRef:function(e){return j().useRef(e)},useState:function(e){return j().useState(e)},Fragment:a,StrictMode:u,Suspense:m,createElement:N,cloneElement:function(e,t,n){(null===e||void 0===e)&&g(\"267\",e);var i=void 0,o=r({},e.props),a=e.key,u=e.ref,c=e._owner;if(null!=t){void 0!==t.ref&&(u=t.ref,c=E.current),void 0!==t.key&&(a=\"\"+t.key);var s=void 0;for(i in e.type&&e.type.defaultProps&&(s=e.type.defaultProps),t)C.call(t,i)&&!P.hasOwnProperty(i)&&(o[i]=void 0===t[i]&&void 0!==s?s[i]:t[i])}if(1===(i=arguments.length-2))o.children=n;else if(1<i){s=Array(i);for(var f=0;f<i;f++)s[f]=arguments[f+2];o.children=s}return{$$typeof:l,type:e.type,key:a,ref:u,props:o,_owner:c}},createFactory:function(e){var t=N.bind(null,e);return t.type=e,t},isValidElement:O,version:\"16.8.2\",unstable_ConcurrentMode:d,unstable_Profiler:c,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:S,ReactCurrentOwner:E,assign:r}},V={default:W},B=V&&W||V;e.exports=B.default||B},function(e,t,n){\"use strict\";var r=n(0),i=n(10),l=n(20);function o(e){for(var t=arguments.length-1,n=\"https://reactjs.org/docs/error-decoder.html?invariant=\"+e,r=0;r<t;r++)n+=\"&args[]=\"+encodeURIComponent(arguments[r+1]);!function(e,t,n,r,i,l,o,a){if(!e){if(e=void 0,void 0===t)e=Error(\"Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.\");else{var u=[n,r,i,l,o,a],c=0;(e=Error(t.replace(/%s/g,function(){return u[c++]}))).name=\"Invariant Violation\"}throw e.framesToPop=1,e}}(!1,\"Minified React error #\"+e+\"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. \",n)}r||o(\"227\");var a=!1,u=null,c=!1,s=null,f={onError:function(e){a=!0,u=e}};function d(e,t,n,r,i,l,o,c,s){a=!1,u=null,function(e,t,n,r,i,l,o,a,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(s){this.onError(s)}}.apply(f,arguments)}var p=null,m={};function h(){if(p)for(var e in m){var t=m[e],n=p.indexOf(e);if(-1<n||o(\"96\",e),!y[n])for(var r in t.extractEvents||o(\"97\",e),y[n]=t,n=t.eventTypes){var i=void 0,l=n[r],a=t,u=r;g.hasOwnProperty(u)&&o(\"99\",u),g[u]=l;var c=l.phasedRegistrationNames;if(c){for(i in c)c.hasOwnProperty(i)&&v(c[i],a,u);i=!0}else l.registrationName?(v(l.registrationName,a,u),i=!0):i=!1;i||o(\"98\",r,e)}}}function v(e,t,n){b[e]&&o(\"100\",e),b[e]=t,w[e]=t.eventTypes[n].dependencies}var y=[],g={},b={},w={},k=null,x=null,T=null;function _(e,t,n){var r=e.type||\"unknown-event\";e.currentTarget=T(n),function(e,t,n,r,i,l,f,p,m){if(d.apply(this,arguments),a){if(a){var h=u;a=!1,u=null}else o(\"198\"),h=void 0;c||(c=!0,s=h)}}(r,t,void 0,e),e.currentTarget=null}function S(e,t){return null==t&&o(\"30\"),null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function E(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var C=null;function P(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var r=0;r<t.length&&!e.isPropagationStopped();r++)_(e,t[r],n[r]);else t&&_(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}var N={injectEventPluginOrder:function(e){p&&o(\"101\"),p=Array.prototype.slice.call(e),h()},injectEventPluginsByName:function(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var r=e[t];m.hasOwnProperty(t)&&m[t]===r||(m[t]&&o(\"102\",t),m[t]=r,n=!0)}n&&h()}};function O(e,t){var n=e.stateNode;if(!n)return null;var r=k(n);if(!r)return null;n=r[t];e:switch(t){case\"onClick\":case\"onClickCapture\":case\"onDoubleClick\":case\"onDoubleClickCapture\":case\"onMouseDown\":case\"onMouseDownCapture\":case\"onMouseMove\":case\"onMouseMoveCapture\":case\"onMouseUp\":case\"onMouseUpCapture\":(r=!r.disabled)||(r=!(\"button\"===(e=e.type)||\"input\"===e||\"select\"===e||\"textarea\"===e)),e=!r;break e;default:e=!1}return e?null:(n&&\"function\"!==typeof n&&o(\"231\",t,typeof n),n)}function R(e){if(null!==e&&(C=S(C,e)),e=C,C=null,e&&(E(e,P),C&&o(\"95\"),c))throw e=s,c=!1,s=null,e}var L=Math.random().toString(36).slice(2),M=\"__reactInternalInstance$\"+L,z=\"__reactEventHandlers$\"+L;function I(e){if(e[M])return e[M];for(;!e[M];){if(!e.parentNode)return null;e=e.parentNode}return 5===(e=e[M]).tag||6===e.tag?e:null}function U(e){return!(e=e[M])||5!==e.tag&&6!==e.tag?null:e}function F(e){if(5===e.tag||6===e.tag)return e.stateNode;o(\"33\")}function D(e){return e[z]||null}function A(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function j(e,t,n){(t=O(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=S(n._dispatchListeners,t),n._dispatchInstances=S(n._dispatchInstances,e))}function W(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=A(t);for(t=n.length;0<t--;)j(n[t],\"captured\",e);for(t=0;t<n.length;t++)j(n[t],\"bubbled\",e)}}function V(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=O(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=S(n._dispatchListeners,t),n._dispatchInstances=S(n._dispatchInstances,e))}function B(e){e&&e.dispatchConfig.registrationName&&V(e._targetInst,null,e)}function H(e){E(e,W)}var $=!(\"undefined\"===typeof window||!window.document||!window.document.createElement);function Q(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n[\"Webkit\"+e]=\"webkit\"+t,n[\"Moz\"+e]=\"moz\"+t,n}var K={animationend:Q(\"Animation\",\"AnimationEnd\"),animationiteration:Q(\"Animation\",\"AnimationIteration\"),animationstart:Q(\"Animation\",\"AnimationStart\"),transitionend:Q(\"Transition\",\"TransitionEnd\")},q={},Y={};function X(e){if(q[e])return q[e];if(!K[e])return e;var t,n=K[e];for(t in n)if(n.hasOwnProperty(t)&&t in Y)return q[e]=n[t];return e}$&&(Y=document.createElement(\"div\").style,\"AnimationEvent\"in window||(delete K.animationend.animation,delete K.animationiteration.animation,delete K.animationstart.animation),\"TransitionEvent\"in window||delete K.transitionend.transition);var G=X(\"animationend\"),J=X(\"animationiteration\"),Z=X(\"animationstart\"),ee=X(\"transitionend\"),te=\"abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting\".split(\" \"),ne=null,re=null,ie=null;function le(){if(ie)return ie;var e,t,n=re,r=n.length,i=\"value\"in ne?ne.value:ne.textContent,l=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[l-t];t++);return ie=i.slice(e,1<t?1-t:void 0)}function oe(){return!0}function ae(){return!1}function ue(e,t,n,r){for(var i in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(i)&&((t=e[i])?this[i]=t(n):\"target\"===i?this.target=r:this[i]=n[i]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?oe:ae,this.isPropagationStopped=ae,this}function ce(e,t,n,r){if(this.eventPool.length){var i=this.eventPool.pop();return this.call(i,e,t,n,r),i}return new this(e,t,n,r)}function se(e){e instanceof this||o(\"279\"),e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function fe(e){e.eventPool=[],e.getPooled=ce,e.release=se}i(ue.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():\"unknown\"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=oe)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():\"unknown\"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=oe)},persist:function(){this.isPersistent=oe},isPersistent:ae,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=ae,this._dispatchInstances=this._dispatchListeners=null}}),ue.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},ue.extend=function(e){function t(){}function n(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var l=new t;return i(l,n.prototype),n.prototype=l,n.prototype.constructor=n,n.Interface=i({},r.Interface,e),n.extend=r.extend,fe(n),n},fe(ue);var de=ue.extend({data:null}),pe=ue.extend({data:null}),me=[9,13,27,32],he=$&&\"CompositionEvent\"in window,ve=null;$&&\"documentMode\"in document&&(ve=document.documentMode);var ye=$&&\"TextEvent\"in window&&!ve,ge=$&&(!he||ve&&8<ve&&11>=ve),be=String.fromCharCode(32),we={beforeInput:{phasedRegistrationNames:{bubbled:\"onBeforeInput\",captured:\"onBeforeInputCapture\"},dependencies:[\"compositionend\",\"keypress\",\"textInput\",\"paste\"]},compositionEnd:{phasedRegistrationNames:{bubbled:\"onCompositionEnd\",captured:\"onCompositionEndCapture\"},dependencies:\"blur compositionend keydown keypress keyup mousedown\".split(\" \")},compositionStart:{phasedRegistrationNames:{bubbled:\"onCompositionStart\",captured:\"onCompositionStartCapture\"},dependencies:\"blur compositionstart keydown keypress keyup mousedown\".split(\" \")},compositionUpdate:{phasedRegistrationNames:{bubbled:\"onCompositionUpdate\",captured:\"onCompositionUpdateCapture\"},dependencies:\"blur compositionupdate keydown keypress keyup mousedown\".split(\" \")}},ke=!1;function xe(e,t){switch(e){case\"keyup\":return-1!==me.indexOf(t.keyCode);case\"keydown\":return 229!==t.keyCode;case\"keypress\":case\"mousedown\":case\"blur\":return!0;default:return!1}}function Te(e){return\"object\"===typeof(e=e.detail)&&\"data\"in e?e.data:null}var _e=!1;var Se={eventTypes:we,extractEvents:function(e,t,n,r){var i=void 0,l=void 0;if(he)e:{switch(e){case\"compositionstart\":i=we.compositionStart;break e;case\"compositionend\":i=we.compositionEnd;break e;case\"compositionupdate\":i=we.compositionUpdate;break e}i=void 0}else _e?xe(e,n)&&(i=we.compositionEnd):\"keydown\"===e&&229===n.keyCode&&(i=we.compositionStart);return i?(ge&&\"ko\"!==n.locale&&(_e||i!==we.compositionStart?i===we.compositionEnd&&_e&&(l=le()):(re=\"value\"in(ne=r)?ne.value:ne.textContent,_e=!0)),i=de.getPooled(i,t,n,r),l?i.data=l:null!==(l=Te(n))&&(i.data=l),H(i),l=i):l=null,(e=ye?function(e,t){switch(e){case\"compositionend\":return Te(t);case\"keypress\":return 32!==t.which?null:(ke=!0,be);case\"textInput\":return(e=t.data)===be&&ke?null:e;default:return null}}(e,n):function(e,t){if(_e)return\"compositionend\"===e||!he&&xe(e,t)?(e=le(),ie=re=ne=null,_e=!1,e):null;switch(e){case\"paste\":return null;case\"keypress\":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case\"compositionend\":return ge&&\"ko\"!==t.locale?null:t.data;default:return null}}(e,n))?((t=pe.getPooled(we.beforeInput,t,n,r)).data=e,H(t)):t=null,null===l?t:null===t?l:[l,t]}},Ee=null,Ce=null,Pe=null;function Ne(e){if(e=x(e)){\"function\"!==typeof Ee&&o(\"280\");var t=k(e.stateNode);Ee(e.stateNode,e.type,t)}}function Oe(e){Ce?Pe?Pe.push(e):Pe=[e]:Ce=e}function Re(){if(Ce){var e=Ce,t=Pe;if(Pe=Ce=null,Ne(e),t)for(e=0;e<t.length;e++)Ne(t[e])}}function Le(e,t){return e(t)}function Me(e,t,n){return e(t,n)}function ze(){}var Ie=!1;function Ue(e,t){if(Ie)return e(t);Ie=!0;try{return Le(e,t)}finally{Ie=!1,(null!==Ce||null!==Pe)&&(ze(),Re())}}var Fe={color:!0,date:!0,datetime:!0,\"datetime-local\":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function De(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return\"input\"===t?!!Fe[e.type]:\"textarea\"===t}function Ae(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function je(e){if(!$)return!1;var t=(e=\"on\"+e)in document;return t||((t=document.createElement(\"div\")).setAttribute(e,\"return;\"),t=\"function\"===typeof t[e]),t}function We(e){var t=e.type;return(e=e.nodeName)&&\"input\"===e.toLowerCase()&&(\"checkbox\"===t||\"radio\"===t)}function Ve(e){e._valueTracker||(e._valueTracker=function(e){var t=We(e)?\"checked\":\"value\",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=\"\"+e[t];if(!e.hasOwnProperty(t)&&\"undefined\"!==typeof n&&\"function\"===typeof n.get&&\"function\"===typeof n.set){var i=n.get,l=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=\"\"+e,l.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=\"\"+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Be(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r=\"\";return e&&(r=We(e)?e.checked?\"true\":\"false\":e.value),(e=r)!==n&&(t.setValue(e),!0)}var He=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;He.hasOwnProperty(\"ReactCurrentDispatcher\")||(He.ReactCurrentDispatcher={current:null});var $e=/^(.*)[\\\\\\/]/,Qe=\"function\"===typeof Symbol&&Symbol.for,Ke=Qe?Symbol.for(\"react.element\"):60103,qe=Qe?Symbol.for(\"react.portal\"):60106,Ye=Qe?Symbol.for(\"react.fragment\"):60107,Xe=Qe?Symbol.for(\"react.strict_mode\"):60108,Ge=Qe?Symbol.for(\"react.profiler\"):60114,Je=Qe?Symbol.for(\"react.provider\"):60109,Ze=Qe?Symbol.for(\"react.context\"):60110,et=Qe?Symbol.for(\"react.concurrent_mode\"):60111,tt=Qe?Symbol.for(\"react.forward_ref\"):60112,nt=Qe?Symbol.for(\"react.suspense\"):60113,rt=Qe?Symbol.for(\"react.memo\"):60115,it=Qe?Symbol.for(\"react.lazy\"):60116,lt=\"function\"===typeof Symbol&&Symbol.iterator;function ot(e){return null===e||\"object\"!==typeof e?null:\"function\"===typeof(e=lt&&e[lt]||e[\"@@iterator\"])?e:null}function at(e){if(null==e)return null;if(\"function\"===typeof e)return e.displayName||e.name||null;if(\"string\"===typeof e)return e;switch(e){case et:return\"ConcurrentMode\";case Ye:return\"Fragment\";case qe:return\"Portal\";case Ge:return\"Profiler\";case Xe:return\"StrictMode\";case nt:return\"Suspense\"}if(\"object\"===typeof e)switch(e.$$typeof){case Ze:return\"Context.Consumer\";case Je:return\"Context.Provider\";case tt:var t=e.render;return t=t.displayName||t.name||\"\",e.displayName||(\"\"!==t?\"ForwardRef(\"+t+\")\":\"ForwardRef\");case rt:return at(e.type);case it:if(e=1===e._status?e._result:null)return at(e)}return null}function ut(e){var t=\"\";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n=\"\";break e;default:var r=e._debugOwner,i=e._debugSource,l=at(e.type);n=null,r&&(n=at(r.type)),r=l,l=\"\",i?l=\" (at \"+i.fileName.replace($e,\"\")+\":\"+i.lineNumber+\")\":n&&(l=\" (created by \"+n+\")\"),n=\"\\n    in \"+(r||\"Unknown\")+l}t+=n,e=e.return}while(e);return t}var ct=/^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$/,st=Object.prototype.hasOwnProperty,ft={},dt={};function pt(e,t,n,r,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t}var mt={};\"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style\".split(\" \").forEach(function(e){mt[e]=new pt(e,0,!1,e,null)}),[[\"acceptCharset\",\"accept-charset\"],[\"className\",\"class\"],[\"htmlFor\",\"for\"],[\"httpEquiv\",\"http-equiv\"]].forEach(function(e){var t=e[0];mt[t]=new pt(t,1,!1,e[1],null)}),[\"contentEditable\",\"draggable\",\"spellCheck\",\"value\"].forEach(function(e){mt[e]=new pt(e,2,!1,e.toLowerCase(),null)}),[\"autoReverse\",\"externalResourcesRequired\",\"focusable\",\"preserveAlpha\"].forEach(function(e){mt[e]=new pt(e,2,!1,e,null)}),\"allowFullScreen async autoFocus autoPlay controls default defer disabled formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope\".split(\" \").forEach(function(e){mt[e]=new pt(e,3,!1,e.toLowerCase(),null)}),[\"checked\",\"multiple\",\"muted\",\"selected\"].forEach(function(e){mt[e]=new pt(e,3,!0,e,null)}),[\"capture\",\"download\"].forEach(function(e){mt[e]=new pt(e,4,!1,e,null)}),[\"cols\",\"rows\",\"size\",\"span\"].forEach(function(e){mt[e]=new pt(e,6,!1,e,null)}),[\"rowSpan\",\"start\"].forEach(function(e){mt[e]=new pt(e,5,!1,e.toLowerCase(),null)});var ht=/[\\-:]([a-z])/g;function vt(e){return e[1].toUpperCase()}function yt(e,t,n,r){var i=mt.hasOwnProperty(t)?mt[t]:null;(null!==i?0===i.type:!r&&(2<t.length&&(\"o\"===t[0]||\"O\"===t[0])&&(\"n\"===t[1]||\"N\"===t[1])))||(function(e,t,n,r){if(null===t||\"undefined\"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case\"function\":case\"symbol\":return!0;case\"boolean\":return!r&&(null!==n?!n.acceptsBooleans:\"data-\"!==(e=e.toLowerCase().slice(0,5))&&\"aria-\"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!st.call(dt,e)||!st.call(ft,e)&&(ct.test(e)?dt[e]=!0:(ft[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,\"\"+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&\"\":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?\"\":\"\"+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}function gt(e){switch(typeof e){case\"boolean\":case\"number\":case\"object\":case\"string\":case\"undefined\":return e;default:return\"\"}}function bt(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function wt(e,t){var n=null==t.defaultValue?\"\":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=gt(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:\"checkbox\"===t.type||\"radio\"===t.type?null!=t.checked:null!=t.value}}function kt(e,t){null!=(t=t.checked)&&yt(e,\"checked\",t,!1)}function xt(e,t){kt(e,t);var n=gt(t.value),r=t.type;if(null!=n)\"number\"===r?(0===n&&\"\"===e.value||e.value!=n)&&(e.value=\"\"+n):e.value!==\"\"+n&&(e.value=\"\"+n);else if(\"submit\"===r||\"reset\"===r)return void e.removeAttribute(\"value\");t.hasOwnProperty(\"value\")?_t(e,t.type,n):t.hasOwnProperty(\"defaultValue\")&&_t(e,t.type,gt(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Tt(e,t,n){if(t.hasOwnProperty(\"value\")||t.hasOwnProperty(\"defaultValue\")){var r=t.type;if(!(\"submit\"!==r&&\"reset\"!==r||void 0!==t.value&&null!==t.value))return;t=\"\"+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}\"\"!==(n=e.name)&&(e.name=\"\"),e.defaultChecked=!e.defaultChecked,e.defaultChecked=!!e._wrapperState.initialChecked,\"\"!==n&&(e.name=n)}function _t(e,t,n){\"number\"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=\"\"+e._wrapperState.initialValue:e.defaultValue!==\"\"+n&&(e.defaultValue=\"\"+n))}\"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height\".split(\" \").forEach(function(e){var t=e.replace(ht,vt);mt[t]=new pt(t,1,!1,e,null)}),\"xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type\".split(\" \").forEach(function(e){var t=e.replace(ht,vt);mt[t]=new pt(t,1,!1,e,\"http://www.w3.org/1999/xlink\")}),[\"xml:base\",\"xml:lang\",\"xml:space\"].forEach(function(e){var t=e.replace(ht,vt);mt[t]=new pt(t,1,!1,e,\"http://www.w3.org/XML/1998/namespace\")}),[\"tabIndex\",\"crossOrigin\"].forEach(function(e){mt[e]=new pt(e,1,!1,e.toLowerCase(),null)});var St={change:{phasedRegistrationNames:{bubbled:\"onChange\",captured:\"onChangeCapture\"},dependencies:\"blur change click focus input keydown keyup selectionchange\".split(\" \")}};function Et(e,t,n){return(e=ue.getPooled(St.change,e,t,n)).type=\"change\",Oe(n),H(e),e}var Ct=null,Pt=null;function Nt(e){R(e)}function Ot(e){if(Be(F(e)))return e}function Rt(e,t){if(\"change\"===e)return t}var Lt=!1;function Mt(){Ct&&(Ct.detachEvent(\"onpropertychange\",zt),Pt=Ct=null)}function zt(e){\"value\"===e.propertyName&&Ot(Pt)&&Ue(Nt,e=Et(Pt,e,Ae(e)))}function It(e,t,n){\"focus\"===e?(Mt(),Pt=n,(Ct=t).attachEvent(\"onpropertychange\",zt)):\"blur\"===e&&Mt()}function Ut(e){if(\"selectionchange\"===e||\"keyup\"===e||\"keydown\"===e)return Ot(Pt)}function Ft(e,t){if(\"click\"===e)return Ot(t)}function Dt(e,t){if(\"input\"===e||\"change\"===e)return Ot(t)}$&&(Lt=je(\"input\")&&(!document.documentMode||9<document.documentMode));var At={eventTypes:St,_isInputEventSupported:Lt,extractEvents:function(e,t,n,r){var i=t?F(t):window,l=void 0,o=void 0,a=i.nodeName&&i.nodeName.toLowerCase();if(\"select\"===a||\"input\"===a&&\"file\"===i.type?l=Rt:De(i)?Lt?l=Dt:(l=Ut,o=It):(a=i.nodeName)&&\"input\"===a.toLowerCase()&&(\"checkbox\"===i.type||\"radio\"===i.type)&&(l=Ft),l&&(l=l(e,t)))return Et(l,n,r);o&&o(e,i,t),\"blur\"===e&&(e=i._wrapperState)&&e.controlled&&\"number\"===i.type&&_t(i,\"number\",i.value)}},jt=ue.extend({view:null,detail:null}),Wt={Alt:\"altKey\",Control:\"ctrlKey\",Meta:\"metaKey\",Shift:\"shiftKey\"};function Vt(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Wt[e])&&!!t[e]}function Bt(){return Vt}var Ht=0,$t=0,Qt=!1,Kt=!1,qt=jt.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Bt,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if(\"movementX\"in e)return e.movementX;var t=Ht;return Ht=e.screenX,Qt?\"mousemove\"===e.type?e.screenX-t:0:(Qt=!0,0)},movementY:function(e){if(\"movementY\"in e)return e.movementY;var t=$t;return $t=e.screenY,Kt?\"mousemove\"===e.type?e.screenY-t:0:(Kt=!0,0)}}),Yt=qt.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Xt={mouseEnter:{registrationName:\"onMouseEnter\",dependencies:[\"mouseout\",\"mouseover\"]},mouseLeave:{registrationName:\"onMouseLeave\",dependencies:[\"mouseout\",\"mouseover\"]},pointerEnter:{registrationName:\"onPointerEnter\",dependencies:[\"pointerout\",\"pointerover\"]},pointerLeave:{registrationName:\"onPointerLeave\",dependencies:[\"pointerout\",\"pointerover\"]}},Gt={eventTypes:Xt,extractEvents:function(e,t,n,r){var i=\"mouseover\"===e||\"pointerover\"===e,l=\"mouseout\"===e||\"pointerout\"===e;if(i&&(n.relatedTarget||n.fromElement)||!l&&!i)return null;if(i=r.window===r?r:(i=r.ownerDocument)?i.defaultView||i.parentWindow:window,l?(l=t,t=(t=n.relatedTarget||n.toElement)?I(t):null):l=null,l===t)return null;var o=void 0,a=void 0,u=void 0,c=void 0;\"mouseout\"===e||\"mouseover\"===e?(o=qt,a=Xt.mouseLeave,u=Xt.mouseEnter,c=\"mouse\"):\"pointerout\"!==e&&\"pointerover\"!==e||(o=Yt,a=Xt.pointerLeave,u=Xt.pointerEnter,c=\"pointer\");var s=null==l?i:F(l);if(i=null==t?i:F(t),(e=o.getPooled(a,l,n,r)).type=c+\"leave\",e.target=s,e.relatedTarget=i,(n=o.getPooled(u,t,n,r)).type=c+\"enter\",n.target=i,n.relatedTarget=s,r=t,l&&r)e:{for(i=r,c=0,o=t=l;o;o=A(o))c++;for(o=0,u=i;u;u=A(u))o++;for(;0<c-o;)t=A(t),c--;for(;0<o-c;)i=A(i),o--;for(;c--;){if(t===i||t===i.alternate)break e;t=A(t),i=A(i)}t=null}else t=null;for(i=t,t=[];l&&l!==i&&(null===(c=l.alternate)||c!==i);)t.push(l),l=A(l);for(l=[];r&&r!==i&&(null===(c=r.alternate)||c!==i);)l.push(r),r=A(r);for(r=0;r<t.length;r++)V(t[r],\"bubbled\",e);for(r=l.length;0<r--;)V(l[r],\"captured\",n);return[e,n]}};function Jt(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t}var Zt=Object.prototype.hasOwnProperty;function en(e,t){if(Jt(e,t))return!0;if(\"object\"!==typeof e||null===e||\"object\"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!Zt.call(t,n[r])||!Jt(e[n[r]],t[n[r]]))return!1;return!0}function tn(e){var t=e;if(e.alternate)for(;t.return;)t=t.return;else{if(0!==(2&t.effectTag))return 1;for(;t.return;)if(0!==(2&(t=t.return).effectTag))return 1}return 3===t.tag?2:3}function nn(e){2!==tn(e)&&o(\"188\")}function rn(e){if(!(e=function(e){var t=e.alternate;if(!t)return 3===(t=tn(e))&&o(\"188\"),1===t?null:e;for(var n=e,r=t;;){var i=n.return,l=i?i.alternate:null;if(!i||!l)break;if(i.child===l.child){for(var a=i.child;a;){if(a===n)return nn(i),e;if(a===r)return nn(i),t;a=a.sibling}o(\"188\")}if(n.return!==r.return)n=i,r=l;else{a=!1;for(var u=i.child;u;){if(u===n){a=!0,n=i,r=l;break}if(u===r){a=!0,r=i,n=l;break}u=u.sibling}if(!a){for(u=l.child;u;){if(u===n){a=!0,n=l,r=i;break}if(u===r){a=!0,r=l,n=i;break}u=u.sibling}a||o(\"189\")}}n.alternate!==r&&o(\"190\")}return 3!==n.tag&&o(\"188\"),n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}var ln=ue.extend({animationName:null,elapsedTime:null,pseudoElement:null}),on=ue.extend({clipboardData:function(e){return\"clipboardData\"in e?e.clipboardData:window.clipboardData}}),an=jt.extend({relatedTarget:null});function un(e){var t=e.keyCode;return\"charCode\"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var cn={Esc:\"Escape\",Spacebar:\" \",Left:\"ArrowLeft\",Up:\"ArrowUp\",Right:\"ArrowRight\",Down:\"ArrowDown\",Del:\"Delete\",Win:\"OS\",Menu:\"ContextMenu\",Apps:\"ContextMenu\",Scroll:\"ScrollLock\",MozPrintableKey:\"Unidentified\"},sn={8:\"Backspace\",9:\"Tab\",12:\"Clear\",13:\"Enter\",16:\"Shift\",17:\"Control\",18:\"Alt\",19:\"Pause\",20:\"CapsLock\",27:\"Escape\",32:\" \",33:\"PageUp\",34:\"PageDown\",35:\"End\",36:\"Home\",37:\"ArrowLeft\",38:\"ArrowUp\",39:\"ArrowRight\",40:\"ArrowDown\",45:\"Insert\",46:\"Delete\",112:\"F1\",113:\"F2\",114:\"F3\",115:\"F4\",116:\"F5\",117:\"F6\",118:\"F7\",119:\"F8\",120:\"F9\",121:\"F10\",122:\"F11\",123:\"F12\",144:\"NumLock\",145:\"ScrollLock\",224:\"Meta\"},fn=jt.extend({key:function(e){if(e.key){var t=cn[e.key]||e.key;if(\"Unidentified\"!==t)return t}return\"keypress\"===e.type?13===(e=un(e))?\"Enter\":String.fromCharCode(e):\"keydown\"===e.type||\"keyup\"===e.type?sn[e.keyCode]||\"Unidentified\":\"\"},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Bt,charCode:function(e){return\"keypress\"===e.type?un(e):0},keyCode:function(e){return\"keydown\"===e.type||\"keyup\"===e.type?e.keyCode:0},which:function(e){return\"keypress\"===e.type?un(e):\"keydown\"===e.type||\"keyup\"===e.type?e.keyCode:0}}),dn=qt.extend({dataTransfer:null}),pn=jt.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Bt}),mn=ue.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),hn=qt.extend({deltaX:function(e){return\"deltaX\"in e?e.deltaX:\"wheelDeltaX\"in e?-e.wheelDeltaX:0},deltaY:function(e){return\"deltaY\"in e?e.deltaY:\"wheelDeltaY\"in e?-e.wheelDeltaY:\"wheelDelta\"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),vn=[[\"abort\",\"abort\"],[G,\"animationEnd\"],[J,\"animationIteration\"],[Z,\"animationStart\"],[\"canplay\",\"canPlay\"],[\"canplaythrough\",\"canPlayThrough\"],[\"drag\",\"drag\"],[\"dragenter\",\"dragEnter\"],[\"dragexit\",\"dragExit\"],[\"dragleave\",\"dragLeave\"],[\"dragover\",\"dragOver\"],[\"durationchange\",\"durationChange\"],[\"emptied\",\"emptied\"],[\"encrypted\",\"encrypted\"],[\"ended\",\"ended\"],[\"error\",\"error\"],[\"gotpointercapture\",\"gotPointerCapture\"],[\"load\",\"load\"],[\"loadeddata\",\"loadedData\"],[\"loadedmetadata\",\"loadedMetadata\"],[\"loadstart\",\"loadStart\"],[\"lostpointercapture\",\"lostPointerCapture\"],[\"mousemove\",\"mouseMove\"],[\"mouseout\",\"mouseOut\"],[\"mouseover\",\"mouseOver\"],[\"playing\",\"playing\"],[\"pointermove\",\"pointerMove\"],[\"pointerout\",\"pointerOut\"],[\"pointerover\",\"pointerOver\"],[\"progress\",\"progress\"],[\"scroll\",\"scroll\"],[\"seeking\",\"seeking\"],[\"stalled\",\"stalled\"],[\"suspend\",\"suspend\"],[\"timeupdate\",\"timeUpdate\"],[\"toggle\",\"toggle\"],[\"touchmove\",\"touchMove\"],[ee,\"transitionEnd\"],[\"waiting\",\"waiting\"],[\"wheel\",\"wheel\"]],yn={},gn={};function bn(e,t){var n=e[0],r=\"on\"+((e=e[1])[0].toUpperCase()+e.slice(1));t={phasedRegistrationNames:{bubbled:r,captured:r+\"Capture\"},dependencies:[n],isInteractive:t},yn[e]=t,gn[n]=t}[[\"blur\",\"blur\"],[\"cancel\",\"cancel\"],[\"click\",\"click\"],[\"close\",\"close\"],[\"contextmenu\",\"contextMenu\"],[\"copy\",\"copy\"],[\"cut\",\"cut\"],[\"auxclick\",\"auxClick\"],[\"dblclick\",\"doubleClick\"],[\"dragend\",\"dragEnd\"],[\"dragstart\",\"dragStart\"],[\"drop\",\"drop\"],[\"focus\",\"focus\"],[\"input\",\"input\"],[\"invalid\",\"invalid\"],[\"keydown\",\"keyDown\"],[\"keypress\",\"keyPress\"],[\"keyup\",\"keyUp\"],[\"mousedown\",\"mouseDown\"],[\"mouseup\",\"mouseUp\"],[\"paste\",\"paste\"],[\"pause\",\"pause\"],[\"play\",\"play\"],[\"pointercancel\",\"pointerCancel\"],[\"pointerdown\",\"pointerDown\"],[\"pointerup\",\"pointerUp\"],[\"ratechange\",\"rateChange\"],[\"reset\",\"reset\"],[\"seeked\",\"seeked\"],[\"submit\",\"submit\"],[\"touchcancel\",\"touchCancel\"],[\"touchend\",\"touchEnd\"],[\"touchstart\",\"touchStart\"],[\"volumechange\",\"volumeChange\"]].forEach(function(e){bn(e,!0)}),vn.forEach(function(e){bn(e,!1)});var wn={eventTypes:yn,isInteractiveTopLevelEventType:function(e){return void 0!==(e=gn[e])&&!0===e.isInteractive},extractEvents:function(e,t,n,r){var i=gn[e];if(!i)return null;switch(e){case\"keypress\":if(0===un(n))return null;case\"keydown\":case\"keyup\":e=fn;break;case\"blur\":case\"focus\":e=an;break;case\"click\":if(2===n.button)return null;case\"auxclick\":case\"dblclick\":case\"mousedown\":case\"mousemove\":case\"mouseup\":case\"mouseout\":case\"mouseover\":case\"contextmenu\":e=qt;break;case\"drag\":case\"dragend\":case\"dragenter\":case\"dragexit\":case\"dragleave\":case\"dragover\":case\"dragstart\":case\"drop\":e=dn;break;case\"touchcancel\":case\"touchend\":case\"touchmove\":case\"touchstart\":e=pn;break;case G:case J:case Z:e=ln;break;case ee:e=mn;break;case\"scroll\":e=jt;break;case\"wheel\":e=hn;break;case\"copy\":case\"cut\":case\"paste\":e=on;break;case\"gotpointercapture\":case\"lostpointercapture\":case\"pointercancel\":case\"pointerdown\":case\"pointermove\":case\"pointerout\":case\"pointerover\":case\"pointerup\":e=Yt;break;default:e=ue}return H(t=e.getPooled(i,t,n,r)),t}},kn=wn.isInteractiveTopLevelEventType,xn=[];function Tn(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var r;for(r=n;r.return;)r=r.return;if(!(r=3!==r.tag?null:r.stateNode.containerInfo))break;e.ancestors.push(n),n=I(r)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var i=Ae(e.nativeEvent);r=e.topLevelType;for(var l=e.nativeEvent,o=null,a=0;a<y.length;a++){var u=y[a];u&&(u=u.extractEvents(r,t,l,i))&&(o=S(o,u))}R(o)}}var _n=!0;function Sn(e,t){if(!t)return null;var n=(kn(e)?Cn:Pn).bind(null,e);t.addEventListener(e,n,!1)}function En(e,t){if(!t)return null;var n=(kn(e)?Cn:Pn).bind(null,e);t.addEventListener(e,n,!0)}function Cn(e,t){Me(Pn,e,t)}function Pn(e,t){if(_n){var n=Ae(t);if(null===(n=I(n))||\"number\"!==typeof n.tag||2===tn(n)||(n=null),xn.length){var r=xn.pop();r.topLevelType=e,r.nativeEvent=t,r.targetInst=n,e=r}else e={topLevelType:e,nativeEvent:t,targetInst:n,ancestors:[]};try{Ue(Tn,e)}finally{e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>xn.length&&xn.push(e)}}}var Nn={},On=0,Rn=\"_reactListenersID\"+(\"\"+Math.random()).slice(2);function Ln(e){return Object.prototype.hasOwnProperty.call(e,Rn)||(e[Rn]=On++,Nn[e[Rn]]={}),Nn[e[Rn]]}function Mn(e){if(\"undefined\"===typeof(e=e||(\"undefined\"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function zn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function In(e,t){var n,r=zn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=zn(r)}}function Un(){for(var e=window,t=Mn();t instanceof e.HTMLIFrameElement;){try{e=t.contentDocument.defaultView}catch(n){break}t=Mn(e.document)}return t}function Fn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(\"input\"===t&&(\"text\"===e.type||\"search\"===e.type||\"tel\"===e.type||\"url\"===e.type||\"password\"===e.type)||\"textarea\"===t||\"true\"===e.contentEditable)}function Dn(e){var t=Un(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&function e(t,n){return!(!t||!n)&&(t===n||(!t||3!==t.nodeType)&&(n&&3===n.nodeType?e(t,n.parentNode):\"contains\"in t?t.contains(n):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(n))))}(n.ownerDocument.documentElement,n)){if(null!==r&&Fn(n))if(t=r.start,void 0===(e=r.end)&&(e=t),\"selectionStart\"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,l=Math.min(r.start,i);r=void 0===r.end?l:Math.min(r.end,i),!e.extend&&l>r&&(i=r,r=l,l=i),i=In(n,l);var o=In(n,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),l>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(\"function\"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var An=$&&\"documentMode\"in document&&11>=document.documentMode,jn={select:{phasedRegistrationNames:{bubbled:\"onSelect\",captured:\"onSelectCapture\"},dependencies:\"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange\".split(\" \")}},Wn=null,Vn=null,Bn=null,Hn=!1;function $n(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return Hn||null==Wn||Wn!==Mn(n)?null:(\"selectionStart\"in(n=Wn)&&Fn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Bn&&en(Bn,n)?null:(Bn=n,(e=ue.getPooled(jn.select,Vn,e,t)).type=\"select\",e.target=Wn,H(e),e))}var Qn={eventTypes:jn,extractEvents:function(e,t,n,r){var i,l=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;if(!(i=!l)){e:{l=Ln(l),i=w.onSelect;for(var o=0;o<i.length;o++){var a=i[o];if(!l.hasOwnProperty(a)||!l[a]){l=!1;break e}}l=!0}i=!l}if(i)return null;switch(l=t?F(t):window,e){case\"focus\":(De(l)||\"true\"===l.contentEditable)&&(Wn=l,Vn=t,Bn=null);break;case\"blur\":Bn=Vn=Wn=null;break;case\"mousedown\":Hn=!0;break;case\"contextmenu\":case\"mouseup\":case\"dragend\":return Hn=!1,$n(n,r);case\"selectionchange\":if(An)break;case\"keydown\":case\"keyup\":return $n(n,r)}return null}};function Kn(e,t){return e=i({children:void 0},t),(t=function(e){var t=\"\";return r.Children.forEach(e,function(e){null!=e&&(t+=e)}),t}(t.children))&&(e.children=t),e}function qn(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t[\"$\"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty(\"$\"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=\"\"+gt(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function Yn(e,t){return null!=t.dangerouslySetInnerHTML&&o(\"91\"),i({},t,{value:void 0,defaultValue:void 0,children:\"\"+e._wrapperState.initialValue})}function Xn(e,t){var n=t.value;null==n&&(n=t.defaultValue,null!=(t=t.children)&&(null!=n&&o(\"92\"),Array.isArray(t)&&(1>=t.length||o(\"93\"),t=t[0]),n=t),null==n&&(n=\"\")),e._wrapperState={initialValue:gt(n)}}function Gn(e,t){var n=gt(t.value),r=gt(t.defaultValue);null!=n&&((n=\"\"+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=\"\"+r)}function Jn(e){var t=e.textContent;t===e._wrapperState.initialValue&&(e.value=t)}N.injectEventPluginOrder(\"ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin\".split(\" \")),k=D,x=U,T=F,N.injectEventPluginsByName({SimpleEventPlugin:wn,EnterLeaveEventPlugin:Gt,ChangeEventPlugin:At,SelectEventPlugin:Qn,BeforeInputEventPlugin:Se});var Zn={html:\"http://www.w3.org/1999/xhtml\",mathml:\"http://www.w3.org/1998/Math/MathML\",svg:\"http://www.w3.org/2000/svg\"};function er(e){switch(e){case\"svg\":return\"http://www.w3.org/2000/svg\";case\"math\":return\"http://www.w3.org/1998/Math/MathML\";default:return\"http://www.w3.org/1999/xhtml\"}}function tr(e,t){return null==e||\"http://www.w3.org/1999/xhtml\"===e?er(t):\"http://www.w3.org/2000/svg\"===e&&\"foreignObject\"===t?\"http://www.w3.org/1999/xhtml\":e}var nr,rr=void 0,ir=(nr=function(e,t){if(e.namespaceURI!==Zn.svg||\"innerHTML\"in e)e.innerHTML=t;else{for((rr=rr||document.createElement(\"div\")).innerHTML=\"<svg>\"+t+\"</svg>\",t=rr.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},\"undefined\"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return nr(e,t)})}:nr);function lr(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var or={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ar=[\"Webkit\",\"ms\",\"Moz\",\"O\"];function ur(e,t,n){return null==t||\"boolean\"===typeof t||\"\"===t?\"\":n||\"number\"!==typeof t||0===t||or.hasOwnProperty(e)&&or[e]?(\"\"+t).trim():t+\"px\"}function cr(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf(\"--\"),i=ur(n,t[n],r);\"float\"===n&&(n=\"cssFloat\"),r?e.setProperty(n,i):e[n]=i}}Object.keys(or).forEach(function(e){ar.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),or[t]=or[e]})});var sr=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fr(e,t){t&&(sr[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML)&&o(\"137\",e,\"\"),null!=t.dangerouslySetInnerHTML&&(null!=t.children&&o(\"60\"),\"object\"===typeof t.dangerouslySetInnerHTML&&\"__html\"in t.dangerouslySetInnerHTML||o(\"61\")),null!=t.style&&\"object\"!==typeof t.style&&o(\"62\",\"\"))}function dr(e,t){if(-1===e.indexOf(\"-\"))return\"string\"===typeof t.is;switch(e){case\"annotation-xml\":case\"color-profile\":case\"font-face\":case\"font-face-src\":case\"font-face-uri\":case\"font-face-format\":case\"font-face-name\":case\"missing-glyph\":return!1;default:return!0}}function pr(e,t){var n=Ln(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=w[t];for(var r=0;r<t.length;r++){var i=t[r];if(!n.hasOwnProperty(i)||!n[i]){switch(i){case\"scroll\":En(\"scroll\",e);break;case\"focus\":case\"blur\":En(\"focus\",e),En(\"blur\",e),n.blur=!0,n.focus=!0;break;case\"cancel\":case\"close\":je(i)&&En(i,e);break;case\"invalid\":case\"submit\":case\"reset\":break;default:-1===te.indexOf(i)&&Sn(i,e)}n[i]=!0}}}function mr(){}var hr=null,vr=null;function yr(e,t){switch(e){case\"button\":case\"input\":case\"select\":case\"textarea\":return!!t.autoFocus}return!1}function gr(e,t){return\"textarea\"===e||\"option\"===e||\"noscript\"===e||\"string\"===typeof t.children||\"number\"===typeof t.children||\"object\"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var br=\"function\"===typeof setTimeout?setTimeout:void 0,wr=\"function\"===typeof clearTimeout?clearTimeout:void 0,kr=l.unstable_scheduleCallback,xr=l.unstable_cancelCallback;function Tr(e){for(e=e.nextSibling;e&&1!==e.nodeType&&3!==e.nodeType;)e=e.nextSibling;return e}function _r(e){for(e=e.firstChild;e&&1!==e.nodeType&&3!==e.nodeType;)e=e.nextSibling;return e}new Set;var Sr=[],Er=-1;function Cr(e){0>Er||(e.current=Sr[Er],Sr[Er]=null,Er--)}function Pr(e,t){Sr[++Er]=e.current,e.current=t}var Nr={},Or={current:Nr},Rr={current:!1},Lr=Nr;function Mr(e,t){var n=e.type.contextTypes;if(!n)return Nr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,l={};for(i in n)l[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=l),l}function zr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ir(e){Cr(Rr),Cr(Or)}function Ur(e){Cr(Rr),Cr(Or)}function Fr(e,t,n){Or.current!==Nr&&o(\"168\"),Pr(Or,t),Pr(Rr,n)}function Dr(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,\"function\"!==typeof r.getChildContext)return n;for(var l in r=r.getChildContext())l in e||o(\"108\",at(t)||\"Unknown\",l);return i({},n,r)}function Ar(e){var t=e.stateNode;return t=t&&t.__reactInternalMemoizedMergedChildContext||Nr,Lr=Or.current,Pr(Or,t),Pr(Rr,Rr.current),!0}function jr(e,t,n){var r=e.stateNode;r||o(\"169\"),n?(t=Dr(e,t,Lr),r.__reactInternalMemoizedMergedChildContext=t,Cr(Rr),Cr(Or),Pr(Or,t)):Cr(Rr),Pr(Rr,n)}var Wr=null,Vr=null;function Br(e){return function(t){try{return e(t)}catch(n){}}}function Hr(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.contextDependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function $r(e,t,n,r){return new Hr(e,t,n,r)}function Qr(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Kr(e,t){var n=e.alternate;return null===n?((n=$r(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,n.contextDependencies=e.contextDependencies,n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function qr(e,t,n,r,i,l){var a=2;if(r=e,\"function\"===typeof e)Qr(e)&&(a=1);else if(\"string\"===typeof e)a=5;else e:switch(e){case Ye:return Yr(n.children,i,l,t);case et:return Xr(n,3|i,l,t);case Xe:return Xr(n,2|i,l,t);case Ge:return(e=$r(12,n,t,4|i)).elementType=Ge,e.type=Ge,e.expirationTime=l,e;case nt:return(e=$r(13,n,t,i)).elementType=nt,e.type=nt,e.expirationTime=l,e;default:if(\"object\"===typeof e&&null!==e)switch(e.$$typeof){case Je:a=10;break e;case Ze:a=9;break e;case tt:a=11;break e;case rt:a=14;break e;case it:a=16,r=null;break e}o(\"130\",null==e?e:typeof e,\"\")}return(t=$r(a,n,t,i)).elementType=e,t.type=r,t.expirationTime=l,t}function Yr(e,t,n,r){return(e=$r(7,e,r,t)).expirationTime=n,e}function Xr(e,t,n,r){return e=$r(8,e,r,t),t=0===(1&t)?Xe:et,e.elementType=t,e.type=t,e.expirationTime=n,e}function Gr(e,t,n){return(e=$r(6,e,null,t)).expirationTime=n,e}function Jr(e,t,n){return(t=$r(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Zr(e,t){e.didError=!1;var n=e.earliestPendingTime;0===n?e.earliestPendingTime=e.latestPendingTime=t:n<t?e.earliestPendingTime=t:e.latestPendingTime>t&&(e.latestPendingTime=t),ni(t,e)}function ei(e,t){e.didError=!1,e.latestPingedTime>=t&&(e.latestPingedTime=0);var n=e.earliestPendingTime,r=e.latestPendingTime;n===t?e.earliestPendingTime=r===t?e.latestPendingTime=0:r:r===t&&(e.latestPendingTime=n),n=e.earliestSuspendedTime,r=e.latestSuspendedTime,0===n?e.earliestSuspendedTime=e.latestSuspendedTime=t:n<t?e.earliestSuspendedTime=t:r>t&&(e.latestSuspendedTime=t),ni(t,e)}function ti(e,t){var n=e.earliestPendingTime;return n>t&&(t=n),(e=e.earliestSuspendedTime)>t&&(t=e),t}function ni(e,t){var n=t.earliestSuspendedTime,r=t.latestSuspendedTime,i=t.earliestPendingTime,l=t.latestPingedTime;0===(i=0!==i?i:l)&&(0===e||r<e)&&(i=r),0!==(e=i)&&n>e&&(e=n),t.nextExpirationTimeToWorkOn=i,t.expirationTime=e}function ri(e,t){if(e&&e.defaultProps)for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var ii=(new r.Component).refs;function li(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:i({},t,n),e.memoizedState=n,null!==(r=e.updateQueue)&&0===e.expirationTime&&(r.baseState=n)}var oi={isMounted:function(e){return!!(e=e._reactInternalFiber)&&2===tn(e)},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var r=xa(),i=Yl(r=Yo(r,e));i.payload=t,void 0!==n&&null!==n&&(i.callback=n),Bo(),Gl(e,i),Jo(e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var r=xa(),i=Yl(r=Yo(r,e));i.tag=Bl,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),Bo(),Gl(e,i),Jo(e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=xa(),r=Yl(n=Yo(n,e));r.tag=Hl,void 0!==t&&null!==t&&(r.callback=t),Bo(),Gl(e,r),Jo(e,n)}};function ai(e,t,n,r,i,l,o){return\"function\"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,l,o):!t.prototype||!t.prototype.isPureReactComponent||(!en(n,r)||!en(i,l))}function ui(e,t,n){var r=!1,i=Nr,l=t.contextType;return\"object\"===typeof l&&null!==l?l=Wl(l):(i=zr(t)?Lr:Or.current,l=(r=null!==(r=t.contextTypes)&&void 0!==r)?Mr(e,i):Nr),t=new t(n,l),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=oi,e.stateNode=t,t._reactInternalFiber=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=l),t}function ci(e,t,n,r){e=t.state,\"function\"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),\"function\"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&oi.enqueueReplaceState(t,t.state,null)}function si(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=ii;var l=t.contextType;\"object\"===typeof l&&null!==l?i.context=Wl(l):(l=zr(t)?Lr:Or.current,i.context=Mr(e,l)),null!==(l=e.updateQueue)&&(to(e,l,n,i,r),i.state=e.memoizedState),\"function\"===typeof(l=t.getDerivedStateFromProps)&&(li(e,t,l,n),i.state=e.memoizedState),\"function\"===typeof t.getDerivedStateFromProps||\"function\"===typeof i.getSnapshotBeforeUpdate||\"function\"!==typeof i.UNSAFE_componentWillMount&&\"function\"!==typeof i.componentWillMount||(t=i.state,\"function\"===typeof i.componentWillMount&&i.componentWillMount(),\"function\"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&oi.enqueueReplaceState(i,i.state,null),null!==(l=e.updateQueue)&&(to(e,l,n,i,r),i.state=e.memoizedState)),\"function\"===typeof i.componentDidMount&&(e.effectTag|=4)}var fi=Array.isArray;function di(e,t,n){if(null!==(e=n.ref)&&\"function\"!==typeof e&&\"object\"!==typeof e){if(n._owner){n=n._owner;var r=void 0;n&&(1!==n.tag&&o(\"309\"),r=n.stateNode),r||o(\"147\",e);var i=\"\"+e;return null!==t&&null!==t.ref&&\"function\"===typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=r.refs;t===ii&&(t=r.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}\"string\"!==typeof e&&o(\"284\"),n._owner||o(\"290\",e)}return e}function pi(e,t){\"textarea\"!==e.type&&o(\"31\",\"[object Object]\"===Object.prototype.toString.call(t)?\"object with keys {\"+Object.keys(t).join(\", \")+\"}\":t,\"\")}function mi(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t,n){return(e=Kr(e,t)).index=0,e.sibling=null,e}function l(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.effectTag=2,n):r:(t.effectTag=2,n):n}function a(t){return e&&null===t.alternate&&(t.effectTag=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Gr(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=di(e,t,n),r.return=e,r):((r=qr(n.type,n.key,n.props,null,e.mode,r)).ref=di(e,t,n),r.return=e,r)}function s(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Jr(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function f(e,t,n,r,l){return null===t||7!==t.tag?((t=Yr(n,e.mode,r,l)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if(\"string\"===typeof t||\"number\"===typeof t)return(t=Gr(\"\"+t,e.mode,n)).return=e,t;if(\"object\"===typeof t&&null!==t){switch(t.$$typeof){case Ke:return(n=qr(t.type,t.key,t.props,null,e.mode,n)).ref=di(e,null,t),n.return=e,n;case qe:return(t=Jr(t,e.mode,n)).return=e,t}if(fi(t)||ot(t))return(t=Yr(t,e.mode,n,null)).return=e,t;pi(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if(\"string\"===typeof n||\"number\"===typeof n)return null!==i?null:u(e,t,\"\"+n,r);if(\"object\"===typeof n&&null!==n){switch(n.$$typeof){case Ke:return n.key===i?n.type===Ye?f(e,t,n.props.children,r,i):c(e,t,n,r):null;case qe:return n.key===i?s(e,t,n,r):null}if(fi(n)||ot(n))return null!==i?null:f(e,t,n,r,null);pi(e,n)}return null}function m(e,t,n,r,i){if(\"string\"===typeof r||\"number\"===typeof r)return u(t,e=e.get(n)||null,\"\"+r,i);if(\"object\"===typeof r&&null!==r){switch(r.$$typeof){case Ke:return e=e.get(null===r.key?n:r.key)||null,r.type===Ye?f(t,e,r.props.children,i,r.key):c(t,e,r,i);case qe:return s(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(fi(r)||ot(r))return f(t,e=e.get(n)||null,r,i,null);pi(t,r)}return null}function h(i,o,a,u){for(var c=null,s=null,f=o,h=o=0,v=null;null!==f&&h<a.length;h++){f.index>h?(v=f,f=null):v=f.sibling;var y=p(i,f,a[h],u);if(null===y){null===f&&(f=v);break}e&&f&&null===y.alternate&&t(i,f),o=l(y,o,h),null===s?c=y:s.sibling=y,s=y,f=v}if(h===a.length)return n(i,f),c;if(null===f){for(;h<a.length;h++)(f=d(i,a[h],u))&&(o=l(f,o,h),null===s?c=f:s.sibling=f,s=f);return c}for(f=r(i,f);h<a.length;h++)(v=m(f,i,h,a[h],u))&&(e&&null!==v.alternate&&f.delete(null===v.key?h:v.key),o=l(v,o,h),null===s?c=v:s.sibling=v,s=v);return e&&f.forEach(function(e){return t(i,e)}),c}function v(i,a,u,c){var s=ot(u);\"function\"!==typeof s&&o(\"150\"),null==(u=s.call(u))&&o(\"151\");for(var f=s=null,h=a,v=a=0,y=null,g=u.next();null!==h&&!g.done;v++,g=u.next()){h.index>v?(y=h,h=null):y=h.sibling;var b=p(i,h,g.value,c);if(null===b){h||(h=y);break}e&&h&&null===b.alternate&&t(i,h),a=l(b,a,v),null===f?s=b:f.sibling=b,f=b,h=y}if(g.done)return n(i,h),s;if(null===h){for(;!g.done;v++,g=u.next())null!==(g=d(i,g.value,c))&&(a=l(g,a,v),null===f?s=g:f.sibling=g,f=g);return s}for(h=r(i,h);!g.done;v++,g=u.next())null!==(g=m(h,i,v,g.value,c))&&(e&&null!==g.alternate&&h.delete(null===g.key?v:g.key),a=l(g,a,v),null===f?s=g:f.sibling=g,f=g);return e&&h.forEach(function(e){return t(i,e)}),s}return function(e,r,l,u){var c=\"object\"===typeof l&&null!==l&&l.type===Ye&&null===l.key;c&&(l=l.props.children);var s=\"object\"===typeof l&&null!==l;if(s)switch(l.$$typeof){case Ke:e:{for(s=l.key,c=r;null!==c;){if(c.key===s){if(7===c.tag?l.type===Ye:c.elementType===l.type){n(e,c.sibling),(r=i(c,l.type===Ye?l.props.children:l.props)).ref=di(e,c,l),r.return=e,e=r;break e}n(e,c);break}t(e,c),c=c.sibling}l.type===Ye?((r=Yr(l.props.children,e.mode,u,l.key)).return=e,e=r):((u=qr(l.type,l.key,l.props,null,e.mode,u)).ref=di(e,r,l),u.return=e,e=u)}return a(e);case qe:e:{for(c=l.key;null!==r;){if(r.key===c){if(4===r.tag&&r.stateNode.containerInfo===l.containerInfo&&r.stateNode.implementation===l.implementation){n(e,r.sibling),(r=i(r,l.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Jr(l,e.mode,u)).return=e,e=r}return a(e)}if(\"string\"===typeof l||\"number\"===typeof l)return l=\"\"+l,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,l)).return=e,e=r):(n(e,r),(r=Gr(l,e.mode,u)).return=e,e=r),a(e);if(fi(l))return h(e,r,l,u);if(ot(l))return v(e,r,l,u);if(s&&pi(e,l),\"undefined\"===typeof l&&!c)switch(e.tag){case 1:case 0:o(\"152\",(u=e.type).displayName||u.name||\"Component\")}return n(e,r)}}var hi=mi(!0),vi=mi(!1),yi={},gi={current:yi},bi={current:yi},wi={current:yi};function ki(e){return e===yi&&o(\"174\"),e}function xi(e,t){Pr(wi,t),Pr(bi,e),Pr(gi,yi);var n=t.nodeType;switch(n){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:tr(null,\"\");break;default:t=tr(t=(n=8===n?t.parentNode:t).namespaceURI||null,n=n.tagName)}Cr(gi),Pr(gi,t)}function Ti(e){Cr(gi),Cr(bi),Cr(wi)}function _i(e){ki(wi.current);var t=ki(gi.current),n=tr(t,e.type);t!==n&&(Pr(bi,e),Pr(gi,n))}function Si(e){bi.current===e&&(Cr(gi),Cr(bi))}var Ei=0,Ci=2,Pi=4,Ni=8,Oi=16,Ri=32,Li=64,Mi=128,zi=He.ReactCurrentDispatcher,Ii=0,Ui=null,Fi=null,Di=null,Ai=null,ji=null,Wi=null,Vi=0,Bi=null,Hi=0,$i=!1,Qi=null,Ki=0;function qi(){o(\"307\")}function Yi(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Jt(e[n],t[n]))return!1;return!0}function Xi(e,t,n,r,i,l){if(Ii=l,Ui=t,Di=null!==e?e.memoizedState:null,zi.current=null===Di?cl:sl,t=n(r,i),$i){do{$i=!1,Ki+=1,Di=null!==e?e.memoizedState:null,Wi=Ai,Bi=ji=Fi=null,zi.current=sl,t=n(r,i)}while($i);Qi=null,Ki=0}return zi.current=ul,(e=Ui).memoizedState=Ai,e.expirationTime=Vi,e.updateQueue=Bi,e.effectTag|=Hi,e=null!==Fi&&null!==Fi.next,Ii=0,Wi=ji=Ai=Di=Fi=Ui=null,Vi=0,Bi=null,Hi=0,e&&o(\"300\"),t}function Gi(){zi.current=ul,Ii=0,Wi=ji=Ai=Di=Fi=Ui=null,Vi=0,Bi=null,Hi=0,$i=!1,Qi=null,Ki=0}function Ji(){var e={memoizedState:null,baseState:null,queue:null,baseUpdate:null,next:null};return null===ji?Ai=ji=e:ji=ji.next=e,ji}function Zi(){if(null!==Wi)Wi=(ji=Wi).next,Di=null!==(Fi=Di)?Fi.next:null;else{null===Di&&o(\"310\");var e={memoizedState:(Fi=Di).memoizedState,baseState:Fi.baseState,queue:Fi.queue,baseUpdate:Fi.baseUpdate,next:null};ji=null===ji?Ai=e:ji.next=e,Di=Fi.next}return ji}function el(e,t){return\"function\"===typeof t?t(e):t}function tl(e){var t=Zi(),n=t.queue;if(null===n&&o(\"311\"),0<Ki){var r=n.dispatch;if(null!==Qi){var i=Qi.get(n);if(void 0!==i){Qi.delete(n);var l=t.memoizedState;do{l=e(l,i.action),i=i.next}while(null!==i);return Jt(l,t.memoizedState)||(kl=!0),t.memoizedState=l,t.baseUpdate===n.last&&(t.baseState=l),[l,r]}}return[t.memoizedState,r]}r=n.last;var a=t.baseUpdate;if(l=t.baseState,null!==a?(null!==r&&(r.next=null),r=a.next):r=null!==r?r.next:null,null!==r){var u=i=null,c=r,s=!1;do{var f=c.expirationTime;f<Ii?(s||(s=!0,u=a,i=l),f>Vi&&(Vi=f)):l=c.eagerReducer===e?c.eagerState:e(l,c.action),a=c,c=c.next}while(null!==c&&c!==r);s||(u=a,i=l),Jt(l,t.memoizedState)||(kl=!0),t.memoizedState=l,t.baseUpdate=u,t.baseState=i,n.eagerReducer=e,n.eagerState=l}return[t.memoizedState,n.dispatch]}function nl(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===Bi?(Bi={lastEffect:null}).lastEffect=e.next=e:null===(t=Bi.lastEffect)?Bi.lastEffect=e.next=e:(n=t.next,t.next=e,e.next=n,Bi.lastEffect=e),e}function rl(e,t,n,r){var i=Ji();Hi|=e,i.memoizedState=nl(t,n,void 0,void 0===r?null:r)}function il(e,t,n,r){var i=Zi();r=void 0===r?null:r;var l=void 0;if(null!==Fi){var o=Fi.memoizedState;if(l=o.destroy,null!==r&&Yi(r,o.deps))return void nl(Ei,n,l,r)}Hi|=e,i.memoizedState=nl(t,n,l,r)}function ll(e,t){return\"function\"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function ol(){}function al(e,t,n){25>Ki||o(\"301\");var r=e.alternate;if(e===Ui||null!==r&&r===Ui)if($i=!0,e={expirationTime:Ii,action:n,eagerReducer:null,eagerState:null,next:null},null===Qi&&(Qi=new Map),void 0===(n=Qi.get(t)))Qi.set(t,e);else{for(t=n;null!==t.next;)t=t.next;t.next=e}else{Bo();var i=xa(),l={expirationTime:i=Yo(i,e),action:n,eagerReducer:null,eagerState:null,next:null},a=t.last;if(null===a)l.next=l;else{var u=a.next;null!==u&&(l.next=u),a.next=l}if(t.last=l,0===e.expirationTime&&(null===r||0===r.expirationTime)&&null!==(r=t.eagerReducer))try{var c=t.eagerState,s=r(c,n);if(l.eagerReducer=r,l.eagerState=s,Jt(s,c))return}catch(f){}Jo(e,i)}}var ul={readContext:Wl,useCallback:qi,useContext:qi,useEffect:qi,useImperativeHandle:qi,useLayoutEffect:qi,useMemo:qi,useReducer:qi,useRef:qi,useState:qi,useDebugValue:qi},cl={readContext:Wl,useCallback:function(e,t){return Ji().memoizedState=[e,void 0===t?null:t],e},useContext:Wl,useEffect:function(e,t){return rl(516,Mi|Li,e,t)},useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,rl(4,Pi|Ri,ll.bind(null,t,e),n)},useLayoutEffect:function(e,t){return rl(4,Pi|Ri,e,t)},useMemo:function(e,t){var n=Ji();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ji();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={last:null,dispatch:null,eagerReducer:e,eagerState:t}).dispatch=al.bind(null,Ui,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ji().memoizedState=e},useState:function(e){var t=Ji();return\"function\"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={last:null,dispatch:null,eagerReducer:el,eagerState:e}).dispatch=al.bind(null,Ui,e),[t.memoizedState,e]},useDebugValue:ol},sl={readContext:Wl,useCallback:function(e,t){var n=Zi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Yi(t,r[1])?r[0]:(n.memoizedState=[e,t],e)},useContext:Wl,useEffect:function(e,t){return il(516,Mi|Li,e,t)},useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,il(4,Pi|Ri,ll.bind(null,t,e),n)},useLayoutEffect:function(e,t){return il(4,Pi|Ri,e,t)},useMemo:function(e,t){var n=Zi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Yi(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)},useReducer:tl,useRef:function(){return Zi().memoizedState},useState:function(e){return tl(el)},useDebugValue:ol},fl=null,dl=null,pl=!1;function ml(e,t){var n=$r(5,null,null,0);n.elementType=\"DELETED\",n.type=\"DELETED\",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function hl(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=\"\"===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function vl(e){if(pl){var t=dl;if(t){var n=t;if(!hl(e,t)){if(!(t=Tr(n))||!hl(e,t))return e.effectTag|=2,pl=!1,void(fl=e);ml(fl,n)}fl=e,dl=_r(t)}else e.effectTag|=2,pl=!1,fl=e}}function yl(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&18!==e.tag;)e=e.return;fl=e}function gl(e){if(e!==fl)return!1;if(!pl)return yl(e),pl=!0,!1;var t=e.type;if(5!==e.tag||\"head\"!==t&&\"body\"!==t&&!gr(t,e.memoizedProps))for(t=dl;t;)ml(e,t),t=Tr(t);return yl(e),dl=fl?Tr(e.stateNode):null,!0}function bl(){dl=fl=null,pl=!1}var wl=He.ReactCurrentOwner,kl=!1;function xl(e,t,n,r){t.child=null===e?vi(t,null,n,r):hi(t,e.child,n,r)}function Tl(e,t,n,r,i){n=n.render;var l=t.ref;return jl(t,i),r=Xi(e,t,n,r,l,i),null===e||kl?(t.effectTag|=1,xl(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Ll(e,t,i))}function _l(e,t,n,r,i,l){if(null===e){var o=n.type;return\"function\"!==typeof o||Qr(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=qr(n.type,null,r,null,t.mode,l)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Sl(e,t,o,r,i,l))}return o=e.child,i<l&&(i=o.memoizedProps,(n=null!==(n=n.compare)?n:en)(i,r)&&e.ref===t.ref)?Ll(e,t,l):(t.effectTag|=1,(e=Kr(o,r)).ref=t.ref,e.return=t,t.child=e)}function Sl(e,t,n,r,i,l){return null!==e&&en(e.memoizedProps,r)&&e.ref===t.ref&&(kl=!1,i<l)?Ll(e,t,l):Cl(e,t,n,r,l)}function El(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function Cl(e,t,n,r,i){var l=zr(n)?Lr:Or.current;return l=Mr(t,l),jl(t,i),n=Xi(e,t,n,r,l,i),null===e||kl?(t.effectTag|=1,xl(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Ll(e,t,i))}function Pl(e,t,n,r,i){if(zr(n)){var l=!0;Ar(t)}else l=!1;if(jl(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),ui(t,n,r),si(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,a=t.memoizedProps;o.props=a;var u=o.context,c=n.contextType;\"object\"===typeof c&&null!==c?c=Wl(c):c=Mr(t,c=zr(n)?Lr:Or.current);var s=n.getDerivedStateFromProps,f=\"function\"===typeof s||\"function\"===typeof o.getSnapshotBeforeUpdate;f||\"function\"!==typeof o.UNSAFE_componentWillReceiveProps&&\"function\"!==typeof o.componentWillReceiveProps||(a!==r||u!==c)&&ci(t,o,r,c),Ql=!1;var d=t.memoizedState;u=o.state=d;var p=t.updateQueue;null!==p&&(to(t,p,r,o,i),u=t.memoizedState),a!==r||d!==u||Rr.current||Ql?(\"function\"===typeof s&&(li(t,n,s,r),u=t.memoizedState),(a=Ql||ai(t,n,a,r,d,u,c))?(f||\"function\"!==typeof o.UNSAFE_componentWillMount&&\"function\"!==typeof o.componentWillMount||(\"function\"===typeof o.componentWillMount&&o.componentWillMount(),\"function\"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),\"function\"===typeof o.componentDidMount&&(t.effectTag|=4)):(\"function\"===typeof o.componentDidMount&&(t.effectTag|=4),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=c,r=a):(\"function\"===typeof o.componentDidMount&&(t.effectTag|=4),r=!1)}else o=t.stateNode,a=t.memoizedProps,o.props=t.type===t.elementType?a:ri(t.type,a),u=o.context,\"object\"===typeof(c=n.contextType)&&null!==c?c=Wl(c):c=Mr(t,c=zr(n)?Lr:Or.current),(f=\"function\"===typeof(s=n.getDerivedStateFromProps)||\"function\"===typeof o.getSnapshotBeforeUpdate)||\"function\"!==typeof o.UNSAFE_componentWillReceiveProps&&\"function\"!==typeof o.componentWillReceiveProps||(a!==r||u!==c)&&ci(t,o,r,c),Ql=!1,u=t.memoizedState,d=o.state=u,null!==(p=t.updateQueue)&&(to(t,p,r,o,i),d=t.memoizedState),a!==r||u!==d||Rr.current||Ql?(\"function\"===typeof s&&(li(t,n,s,r),d=t.memoizedState),(s=Ql||ai(t,n,a,r,u,d,c))?(f||\"function\"!==typeof o.UNSAFE_componentWillUpdate&&\"function\"!==typeof o.componentWillUpdate||(\"function\"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,d,c),\"function\"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,d,c)),\"function\"===typeof o.componentDidUpdate&&(t.effectTag|=4),\"function\"===typeof o.getSnapshotBeforeUpdate&&(t.effectTag|=256)):(\"function\"!==typeof o.componentDidUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),\"function\"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),t.memoizedProps=r,t.memoizedState=d),o.props=r,o.state=d,o.context=c,r=s):(\"function\"!==typeof o.componentDidUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),\"function\"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),r=!1);return Nl(e,t,n,r,l,i)}function Nl(e,t,n,r,i,l){El(e,t);var o=0!==(64&t.effectTag);if(!r&&!o)return i&&jr(t,n,!1),Ll(e,t,l);r=t.stateNode,wl.current=t;var a=o&&\"function\"!==typeof n.getDerivedStateFromError?null:r.render();return t.effectTag|=1,null!==e&&o?(t.child=hi(t,e.child,null,l),t.child=hi(t,null,a,l)):xl(e,t,a,l),t.memoizedState=r.state,i&&jr(t,n,!0),t.child}function Ol(e){var t=e.stateNode;t.pendingContext?Fr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Fr(0,t.context,!1),xi(e,t.containerInfo)}function Rl(e,t,n){var r=t.mode,i=t.pendingProps,l=t.memoizedState;if(0===(64&t.effectTag)){l=null;var o=!1}else l={timedOutAt:null!==l?l.timedOutAt:0},o=!0,t.effectTag&=-65;if(null===e)if(o){var a=i.fallback;e=Yr(null,r,0,null),0===(1&t.mode)&&(e.child=null!==t.memoizedState?t.child.child:t.child),r=Yr(a,r,n,null),e.sibling=r,(n=e).return=r.return=t}else n=r=vi(t,null,i.children,n);else null!==e.memoizedState?(a=(r=e.child).sibling,o?(n=i.fallback,i=Kr(r,r.pendingProps),0===(1&t.mode)&&((o=null!==t.memoizedState?t.child.child:t.child)!==r.child&&(i.child=o)),r=i.sibling=Kr(a,n,a.expirationTime),n=i,i.childExpirationTime=0,n.return=r.return=t):n=r=hi(t,r.child,i.children,n)):(a=e.child,o?(o=i.fallback,(i=Yr(null,r,0,null)).child=a,0===(1&t.mode)&&(i.child=null!==t.memoizedState?t.child.child:t.child),(r=i.sibling=Yr(o,r,n,null)).effectTag|=2,n=i,i.childExpirationTime=0,n.return=r.return=t):r=n=hi(t,a,i.children,n)),t.stateNode=e.stateNode;return t.memoizedState=l,t.child=n,r}function Ll(e,t,n){if(null!==e&&(t.contextDependencies=e.contextDependencies),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child&&o(\"153\"),null!==t.child){for(n=Kr(e=t.child,e.pendingProps,e.expirationTime),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Kr(e,e.pendingProps,e.expirationTime)).return=t;n.sibling=null}return t.child}function Ml(e,t,n){var r=t.expirationTime;if(null!==e){if(e.memoizedProps!==t.pendingProps||Rr.current)kl=!0;else if(r<n){switch(kl=!1,t.tag){case 3:Ol(t),bl();break;case 5:_i(t);break;case 1:zr(t.type)&&Ar(t);break;case 4:xi(t,t.stateNode.containerInfo);break;case 10:Dl(t,t.memoizedProps.value);break;case 13:if(null!==t.memoizedState)return 0!==(r=t.child.childExpirationTime)&&r>=n?Rl(e,t,n):null!==(t=Ll(e,t,n))?t.sibling:null}return Ll(e,t,n)}}else kl=!1;switch(t.expirationTime=0,t.tag){case 2:r=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps;var i=Mr(t,Or.current);if(jl(t,n),i=Xi(null,t,r,e,i,n),t.effectTag|=1,\"object\"===typeof i&&null!==i&&\"function\"===typeof i.render&&void 0===i.$$typeof){if(t.tag=1,Gi(),zr(r)){var l=!0;Ar(t)}else l=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null;var a=r.getDerivedStateFromProps;\"function\"===typeof a&&li(t,r,a,e),i.updater=oi,t.stateNode=i,i._reactInternalFiber=t,si(t,r,e,n),t=Nl(null,t,r,!0,l,n)}else t.tag=0,xl(null,t,i,n),t=t.child;return t;case 16:switch(i=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),l=t.pendingProps,e=function(e){var t=e._result;switch(e._status){case 1:return t;case 2:case 0:throw t;default:switch(e._status=0,(t=(t=e._ctor)()).then(function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)},function(t){0===e._status&&(e._status=2,e._result=t)}),e._status){case 1:return e._result;case 2:throw e._result}throw e._result=t,t}}(i),t.type=e,i=t.tag=function(e){if(\"function\"===typeof e)return Qr(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===tt)return 11;if(e===rt)return 14}return 2}(e),l=ri(e,l),a=void 0,i){case 0:a=Cl(null,t,e,l,n);break;case 1:a=Pl(null,t,e,l,n);break;case 11:a=Tl(null,t,e,l,n);break;case 14:a=_l(null,t,e,ri(e.type,l),r,n);break;default:o(\"306\",e,\"\")}return a;case 0:return r=t.type,i=t.pendingProps,Cl(e,t,r,i=t.elementType===r?i:ri(r,i),n);case 1:return r=t.type,i=t.pendingProps,Pl(e,t,r,i=t.elementType===r?i:ri(r,i),n);case 3:return Ol(t),null===(r=t.updateQueue)&&o(\"282\"),i=null!==(i=t.memoizedState)?i.element:null,to(t,r,t.pendingProps,null,n),(r=t.memoizedState.element)===i?(bl(),t=Ll(e,t,n)):(i=t.stateNode,(i=(null===e||null===e.child)&&i.hydrate)&&(dl=_r(t.stateNode.containerInfo),fl=t,i=pl=!0),i?(t.effectTag|=2,t.child=vi(t,null,r,n)):(xl(e,t,r,n),bl()),t=t.child),t;case 5:return _i(t),null===e&&vl(t),r=t.type,i=t.pendingProps,l=null!==e?e.memoizedProps:null,a=i.children,gr(r,i)?a=null:null!==l&&gr(r,l)&&(t.effectTag|=16),El(e,t),1!==n&&1&t.mode&&i.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(xl(e,t,a,n),t=t.child),t;case 6:return null===e&&vl(t),null;case 13:return Rl(e,t,n);case 4:return xi(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=hi(t,null,r,n):xl(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Tl(e,t,r,i=t.elementType===r?i:ri(r,i),n);case 7:return xl(e,t,t.pendingProps,n),t.child;case 8:case 12:return xl(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,a=t.memoizedProps,Dl(t,l=i.value),null!==a){var u=a.value;if(0===(l=Jt(u,l)?0:0|(\"function\"===typeof r._calculateChangedBits?r._calculateChangedBits(u,l):1073741823))){if(a.children===i.children&&!Rr.current){t=Ll(e,t,n);break e}}else for(null!==(u=t.child)&&(u.return=t);null!==u;){var c=u.contextDependencies;if(null!==c){a=u.child;for(var s=c.first;null!==s;){if(s.context===r&&0!==(s.observedBits&l)){1===u.tag&&((s=Yl(n)).tag=Hl,Gl(u,s)),u.expirationTime<n&&(u.expirationTime=n),null!==(s=u.alternate)&&s.expirationTime<n&&(s.expirationTime=n),s=n;for(var f=u.return;null!==f;){var d=f.alternate;if(f.childExpirationTime<s)f.childExpirationTime=s,null!==d&&d.childExpirationTime<s&&(d.childExpirationTime=s);else{if(!(null!==d&&d.childExpirationTime<s))break;d.childExpirationTime=s}f=f.return}c.expirationTime<n&&(c.expirationTime=n);break}s=s.next}}else a=10===u.tag&&u.type===t.type?null:u.child;if(null!==a)a.return=u;else for(a=u;null!==a;){if(a===t){a=null;break}if(null!==(u=a.sibling)){u.return=a.return,a=u;break}a=a.return}u=a}}xl(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(l=t.pendingProps).children,jl(t,n),r=r(i=Wl(i,l.unstable_observedBits)),t.effectTag|=1,xl(e,t,r,n),t.child;case 14:return l=ri(i=t.type,t.pendingProps),_l(e,t,i,l=ri(i.type,l),r,n);case 15:return Sl(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:ri(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,zr(r)?(e=!0,Ar(t)):e=!1,jl(t,n),ui(t,r,i),si(t,r,i,n),Nl(null,t,r,!0,e,n)}o(\"156\")}var zl={current:null},Il=null,Ul=null,Fl=null;function Dl(e,t){var n=e.type._context;Pr(zl,n._currentValue),n._currentValue=t}function Al(e){var t=zl.current;Cr(zl),e.type._context._currentValue=t}function jl(e,t){Il=e,Fl=Ul=null;var n=e.contextDependencies;null!==n&&n.expirationTime>=t&&(kl=!0),e.contextDependencies=null}function Wl(e,t){return Fl!==e&&!1!==t&&0!==t&&(\"number\"===typeof t&&1073741823!==t||(Fl=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Ul?(null===Il&&o(\"308\"),Ul=t,Il.contextDependencies={first:t,expirationTime:0}):Ul=Ul.next=t),e._currentValue}var Vl=0,Bl=1,Hl=2,$l=3,Ql=!1;function Kl(e){return{baseState:e,firstUpdate:null,lastUpdate:null,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function ql(e){return{baseState:e.baseState,firstUpdate:e.firstUpdate,lastUpdate:e.lastUpdate,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function Yl(e){return{expirationTime:e,tag:Vl,payload:null,callback:null,next:null,nextEffect:null}}function Xl(e,t){null===e.lastUpdate?e.firstUpdate=e.lastUpdate=t:(e.lastUpdate.next=t,e.lastUpdate=t)}function Gl(e,t){var n=e.alternate;if(null===n){var r=e.updateQueue,i=null;null===r&&(r=e.updateQueue=Kl(e.memoizedState))}else r=e.updateQueue,i=n.updateQueue,null===r?null===i?(r=e.updateQueue=Kl(e.memoizedState),i=n.updateQueue=Kl(n.memoizedState)):r=e.updateQueue=ql(i):null===i&&(i=n.updateQueue=ql(r));null===i||r===i?Xl(r,t):null===r.lastUpdate||null===i.lastUpdate?(Xl(r,t),Xl(i,t)):(Xl(r,t),i.lastUpdate=t)}function Jl(e,t){var n=e.updateQueue;null===(n=null===n?e.updateQueue=Kl(e.memoizedState):Zl(e,n)).lastCapturedUpdate?n.firstCapturedUpdate=n.lastCapturedUpdate=t:(n.lastCapturedUpdate.next=t,n.lastCapturedUpdate=t)}function Zl(e,t){var n=e.alternate;return null!==n&&t===n.updateQueue&&(t=e.updateQueue=ql(t)),t}function eo(e,t,n,r,l,o){switch(n.tag){case Bl:return\"function\"===typeof(e=n.payload)?e.call(o,r,l):e;case $l:e.effectTag=-2049&e.effectTag|64;case Vl:if(null===(l=\"function\"===typeof(e=n.payload)?e.call(o,r,l):e)||void 0===l)break;return i({},r,l);case Hl:Ql=!0}return r}function to(e,t,n,r,i){Ql=!1;for(var l=(t=Zl(e,t)).baseState,o=null,a=0,u=t.firstUpdate,c=l;null!==u;){var s=u.expirationTime;s<i?(null===o&&(o=u,l=c),a<s&&(a=s)):(c=eo(e,0,u,c,n,r),null!==u.callback&&(e.effectTag|=32,u.nextEffect=null,null===t.lastEffect?t.firstEffect=t.lastEffect=u:(t.lastEffect.nextEffect=u,t.lastEffect=u))),u=u.next}for(s=null,u=t.firstCapturedUpdate;null!==u;){var f=u.expirationTime;f<i?(null===s&&(s=u,null===o&&(l=c)),a<f&&(a=f)):(c=eo(e,0,u,c,n,r),null!==u.callback&&(e.effectTag|=32,u.nextEffect=null,null===t.lastCapturedEffect?t.firstCapturedEffect=t.lastCapturedEffect=u:(t.lastCapturedEffect.nextEffect=u,t.lastCapturedEffect=u))),u=u.next}null===o&&(t.lastUpdate=null),null===s?t.lastCapturedUpdate=null:e.effectTag|=32,null===o&&null===s&&(l=c),t.baseState=l,t.firstUpdate=o,t.firstCapturedUpdate=s,e.expirationTime=a,e.memoizedState=c}function no(e,t,n){null!==t.firstCapturedUpdate&&(null!==t.lastUpdate&&(t.lastUpdate.next=t.firstCapturedUpdate,t.lastUpdate=t.lastCapturedUpdate),t.firstCapturedUpdate=t.lastCapturedUpdate=null),ro(t.firstEffect,n),t.firstEffect=t.lastEffect=null,ro(t.firstCapturedEffect,n),t.firstCapturedEffect=t.lastCapturedEffect=null}function ro(e,t){for(;null!==e;){var n=e.callback;if(null!==n){e.callback=null;var r=t;\"function\"!==typeof n&&o(\"191\",n),n.call(r)}e=e.nextEffect}}function io(e,t){return{value:e,source:t,stack:ut(t)}}function lo(e){e.effectTag|=4}var oo=void 0,ao=void 0,uo=void 0,co=void 0;oo=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},ao=function(){},uo=function(e,t,n,r,l){var o=e.memoizedProps;if(o!==r){var a=t.stateNode;switch(ki(gi.current),e=null,n){case\"input\":o=bt(a,o),r=bt(a,r),e=[];break;case\"option\":o=Kn(a,o),r=Kn(a,r),e=[];break;case\"select\":o=i({},o,{value:void 0}),r=i({},r,{value:void 0}),e=[];break;case\"textarea\":o=Yn(a,o),r=Yn(a,r),e=[];break;default:\"function\"!==typeof o.onClick&&\"function\"===typeof r.onClick&&(a.onclick=mr)}fr(n,r),a=n=void 0;var u=null;for(n in o)if(!r.hasOwnProperty(n)&&o.hasOwnProperty(n)&&null!=o[n])if(\"style\"===n){var c=o[n];for(a in c)c.hasOwnProperty(a)&&(u||(u={}),u[a]=\"\")}else\"dangerouslySetInnerHTML\"!==n&&\"children\"!==n&&\"suppressContentEditableWarning\"!==n&&\"suppressHydrationWarning\"!==n&&\"autoFocus\"!==n&&(b.hasOwnProperty(n)?e||(e=[]):(e=e||[]).push(n,null));for(n in r){var s=r[n];if(c=null!=o?o[n]:void 0,r.hasOwnProperty(n)&&s!==c&&(null!=s||null!=c))if(\"style\"===n)if(c){for(a in c)!c.hasOwnProperty(a)||s&&s.hasOwnProperty(a)||(u||(u={}),u[a]=\"\");for(a in s)s.hasOwnProperty(a)&&c[a]!==s[a]&&(u||(u={}),u[a]=s[a])}else u||(e||(e=[]),e.push(n,u)),u=s;else\"dangerouslySetInnerHTML\"===n?(s=s?s.__html:void 0,c=c?c.__html:void 0,null!=s&&c!==s&&(e=e||[]).push(n,\"\"+s)):\"children\"===n?c===s||\"string\"!==typeof s&&\"number\"!==typeof s||(e=e||[]).push(n,\"\"+s):\"suppressContentEditableWarning\"!==n&&\"suppressHydrationWarning\"!==n&&(b.hasOwnProperty(n)?(null!=s&&pr(l,n),e||c===s||(e=[])):(e=e||[]).push(n,s))}u&&(e=e||[]).push(\"style\",u),l=e,(t.updateQueue=l)&&lo(t)}},co=function(e,t,n,r){n!==r&&lo(t)};var so=\"function\"===typeof WeakSet?WeakSet:Set;function fo(e,t){var n=t.source,r=t.stack;null===r&&null!==n&&(r=ut(n)),null!==n&&at(n.type),t=t.value,null!==e&&1===e.tag&&at(e.type);try{console.error(t)}catch(i){setTimeout(function(){throw i})}}function po(e){var t=e.ref;if(null!==t)if(\"function\"===typeof t)try{t(null)}catch(n){qo(e,n)}else t.current=null}function mo(e,t,n){if(null!==(n=null!==(n=n.updateQueue)?n.lastEffect:null)){var r=n=n.next;do{if((r.tag&e)!==Ei){var i=r.destroy;r.destroy=void 0,void 0!==i&&i()}(r.tag&t)!==Ei&&(i=r.create,r.destroy=i()),r=r.next}while(r!==n)}}function ho(e){switch(\"function\"===typeof Vr&&Vr(e),e.tag){case 0:case 11:case 14:case 15:var t=e.updateQueue;if(null!==t&&null!==(t=t.lastEffect)){var n=t=t.next;do{var r=n.destroy;if(void 0!==r){var i=e;try{r()}catch(l){qo(i,l)}}n=n.next}while(n!==t)}break;case 1:if(po(e),\"function\"===typeof(t=e.stateNode).componentWillUnmount)try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(l){qo(e,l)}break;case 5:po(e);break;case 4:go(e)}}function vo(e){return 5===e.tag||3===e.tag||4===e.tag}function yo(e){e:{for(var t=e.return;null!==t;){if(vo(t)){var n=t;break e}t=t.return}o(\"160\"),n=void 0}var r=t=void 0;switch(n.tag){case 5:t=n.stateNode,r=!1;break;case 3:case 4:t=n.stateNode.containerInfo,r=!0;break;default:o(\"161\")}16&n.effectTag&&(lr(t,\"\"),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||vo(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}for(var i=e;;){if(5===i.tag||6===i.tag)if(n)if(r){var l=t,a=i.stateNode,u=n;8===l.nodeType?l.parentNode.insertBefore(a,u):l.insertBefore(a,u)}else t.insertBefore(i.stateNode,n);else r?(a=t,u=i.stateNode,8===a.nodeType?(l=a.parentNode).insertBefore(u,a):(l=a).appendChild(u),null!==(a=a._reactRootContainer)&&void 0!==a||null!==l.onclick||(l.onclick=mr)):t.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===e)break;for(;null===i.sibling;){if(null===i.return||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}function go(e){for(var t=e,n=!1,r=void 0,i=void 0;;){if(!n){n=t.return;e:for(;;){switch(null===n&&o(\"160\"),n.tag){case 5:r=n.stateNode,i=!1;break e;case 3:case 4:r=n.stateNode.containerInfo,i=!0;break e}n=n.return}n=!0}if(5===t.tag||6===t.tag){e:for(var l=t,a=l;;)if(ho(a),null!==a.child&&4!==a.tag)a.child.return=a,a=a.child;else{if(a===l)break;for(;null===a.sibling;){if(null===a.return||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}i?(l=r,a=t.stateNode,8===l.nodeType?l.parentNode.removeChild(a):l.removeChild(a)):r.removeChild(t.stateNode)}else if(4===t.tag){if(null!==t.child){r=t.stateNode.containerInfo,i=!0,t.child.return=t,t=t.child;continue}}else if(ho(t),null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return;4===(t=t.return).tag&&(n=!1)}t.sibling.return=t.return,t=t.sibling}}function bo(e,t){switch(t.tag){case 0:case 11:case 14:case 15:mo(Pi,Ni,t);break;case 1:break;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps;e=null!==e?e.memoizedProps:r;var i=t.type,l=t.updateQueue;t.updateQueue=null,null!==l&&function(e,t,n,r,i){e[z]=i,\"input\"===n&&\"radio\"===i.type&&null!=i.name&&kt(e,i),dr(n,r),r=dr(n,i);for(var l=0;l<t.length;l+=2){var o=t[l],a=t[l+1];\"style\"===o?cr(e,a):\"dangerouslySetInnerHTML\"===o?ir(e,a):\"children\"===o?lr(e,a):yt(e,o,a,r)}switch(n){case\"input\":xt(e,i);break;case\"textarea\":Gn(e,i);break;case\"select\":t=e._wrapperState.wasMultiple,e._wrapperState.wasMultiple=!!i.multiple,null!=(n=i.value)?qn(e,!!i.multiple,n,!1):t!==!!i.multiple&&(null!=i.defaultValue?qn(e,!!i.multiple,i.defaultValue,!0):qn(e,!!i.multiple,i.multiple?[]:\"\",!1))}}(n,l,i,e,r)}break;case 6:null===t.stateNode&&o(\"162\"),t.stateNode.nodeValue=t.memoizedProps;break;case 3:case 12:break;case 13:if(n=t.memoizedState,r=void 0,e=t,null===n?r=!1:(r=!0,e=t.child,0===n.timedOutAt&&(n.timedOutAt=xa())),null!==e&&function(e,t){for(var n=e;;){if(5===n.tag){var r=n.stateNode;if(t)r.style.display=\"none\";else{r=n.stateNode;var i=n.memoizedProps.style;i=void 0!==i&&null!==i&&i.hasOwnProperty(\"display\")?i.display:null,r.style.display=ur(\"display\",i)}}else if(6===n.tag)n.stateNode.nodeValue=t?\"\":n.memoizedProps;else{if(13===n.tag&&null!==n.memoizedState){(r=n.child.sibling).return=n,n=r;continue}if(null!==n.child){n.child.return=n,n=n.child;continue}}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}(e,r),null!==(n=t.updateQueue)){t.updateQueue=null;var a=t.stateNode;null===a&&(a=t.stateNode=new so),n.forEach(function(e){var n=function(e,t){var n=e.stateNode;null!==n&&n.delete(t),t=Yo(t=xa(),e),null!==(e=Go(e,t))&&(Zr(e,t),0!==(t=e.expirationTime)&&Ta(e,t))}.bind(null,t,e);a.has(e)||(a.add(e),e.then(n,n))})}break;case 17:break;default:o(\"163\")}}var wo=\"function\"===typeof WeakMap?WeakMap:Map;function ko(e,t,n){(n=Yl(n)).tag=$l,n.payload={element:null};var r=t.value;return n.callback=function(){La(r),fo(e,t)},n}function xo(e,t,n){(n=Yl(n)).tag=$l;var r=e.type.getDerivedStateFromError;if(\"function\"===typeof r){var i=t.value;n.payload=function(){return r(i)}}var l=e.stateNode;return null!==l&&\"function\"===typeof l.componentDidCatch&&(n.callback=function(){\"function\"!==typeof r&&(null===Do?Do=new Set([this]):Do.add(this));var n=t.value,i=t.stack;fo(e,t),this.componentDidCatch(n,{componentStack:null!==i?i:\"\"})}),n}function To(e){switch(e.tag){case 1:zr(e.type)&&Ir();var t=e.effectTag;return 2048&t?(e.effectTag=-2049&t|64,e):null;case 3:return Ti(),Ur(),0!==(64&(t=e.effectTag))&&o(\"285\"),e.effectTag=-2049&t|64,e;case 5:return Si(e),null;case 13:return 2048&(t=e.effectTag)?(e.effectTag=-2049&t|64,e):null;case 18:return null;case 4:return Ti(),null;case 10:return Al(e),null;default:return null}}var _o=He.ReactCurrentDispatcher,So=He.ReactCurrentOwner,Eo=1073741822,Co=!1,Po=null,No=null,Oo=0,Ro=-1,Lo=!1,Mo=null,zo=!1,Io=null,Uo=null,Fo=null,Do=null;function Ao(){if(null!==Po)for(var e=Po.return;null!==e;){var t=e;switch(t.tag){case 1:var n=t.type.childContextTypes;null!==n&&void 0!==n&&Ir();break;case 3:Ti(),Ur();break;case 5:Si(t);break;case 4:Ti();break;case 10:Al(t)}e=e.return}No=null,Oo=0,Ro=-1,Lo=!1,Po=null}function jo(){for(;null!==Mo;){var e=Mo.effectTag;if(16&e&&lr(Mo.stateNode,\"\"),128&e){var t=Mo.alternate;null!==t&&(null!==(t=t.ref)&&(\"function\"===typeof t?t(null):t.current=null))}switch(14&e){case 2:yo(Mo),Mo.effectTag&=-3;break;case 6:yo(Mo),Mo.effectTag&=-3,bo(Mo.alternate,Mo);break;case 4:bo(Mo.alternate,Mo);break;case 8:go(e=Mo),e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,null!==(e=e.alternate)&&(e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null)}Mo=Mo.nextEffect}}function Wo(){for(;null!==Mo;){if(256&Mo.effectTag)e:{var e=Mo.alternate,t=Mo;switch(t.tag){case 0:case 11:case 15:mo(Ci,Ei,t);break e;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:ri(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}break e;case 3:case 5:case 6:case 4:case 17:break e;default:o(\"163\")}}Mo=Mo.nextEffect}}function Vo(e,t){for(;null!==Mo;){var n=Mo.effectTag;if(36&n){var r=Mo.alternate,i=Mo,l=t;switch(i.tag){case 0:case 11:case 15:mo(Oi,Ri,i);break;case 1:var a=i.stateNode;if(4&i.effectTag)if(null===r)a.componentDidMount();else{var u=i.elementType===i.type?r.memoizedProps:ri(i.type,r.memoizedProps);a.componentDidUpdate(u,r.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}null!==(r=i.updateQueue)&&no(0,r,a);break;case 3:if(null!==(r=i.updateQueue)){if(a=null,null!==i.child)switch(i.child.tag){case 5:a=i.child.stateNode;break;case 1:a=i.child.stateNode}no(0,r,a)}break;case 5:l=i.stateNode,null===r&&4&i.effectTag&&yr(i.type,i.memoizedProps)&&l.focus();break;case 6:case 4:case 12:case 13:case 17:break;default:o(\"163\")}}128&n&&(null!==(i=Mo.ref)&&(l=Mo.stateNode,\"function\"===typeof i?i(l):i.current=l)),512&n&&(Io=e),Mo=Mo.nextEffect}}function Bo(){null!==Uo&&xr(Uo),null!==Fo&&Fo()}function Ho(e,t){zo=Co=!0,e.current===t&&o(\"177\");var n=e.pendingCommitExpirationTime;0===n&&o(\"261\"),e.pendingCommitExpirationTime=0;var r=t.expirationTime,i=t.childExpirationTime;for(function(e,t){if(e.didError=!1,0===t)e.earliestPendingTime=0,e.latestPendingTime=0,e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0;else{t<e.latestPingedTime&&(e.latestPingedTime=0);var n=e.latestPendingTime;0!==n&&(n>t?e.earliestPendingTime=e.latestPendingTime=0:e.earliestPendingTime>t&&(e.earliestPendingTime=e.latestPendingTime)),0===(n=e.earliestSuspendedTime)?Zr(e,t):t<e.latestSuspendedTime?(e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0,Zr(e,t)):t>n&&Zr(e,t)}ni(0,e)}(e,i>r?i:r),So.current=null,r=void 0,1<t.effectTag?null!==t.lastEffect?(t.lastEffect.nextEffect=t,r=t.firstEffect):r=t:r=t.firstEffect,hr=_n,vr=function(){var e=Un();if(Fn(e)){if(\"selectionStart\"in e)var t={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(t=(t=e.ownerDocument)&&t.defaultView||window).getSelection&&t.getSelection();if(n&&0!==n.rangeCount){t=n.anchorNode;var r=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{t.nodeType,i.nodeType}catch(p){t=null;break e}var l=0,o=-1,a=-1,u=0,c=0,s=e,f=null;t:for(;;){for(var d;s!==t||0!==r&&3!==s.nodeType||(o=l+r),s!==i||0!==n&&3!==s.nodeType||(a=l+n),3===s.nodeType&&(l+=s.nodeValue.length),null!==(d=s.firstChild);)f=s,s=d;for(;;){if(s===e)break t;if(f===t&&++u===r&&(o=l),f===i&&++c===n&&(a=l),null!==(d=s.nextSibling))break;f=(s=f).parentNode}s=d}t=-1===o||-1===a?null:{start:o,end:a}}else t=null}t=t||{start:0,end:0}}else t=null;return{focusedElem:e,selectionRange:t}}(),_n=!1,Mo=r;null!==Mo;){i=!1;var a=void 0;try{Wo()}catch(c){i=!0,a=c}i&&(null===Mo&&o(\"178\"),qo(Mo,a),null!==Mo&&(Mo=Mo.nextEffect))}for(Mo=r;null!==Mo;){i=!1,a=void 0;try{jo()}catch(c){i=!0,a=c}i&&(null===Mo&&o(\"178\"),qo(Mo,a),null!==Mo&&(Mo=Mo.nextEffect))}for(Dn(vr),vr=null,_n=!!hr,hr=null,e.current=t,Mo=r;null!==Mo;){i=!1,a=void 0;try{Vo(e,n)}catch(c){i=!0,a=c}i&&(null===Mo&&o(\"178\"),qo(Mo,a),null!==Mo&&(Mo=Mo.nextEffect))}if(null!==r&&null!==Io){var u=function(e,t){Fo=Uo=Io=null;var n=ia;ia=!0;do{if(512&t.effectTag){var r=!1,i=void 0;try{var l=t;mo(Mi,Ei,l),mo(Ei,Li,l)}catch(u){r=!0,i=u}r&&qo(t,i)}t=t.nextEffect}while(null!==t);ia=n,0!==(n=e.expirationTime)&&Ta(e,n),sa||ia||Pa(1073741823,!1)}.bind(null,e,r);Uo=l.unstable_runWithPriority(l.unstable_NormalPriority,function(){return kr(u)}),Fo=u}Co=zo=!1,\"function\"===typeof Wr&&Wr(t.stateNode),n=t.expirationTime,0===(t=(t=t.childExpirationTime)>n?t:n)&&(Do=null),function(e,t){e.expirationTime=t,e.finishedWork=null}(e,t)}function $o(e){for(;;){var t=e.alternate,n=e.return,r=e.sibling;if(0===(1024&e.effectTag)){Po=e;e:{var l=t,a=Oo,u=(t=e).pendingProps;switch(t.tag){case 2:case 16:break;case 15:case 0:break;case 1:zr(t.type)&&Ir();break;case 3:Ti(),Ur(),(u=t.stateNode).pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),null!==l&&null!==l.child||(gl(t),t.effectTag&=-3),ao(t);break;case 5:Si(t);var c=ki(wi.current);if(a=t.type,null!==l&&null!=t.stateNode)uo(l,t,a,u,c),l.ref!==t.ref&&(t.effectTag|=128);else if(u){var s=ki(gi.current);if(gl(t)){l=(u=t).stateNode;var f=u.type,d=u.memoizedProps,p=c;switch(l[M]=u,l[z]=d,a=void 0,c=f){case\"iframe\":case\"object\":Sn(\"load\",l);break;case\"video\":case\"audio\":for(f=0;f<te.length;f++)Sn(te[f],l);break;case\"source\":Sn(\"error\",l);break;case\"img\":case\"image\":case\"link\":Sn(\"error\",l),Sn(\"load\",l);break;case\"form\":Sn(\"reset\",l),Sn(\"submit\",l);break;case\"details\":Sn(\"toggle\",l);break;case\"input\":wt(l,d),Sn(\"invalid\",l),pr(p,\"onChange\");break;case\"select\":l._wrapperState={wasMultiple:!!d.multiple},Sn(\"invalid\",l),pr(p,\"onChange\");break;case\"textarea\":Xn(l,d),Sn(\"invalid\",l),pr(p,\"onChange\")}for(a in fr(c,d),f=null,d)d.hasOwnProperty(a)&&(s=d[a],\"children\"===a?\"string\"===typeof s?l.textContent!==s&&(f=[\"children\",s]):\"number\"===typeof s&&l.textContent!==\"\"+s&&(f=[\"children\",\"\"+s]):b.hasOwnProperty(a)&&null!=s&&pr(p,a));switch(c){case\"input\":Ve(l),Tt(l,d,!0);break;case\"textarea\":Ve(l),Jn(l);break;case\"select\":case\"option\":break;default:\"function\"===typeof d.onClick&&(l.onclick=mr)}a=f,u.updateQueue=a,(u=null!==a)&&lo(t)}else{d=t,l=a,p=u,f=9===c.nodeType?c:c.ownerDocument,s===Zn.html&&(s=er(l)),s===Zn.html?\"script\"===l?((l=f.createElement(\"div\")).innerHTML=\"<script><\\/script>\",f=l.removeChild(l.firstChild)):\"string\"===typeof p.is?f=f.createElement(l,{is:p.is}):(f=f.createElement(l),\"select\"===l&&p.multiple&&(f.multiple=!0)):f=f.createElementNS(s,l),(l=f)[M]=d,l[z]=u,oo(l,t,!1,!1),p=l;var m=c,h=dr(f=a,d=u);switch(f){case\"iframe\":case\"object\":Sn(\"load\",p),c=d;break;case\"video\":case\"audio\":for(c=0;c<te.length;c++)Sn(te[c],p);c=d;break;case\"source\":Sn(\"error\",p),c=d;break;case\"img\":case\"image\":case\"link\":Sn(\"error\",p),Sn(\"load\",p),c=d;break;case\"form\":Sn(\"reset\",p),Sn(\"submit\",p),c=d;break;case\"details\":Sn(\"toggle\",p),c=d;break;case\"input\":wt(p,d),c=bt(p,d),Sn(\"invalid\",p),pr(m,\"onChange\");break;case\"option\":c=Kn(p,d);break;case\"select\":p._wrapperState={wasMultiple:!!d.multiple},c=i({},d,{value:void 0}),Sn(\"invalid\",p),pr(m,\"onChange\");break;case\"textarea\":Xn(p,d),c=Yn(p,d),Sn(\"invalid\",p),pr(m,\"onChange\");break;default:c=d}fr(f,c),s=void 0;var v=f,y=p,g=c;for(s in g)if(g.hasOwnProperty(s)){var w=g[s];\"style\"===s?cr(y,w):\"dangerouslySetInnerHTML\"===s?null!=(w=w?w.__html:void 0)&&ir(y,w):\"children\"===s?\"string\"===typeof w?(\"textarea\"!==v||\"\"!==w)&&lr(y,w):\"number\"===typeof w&&lr(y,\"\"+w):\"suppressContentEditableWarning\"!==s&&\"suppressHydrationWarning\"!==s&&\"autoFocus\"!==s&&(b.hasOwnProperty(s)?null!=w&&pr(m,s):null!=w&&yt(y,s,w,h))}switch(f){case\"input\":Ve(p),Tt(p,d,!1);break;case\"textarea\":Ve(p),Jn(p);break;case\"option\":null!=d.value&&p.setAttribute(\"value\",\"\"+gt(d.value));break;case\"select\":(c=p).multiple=!!d.multiple,null!=(p=d.value)?qn(c,!!d.multiple,p,!1):null!=d.defaultValue&&qn(c,!!d.multiple,d.defaultValue,!0);break;default:\"function\"===typeof c.onClick&&(p.onclick=mr)}(u=yr(a,u))&&lo(t),t.stateNode=l}null!==t.ref&&(t.effectTag|=128)}else null===t.stateNode&&o(\"166\");break;case 6:l&&null!=t.stateNode?co(l,t,l.memoizedProps,u):(\"string\"!==typeof u&&(null===t.stateNode&&o(\"166\")),l=ki(wi.current),ki(gi.current),gl(t)?(a=(u=t).stateNode,l=u.memoizedProps,a[M]=u,(u=a.nodeValue!==l)&&lo(t)):(a=t,(u=(9===l.nodeType?l:l.ownerDocument).createTextNode(u))[M]=t,a.stateNode=u));break;case 11:break;case 13:if(u=t.memoizedState,0!==(64&t.effectTag)){t.expirationTime=a,Po=t;break e}u=null!==u,a=null!==l&&null!==l.memoizedState,null!==l&&!u&&a&&(null!==(l=l.child.sibling)&&(null!==(c=t.firstEffect)?(t.firstEffect=l,l.nextEffect=c):(t.firstEffect=t.lastEffect=l,l.nextEffect=null),l.effectTag=8)),(u||a)&&(t.effectTag|=4);break;case 7:case 8:case 12:break;case 4:Ti(),ao(t);break;case 10:Al(t);break;case 9:case 14:break;case 17:zr(t.type)&&Ir();break;case 18:break;default:o(\"156\")}Po=null}if(t=e,1===Oo||1!==t.childExpirationTime){for(u=0,a=t.child;null!==a;)(l=a.expirationTime)>u&&(u=l),(c=a.childExpirationTime)>u&&(u=c),a=a.sibling;t.childExpirationTime=u}if(null!==Po)return Po;null!==n&&0===(1024&n.effectTag)&&(null===n.firstEffect&&(n.firstEffect=e.firstEffect),null!==e.lastEffect&&(null!==n.lastEffect&&(n.lastEffect.nextEffect=e.firstEffect),n.lastEffect=e.lastEffect),1<e.effectTag&&(null!==n.lastEffect?n.lastEffect.nextEffect=e:n.firstEffect=e,n.lastEffect=e))}else{if(null!==(e=To(e)))return e.effectTag&=1023,e;null!==n&&(n.firstEffect=n.lastEffect=null,n.effectTag|=1024)}if(null!==r)return r;if(null===n)break;e=n}return null}function Qo(e){var t=Ml(e.alternate,e,Oo);return e.memoizedProps=e.pendingProps,null===t&&(t=$o(e)),So.current=null,t}function Ko(e,t){Co&&o(\"243\"),Bo(),Co=!0;var n=_o.current;_o.current=ul;var r=e.nextExpirationTimeToWorkOn;r===Oo&&e===No&&null!==Po||(Ao(),Oo=r,Po=Kr((No=e).current,null),e.pendingCommitExpirationTime=0);for(var i=!1;;){try{if(t)for(;null!==Po&&!Ea();)Po=Qo(Po);else for(;null!==Po;)Po=Qo(Po)}catch(y){if(Fl=Ul=Il=null,Gi(),null===Po)i=!0,La(y);else{null===Po&&o(\"271\");var l=Po,a=l.return;if(null!==a){e:{var u=e,c=a,s=l,f=y;if(a=Oo,s.effectTag|=1024,s.firstEffect=s.lastEffect=null,null!==f&&\"object\"===typeof f&&\"function\"===typeof f.then){var d=f;f=c;var p=-1,m=-1;do{if(13===f.tag){var h=f.alternate;if(null!==h&&null!==(h=h.memoizedState)){m=10*(1073741822-h.timedOutAt);break}\"number\"===typeof(h=f.pendingProps.maxDuration)&&(0>=h?p=0:(-1===p||h<p)&&(p=h))}f=f.return}while(null!==f);f=c;do{if((h=13===f.tag)&&(h=void 0!==f.memoizedProps.fallback&&null===f.memoizedState),h){if(null===(c=f.updateQueue)?((c=new Set).add(d),f.updateQueue=c):c.add(d),0===(1&f.mode)){f.effectTag|=64,s.effectTag&=-1957,1===s.tag&&(null===s.alternate?s.tag=17:((a=Yl(1073741823)).tag=Hl,Gl(s,a))),s.expirationTime=1073741823;break e}c=a;var v=(s=u).pingCache;null===v?(v=s.pingCache=new wo,h=new Set,v.set(d,h)):void 0===(h=v.get(d))&&(h=new Set,v.set(d,h)),h.has(c)||(h.add(c),s=Xo.bind(null,s,d,c),d.then(s,s)),-1===p?u=1073741823:(-1===m&&(m=10*(1073741822-ti(u,a))-5e3),u=m+p),0<=u&&Ro<u&&(Ro=u),f.effectTag|=2048,f.expirationTime=a;break e}f=f.return}while(null!==f);f=Error((at(s.type)||\"A React component\")+\" suspended while rendering, but no fallback UI was specified.\\n\\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.\"+ut(s))}Lo=!0,f=io(f,s),u=c;do{switch(u.tag){case 3:u.effectTag|=2048,u.expirationTime=a,Jl(u,a=ko(u,f,a));break e;case 1:if(p=f,m=u.type,s=u.stateNode,0===(64&u.effectTag)&&(\"function\"===typeof m.getDerivedStateFromError||null!==s&&\"function\"===typeof s.componentDidCatch&&(null===Do||!Do.has(s)))){u.effectTag|=2048,u.expirationTime=a,Jl(u,a=xo(u,p,a));break e}}u=u.return}while(null!==u)}Po=$o(l);continue}i=!0,La(y)}}break}if(Co=!1,_o.current=n,Fl=Ul=Il=null,Gi(),i)No=null,e.finishedWork=null;else if(null!==Po)e.finishedWork=null;else{if(null===(n=e.current.alternate)&&o(\"281\"),No=null,Lo){if(i=e.latestPendingTime,l=e.latestSuspendedTime,a=e.latestPingedTime,0!==i&&i<r||0!==l&&l<r||0!==a&&a<r)return ei(e,r),void ka(e,n,r,e.expirationTime,-1);if(!e.didError&&t)return e.didError=!0,r=e.nextExpirationTimeToWorkOn=r,t=e.expirationTime=1073741823,void ka(e,n,r,t,-1)}t&&-1!==Ro?(ei(e,r),(t=10*(1073741822-ti(e,r)))<Ro&&(Ro=t),t=10*(1073741822-xa()),t=Ro-t,ka(e,n,r,e.expirationTime,0>t?0:t)):(e.pendingCommitExpirationTime=r,e.finishedWork=n)}}function qo(e,t){for(var n=e.return;null!==n;){switch(n.tag){case 1:var r=n.stateNode;if(\"function\"===typeof n.type.getDerivedStateFromError||\"function\"===typeof r.componentDidCatch&&(null===Do||!Do.has(r)))return Gl(n,e=xo(n,e=io(t,e),1073741823)),void Jo(n,1073741823);break;case 3:return Gl(n,e=ko(n,e=io(t,e),1073741823)),void Jo(n,1073741823)}n=n.return}3===e.tag&&(Gl(e,n=ko(e,n=io(t,e),1073741823)),Jo(e,1073741823))}function Yo(e,t){var n=l.unstable_getCurrentPriorityLevel(),r=void 0;if(0===(1&t.mode))r=1073741823;else if(Co&&!zo)r=Oo;else{switch(n){case l.unstable_ImmediatePriority:r=1073741823;break;case l.unstable_UserBlockingPriority:r=1073741822-10*(1+((1073741822-e+15)/10|0));break;case l.unstable_NormalPriority:r=1073741822-25*(1+((1073741822-e+500)/25|0));break;case l.unstable_LowPriority:case l.unstable_IdlePriority:r=1;break;default:o(\"313\")}null!==No&&r===Oo&&--r}return n===l.unstable_UserBlockingPriority&&(0===aa||r<aa)&&(aa=r),r}function Xo(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),null!==No&&Oo===n?No=null:(t=e.earliestSuspendedTime,r=e.latestSuspendedTime,0!==t&&n<=t&&n>=r&&(e.didError=!1,(0===(t=e.latestPingedTime)||t>n)&&(e.latestPingedTime=n),ni(n,e),0!==(n=e.expirationTime)&&Ta(e,n)))}function Go(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var r=e.return,i=null;if(null===r&&3===e.tag)i=e.stateNode;else for(;null!==r;){if(n=r.alternate,r.childExpirationTime<t&&(r.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===r.return&&3===r.tag){i=r.stateNode;break}r=r.return}return i}function Jo(e,t){null!==(e=Go(e,t))&&(!Co&&0!==Oo&&t>Oo&&Ao(),Zr(e,t),Co&&!zo&&No===e||Ta(e,e.expirationTime),ya>va&&(ya=0,o(\"185\")))}function Zo(e,t,n,r,i){return l.unstable_runWithPriority(l.unstable_ImmediatePriority,function(){return e(t,n,r,i)})}var ea=null,ta=null,na=0,ra=void 0,ia=!1,la=null,oa=0,aa=0,ua=!1,ca=null,sa=!1,fa=!1,da=null,pa=l.unstable_now(),ma=1073741822-(pa/10|0),ha=ma,va=50,ya=0,ga=null;function ba(){ma=1073741822-((l.unstable_now()-pa)/10|0)}function wa(e,t){if(0!==na){if(t<na)return;null!==ra&&l.unstable_cancelCallback(ra)}na=t,e=l.unstable_now()-pa,ra=l.unstable_scheduleCallback(Ca,{timeout:10*(1073741822-t)-e})}function ka(e,t,n,r,i){e.expirationTime=r,0!==i||Ea()?0<i&&(e.timeoutHandle=br(function(e,t,n){e.pendingCommitExpirationTime=n,e.finishedWork=t,ba(),ha=ma,Na(e,n)}.bind(null,e,t,n),i)):(e.pendingCommitExpirationTime=n,e.finishedWork=t)}function xa(){return ia?ha:(_a(),0!==oa&&1!==oa||(ba(),ha=ma),ha)}function Ta(e,t){null===e.nextScheduledRoot?(e.expirationTime=t,null===ta?(ea=ta=e,e.nextScheduledRoot=e):(ta=ta.nextScheduledRoot=e).nextScheduledRoot=ea):t>e.expirationTime&&(e.expirationTime=t),ia||(sa?fa&&(la=e,oa=1073741823,Oa(e,1073741823,!1)):1073741823===t?Pa(1073741823,!1):wa(e,t))}function _a(){var e=0,t=null;if(null!==ta)for(var n=ta,r=ea;null!==r;){var i=r.expirationTime;if(0===i){if((null===n||null===ta)&&o(\"244\"),r===r.nextScheduledRoot){ea=ta=r.nextScheduledRoot=null;break}if(r===ea)ea=i=r.nextScheduledRoot,ta.nextScheduledRoot=i,r.nextScheduledRoot=null;else{if(r===ta){(ta=n).nextScheduledRoot=ea,r.nextScheduledRoot=null;break}n.nextScheduledRoot=r.nextScheduledRoot,r.nextScheduledRoot=null}r=n.nextScheduledRoot}else{if(i>e&&(e=i,t=r),r===ta)break;if(1073741823===e)break;n=r,r=r.nextScheduledRoot}}la=t,oa=e}var Sa=!1;function Ea(){return!!Sa||!!l.unstable_shouldYield()&&(Sa=!0)}function Ca(){try{if(!Ea()&&null!==ea){ba();var e=ea;do{var t=e.expirationTime;0!==t&&ma<=t&&(e.nextExpirationTimeToWorkOn=ma),e=e.nextScheduledRoot}while(e!==ea)}Pa(0,!0)}finally{Sa=!1}}function Pa(e,t){if(_a(),t)for(ba(),ha=ma;null!==la&&0!==oa&&e<=oa&&!(Sa&&ma>oa);)Oa(la,oa,ma>oa),_a(),ba(),ha=ma;else for(;null!==la&&0!==oa&&e<=oa;)Oa(la,oa,!1),_a();if(t&&(na=0,ra=null),0!==oa&&wa(la,oa),ya=0,ga=null,null!==da)for(e=da,da=null,t=0;t<e.length;t++){var n=e[t];try{n._onComplete()}catch(r){ua||(ua=!0,ca=r)}}if(ua)throw e=ca,ca=null,ua=!1,e}function Na(e,t){ia&&o(\"253\"),la=e,oa=t,Oa(e,t,!1),Pa(1073741823,!1)}function Oa(e,t,n){if(ia&&o(\"245\"),ia=!0,n){var r=e.finishedWork;null!==r?Ra(e,r,t):(e.finishedWork=null,-1!==(r=e.timeoutHandle)&&(e.timeoutHandle=-1,wr(r)),Ko(e,n),null!==(r=e.finishedWork)&&(Ea()?e.finishedWork=r:Ra(e,r,t)))}else null!==(r=e.finishedWork)?Ra(e,r,t):(e.finishedWork=null,-1!==(r=e.timeoutHandle)&&(e.timeoutHandle=-1,wr(r)),Ko(e,n),null!==(r=e.finishedWork)&&Ra(e,r,t));ia=!1}function Ra(e,t,n){var r=e.firstBatch;if(null!==r&&r._expirationTime>=n&&(null===da?da=[r]:da.push(r),r._defer))return e.finishedWork=t,void(e.expirationTime=0);e.finishedWork=null,e===ga?ya++:(ga=e,ya=0),l.unstable_runWithPriority(l.unstable_ImmediatePriority,function(){Ho(e,t)})}function La(e){null===la&&o(\"246\"),la.expirationTime=0,ua||(ua=!0,ca=e)}function Ma(e,t){var n=sa;sa=!0;try{return e(t)}finally{(sa=n)||ia||Pa(1073741823,!1)}}function za(e,t){if(sa&&!fa){fa=!0;try{return e(t)}finally{fa=!1}}return e(t)}function Ia(e,t,n){sa||ia||0===aa||(Pa(aa,!1),aa=0);var r=sa;sa=!0;try{return l.unstable_runWithPriority(l.unstable_UserBlockingPriority,function(){return e(t,n)})}finally{(sa=r)||ia||Pa(1073741823,!1)}}function Ua(e,t,n,r,i){var l=t.current;e:if(n){t:{2===tn(n=n._reactInternalFiber)&&1===n.tag||o(\"170\");var a=n;do{switch(a.tag){case 3:a=a.stateNode.context;break t;case 1:if(zr(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break t}}a=a.return}while(null!==a);o(\"171\"),a=void 0}if(1===n.tag){var u=n.type;if(zr(u)){n=Dr(n,u,a);break e}}n=a}else n=Nr;return null===t.context?t.context=n:t.pendingContext=n,t=i,(i=Yl(r)).payload={element:e},null!==(t=void 0===t?null:t)&&(i.callback=t),Bo(),Gl(l,i),Jo(l,r),r}function Fa(e,t,n,r){var i=t.current;return Ua(e,t,n,i=Yo(xa(),i),r)}function Da(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Aa(e){var t=1073741822-25*(1+((1073741822-xa()+500)/25|0));t>=Eo&&(t=Eo-1),this._expirationTime=Eo=t,this._root=e,this._callbacks=this._next=null,this._hasChildren=this._didComplete=!1,this._children=null,this._defer=!0}function ja(){this._callbacks=null,this._didCommit=!1,this._onCommit=this._onCommit.bind(this)}function Wa(e,t,n){e={current:t=$r(3,null,null,t?3:0),containerInfo:e,pendingChildren:null,pingCache:null,earliestPendingTime:0,latestPendingTime:0,earliestSuspendedTime:0,latestSuspendedTime:0,latestPingedTime:0,didError:!1,pendingCommitExpirationTime:0,finishedWork:null,timeoutHandle:-1,context:null,pendingContext:null,hydrate:n,nextExpirationTimeToWorkOn:0,expirationTime:0,firstBatch:null,nextScheduledRoot:null},this._internalRoot=t.stateNode=e}function Va(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||\" react-mount-point-unstable \"!==e.nodeValue))}function Ba(e,t,n,r,i){var l=n._reactRootContainer;if(l){if(\"function\"===typeof i){var o=i;i=function(){var e=Da(l._internalRoot);o.call(e)}}null!=e?l.legacy_renderSubtreeIntoContainer(e,t,i):l.render(t,i)}else{if(l=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute(\"data-reactroot\"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new Wa(e,!1,t)}(n,r),\"function\"===typeof i){var a=i;i=function(){var e=Da(l._internalRoot);a.call(e)}}za(function(){null!=e?l.legacy_renderSubtreeIntoContainer(e,t,i):l.render(t,i)})}return Da(l._internalRoot)}function Ha(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return Va(t)||o(\"200\"),function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:qe,key:null==r?null:\"\"+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)}Ee=function(e,t,n){switch(t){case\"input\":if(xt(e,n),t=n.name,\"radio\"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll(\"input[name=\"+JSON.stringify(\"\"+t)+'][type=\"radio\"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=D(r);i||o(\"90\"),Be(r),xt(r,i)}}}break;case\"textarea\":Gn(e,n);break;case\"select\":null!=(t=n.value)&&qn(e,!!n.multiple,t,!1)}},Aa.prototype.render=function(e){this._defer||o(\"250\"),this._hasChildren=!0,this._children=e;var t=this._root._internalRoot,n=this._expirationTime,r=new ja;return Ua(e,t,null,n,r._onCommit),r},Aa.prototype.then=function(e){if(this._didComplete)e();else{var t=this._callbacks;null===t&&(t=this._callbacks=[]),t.push(e)}},Aa.prototype.commit=function(){var e=this._root._internalRoot,t=e.firstBatch;if(this._defer&&null!==t||o(\"251\"),this._hasChildren){var n=this._expirationTime;if(t!==this){this._hasChildren&&(n=this._expirationTime=t._expirationTime,this.render(this._children));for(var r=null,i=t;i!==this;)r=i,i=i._next;null===r&&o(\"251\"),r._next=i._next,this._next=t,e.firstBatch=this}this._defer=!1,Na(e,n),t=this._next,this._next=null,null!==(t=e.firstBatch=t)&&t._hasChildren&&t.render(t._children)}else this._next=null,this._defer=!1},Aa.prototype._onComplete=function(){if(!this._didComplete){this._didComplete=!0;var e=this._callbacks;if(null!==e)for(var t=0;t<e.length;t++)(0,e[t])()}},ja.prototype.then=function(e){if(this._didCommit)e();else{var t=this._callbacks;null===t&&(t=this._callbacks=[]),t.push(e)}},ja.prototype._onCommit=function(){if(!this._didCommit){this._didCommit=!0;var e=this._callbacks;if(null!==e)for(var t=0;t<e.length;t++){var n=e[t];\"function\"!==typeof n&&o(\"191\",n),n()}}},Wa.prototype.render=function(e,t){var n=this._internalRoot,r=new ja;return null!==(t=void 0===t?null:t)&&r.then(t),Fa(e,n,null,r._onCommit),r},Wa.prototype.unmount=function(e){var t=this._internalRoot,n=new ja;return null!==(e=void 0===e?null:e)&&n.then(e),Fa(null,t,null,n._onCommit),n},Wa.prototype.legacy_renderSubtreeIntoContainer=function(e,t,n){var r=this._internalRoot,i=new ja;return null!==(n=void 0===n?null:n)&&i.then(n),Fa(t,r,e,i._onCommit),i},Wa.prototype.createBatch=function(){var e=new Aa(this),t=e._expirationTime,n=this._internalRoot,r=n.firstBatch;if(null===r)n.firstBatch=e,e._next=null;else{for(n=null;null!==r&&r._expirationTime>=t;)n=r,r=r._next;e._next=r,null!==n&&(n._next=e)}return e},Le=Ma,Me=Ia,ze=function(){ia||0===aa||(Pa(aa,!1),aa=0)};var $a={createPortal:Ha,findDOMNode:function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;return void 0===t&&(\"function\"===typeof e.render?o(\"188\"):o(\"268\",Object.keys(e))),e=null===(e=rn(t))?null:e.stateNode},hydrate:function(e,t,n){return Va(t)||o(\"200\"),Ba(null,e,t,!0,n)},render:function(e,t,n){return Va(t)||o(\"200\"),Ba(null,e,t,!1,n)},unstable_renderSubtreeIntoContainer:function(e,t,n,r){return Va(n)||o(\"200\"),(null==e||void 0===e._reactInternalFiber)&&o(\"38\"),Ba(e,t,n,!1,r)},unmountComponentAtNode:function(e){return Va(e)||o(\"40\"),!!e._reactRootContainer&&(za(function(){Ba(null,null,e,!1,function(){e._reactRootContainer=null})}),!0)},unstable_createPortal:function(){return Ha.apply(void 0,arguments)},unstable_batchedUpdates:Ma,unstable_interactiveUpdates:Ia,flushSync:function(e,t){ia&&o(\"187\");var n=sa;sa=!0;try{return Zo(e,t)}finally{sa=n,Pa(1073741823,!1)}},unstable_createRoot:function(e,t){return Va(e)||o(\"299\",\"unstable_createRoot\"),new Wa(e,!0,null!=t&&!0===t.hydrate)},unstable_flushControlled:function(e){var t=sa;sa=!0;try{Zo(e)}finally{(sa=t)||ia||Pa(1073741823,!1)}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{Events:[U,F,D,N.injectEventPluginsByName,g,H,function(e){E(e,B)},Oe,Re,Pn,R]}};!function(e){var t=e.findFiberByHostInstance;(function(e){if(\"undefined\"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);Wr=Br(function(e){return t.onCommitFiberRoot(n,e)}),Vr=Br(function(e){return t.onCommitFiberUnmount(n,e)})}catch(r){}})(i({},e,{overrideProps:null,currentDispatcherRef:He.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=rn(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null}}))}({findFiberByHostInstance:I,bundleType:0,version:\"16.8.2\",rendererPackageName:\"react-dom\"});var Qa={default:$a},Ka=Qa&&$a||Qa;e.exports=Ka.default||Ka},function(e,t,n){\"use strict\";e.exports=n(21)},function(e,t,n){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=null,r=!1,i=3,l=-1,o=-1,a=!1,u=!1;function c(){if(!a){var e=n.expirationTime;u?T():u=!0,x(d,e)}}function s(){var e=n,t=n.next;if(n===t)n=null;else{var r=n.previous;n=r.next=t,t.previous=r}e.next=e.previous=null,r=e.callback,t=e.expirationTime,e=e.priorityLevel;var l=i,a=o;i=e,o=t;try{var u=r()}finally{i=l,o=a}if(\"function\"===typeof u)if(u={callback:u,priorityLevel:e,expirationTime:t,next:null,previous:null},null===n)n=u.next=u.previous=u;else{r=null,e=n;do{if(e.expirationTime>=t){r=e;break}e=e.next}while(e!==n);null===r?r=n:r===n&&(n=u,c()),(t=r.previous).next=r.previous=u,u.next=r,u.previous=t}}function f(){if(-1===l&&null!==n&&1===n.priorityLevel){a=!0;try{do{s()}while(null!==n&&1===n.priorityLevel)}finally{a=!1,null!==n?c():u=!1}}}function d(e){a=!0;var i=r;r=e;try{if(e)for(;null!==n;){var l=t.unstable_now();if(!(n.expirationTime<=l))break;do{s()}while(null!==n&&n.expirationTime<=l)}else if(null!==n)do{s()}while(null!==n&&!_())}finally{a=!1,r=i,null!==n?c():u=!1,f()}}var p,m,h=Date,v=\"function\"===typeof setTimeout?setTimeout:void 0,y=\"function\"===typeof clearTimeout?clearTimeout:void 0,g=\"function\"===typeof requestAnimationFrame?requestAnimationFrame:void 0,b=\"function\"===typeof cancelAnimationFrame?cancelAnimationFrame:void 0;function w(e){p=g(function(t){y(m),e(t)}),m=v(function(){b(p),e(t.unstable_now())},100)}if(\"object\"===typeof performance&&\"function\"===typeof performance.now){var k=performance;t.unstable_now=function(){return k.now()}}else t.unstable_now=function(){return h.now()};var x,T,_,S=null;if(\"undefined\"!==typeof window?S=window:\"undefined\"!==typeof e&&(S=e),S&&S._schedMock){var E=S._schedMock;x=E[0],T=E[1],_=E[2],t.unstable_now=E[3]}else if(\"undefined\"===typeof window||\"function\"!==typeof MessageChannel){var C=null,P=function(e){if(null!==C)try{C(e)}finally{C=null}};x=function(e){null!==C?setTimeout(x,0,e):(C=e,setTimeout(P,0,!1))},T=function(){C=null},_=function(){return!1}}else{\"undefined\"!==typeof console&&(\"function\"!==typeof g&&console.error(\"This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills\"),\"function\"!==typeof b&&console.error(\"This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills\"));var N=null,O=!1,R=-1,L=!1,M=!1,z=0,I=33,U=33;_=function(){return z<=t.unstable_now()};var F=new MessageChannel,D=F.port2;F.port1.onmessage=function(){O=!1;var e=N,n=R;N=null,R=-1;var r=t.unstable_now(),i=!1;if(0>=z-r){if(!(-1!==n&&n<=r))return L||(L=!0,w(A)),N=e,void(R=n);i=!0}if(null!==e){M=!0;try{e(i)}finally{M=!1}}};var A=function e(t){if(null!==N){w(e);var n=t-z+U;n<U&&I<U?(8>n&&(n=8),U=n<I?I:n):I=n,z=t+U,O||(O=!0,D.postMessage(void 0))}else L=!1};x=function(e,t){N=e,R=t,M||0>t?D.postMessage(void 0):L||(L=!0,w(A))},T=function(){N=null,O=!1,R=-1}}t.unstable_ImmediatePriority=1,t.unstable_UserBlockingPriority=2,t.unstable_NormalPriority=3,t.unstable_IdlePriority=5,t.unstable_LowPriority=4,t.unstable_runWithPriority=function(e,n){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=i,o=l;i=e,l=t.unstable_now();try{return n()}finally{i=r,l=o,f()}},t.unstable_next=function(e){switch(i){case 1:case 2:case 3:var n=3;break;default:n=i}var r=i,o=l;i=n,l=t.unstable_now();try{return e()}finally{i=r,l=o,f()}},t.unstable_scheduleCallback=function(e,r){var o=-1!==l?l:t.unstable_now();if(\"object\"===typeof r&&null!==r&&\"number\"===typeof r.timeout)r=o+r.timeout;else switch(i){case 1:r=o+-1;break;case 2:r=o+250;break;case 5:r=o+1073741823;break;case 4:r=o+1e4;break;default:r=o+5e3}if(e={callback:e,priorityLevel:i,expirationTime:r,next:null,previous:null},null===n)n=e.next=e.previous=e,c();else{o=null;var a=n;do{if(a.expirationTime>r){o=a;break}a=a.next}while(a!==n);null===o?o=n:o===n&&(n=e,c()),(r=o.previous).next=o.previous=e,e.next=o,e.previous=r}return e},t.unstable_cancelCallback=function(e){var t=e.next;if(null!==t){if(t===e)n=null;else{e===n&&(n=t);var r=e.previous;r.next=t,t.previous=r}e.next=e.previous=null}},t.unstable_wrapCallback=function(e){var n=i;return function(){var r=i,o=l;i=n,l=t.unstable_now();try{return e.apply(this,arguments)}finally{i=r,l=o,f()}}},t.unstable_getCurrentPriorityLevel=function(){return i},t.unstable_shouldYield=function(){return!r&&(null!==n&&n.expirationTime<o||_())},t.unstable_continueExecution=function(){null!==n&&c()},t.unstable_pauseExecution=function(){},t.unstable_getFirstCallbackNode=function(){return n}}).call(this,n(22))},function(e,t){var n;n=function(){return this}();try{n=n||Function(\"return this\")()||(0,eval)(\"this\")}catch(r){\"object\"===typeof window&&(n=window)}e.exports=n}]]);//# sourceMappingURL=1.84e4dc26.chunk.js.map</script><script>(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,,,function(e,t,a){e.exports=a.p+\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiB2aWV3Qm94PSIwIDAgNjEyIDYxMiI+PHBhdGggZD0iTTU4Ny41NzIgMTg2Ljg4MWMtMzIuMjY2LTc1LjIyNS04Ny4wOTYtMTI5LjkzNC0xNjIuOTQ5LTE2Mi4yODVDMzg2LjcxMSA4LjQyNyAzNDcuMzI4LjE2OCAzMDUuODMyLjE2OGMtNDEuNDg4IDAtODAuOTE0IDguMTgxLTExOC43ODQgMjQuNDI4LTc1LjIyNCAzMi4yNjUtMTMwLjYzMyA4Ni45MzktMTYyLjk1NiAxNjIuMjg1QzcuODk1IDIyNC42MjkgMCAyNjQuMTc2IDAgMzA1LjY2NGMwIDQxLjQ5NiA3Ljg5NSA4MS4zNzEgMjQuMDkyIDExOS4xMjcgMzIuMzIzIDc1LjM0NiA4Ny43MzEgMTMwLjM0OCAxNjIuOTU2IDE2Mi42MjEgMzcuODcgMTYuMjQ3IDc3LjI5NSAyNC40MiAxMTguNzg0IDI0LjQyIDQxLjQ5NiAwIDgwLjg3OS04LjI1OSAxMTguNzkxLTI0LjQyIDc1Ljg1NC0zMi4zNTIgMTMwLjY4NC04Ny40MDMgMTYyLjk0OS0xNjIuNjIxQzYwMy44MTkgMzg2LjkxNCA2MTIgMzQ3LjE2IDYxMiAzMDUuNjY0YzAtNDEuNDg4LTguMTgxLTgwLjkwNy0yNC40MjgtMTE4Ljc4M3pNMjA0LjEwOSA1Ny4wNTRjLTI2LjQzNCAzMy40NTgtNDUuODM2IDc1Ljk1My01OC4yMjEgMTI3LjQ4NUg2NS45MTdjMjkuNDQ1LTU3LjIyMSA3OC45NzItMTAzLjA2NCAxMzguMTkyLTEyNy40ODV6TTM3LjE0MSAzMDUuNjY0YzAtMjkuMTEgNC42ODMtNTcuMjE0IDEzLjcyLTg0LjMxOWg4Ny42NjdjLTQuMzQ4IDI4LjQzOS02LjM2IDU2LjU1MS02LjM2IDg0LjMxOSAwIDI3LjQ0IDIuMDEzIDU1LjIxNyA2LjM2IDgzLjY1Nkg1MC4xOWMtOC43MDEtMjcuMTA1LTEzLjA0OS01NS4yMDktMTMuMDQ5LTgzLjY1NnptMjguNzc2IDEyMC40NjJoNzkuOTcyYzEyLjM4NSA1Mi41MzEgMzEuNzg4IDk1LjY5NyA1OC4yMjEgMTI4LjgyNy02MC4yMjgtMjUuMDk5LTEwOS43NTQtNzAuOTQxLTEzOC4xOTMtMTI4LjgyN3ptMjIxLjE3NyAxNDUuNTUzYy0yMS43NTEtNi4zNTQtNDIuMTYtMjIuNDE1LTYwLjU2Mi00OC41MTMtMTguNDAzLTI2LjEwNS0zMi40NTgtNTguNTU3LTQyLjE2LTk3LjA0aDEwMi43MjJ2MTQ1LjU1M3ptMC0xODIuMzU5SDE3Ni4wMDVjLTQuMzU0LTI5Ljc4Mi02LjY5Ni01Ny41NTgtNi42OTYtODMuNjU2IDAtMjguMTA0IDIuMzQxLTU2LjIxNSA3LjM2Ny04NC4zMTloMTEwLjQxN1YzODkuMzJoLjAwMXptMC0yMDQuNzhIMTg0LjM3MmMxMC4zNzItMzguMTQ4IDI0LjUwNi03MC4yMTQgNDIuODMxLTk2LjAzNCAxOC40ODEtMjYuMDQ4IDM4LjE0MS00Mi4xNiA1OS44OTItNDguMTg1VjE4NC41NHptMjU4Ljk5IDBoLTc5Ljk3M2MtMTIuMzc4LTUxLjUzMy0zMS43ODctOTQuMDI4LTU4LjIyMS0xMjcuNDg1IDU5LjIyOCAyNC40MiAxMDguNzQ4IDcwLjI2MyAxMzguMTk0IDEyNy40ODV6TTMyNC45MDYgNDAuMzIxYzIxLjc1MSA2LjAyNSA0MS40MSAyMi4xMzcgNTkuODkyIDQ4LjE4NSAxOC4zMzEgMjUuODIgMzIuNDU4IDU3Ljg4NiA0Mi44MyA5Ni4wMzRIMzI0LjkwNlY0MC4zMjF6bTAgMTgxLjAyNGgxMTAuNDE3YzUuMDI1IDI4LjEwNCA3LjM2NyA1Ni4yMTUgNy4zNjcgODQuMzE5IDAgMjYuMDk5LTIuMzQyIDUzLjg3NC02LjY5NiA4My42NTZIMzI0LjkwNlYyMjEuMzQ1em0wIDM1MC4zMzRWNDI2LjEyNmgxMDIuNzIyYy0xMC4wMzYgMzguNDgzLTI0LjI3NyA3MC44MDYtNDIuNDk1IDk3LjA0LTE4LjI2IDI2LjI5OC0zOC4xNDEgNDIuNDk1LTYwLjIyNyA0OC41MTN6bTgyLjk4NS0xNi43MjZjMjYuNDM0LTMzLjEzIDQ1Ljg0My03Ni4yOTYgNTguMjIxLTEyOC44MjdoNzkuOTczYy0yOC40NCA1Ny44ODYtNzcuOTY4IDEwMy43MjgtMTM4LjE5NCAxMjguODI3ek01NjEuODEgMzg5LjMyaC04OC4zMzhhNTUwLjc1NiA1NTAuNzU2IDAgMCAwIDYuMzYtODMuNjU2YzAtMjcuNzY4LTIuMDA2LTU1Ljg3OS02LjM2LTg0LjMxOWg4Ny42NjdjOS4wMzcgMjcuMTA0IDEzLjcyIDU1LjIwOCAxMy43MiA4NC4zMTktLjAwMSAyOC40NDctNC4zNDcgNTYuNTUxLTEzLjA0OSA4My42NTZ6IiBmaWxsPSIjRkZGIi8+PC9zdmc+\"},function(e,t,a){e.exports=a.p+\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiB2aWV3Qm94PSIwIDAgNjEyIDYxMiI+PHBhdGggZD0iTTU2MSA3Ni41SDE3OC41Yy0xNy44NSAwLTMwLjYgNy42NS00MC44IDIyLjk1TDAgMzA2bDEzNy43IDIwNi41NWMxMC4yIDEyLjc1IDIyLjk1IDIyLjk1IDQwLjggMjIuOTVINTYxYzI4LjA1IDAgNTEtMjIuOTUgNTEtNTF2LTM1N2MwLTI4LjA1LTIyLjk1LTUxLTUxLTUxem0tNzYuNSAzMjEuM2wtMzUuNyAzNS43LTkxLjgtOTEuOC05MS44IDkxLjgtMzUuNy0zNS43IDkxLjgtOTEuOC05MS44LTkxLjggMzUuNy0zNS43IDkxLjggOTEuOCA5MS44LTkxLjggMzUuNyAzNS43LTkxLjggOTEuOCA5MS44IDkxLjh6IiBmaWxsPSIjN2E5MjlmIi8+PC9zdmc+Cg==\"},function(e,t,a){e.exports=a.p+\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNC4xIDI0LjEiPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0yMy4xIDE3LjA1Yy42IDAgMS0uNCAxLTF2LTEzYzAtLjYtLjQtMS0xLTFoLTJjLS42IDAtMSAuNC0xIDF2OS41YzAgLjMtLjIuNS0uNS41SDguNWMtLjQgMC0uNy0uNS0uNC0uOWwxLTFjLjItLjIuMy0uNC4zLS43IDAtLjMtLjEtLjUtLjMtLjdsLTEuNC0xLjRjLS4yLS4yLS40LS4zLS43LS4zLS4zIDAtLjUuMS0uNy4zbC02IDZjLS4yLjItLjMuNS0uMy43cy4xLjUuMy43bDYgNmMuMi4yLjQuMy43LjMuMyAwIC41LS4xLjctLjNsMS40LTEuNGMuMi0uMi4zLS40LjMtLjdzLS4xLS41LS4zLS43bC0xLTFjLS4zLS4zLS4xLS45LjQtLjloMTQuNnoiLz48L3N2Zz4K\"},function(e,t,a){e.exports=a.p+\"data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjZmZmIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0ODQuNSIgaGVpZ2h0PSI0ODQuNSI+PHBhdGggZD0iTTI0Mi4yNSAzMDZjNDMuMzUgMCA3Ni41LTMzLjE1IDc2LjUtNzYuNXYtMTUzYzAtNDMuMzUtMzMuMTUtNzYuNS03Ni41LTc2LjVzLTc2LjUgMzMuMTUtNzYuNSA3Ni41djE1M2MwIDQzLjM1IDMzLjE1IDc2LjUgNzYuNSA3Ni41em0xMzUuMTUtNzYuNWMwIDc2LjUtNjMuNzUgMTMwLjA1LTEzNS4xNSAxMzAuMDVTMTA3LjEgMzA2IDEwNy4xIDIyOS41SDYzLjc1YzAgODYuNyA2OC44NSAxNTguMSAxNTMgMTcwLjg1djg0LjE1aDUxdi04NC4xNWM4NC4xNS0xMi43NSAxNTMtODQuMTQ5IDE1My0xNzAuODVIMzc3LjR6Ii8+PC9zdmc+Cg==\"},,function(e,t,a){e.exports=a(39)},,,,,,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){\"use strict\";a.r(t);var n,r=a(0),i=a.n(r),c=a(11),o=a.n(c),s=(a(23),a(2)),u=a(3),l=a(4),y=a(1),h=a(5);a(25);!function(e){e[e.DOWN=0]=\"DOWN\",e[e.DOWN_CONTINUOUSLY=1]=\"DOWN_CONTINUOUSLY\",e[e.UP=2]=\"UP\",e[e.NORMAL=3]=\"NORMAL\"}(n||(n={}));var p,d=function(e){function t(){var e,a;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),c=0;c<r;c++)i[c]=arguments[c];return(a=Object(l.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(i)))).state={keyState:n.NORMAL},a._clearTimers=function(){clearTimeout(a._keyUpTimeoutId),clearTimeout(a._keyDownTimeoutId),clearInterval(a._keyDownContinuouslyIntervalId)},a._handleMouseDown=function(){a._clearTimers(),a.setState({keyState:n.DOWN}),a.props.definition.onClick(),a._keyDownTimeoutId=setTimeout(function(){a.setState({keyState:n.DOWN_CONTINUOUSLY}),a._keyDownContinuouslyIntervalId=setInterval(a.props.definition.onClick,100)},1e3)},a._handleMouseUp=function(){a._clearTimers(),a.setState({keyState:n.UP}),a._keyUpTimeoutId=setTimeout(function(){return a.setState({keyState:n.NORMAL})},1e3)},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"componentWillUnmount\",value:function(){this._clearTimers()}},{key:\"render\",value:function(){var e=[\"key-component\"];switch(this.props.className&&e.push(this.props.className),this.state.keyState){case n.DOWN:case n.DOWN_CONTINUOUSLY:e.push(\"key-down\");break;case n.UP:e.push(\"key-up\")}return i.a.createElement(\"div\",{className:e.join(\" \"),onMouseDown:this._handleMouseDown,onMouseUp:this._handleMouseUp},this.props.children||this.props.definition.value)}}]),t}(r.Component),f=function e(t,a){var n=this;Object(s.a)(this,e),this.value=t,this._clickHandler=a,this.onClick=function(){n._clickHandler&&n._clickHandler(n)}};!function(e){e.SET_LANGUAGE=\"keyboard.setLanguage\",e.VOICE_RECOGNITION_DISABLED=\"keyboard.voiceRecognitionDisabled\",e.VOICE_RECOGNITION_ENABLED=\"keyboard.voiceRecognitionEnabled\",e.VOICE_RECOGNITION_FINISHED=\"keyboard.voiceRecognitionFinished\",e.VOICE_RECOGNITION_STARTED=\"keyboard.voiceRecognitionStarted\",e.INPUT_RECEIVED=\"keyboard.inputReceived\",e.KEYBOARD_INITIALIZED=\"keyboard.initialized\",e.VOICE_RECOGNITION_FINISH_REQUESTED=\"keyboard.voiceRecognitionFinishRequested\",e.VOICE_RECOGNITION_START_REQUESTED=\"keyboard.voiceRecognitionStartRequested\"}(p||(p={}));var g=p;function m(e){window.vuplex&&window.vuplex.postMessage({type:g.INPUT_RECEIVED,value:e.value})}a(27);var v,O=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(l.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r))))._spacebarKeyDefinition=new f(\" \",m),a._renderKey=function(e){return i.a.createElement(d,{className:\"key\",definition:e,key:e.value})},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"render\",value:function(){return i.a.createElement(\"div\",{className:\"center-board\"},i.a.createElement(\"div\",{className:\"key-area\"},i.a.createElement(\"div\",{className:\"key-row\"},this.props.rows[0].map(this._renderKey)),i.a.createElement(\"div\",{className:\"key-row\"},i.a.createElement(\"div\",{className:\"key-offset-margin\"}),this.props.rows[1].map(this._renderKey),i.a.createElement(\"div\",{className:\"key-offset-margin\"})),i.a.createElement(\"div\",{className:\"key-row\"},this.props.rows[2].map(this._renderKey)),i.a.createElement(\"div\",{className:\"key-row\"},this.props.rows[3].slice(0,2).map(this._renderKey),i.a.createElement(\"div\",{className:\"spacebar-container\"},i.a.createElement(d,{className:\"spacebar\",definition:this._spacebarKeyDefinition},this.props.spacebarText)),this.props.rows[3].slice(2).map(this._renderKey))))}}]),t}(r.Component),k=a(7),b=a(9),_=a.n(b),E=a(6),C=a(16),w=a(8);!function(e){e[e.LOWERCASE=0]=\"LOWERCASE\",e[e.UPPERCASE=1]=\"UPPERCASE\",e[e.CAPS_LOCK=2]=\"CAPS_LOCK\",e[e.SPECIAL=3]=\"SPECIAL\"}(v||(v={}));var S=v,j=(a(29),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"render\",value:function(){var e=[S.UPPERCASE,S.CAPS_LOCK].includes(this.props.keyboardLayout);return i.a.createElement(\"div\",{className:\"shift-key-icon\"},i.a.createElement(\"div\",{className:\"shift-arrow-triangle \".concat(e?\"shift-arrow-colored\":\"\")}),this._renderArrowLine(e))}},{key:\"_renderArrowLine\",value:function(e){return this.props.keyboardLayout===S.CAPS_LOCK?i.a.createElement(\"div\",{className:\"caps-lock-arrow-line\"},i.a.createElement(\"div\",{className:\"caps-lock-line-top\"}),i.a.createElement(\"div\",{className:\"caps-lock-line-middle\"}),i.a.createElement(\"div\",{className:\"caps-lock-line-bottom\"})):i.a.createElement(\"div\",{className:\"regular-arrow-line \".concat(e?\"shift-arrow-colored\":\"\")})}}]),t}(r.Component)),N=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(l.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r))))._layout=S.LOWERCASE,a._createSimpleKeyDefinition=function(e){return new f(e,a._handleSimpleKeyPress)},a._handleShiftKeyPressed=function(){switch(a._layout){case S.LOWERCASE:a._setLayout(S.UPPERCASE);break;case S.UPPERCASE:a._setLayout(S.CAPS_LOCK);break;default:a._setLayout(S.LOWERCASE)}},a._handleSimpleKeyPress=function(e){a._layout===S.UPPERCASE&&a._setLayout(S.LOWERCASE),m(e)},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getAlphabeticCharacterSetKeySymbol\",value:function(){return\"ABC\"}},{key:\"getCurrencyCharacters\",value:function(){return[\"$\",\"\\u20ac\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){return[[\"q\",\"w\",\"e\",\"r\",\"t\",\"y\",\"u\",\"i\",\"o\",\"p\"],[\"a\",\"s\",\"d\",\"f\",\"g\",\"h\",\"j\",\"k\",\"l\"],[\"z\",\"x\",\"c\",\"v\",\"b\",\"n\",\"m\",\"!\",\"?\"]]}},{key:\"getSpecialCharactersByRow\",value:function(){return[[\"@\",\"#\"].concat(Object(w.a)(this.getCurrencyCharacters()),[\"%\",\"&\",\"*\",\"-\",\"+\"]),[\"~\",\"`\",'\"',\"'\",\":\",\";\",\"_\",\"=\",\"\\\\\",\"/\"],[\"{\",\"}\",\"[\",\"]\",\"<\",\">\",\"^\",\"|\",\"(\",\")\"],[\"@\",\",\",\".\"]]}},{key:\"getRows\",value:function(){return this._layout===S.SPECIAL?this._getSpecialCharacterRows():this._getAlphabeticCharactersRows()}},{key:\"getUpperCaseCharactersByRow\",value:function(){return this.getLowerCaseCharactersByRow().map(function(e){return e.map(function(e){return e.toUpperCase()})})}},{key:\"_getAlphabeticCharactersRows\",value:function(){var e=[S.UPPERCASE,S.CAPS_LOCK].includes(this._layout)?this.getUpperCaseCharactersByRow():this.getLowerCaseCharactersByRow();return[e[0].map(this._createSimpleKeyDefinition),e[1].map(this._createSimpleKeyDefinition),[this._getShiftKey()].concat(Object(w.a)(e[2].map(this._createSimpleKeyDefinition))),[this._getSpecialCharacterSetKey()].concat(Object(w.a)([\"@\",\",\",\".\"].map(this._createSimpleKeyDefinition)))]}},{key:\"_getAlphabeticCharacterSetKey\",value:function(){var e=this,t=this.getAlphabeticCharacterSetKeySymbol();return new f(t,function(){return e._setLayout(S.LOWERCASE)})}},{key:\"_getShiftKey\",value:function(){return new f(i.a.createElement(j,{keyboardLayout:this._layout}),this._handleShiftKeyPressed)}},{key:\"_getSpecialCharacterRows\",value:function(){var e=this.getSpecialCharactersByRow(),t=Object(C.a)(e,4),a=t[0],n=t[1],r=t[2],i=t[3];return[a.map(this._createSimpleKeyDefinition),n.map(this._createSimpleKeyDefinition),r.map(this._createSimpleKeyDefinition),[this._getAlphabeticCharacterSetKey()].concat(Object(w.a)(i.map(this._createSimpleKeyDefinition)))]}},{key:\"_getSpecialCharacterSetKey\",value:function(){var e=this;return new f(\"#+=\",function(){return e._setLayout(S.SPECIAL)})}},{key:\"_setLayout\",value:function(e){this._layout=e,this.emit(\"layoutChanged\",this)}},{key:\"layout\",get:function(){return this._layout}}]),t}(_.a),R=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\xa3\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){var e=Object(E.a)(Object(y.a)(t.prototype),\"getLowerCaseCharactersByRow\",this).call(this);return e[0].push(\"\\xe5\"),e[1].push(\"\\xe6\",\"\\xf8\"),e}},{key:\"language\",get:function(){return\"Dansk\"}},{key:\"languageCode\",get:function(){return\"da\"}}]),t}(N),I=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"$\",\"\\u20ac\",\"\\xa3\",\"\\u20b9\"]}},{key:\"language\",get:function(){return\"English\"}},{key:\"languageCode\",get:function(){return\"en\"}}]),t}(N),L=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\u20ac\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){return[[\"a\",\"z\",\"e\",\"r\",\"t\",\"y\",\"u\",\"i\",\"o\",\"p\"],[\"q\",\"s\",\"d\",\"f\",\"g\",\"h\",\"j\",\"k\",\"l\",\"m\"],[\"z\",\"x\",\"c\",\"v\",\"b\",\"n\",\"'\",\"/\"]]}},{key:\"language\",get:function(){return\"Fran\\xe7ais\"}},{key:\"languageCode\",get:function(){return\"fr\"}}]),t}(N),A=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\u20ac\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){return[[\"q\",\"w\",\"e\",\"r\",\"t\",\"z\",\"u\",\"i\",\"o\",\"p\"],[\"a\",\"s\",\"d\",\"f\",\"g\",\"h\",\"j\",\"k\",\"l\"],[\"y\",\"x\",\"c\",\"v\",\"b\",\"n\",\"m\",\"!\",\"?\"]]}},{key:\"language\",get:function(){return\"Deutsche\"}},{key:\"languageCode\",get:function(){return\"de\"}}]),t}(N),D=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\xa3\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){var e=Object(E.a)(Object(y.a)(t.prototype),\"getLowerCaseCharactersByRow\",this).call(this);return e[0].push(\"\\xe5\"),e[1].push(\"\\xf8\",\"\\xe6\"),e}},{key:\"language\",get:function(){return\"Norsk\"}},{key:\"languageCode\",get:function(){return\"no\"}}]),t}(N),K=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\u20bd\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){return[[\"\\u0439\",\"\\u0446\",\"\\u0443\",\"\\u043a\",\"\\u0435\",\"\\u043d\",\"\\u0433\",\"\\u0448\",\"\\u0449\",\"\\u0437\",\"\\u0445\",\"\\u044a\"],[\"\\u0444\",\"\\u044b\",\"\\u0432\",\"\\u0430\",\"\\u043f\",\"\\u0440\",\"\\u043e\",\"\\u043b\",\"\\u0434\",\"\\u0436\",\"\\u044d\"],[\"\\u044f\",\"\\u0447\",\"\\u0441\",\"\\u043c\",\"\\u0438\",\"\\u0442\",\"\\u044c\",\"\\u0431\",\"\\u044e\",\"!\",\"?\"]]}},{key:\"getAlphabeticCharacterSetKeySymbol\",value:function(){return\"\\u0410\\u0411\\u0412\"}},{key:\"language\",get:function(){return\"\\u0440\\u0443\\u0441\\u0441\\u043a\\u0438\\u0439\"}},{key:\"languageCode\",get:function(){return\"ru\"}}]),t}(N),T=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"$\",\"\\u20ac\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){var e=Object(E.a)(Object(y.a)(t.prototype),\"getLowerCaseCharactersByRow\",this).call(this);return e[1].push(\"\\xf1\"),e}},{key:\"getSpecialCharactersByRow\",value:function(){var e=Object(E.a)(Object(y.a)(t.prototype),\"getSpecialCharactersByRow\",this).call(this);return e[3].splice(1,2,\"\\xba\",\"\\xaa\"),e}},{key:\"language\",get:function(){return\"Espa\\xf1ol\"}},{key:\"languageCode\",get:function(){return\"es\"}}]),t}(N),U=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\xa3\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){var e=Object(E.a)(Object(y.a)(t.prototype),\"getLowerCaseCharactersByRow\",this).call(this);return e[0].push(\"\\xe5\"),e[1].push(\"\\xf6\",\"\\xe4\"),e}},{key:\"language\",get:function(){return\"Svenska\"}},{key:\"languageCode\",get:function(){return\"sv\"}}]),t}(N),P=a(12),B=a.n(P),x=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(l.a)(this,Object(y.a)(t).call(this)))._keySetIndex=0,e._keySets=[new I,new T,new L,new A,new K,new R,new D,new U],e._handleLayoutChanged=function(){e.emit(\"layoutChanged\",Object(k.a)(Object(k.a)(e)))},e._handleSwitchLanguageKeyClick=function(){e._keySetIndex=e._keySetIndex>=e._keySets.length-1?0:e._keySetIndex+1,e.emit(\"layoutChanged\",Object(k.a)(Object(k.a)(e)))},e._keySets.forEach(function(t){return t.on(\"layoutChanged\",e._handleLayoutChanged)}),e}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getRows\",value:function(){var e=this._getKeySet().getRows();return e[3][1]=new f(this._getSwitchLanguageIcon(),this._handleSwitchLanguageKeyClick),e}},{key:\"setLanguage\",value:function(e){this._keySetIndex=this._keySets.findIndex(function(t){return t.languageCode===e}),-1===this._keySetIndex&&(this._keySetIndex=this._keySets.findIndex(function(e){return\"en\"===e.languageCode})),this.emit(\"layoutChanged\",this)}},{key:\"_getKeySet\",value:function(){return this._keySets[this._keySetIndex]}},{key:\"_getSwitchLanguageIcon\",value:function(){return i.a.createElement(\"img\",{style:{width:\"1.2em\",height:\"1.2em\"},src:B.a,alt:\"globe\"})}},{key:\"language\",get:function(){return this._getKeySet().language}},{key:\"layout\",get:function(){return this._getKeySet().layout}}]),t}(_.a),M=a(13),V=a.n(M),G=a(14),W=a.n(G),F=(a(31),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(l.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r))))._keyRows=[[new f(\"1\",m),new f(\"2\",m),new f(\"3\",m)],[new f(\"4\",m),new f(\"5\",m),new f(\"6\",m)],[new f(\"7\",m),new f(\"8\",m),new f(\"9\",m)],[new f(\".\",m),new f(\"0\",m),new f(\"-\",m)]],a._renderKeyRow=function(e,t){return i.a.createElement(\"div\",{className:\"key-row\",key:t},e.map(function(e){return i.a.createElement(d,{className:\"key\",definition:e,key:e.value})}))},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"render\",value:function(){return i.a.createElement(\"div\",{className:\"num-pad\"},i.a.createElement(\"div\",{className:\"key-area\"},this._keyRows.map(this._renderKeyRow)))}}]),t}(r.Component)),H=(a(33),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(l.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r))))._upKeyDefinition=new f(\"ArrowUp\",m),a._leftKeyDefinition=new f(\"ArrowLeft\",m),a._rightKeyDefinition=new f(\"ArrowRight\",m),a._downKeyDefinition=new f(\"ArrowDown\",m),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"render\",value:function(){return i.a.createElement(\"div\",{className:\"right-pad\"},i.a.createElement(\"div\",{className:\"key-area\"},i.a.createElement(\"div\",{className:\"right-key-area\"},i.a.createElement(\"div\",{className:\"arrow-pad\"},i.a.createElement(\"div\",{className:\"arrow-pad-row\"},i.a.createElement(d,{definition:this._upKeyDefinition},\"\\u25b2\")),i.a.createElement(\"div\",{className:\"arrow-pad-row arrow-pad-middle\"},i.a.createElement(d,{definition:this._leftKeyDefinition},i.a.createElement(\"span\",{style:{transform:\"rotate(-90deg)\"}},\"\\u25b2\")),i.a.createElement(d,{definition:this._rightKeyDefinition},i.a.createElement(\"span\",{style:{transform:\"rotate(90deg)\"}},\"\\u25b2\"))),i.a.createElement(\"div\",{className:\"arrow-pad-row\"},i.a.createElement(d,{definition:this._downKeyDefinition},i.a.createElement(\"span\",{style:{transform:\"rotate(180deg)\"}},\"\\u25b2\")))))))}}]),t}(r.Component)),Y=a(15),q=a.n(Y),z=(a(35),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"render\",value:function(){return i.a.createElement(\"div\",{className:\"voice-button \".concat(this.props.active?\"voice-button-active\":\"\"),onMouseDown:this.props.onMouseDown},i.a.createElement(\"div\",{className:\"voice-button-icon\"},i.a.createElement(\"div\",null,i.a.createElement(\"img\",{src:q.a,alt:\"voice control\"}))))}}]),t}(r.Component)),Q=(a(37),function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(y.a)(t).call(this,e)))._keySet=new x,a.state={language:a._keySet.language,layout:a._keySet.layout,voiceRecognitionEnabled:!1,voiceRecognitionActive:!1},a._backspaceKeyDefinition=new f(\"Backspace\",m),a._returnKeyDefinition=new f(\"Enter\",m),a._handleReceivedMessage=function(e){var t=JSON.parse(e.data);switch(t.type){case g.SET_LANGUAGE:a._keySet.setLanguage(t.value);break;case g.VOICE_RECOGNITION_DISABLED:a.setState({voiceRecognitionEnabled:!1});break;case g.VOICE_RECOGNITION_ENABLED:a.setState({voiceRecognitionEnabled:!0});break;case g.VOICE_RECOGNITION_FINISHED:a.setState({voiceRecognitionActive:!1});break;case g.VOICE_RECOGNITION_STARTED:a.setState({voiceRecognitionActive:!0})}},a._handleLayoutChange=function(e){return a.setState({language:e.language,layout:e.layout})},a._handleVoiceButtonMouseDown=function(e){e.preventDefault();var t=!a.state.voiceRecognitionActive;a.setState({voiceRecognitionActive:t}),window.vuplex.postMessage({type:t?g.VOICE_RECOGNITION_START_REQUESTED:g.VOICE_RECOGNITION_FINISH_REQUESTED})},a._initMessages=function(){window.vuplex.addEventListener(\"message\",a._handleReceivedMessage),window.vuplex.postMessage({type:g.KEYBOARD_INITIALIZED})},a._keySet.on(\"layoutChanged\",a._handleLayoutChange),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"componentDidMount\",value:function(){window.vuplex?this._initMessages():window.addEventListener(\"vuplexready\",this._initMessages)}},{key:\"render\",value:function(){return i.a.createElement(\"div\",{className:\"keyboard\"},i.a.createElement(\"div\",{className:\"num-pad-container\"},i.a.createElement(F,null)),i.a.createElement(\"div\",{className:\"board-margin\"}),i.a.createElement(\"div\",{className:\"center-board-container\"},i.a.createElement(O,{rows:this._keySet.getRows(),spacebarText:this._keySet.language})),i.a.createElement(\"div\",{className:\"enter-key-area\"},i.a.createElement(d,{className:\"backspace-icon\",definition:this._backspaceKeyDefinition},i.a.createElement(\"img\",{src:V.a,alt:\"backspace\"})),i.a.createElement(\"div\",{className:\"return-key-container\"},i.a.createElement(d,{definition:this._returnKeyDefinition,className:\"return-key-component\"},i.a.createElement(\"div\",{className:\"return-key\"},i.a.createElement(\"div\",{className:\"return-key-text\"},i.a.createElement(\"img\",{src:W.a,alt:\"return\"}))))),this._renderVoiceButton()),i.a.createElement(\"div\",{className:\"right-pad-container\"},i.a.createElement(H,null)))}},{key:\"_renderVoiceButton\",value:function(){if(this.state.voiceRecognitionEnabled)return i.a.createElement(\"div\",{className:\"voice-button-container\"},i.a.createElement(z,{onMouseDown:this._handleVoiceButtonMouseDown,active:this.state.voiceRecognitionActive}))}}]),t}(r.Component));o.a.render(i.a.createElement(Q,null),document.getElementById(\"root\"))}],[[17,2,1]]]);//# sourceMappingURL=main.d5c58ea6.chunk.js.map</script></body></html>".Substring(0, 500))
				{
					SetAlternativeInputSystemEnabled(enabled: true);
				}
				string text = System.IO.Path.Combine(UnityEngine.Application.temporaryCachePath, "vuplex");
				if (!Directory.Exists(text))
				{
					Directory.CreateDirectory(text);
				}
				string text2 = System.IO.Path.Combine(text, Guid.NewGuid().ToString());
				File.WriteAllText(text2, html);
				string url = "file://" + text2;
				LoadUrl(url);
			}
		}

		public override void LoadUrl(string url)
		{
			if (!_isDisposed)
			{
				_webView.Call("loadUrl", url);
			}
		}

		public override void LoadUrl(string url, Dictionary<string, string> additionalHttpHeaders)
		{
			if (!_isDisposed)
			{
				if (additionalHttpHeaders == null)
				{
					LoadUrl(url);
					return;
				}
				AndroidJavaObject androidJavaObject = _convertDictionaryToJavaMap(additionalHttpHeaders);
				_webView.Call("loadUrl", url, androidJavaObject);
			}
		}

		public void MovePointer(Vector2 point)
		{
			if (!_isDisposed)
			{
				int num = (int)(point.x * (float)base._nativeWidth);
				int num2 = (int)(point.y * (float)base._nativeHeight);
				_webView.Call("movePointer", num, num2);
			}
		}

		public void PointerDown(Vector2 point)
		{
			if (!_isDisposed)
			{
				int num = (int)(point.x * (float)base._nativeWidth);
				int num2 = (int)(point.y * (float)base._nativeHeight);
				_webView.Call("pointerDown", num, num2);
			}
		}

		public void PointerUp(Vector2 point)
		{
			if (!_isDisposed)
			{
				int num = (int)(point.x * (float)base._nativeWidth);
				int num2 = (int)(point.y * (float)base._nativeHeight);
				_webView.Call("pointerUp", num, num2);
			}
		}

		public override void Reload()
		{
			if (!_isDisposed)
			{
				_webView.Call("reload");
			}
		}

		public override void Scroll(Vector2 scrollDelta)
		{
			int num = (int)(scrollDelta.x * (float)_numberOfPixelsPerUnityUnit);
			int num2 = (int)(scrollDelta.y * (float)_numberOfPixelsPerUnityUnit);
			_webView.Call("scroll", num, num2);
		}

		public override void Scroll(Vector2 scrollDelta, Vector2 mousePosition)
		{
			int num = (int)(scrollDelta.x * (float)_numberOfPixelsPerUnityUnit);
			int num2 = (int)(scrollDelta.y * (float)_numberOfPixelsPerUnityUnit);
			int num3 = (int)(mousePosition.x * (float)base._nativeWidth);
			int num4 = (int)(mousePosition.y * (float)base._nativeHeight);
			_webView.Call("scroll", num, num2, num3, num4);
		}

		public void SetAlternativeInputSystemEnabled(bool enabled)
		{
			if (!_isDisposed)
			{
				_webView.Call("setAlternativeInputSystemEnabled", enabled);
			}
		}

		public static void SetStorageEnabled(bool enabled)
		{
			_class.CallStatic("setStorageEnabled", enabled);
		}

		public override void ZoomIn()
		{
			_webView.Call("zoomIn");
		}

		public override void ZoomOut()
		{
			_webView.Call("zoomOut");
		}

		private AndroidJavaObject _convertDictionaryToJavaMap(Dictionary<string, string> dictionary)
		{
			AndroidJavaObject androidJavaObject = new AndroidJavaObject("java.util.HashMap");
			IntPtr methodID = AndroidJNIHelper.GetMethodID(androidJavaObject.GetRawClass(), "put", "(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;");
			foreach (KeyValuePair<string, string> item in dictionary)
			{
				AndroidJNI.CallObjectMethod(androidJavaObject.GetRawObject(), methodID, AndroidJNIHelper.CreateJNIArgArray(new object[2] { item.Key, item.Value }));
			}
			return androidJavaObject;
		}

		private IEnumerator _renderPluginOncePerFrame()
		{
			while (true)
			{
				yield return new WaitForEndOfFrame();
				if (_viewUpdatesAreEnabled && !_isDisposed)
				{
					IntPtr rawObject = _webView.GetRawObject();
					if (rawObject != IntPtr.Zero)
					{
						int eventID = WebView_depositPointer(rawObject);
						GL.IssuePluginEvent(WebView_getRenderFunction(), eventID);
					}
				}
			}
		}

		protected override void _resize()
		{
			if ((bool)_viewportTexture)
			{
				_webView.Call("resize", base._nativeWidth, base._nativeHeight);
			}
		}

		private IEnumerator Start()
		{
			yield return StartCoroutine(_renderPluginOncePerFrame());
		}

		[DllImport("VuplexWebViewAndroidGecko")]
		private static extern IntPtr WebView_getRenderFunction();

		[DllImport("VuplexWebViewAndroidGecko")]
		private static extern int WebView_depositPointer(IntPtr pointer);

		[DllImport("VuplexWebViewAndroidGecko")]
		private static extern void WebView_removePointer(IntPtr pointer);
	}
	public abstract class BaseWebView : MonoBehaviour
	{
		protected IntPtr _currentViewportNativeTexture;

		protected const string _dllName = "VuplexWebViewAndroid";

		protected float _height;

		protected bool _isDisposed;

		protected BridgeMessageHandler _messageHandler = new BridgeMessageHandler();

		protected IntPtr _nativeWebViewPtr = IntPtr.Zero;

		protected int _numberOfPixelsPerUnityUnit = 1300;

		protected Dictionary<string, Action<string>> _pendingJavaScriptResultCallbacks = new Dictionary<string, Action<string>>();

		protected static bool _pluginTerminated;

		private const string USER_AGENT_EXCEPTION_MESSAGE = "Unable to set the User-Agent string, because a webview has already been created with the default User-Agent. On Windows and macOS, SetUserAgent() can only be called prior to creating any webviews.";

		protected Texture2D _videoTexture;

		protected bool _viewUpdatesAreEnabled = true;

		protected Texture2D _viewportTexture;

		protected float _width;

		public int Resolution => _numberOfPixelsPerUnityUnit;

		public Vector2 Size => new Vector2(_width, _height);

		public Vector2 SizeInPixels => new Vector2(_nativeWidth, _nativeHeight);

		public Texture2D Texture => _viewportTexture;

		public string Url { get; private set; }

		public Texture2D VideoTexture => _viewportTexture;

		protected int _nativeHeight => (int)(_height * (float)_numberOfPixelsPerUnityUnit);

		protected int _nativeWidth => (int)(_width * (float)_numberOfPixelsPerUnityUnit);

		public event EventHandler<ProgressChangedEventArgs> LoadProgressChanged;

		public event EventHandler<EventArgs<string>> MessageEmitted
		{
			add
			{
				_messageHandler.MessageEmitted += value;
			}
			remove
			{
				_messageHandler.MessageEmitted -= value;
			}
		}

		public event EventHandler PageLoadFailed;

		public event EventHandler<EventArgs<string>> TitleChanged
		{
			add
			{
				_messageHandler.TitleChanged += value;
			}
			remove
			{
				_messageHandler.TitleChanged -= value;
			}
		}

		public event EventHandler<UrlChangedEventArgs> UrlChanged;

		public event EventHandler<EventArgs<Rect>> VideoRectChanged
		{
			add
			{
				_messageHandler.VideoRectChanged += value;
			}
			remove
			{
				_messageHandler.VideoRectChanged -= value;
			}
		}

		public void Init(Texture2D texture, float width, float height)
		{
			Init(texture, width, height, null);
		}

		public virtual void Init(Texture2D viewportTexture, float width, float height, Texture2D videoTexture)
		{
			_viewportTexture = viewportTexture;
			_videoTexture = videoTexture;
			base.gameObject.name = $"WebView-{Guid.NewGuid().ToString()}";
			_width = width;
			_height = height;
			_messageHandler.JavaScriptResultReceived += MessageHandler_JavaScriptResultReceived;
			_messageHandler.UrlChanged += MessageHandler_UrlChanged;
		}

		public virtual void Blur()
		{
			WebView_blur(_nativeWebViewPtr);
		}

		public Task<bool> CanGoBack()
		{
			TaskCompletionSource<bool> taskCompletionSource = new TaskCompletionSource<bool>();
			CanGoBack(taskCompletionSource.SetResult);
			return taskCompletionSource.Task;
		}

		public Task<bool> CanGoForward()
		{
			TaskCompletionSource<bool> taskCompletionSource = new TaskCompletionSource<bool>();
			CanGoForward(taskCompletionSource.SetResult);
			return taskCompletionSource.Task;
		}

		public abstract void CanGoBack(Action<bool> callback);

		public abstract void CanGoForward(Action<bool> callback);

		public virtual void Click(Vector2 point)
		{
			int x = (int)(point.x * (float)_nativeWidth);
			int y = (int)(point.y * (float)_nativeHeight);
			WebView_click(_nativeWebViewPtr, x, y);
		}

		public Task<byte[]> CaptureScreenshot()
		{
			TaskCompletionSource<byte[]> taskCompletionSource = new TaskCompletionSource<byte[]>();
			CaptureScreenshot(taskCompletionSource.SetResult);
			return taskCompletionSource.Task;
		}

		public abstract void CaptureScreenshot(Action<byte[]> callback);

		public static void CreateTexture(float width, float height, Action<Texture2D> callback)
		{
			int width2 = (int)(width * 1300f);
			int height2 = (int)(height * 1300f);
			IntPtr nativeTex = WebView_createTexture(width2, height2, SystemInfo.graphicsDeviceType.ToString());
			Texture2D texture = Texture2D.CreateExternalTexture(width2, height2, TextureFormat.RGBA32, mipChain: false, linear: false, nativeTex);
			Dispatcher.RunOnMainThread(delegate
			{
				callback(texture);
			});
		}

		public virtual void DisableViewUpdates()
		{
			WebView_disableViewUpdates(_nativeWebViewPtr);
			_viewUpdatesAreEnabled = false;
		}

		public virtual void Dispose()
		{
			_isDisposed = true;
			if (!_pluginTerminated)
			{
				WebView_destroy(_nativeWebViewPtr);
			}
			_nativeWebViewPtr = IntPtr.Zero;
			if (this != null)
			{
				UnityEngine.Object.Destroy(base.gameObject);
			}
		}

		public virtual void EnableViewUpdates()
		{
			if (_currentViewportNativeTexture != IntPtr.Zero)
			{
				_viewportTexture.UpdateExternalTexture(_currentViewportNativeTexture);
			}
			WebView_enableViewUpdates(_nativeWebViewPtr);
			_viewUpdatesAreEnabled = true;
		}

		public Task<string> ExecuteJavaScript(string javaScript)
		{
			TaskCompletionSource<string> taskCompletionSource = new TaskCompletionSource<string>();
			ExecuteJavaScript(javaScript, taskCompletionSource.SetResult);
			return taskCompletionSource.Task;
		}

		public virtual void ExecuteJavaScript(string javaScript, Action<string> callback)
		{
			if (_isDisposed)
			{
				callback?.Invoke("");
				return;
			}
			string text = null;
			if (callback != null)
			{
				text = Guid.NewGuid().ToString();
				_pendingJavaScriptResultCallbacks[text] = callback;
			}
			WebView_executeJavaScript(_nativeWebViewPtr, javaScript, text);
		}

		public virtual void Focus()
		{
			WebView_focus(_nativeWebViewPtr);
		}

		public Task<byte[]> GetRawTextureData()
		{
			TaskCompletionSource<byte[]> taskCompletionSource = new TaskCompletionSource<byte[]>();
			GetRawTextureData(taskCompletionSource.SetResult);
			return taskCompletionSource.Task;
		}

		public virtual void GetRawTextureData(Action<byte[]> callback)
		{
			IntPtr bytes = IntPtr.Zero;
			int length = 0;
			WebView_getRawTextureData(_nativeWebViewPtr, ref bytes, ref length);
			byte[] array = new byte[length];
			Marshal.Copy(bytes, array, 0, length);
			WebView_freeMemory(bytes);
			callback(array);
		}

		public static void GloballySetUserAgent(bool mobile)
		{
			if (!WebView_globallySetUserAgentToMobile(mobile))
			{
				throw new InvalidOperationException("Unable to set the User-Agent string, because a webview has already been created with the default User-Agent. On Windows and macOS, SetUserAgent() can only be called prior to creating any webviews.");
			}
		}

		public static void GloballySetUserAgent(string userAgent)
		{
			if (!WebView_globallySetUserAgent(userAgent))
			{
				throw new InvalidOperationException("Unable to set the User-Agent string, because a webview has already been created with the default User-Agent. On Windows and macOS, SetUserAgent() can only be called prior to creating any webviews.");
			}
		}

		public virtual void GoBack()
		{
			WebView_goBack(_nativeWebViewPtr);
		}

		public virtual void GoForward()
		{
			WebView_goForward(_nativeWebViewPtr);
		}

		public virtual void HandleKeyboardInput(string input)
		{
			WebView_handleKeyboardInput(_nativeWebViewPtr, input);
		}

		public void HandleLoadFailed(string unusedParam)
		{
			if (this.PageLoadFailed != null)
			{
				this.PageLoadFailed(this, EventArgs.Empty);
			}
			ProgressChangedEventArgs e = new ProgressChangedEventArgs(ProgressChangeType.Failed, 1f);
			OnLoadProgressChanged(e);
		}

		public void HandleLoadFinished(string unusedParam)
		{
			ProgressChangedEventArgs e = new ProgressChangedEventArgs(ProgressChangeType.Finished, 1f);
			OnLoadProgressChanged(e);
		}

		public void HandleLoadStarted(string unusedParam)
		{
			ProgressChangedEventArgs e = new ProgressChangedEventArgs(ProgressChangeType.Started, 0f);
			OnLoadProgressChanged(e);
		}

		public void HandleLoadProgressUpdate(string progressString)
		{
			float progress = float.Parse(progressString);
			ProgressChangedEventArgs e = new ProgressChangedEventArgs(ProgressChangeType.Updated, progress);
			OnLoadProgressChanged(e);
		}

		public void HandleMessageEmitted(string serializedMessage)
		{
			_messageHandler.HandleMessage(serializedMessage);
		}

		public void HandleTextureChanged(string textureString)
		{
			IntPtr intPtr = new IntPtr(long.Parse(textureString));
			if (!(intPtr == _currentViewportNativeTexture))
			{
				IntPtr currentViewportNativeTexture = _currentViewportNativeTexture;
				_currentViewportNativeTexture = intPtr;
				if (_viewUpdatesAreEnabled)
				{
					_viewportTexture.UpdateExternalTexture(_currentViewportNativeTexture);
				}
				if (currentViewportNativeTexture != IntPtr.Zero && currentViewportNativeTexture != _currentViewportNativeTexture)
				{
					WebView_destroyTexture(currentViewportNativeTexture, SystemInfo.graphicsDeviceType.ToString());
				}
			}
		}

		public virtual void LoadHtml(string html)
		{
			WebView_loadHtml(_nativeWebViewPtr, html);
		}

		public virtual void LoadUrl(string url)
		{
			WebView_loadUrl(_nativeWebViewPtr, url);
		}

		public virtual void LoadUrl(string url, Dictionary<string, string> additionalHttpHeaders)
		{
			if (additionalHttpHeaders == null)
			{
				LoadUrl(url);
				return;
			}
			string[] value = additionalHttpHeaders.Keys.Select((string key) => $"{key}: {additionalHttpHeaders[key]}").ToArray();
			string newlineDelimitedHttpHeaders = string.Join("\n", value);
			WebView_loadUrlWithHeaders(_nativeWebViewPtr, url, newlineDelimitedHttpHeaders);
		}

		public void PostMessage(string data)
		{
			string arg = data.Replace("'", "\\'");
			ExecuteJavaScript($"vuplex._emit('message', {{ data: '{arg}' }})");
		}

		public virtual void Reload()
		{
			WebView_reload(_nativeWebViewPtr);
		}

		public virtual void Resize(float width, float height)
		{
			if (!_isDisposed && (width != _width || height != _height))
			{
				_width = width;
				_height = height;
				_resize();
			}
		}

		public virtual void Scroll(Vector2 delta)
		{
			int deltaX = (int)(delta.x * (float)_numberOfPixelsPerUnityUnit);
			int deltaY = (int)(delta.y * (float)_numberOfPixelsPerUnityUnit);
			WebView_scroll(_nativeWebViewPtr, deltaX, deltaY);
		}

		public virtual void Scroll(Vector2 scrollDelta, Vector2 mousePosition)
		{
			int deltaX = (int)(scrollDelta.x * (float)_numberOfPixelsPerUnityUnit);
			int deltaY = (int)(scrollDelta.y * (float)_numberOfPixelsPerUnityUnit);
			int mouseX = (int)(mousePosition.x * (float)_nativeWidth);
			int mouseY = (int)(mousePosition.y * (float)_nativeHeight);
			WebView_scrollAtPoint(_nativeWebViewPtr, deltaX, deltaY, mouseX, mouseY);
		}

		public void SetResolution(int pixelsPerUnityUnit)
		{
			_numberOfPixelsPerUnityUnit = pixelsPerUnityUnit;
			_resize();
		}

		public virtual void ZoomIn()
		{
			WebView_zoomIn(_nativeWebViewPtr);
		}

		public virtual void ZoomOut()
		{
			WebView_zoomOut(_nativeWebViewPtr);
		}

		private void MessageHandler_JavaScriptResultReceived(object sender, EventArgs<StringWithIdBridgeMessage> e)
		{
			string id = e.Value.id;
			string value = e.Value.value;
			Action<string> action = _pendingJavaScriptResultCallbacks[id];
			_pendingJavaScriptResultCallbacks.Remove(id);
			action(value);
		}

		protected void MessageHandler_UrlChanged(object sender, UrlChangedEventArgs e)
		{
			OnUrlChanged(e);
		}

		protected virtual void OnLoadProgressChanged(ProgressChangedEventArgs e)
		{
			if (this.LoadProgressChanged != null)
			{
				this.LoadProgressChanged(this, e);
			}
		}

		protected virtual void OnUrlChanged(UrlChangedEventArgs e)
		{
			if (!(Url == e.Url))
			{
				Url = e.Url;
				if (this.UrlChanged != null)
				{
					this.UrlChanged(this, e);
				}
			}
		}

		protected virtual void _resize()
		{
			if ((bool)_viewportTexture)
			{
				WebView_resize(_nativeWebViewPtr, _nativeWidth, _nativeHeight);
			}
		}

		private static void _unitySendMessage(string gameObjectName, string methodName, string message)
		{
			Dispatcher.RunOnMainThread(delegate
			{
				GameObject gameObject = GameObject.Find(gameObjectName);
				if (gameObject == null)
				{
					UnityEngine.Debug.LogErrorFormat("Unable to send the message, because there is no GameObject named '{0}'", gameObjectName);
				}
				else
				{
					gameObject.SendMessage(methodName, message);
				}
			});
		}

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_blur(IntPtr webViewPtr);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_click(IntPtr webViewPtr, int x, int y);

		[DllImport("VuplexWebViewAndroid")]
		protected static extern IntPtr WebView_createTexture(int width, int height, string graphicsApi);

		[DllImport("VuplexWebViewAndroid")]
		protected static extern void WebView_destroyTexture(IntPtr texture, string graphicsApi);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_destroy(IntPtr webViewPtr);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_disableViewUpdates(IntPtr webViewPtr);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_enableViewUpdates(IntPtr webViewPtr);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_executeJavaScript(IntPtr webViewPtr, string javaScript, string resultCallbackId);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_focus(IntPtr webViewPtr);

		[DllImport("VuplexWebViewAndroid")]
		protected static extern void WebView_freeMemory(IntPtr bytes);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_getRawTextureData(IntPtr webViewPtr, ref IntPtr bytes, ref int length);

		[DllImport("VuplexWebViewAndroid")]
		private static extern bool WebView_globallySetUserAgentToMobile(bool mobile);

		[DllImport("VuplexWebViewAndroid")]
		private static extern bool WebView_globallySetUserAgent(string userAgent);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_goBack(IntPtr webViewPtr);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_goForward(IntPtr webViewPtr);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_handleKeyboardInput(IntPtr webViewPtr, string input);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_loadHtml(IntPtr webViewPtr, string html);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_loadUrl(IntPtr webViewPtr, string url);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_loadUrlWithHeaders(IntPtr webViewPtr, string url, string newlineDelimitedHttpHeaders);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_reload(IntPtr webViewPtr);

		[DllImport("VuplexWebViewAndroid")]
		protected static extern void WebView_resize(IntPtr webViewPtr, int width, int height);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_scroll(IntPtr webViewPtr, int deltaX, int deltaY);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_scrollAtPoint(IntPtr webViewPtr, int deltaX, int deltaY, int mouseX, int mouseY);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_zoomIn(IntPtr webViewPtr);

		[DllImport("VuplexWebViewAndroid")]
		private static extern void WebView_zoomOut(IntPtr webViewPtr);
	}
	[Serializable]
	public class BridgeMessage
	{
		public string type;

		public static string ParseType(string serializedMessage)
		{
			try
			{
				return UnityEngine.JsonUtility.FromJson<BridgeMessage>(serializedMessage).type;
			}
			catch (Exception)
			{
				UnityEngine.Debug.LogWarning("The bridge message could not be parsed as JSON.");
				return null;
			}
		}
	}
	public class BridgeMessageHandler
	{
		private Rect _videoRect = new Rect(0f, 0f, 0f, 0f);

		public Rect VideoRect => _videoRect;

		public event EventHandler<EventArgs<StringWithIdBridgeMessage>> JavaScriptResultReceived;

		public event EventHandler<EventArgs<string>> MessageEmitted;

		public event EventHandler<EventArgs<string>> TitleChanged;

		public event EventHandler<UrlChangedEventArgs> UrlChanged;

		public event EventHandler<EventArgs<Rect>> VideoRectChanged;

		public void HandleMessage(string serializedMessage)
		{
			switch (BridgeMessage.ParseType(serializedMessage))
			{
			case "vuplex.webview.javaScriptResult":
			{
				StringWithIdBridgeMessage val2 = UnityEngine.JsonUtility.FromJson<StringWithIdBridgeMessage>(serializedMessage);
				if (this.JavaScriptResultReceived != null)
				{
					this.JavaScriptResultReceived(this, new EventArgs<StringWithIdBridgeMessage>(val2));
				}
				break;
			}
			case "vuplex.webview.titleChanged":
			{
				string val = StringBridgeMessage.ParseValue(serializedMessage);
				if (this.TitleChanged != null)
				{
					this.TitleChanged(this, new EventArgs<string>(val));
				}
				break;
			}
			case "vuplex.webview.urlChanged":
			{
				UrlAction urlAction = UnityEngine.JsonUtility.FromJson<UrlChangedMessage>(serializedMessage).urlAction;
				if (this.UrlChanged != null)
				{
					this.UrlChanged(this, new UrlChangedEventArgs(urlAction.Url, urlAction.Title, urlAction.Type));
				}
				break;
			}
			case "vuplex.webview.videoRectChanged":
				_handleVideoRectChangedMessage(serializedMessage);
				break;
			default:
				if (this.MessageEmitted != null)
				{
					this.MessageEmitted(this, new EventArgs<string>(serializedMessage));
				}
				break;
			}
		}

		private void _handleVideoRectChangedMessage(string serializedMessage)
		{
			Rect rect = UnityEngine.JsonUtility.FromJson<VideoRectChangedMessage>(serializedMessage).value.rect.toRect();
			if (_videoRect != rect)
			{
				_videoRect = rect;
				if (this.VideoRectChanged != null)
				{
					this.VideoRectChanged(this, new EventArgs<Rect>(rect));
				}
			}
		}
	}
	public class CanvasWebViewPrefab : MonoBehaviour
	{
		public EventHandler Initialized;

		[Label("Initial URL to Load (Optional)")]
		public string InitialUrl;

		[Label("Initial Resolution (Pixels per Unity Unit)")]
		public int InitialResolution = 1;

		private WebViewPrefab _webViewPrefab;

		public IWebView WebView
		{
			get
			{
				if (!(_webViewPrefab == null))
				{
					return _webViewPrefab.WebView;
				}
				return null;
			}
		}

		public static CanvasWebViewPrefab Instantiate()
		{
			return Instantiate(default(WebViewOptions));
		}

		public static CanvasWebViewPrefab Instantiate(WebViewOptions options, string url = "")
		{
			GameObject gameObject = UnityEngine.Object.Instantiate((GameObject)Resources.Load("CanvasWebViewPrefab"));
			CanvasWebViewPrefab canvasWebViewPrefab = gameObject.GetComponent<CanvasWebViewPrefab>();
			canvasWebViewPrefab.Init(options);
			CanvasWebViewPrefab canvasWebViewPrefab2 = canvasWebViewPrefab;
			canvasWebViewPrefab2.Initialized = (EventHandler)Delegate.Combine(canvasWebViewPrefab2.Initialized, (EventHandler)delegate
			{
				canvasWebViewPrefab.WebView.LoadUrl(url);
			});
			return canvasWebViewPrefab;
		}

		public void Init()
		{
			Init(default(WebViewOptions));
		}

		public void Init(WebViewOptions options)
		{
			GetComponent<Image>().enabled = false;
			_webViewPrefab = WebViewPrefab.Instantiate(1f, 1f, options);
			_webViewPrefab.Initialized += WebViewPrefab_Initialized;
			_webViewPrefab.transform.SetParent(base.transform, worldPositionStays: false);
			_webViewPrefab.transform.localPosition = new Vector3(0f, _getRect().height / 2f, 0f);
			_webViewPrefab.transform.localEulerAngles = new Vector3(0f, 180f, 0f);
		}

		private Rect _getRect()
		{
			return GetComponent<RectTransform>().rect;
		}

		private void Awake()
		{
			if (!string.IsNullOrEmpty(InitialUrl))
			{
				Init();
			}
		}

		private void Update()
		{
			if (!(_webViewPrefab == null) && _webViewPrefab.WebView != null)
			{
				Rect rect = _getRect();
				Vector2 size = _webViewPrefab.WebView.Size;
				if (rect.width != size.x || rect.height != size.y)
				{
					_webViewPrefab.Resize(rect.width, rect.height);
				}
				Vector3 vector = new Vector3(0f, rect.height / 2f, 0f);
				if (_webViewPrefab.transform.localPosition != vector)
				{
					_webViewPrefab.transform.localPosition = vector;
				}
			}
		}

		private void WebViewPrefab_Initialized(object sender, EventArgs e)
		{
			int resolution = InitialResolution;
			if (InitialResolution <= 0)
			{
				UnityEngine.Debug.LogWarningFormat("Invalid value for CanvasWebViewPrefab.InitialResolution: {0}. The resolution will instead default to 1.", InitialResolution);
				resolution = 1;
			}
			_webViewPrefab.WebView.SetResolution(resolution);
			Rect rect = _getRect();
			_webViewPrefab.Resize(rect.width, rect.height);
			Initialized?.Invoke(this, EventArgs.Empty);
			if (!string.IsNullOrEmpty(InitialUrl))
			{
				string text = InitialUrl.Trim();
				if (!text.Contains(":"))
				{
					text = "http://" + text;
				}
				_webViewPrefab.WebView.LoadUrl(text);
			}
		}
	}
	internal class Config
	{
		public const int NumberOfPixelsPerUnityUnit = 1300;
	}
	internal class Dispatcher : MonoBehaviour
	{
		private static Dispatcher _instance;

		private static volatile bool _queued = false;

		private static List<Action> _backlog = new List<Action>(8);

		private static List<Action> _actions = new List<Action>(8);

		public static void RunAsync(Action action)
		{
			ThreadPool.QueueUserWorkItem(delegate
			{
				action();
			});
		}

		public static void RunAsync(Action<object> action, object state)
		{
			ThreadPool.QueueUserWorkItem(delegate(object o)
			{
				action(o);
			}, state);
		}

		public static void RunOnMainThread(Action action)
		{
			lock (_backlog)
			{
				_backlog.Add(action);
				_queued = true;
			}
		}

		[RuntimeInitializeOnLoadMethod(RuntimeInitializeLoadType.BeforeSceneLoad)]
		private static void Initialize()
		{
			if (_instance == null)
			{
				_instance = new GameObject("Dispatcher").AddComponent<Dispatcher>();
				UnityEngine.Object.DontDestroyOnLoad(_instance.gameObject);
			}
		}

		private void Update()
		{
			if (!_queued)
			{
				return;
			}
			lock (_backlog)
			{
				List<Action> actions = _actions;
				_actions = _backlog;
				_backlog = actions;
				_queued = false;
			}
			foreach (Action action in _actions)
			{
				action();
			}
			_actions.Clear();
		}
	}
	public class EventArgs<T> : EventArgs
	{
		public T Value { get; private set; }

		public EventArgs(T val)
		{
			Value = val;
		}
	}
	internal interface IWebPlugin
	{
		void ClearAllData();

		void CreateTexture(float width, float height, Action<Texture2D> callback);

		void CreateMaterial(Action<Material> callback);

		void CreateVideoMaterial(Action<Material> callback);

		IWebView CreateWebView();

		void SetStorageEnabled(bool enabled);

		void SetUserAgent(bool mobile);

		void SetUserAgent(string userAgent);
	}
	public interface IWebView
	{
		int Resolution { get; }

		Vector2 Size { get; }

		Vector2 SizeInPixels { get; }

		Texture2D Texture { get; }

		string Url { get; }

		Texture2D VideoTexture { get; }

		event EventHandler<ProgressChangedEventArgs> LoadProgressChanged;

		event EventHandler<EventArgs<string>> MessageEmitted;

		event EventHandler PageLoadFailed;

		event EventHandler<EventArgs<string>> TitleChanged;

		event EventHandler<UrlChangedEventArgs> UrlChanged;

		event EventHandler<EventArgs<Rect>> VideoRectChanged;

		void Init(Texture2D viewportTexture, float width, float height, Texture2D videoTexture);

		void Init(Texture2D viewportTexture, float width, float height);

		void Blur();

		Task<bool> CanGoBack();

		Task<bool> CanGoForward();

		void CanGoBack(Action<bool> callback);

		void CanGoForward(Action<bool> callback);

		Task<byte[]> CaptureScreenshot();

		void CaptureScreenshot(Action<byte[]> callback);

		void Click(Vector2 point);

		void DisableViewUpdates();

		void Dispose();

		void EnableViewUpdates();

		Task<string> ExecuteJavaScript(string javaScript);

		void ExecuteJavaScript(string javaScript, Action<string> callback);

		void Focus();

		Task<byte[]> GetRawTextureData();

		void GetRawTextureData(Action<byte[]> callback);

		void GoBack();

		void GoForward();

		void HandleKeyboardInput(string key);

		void LoadHtml(string html);

		void LoadUrl(string url);

		void LoadUrl(string url, Dictionary<string, string> additionalHttpHeaders);

		void Reload();

		void Resize(float width, float height);

		void PostMessage(string data);

		void Scroll(Vector2 scrollDelta);

		void Scroll(Vector2 scrollDelta, Vector2 mousePosition);

		void SetResolution(int pixelsPerUnityUnit);

		void ZoomIn();

		void ZoomOut();
	}
	public class Keyboard : MonoBehaviour
	{
		private const float DEFAULT_KEYBOARD_WIDTH = 0.5f;

		private const float DEFAULT_KEYBOARD_HEIGHT = 0.125f;

		public WebViewPrefab WebViewPrefab { get; private set; }

		public event EventHandler<EventArgs<string>> InputReceived;

		public event EventHandler Initialized;

		public static Keyboard Instantiate()
		{
			return Instantiate(0.5f, 0.125f);
		}

		public static Keyboard Instantiate(float width, float height)
		{
			Keyboard keyboard = new GameObject("Keyboard").AddComponent<Keyboard>();
			keyboard.Init(width, height);
			return keyboard;
		}

		public void Init(float width, float height)
		{
			WebViewPrefab = WebViewPrefab.Instantiate(width, height, new WebViewOptions
			{
				disableVideo = true,
				preferredPlugins = new WebPluginType[1]
			});
			WebViewPrefab.transform.parent = base.transform;
			WebViewPrefab.transform.localPosition = new Vector3(0f, 0f, 0f);
			WebViewPrefab.Initialized += delegate
			{
				WebViewPrefab.WebView.MessageEmitted += WebView_MessageEmitted;
				WebViewPrefab.WebView.LoadHtml("<!DOCTYPE html><html lang=\"en\"><head><meta charset=\"utf-8\"><meta name=\"transparent\" content=\"true\"><meta name=\"viewport\" content=\"viewport-fit=cover,width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0\"><meta name=\"theme-color\" content=\"#000000\"><link rel=\"manifest\" href=\"./manifest.json\"><link rel=\"shortcut icon\" href=\"./favicon.ico\"><title>Unity Keyboard</title><style>html{width:100vw;height:100vh}body{margin:0;padding:0;font-family:Helvetica,Ariel,sans-serif;font-size:20px}#root,body{width:100%;height:100%}.key-component{display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center;border-radius:.5rem}.key-component>img,.key-component div,.key-component span{pointer-events:none}.key-component.hover,.key-component:hover{background-color:#485a63}.key-component.key-down{background-color:#a2b3bc}.key-component.key-up{-webkit-animation:highlight 1s;animation:highlight 1s}@-webkit-keyframes highlight{0%{background-color:#a2b3bc}to{background-color:auto}}@keyframes highlight{0%{background-color:#a2b3bc}to{background-color:auto}}.center-board{background-color:#283237;color:#fff;height:100%;width:100%;border-radius:.6rem;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.center-board .key-area{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;width:95%;height:90%}.center-board .key-area .key-row{display:-webkit-flex;display:flex;-webkit-justify-content:space-around;justify-content:space-around;-webkit-flex:1 1 auto;flex:1 1 auto}.center-board .key-area .key-row .key{-webkit-flex:2 0 auto;flex:2 0 auto}.center-board .key-area .key-row .key-offset-margin{-webkit-flex:1 0 auto;flex:1 0 auto}.center-board .key-area .key-row .spacebar-container{-webkit-flex:12 0 auto;flex:12 0 auto;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.center-board .key-area .key-row .spacebar-container .spacebar{width:98%;height:80%;background-color:#3d4d55;border-radius:.6rem;color:#a6a6a6}.center-board .key-area .key-row .spacebar-container .spacebar.hover,.center-board .key-area .key-row .spacebar-container .spacebar:hover{background-color:#485a63}.center-board .key-area .key-row .spacebar-container .spacebar:active{background-color:#688390}.shift-key-icon{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;justify-conten:center;-webkit-align-items:center;align-items:center}.shift-key-icon .shift-arrow-triangle{width:0;height:0;border-left:.45em solid transparent;border-bottom:.45em solid #fff;border-right:.45em solid transparent}.shift-key-icon .shift-arrow-triangle.shift-arrow-colored{border-bottom-color:#4fbea0}.shift-key-icon .regular-arrow-line{height:.6em;width:.35em;background-color:#fff}.shift-key-icon .regular-arrow-line.shift-arrow-colored{background-color:#4fbea0}.shift-key-icon .caps-lock-arrow-line .caps-lock-line-top{height:.3em;width:.35em;background-color:#4fbea0}.shift-key-icon .caps-lock-arrow-line .caps-lock-line-middle{height:.2em}.shift-key-icon .caps-lock-arrow-line .caps-lock-line-bottom{height:.1em;width:.35em;background-color:#4fbea0}.num-pad{width:100%;height:100%;border-radius:.6rem;background-color:#283237;color:#fff;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.num-pad,.num-pad .key-area{display:-webkit-flex;display:flex}.num-pad .key-area{-webkit-flex-direction:column;flex-direction:column;width:85%;height:90%}.num-pad .key-area .key-row{display:-webkit-flex;display:flex;-webkit-justify-content:space-around;justify-content:space-around;-webkit-flex:1 1 auto;flex:1 1 auto}.num-pad .key-area .key-row .key{-webkit-flex:1 0 auto;flex:1 0 auto}.right-pad{width:100%;height:100%;background-color:#283237;border-radius:.6rem;color:#fff;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.right-pad,.right-pad .key-area{display:-webkit-flex;display:flex}.right-pad .key-area{width:90%;height:75%;-webkit-justify-content:space-between;justify-content:space-between}.right-pad .right-key-area{-webkit-flex:0 0 100%;flex:0 0 100%;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;-webkit-justify-content:center;justify-content:center}.right-pad .right-key-area .arrow-pad{width:90%;height:3.75em;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;font-size:1.25em}.right-pad .right-key-area .arrow-pad .arrow-pad-row{-webkit-flex:1 1 auto;flex:1 1 auto;width:100%;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.right-pad .right-key-area .arrow-pad .arrow-pad-row.arrow-pad-middle{-webkit-justify-content:space-between;justify-content:space-between}.voice-button{width:100%;padding-top:100%;position:relative;border-radius:50%;background-color:#a6a6a6}.voice-button .voice-button-icon{position:absolute;top:0;right:0;bottom:0;left:0;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center;pointer-events:none}.voice-button .voice-button-icon>div{width:50%;height:50%}.voice-button .voice-button-icon>div img{width:100%;height:100%}.voice-button svg{position:absolute;top:-224px;left:-224px;-webkit-transform:scale(.05);transform:scale(.05);fill:rgba(0,0,0,.5);pointer-events:none}.voice-button.hover,.voice-button:hover{background-color:#62c5aa}.voice-button.hover svg,.voice-button:hover svg{fill:#283237}@-webkit-keyframes recordingBackground{0%{background:#f30}50%{background:#ff8000}to{background:#f30}}@keyframes recordingBackground{0%{background:#f30}50%{background:#ff8000}to{background:#f30}}.voice-button.voice-button-active{-webkit-animation:recordingBackground 5s infinite;animation:recordingBackground 5s infinite}.voice-button.voice-button-active svg{fill:#fff}.keyboard{width:100%;height:100%;display:-webkit-flex;display:flex;-webkit-justify-content:space-between;justify-content:space-between}.keyboard .num-pad-container{-webkit-flex:1 1 15%;flex:1 1 15%}.keyboard .center-board-container{-webkit-flex:1 1 55%;flex:1 1 55%}.keyboard .right-pad-container{-webkit-flex:1 1 15%;flex:1 1 15%}.keyboard .board-margin{-webkit-flex:1 1 2.5%;flex:1 1 2.5%}.keyboard .enter-key-area{height:100%;-webkit-flex:1 1 10%;flex:1 1 10%;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.keyboard .enter-key-area .backspace-icon{width:60%;border-radius:.5rem}.keyboard .enter-key-area .backspace-icon:hover{background-color:#dde4e7}.keyboard .enter-key-area .backspace-icon img{width:100%}.keyboard .enter-key-area .return-key-container{width:60%;padding-top:10px}.keyboard .enter-key-area .return-key-container .return-key-component{border-radius:50%;background-color:#09f}.keyboard .enter-key-area .return-key-container .return-key-component.hover,.keyboard .enter-key-area .return-key-container .return-key-component:hover{background-color:#008ae6}.keyboard .enter-key-area .return-key-container .return-key{width:100%;padding-top:100%;position:relative;border-radius:50%;pointer-events:none}.keyboard .enter-key-area .voice-button-container{width:60%;padding-top:15px}.keyboard .enter-key-area .return-key-text{position:absolute;top:0;left:0;bottom:0;right:0;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center;font-size:45px;font-weight:700}.keyboard .enter-key-area .return-key-text img{width:60%}/*# sourceMappingURL=main.047c931b.chunk.css.map */</style></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id=\"root\"></div><script>!function(l){function e(e){for(var r,t,n=e[0],o=e[1],u=e[2],f=0,i=[];f<n.length;f++)t=n[f],p[t]&&i.push(p[t][0]),p[t]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(l[r]=o[r]);for(s&&s(e);i.length;)i.shift()();return c.push.apply(c,u||[]),a()}function a(){for(var e,r=0;r<c.length;r++){for(var t=c[r],n=!0,o=1;o<t.length;o++){var u=t[o];0!==p[u]&&(n=!1)}n&&(c.splice(r--,1),e=f(f.s=t[0]))}return e}var t={},p={2:0},c=[];function f(e){if(t[e])return t[e].exports;var r=t[e]={i:e,l:!1,exports:{}};return l[e].call(r.exports,r,r.exports,f),r.l=!0,r.exports}f.m=l,f.c=t,f.d=function(e,r,t){f.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},f.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},f.t=function(r,e){if(1&e&&(r=f(r)),8&e)return r;if(4&e&&\"object\"==typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(f.r(t),Object.defineProperty(t,\"default\",{enumerable:!0,value:r}),2&e&&\"string\"!=typeof r)for(var n in r)f.d(t,n,function(e){return r[e]}.bind(null,n));return t},f.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(r,\"a\",r),r},f.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},f.p=\"\";var r=window.webpackJsonp=window.webpackJsonp||[],n=r.push.bind(r);r.push=e,r=r.slice();for(var o=0;o<r.length;o++)e(r[o]);var s=n;a()}([])</script><script>(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[function(e,t,n){\"use strict\";e.exports=n(18)},function(e,t,n){\"use strict\";function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,\"a\",function(){return r})},function(e,t,n){\"use strict\";function r(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}n.d(t,\"a\",function(){return r})},function(e,t,n){\"use strict\";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,\"a\",function(){return i})},function(e,t,n){\"use strict\";function r(e){return(r=\"function\"===typeof Symbol&&\"symbol\"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function i(e){return(i=\"function\"===typeof Symbol&&\"symbol\"===r(Symbol.iterator)?function(e){return r(e)}:function(e){return e&&\"function\"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":r(e)})(e)}var l=n(7);function o(e,t){return!t||\"object\"!==i(t)&&\"function\"!==typeof t?Object(l.a)(e):t}n.d(t,\"a\",function(){return o})},function(e,t,n){\"use strict\";function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e,t){if(\"function\"!==typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}n.d(t,\"a\",function(){return i})},function(e,t,n){\"use strict\";var r=n(1);function i(e,t,n){return(i=\"undefined\"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Object(r.a)(e)););return e}(e,t);if(i){var l=Object.getOwnPropertyDescriptor(i,t);return l.get?l.get.call(n):l.value}})(e,t,n||e)}n.d(t,\"a\",function(){return i})},function(e,t,n){\"use strict\";function r(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}n.d(t,\"a\",function(){return r})},function(e,t,n){\"use strict\";function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}()}n.d(t,\"a\",function(){return r})},function(e,t,n){\"use strict\";var r,i=\"object\"===typeof Reflect?Reflect:null,l=i&&\"function\"===typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&\"function\"===typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!==e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var u=10;function c(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function s(e,t,n,r){var i,l,o,a;if(\"function\"!==typeof n)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof n);if(void 0===(l=e._events)?(l=e._events=Object.create(null),e._eventsCount=0):(void 0!==l.newListener&&(e.emit(\"newListener\",t,n.listener?n.listener:n),l=e._events),o=l[t]),void 0===o)o=l[t]=n,++e._eventsCount;else if(\"function\"===typeof o?o=l[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=c(e))>0&&o.length>i&&!o.warned){o.warned=!0;var u=new Error(\"Possible EventEmitter memory leak detected. \"+o.length+\" \"+String(t)+\" listeners added. Use emitter.setMaxListeners() to increase limit\");u.name=\"MaxListenersExceededWarning\",u.emitter=e,u.type=t,u.count=o.length,a=u,console&&console.warn&&console.warn(a)}return e}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,l(this.listener,this.target,e))}.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:\"function\"===typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):m(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if(\"function\"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(a,\"defaultMaxListeners\",{enumerable:!0,get:function(){return u},set:function(e){if(\"number\"!==typeof e||e<0||o(e))throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received '+e+\".\");u=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if(\"number\"!==typeof e||e<0||o(e))throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received '+e+\".\");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r=\"error\"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error(\"Unhandled error.\"+(o?\" (\"+o.message+\")\":\"\"));throw a.context=o,a}var u=i[e];if(void 0===u)return!1;if(\"function\"===typeof u)l(u,this,t);else{var c=u.length,s=m(u,c);for(n=0;n<c;++n)l(s[n],this,t)}return!0},a.prototype.addListener=function(e,t){return s(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return s(this,e,t,!0)},a.prototype.once=function(e,t){if(\"function\"!==typeof t)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof t);return this.on(e,f(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if(\"function\"!==typeof t)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,f(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,l,o;if(\"function\"!==typeof t)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit(\"removeListener\",e,n.listener||t));else if(\"function\"!==typeof n){for(i=-1,l=n.length-1;l>=0;l--)if(n[l]===t||n[l].listener===t){o=n[l].listener,i=l;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit(\"removeListener\",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,l=Object.keys(n);for(r=0;r<l.length;++r)\"removeListener\"!==(i=l[r])&&this.removeAllListeners(i);return this.removeAllListeners(\"removeListener\"),this._events=Object.create(null),this._eventsCount=0,this}if(\"function\"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return d(this,e,!0)},a.prototype.rawListeners=function(e){return d(this,e,!1)},a.listenerCount=function(e,t){return\"function\"===typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){\"use strict\";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String(\"abc\");if(e[5]=\"de\",\"5\"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t[\"_\"+String.fromCharCode(n)]=n;if(\"0123456789\"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(\"\"))return!1;var r={};return\"abcdefghijklmnopqrst\".split(\"\").forEach(function(e){r[e]=e}),\"abcdefghijklmnopqrst\"===Object.keys(Object.assign({},r)).join(\"\")}catch(i){return!1}}()?Object.assign:function(e,t){for(var n,o,a=function(e){if(null===e||void 0===e)throw new TypeError(\"Object.assign cannot be called with null or undefined\");return Object(e)}(e),u=1;u<arguments.length;u++){for(var c in n=Object(arguments[u]))i.call(n,c)&&(a[c]=n[c]);if(r){o=r(n);for(var s=0;s<o.length;s++)l.call(n,o[s])&&(a[o[s]]=n[o[s]])}}return a}},function(e,t,n){\"use strict\";!function e(){if(\"undefined\"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&\"function\"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(19)},,,,,function(e,t,n){\"use strict\";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,l=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(u){i=!0,l=u}finally{try{r||null==a.return||a.return()}finally{if(i)throw l}}return n}(e,t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}()}n.d(t,\"a\",function(){return r})},,function(e,t,n){\"use strict\";var r=n(10),i=\"function\"===typeof Symbol&&Symbol.for,l=i?Symbol.for(\"react.element\"):60103,o=i?Symbol.for(\"react.portal\"):60106,a=i?Symbol.for(\"react.fragment\"):60107,u=i?Symbol.for(\"react.strict_mode\"):60108,c=i?Symbol.for(\"react.profiler\"):60114,s=i?Symbol.for(\"react.provider\"):60109,f=i?Symbol.for(\"react.context\"):60110,d=i?Symbol.for(\"react.concurrent_mode\"):60111,p=i?Symbol.for(\"react.forward_ref\"):60112,m=i?Symbol.for(\"react.suspense\"):60113,h=i?Symbol.for(\"react.memo\"):60115,v=i?Symbol.for(\"react.lazy\"):60116,y=\"function\"===typeof Symbol&&Symbol.iterator;function g(e){for(var t=arguments.length-1,n=\"https://reactjs.org/docs/error-decoder.html?invariant=\"+e,r=0;r<t;r++)n+=\"&args[]=\"+encodeURIComponent(arguments[r+1]);!function(e,t,n,r,i,l,o,a){if(!e){if(e=void 0,void 0===t)e=Error(\"Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.\");else{var u=[n,r,i,l,o,a],c=0;(e=Error(t.replace(/%s/g,function(){return u[c++]}))).name=\"Invariant Violation\"}throw e.framesToPop=1,e}}(!1,\"Minified React error #\"+e+\"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. \",n)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w={};function k(e,t,n){this.props=e,this.context=t,this.refs=w,this.updater=n||b}function x(){}function T(e,t,n){this.props=e,this.context=t,this.refs=w,this.updater=n||b}k.prototype.isReactComponent={},k.prototype.setState=function(e,t){\"object\"!==typeof e&&\"function\"!==typeof e&&null!=e&&g(\"85\"),this.updater.enqueueSetState(this,e,t,\"setState\")},k.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,\"forceUpdate\")},x.prototype=k.prototype;var _=T.prototype=new x;_.constructor=T,r(_,k.prototype),_.isPureReactComponent=!0;var S={current:null},E={current:null},C=Object.prototype.hasOwnProperty,P={key:!0,ref:!0,__self:!0,__source:!0};function N(e,t,n){var r=void 0,i={},o=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=\"\"+t.key),t)C.call(t,r)&&!P.hasOwnProperty(r)&&(i[r]=t[r]);var u=arguments.length-2;if(1===u)i.children=n;else if(1<u){for(var c=Array(u),s=0;s<u;s++)c[s]=arguments[s+2];i.children=c}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===i[r]&&(i[r]=u[r]);return{$$typeof:l,type:e,key:o,ref:a,props:i,_owner:E.current}}function O(e){return\"object\"===typeof e&&null!==e&&e.$$typeof===l}var R=/\\/+/g,L=[];function M(e,t,n,r){if(L.length){var i=L.pop();return i.result=e,i.keyPrefix=t,i.func=n,i.context=r,i.count=0,i}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function z(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>L.length&&L.push(e)}function I(e,t,n){return null==e?0:function e(t,n,r,i){var a=typeof t;\"undefined\"!==a&&\"boolean\"!==a||(t=null);var u=!1;if(null===t)u=!0;else switch(a){case\"string\":case\"number\":u=!0;break;case\"object\":switch(t.$$typeof){case l:case o:u=!0}}if(u)return r(i,t,\"\"===n?\".\"+U(t,0):n),1;if(u=0,n=\"\"===n?\".\":n+\":\",Array.isArray(t))for(var c=0;c<t.length;c++){var s=n+U(a=t[c],c);u+=e(a,s,r,i)}else if(s=null===t||\"object\"!==typeof t?null:\"function\"===typeof(s=y&&t[y]||t[\"@@iterator\"])?s:null,\"function\"===typeof s)for(t=s.call(t),c=0;!(a=t.next()).done;)u+=e(a=a.value,s=n+U(a,c++),r,i);else\"object\"===a&&g(\"31\",\"[object Object]\"===(r=\"\"+t)?\"object with keys {\"+Object.keys(t).join(\", \")+\"}\":r,\"\");return u}(e,\"\",t,n)}function U(e,t){return\"object\"===typeof e&&null!==e&&null!=e.key?function(e){var t={\"=\":\"=0\",\":\":\"=2\"};return\"$\"+(\"\"+e).replace(/[=:]/g,function(e){return t[e]})}(e.key):t.toString(36)}function F(e,t){e.func.call(e.context,t,e.count++)}function D(e,t,n){var r=e.result,i=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?A(e,r,n,function(e){return e}):null!=e&&(O(e)&&(e=function(e,t){return{$$typeof:l,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,i+(!e.key||t&&t.key===e.key?\"\":(\"\"+e.key).replace(R,\"$&/\")+\"/\")+n)),r.push(e))}function A(e,t,n,r,i){var l=\"\";null!=n&&(l=(\"\"+n).replace(R,\"$&/\")+\"/\"),I(e,D,t=M(t,l,r,i)),z(t)}function j(){var e=S.current;return null===e&&g(\"307\"),e}var W={Children:{map:function(e,t,n){if(null==e)return e;var r=[];return A(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;I(e,F,t=M(null,null,t,n)),z(t)},count:function(e){return I(e,function(){return null},null)},toArray:function(e){var t=[];return A(e,t,null,function(e){return e}),t},only:function(e){return O(e)||g(\"143\"),e}},createRef:function(){return{current:null}},Component:k,PureComponent:T,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:f,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},forwardRef:function(e){return{$$typeof:p,render:e}},lazy:function(e){return{$$typeof:v,_ctor:e,_status:-1,_result:null}},memo:function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},useCallback:function(e,t){return j().useCallback(e,t)},useContext:function(e,t){return j().useContext(e,t)},useEffect:function(e,t){return j().useEffect(e,t)},useImperativeHandle:function(e,t,n){return j().useImperativeHandle(e,t,n)},useDebugValue:function(){},useLayoutEffect:function(e,t){return j().useLayoutEffect(e,t)},useMemo:function(e,t){return j().useMemo(e,t)},useReducer:function(e,t,n){return j().useReducer(e,t,n)},useRef:function(e){return j().useRef(e)},useState:function(e){return j().useState(e)},Fragment:a,StrictMode:u,Suspense:m,createElement:N,cloneElement:function(e,t,n){(null===e||void 0===e)&&g(\"267\",e);var i=void 0,o=r({},e.props),a=e.key,u=e.ref,c=e._owner;if(null!=t){void 0!==t.ref&&(u=t.ref,c=E.current),void 0!==t.key&&(a=\"\"+t.key);var s=void 0;for(i in e.type&&e.type.defaultProps&&(s=e.type.defaultProps),t)C.call(t,i)&&!P.hasOwnProperty(i)&&(o[i]=void 0===t[i]&&void 0!==s?s[i]:t[i])}if(1===(i=arguments.length-2))o.children=n;else if(1<i){s=Array(i);for(var f=0;f<i;f++)s[f]=arguments[f+2];o.children=s}return{$$typeof:l,type:e.type,key:a,ref:u,props:o,_owner:c}},createFactory:function(e){var t=N.bind(null,e);return t.type=e,t},isValidElement:O,version:\"16.8.2\",unstable_ConcurrentMode:d,unstable_Profiler:c,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:S,ReactCurrentOwner:E,assign:r}},V={default:W},B=V&&W||V;e.exports=B.default||B},function(e,t,n){\"use strict\";var r=n(0),i=n(10),l=n(20);function o(e){for(var t=arguments.length-1,n=\"https://reactjs.org/docs/error-decoder.html?invariant=\"+e,r=0;r<t;r++)n+=\"&args[]=\"+encodeURIComponent(arguments[r+1]);!function(e,t,n,r,i,l,o,a){if(!e){if(e=void 0,void 0===t)e=Error(\"Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.\");else{var u=[n,r,i,l,o,a],c=0;(e=Error(t.replace(/%s/g,function(){return u[c++]}))).name=\"Invariant Violation\"}throw e.framesToPop=1,e}}(!1,\"Minified React error #\"+e+\"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. \",n)}r||o(\"227\");var a=!1,u=null,c=!1,s=null,f={onError:function(e){a=!0,u=e}};function d(e,t,n,r,i,l,o,c,s){a=!1,u=null,function(e,t,n,r,i,l,o,a,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(s){this.onError(s)}}.apply(f,arguments)}var p=null,m={};function h(){if(p)for(var e in m){var t=m[e],n=p.indexOf(e);if(-1<n||o(\"96\",e),!y[n])for(var r in t.extractEvents||o(\"97\",e),y[n]=t,n=t.eventTypes){var i=void 0,l=n[r],a=t,u=r;g.hasOwnProperty(u)&&o(\"99\",u),g[u]=l;var c=l.phasedRegistrationNames;if(c){for(i in c)c.hasOwnProperty(i)&&v(c[i],a,u);i=!0}else l.registrationName?(v(l.registrationName,a,u),i=!0):i=!1;i||o(\"98\",r,e)}}}function v(e,t,n){b[e]&&o(\"100\",e),b[e]=t,w[e]=t.eventTypes[n].dependencies}var y=[],g={},b={},w={},k=null,x=null,T=null;function _(e,t,n){var r=e.type||\"unknown-event\";e.currentTarget=T(n),function(e,t,n,r,i,l,f,p,m){if(d.apply(this,arguments),a){if(a){var h=u;a=!1,u=null}else o(\"198\"),h=void 0;c||(c=!0,s=h)}}(r,t,void 0,e),e.currentTarget=null}function S(e,t){return null==t&&o(\"30\"),null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function E(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var C=null;function P(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var r=0;r<t.length&&!e.isPropagationStopped();r++)_(e,t[r],n[r]);else t&&_(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}var N={injectEventPluginOrder:function(e){p&&o(\"101\"),p=Array.prototype.slice.call(e),h()},injectEventPluginsByName:function(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var r=e[t];m.hasOwnProperty(t)&&m[t]===r||(m[t]&&o(\"102\",t),m[t]=r,n=!0)}n&&h()}};function O(e,t){var n=e.stateNode;if(!n)return null;var r=k(n);if(!r)return null;n=r[t];e:switch(t){case\"onClick\":case\"onClickCapture\":case\"onDoubleClick\":case\"onDoubleClickCapture\":case\"onMouseDown\":case\"onMouseDownCapture\":case\"onMouseMove\":case\"onMouseMoveCapture\":case\"onMouseUp\":case\"onMouseUpCapture\":(r=!r.disabled)||(r=!(\"button\"===(e=e.type)||\"input\"===e||\"select\"===e||\"textarea\"===e)),e=!r;break e;default:e=!1}return e?null:(n&&\"function\"!==typeof n&&o(\"231\",t,typeof n),n)}function R(e){if(null!==e&&(C=S(C,e)),e=C,C=null,e&&(E(e,P),C&&o(\"95\"),c))throw e=s,c=!1,s=null,e}var L=Math.random().toString(36).slice(2),M=\"__reactInternalInstance$\"+L,z=\"__reactEventHandlers$\"+L;function I(e){if(e[M])return e[M];for(;!e[M];){if(!e.parentNode)return null;e=e.parentNode}return 5===(e=e[M]).tag||6===e.tag?e:null}function U(e){return!(e=e[M])||5!==e.tag&&6!==e.tag?null:e}function F(e){if(5===e.tag||6===e.tag)return e.stateNode;o(\"33\")}function D(e){return e[z]||null}function A(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function j(e,t,n){(t=O(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=S(n._dispatchListeners,t),n._dispatchInstances=S(n._dispatchInstances,e))}function W(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=A(t);for(t=n.length;0<t--;)j(n[t],\"captured\",e);for(t=0;t<n.length;t++)j(n[t],\"bubbled\",e)}}function V(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=O(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=S(n._dispatchListeners,t),n._dispatchInstances=S(n._dispatchInstances,e))}function B(e){e&&e.dispatchConfig.registrationName&&V(e._targetInst,null,e)}function H(e){E(e,W)}var $=!(\"undefined\"===typeof window||!window.document||!window.document.createElement);function Q(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n[\"Webkit\"+e]=\"webkit\"+t,n[\"Moz\"+e]=\"moz\"+t,n}var K={animationend:Q(\"Animation\",\"AnimationEnd\"),animationiteration:Q(\"Animation\",\"AnimationIteration\"),animationstart:Q(\"Animation\",\"AnimationStart\"),transitionend:Q(\"Transition\",\"TransitionEnd\")},q={},Y={};function X(e){if(q[e])return q[e];if(!K[e])return e;var t,n=K[e];for(t in n)if(n.hasOwnProperty(t)&&t in Y)return q[e]=n[t];return e}$&&(Y=document.createElement(\"div\").style,\"AnimationEvent\"in window||(delete K.animationend.animation,delete K.animationiteration.animation,delete K.animationstart.animation),\"TransitionEvent\"in window||delete K.transitionend.transition);var G=X(\"animationend\"),J=X(\"animationiteration\"),Z=X(\"animationstart\"),ee=X(\"transitionend\"),te=\"abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting\".split(\" \"),ne=null,re=null,ie=null;function le(){if(ie)return ie;var e,t,n=re,r=n.length,i=\"value\"in ne?ne.value:ne.textContent,l=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[l-t];t++);return ie=i.slice(e,1<t?1-t:void 0)}function oe(){return!0}function ae(){return!1}function ue(e,t,n,r){for(var i in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(i)&&((t=e[i])?this[i]=t(n):\"target\"===i?this.target=r:this[i]=n[i]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?oe:ae,this.isPropagationStopped=ae,this}function ce(e,t,n,r){if(this.eventPool.length){var i=this.eventPool.pop();return this.call(i,e,t,n,r),i}return new this(e,t,n,r)}function se(e){e instanceof this||o(\"279\"),e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function fe(e){e.eventPool=[],e.getPooled=ce,e.release=se}i(ue.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():\"unknown\"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=oe)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():\"unknown\"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=oe)},persist:function(){this.isPersistent=oe},isPersistent:ae,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=ae,this._dispatchInstances=this._dispatchListeners=null}}),ue.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},ue.extend=function(e){function t(){}function n(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var l=new t;return i(l,n.prototype),n.prototype=l,n.prototype.constructor=n,n.Interface=i({},r.Interface,e),n.extend=r.extend,fe(n),n},fe(ue);var de=ue.extend({data:null}),pe=ue.extend({data:null}),me=[9,13,27,32],he=$&&\"CompositionEvent\"in window,ve=null;$&&\"documentMode\"in document&&(ve=document.documentMode);var ye=$&&\"TextEvent\"in window&&!ve,ge=$&&(!he||ve&&8<ve&&11>=ve),be=String.fromCharCode(32),we={beforeInput:{phasedRegistrationNames:{bubbled:\"onBeforeInput\",captured:\"onBeforeInputCapture\"},dependencies:[\"compositionend\",\"keypress\",\"textInput\",\"paste\"]},compositionEnd:{phasedRegistrationNames:{bubbled:\"onCompositionEnd\",captured:\"onCompositionEndCapture\"},dependencies:\"blur compositionend keydown keypress keyup mousedown\".split(\" \")},compositionStart:{phasedRegistrationNames:{bubbled:\"onCompositionStart\",captured:\"onCompositionStartCapture\"},dependencies:\"blur compositionstart keydown keypress keyup mousedown\".split(\" \")},compositionUpdate:{phasedRegistrationNames:{bubbled:\"onCompositionUpdate\",captured:\"onCompositionUpdateCapture\"},dependencies:\"blur compositionupdate keydown keypress keyup mousedown\".split(\" \")}},ke=!1;function xe(e,t){switch(e){case\"keyup\":return-1!==me.indexOf(t.keyCode);case\"keydown\":return 229!==t.keyCode;case\"keypress\":case\"mousedown\":case\"blur\":return!0;default:return!1}}function Te(e){return\"object\"===typeof(e=e.detail)&&\"data\"in e?e.data:null}var _e=!1;var Se={eventTypes:we,extractEvents:function(e,t,n,r){var i=void 0,l=void 0;if(he)e:{switch(e){case\"compositionstart\":i=we.compositionStart;break e;case\"compositionend\":i=we.compositionEnd;break e;case\"compositionupdate\":i=we.compositionUpdate;break e}i=void 0}else _e?xe(e,n)&&(i=we.compositionEnd):\"keydown\"===e&&229===n.keyCode&&(i=we.compositionStart);return i?(ge&&\"ko\"!==n.locale&&(_e||i!==we.compositionStart?i===we.compositionEnd&&_e&&(l=le()):(re=\"value\"in(ne=r)?ne.value:ne.textContent,_e=!0)),i=de.getPooled(i,t,n,r),l?i.data=l:null!==(l=Te(n))&&(i.data=l),H(i),l=i):l=null,(e=ye?function(e,t){switch(e){case\"compositionend\":return Te(t);case\"keypress\":return 32!==t.which?null:(ke=!0,be);case\"textInput\":return(e=t.data)===be&&ke?null:e;default:return null}}(e,n):function(e,t){if(_e)return\"compositionend\"===e||!he&&xe(e,t)?(e=le(),ie=re=ne=null,_e=!1,e):null;switch(e){case\"paste\":return null;case\"keypress\":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case\"compositionend\":return ge&&\"ko\"!==t.locale?null:t.data;default:return null}}(e,n))?((t=pe.getPooled(we.beforeInput,t,n,r)).data=e,H(t)):t=null,null===l?t:null===t?l:[l,t]}},Ee=null,Ce=null,Pe=null;function Ne(e){if(e=x(e)){\"function\"!==typeof Ee&&o(\"280\");var t=k(e.stateNode);Ee(e.stateNode,e.type,t)}}function Oe(e){Ce?Pe?Pe.push(e):Pe=[e]:Ce=e}function Re(){if(Ce){var e=Ce,t=Pe;if(Pe=Ce=null,Ne(e),t)for(e=0;e<t.length;e++)Ne(t[e])}}function Le(e,t){return e(t)}function Me(e,t,n){return e(t,n)}function ze(){}var Ie=!1;function Ue(e,t){if(Ie)return e(t);Ie=!0;try{return Le(e,t)}finally{Ie=!1,(null!==Ce||null!==Pe)&&(ze(),Re())}}var Fe={color:!0,date:!0,datetime:!0,\"datetime-local\":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function De(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return\"input\"===t?!!Fe[e.type]:\"textarea\"===t}function Ae(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function je(e){if(!$)return!1;var t=(e=\"on\"+e)in document;return t||((t=document.createElement(\"div\")).setAttribute(e,\"return;\"),t=\"function\"===typeof t[e]),t}function We(e){var t=e.type;return(e=e.nodeName)&&\"input\"===e.toLowerCase()&&(\"checkbox\"===t||\"radio\"===t)}function Ve(e){e._valueTracker||(e._valueTracker=function(e){var t=We(e)?\"checked\":\"value\",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=\"\"+e[t];if(!e.hasOwnProperty(t)&&\"undefined\"!==typeof n&&\"function\"===typeof n.get&&\"function\"===typeof n.set){var i=n.get,l=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=\"\"+e,l.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=\"\"+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Be(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r=\"\";return e&&(r=We(e)?e.checked?\"true\":\"false\":e.value),(e=r)!==n&&(t.setValue(e),!0)}var He=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;He.hasOwnProperty(\"ReactCurrentDispatcher\")||(He.ReactCurrentDispatcher={current:null});var $e=/^(.*)[\\\\\\/]/,Qe=\"function\"===typeof Symbol&&Symbol.for,Ke=Qe?Symbol.for(\"react.element\"):60103,qe=Qe?Symbol.for(\"react.portal\"):60106,Ye=Qe?Symbol.for(\"react.fragment\"):60107,Xe=Qe?Symbol.for(\"react.strict_mode\"):60108,Ge=Qe?Symbol.for(\"react.profiler\"):60114,Je=Qe?Symbol.for(\"react.provider\"):60109,Ze=Qe?Symbol.for(\"react.context\"):60110,et=Qe?Symbol.for(\"react.concurrent_mode\"):60111,tt=Qe?Symbol.for(\"react.forward_ref\"):60112,nt=Qe?Symbol.for(\"react.suspense\"):60113,rt=Qe?Symbol.for(\"react.memo\"):60115,it=Qe?Symbol.for(\"react.lazy\"):60116,lt=\"function\"===typeof Symbol&&Symbol.iterator;function ot(e){return null===e||\"object\"!==typeof e?null:\"function\"===typeof(e=lt&&e[lt]||e[\"@@iterator\"])?e:null}function at(e){if(null==e)return null;if(\"function\"===typeof e)return e.displayName||e.name||null;if(\"string\"===typeof e)return e;switch(e){case et:return\"ConcurrentMode\";case Ye:return\"Fragment\";case qe:return\"Portal\";case Ge:return\"Profiler\";case Xe:return\"StrictMode\";case nt:return\"Suspense\"}if(\"object\"===typeof e)switch(e.$$typeof){case Ze:return\"Context.Consumer\";case Je:return\"Context.Provider\";case tt:var t=e.render;return t=t.displayName||t.name||\"\",e.displayName||(\"\"!==t?\"ForwardRef(\"+t+\")\":\"ForwardRef\");case rt:return at(e.type);case it:if(e=1===e._status?e._result:null)return at(e)}return null}function ut(e){var t=\"\";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n=\"\";break e;default:var r=e._debugOwner,i=e._debugSource,l=at(e.type);n=null,r&&(n=at(r.type)),r=l,l=\"\",i?l=\" (at \"+i.fileName.replace($e,\"\")+\":\"+i.lineNumber+\")\":n&&(l=\" (created by \"+n+\")\"),n=\"\\n    in \"+(r||\"Unknown\")+l}t+=n,e=e.return}while(e);return t}var ct=/^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$/,st=Object.prototype.hasOwnProperty,ft={},dt={};function pt(e,t,n,r,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t}var mt={};\"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style\".split(\" \").forEach(function(e){mt[e]=new pt(e,0,!1,e,null)}),[[\"acceptCharset\",\"accept-charset\"],[\"className\",\"class\"],[\"htmlFor\",\"for\"],[\"httpEquiv\",\"http-equiv\"]].forEach(function(e){var t=e[0];mt[t]=new pt(t,1,!1,e[1],null)}),[\"contentEditable\",\"draggable\",\"spellCheck\",\"value\"].forEach(function(e){mt[e]=new pt(e,2,!1,e.toLowerCase(),null)}),[\"autoReverse\",\"externalResourcesRequired\",\"focusable\",\"preserveAlpha\"].forEach(function(e){mt[e]=new pt(e,2,!1,e,null)}),\"allowFullScreen async autoFocus autoPlay controls default defer disabled formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope\".split(\" \").forEach(function(e){mt[e]=new pt(e,3,!1,e.toLowerCase(),null)}),[\"checked\",\"multiple\",\"muted\",\"selected\"].forEach(function(e){mt[e]=new pt(e,3,!0,e,null)}),[\"capture\",\"download\"].forEach(function(e){mt[e]=new pt(e,4,!1,e,null)}),[\"cols\",\"rows\",\"size\",\"span\"].forEach(function(e){mt[e]=new pt(e,6,!1,e,null)}),[\"rowSpan\",\"start\"].forEach(function(e){mt[e]=new pt(e,5,!1,e.toLowerCase(),null)});var ht=/[\\-:]([a-z])/g;function vt(e){return e[1].toUpperCase()}function yt(e,t,n,r){var i=mt.hasOwnProperty(t)?mt[t]:null;(null!==i?0===i.type:!r&&(2<t.length&&(\"o\"===t[0]||\"O\"===t[0])&&(\"n\"===t[1]||\"N\"===t[1])))||(function(e,t,n,r){if(null===t||\"undefined\"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case\"function\":case\"symbol\":return!0;case\"boolean\":return!r&&(null!==n?!n.acceptsBooleans:\"data-\"!==(e=e.toLowerCase().slice(0,5))&&\"aria-\"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!st.call(dt,e)||!st.call(ft,e)&&(ct.test(e)?dt[e]=!0:(ft[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,\"\"+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&\"\":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?\"\":\"\"+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}function gt(e){switch(typeof e){case\"boolean\":case\"number\":case\"object\":case\"string\":case\"undefined\":return e;default:return\"\"}}function bt(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function wt(e,t){var n=null==t.defaultValue?\"\":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=gt(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:\"checkbox\"===t.type||\"radio\"===t.type?null!=t.checked:null!=t.value}}function kt(e,t){null!=(t=t.checked)&&yt(e,\"checked\",t,!1)}function xt(e,t){kt(e,t);var n=gt(t.value),r=t.type;if(null!=n)\"number\"===r?(0===n&&\"\"===e.value||e.value!=n)&&(e.value=\"\"+n):e.value!==\"\"+n&&(e.value=\"\"+n);else if(\"submit\"===r||\"reset\"===r)return void e.removeAttribute(\"value\");t.hasOwnProperty(\"value\")?_t(e,t.type,n):t.hasOwnProperty(\"defaultValue\")&&_t(e,t.type,gt(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Tt(e,t,n){if(t.hasOwnProperty(\"value\")||t.hasOwnProperty(\"defaultValue\")){var r=t.type;if(!(\"submit\"!==r&&\"reset\"!==r||void 0!==t.value&&null!==t.value))return;t=\"\"+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}\"\"!==(n=e.name)&&(e.name=\"\"),e.defaultChecked=!e.defaultChecked,e.defaultChecked=!!e._wrapperState.initialChecked,\"\"!==n&&(e.name=n)}function _t(e,t,n){\"number\"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=\"\"+e._wrapperState.initialValue:e.defaultValue!==\"\"+n&&(e.defaultValue=\"\"+n))}\"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height\".split(\" \").forEach(function(e){var t=e.replace(ht,vt);mt[t]=new pt(t,1,!1,e,null)}),\"xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type\".split(\" \").forEach(function(e){var t=e.replace(ht,vt);mt[t]=new pt(t,1,!1,e,\"http://www.w3.org/1999/xlink\")}),[\"xml:base\",\"xml:lang\",\"xml:space\"].forEach(function(e){var t=e.replace(ht,vt);mt[t]=new pt(t,1,!1,e,\"http://www.w3.org/XML/1998/namespace\")}),[\"tabIndex\",\"crossOrigin\"].forEach(function(e){mt[e]=new pt(e,1,!1,e.toLowerCase(),null)});var St={change:{phasedRegistrationNames:{bubbled:\"onChange\",captured:\"onChangeCapture\"},dependencies:\"blur change click focus input keydown keyup selectionchange\".split(\" \")}};function Et(e,t,n){return(e=ue.getPooled(St.change,e,t,n)).type=\"change\",Oe(n),H(e),e}var Ct=null,Pt=null;function Nt(e){R(e)}function Ot(e){if(Be(F(e)))return e}function Rt(e,t){if(\"change\"===e)return t}var Lt=!1;function Mt(){Ct&&(Ct.detachEvent(\"onpropertychange\",zt),Pt=Ct=null)}function zt(e){\"value\"===e.propertyName&&Ot(Pt)&&Ue(Nt,e=Et(Pt,e,Ae(e)))}function It(e,t,n){\"focus\"===e?(Mt(),Pt=n,(Ct=t).attachEvent(\"onpropertychange\",zt)):\"blur\"===e&&Mt()}function Ut(e){if(\"selectionchange\"===e||\"keyup\"===e||\"keydown\"===e)return Ot(Pt)}function Ft(e,t){if(\"click\"===e)return Ot(t)}function Dt(e,t){if(\"input\"===e||\"change\"===e)return Ot(t)}$&&(Lt=je(\"input\")&&(!document.documentMode||9<document.documentMode));var At={eventTypes:St,_isInputEventSupported:Lt,extractEvents:function(e,t,n,r){var i=t?F(t):window,l=void 0,o=void 0,a=i.nodeName&&i.nodeName.toLowerCase();if(\"select\"===a||\"input\"===a&&\"file\"===i.type?l=Rt:De(i)?Lt?l=Dt:(l=Ut,o=It):(a=i.nodeName)&&\"input\"===a.toLowerCase()&&(\"checkbox\"===i.type||\"radio\"===i.type)&&(l=Ft),l&&(l=l(e,t)))return Et(l,n,r);o&&o(e,i,t),\"blur\"===e&&(e=i._wrapperState)&&e.controlled&&\"number\"===i.type&&_t(i,\"number\",i.value)}},jt=ue.extend({view:null,detail:null}),Wt={Alt:\"altKey\",Control:\"ctrlKey\",Meta:\"metaKey\",Shift:\"shiftKey\"};function Vt(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Wt[e])&&!!t[e]}function Bt(){return Vt}var Ht=0,$t=0,Qt=!1,Kt=!1,qt=jt.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Bt,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if(\"movementX\"in e)return e.movementX;var t=Ht;return Ht=e.screenX,Qt?\"mousemove\"===e.type?e.screenX-t:0:(Qt=!0,0)},movementY:function(e){if(\"movementY\"in e)return e.movementY;var t=$t;return $t=e.screenY,Kt?\"mousemove\"===e.type?e.screenY-t:0:(Kt=!0,0)}}),Yt=qt.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Xt={mouseEnter:{registrationName:\"onMouseEnter\",dependencies:[\"mouseout\",\"mouseover\"]},mouseLeave:{registrationName:\"onMouseLeave\",dependencies:[\"mouseout\",\"mouseover\"]},pointerEnter:{registrationName:\"onPointerEnter\",dependencies:[\"pointerout\",\"pointerover\"]},pointerLeave:{registrationName:\"onPointerLeave\",dependencies:[\"pointerout\",\"pointerover\"]}},Gt={eventTypes:Xt,extractEvents:function(e,t,n,r){var i=\"mouseover\"===e||\"pointerover\"===e,l=\"mouseout\"===e||\"pointerout\"===e;if(i&&(n.relatedTarget||n.fromElement)||!l&&!i)return null;if(i=r.window===r?r:(i=r.ownerDocument)?i.defaultView||i.parentWindow:window,l?(l=t,t=(t=n.relatedTarget||n.toElement)?I(t):null):l=null,l===t)return null;var o=void 0,a=void 0,u=void 0,c=void 0;\"mouseout\"===e||\"mouseover\"===e?(o=qt,a=Xt.mouseLeave,u=Xt.mouseEnter,c=\"mouse\"):\"pointerout\"!==e&&\"pointerover\"!==e||(o=Yt,a=Xt.pointerLeave,u=Xt.pointerEnter,c=\"pointer\");var s=null==l?i:F(l);if(i=null==t?i:F(t),(e=o.getPooled(a,l,n,r)).type=c+\"leave\",e.target=s,e.relatedTarget=i,(n=o.getPooled(u,t,n,r)).type=c+\"enter\",n.target=i,n.relatedTarget=s,r=t,l&&r)e:{for(i=r,c=0,o=t=l;o;o=A(o))c++;for(o=0,u=i;u;u=A(u))o++;for(;0<c-o;)t=A(t),c--;for(;0<o-c;)i=A(i),o--;for(;c--;){if(t===i||t===i.alternate)break e;t=A(t),i=A(i)}t=null}else t=null;for(i=t,t=[];l&&l!==i&&(null===(c=l.alternate)||c!==i);)t.push(l),l=A(l);for(l=[];r&&r!==i&&(null===(c=r.alternate)||c!==i);)l.push(r),r=A(r);for(r=0;r<t.length;r++)V(t[r],\"bubbled\",e);for(r=l.length;0<r--;)V(l[r],\"captured\",n);return[e,n]}};function Jt(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t}var Zt=Object.prototype.hasOwnProperty;function en(e,t){if(Jt(e,t))return!0;if(\"object\"!==typeof e||null===e||\"object\"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!Zt.call(t,n[r])||!Jt(e[n[r]],t[n[r]]))return!1;return!0}function tn(e){var t=e;if(e.alternate)for(;t.return;)t=t.return;else{if(0!==(2&t.effectTag))return 1;for(;t.return;)if(0!==(2&(t=t.return).effectTag))return 1}return 3===t.tag?2:3}function nn(e){2!==tn(e)&&o(\"188\")}function rn(e){if(!(e=function(e){var t=e.alternate;if(!t)return 3===(t=tn(e))&&o(\"188\"),1===t?null:e;for(var n=e,r=t;;){var i=n.return,l=i?i.alternate:null;if(!i||!l)break;if(i.child===l.child){for(var a=i.child;a;){if(a===n)return nn(i),e;if(a===r)return nn(i),t;a=a.sibling}o(\"188\")}if(n.return!==r.return)n=i,r=l;else{a=!1;for(var u=i.child;u;){if(u===n){a=!0,n=i,r=l;break}if(u===r){a=!0,r=i,n=l;break}u=u.sibling}if(!a){for(u=l.child;u;){if(u===n){a=!0,n=l,r=i;break}if(u===r){a=!0,r=l,n=i;break}u=u.sibling}a||o(\"189\")}}n.alternate!==r&&o(\"190\")}return 3!==n.tag&&o(\"188\"),n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}var ln=ue.extend({animationName:null,elapsedTime:null,pseudoElement:null}),on=ue.extend({clipboardData:function(e){return\"clipboardData\"in e?e.clipboardData:window.clipboardData}}),an=jt.extend({relatedTarget:null});function un(e){var t=e.keyCode;return\"charCode\"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var cn={Esc:\"Escape\",Spacebar:\" \",Left:\"ArrowLeft\",Up:\"ArrowUp\",Right:\"ArrowRight\",Down:\"ArrowDown\",Del:\"Delete\",Win:\"OS\",Menu:\"ContextMenu\",Apps:\"ContextMenu\",Scroll:\"ScrollLock\",MozPrintableKey:\"Unidentified\"},sn={8:\"Backspace\",9:\"Tab\",12:\"Clear\",13:\"Enter\",16:\"Shift\",17:\"Control\",18:\"Alt\",19:\"Pause\",20:\"CapsLock\",27:\"Escape\",32:\" \",33:\"PageUp\",34:\"PageDown\",35:\"End\",36:\"Home\",37:\"ArrowLeft\",38:\"ArrowUp\",39:\"ArrowRight\",40:\"ArrowDown\",45:\"Insert\",46:\"Delete\",112:\"F1\",113:\"F2\",114:\"F3\",115:\"F4\",116:\"F5\",117:\"F6\",118:\"F7\",119:\"F8\",120:\"F9\",121:\"F10\",122:\"F11\",123:\"F12\",144:\"NumLock\",145:\"ScrollLock\",224:\"Meta\"},fn=jt.extend({key:function(e){if(e.key){var t=cn[e.key]||e.key;if(\"Unidentified\"!==t)return t}return\"keypress\"===e.type?13===(e=un(e))?\"Enter\":String.fromCharCode(e):\"keydown\"===e.type||\"keyup\"===e.type?sn[e.keyCode]||\"Unidentified\":\"\"},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Bt,charCode:function(e){return\"keypress\"===e.type?un(e):0},keyCode:function(e){return\"keydown\"===e.type||\"keyup\"===e.type?e.keyCode:0},which:function(e){return\"keypress\"===e.type?un(e):\"keydown\"===e.type||\"keyup\"===e.type?e.keyCode:0}}),dn=qt.extend({dataTransfer:null}),pn=jt.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Bt}),mn=ue.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),hn=qt.extend({deltaX:function(e){return\"deltaX\"in e?e.deltaX:\"wheelDeltaX\"in e?-e.wheelDeltaX:0},deltaY:function(e){return\"deltaY\"in e?e.deltaY:\"wheelDeltaY\"in e?-e.wheelDeltaY:\"wheelDelta\"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),vn=[[\"abort\",\"abort\"],[G,\"animationEnd\"],[J,\"animationIteration\"],[Z,\"animationStart\"],[\"canplay\",\"canPlay\"],[\"canplaythrough\",\"canPlayThrough\"],[\"drag\",\"drag\"],[\"dragenter\",\"dragEnter\"],[\"dragexit\",\"dragExit\"],[\"dragleave\",\"dragLeave\"],[\"dragover\",\"dragOver\"],[\"durationchange\",\"durationChange\"],[\"emptied\",\"emptied\"],[\"encrypted\",\"encrypted\"],[\"ended\",\"ended\"],[\"error\",\"error\"],[\"gotpointercapture\",\"gotPointerCapture\"],[\"load\",\"load\"],[\"loadeddata\",\"loadedData\"],[\"loadedmetadata\",\"loadedMetadata\"],[\"loadstart\",\"loadStart\"],[\"lostpointercapture\",\"lostPointerCapture\"],[\"mousemove\",\"mouseMove\"],[\"mouseout\",\"mouseOut\"],[\"mouseover\",\"mouseOver\"],[\"playing\",\"playing\"],[\"pointermove\",\"pointerMove\"],[\"pointerout\",\"pointerOut\"],[\"pointerover\",\"pointerOver\"],[\"progress\",\"progress\"],[\"scroll\",\"scroll\"],[\"seeking\",\"seeking\"],[\"stalled\",\"stalled\"],[\"suspend\",\"suspend\"],[\"timeupdate\",\"timeUpdate\"],[\"toggle\",\"toggle\"],[\"touchmove\",\"touchMove\"],[ee,\"transitionEnd\"],[\"waiting\",\"waiting\"],[\"wheel\",\"wheel\"]],yn={},gn={};function bn(e,t){var n=e[0],r=\"on\"+((e=e[1])[0].toUpperCase()+e.slice(1));t={phasedRegistrationNames:{bubbled:r,captured:r+\"Capture\"},dependencies:[n],isInteractive:t},yn[e]=t,gn[n]=t}[[\"blur\",\"blur\"],[\"cancel\",\"cancel\"],[\"click\",\"click\"],[\"close\",\"close\"],[\"contextmenu\",\"contextMenu\"],[\"copy\",\"copy\"],[\"cut\",\"cut\"],[\"auxclick\",\"auxClick\"],[\"dblclick\",\"doubleClick\"],[\"dragend\",\"dragEnd\"],[\"dragstart\",\"dragStart\"],[\"drop\",\"drop\"],[\"focus\",\"focus\"],[\"input\",\"input\"],[\"invalid\",\"invalid\"],[\"keydown\",\"keyDown\"],[\"keypress\",\"keyPress\"],[\"keyup\",\"keyUp\"],[\"mousedown\",\"mouseDown\"],[\"mouseup\",\"mouseUp\"],[\"paste\",\"paste\"],[\"pause\",\"pause\"],[\"play\",\"play\"],[\"pointercancel\",\"pointerCancel\"],[\"pointerdown\",\"pointerDown\"],[\"pointerup\",\"pointerUp\"],[\"ratechange\",\"rateChange\"],[\"reset\",\"reset\"],[\"seeked\",\"seeked\"],[\"submit\",\"submit\"],[\"touchcancel\",\"touchCancel\"],[\"touchend\",\"touchEnd\"],[\"touchstart\",\"touchStart\"],[\"volumechange\",\"volumeChange\"]].forEach(function(e){bn(e,!0)}),vn.forEach(function(e){bn(e,!1)});var wn={eventTypes:yn,isInteractiveTopLevelEventType:function(e){return void 0!==(e=gn[e])&&!0===e.isInteractive},extractEvents:function(e,t,n,r){var i=gn[e];if(!i)return null;switch(e){case\"keypress\":if(0===un(n))return null;case\"keydown\":case\"keyup\":e=fn;break;case\"blur\":case\"focus\":e=an;break;case\"click\":if(2===n.button)return null;case\"auxclick\":case\"dblclick\":case\"mousedown\":case\"mousemove\":case\"mouseup\":case\"mouseout\":case\"mouseover\":case\"contextmenu\":e=qt;break;case\"drag\":case\"dragend\":case\"dragenter\":case\"dragexit\":case\"dragleave\":case\"dragover\":case\"dragstart\":case\"drop\":e=dn;break;case\"touchcancel\":case\"touchend\":case\"touchmove\":case\"touchstart\":e=pn;break;case G:case J:case Z:e=ln;break;case ee:e=mn;break;case\"scroll\":e=jt;break;case\"wheel\":e=hn;break;case\"copy\":case\"cut\":case\"paste\":e=on;break;case\"gotpointercapture\":case\"lostpointercapture\":case\"pointercancel\":case\"pointerdown\":case\"pointermove\":case\"pointerout\":case\"pointerover\":case\"pointerup\":e=Yt;break;default:e=ue}return H(t=e.getPooled(i,t,n,r)),t}},kn=wn.isInteractiveTopLevelEventType,xn=[];function Tn(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var r;for(r=n;r.return;)r=r.return;if(!(r=3!==r.tag?null:r.stateNode.containerInfo))break;e.ancestors.push(n),n=I(r)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var i=Ae(e.nativeEvent);r=e.topLevelType;for(var l=e.nativeEvent,o=null,a=0;a<y.length;a++){var u=y[a];u&&(u=u.extractEvents(r,t,l,i))&&(o=S(o,u))}R(o)}}var _n=!0;function Sn(e,t){if(!t)return null;var n=(kn(e)?Cn:Pn).bind(null,e);t.addEventListener(e,n,!1)}function En(e,t){if(!t)return null;var n=(kn(e)?Cn:Pn).bind(null,e);t.addEventListener(e,n,!0)}function Cn(e,t){Me(Pn,e,t)}function Pn(e,t){if(_n){var n=Ae(t);if(null===(n=I(n))||\"number\"!==typeof n.tag||2===tn(n)||(n=null),xn.length){var r=xn.pop();r.topLevelType=e,r.nativeEvent=t,r.targetInst=n,e=r}else e={topLevelType:e,nativeEvent:t,targetInst:n,ancestors:[]};try{Ue(Tn,e)}finally{e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>xn.length&&xn.push(e)}}}var Nn={},On=0,Rn=\"_reactListenersID\"+(\"\"+Math.random()).slice(2);function Ln(e){return Object.prototype.hasOwnProperty.call(e,Rn)||(e[Rn]=On++,Nn[e[Rn]]={}),Nn[e[Rn]]}function Mn(e){if(\"undefined\"===typeof(e=e||(\"undefined\"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function zn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function In(e,t){var n,r=zn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=zn(r)}}function Un(){for(var e=window,t=Mn();t instanceof e.HTMLIFrameElement;){try{e=t.contentDocument.defaultView}catch(n){break}t=Mn(e.document)}return t}function Fn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(\"input\"===t&&(\"text\"===e.type||\"search\"===e.type||\"tel\"===e.type||\"url\"===e.type||\"password\"===e.type)||\"textarea\"===t||\"true\"===e.contentEditable)}function Dn(e){var t=Un(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&function e(t,n){return!(!t||!n)&&(t===n||(!t||3!==t.nodeType)&&(n&&3===n.nodeType?e(t,n.parentNode):\"contains\"in t?t.contains(n):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(n))))}(n.ownerDocument.documentElement,n)){if(null!==r&&Fn(n))if(t=r.start,void 0===(e=r.end)&&(e=t),\"selectionStart\"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,l=Math.min(r.start,i);r=void 0===r.end?l:Math.min(r.end,i),!e.extend&&l>r&&(i=r,r=l,l=i),i=In(n,l);var o=In(n,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),l>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(\"function\"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var An=$&&\"documentMode\"in document&&11>=document.documentMode,jn={select:{phasedRegistrationNames:{bubbled:\"onSelect\",captured:\"onSelectCapture\"},dependencies:\"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange\".split(\" \")}},Wn=null,Vn=null,Bn=null,Hn=!1;function $n(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return Hn||null==Wn||Wn!==Mn(n)?null:(\"selectionStart\"in(n=Wn)&&Fn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Bn&&en(Bn,n)?null:(Bn=n,(e=ue.getPooled(jn.select,Vn,e,t)).type=\"select\",e.target=Wn,H(e),e))}var Qn={eventTypes:jn,extractEvents:function(e,t,n,r){var i,l=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;if(!(i=!l)){e:{l=Ln(l),i=w.onSelect;for(var o=0;o<i.length;o++){var a=i[o];if(!l.hasOwnProperty(a)||!l[a]){l=!1;break e}}l=!0}i=!l}if(i)return null;switch(l=t?F(t):window,e){case\"focus\":(De(l)||\"true\"===l.contentEditable)&&(Wn=l,Vn=t,Bn=null);break;case\"blur\":Bn=Vn=Wn=null;break;case\"mousedown\":Hn=!0;break;case\"contextmenu\":case\"mouseup\":case\"dragend\":return Hn=!1,$n(n,r);case\"selectionchange\":if(An)break;case\"keydown\":case\"keyup\":return $n(n,r)}return null}};function Kn(e,t){return e=i({children:void 0},t),(t=function(e){var t=\"\";return r.Children.forEach(e,function(e){null!=e&&(t+=e)}),t}(t.children))&&(e.children=t),e}function qn(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t[\"$\"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty(\"$\"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=\"\"+gt(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function Yn(e,t){return null!=t.dangerouslySetInnerHTML&&o(\"91\"),i({},t,{value:void 0,defaultValue:void 0,children:\"\"+e._wrapperState.initialValue})}function Xn(e,t){var n=t.value;null==n&&(n=t.defaultValue,null!=(t=t.children)&&(null!=n&&o(\"92\"),Array.isArray(t)&&(1>=t.length||o(\"93\"),t=t[0]),n=t),null==n&&(n=\"\")),e._wrapperState={initialValue:gt(n)}}function Gn(e,t){var n=gt(t.value),r=gt(t.defaultValue);null!=n&&((n=\"\"+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=\"\"+r)}function Jn(e){var t=e.textContent;t===e._wrapperState.initialValue&&(e.value=t)}N.injectEventPluginOrder(\"ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin\".split(\" \")),k=D,x=U,T=F,N.injectEventPluginsByName({SimpleEventPlugin:wn,EnterLeaveEventPlugin:Gt,ChangeEventPlugin:At,SelectEventPlugin:Qn,BeforeInputEventPlugin:Se});var Zn={html:\"http://www.w3.org/1999/xhtml\",mathml:\"http://www.w3.org/1998/Math/MathML\",svg:\"http://www.w3.org/2000/svg\"};function er(e){switch(e){case\"svg\":return\"http://www.w3.org/2000/svg\";case\"math\":return\"http://www.w3.org/1998/Math/MathML\";default:return\"http://www.w3.org/1999/xhtml\"}}function tr(e,t){return null==e||\"http://www.w3.org/1999/xhtml\"===e?er(t):\"http://www.w3.org/2000/svg\"===e&&\"foreignObject\"===t?\"http://www.w3.org/1999/xhtml\":e}var nr,rr=void 0,ir=(nr=function(e,t){if(e.namespaceURI!==Zn.svg||\"innerHTML\"in e)e.innerHTML=t;else{for((rr=rr||document.createElement(\"div\")).innerHTML=\"<svg>\"+t+\"</svg>\",t=rr.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},\"undefined\"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return nr(e,t)})}:nr);function lr(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var or={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ar=[\"Webkit\",\"ms\",\"Moz\",\"O\"];function ur(e,t,n){return null==t||\"boolean\"===typeof t||\"\"===t?\"\":n||\"number\"!==typeof t||0===t||or.hasOwnProperty(e)&&or[e]?(\"\"+t).trim():t+\"px\"}function cr(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf(\"--\"),i=ur(n,t[n],r);\"float\"===n&&(n=\"cssFloat\"),r?e.setProperty(n,i):e[n]=i}}Object.keys(or).forEach(function(e){ar.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),or[t]=or[e]})});var sr=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fr(e,t){t&&(sr[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML)&&o(\"137\",e,\"\"),null!=t.dangerouslySetInnerHTML&&(null!=t.children&&o(\"60\"),\"object\"===typeof t.dangerouslySetInnerHTML&&\"__html\"in t.dangerouslySetInnerHTML||o(\"61\")),null!=t.style&&\"object\"!==typeof t.style&&o(\"62\",\"\"))}function dr(e,t){if(-1===e.indexOf(\"-\"))return\"string\"===typeof t.is;switch(e){case\"annotation-xml\":case\"color-profile\":case\"font-face\":case\"font-face-src\":case\"font-face-uri\":case\"font-face-format\":case\"font-face-name\":case\"missing-glyph\":return!1;default:return!0}}function pr(e,t){var n=Ln(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=w[t];for(var r=0;r<t.length;r++){var i=t[r];if(!n.hasOwnProperty(i)||!n[i]){switch(i){case\"scroll\":En(\"scroll\",e);break;case\"focus\":case\"blur\":En(\"focus\",e),En(\"blur\",e),n.blur=!0,n.focus=!0;break;case\"cancel\":case\"close\":je(i)&&En(i,e);break;case\"invalid\":case\"submit\":case\"reset\":break;default:-1===te.indexOf(i)&&Sn(i,e)}n[i]=!0}}}function mr(){}var hr=null,vr=null;function yr(e,t){switch(e){case\"button\":case\"input\":case\"select\":case\"textarea\":return!!t.autoFocus}return!1}function gr(e,t){return\"textarea\"===e||\"option\"===e||\"noscript\"===e||\"string\"===typeof t.children||\"number\"===typeof t.children||\"object\"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var br=\"function\"===typeof setTimeout?setTimeout:void 0,wr=\"function\"===typeof clearTimeout?clearTimeout:void 0,kr=l.unstable_scheduleCallback,xr=l.unstable_cancelCallback;function Tr(e){for(e=e.nextSibling;e&&1!==e.nodeType&&3!==e.nodeType;)e=e.nextSibling;return e}function _r(e){for(e=e.firstChild;e&&1!==e.nodeType&&3!==e.nodeType;)e=e.nextSibling;return e}new Set;var Sr=[],Er=-1;function Cr(e){0>Er||(e.current=Sr[Er],Sr[Er]=null,Er--)}function Pr(e,t){Sr[++Er]=e.current,e.current=t}var Nr={},Or={current:Nr},Rr={current:!1},Lr=Nr;function Mr(e,t){var n=e.type.contextTypes;if(!n)return Nr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,l={};for(i in n)l[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=l),l}function zr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ir(e){Cr(Rr),Cr(Or)}function Ur(e){Cr(Rr),Cr(Or)}function Fr(e,t,n){Or.current!==Nr&&o(\"168\"),Pr(Or,t),Pr(Rr,n)}function Dr(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,\"function\"!==typeof r.getChildContext)return n;for(var l in r=r.getChildContext())l in e||o(\"108\",at(t)||\"Unknown\",l);return i({},n,r)}function Ar(e){var t=e.stateNode;return t=t&&t.__reactInternalMemoizedMergedChildContext||Nr,Lr=Or.current,Pr(Or,t),Pr(Rr,Rr.current),!0}function jr(e,t,n){var r=e.stateNode;r||o(\"169\"),n?(t=Dr(e,t,Lr),r.__reactInternalMemoizedMergedChildContext=t,Cr(Rr),Cr(Or),Pr(Or,t)):Cr(Rr),Pr(Rr,n)}var Wr=null,Vr=null;function Br(e){return function(t){try{return e(t)}catch(n){}}}function Hr(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.contextDependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function $r(e,t,n,r){return new Hr(e,t,n,r)}function Qr(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Kr(e,t){var n=e.alternate;return null===n?((n=$r(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,n.contextDependencies=e.contextDependencies,n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function qr(e,t,n,r,i,l){var a=2;if(r=e,\"function\"===typeof e)Qr(e)&&(a=1);else if(\"string\"===typeof e)a=5;else e:switch(e){case Ye:return Yr(n.children,i,l,t);case et:return Xr(n,3|i,l,t);case Xe:return Xr(n,2|i,l,t);case Ge:return(e=$r(12,n,t,4|i)).elementType=Ge,e.type=Ge,e.expirationTime=l,e;case nt:return(e=$r(13,n,t,i)).elementType=nt,e.type=nt,e.expirationTime=l,e;default:if(\"object\"===typeof e&&null!==e)switch(e.$$typeof){case Je:a=10;break e;case Ze:a=9;break e;case tt:a=11;break e;case rt:a=14;break e;case it:a=16,r=null;break e}o(\"130\",null==e?e:typeof e,\"\")}return(t=$r(a,n,t,i)).elementType=e,t.type=r,t.expirationTime=l,t}function Yr(e,t,n,r){return(e=$r(7,e,r,t)).expirationTime=n,e}function Xr(e,t,n,r){return e=$r(8,e,r,t),t=0===(1&t)?Xe:et,e.elementType=t,e.type=t,e.expirationTime=n,e}function Gr(e,t,n){return(e=$r(6,e,null,t)).expirationTime=n,e}function Jr(e,t,n){return(t=$r(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Zr(e,t){e.didError=!1;var n=e.earliestPendingTime;0===n?e.earliestPendingTime=e.latestPendingTime=t:n<t?e.earliestPendingTime=t:e.latestPendingTime>t&&(e.latestPendingTime=t),ni(t,e)}function ei(e,t){e.didError=!1,e.latestPingedTime>=t&&(e.latestPingedTime=0);var n=e.earliestPendingTime,r=e.latestPendingTime;n===t?e.earliestPendingTime=r===t?e.latestPendingTime=0:r:r===t&&(e.latestPendingTime=n),n=e.earliestSuspendedTime,r=e.latestSuspendedTime,0===n?e.earliestSuspendedTime=e.latestSuspendedTime=t:n<t?e.earliestSuspendedTime=t:r>t&&(e.latestSuspendedTime=t),ni(t,e)}function ti(e,t){var n=e.earliestPendingTime;return n>t&&(t=n),(e=e.earliestSuspendedTime)>t&&(t=e),t}function ni(e,t){var n=t.earliestSuspendedTime,r=t.latestSuspendedTime,i=t.earliestPendingTime,l=t.latestPingedTime;0===(i=0!==i?i:l)&&(0===e||r<e)&&(i=r),0!==(e=i)&&n>e&&(e=n),t.nextExpirationTimeToWorkOn=i,t.expirationTime=e}function ri(e,t){if(e&&e.defaultProps)for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var ii=(new r.Component).refs;function li(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:i({},t,n),e.memoizedState=n,null!==(r=e.updateQueue)&&0===e.expirationTime&&(r.baseState=n)}var oi={isMounted:function(e){return!!(e=e._reactInternalFiber)&&2===tn(e)},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var r=xa(),i=Yl(r=Yo(r,e));i.payload=t,void 0!==n&&null!==n&&(i.callback=n),Bo(),Gl(e,i),Jo(e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var r=xa(),i=Yl(r=Yo(r,e));i.tag=Bl,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),Bo(),Gl(e,i),Jo(e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=xa(),r=Yl(n=Yo(n,e));r.tag=Hl,void 0!==t&&null!==t&&(r.callback=t),Bo(),Gl(e,r),Jo(e,n)}};function ai(e,t,n,r,i,l,o){return\"function\"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,l,o):!t.prototype||!t.prototype.isPureReactComponent||(!en(n,r)||!en(i,l))}function ui(e,t,n){var r=!1,i=Nr,l=t.contextType;return\"object\"===typeof l&&null!==l?l=Wl(l):(i=zr(t)?Lr:Or.current,l=(r=null!==(r=t.contextTypes)&&void 0!==r)?Mr(e,i):Nr),t=new t(n,l),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=oi,e.stateNode=t,t._reactInternalFiber=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=l),t}function ci(e,t,n,r){e=t.state,\"function\"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),\"function\"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&oi.enqueueReplaceState(t,t.state,null)}function si(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=ii;var l=t.contextType;\"object\"===typeof l&&null!==l?i.context=Wl(l):(l=zr(t)?Lr:Or.current,i.context=Mr(e,l)),null!==(l=e.updateQueue)&&(to(e,l,n,i,r),i.state=e.memoizedState),\"function\"===typeof(l=t.getDerivedStateFromProps)&&(li(e,t,l,n),i.state=e.memoizedState),\"function\"===typeof t.getDerivedStateFromProps||\"function\"===typeof i.getSnapshotBeforeUpdate||\"function\"!==typeof i.UNSAFE_componentWillMount&&\"function\"!==typeof i.componentWillMount||(t=i.state,\"function\"===typeof i.componentWillMount&&i.componentWillMount(),\"function\"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&oi.enqueueReplaceState(i,i.state,null),null!==(l=e.updateQueue)&&(to(e,l,n,i,r),i.state=e.memoizedState)),\"function\"===typeof i.componentDidMount&&(e.effectTag|=4)}var fi=Array.isArray;function di(e,t,n){if(null!==(e=n.ref)&&\"function\"!==typeof e&&\"object\"!==typeof e){if(n._owner){n=n._owner;var r=void 0;n&&(1!==n.tag&&o(\"309\"),r=n.stateNode),r||o(\"147\",e);var i=\"\"+e;return null!==t&&null!==t.ref&&\"function\"===typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=r.refs;t===ii&&(t=r.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}\"string\"!==typeof e&&o(\"284\"),n._owner||o(\"290\",e)}return e}function pi(e,t){\"textarea\"!==e.type&&o(\"31\",\"[object Object]\"===Object.prototype.toString.call(t)?\"object with keys {\"+Object.keys(t).join(\", \")+\"}\":t,\"\")}function mi(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t,n){return(e=Kr(e,t)).index=0,e.sibling=null,e}function l(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.effectTag=2,n):r:(t.effectTag=2,n):n}function a(t){return e&&null===t.alternate&&(t.effectTag=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Gr(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=di(e,t,n),r.return=e,r):((r=qr(n.type,n.key,n.props,null,e.mode,r)).ref=di(e,t,n),r.return=e,r)}function s(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Jr(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function f(e,t,n,r,l){return null===t||7!==t.tag?((t=Yr(n,e.mode,r,l)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if(\"string\"===typeof t||\"number\"===typeof t)return(t=Gr(\"\"+t,e.mode,n)).return=e,t;if(\"object\"===typeof t&&null!==t){switch(t.$$typeof){case Ke:return(n=qr(t.type,t.key,t.props,null,e.mode,n)).ref=di(e,null,t),n.return=e,n;case qe:return(t=Jr(t,e.mode,n)).return=e,t}if(fi(t)||ot(t))return(t=Yr(t,e.mode,n,null)).return=e,t;pi(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if(\"string\"===typeof n||\"number\"===typeof n)return null!==i?null:u(e,t,\"\"+n,r);if(\"object\"===typeof n&&null!==n){switch(n.$$typeof){case Ke:return n.key===i?n.type===Ye?f(e,t,n.props.children,r,i):c(e,t,n,r):null;case qe:return n.key===i?s(e,t,n,r):null}if(fi(n)||ot(n))return null!==i?null:f(e,t,n,r,null);pi(e,n)}return null}function m(e,t,n,r,i){if(\"string\"===typeof r||\"number\"===typeof r)return u(t,e=e.get(n)||null,\"\"+r,i);if(\"object\"===typeof r&&null!==r){switch(r.$$typeof){case Ke:return e=e.get(null===r.key?n:r.key)||null,r.type===Ye?f(t,e,r.props.children,i,r.key):c(t,e,r,i);case qe:return s(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(fi(r)||ot(r))return f(t,e=e.get(n)||null,r,i,null);pi(t,r)}return null}function h(i,o,a,u){for(var c=null,s=null,f=o,h=o=0,v=null;null!==f&&h<a.length;h++){f.index>h?(v=f,f=null):v=f.sibling;var y=p(i,f,a[h],u);if(null===y){null===f&&(f=v);break}e&&f&&null===y.alternate&&t(i,f),o=l(y,o,h),null===s?c=y:s.sibling=y,s=y,f=v}if(h===a.length)return n(i,f),c;if(null===f){for(;h<a.length;h++)(f=d(i,a[h],u))&&(o=l(f,o,h),null===s?c=f:s.sibling=f,s=f);return c}for(f=r(i,f);h<a.length;h++)(v=m(f,i,h,a[h],u))&&(e&&null!==v.alternate&&f.delete(null===v.key?h:v.key),o=l(v,o,h),null===s?c=v:s.sibling=v,s=v);return e&&f.forEach(function(e){return t(i,e)}),c}function v(i,a,u,c){var s=ot(u);\"function\"!==typeof s&&o(\"150\"),null==(u=s.call(u))&&o(\"151\");for(var f=s=null,h=a,v=a=0,y=null,g=u.next();null!==h&&!g.done;v++,g=u.next()){h.index>v?(y=h,h=null):y=h.sibling;var b=p(i,h,g.value,c);if(null===b){h||(h=y);break}e&&h&&null===b.alternate&&t(i,h),a=l(b,a,v),null===f?s=b:f.sibling=b,f=b,h=y}if(g.done)return n(i,h),s;if(null===h){for(;!g.done;v++,g=u.next())null!==(g=d(i,g.value,c))&&(a=l(g,a,v),null===f?s=g:f.sibling=g,f=g);return s}for(h=r(i,h);!g.done;v++,g=u.next())null!==(g=m(h,i,v,g.value,c))&&(e&&null!==g.alternate&&h.delete(null===g.key?v:g.key),a=l(g,a,v),null===f?s=g:f.sibling=g,f=g);return e&&h.forEach(function(e){return t(i,e)}),s}return function(e,r,l,u){var c=\"object\"===typeof l&&null!==l&&l.type===Ye&&null===l.key;c&&(l=l.props.children);var s=\"object\"===typeof l&&null!==l;if(s)switch(l.$$typeof){case Ke:e:{for(s=l.key,c=r;null!==c;){if(c.key===s){if(7===c.tag?l.type===Ye:c.elementType===l.type){n(e,c.sibling),(r=i(c,l.type===Ye?l.props.children:l.props)).ref=di(e,c,l),r.return=e,e=r;break e}n(e,c);break}t(e,c),c=c.sibling}l.type===Ye?((r=Yr(l.props.children,e.mode,u,l.key)).return=e,e=r):((u=qr(l.type,l.key,l.props,null,e.mode,u)).ref=di(e,r,l),u.return=e,e=u)}return a(e);case qe:e:{for(c=l.key;null!==r;){if(r.key===c){if(4===r.tag&&r.stateNode.containerInfo===l.containerInfo&&r.stateNode.implementation===l.implementation){n(e,r.sibling),(r=i(r,l.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Jr(l,e.mode,u)).return=e,e=r}return a(e)}if(\"string\"===typeof l||\"number\"===typeof l)return l=\"\"+l,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,l)).return=e,e=r):(n(e,r),(r=Gr(l,e.mode,u)).return=e,e=r),a(e);if(fi(l))return h(e,r,l,u);if(ot(l))return v(e,r,l,u);if(s&&pi(e,l),\"undefined\"===typeof l&&!c)switch(e.tag){case 1:case 0:o(\"152\",(u=e.type).displayName||u.name||\"Component\")}return n(e,r)}}var hi=mi(!0),vi=mi(!1),yi={},gi={current:yi},bi={current:yi},wi={current:yi};function ki(e){return e===yi&&o(\"174\"),e}function xi(e,t){Pr(wi,t),Pr(bi,e),Pr(gi,yi);var n=t.nodeType;switch(n){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:tr(null,\"\");break;default:t=tr(t=(n=8===n?t.parentNode:t).namespaceURI||null,n=n.tagName)}Cr(gi),Pr(gi,t)}function Ti(e){Cr(gi),Cr(bi),Cr(wi)}function _i(e){ki(wi.current);var t=ki(gi.current),n=tr(t,e.type);t!==n&&(Pr(bi,e),Pr(gi,n))}function Si(e){bi.current===e&&(Cr(gi),Cr(bi))}var Ei=0,Ci=2,Pi=4,Ni=8,Oi=16,Ri=32,Li=64,Mi=128,zi=He.ReactCurrentDispatcher,Ii=0,Ui=null,Fi=null,Di=null,Ai=null,ji=null,Wi=null,Vi=0,Bi=null,Hi=0,$i=!1,Qi=null,Ki=0;function qi(){o(\"307\")}function Yi(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Jt(e[n],t[n]))return!1;return!0}function Xi(e,t,n,r,i,l){if(Ii=l,Ui=t,Di=null!==e?e.memoizedState:null,zi.current=null===Di?cl:sl,t=n(r,i),$i){do{$i=!1,Ki+=1,Di=null!==e?e.memoizedState:null,Wi=Ai,Bi=ji=Fi=null,zi.current=sl,t=n(r,i)}while($i);Qi=null,Ki=0}return zi.current=ul,(e=Ui).memoizedState=Ai,e.expirationTime=Vi,e.updateQueue=Bi,e.effectTag|=Hi,e=null!==Fi&&null!==Fi.next,Ii=0,Wi=ji=Ai=Di=Fi=Ui=null,Vi=0,Bi=null,Hi=0,e&&o(\"300\"),t}function Gi(){zi.current=ul,Ii=0,Wi=ji=Ai=Di=Fi=Ui=null,Vi=0,Bi=null,Hi=0,$i=!1,Qi=null,Ki=0}function Ji(){var e={memoizedState:null,baseState:null,queue:null,baseUpdate:null,next:null};return null===ji?Ai=ji=e:ji=ji.next=e,ji}function Zi(){if(null!==Wi)Wi=(ji=Wi).next,Di=null!==(Fi=Di)?Fi.next:null;else{null===Di&&o(\"310\");var e={memoizedState:(Fi=Di).memoizedState,baseState:Fi.baseState,queue:Fi.queue,baseUpdate:Fi.baseUpdate,next:null};ji=null===ji?Ai=e:ji.next=e,Di=Fi.next}return ji}function el(e,t){return\"function\"===typeof t?t(e):t}function tl(e){var t=Zi(),n=t.queue;if(null===n&&o(\"311\"),0<Ki){var r=n.dispatch;if(null!==Qi){var i=Qi.get(n);if(void 0!==i){Qi.delete(n);var l=t.memoizedState;do{l=e(l,i.action),i=i.next}while(null!==i);return Jt(l,t.memoizedState)||(kl=!0),t.memoizedState=l,t.baseUpdate===n.last&&(t.baseState=l),[l,r]}}return[t.memoizedState,r]}r=n.last;var a=t.baseUpdate;if(l=t.baseState,null!==a?(null!==r&&(r.next=null),r=a.next):r=null!==r?r.next:null,null!==r){var u=i=null,c=r,s=!1;do{var f=c.expirationTime;f<Ii?(s||(s=!0,u=a,i=l),f>Vi&&(Vi=f)):l=c.eagerReducer===e?c.eagerState:e(l,c.action),a=c,c=c.next}while(null!==c&&c!==r);s||(u=a,i=l),Jt(l,t.memoizedState)||(kl=!0),t.memoizedState=l,t.baseUpdate=u,t.baseState=i,n.eagerReducer=e,n.eagerState=l}return[t.memoizedState,n.dispatch]}function nl(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===Bi?(Bi={lastEffect:null}).lastEffect=e.next=e:null===(t=Bi.lastEffect)?Bi.lastEffect=e.next=e:(n=t.next,t.next=e,e.next=n,Bi.lastEffect=e),e}function rl(e,t,n,r){var i=Ji();Hi|=e,i.memoizedState=nl(t,n,void 0,void 0===r?null:r)}function il(e,t,n,r){var i=Zi();r=void 0===r?null:r;var l=void 0;if(null!==Fi){var o=Fi.memoizedState;if(l=o.destroy,null!==r&&Yi(r,o.deps))return void nl(Ei,n,l,r)}Hi|=e,i.memoizedState=nl(t,n,l,r)}function ll(e,t){return\"function\"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function ol(){}function al(e,t,n){25>Ki||o(\"301\");var r=e.alternate;if(e===Ui||null!==r&&r===Ui)if($i=!0,e={expirationTime:Ii,action:n,eagerReducer:null,eagerState:null,next:null},null===Qi&&(Qi=new Map),void 0===(n=Qi.get(t)))Qi.set(t,e);else{for(t=n;null!==t.next;)t=t.next;t.next=e}else{Bo();var i=xa(),l={expirationTime:i=Yo(i,e),action:n,eagerReducer:null,eagerState:null,next:null},a=t.last;if(null===a)l.next=l;else{var u=a.next;null!==u&&(l.next=u),a.next=l}if(t.last=l,0===e.expirationTime&&(null===r||0===r.expirationTime)&&null!==(r=t.eagerReducer))try{var c=t.eagerState,s=r(c,n);if(l.eagerReducer=r,l.eagerState=s,Jt(s,c))return}catch(f){}Jo(e,i)}}var ul={readContext:Wl,useCallback:qi,useContext:qi,useEffect:qi,useImperativeHandle:qi,useLayoutEffect:qi,useMemo:qi,useReducer:qi,useRef:qi,useState:qi,useDebugValue:qi},cl={readContext:Wl,useCallback:function(e,t){return Ji().memoizedState=[e,void 0===t?null:t],e},useContext:Wl,useEffect:function(e,t){return rl(516,Mi|Li,e,t)},useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,rl(4,Pi|Ri,ll.bind(null,t,e),n)},useLayoutEffect:function(e,t){return rl(4,Pi|Ri,e,t)},useMemo:function(e,t){var n=Ji();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ji();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={last:null,dispatch:null,eagerReducer:e,eagerState:t}).dispatch=al.bind(null,Ui,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ji().memoizedState=e},useState:function(e){var t=Ji();return\"function\"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={last:null,dispatch:null,eagerReducer:el,eagerState:e}).dispatch=al.bind(null,Ui,e),[t.memoizedState,e]},useDebugValue:ol},sl={readContext:Wl,useCallback:function(e,t){var n=Zi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Yi(t,r[1])?r[0]:(n.memoizedState=[e,t],e)},useContext:Wl,useEffect:function(e,t){return il(516,Mi|Li,e,t)},useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,il(4,Pi|Ri,ll.bind(null,t,e),n)},useLayoutEffect:function(e,t){return il(4,Pi|Ri,e,t)},useMemo:function(e,t){var n=Zi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Yi(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)},useReducer:tl,useRef:function(){return Zi().memoizedState},useState:function(e){return tl(el)},useDebugValue:ol},fl=null,dl=null,pl=!1;function ml(e,t){var n=$r(5,null,null,0);n.elementType=\"DELETED\",n.type=\"DELETED\",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function hl(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=\"\"===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function vl(e){if(pl){var t=dl;if(t){var n=t;if(!hl(e,t)){if(!(t=Tr(n))||!hl(e,t))return e.effectTag|=2,pl=!1,void(fl=e);ml(fl,n)}fl=e,dl=_r(t)}else e.effectTag|=2,pl=!1,fl=e}}function yl(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&18!==e.tag;)e=e.return;fl=e}function gl(e){if(e!==fl)return!1;if(!pl)return yl(e),pl=!0,!1;var t=e.type;if(5!==e.tag||\"head\"!==t&&\"body\"!==t&&!gr(t,e.memoizedProps))for(t=dl;t;)ml(e,t),t=Tr(t);return yl(e),dl=fl?Tr(e.stateNode):null,!0}function bl(){dl=fl=null,pl=!1}var wl=He.ReactCurrentOwner,kl=!1;function xl(e,t,n,r){t.child=null===e?vi(t,null,n,r):hi(t,e.child,n,r)}function Tl(e,t,n,r,i){n=n.render;var l=t.ref;return jl(t,i),r=Xi(e,t,n,r,l,i),null===e||kl?(t.effectTag|=1,xl(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Ll(e,t,i))}function _l(e,t,n,r,i,l){if(null===e){var o=n.type;return\"function\"!==typeof o||Qr(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=qr(n.type,null,r,null,t.mode,l)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Sl(e,t,o,r,i,l))}return o=e.child,i<l&&(i=o.memoizedProps,(n=null!==(n=n.compare)?n:en)(i,r)&&e.ref===t.ref)?Ll(e,t,l):(t.effectTag|=1,(e=Kr(o,r)).ref=t.ref,e.return=t,t.child=e)}function Sl(e,t,n,r,i,l){return null!==e&&en(e.memoizedProps,r)&&e.ref===t.ref&&(kl=!1,i<l)?Ll(e,t,l):Cl(e,t,n,r,l)}function El(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function Cl(e,t,n,r,i){var l=zr(n)?Lr:Or.current;return l=Mr(t,l),jl(t,i),n=Xi(e,t,n,r,l,i),null===e||kl?(t.effectTag|=1,xl(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Ll(e,t,i))}function Pl(e,t,n,r,i){if(zr(n)){var l=!0;Ar(t)}else l=!1;if(jl(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),ui(t,n,r),si(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,a=t.memoizedProps;o.props=a;var u=o.context,c=n.contextType;\"object\"===typeof c&&null!==c?c=Wl(c):c=Mr(t,c=zr(n)?Lr:Or.current);var s=n.getDerivedStateFromProps,f=\"function\"===typeof s||\"function\"===typeof o.getSnapshotBeforeUpdate;f||\"function\"!==typeof o.UNSAFE_componentWillReceiveProps&&\"function\"!==typeof o.componentWillReceiveProps||(a!==r||u!==c)&&ci(t,o,r,c),Ql=!1;var d=t.memoizedState;u=o.state=d;var p=t.updateQueue;null!==p&&(to(t,p,r,o,i),u=t.memoizedState),a!==r||d!==u||Rr.current||Ql?(\"function\"===typeof s&&(li(t,n,s,r),u=t.memoizedState),(a=Ql||ai(t,n,a,r,d,u,c))?(f||\"function\"!==typeof o.UNSAFE_componentWillMount&&\"function\"!==typeof o.componentWillMount||(\"function\"===typeof o.componentWillMount&&o.componentWillMount(),\"function\"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),\"function\"===typeof o.componentDidMount&&(t.effectTag|=4)):(\"function\"===typeof o.componentDidMount&&(t.effectTag|=4),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=c,r=a):(\"function\"===typeof o.componentDidMount&&(t.effectTag|=4),r=!1)}else o=t.stateNode,a=t.memoizedProps,o.props=t.type===t.elementType?a:ri(t.type,a),u=o.context,\"object\"===typeof(c=n.contextType)&&null!==c?c=Wl(c):c=Mr(t,c=zr(n)?Lr:Or.current),(f=\"function\"===typeof(s=n.getDerivedStateFromProps)||\"function\"===typeof o.getSnapshotBeforeUpdate)||\"function\"!==typeof o.UNSAFE_componentWillReceiveProps&&\"function\"!==typeof o.componentWillReceiveProps||(a!==r||u!==c)&&ci(t,o,r,c),Ql=!1,u=t.memoizedState,d=o.state=u,null!==(p=t.updateQueue)&&(to(t,p,r,o,i),d=t.memoizedState),a!==r||u!==d||Rr.current||Ql?(\"function\"===typeof s&&(li(t,n,s,r),d=t.memoizedState),(s=Ql||ai(t,n,a,r,u,d,c))?(f||\"function\"!==typeof o.UNSAFE_componentWillUpdate&&\"function\"!==typeof o.componentWillUpdate||(\"function\"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,d,c),\"function\"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,d,c)),\"function\"===typeof o.componentDidUpdate&&(t.effectTag|=4),\"function\"===typeof o.getSnapshotBeforeUpdate&&(t.effectTag|=256)):(\"function\"!==typeof o.componentDidUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),\"function\"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),t.memoizedProps=r,t.memoizedState=d),o.props=r,o.state=d,o.context=c,r=s):(\"function\"!==typeof o.componentDidUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),\"function\"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),r=!1);return Nl(e,t,n,r,l,i)}function Nl(e,t,n,r,i,l){El(e,t);var o=0!==(64&t.effectTag);if(!r&&!o)return i&&jr(t,n,!1),Ll(e,t,l);r=t.stateNode,wl.current=t;var a=o&&\"function\"!==typeof n.getDerivedStateFromError?null:r.render();return t.effectTag|=1,null!==e&&o?(t.child=hi(t,e.child,null,l),t.child=hi(t,null,a,l)):xl(e,t,a,l),t.memoizedState=r.state,i&&jr(t,n,!0),t.child}function Ol(e){var t=e.stateNode;t.pendingContext?Fr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Fr(0,t.context,!1),xi(e,t.containerInfo)}function Rl(e,t,n){var r=t.mode,i=t.pendingProps,l=t.memoizedState;if(0===(64&t.effectTag)){l=null;var o=!1}else l={timedOutAt:null!==l?l.timedOutAt:0},o=!0,t.effectTag&=-65;if(null===e)if(o){var a=i.fallback;e=Yr(null,r,0,null),0===(1&t.mode)&&(e.child=null!==t.memoizedState?t.child.child:t.child),r=Yr(a,r,n,null),e.sibling=r,(n=e).return=r.return=t}else n=r=vi(t,null,i.children,n);else null!==e.memoizedState?(a=(r=e.child).sibling,o?(n=i.fallback,i=Kr(r,r.pendingProps),0===(1&t.mode)&&((o=null!==t.memoizedState?t.child.child:t.child)!==r.child&&(i.child=o)),r=i.sibling=Kr(a,n,a.expirationTime),n=i,i.childExpirationTime=0,n.return=r.return=t):n=r=hi(t,r.child,i.children,n)):(a=e.child,o?(o=i.fallback,(i=Yr(null,r,0,null)).child=a,0===(1&t.mode)&&(i.child=null!==t.memoizedState?t.child.child:t.child),(r=i.sibling=Yr(o,r,n,null)).effectTag|=2,n=i,i.childExpirationTime=0,n.return=r.return=t):r=n=hi(t,a,i.children,n)),t.stateNode=e.stateNode;return t.memoizedState=l,t.child=n,r}function Ll(e,t,n){if(null!==e&&(t.contextDependencies=e.contextDependencies),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child&&o(\"153\"),null!==t.child){for(n=Kr(e=t.child,e.pendingProps,e.expirationTime),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Kr(e,e.pendingProps,e.expirationTime)).return=t;n.sibling=null}return t.child}function Ml(e,t,n){var r=t.expirationTime;if(null!==e){if(e.memoizedProps!==t.pendingProps||Rr.current)kl=!0;else if(r<n){switch(kl=!1,t.tag){case 3:Ol(t),bl();break;case 5:_i(t);break;case 1:zr(t.type)&&Ar(t);break;case 4:xi(t,t.stateNode.containerInfo);break;case 10:Dl(t,t.memoizedProps.value);break;case 13:if(null!==t.memoizedState)return 0!==(r=t.child.childExpirationTime)&&r>=n?Rl(e,t,n):null!==(t=Ll(e,t,n))?t.sibling:null}return Ll(e,t,n)}}else kl=!1;switch(t.expirationTime=0,t.tag){case 2:r=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps;var i=Mr(t,Or.current);if(jl(t,n),i=Xi(null,t,r,e,i,n),t.effectTag|=1,\"object\"===typeof i&&null!==i&&\"function\"===typeof i.render&&void 0===i.$$typeof){if(t.tag=1,Gi(),zr(r)){var l=!0;Ar(t)}else l=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null;var a=r.getDerivedStateFromProps;\"function\"===typeof a&&li(t,r,a,e),i.updater=oi,t.stateNode=i,i._reactInternalFiber=t,si(t,r,e,n),t=Nl(null,t,r,!0,l,n)}else t.tag=0,xl(null,t,i,n),t=t.child;return t;case 16:switch(i=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),l=t.pendingProps,e=function(e){var t=e._result;switch(e._status){case 1:return t;case 2:case 0:throw t;default:switch(e._status=0,(t=(t=e._ctor)()).then(function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)},function(t){0===e._status&&(e._status=2,e._result=t)}),e._status){case 1:return e._result;case 2:throw e._result}throw e._result=t,t}}(i),t.type=e,i=t.tag=function(e){if(\"function\"===typeof e)return Qr(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===tt)return 11;if(e===rt)return 14}return 2}(e),l=ri(e,l),a=void 0,i){case 0:a=Cl(null,t,e,l,n);break;case 1:a=Pl(null,t,e,l,n);break;case 11:a=Tl(null,t,e,l,n);break;case 14:a=_l(null,t,e,ri(e.type,l),r,n);break;default:o(\"306\",e,\"\")}return a;case 0:return r=t.type,i=t.pendingProps,Cl(e,t,r,i=t.elementType===r?i:ri(r,i),n);case 1:return r=t.type,i=t.pendingProps,Pl(e,t,r,i=t.elementType===r?i:ri(r,i),n);case 3:return Ol(t),null===(r=t.updateQueue)&&o(\"282\"),i=null!==(i=t.memoizedState)?i.element:null,to(t,r,t.pendingProps,null,n),(r=t.memoizedState.element)===i?(bl(),t=Ll(e,t,n)):(i=t.stateNode,(i=(null===e||null===e.child)&&i.hydrate)&&(dl=_r(t.stateNode.containerInfo),fl=t,i=pl=!0),i?(t.effectTag|=2,t.child=vi(t,null,r,n)):(xl(e,t,r,n),bl()),t=t.child),t;case 5:return _i(t),null===e&&vl(t),r=t.type,i=t.pendingProps,l=null!==e?e.memoizedProps:null,a=i.children,gr(r,i)?a=null:null!==l&&gr(r,l)&&(t.effectTag|=16),El(e,t),1!==n&&1&t.mode&&i.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(xl(e,t,a,n),t=t.child),t;case 6:return null===e&&vl(t),null;case 13:return Rl(e,t,n);case 4:return xi(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=hi(t,null,r,n):xl(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Tl(e,t,r,i=t.elementType===r?i:ri(r,i),n);case 7:return xl(e,t,t.pendingProps,n),t.child;case 8:case 12:return xl(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,a=t.memoizedProps,Dl(t,l=i.value),null!==a){var u=a.value;if(0===(l=Jt(u,l)?0:0|(\"function\"===typeof r._calculateChangedBits?r._calculateChangedBits(u,l):1073741823))){if(a.children===i.children&&!Rr.current){t=Ll(e,t,n);break e}}else for(null!==(u=t.child)&&(u.return=t);null!==u;){var c=u.contextDependencies;if(null!==c){a=u.child;for(var s=c.first;null!==s;){if(s.context===r&&0!==(s.observedBits&l)){1===u.tag&&((s=Yl(n)).tag=Hl,Gl(u,s)),u.expirationTime<n&&(u.expirationTime=n),null!==(s=u.alternate)&&s.expirationTime<n&&(s.expirationTime=n),s=n;for(var f=u.return;null!==f;){var d=f.alternate;if(f.childExpirationTime<s)f.childExpirationTime=s,null!==d&&d.childExpirationTime<s&&(d.childExpirationTime=s);else{if(!(null!==d&&d.childExpirationTime<s))break;d.childExpirationTime=s}f=f.return}c.expirationTime<n&&(c.expirationTime=n);break}s=s.next}}else a=10===u.tag&&u.type===t.type?null:u.child;if(null!==a)a.return=u;else for(a=u;null!==a;){if(a===t){a=null;break}if(null!==(u=a.sibling)){u.return=a.return,a=u;break}a=a.return}u=a}}xl(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(l=t.pendingProps).children,jl(t,n),r=r(i=Wl(i,l.unstable_observedBits)),t.effectTag|=1,xl(e,t,r,n),t.child;case 14:return l=ri(i=t.type,t.pendingProps),_l(e,t,i,l=ri(i.type,l),r,n);case 15:return Sl(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:ri(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,zr(r)?(e=!0,Ar(t)):e=!1,jl(t,n),ui(t,r,i),si(t,r,i,n),Nl(null,t,r,!0,e,n)}o(\"156\")}var zl={current:null},Il=null,Ul=null,Fl=null;function Dl(e,t){var n=e.type._context;Pr(zl,n._currentValue),n._currentValue=t}function Al(e){var t=zl.current;Cr(zl),e.type._context._currentValue=t}function jl(e,t){Il=e,Fl=Ul=null;var n=e.contextDependencies;null!==n&&n.expirationTime>=t&&(kl=!0),e.contextDependencies=null}function Wl(e,t){return Fl!==e&&!1!==t&&0!==t&&(\"number\"===typeof t&&1073741823!==t||(Fl=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Ul?(null===Il&&o(\"308\"),Ul=t,Il.contextDependencies={first:t,expirationTime:0}):Ul=Ul.next=t),e._currentValue}var Vl=0,Bl=1,Hl=2,$l=3,Ql=!1;function Kl(e){return{baseState:e,firstUpdate:null,lastUpdate:null,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function ql(e){return{baseState:e.baseState,firstUpdate:e.firstUpdate,lastUpdate:e.lastUpdate,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function Yl(e){return{expirationTime:e,tag:Vl,payload:null,callback:null,next:null,nextEffect:null}}function Xl(e,t){null===e.lastUpdate?e.firstUpdate=e.lastUpdate=t:(e.lastUpdate.next=t,e.lastUpdate=t)}function Gl(e,t){var n=e.alternate;if(null===n){var r=e.updateQueue,i=null;null===r&&(r=e.updateQueue=Kl(e.memoizedState))}else r=e.updateQueue,i=n.updateQueue,null===r?null===i?(r=e.updateQueue=Kl(e.memoizedState),i=n.updateQueue=Kl(n.memoizedState)):r=e.updateQueue=ql(i):null===i&&(i=n.updateQueue=ql(r));null===i||r===i?Xl(r,t):null===r.lastUpdate||null===i.lastUpdate?(Xl(r,t),Xl(i,t)):(Xl(r,t),i.lastUpdate=t)}function Jl(e,t){var n=e.updateQueue;null===(n=null===n?e.updateQueue=Kl(e.memoizedState):Zl(e,n)).lastCapturedUpdate?n.firstCapturedUpdate=n.lastCapturedUpdate=t:(n.lastCapturedUpdate.next=t,n.lastCapturedUpdate=t)}function Zl(e,t){var n=e.alternate;return null!==n&&t===n.updateQueue&&(t=e.updateQueue=ql(t)),t}function eo(e,t,n,r,l,o){switch(n.tag){case Bl:return\"function\"===typeof(e=n.payload)?e.call(o,r,l):e;case $l:e.effectTag=-2049&e.effectTag|64;case Vl:if(null===(l=\"function\"===typeof(e=n.payload)?e.call(o,r,l):e)||void 0===l)break;return i({},r,l);case Hl:Ql=!0}return r}function to(e,t,n,r,i){Ql=!1;for(var l=(t=Zl(e,t)).baseState,o=null,a=0,u=t.firstUpdate,c=l;null!==u;){var s=u.expirationTime;s<i?(null===o&&(o=u,l=c),a<s&&(a=s)):(c=eo(e,0,u,c,n,r),null!==u.callback&&(e.effectTag|=32,u.nextEffect=null,null===t.lastEffect?t.firstEffect=t.lastEffect=u:(t.lastEffect.nextEffect=u,t.lastEffect=u))),u=u.next}for(s=null,u=t.firstCapturedUpdate;null!==u;){var f=u.expirationTime;f<i?(null===s&&(s=u,null===o&&(l=c)),a<f&&(a=f)):(c=eo(e,0,u,c,n,r),null!==u.callback&&(e.effectTag|=32,u.nextEffect=null,null===t.lastCapturedEffect?t.firstCapturedEffect=t.lastCapturedEffect=u:(t.lastCapturedEffect.nextEffect=u,t.lastCapturedEffect=u))),u=u.next}null===o&&(t.lastUpdate=null),null===s?t.lastCapturedUpdate=null:e.effectTag|=32,null===o&&null===s&&(l=c),t.baseState=l,t.firstUpdate=o,t.firstCapturedUpdate=s,e.expirationTime=a,e.memoizedState=c}function no(e,t,n){null!==t.firstCapturedUpdate&&(null!==t.lastUpdate&&(t.lastUpdate.next=t.firstCapturedUpdate,t.lastUpdate=t.lastCapturedUpdate),t.firstCapturedUpdate=t.lastCapturedUpdate=null),ro(t.firstEffect,n),t.firstEffect=t.lastEffect=null,ro(t.firstCapturedEffect,n),t.firstCapturedEffect=t.lastCapturedEffect=null}function ro(e,t){for(;null!==e;){var n=e.callback;if(null!==n){e.callback=null;var r=t;\"function\"!==typeof n&&o(\"191\",n),n.call(r)}e=e.nextEffect}}function io(e,t){return{value:e,source:t,stack:ut(t)}}function lo(e){e.effectTag|=4}var oo=void 0,ao=void 0,uo=void 0,co=void 0;oo=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},ao=function(){},uo=function(e,t,n,r,l){var o=e.memoizedProps;if(o!==r){var a=t.stateNode;switch(ki(gi.current),e=null,n){case\"input\":o=bt(a,o),r=bt(a,r),e=[];break;case\"option\":o=Kn(a,o),r=Kn(a,r),e=[];break;case\"select\":o=i({},o,{value:void 0}),r=i({},r,{value:void 0}),e=[];break;case\"textarea\":o=Yn(a,o),r=Yn(a,r),e=[];break;default:\"function\"!==typeof o.onClick&&\"function\"===typeof r.onClick&&(a.onclick=mr)}fr(n,r),a=n=void 0;var u=null;for(n in o)if(!r.hasOwnProperty(n)&&o.hasOwnProperty(n)&&null!=o[n])if(\"style\"===n){var c=o[n];for(a in c)c.hasOwnProperty(a)&&(u||(u={}),u[a]=\"\")}else\"dangerouslySetInnerHTML\"!==n&&\"children\"!==n&&\"suppressContentEditableWarning\"!==n&&\"suppressHydrationWarning\"!==n&&\"autoFocus\"!==n&&(b.hasOwnProperty(n)?e||(e=[]):(e=e||[]).push(n,null));for(n in r){var s=r[n];if(c=null!=o?o[n]:void 0,r.hasOwnProperty(n)&&s!==c&&(null!=s||null!=c))if(\"style\"===n)if(c){for(a in c)!c.hasOwnProperty(a)||s&&s.hasOwnProperty(a)||(u||(u={}),u[a]=\"\");for(a in s)s.hasOwnProperty(a)&&c[a]!==s[a]&&(u||(u={}),u[a]=s[a])}else u||(e||(e=[]),e.push(n,u)),u=s;else\"dangerouslySetInnerHTML\"===n?(s=s?s.__html:void 0,c=c?c.__html:void 0,null!=s&&c!==s&&(e=e||[]).push(n,\"\"+s)):\"children\"===n?c===s||\"string\"!==typeof s&&\"number\"!==typeof s||(e=e||[]).push(n,\"\"+s):\"suppressContentEditableWarning\"!==n&&\"suppressHydrationWarning\"!==n&&(b.hasOwnProperty(n)?(null!=s&&pr(l,n),e||c===s||(e=[])):(e=e||[]).push(n,s))}u&&(e=e||[]).push(\"style\",u),l=e,(t.updateQueue=l)&&lo(t)}},co=function(e,t,n,r){n!==r&&lo(t)};var so=\"function\"===typeof WeakSet?WeakSet:Set;function fo(e,t){var n=t.source,r=t.stack;null===r&&null!==n&&(r=ut(n)),null!==n&&at(n.type),t=t.value,null!==e&&1===e.tag&&at(e.type);try{console.error(t)}catch(i){setTimeout(function(){throw i})}}function po(e){var t=e.ref;if(null!==t)if(\"function\"===typeof t)try{t(null)}catch(n){qo(e,n)}else t.current=null}function mo(e,t,n){if(null!==(n=null!==(n=n.updateQueue)?n.lastEffect:null)){var r=n=n.next;do{if((r.tag&e)!==Ei){var i=r.destroy;r.destroy=void 0,void 0!==i&&i()}(r.tag&t)!==Ei&&(i=r.create,r.destroy=i()),r=r.next}while(r!==n)}}function ho(e){switch(\"function\"===typeof Vr&&Vr(e),e.tag){case 0:case 11:case 14:case 15:var t=e.updateQueue;if(null!==t&&null!==(t=t.lastEffect)){var n=t=t.next;do{var r=n.destroy;if(void 0!==r){var i=e;try{r()}catch(l){qo(i,l)}}n=n.next}while(n!==t)}break;case 1:if(po(e),\"function\"===typeof(t=e.stateNode).componentWillUnmount)try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(l){qo(e,l)}break;case 5:po(e);break;case 4:go(e)}}function vo(e){return 5===e.tag||3===e.tag||4===e.tag}function yo(e){e:{for(var t=e.return;null!==t;){if(vo(t)){var n=t;break e}t=t.return}o(\"160\"),n=void 0}var r=t=void 0;switch(n.tag){case 5:t=n.stateNode,r=!1;break;case 3:case 4:t=n.stateNode.containerInfo,r=!0;break;default:o(\"161\")}16&n.effectTag&&(lr(t,\"\"),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||vo(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}for(var i=e;;){if(5===i.tag||6===i.tag)if(n)if(r){var l=t,a=i.stateNode,u=n;8===l.nodeType?l.parentNode.insertBefore(a,u):l.insertBefore(a,u)}else t.insertBefore(i.stateNode,n);else r?(a=t,u=i.stateNode,8===a.nodeType?(l=a.parentNode).insertBefore(u,a):(l=a).appendChild(u),null!==(a=a._reactRootContainer)&&void 0!==a||null!==l.onclick||(l.onclick=mr)):t.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===e)break;for(;null===i.sibling;){if(null===i.return||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}function go(e){for(var t=e,n=!1,r=void 0,i=void 0;;){if(!n){n=t.return;e:for(;;){switch(null===n&&o(\"160\"),n.tag){case 5:r=n.stateNode,i=!1;break e;case 3:case 4:r=n.stateNode.containerInfo,i=!0;break e}n=n.return}n=!0}if(5===t.tag||6===t.tag){e:for(var l=t,a=l;;)if(ho(a),null!==a.child&&4!==a.tag)a.child.return=a,a=a.child;else{if(a===l)break;for(;null===a.sibling;){if(null===a.return||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}i?(l=r,a=t.stateNode,8===l.nodeType?l.parentNode.removeChild(a):l.removeChild(a)):r.removeChild(t.stateNode)}else if(4===t.tag){if(null!==t.child){r=t.stateNode.containerInfo,i=!0,t.child.return=t,t=t.child;continue}}else if(ho(t),null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return;4===(t=t.return).tag&&(n=!1)}t.sibling.return=t.return,t=t.sibling}}function bo(e,t){switch(t.tag){case 0:case 11:case 14:case 15:mo(Pi,Ni,t);break;case 1:break;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps;e=null!==e?e.memoizedProps:r;var i=t.type,l=t.updateQueue;t.updateQueue=null,null!==l&&function(e,t,n,r,i){e[z]=i,\"input\"===n&&\"radio\"===i.type&&null!=i.name&&kt(e,i),dr(n,r),r=dr(n,i);for(var l=0;l<t.length;l+=2){var o=t[l],a=t[l+1];\"style\"===o?cr(e,a):\"dangerouslySetInnerHTML\"===o?ir(e,a):\"children\"===o?lr(e,a):yt(e,o,a,r)}switch(n){case\"input\":xt(e,i);break;case\"textarea\":Gn(e,i);break;case\"select\":t=e._wrapperState.wasMultiple,e._wrapperState.wasMultiple=!!i.multiple,null!=(n=i.value)?qn(e,!!i.multiple,n,!1):t!==!!i.multiple&&(null!=i.defaultValue?qn(e,!!i.multiple,i.defaultValue,!0):qn(e,!!i.multiple,i.multiple?[]:\"\",!1))}}(n,l,i,e,r)}break;case 6:null===t.stateNode&&o(\"162\"),t.stateNode.nodeValue=t.memoizedProps;break;case 3:case 12:break;case 13:if(n=t.memoizedState,r=void 0,e=t,null===n?r=!1:(r=!0,e=t.child,0===n.timedOutAt&&(n.timedOutAt=xa())),null!==e&&function(e,t){for(var n=e;;){if(5===n.tag){var r=n.stateNode;if(t)r.style.display=\"none\";else{r=n.stateNode;var i=n.memoizedProps.style;i=void 0!==i&&null!==i&&i.hasOwnProperty(\"display\")?i.display:null,r.style.display=ur(\"display\",i)}}else if(6===n.tag)n.stateNode.nodeValue=t?\"\":n.memoizedProps;else{if(13===n.tag&&null!==n.memoizedState){(r=n.child.sibling).return=n,n=r;continue}if(null!==n.child){n.child.return=n,n=n.child;continue}}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}(e,r),null!==(n=t.updateQueue)){t.updateQueue=null;var a=t.stateNode;null===a&&(a=t.stateNode=new so),n.forEach(function(e){var n=function(e,t){var n=e.stateNode;null!==n&&n.delete(t),t=Yo(t=xa(),e),null!==(e=Go(e,t))&&(Zr(e,t),0!==(t=e.expirationTime)&&Ta(e,t))}.bind(null,t,e);a.has(e)||(a.add(e),e.then(n,n))})}break;case 17:break;default:o(\"163\")}}var wo=\"function\"===typeof WeakMap?WeakMap:Map;function ko(e,t,n){(n=Yl(n)).tag=$l,n.payload={element:null};var r=t.value;return n.callback=function(){La(r),fo(e,t)},n}function xo(e,t,n){(n=Yl(n)).tag=$l;var r=e.type.getDerivedStateFromError;if(\"function\"===typeof r){var i=t.value;n.payload=function(){return r(i)}}var l=e.stateNode;return null!==l&&\"function\"===typeof l.componentDidCatch&&(n.callback=function(){\"function\"!==typeof r&&(null===Do?Do=new Set([this]):Do.add(this));var n=t.value,i=t.stack;fo(e,t),this.componentDidCatch(n,{componentStack:null!==i?i:\"\"})}),n}function To(e){switch(e.tag){case 1:zr(e.type)&&Ir();var t=e.effectTag;return 2048&t?(e.effectTag=-2049&t|64,e):null;case 3:return Ti(),Ur(),0!==(64&(t=e.effectTag))&&o(\"285\"),e.effectTag=-2049&t|64,e;case 5:return Si(e),null;case 13:return 2048&(t=e.effectTag)?(e.effectTag=-2049&t|64,e):null;case 18:return null;case 4:return Ti(),null;case 10:return Al(e),null;default:return null}}var _o=He.ReactCurrentDispatcher,So=He.ReactCurrentOwner,Eo=1073741822,Co=!1,Po=null,No=null,Oo=0,Ro=-1,Lo=!1,Mo=null,zo=!1,Io=null,Uo=null,Fo=null,Do=null;function Ao(){if(null!==Po)for(var e=Po.return;null!==e;){var t=e;switch(t.tag){case 1:var n=t.type.childContextTypes;null!==n&&void 0!==n&&Ir();break;case 3:Ti(),Ur();break;case 5:Si(t);break;case 4:Ti();break;case 10:Al(t)}e=e.return}No=null,Oo=0,Ro=-1,Lo=!1,Po=null}function jo(){for(;null!==Mo;){var e=Mo.effectTag;if(16&e&&lr(Mo.stateNode,\"\"),128&e){var t=Mo.alternate;null!==t&&(null!==(t=t.ref)&&(\"function\"===typeof t?t(null):t.current=null))}switch(14&e){case 2:yo(Mo),Mo.effectTag&=-3;break;case 6:yo(Mo),Mo.effectTag&=-3,bo(Mo.alternate,Mo);break;case 4:bo(Mo.alternate,Mo);break;case 8:go(e=Mo),e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,null!==(e=e.alternate)&&(e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null)}Mo=Mo.nextEffect}}function Wo(){for(;null!==Mo;){if(256&Mo.effectTag)e:{var e=Mo.alternate,t=Mo;switch(t.tag){case 0:case 11:case 15:mo(Ci,Ei,t);break e;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:ri(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}break e;case 3:case 5:case 6:case 4:case 17:break e;default:o(\"163\")}}Mo=Mo.nextEffect}}function Vo(e,t){for(;null!==Mo;){var n=Mo.effectTag;if(36&n){var r=Mo.alternate,i=Mo,l=t;switch(i.tag){case 0:case 11:case 15:mo(Oi,Ri,i);break;case 1:var a=i.stateNode;if(4&i.effectTag)if(null===r)a.componentDidMount();else{var u=i.elementType===i.type?r.memoizedProps:ri(i.type,r.memoizedProps);a.componentDidUpdate(u,r.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}null!==(r=i.updateQueue)&&no(0,r,a);break;case 3:if(null!==(r=i.updateQueue)){if(a=null,null!==i.child)switch(i.child.tag){case 5:a=i.child.stateNode;break;case 1:a=i.child.stateNode}no(0,r,a)}break;case 5:l=i.stateNode,null===r&&4&i.effectTag&&yr(i.type,i.memoizedProps)&&l.focus();break;case 6:case 4:case 12:case 13:case 17:break;default:o(\"163\")}}128&n&&(null!==(i=Mo.ref)&&(l=Mo.stateNode,\"function\"===typeof i?i(l):i.current=l)),512&n&&(Io=e),Mo=Mo.nextEffect}}function Bo(){null!==Uo&&xr(Uo),null!==Fo&&Fo()}function Ho(e,t){zo=Co=!0,e.current===t&&o(\"177\");var n=e.pendingCommitExpirationTime;0===n&&o(\"261\"),e.pendingCommitExpirationTime=0;var r=t.expirationTime,i=t.childExpirationTime;for(function(e,t){if(e.didError=!1,0===t)e.earliestPendingTime=0,e.latestPendingTime=0,e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0;else{t<e.latestPingedTime&&(e.latestPingedTime=0);var n=e.latestPendingTime;0!==n&&(n>t?e.earliestPendingTime=e.latestPendingTime=0:e.earliestPendingTime>t&&(e.earliestPendingTime=e.latestPendingTime)),0===(n=e.earliestSuspendedTime)?Zr(e,t):t<e.latestSuspendedTime?(e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0,Zr(e,t)):t>n&&Zr(e,t)}ni(0,e)}(e,i>r?i:r),So.current=null,r=void 0,1<t.effectTag?null!==t.lastEffect?(t.lastEffect.nextEffect=t,r=t.firstEffect):r=t:r=t.firstEffect,hr=_n,vr=function(){var e=Un();if(Fn(e)){if(\"selectionStart\"in e)var t={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(t=(t=e.ownerDocument)&&t.defaultView||window).getSelection&&t.getSelection();if(n&&0!==n.rangeCount){t=n.anchorNode;var r=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{t.nodeType,i.nodeType}catch(p){t=null;break e}var l=0,o=-1,a=-1,u=0,c=0,s=e,f=null;t:for(;;){for(var d;s!==t||0!==r&&3!==s.nodeType||(o=l+r),s!==i||0!==n&&3!==s.nodeType||(a=l+n),3===s.nodeType&&(l+=s.nodeValue.length),null!==(d=s.firstChild);)f=s,s=d;for(;;){if(s===e)break t;if(f===t&&++u===r&&(o=l),f===i&&++c===n&&(a=l),null!==(d=s.nextSibling))break;f=(s=f).parentNode}s=d}t=-1===o||-1===a?null:{start:o,end:a}}else t=null}t=t||{start:0,end:0}}else t=null;return{focusedElem:e,selectionRange:t}}(),_n=!1,Mo=r;null!==Mo;){i=!1;var a=void 0;try{Wo()}catch(c){i=!0,a=c}i&&(null===Mo&&o(\"178\"),qo(Mo,a),null!==Mo&&(Mo=Mo.nextEffect))}for(Mo=r;null!==Mo;){i=!1,a=void 0;try{jo()}catch(c){i=!0,a=c}i&&(null===Mo&&o(\"178\"),qo(Mo,a),null!==Mo&&(Mo=Mo.nextEffect))}for(Dn(vr),vr=null,_n=!!hr,hr=null,e.current=t,Mo=r;null!==Mo;){i=!1,a=void 0;try{Vo(e,n)}catch(c){i=!0,a=c}i&&(null===Mo&&o(\"178\"),qo(Mo,a),null!==Mo&&(Mo=Mo.nextEffect))}if(null!==r&&null!==Io){var u=function(e,t){Fo=Uo=Io=null;var n=ia;ia=!0;do{if(512&t.effectTag){var r=!1,i=void 0;try{var l=t;mo(Mi,Ei,l),mo(Ei,Li,l)}catch(u){r=!0,i=u}r&&qo(t,i)}t=t.nextEffect}while(null!==t);ia=n,0!==(n=e.expirationTime)&&Ta(e,n),sa||ia||Pa(1073741823,!1)}.bind(null,e,r);Uo=l.unstable_runWithPriority(l.unstable_NormalPriority,function(){return kr(u)}),Fo=u}Co=zo=!1,\"function\"===typeof Wr&&Wr(t.stateNode),n=t.expirationTime,0===(t=(t=t.childExpirationTime)>n?t:n)&&(Do=null),function(e,t){e.expirationTime=t,e.finishedWork=null}(e,t)}function $o(e){for(;;){var t=e.alternate,n=e.return,r=e.sibling;if(0===(1024&e.effectTag)){Po=e;e:{var l=t,a=Oo,u=(t=e).pendingProps;switch(t.tag){case 2:case 16:break;case 15:case 0:break;case 1:zr(t.type)&&Ir();break;case 3:Ti(),Ur(),(u=t.stateNode).pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),null!==l&&null!==l.child||(gl(t),t.effectTag&=-3),ao(t);break;case 5:Si(t);var c=ki(wi.current);if(a=t.type,null!==l&&null!=t.stateNode)uo(l,t,a,u,c),l.ref!==t.ref&&(t.effectTag|=128);else if(u){var s=ki(gi.current);if(gl(t)){l=(u=t).stateNode;var f=u.type,d=u.memoizedProps,p=c;switch(l[M]=u,l[z]=d,a=void 0,c=f){case\"iframe\":case\"object\":Sn(\"load\",l);break;case\"video\":case\"audio\":for(f=0;f<te.length;f++)Sn(te[f],l);break;case\"source\":Sn(\"error\",l);break;case\"img\":case\"image\":case\"link\":Sn(\"error\",l),Sn(\"load\",l);break;case\"form\":Sn(\"reset\",l),Sn(\"submit\",l);break;case\"details\":Sn(\"toggle\",l);break;case\"input\":wt(l,d),Sn(\"invalid\",l),pr(p,\"onChange\");break;case\"select\":l._wrapperState={wasMultiple:!!d.multiple},Sn(\"invalid\",l),pr(p,\"onChange\");break;case\"textarea\":Xn(l,d),Sn(\"invalid\",l),pr(p,\"onChange\")}for(a in fr(c,d),f=null,d)d.hasOwnProperty(a)&&(s=d[a],\"children\"===a?\"string\"===typeof s?l.textContent!==s&&(f=[\"children\",s]):\"number\"===typeof s&&l.textContent!==\"\"+s&&(f=[\"children\",\"\"+s]):b.hasOwnProperty(a)&&null!=s&&pr(p,a));switch(c){case\"input\":Ve(l),Tt(l,d,!0);break;case\"textarea\":Ve(l),Jn(l);break;case\"select\":case\"option\":break;default:\"function\"===typeof d.onClick&&(l.onclick=mr)}a=f,u.updateQueue=a,(u=null!==a)&&lo(t)}else{d=t,l=a,p=u,f=9===c.nodeType?c:c.ownerDocument,s===Zn.html&&(s=er(l)),s===Zn.html?\"script\"===l?((l=f.createElement(\"div\")).innerHTML=\"<script><\\/script>\",f=l.removeChild(l.firstChild)):\"string\"===typeof p.is?f=f.createElement(l,{is:p.is}):(f=f.createElement(l),\"select\"===l&&p.multiple&&(f.multiple=!0)):f=f.createElementNS(s,l),(l=f)[M]=d,l[z]=u,oo(l,t,!1,!1),p=l;var m=c,h=dr(f=a,d=u);switch(f){case\"iframe\":case\"object\":Sn(\"load\",p),c=d;break;case\"video\":case\"audio\":for(c=0;c<te.length;c++)Sn(te[c],p);c=d;break;case\"source\":Sn(\"error\",p),c=d;break;case\"img\":case\"image\":case\"link\":Sn(\"error\",p),Sn(\"load\",p),c=d;break;case\"form\":Sn(\"reset\",p),Sn(\"submit\",p),c=d;break;case\"details\":Sn(\"toggle\",p),c=d;break;case\"input\":wt(p,d),c=bt(p,d),Sn(\"invalid\",p),pr(m,\"onChange\");break;case\"option\":c=Kn(p,d);break;case\"select\":p._wrapperState={wasMultiple:!!d.multiple},c=i({},d,{value:void 0}),Sn(\"invalid\",p),pr(m,\"onChange\");break;case\"textarea\":Xn(p,d),c=Yn(p,d),Sn(\"invalid\",p),pr(m,\"onChange\");break;default:c=d}fr(f,c),s=void 0;var v=f,y=p,g=c;for(s in g)if(g.hasOwnProperty(s)){var w=g[s];\"style\"===s?cr(y,w):\"dangerouslySetInnerHTML\"===s?null!=(w=w?w.__html:void 0)&&ir(y,w):\"children\"===s?\"string\"===typeof w?(\"textarea\"!==v||\"\"!==w)&&lr(y,w):\"number\"===typeof w&&lr(y,\"\"+w):\"suppressContentEditableWarning\"!==s&&\"suppressHydrationWarning\"!==s&&\"autoFocus\"!==s&&(b.hasOwnProperty(s)?null!=w&&pr(m,s):null!=w&&yt(y,s,w,h))}switch(f){case\"input\":Ve(p),Tt(p,d,!1);break;case\"textarea\":Ve(p),Jn(p);break;case\"option\":null!=d.value&&p.setAttribute(\"value\",\"\"+gt(d.value));break;case\"select\":(c=p).multiple=!!d.multiple,null!=(p=d.value)?qn(c,!!d.multiple,p,!1):null!=d.defaultValue&&qn(c,!!d.multiple,d.defaultValue,!0);break;default:\"function\"===typeof c.onClick&&(p.onclick=mr)}(u=yr(a,u))&&lo(t),t.stateNode=l}null!==t.ref&&(t.effectTag|=128)}else null===t.stateNode&&o(\"166\");break;case 6:l&&null!=t.stateNode?co(l,t,l.memoizedProps,u):(\"string\"!==typeof u&&(null===t.stateNode&&o(\"166\")),l=ki(wi.current),ki(gi.current),gl(t)?(a=(u=t).stateNode,l=u.memoizedProps,a[M]=u,(u=a.nodeValue!==l)&&lo(t)):(a=t,(u=(9===l.nodeType?l:l.ownerDocument).createTextNode(u))[M]=t,a.stateNode=u));break;case 11:break;case 13:if(u=t.memoizedState,0!==(64&t.effectTag)){t.expirationTime=a,Po=t;break e}u=null!==u,a=null!==l&&null!==l.memoizedState,null!==l&&!u&&a&&(null!==(l=l.child.sibling)&&(null!==(c=t.firstEffect)?(t.firstEffect=l,l.nextEffect=c):(t.firstEffect=t.lastEffect=l,l.nextEffect=null),l.effectTag=8)),(u||a)&&(t.effectTag|=4);break;case 7:case 8:case 12:break;case 4:Ti(),ao(t);break;case 10:Al(t);break;case 9:case 14:break;case 17:zr(t.type)&&Ir();break;case 18:break;default:o(\"156\")}Po=null}if(t=e,1===Oo||1!==t.childExpirationTime){for(u=0,a=t.child;null!==a;)(l=a.expirationTime)>u&&(u=l),(c=a.childExpirationTime)>u&&(u=c),a=a.sibling;t.childExpirationTime=u}if(null!==Po)return Po;null!==n&&0===(1024&n.effectTag)&&(null===n.firstEffect&&(n.firstEffect=e.firstEffect),null!==e.lastEffect&&(null!==n.lastEffect&&(n.lastEffect.nextEffect=e.firstEffect),n.lastEffect=e.lastEffect),1<e.effectTag&&(null!==n.lastEffect?n.lastEffect.nextEffect=e:n.firstEffect=e,n.lastEffect=e))}else{if(null!==(e=To(e)))return e.effectTag&=1023,e;null!==n&&(n.firstEffect=n.lastEffect=null,n.effectTag|=1024)}if(null!==r)return r;if(null===n)break;e=n}return null}function Qo(e){var t=Ml(e.alternate,e,Oo);return e.memoizedProps=e.pendingProps,null===t&&(t=$o(e)),So.current=null,t}function Ko(e,t){Co&&o(\"243\"),Bo(),Co=!0;var n=_o.current;_o.current=ul;var r=e.nextExpirationTimeToWorkOn;r===Oo&&e===No&&null!==Po||(Ao(),Oo=r,Po=Kr((No=e).current,null),e.pendingCommitExpirationTime=0);for(var i=!1;;){try{if(t)for(;null!==Po&&!Ea();)Po=Qo(Po);else for(;null!==Po;)Po=Qo(Po)}catch(y){if(Fl=Ul=Il=null,Gi(),null===Po)i=!0,La(y);else{null===Po&&o(\"271\");var l=Po,a=l.return;if(null!==a){e:{var u=e,c=a,s=l,f=y;if(a=Oo,s.effectTag|=1024,s.firstEffect=s.lastEffect=null,null!==f&&\"object\"===typeof f&&\"function\"===typeof f.then){var d=f;f=c;var p=-1,m=-1;do{if(13===f.tag){var h=f.alternate;if(null!==h&&null!==(h=h.memoizedState)){m=10*(1073741822-h.timedOutAt);break}\"number\"===typeof(h=f.pendingProps.maxDuration)&&(0>=h?p=0:(-1===p||h<p)&&(p=h))}f=f.return}while(null!==f);f=c;do{if((h=13===f.tag)&&(h=void 0!==f.memoizedProps.fallback&&null===f.memoizedState),h){if(null===(c=f.updateQueue)?((c=new Set).add(d),f.updateQueue=c):c.add(d),0===(1&f.mode)){f.effectTag|=64,s.effectTag&=-1957,1===s.tag&&(null===s.alternate?s.tag=17:((a=Yl(1073741823)).tag=Hl,Gl(s,a))),s.expirationTime=1073741823;break e}c=a;var v=(s=u).pingCache;null===v?(v=s.pingCache=new wo,h=new Set,v.set(d,h)):void 0===(h=v.get(d))&&(h=new Set,v.set(d,h)),h.has(c)||(h.add(c),s=Xo.bind(null,s,d,c),d.then(s,s)),-1===p?u=1073741823:(-1===m&&(m=10*(1073741822-ti(u,a))-5e3),u=m+p),0<=u&&Ro<u&&(Ro=u),f.effectTag|=2048,f.expirationTime=a;break e}f=f.return}while(null!==f);f=Error((at(s.type)||\"A React component\")+\" suspended while rendering, but no fallback UI was specified.\\n\\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.\"+ut(s))}Lo=!0,f=io(f,s),u=c;do{switch(u.tag){case 3:u.effectTag|=2048,u.expirationTime=a,Jl(u,a=ko(u,f,a));break e;case 1:if(p=f,m=u.type,s=u.stateNode,0===(64&u.effectTag)&&(\"function\"===typeof m.getDerivedStateFromError||null!==s&&\"function\"===typeof s.componentDidCatch&&(null===Do||!Do.has(s)))){u.effectTag|=2048,u.expirationTime=a,Jl(u,a=xo(u,p,a));break e}}u=u.return}while(null!==u)}Po=$o(l);continue}i=!0,La(y)}}break}if(Co=!1,_o.current=n,Fl=Ul=Il=null,Gi(),i)No=null,e.finishedWork=null;else if(null!==Po)e.finishedWork=null;else{if(null===(n=e.current.alternate)&&o(\"281\"),No=null,Lo){if(i=e.latestPendingTime,l=e.latestSuspendedTime,a=e.latestPingedTime,0!==i&&i<r||0!==l&&l<r||0!==a&&a<r)return ei(e,r),void ka(e,n,r,e.expirationTime,-1);if(!e.didError&&t)return e.didError=!0,r=e.nextExpirationTimeToWorkOn=r,t=e.expirationTime=1073741823,void ka(e,n,r,t,-1)}t&&-1!==Ro?(ei(e,r),(t=10*(1073741822-ti(e,r)))<Ro&&(Ro=t),t=10*(1073741822-xa()),t=Ro-t,ka(e,n,r,e.expirationTime,0>t?0:t)):(e.pendingCommitExpirationTime=r,e.finishedWork=n)}}function qo(e,t){for(var n=e.return;null!==n;){switch(n.tag){case 1:var r=n.stateNode;if(\"function\"===typeof n.type.getDerivedStateFromError||\"function\"===typeof r.componentDidCatch&&(null===Do||!Do.has(r)))return Gl(n,e=xo(n,e=io(t,e),1073741823)),void Jo(n,1073741823);break;case 3:return Gl(n,e=ko(n,e=io(t,e),1073741823)),void Jo(n,1073741823)}n=n.return}3===e.tag&&(Gl(e,n=ko(e,n=io(t,e),1073741823)),Jo(e,1073741823))}function Yo(e,t){var n=l.unstable_getCurrentPriorityLevel(),r=void 0;if(0===(1&t.mode))r=1073741823;else if(Co&&!zo)r=Oo;else{switch(n){case l.unstable_ImmediatePriority:r=1073741823;break;case l.unstable_UserBlockingPriority:r=1073741822-10*(1+((1073741822-e+15)/10|0));break;case l.unstable_NormalPriority:r=1073741822-25*(1+((1073741822-e+500)/25|0));break;case l.unstable_LowPriority:case l.unstable_IdlePriority:r=1;break;default:o(\"313\")}null!==No&&r===Oo&&--r}return n===l.unstable_UserBlockingPriority&&(0===aa||r<aa)&&(aa=r),r}function Xo(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),null!==No&&Oo===n?No=null:(t=e.earliestSuspendedTime,r=e.latestSuspendedTime,0!==t&&n<=t&&n>=r&&(e.didError=!1,(0===(t=e.latestPingedTime)||t>n)&&(e.latestPingedTime=n),ni(n,e),0!==(n=e.expirationTime)&&Ta(e,n)))}function Go(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var r=e.return,i=null;if(null===r&&3===e.tag)i=e.stateNode;else for(;null!==r;){if(n=r.alternate,r.childExpirationTime<t&&(r.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===r.return&&3===r.tag){i=r.stateNode;break}r=r.return}return i}function Jo(e,t){null!==(e=Go(e,t))&&(!Co&&0!==Oo&&t>Oo&&Ao(),Zr(e,t),Co&&!zo&&No===e||Ta(e,e.expirationTime),ya>va&&(ya=0,o(\"185\")))}function Zo(e,t,n,r,i){return l.unstable_runWithPriority(l.unstable_ImmediatePriority,function(){return e(t,n,r,i)})}var ea=null,ta=null,na=0,ra=void 0,ia=!1,la=null,oa=0,aa=0,ua=!1,ca=null,sa=!1,fa=!1,da=null,pa=l.unstable_now(),ma=1073741822-(pa/10|0),ha=ma,va=50,ya=0,ga=null;function ba(){ma=1073741822-((l.unstable_now()-pa)/10|0)}function wa(e,t){if(0!==na){if(t<na)return;null!==ra&&l.unstable_cancelCallback(ra)}na=t,e=l.unstable_now()-pa,ra=l.unstable_scheduleCallback(Ca,{timeout:10*(1073741822-t)-e})}function ka(e,t,n,r,i){e.expirationTime=r,0!==i||Ea()?0<i&&(e.timeoutHandle=br(function(e,t,n){e.pendingCommitExpirationTime=n,e.finishedWork=t,ba(),ha=ma,Na(e,n)}.bind(null,e,t,n),i)):(e.pendingCommitExpirationTime=n,e.finishedWork=t)}function xa(){return ia?ha:(_a(),0!==oa&&1!==oa||(ba(),ha=ma),ha)}function Ta(e,t){null===e.nextScheduledRoot?(e.expirationTime=t,null===ta?(ea=ta=e,e.nextScheduledRoot=e):(ta=ta.nextScheduledRoot=e).nextScheduledRoot=ea):t>e.expirationTime&&(e.expirationTime=t),ia||(sa?fa&&(la=e,oa=1073741823,Oa(e,1073741823,!1)):1073741823===t?Pa(1073741823,!1):wa(e,t))}function _a(){var e=0,t=null;if(null!==ta)for(var n=ta,r=ea;null!==r;){var i=r.expirationTime;if(0===i){if((null===n||null===ta)&&o(\"244\"),r===r.nextScheduledRoot){ea=ta=r.nextScheduledRoot=null;break}if(r===ea)ea=i=r.nextScheduledRoot,ta.nextScheduledRoot=i,r.nextScheduledRoot=null;else{if(r===ta){(ta=n).nextScheduledRoot=ea,r.nextScheduledRoot=null;break}n.nextScheduledRoot=r.nextScheduledRoot,r.nextScheduledRoot=null}r=n.nextScheduledRoot}else{if(i>e&&(e=i,t=r),r===ta)break;if(1073741823===e)break;n=r,r=r.nextScheduledRoot}}la=t,oa=e}var Sa=!1;function Ea(){return!!Sa||!!l.unstable_shouldYield()&&(Sa=!0)}function Ca(){try{if(!Ea()&&null!==ea){ba();var e=ea;do{var t=e.expirationTime;0!==t&&ma<=t&&(e.nextExpirationTimeToWorkOn=ma),e=e.nextScheduledRoot}while(e!==ea)}Pa(0,!0)}finally{Sa=!1}}function Pa(e,t){if(_a(),t)for(ba(),ha=ma;null!==la&&0!==oa&&e<=oa&&!(Sa&&ma>oa);)Oa(la,oa,ma>oa),_a(),ba(),ha=ma;else for(;null!==la&&0!==oa&&e<=oa;)Oa(la,oa,!1),_a();if(t&&(na=0,ra=null),0!==oa&&wa(la,oa),ya=0,ga=null,null!==da)for(e=da,da=null,t=0;t<e.length;t++){var n=e[t];try{n._onComplete()}catch(r){ua||(ua=!0,ca=r)}}if(ua)throw e=ca,ca=null,ua=!1,e}function Na(e,t){ia&&o(\"253\"),la=e,oa=t,Oa(e,t,!1),Pa(1073741823,!1)}function Oa(e,t,n){if(ia&&o(\"245\"),ia=!0,n){var r=e.finishedWork;null!==r?Ra(e,r,t):(e.finishedWork=null,-1!==(r=e.timeoutHandle)&&(e.timeoutHandle=-1,wr(r)),Ko(e,n),null!==(r=e.finishedWork)&&(Ea()?e.finishedWork=r:Ra(e,r,t)))}else null!==(r=e.finishedWork)?Ra(e,r,t):(e.finishedWork=null,-1!==(r=e.timeoutHandle)&&(e.timeoutHandle=-1,wr(r)),Ko(e,n),null!==(r=e.finishedWork)&&Ra(e,r,t));ia=!1}function Ra(e,t,n){var r=e.firstBatch;if(null!==r&&r._expirationTime>=n&&(null===da?da=[r]:da.push(r),r._defer))return e.finishedWork=t,void(e.expirationTime=0);e.finishedWork=null,e===ga?ya++:(ga=e,ya=0),l.unstable_runWithPriority(l.unstable_ImmediatePriority,function(){Ho(e,t)})}function La(e){null===la&&o(\"246\"),la.expirationTime=0,ua||(ua=!0,ca=e)}function Ma(e,t){var n=sa;sa=!0;try{return e(t)}finally{(sa=n)||ia||Pa(1073741823,!1)}}function za(e,t){if(sa&&!fa){fa=!0;try{return e(t)}finally{fa=!1}}return e(t)}function Ia(e,t,n){sa||ia||0===aa||(Pa(aa,!1),aa=0);var r=sa;sa=!0;try{return l.unstable_runWithPriority(l.unstable_UserBlockingPriority,function(){return e(t,n)})}finally{(sa=r)||ia||Pa(1073741823,!1)}}function Ua(e,t,n,r,i){var l=t.current;e:if(n){t:{2===tn(n=n._reactInternalFiber)&&1===n.tag||o(\"170\");var a=n;do{switch(a.tag){case 3:a=a.stateNode.context;break t;case 1:if(zr(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break t}}a=a.return}while(null!==a);o(\"171\"),a=void 0}if(1===n.tag){var u=n.type;if(zr(u)){n=Dr(n,u,a);break e}}n=a}else n=Nr;return null===t.context?t.context=n:t.pendingContext=n,t=i,(i=Yl(r)).payload={element:e},null!==(t=void 0===t?null:t)&&(i.callback=t),Bo(),Gl(l,i),Jo(l,r),r}function Fa(e,t,n,r){var i=t.current;return Ua(e,t,n,i=Yo(xa(),i),r)}function Da(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Aa(e){var t=1073741822-25*(1+((1073741822-xa()+500)/25|0));t>=Eo&&(t=Eo-1),this._expirationTime=Eo=t,this._root=e,this._callbacks=this._next=null,this._hasChildren=this._didComplete=!1,this._children=null,this._defer=!0}function ja(){this._callbacks=null,this._didCommit=!1,this._onCommit=this._onCommit.bind(this)}function Wa(e,t,n){e={current:t=$r(3,null,null,t?3:0),containerInfo:e,pendingChildren:null,pingCache:null,earliestPendingTime:0,latestPendingTime:0,earliestSuspendedTime:0,latestSuspendedTime:0,latestPingedTime:0,didError:!1,pendingCommitExpirationTime:0,finishedWork:null,timeoutHandle:-1,context:null,pendingContext:null,hydrate:n,nextExpirationTimeToWorkOn:0,expirationTime:0,firstBatch:null,nextScheduledRoot:null},this._internalRoot=t.stateNode=e}function Va(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||\" react-mount-point-unstable \"!==e.nodeValue))}function Ba(e,t,n,r,i){var l=n._reactRootContainer;if(l){if(\"function\"===typeof i){var o=i;i=function(){var e=Da(l._internalRoot);o.call(e)}}null!=e?l.legacy_renderSubtreeIntoContainer(e,t,i):l.render(t,i)}else{if(l=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute(\"data-reactroot\"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new Wa(e,!1,t)}(n,r),\"function\"===typeof i){var a=i;i=function(){var e=Da(l._internalRoot);a.call(e)}}za(function(){null!=e?l.legacy_renderSubtreeIntoContainer(e,t,i):l.render(t,i)})}return Da(l._internalRoot)}function Ha(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return Va(t)||o(\"200\"),function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:qe,key:null==r?null:\"\"+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)}Ee=function(e,t,n){switch(t){case\"input\":if(xt(e,n),t=n.name,\"radio\"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll(\"input[name=\"+JSON.stringify(\"\"+t)+'][type=\"radio\"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=D(r);i||o(\"90\"),Be(r),xt(r,i)}}}break;case\"textarea\":Gn(e,n);break;case\"select\":null!=(t=n.value)&&qn(e,!!n.multiple,t,!1)}},Aa.prototype.render=function(e){this._defer||o(\"250\"),this._hasChildren=!0,this._children=e;var t=this._root._internalRoot,n=this._expirationTime,r=new ja;return Ua(e,t,null,n,r._onCommit),r},Aa.prototype.then=function(e){if(this._didComplete)e();else{var t=this._callbacks;null===t&&(t=this._callbacks=[]),t.push(e)}},Aa.prototype.commit=function(){var e=this._root._internalRoot,t=e.firstBatch;if(this._defer&&null!==t||o(\"251\"),this._hasChildren){var n=this._expirationTime;if(t!==this){this._hasChildren&&(n=this._expirationTime=t._expirationTime,this.render(this._children));for(var r=null,i=t;i!==this;)r=i,i=i._next;null===r&&o(\"251\"),r._next=i._next,this._next=t,e.firstBatch=this}this._defer=!1,Na(e,n),t=this._next,this._next=null,null!==(t=e.firstBatch=t)&&t._hasChildren&&t.render(t._children)}else this._next=null,this._defer=!1},Aa.prototype._onComplete=function(){if(!this._didComplete){this._didComplete=!0;var e=this._callbacks;if(null!==e)for(var t=0;t<e.length;t++)(0,e[t])()}},ja.prototype.then=function(e){if(this._didCommit)e();else{var t=this._callbacks;null===t&&(t=this._callbacks=[]),t.push(e)}},ja.prototype._onCommit=function(){if(!this._didCommit){this._didCommit=!0;var e=this._callbacks;if(null!==e)for(var t=0;t<e.length;t++){var n=e[t];\"function\"!==typeof n&&o(\"191\",n),n()}}},Wa.prototype.render=function(e,t){var n=this._internalRoot,r=new ja;return null!==(t=void 0===t?null:t)&&r.then(t),Fa(e,n,null,r._onCommit),r},Wa.prototype.unmount=function(e){var t=this._internalRoot,n=new ja;return null!==(e=void 0===e?null:e)&&n.then(e),Fa(null,t,null,n._onCommit),n},Wa.prototype.legacy_renderSubtreeIntoContainer=function(e,t,n){var r=this._internalRoot,i=new ja;return null!==(n=void 0===n?null:n)&&i.then(n),Fa(t,r,e,i._onCommit),i},Wa.prototype.createBatch=function(){var e=new Aa(this),t=e._expirationTime,n=this._internalRoot,r=n.firstBatch;if(null===r)n.firstBatch=e,e._next=null;else{for(n=null;null!==r&&r._expirationTime>=t;)n=r,r=r._next;e._next=r,null!==n&&(n._next=e)}return e},Le=Ma,Me=Ia,ze=function(){ia||0===aa||(Pa(aa,!1),aa=0)};var $a={createPortal:Ha,findDOMNode:function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;return void 0===t&&(\"function\"===typeof e.render?o(\"188\"):o(\"268\",Object.keys(e))),e=null===(e=rn(t))?null:e.stateNode},hydrate:function(e,t,n){return Va(t)||o(\"200\"),Ba(null,e,t,!0,n)},render:function(e,t,n){return Va(t)||o(\"200\"),Ba(null,e,t,!1,n)},unstable_renderSubtreeIntoContainer:function(e,t,n,r){return Va(n)||o(\"200\"),(null==e||void 0===e._reactInternalFiber)&&o(\"38\"),Ba(e,t,n,!1,r)},unmountComponentAtNode:function(e){return Va(e)||o(\"40\"),!!e._reactRootContainer&&(za(function(){Ba(null,null,e,!1,function(){e._reactRootContainer=null})}),!0)},unstable_createPortal:function(){return Ha.apply(void 0,arguments)},unstable_batchedUpdates:Ma,unstable_interactiveUpdates:Ia,flushSync:function(e,t){ia&&o(\"187\");var n=sa;sa=!0;try{return Zo(e,t)}finally{sa=n,Pa(1073741823,!1)}},unstable_createRoot:function(e,t){return Va(e)||o(\"299\",\"unstable_createRoot\"),new Wa(e,!0,null!=t&&!0===t.hydrate)},unstable_flushControlled:function(e){var t=sa;sa=!0;try{Zo(e)}finally{(sa=t)||ia||Pa(1073741823,!1)}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{Events:[U,F,D,N.injectEventPluginsByName,g,H,function(e){E(e,B)},Oe,Re,Pn,R]}};!function(e){var t=e.findFiberByHostInstance;(function(e){if(\"undefined\"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);Wr=Br(function(e){return t.onCommitFiberRoot(n,e)}),Vr=Br(function(e){return t.onCommitFiberUnmount(n,e)})}catch(r){}})(i({},e,{overrideProps:null,currentDispatcherRef:He.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=rn(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null}}))}({findFiberByHostInstance:I,bundleType:0,version:\"16.8.2\",rendererPackageName:\"react-dom\"});var Qa={default:$a},Ka=Qa&&$a||Qa;e.exports=Ka.default||Ka},function(e,t,n){\"use strict\";e.exports=n(21)},function(e,t,n){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=null,r=!1,i=3,l=-1,o=-1,a=!1,u=!1;function c(){if(!a){var e=n.expirationTime;u?T():u=!0,x(d,e)}}function s(){var e=n,t=n.next;if(n===t)n=null;else{var r=n.previous;n=r.next=t,t.previous=r}e.next=e.previous=null,r=e.callback,t=e.expirationTime,e=e.priorityLevel;var l=i,a=o;i=e,o=t;try{var u=r()}finally{i=l,o=a}if(\"function\"===typeof u)if(u={callback:u,priorityLevel:e,expirationTime:t,next:null,previous:null},null===n)n=u.next=u.previous=u;else{r=null,e=n;do{if(e.expirationTime>=t){r=e;break}e=e.next}while(e!==n);null===r?r=n:r===n&&(n=u,c()),(t=r.previous).next=r.previous=u,u.next=r,u.previous=t}}function f(){if(-1===l&&null!==n&&1===n.priorityLevel){a=!0;try{do{s()}while(null!==n&&1===n.priorityLevel)}finally{a=!1,null!==n?c():u=!1}}}function d(e){a=!0;var i=r;r=e;try{if(e)for(;null!==n;){var l=t.unstable_now();if(!(n.expirationTime<=l))break;do{s()}while(null!==n&&n.expirationTime<=l)}else if(null!==n)do{s()}while(null!==n&&!_())}finally{a=!1,r=i,null!==n?c():u=!1,f()}}var p,m,h=Date,v=\"function\"===typeof setTimeout?setTimeout:void 0,y=\"function\"===typeof clearTimeout?clearTimeout:void 0,g=\"function\"===typeof requestAnimationFrame?requestAnimationFrame:void 0,b=\"function\"===typeof cancelAnimationFrame?cancelAnimationFrame:void 0;function w(e){p=g(function(t){y(m),e(t)}),m=v(function(){b(p),e(t.unstable_now())},100)}if(\"object\"===typeof performance&&\"function\"===typeof performance.now){var k=performance;t.unstable_now=function(){return k.now()}}else t.unstable_now=function(){return h.now()};var x,T,_,S=null;if(\"undefined\"!==typeof window?S=window:\"undefined\"!==typeof e&&(S=e),S&&S._schedMock){var E=S._schedMock;x=E[0],T=E[1],_=E[2],t.unstable_now=E[3]}else if(\"undefined\"===typeof window||\"function\"!==typeof MessageChannel){var C=null,P=function(e){if(null!==C)try{C(e)}finally{C=null}};x=function(e){null!==C?setTimeout(x,0,e):(C=e,setTimeout(P,0,!1))},T=function(){C=null},_=function(){return!1}}else{\"undefined\"!==typeof console&&(\"function\"!==typeof g&&console.error(\"This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills\"),\"function\"!==typeof b&&console.error(\"This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills\"));var N=null,O=!1,R=-1,L=!1,M=!1,z=0,I=33,U=33;_=function(){return z<=t.unstable_now()};var F=new MessageChannel,D=F.port2;F.port1.onmessage=function(){O=!1;var e=N,n=R;N=null,R=-1;var r=t.unstable_now(),i=!1;if(0>=z-r){if(!(-1!==n&&n<=r))return L||(L=!0,w(A)),N=e,void(R=n);i=!0}if(null!==e){M=!0;try{e(i)}finally{M=!1}}};var A=function e(t){if(null!==N){w(e);var n=t-z+U;n<U&&I<U?(8>n&&(n=8),U=n<I?I:n):I=n,z=t+U,O||(O=!0,D.postMessage(void 0))}else L=!1};x=function(e,t){N=e,R=t,M||0>t?D.postMessage(void 0):L||(L=!0,w(A))},T=function(){N=null,O=!1,R=-1}}t.unstable_ImmediatePriority=1,t.unstable_UserBlockingPriority=2,t.unstable_NormalPriority=3,t.unstable_IdlePriority=5,t.unstable_LowPriority=4,t.unstable_runWithPriority=function(e,n){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=i,o=l;i=e,l=t.unstable_now();try{return n()}finally{i=r,l=o,f()}},t.unstable_next=function(e){switch(i){case 1:case 2:case 3:var n=3;break;default:n=i}var r=i,o=l;i=n,l=t.unstable_now();try{return e()}finally{i=r,l=o,f()}},t.unstable_scheduleCallback=function(e,r){var o=-1!==l?l:t.unstable_now();if(\"object\"===typeof r&&null!==r&&\"number\"===typeof r.timeout)r=o+r.timeout;else switch(i){case 1:r=o+-1;break;case 2:r=o+250;break;case 5:r=o+1073741823;break;case 4:r=o+1e4;break;default:r=o+5e3}if(e={callback:e,priorityLevel:i,expirationTime:r,next:null,previous:null},null===n)n=e.next=e.previous=e,c();else{o=null;var a=n;do{if(a.expirationTime>r){o=a;break}a=a.next}while(a!==n);null===o?o=n:o===n&&(n=e,c()),(r=o.previous).next=o.previous=e,e.next=o,e.previous=r}return e},t.unstable_cancelCallback=function(e){var t=e.next;if(null!==t){if(t===e)n=null;else{e===n&&(n=t);var r=e.previous;r.next=t,t.previous=r}e.next=e.previous=null}},t.unstable_wrapCallback=function(e){var n=i;return function(){var r=i,o=l;i=n,l=t.unstable_now();try{return e.apply(this,arguments)}finally{i=r,l=o,f()}}},t.unstable_getCurrentPriorityLevel=function(){return i},t.unstable_shouldYield=function(){return!r&&(null!==n&&n.expirationTime<o||_())},t.unstable_continueExecution=function(){null!==n&&c()},t.unstable_pauseExecution=function(){},t.unstable_getFirstCallbackNode=function(){return n}}).call(this,n(22))},function(e,t){var n;n=function(){return this}();try{n=n||Function(\"return this\")()||(0,eval)(\"this\")}catch(r){\"object\"===typeof window&&(n=window)}e.exports=n}]]);//# sourceMappingURL=1.84e4dc26.chunk.js.map</script><script>(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,,,function(e,t,a){e.exports=a.p+\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiB2aWV3Qm94PSIwIDAgNjEyIDYxMiI+PHBhdGggZD0iTTU4Ny41NzIgMTg2Ljg4MWMtMzIuMjY2LTc1LjIyNS04Ny4wOTYtMTI5LjkzNC0xNjIuOTQ5LTE2Mi4yODVDMzg2LjcxMSA4LjQyNyAzNDcuMzI4LjE2OCAzMDUuODMyLjE2OGMtNDEuNDg4IDAtODAuOTE0IDguMTgxLTExOC43ODQgMjQuNDI4LTc1LjIyNCAzMi4yNjUtMTMwLjYzMyA4Ni45MzktMTYyLjk1NiAxNjIuMjg1QzcuODk1IDIyNC42MjkgMCAyNjQuMTc2IDAgMzA1LjY2NGMwIDQxLjQ5NiA3Ljg5NSA4MS4zNzEgMjQuMDkyIDExOS4xMjcgMzIuMzIzIDc1LjM0NiA4Ny43MzEgMTMwLjM0OCAxNjIuOTU2IDE2Mi42MjEgMzcuODcgMTYuMjQ3IDc3LjI5NSAyNC40MiAxMTguNzg0IDI0LjQyIDQxLjQ5NiAwIDgwLjg3OS04LjI1OSAxMTguNzkxLTI0LjQyIDc1Ljg1NC0zMi4zNTIgMTMwLjY4NC04Ny40MDMgMTYyLjk0OS0xNjIuNjIxQzYwMy44MTkgMzg2LjkxNCA2MTIgMzQ3LjE2IDYxMiAzMDUuNjY0YzAtNDEuNDg4LTguMTgxLTgwLjkwNy0yNC40MjgtMTE4Ljc4M3pNMjA0LjEwOSA1Ny4wNTRjLTI2LjQzNCAzMy40NTgtNDUuODM2IDc1Ljk1My01OC4yMjEgMTI3LjQ4NUg2NS45MTdjMjkuNDQ1LTU3LjIyMSA3OC45NzItMTAzLjA2NCAxMzguMTkyLTEyNy40ODV6TTM3LjE0MSAzMDUuNjY0YzAtMjkuMTEgNC42ODMtNTcuMjE0IDEzLjcyLTg0LjMxOWg4Ny42NjdjLTQuMzQ4IDI4LjQzOS02LjM2IDU2LjU1MS02LjM2IDg0LjMxOSAwIDI3LjQ0IDIuMDEzIDU1LjIxNyA2LjM2IDgzLjY1Nkg1MC4xOWMtOC43MDEtMjcuMTA1LTEzLjA0OS01NS4yMDktMTMuMDQ5LTgzLjY1NnptMjguNzc2IDEyMC40NjJoNzkuOTcyYzEyLjM4NSA1Mi41MzEgMzEuNzg4IDk1LjY5NyA1OC4yMjEgMTI4LjgyNy02MC4yMjgtMjUuMDk5LTEwOS43NTQtNzAuOTQxLTEzOC4xOTMtMTI4LjgyN3ptMjIxLjE3NyAxNDUuNTUzYy0yMS43NTEtNi4zNTQtNDIuMTYtMjIuNDE1LTYwLjU2Mi00OC41MTMtMTguNDAzLTI2LjEwNS0zMi40NTgtNTguNTU3LTQyLjE2LTk3LjA0aDEwMi43MjJ2MTQ1LjU1M3ptMC0xODIuMzU5SDE3Ni4wMDVjLTQuMzU0LTI5Ljc4Mi02LjY5Ni01Ny41NTgtNi42OTYtODMuNjU2IDAtMjguMTA0IDIuMzQxLTU2LjIxNSA3LjM2Ny04NC4zMTloMTEwLjQxN1YzODkuMzJoLjAwMXptMC0yMDQuNzhIMTg0LjM3MmMxMC4zNzItMzguMTQ4IDI0LjUwNi03MC4yMTQgNDIuODMxLTk2LjAzNCAxOC40ODEtMjYuMDQ4IDM4LjE0MS00Mi4xNiA1OS44OTItNDguMTg1VjE4NC41NHptMjU4Ljk5IDBoLTc5Ljk3M2MtMTIuMzc4LTUxLjUzMy0zMS43ODctOTQuMDI4LTU4LjIyMS0xMjcuNDg1IDU5LjIyOCAyNC40MiAxMDguNzQ4IDcwLjI2MyAxMzguMTk0IDEyNy40ODV6TTMyNC45MDYgNDAuMzIxYzIxLjc1MSA2LjAyNSA0MS40MSAyMi4xMzcgNTkuODkyIDQ4LjE4NSAxOC4zMzEgMjUuODIgMzIuNDU4IDU3Ljg4NiA0Mi44MyA5Ni4wMzRIMzI0LjkwNlY0MC4zMjF6bTAgMTgxLjAyNGgxMTAuNDE3YzUuMDI1IDI4LjEwNCA3LjM2NyA1Ni4yMTUgNy4zNjcgODQuMzE5IDAgMjYuMDk5LTIuMzQyIDUzLjg3NC02LjY5NiA4My42NTZIMzI0LjkwNlYyMjEuMzQ1em0wIDM1MC4zMzRWNDI2LjEyNmgxMDIuNzIyYy0xMC4wMzYgMzguNDgzLTI0LjI3NyA3MC44MDYtNDIuNDk1IDk3LjA0LTE4LjI2IDI2LjI5OC0zOC4xNDEgNDIuNDk1LTYwLjIyNyA0OC41MTN6bTgyLjk4NS0xNi43MjZjMjYuNDM0LTMzLjEzIDQ1Ljg0My03Ni4yOTYgNTguMjIxLTEyOC44MjdoNzkuOTczYy0yOC40NCA1Ny44ODYtNzcuOTY4IDEwMy43MjgtMTM4LjE5NCAxMjguODI3ek01NjEuODEgMzg5LjMyaC04OC4zMzhhNTUwLjc1NiA1NTAuNzU2IDAgMCAwIDYuMzYtODMuNjU2YzAtMjcuNzY4LTIuMDA2LTU1Ljg3OS02LjM2LTg0LjMxOWg4Ny42NjdjOS4wMzcgMjcuMTA0IDEzLjcyIDU1LjIwOCAxMy43MiA4NC4zMTktLjAwMSAyOC40NDctNC4zNDcgNTYuNTUxLTEzLjA0OSA4My42NTZ6IiBmaWxsPSIjRkZGIi8+PC9zdmc+\"},function(e,t,a){e.exports=a.p+\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiB2aWV3Qm94PSIwIDAgNjEyIDYxMiI+PHBhdGggZD0iTTU2MSA3Ni41SDE3OC41Yy0xNy44NSAwLTMwLjYgNy42NS00MC44IDIyLjk1TDAgMzA2bDEzNy43IDIwNi41NWMxMC4yIDEyLjc1IDIyLjk1IDIyLjk1IDQwLjggMjIuOTVINTYxYzI4LjA1IDAgNTEtMjIuOTUgNTEtNTF2LTM1N2MwLTI4LjA1LTIyLjk1LTUxLTUxLTUxem0tNzYuNSAzMjEuM2wtMzUuNyAzNS43LTkxLjgtOTEuOC05MS44IDkxLjgtMzUuNy0zNS43IDkxLjgtOTEuOC05MS44LTkxLjggMzUuNy0zNS43IDkxLjggOTEuOCA5MS44LTkxLjggMzUuNyAzNS43LTkxLjggOTEuOCA5MS44IDkxLjh6IiBmaWxsPSIjN2E5MjlmIi8+PC9zdmc+Cg==\"},function(e,t,a){e.exports=a.p+\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNC4xIDI0LjEiPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0yMy4xIDE3LjA1Yy42IDAgMS0uNCAxLTF2LTEzYzAtLjYtLjQtMS0xLTFoLTJjLS42IDAtMSAuNC0xIDF2OS41YzAgLjMtLjIuNS0uNS41SDguNWMtLjQgMC0uNy0uNS0uNC0uOWwxLTFjLjItLjIuMy0uNC4zLS43IDAtLjMtLjEtLjUtLjMtLjdsLTEuNC0xLjRjLS4yLS4yLS40LS4zLS43LS4zLS4zIDAtLjUuMS0uNy4zbC02IDZjLS4yLjItLjMuNS0uMy43cy4xLjUuMy43bDYgNmMuMi4yLjQuMy43LjMuMyAwIC41LS4xLjctLjNsMS40LTEuNGMuMi0uMi4zLS40LjMtLjdzLS4xLS41LS4zLS43bC0xLTFjLS4zLS4zLS4xLS45LjQtLjloMTQuNnoiLz48L3N2Zz4K\"},function(e,t,a){e.exports=a.p+\"data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjZmZmIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0ODQuNSIgaGVpZ2h0PSI0ODQuNSI+PHBhdGggZD0iTTI0Mi4yNSAzMDZjNDMuMzUgMCA3Ni41LTMzLjE1IDc2LjUtNzYuNXYtMTUzYzAtNDMuMzUtMzMuMTUtNzYuNS03Ni41LTc2LjVzLTc2LjUgMzMuMTUtNzYuNSA3Ni41djE1M2MwIDQzLjM1IDMzLjE1IDc2LjUgNzYuNSA3Ni41em0xMzUuMTUtNzYuNWMwIDc2LjUtNjMuNzUgMTMwLjA1LTEzNS4xNSAxMzAuMDVTMTA3LjEgMzA2IDEwNy4xIDIyOS41SDYzLjc1YzAgODYuNyA2OC44NSAxNTguMSAxNTMgMTcwLjg1djg0LjE1aDUxdi04NC4xNWM4NC4xNS0xMi43NSAxNTMtODQuMTQ5IDE1My0xNzAuODVIMzc3LjR6Ii8+PC9zdmc+Cg==\"},,function(e,t,a){e.exports=a(39)},,,,,,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){\"use strict\";a.r(t);var n,r=a(0),i=a.n(r),c=a(11),o=a.n(c),s=(a(23),a(2)),u=a(3),l=a(4),y=a(1),h=a(5);a(25);!function(e){e[e.DOWN=0]=\"DOWN\",e[e.DOWN_CONTINUOUSLY=1]=\"DOWN_CONTINUOUSLY\",e[e.UP=2]=\"UP\",e[e.NORMAL=3]=\"NORMAL\"}(n||(n={}));var p,d=function(e){function t(){var e,a;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),c=0;c<r;c++)i[c]=arguments[c];return(a=Object(l.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(i)))).state={keyState:n.NORMAL},a._clearTimers=function(){clearTimeout(a._keyUpTimeoutId),clearTimeout(a._keyDownTimeoutId),clearInterval(a._keyDownContinuouslyIntervalId)},a._handleMouseDown=function(){a._clearTimers(),a.setState({keyState:n.DOWN}),a.props.definition.onClick(),a._keyDownTimeoutId=setTimeout(function(){a.setState({keyState:n.DOWN_CONTINUOUSLY}),a._keyDownContinuouslyIntervalId=setInterval(a.props.definition.onClick,100)},1e3)},a._handleMouseUp=function(){a._clearTimers(),a.setState({keyState:n.UP}),a._keyUpTimeoutId=setTimeout(function(){return a.setState({keyState:n.NORMAL})},1e3)},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"componentWillUnmount\",value:function(){this._clearTimers()}},{key:\"render\",value:function(){var e=[\"key-component\"];switch(this.props.className&&e.push(this.props.className),this.state.keyState){case n.DOWN:case n.DOWN_CONTINUOUSLY:e.push(\"key-down\");break;case n.UP:e.push(\"key-up\")}return i.a.createElement(\"div\",{className:e.join(\" \"),onMouseDown:this._handleMouseDown,onMouseUp:this._handleMouseUp},this.props.children||this.props.definition.value)}}]),t}(r.Component),f=function e(t,a){var n=this;Object(s.a)(this,e),this.value=t,this._clickHandler=a,this.onClick=function(){n._clickHandler&&n._clickHandler(n)}};!function(e){e.SET_LANGUAGE=\"keyboard.setLanguage\",e.VOICE_RECOGNITION_DISABLED=\"keyboard.voiceRecognitionDisabled\",e.VOICE_RECOGNITION_ENABLED=\"keyboard.voiceRecognitionEnabled\",e.VOICE_RECOGNITION_FINISHED=\"keyboard.voiceRecognitionFinished\",e.VOICE_RECOGNITION_STARTED=\"keyboard.voiceRecognitionStarted\",e.INPUT_RECEIVED=\"keyboard.inputReceived\",e.KEYBOARD_INITIALIZED=\"keyboard.initialized\",e.VOICE_RECOGNITION_FINISH_REQUESTED=\"keyboard.voiceRecognitionFinishRequested\",e.VOICE_RECOGNITION_START_REQUESTED=\"keyboard.voiceRecognitionStartRequested\"}(p||(p={}));var g=p;function m(e){window.vuplex&&window.vuplex.postMessage({type:g.INPUT_RECEIVED,value:e.value})}a(27);var v,O=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(l.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r))))._spacebarKeyDefinition=new f(\" \",m),a._renderKey=function(e){return i.a.createElement(d,{className:\"key\",definition:e,key:e.value})},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"render\",value:function(){return i.a.createElement(\"div\",{className:\"center-board\"},i.a.createElement(\"div\",{className:\"key-area\"},i.a.createElement(\"div\",{className:\"key-row\"},this.props.rows[0].map(this._renderKey)),i.a.createElement(\"div\",{className:\"key-row\"},i.a.createElement(\"div\",{className:\"key-offset-margin\"}),this.props.rows[1].map(this._renderKey),i.a.createElement(\"div\",{className:\"key-offset-margin\"})),i.a.createElement(\"div\",{className:\"key-row\"},this.props.rows[2].map(this._renderKey)),i.a.createElement(\"div\",{className:\"key-row\"},this.props.rows[3].slice(0,2).map(this._renderKey),i.a.createElement(\"div\",{className:\"spacebar-container\"},i.a.createElement(d,{className:\"spacebar\",definition:this._spacebarKeyDefinition},this.props.spacebarText)),this.props.rows[3].slice(2).map(this._renderKey))))}}]),t}(r.Component),k=a(7),b=a(9),_=a.n(b),E=a(6),C=a(16),w=a(8);!function(e){e[e.LOWERCASE=0]=\"LOWERCASE\",e[e.UPPERCASE=1]=\"UPPERCASE\",e[e.CAPS_LOCK=2]=\"CAPS_LOCK\",e[e.SPECIAL=3]=\"SPECIAL\"}(v||(v={}));var S=v,j=(a(29),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"render\",value:function(){var e=[S.UPPERCASE,S.CAPS_LOCK].includes(this.props.keyboardLayout);return i.a.createElement(\"div\",{className:\"shift-key-icon\"},i.a.createElement(\"div\",{className:\"shift-arrow-triangle \".concat(e?\"shift-arrow-colored\":\"\")}),this._renderArrowLine(e))}},{key:\"_renderArrowLine\",value:function(e){return this.props.keyboardLayout===S.CAPS_LOCK?i.a.createElement(\"div\",{className:\"caps-lock-arrow-line\"},i.a.createElement(\"div\",{className:\"caps-lock-line-top\"}),i.a.createElement(\"div\",{className:\"caps-lock-line-middle\"}),i.a.createElement(\"div\",{className:\"caps-lock-line-bottom\"})):i.a.createElement(\"div\",{className:\"regular-arrow-line \".concat(e?\"shift-arrow-colored\":\"\")})}}]),t}(r.Component)),N=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(l.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r))))._layout=S.LOWERCASE,a._createSimpleKeyDefinition=function(e){return new f(e,a._handleSimpleKeyPress)},a._handleShiftKeyPressed=function(){switch(a._layout){case S.LOWERCASE:a._setLayout(S.UPPERCASE);break;case S.UPPERCASE:a._setLayout(S.CAPS_LOCK);break;default:a._setLayout(S.LOWERCASE)}},a._handleSimpleKeyPress=function(e){a._layout===S.UPPERCASE&&a._setLayout(S.LOWERCASE),m(e)},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getAlphabeticCharacterSetKeySymbol\",value:function(){return\"ABC\"}},{key:\"getCurrencyCharacters\",value:function(){return[\"$\",\"\\u20ac\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){return[[\"q\",\"w\",\"e\",\"r\",\"t\",\"y\",\"u\",\"i\",\"o\",\"p\"],[\"a\",\"s\",\"d\",\"f\",\"g\",\"h\",\"j\",\"k\",\"l\"],[\"z\",\"x\",\"c\",\"v\",\"b\",\"n\",\"m\",\"!\",\"?\"]]}},{key:\"getSpecialCharactersByRow\",value:function(){return[[\"@\",\"#\"].concat(Object(w.a)(this.getCurrencyCharacters()),[\"%\",\"&\",\"*\",\"-\",\"+\"]),[\"~\",\"`\",'\"',\"'\",\":\",\";\",\"_\",\"=\",\"\\\\\",\"/\"],[\"{\",\"}\",\"[\",\"]\",\"<\",\">\",\"^\",\"|\",\"(\",\")\"],[\"@\",\",\",\".\"]]}},{key:\"getRows\",value:function(){return this._layout===S.SPECIAL?this._getSpecialCharacterRows():this._getAlphabeticCharactersRows()}},{key:\"getUpperCaseCharactersByRow\",value:function(){return this.getLowerCaseCharactersByRow().map(function(e){return e.map(function(e){return e.toUpperCase()})})}},{key:\"_getAlphabeticCharactersRows\",value:function(){var e=[S.UPPERCASE,S.CAPS_LOCK].includes(this._layout)?this.getUpperCaseCharactersByRow():this.getLowerCaseCharactersByRow();return[e[0].map(this._createSimpleKeyDefinition),e[1].map(this._createSimpleKeyDefinition),[this._getShiftKey()].concat(Object(w.a)(e[2].map(this._createSimpleKeyDefinition))),[this._getSpecialCharacterSetKey()].concat(Object(w.a)([\"@\",\",\",\".\"].map(this._createSimpleKeyDefinition)))]}},{key:\"_getAlphabeticCharacterSetKey\",value:function(){var e=this,t=this.getAlphabeticCharacterSetKeySymbol();return new f(t,function(){return e._setLayout(S.LOWERCASE)})}},{key:\"_getShiftKey\",value:function(){return new f(i.a.createElement(j,{keyboardLayout:this._layout}),this._handleShiftKeyPressed)}},{key:\"_getSpecialCharacterRows\",value:function(){var e=this.getSpecialCharactersByRow(),t=Object(C.a)(e,4),a=t[0],n=t[1],r=t[2],i=t[3];return[a.map(this._createSimpleKeyDefinition),n.map(this._createSimpleKeyDefinition),r.map(this._createSimpleKeyDefinition),[this._getAlphabeticCharacterSetKey()].concat(Object(w.a)(i.map(this._createSimpleKeyDefinition)))]}},{key:\"_getSpecialCharacterSetKey\",value:function(){var e=this;return new f(\"#+=\",function(){return e._setLayout(S.SPECIAL)})}},{key:\"_setLayout\",value:function(e){this._layout=e,this.emit(\"layoutChanged\",this)}},{key:\"layout\",get:function(){return this._layout}}]),t}(_.a),R=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\xa3\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){var e=Object(E.a)(Object(y.a)(t.prototype),\"getLowerCaseCharactersByRow\",this).call(this);return e[0].push(\"\\xe5\"),e[1].push(\"\\xe6\",\"\\xf8\"),e}},{key:\"language\",get:function(){return\"Dansk\"}},{key:\"languageCode\",get:function(){return\"da\"}}]),t}(N),I=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"$\",\"\\u20ac\",\"\\xa3\",\"\\u20b9\"]}},{key:\"language\",get:function(){return\"English\"}},{key:\"languageCode\",get:function(){return\"en\"}}]),t}(N),L=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\u20ac\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){return[[\"a\",\"z\",\"e\",\"r\",\"t\",\"y\",\"u\",\"i\",\"o\",\"p\"],[\"q\",\"s\",\"d\",\"f\",\"g\",\"h\",\"j\",\"k\",\"l\",\"m\"],[\"z\",\"x\",\"c\",\"v\",\"b\",\"n\",\"'\",\"/\"]]}},{key:\"language\",get:function(){return\"Fran\\xe7ais\"}},{key:\"languageCode\",get:function(){return\"fr\"}}]),t}(N),A=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\u20ac\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){return[[\"q\",\"w\",\"e\",\"r\",\"t\",\"z\",\"u\",\"i\",\"o\",\"p\"],[\"a\",\"s\",\"d\",\"f\",\"g\",\"h\",\"j\",\"k\",\"l\"],[\"y\",\"x\",\"c\",\"v\",\"b\",\"n\",\"m\",\"!\",\"?\"]]}},{key:\"language\",get:function(){return\"Deutsche\"}},{key:\"languageCode\",get:function(){return\"de\"}}]),t}(N),D=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\xa3\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){var e=Object(E.a)(Object(y.a)(t.prototype),\"getLowerCaseCharactersByRow\",this).call(this);return e[0].push(\"\\xe5\"),e[1].push(\"\\xf8\",\"\\xe6\"),e}},{key:\"language\",get:function(){return\"Norsk\"}},{key:\"languageCode\",get:function(){return\"no\"}}]),t}(N),K=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\u20bd\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){return[[\"\\u0439\",\"\\u0446\",\"\\u0443\",\"\\u043a\",\"\\u0435\",\"\\u043d\",\"\\u0433\",\"\\u0448\",\"\\u0449\",\"\\u0437\",\"\\u0445\",\"\\u044a\"],[\"\\u0444\",\"\\u044b\",\"\\u0432\",\"\\u0430\",\"\\u043f\",\"\\u0440\",\"\\u043e\",\"\\u043b\",\"\\u0434\",\"\\u0436\",\"\\u044d\"],[\"\\u044f\",\"\\u0447\",\"\\u0441\",\"\\u043c\",\"\\u0438\",\"\\u0442\",\"\\u044c\",\"\\u0431\",\"\\u044e\",\"!\",\"?\"]]}},{key:\"getAlphabeticCharacterSetKeySymbol\",value:function(){return\"\\u0410\\u0411\\u0412\"}},{key:\"language\",get:function(){return\"\\u0440\\u0443\\u0441\\u0441\\u043a\\u0438\\u0439\"}},{key:\"languageCode\",get:function(){return\"ru\"}}]),t}(N),T=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"$\",\"\\u20ac\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){var e=Object(E.a)(Object(y.a)(t.prototype),\"getLowerCaseCharactersByRow\",this).call(this);return e[1].push(\"\\xf1\"),e}},{key:\"getSpecialCharactersByRow\",value:function(){var e=Object(E.a)(Object(y.a)(t.prototype),\"getSpecialCharactersByRow\",this).call(this);return e[3].splice(1,2,\"\\xba\",\"\\xaa\"),e}},{key:\"language\",get:function(){return\"Espa\\xf1ol\"}},{key:\"languageCode\",get:function(){return\"es\"}}]),t}(N),U=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\xa3\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){var e=Object(E.a)(Object(y.a)(t.prototype),\"getLowerCaseCharactersByRow\",this).call(this);return e[0].push(\"\\xe5\"),e[1].push(\"\\xf6\",\"\\xe4\"),e}},{key:\"language\",get:function(){return\"Svenska\"}},{key:\"languageCode\",get:function(){return\"sv\"}}]),t}(N),P=a(12),B=a.n(P),x=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(l.a)(this,Object(y.a)(t).call(this)))._keySetIndex=0,e._keySets=[new I,new T,new L,new A,new K,new R,new D,new U],e._handleLayoutChanged=function(){e.emit(\"layoutChanged\",Object(k.a)(Object(k.a)(e)))},e._handleSwitchLanguageKeyClick=function(){e._keySetIndex=e._keySetIndex>=e._keySets.length-1?0:e._keySetIndex+1,e.emit(\"layoutChanged\",Object(k.a)(Object(k.a)(e)))},e._keySets.forEach(function(t){return t.on(\"layoutChanged\",e._handleLayoutChanged)}),e}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getRows\",value:function(){var e=this._getKeySet().getRows();return e[3][1]=new f(this._getSwitchLanguageIcon(),this._handleSwitchLanguageKeyClick),e}},{key:\"setLanguage\",value:function(e){this._keySetIndex=this._keySets.findIndex(function(t){return t.languageCode===e}),-1===this._keySetIndex&&(this._keySetIndex=this._keySets.findIndex(function(e){return\"en\"===e.languageCode})),this.emit(\"layoutChanged\",this)}},{key:\"_getKeySet\",value:function(){return this._keySets[this._keySetIndex]}},{key:\"_getSwitchLanguageIcon\",value:function(){return i.a.createElement(\"img\",{style:{width:\"1.2em\",height:\"1.2em\"},src:B.a,alt:\"globe\"})}},{key:\"language\",get:function(){return this._getKeySet().language}},{key:\"layout\",get:function(){return this._getKeySet().layout}}]),t}(_.a),M=a(13),V=a.n(M),G=a(14),W=a.n(G),F=(a(31),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(l.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r))))._keyRows=[[new f(\"1\",m),new f(\"2\",m),new f(\"3\",m)],[new f(\"4\",m),new f(\"5\",m),new f(\"6\",m)],[new f(\"7\",m),new f(\"8\",m),new f(\"9\",m)],[new f(\".\",m),new f(\"0\",m),new f(\"-\",m)]],a._renderKeyRow=function(e,t){return i.a.createElement(\"div\",{className:\"key-row\",key:t},e.map(function(e){return i.a.createElement(d,{className:\"key\",definition:e,key:e.value})}))},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"render\",value:function(){return i.a.createElement(\"div\",{className:\"num-pad\"},i.a.createElement(\"div\",{className:\"key-area\"},this._keyRows.map(this._renderKeyRow)))}}]),t}(r.Component)),H=(a(33),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(l.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r))))._upKeyDefinition=new f(\"ArrowUp\",m),a._leftKeyDefinition=new f(\"ArrowLeft\",m),a._rightKeyDefinition=new f(\"ArrowRight\",m),a._downKeyDefinition=new f(\"ArrowDown\",m),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"render\",value:function(){return i.a.createElement(\"div\",{className:\"right-pad\"},i.a.createElement(\"div\",{className:\"key-area\"},i.a.createElement(\"div\",{className:\"right-key-area\"},i.a.createElement(\"div\",{className:\"arrow-pad\"},i.a.createElement(\"div\",{className:\"arrow-pad-row\"},i.a.createElement(d,{definition:this._upKeyDefinition},\"\\u25b2\")),i.a.createElement(\"div\",{className:\"arrow-pad-row arrow-pad-middle\"},i.a.createElement(d,{definition:this._leftKeyDefinition},i.a.createElement(\"span\",{style:{transform:\"rotate(-90deg)\"}},\"\\u25b2\")),i.a.createElement(d,{definition:this._rightKeyDefinition},i.a.createElement(\"span\",{style:{transform:\"rotate(90deg)\"}},\"\\u25b2\"))),i.a.createElement(\"div\",{className:\"arrow-pad-row\"},i.a.createElement(d,{definition:this._downKeyDefinition},i.a.createElement(\"span\",{style:{transform:\"rotate(180deg)\"}},\"\\u25b2\")))))))}}]),t}(r.Component)),Y=a(15),q=a.n(Y),z=(a(35),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"render\",value:function(){return i.a.createElement(\"div\",{className:\"voice-button \".concat(this.props.active?\"voice-button-active\":\"\"),onMouseDown:this.props.onMouseDown},i.a.createElement(\"div\",{className:\"voice-button-icon\"},i.a.createElement(\"div\",null,i.a.createElement(\"img\",{src:q.a,alt:\"voice control\"}))))}}]),t}(r.Component)),Q=(a(37),function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(y.a)(t).call(this,e)))._keySet=new x,a.state={language:a._keySet.language,layout:a._keySet.layout,voiceRecognitionEnabled:!1,voiceRecognitionActive:!1},a._backspaceKeyDefinition=new f(\"Backspace\",m),a._returnKeyDefinition=new f(\"Enter\",m),a._handleReceivedMessage=function(e){var t=JSON.parse(e.data);switch(t.type){case g.SET_LANGUAGE:a._keySet.setLanguage(t.value);break;case g.VOICE_RECOGNITION_DISABLED:a.setState({voiceRecognitionEnabled:!1});break;case g.VOICE_RECOGNITION_ENABLED:a.setState({voiceRecognitionEnabled:!0});break;case g.VOICE_RECOGNITION_FINISHED:a.setState({voiceRecognitionActive:!1});break;case g.VOICE_RECOGNITION_STARTED:a.setState({voiceRecognitionActive:!0})}},a._handleLayoutChange=function(e){return a.setState({language:e.language,layout:e.layout})},a._handleVoiceButtonMouseDown=function(e){e.preventDefault();var t=!a.state.voiceRecognitionActive;a.setState({voiceRecognitionActive:t}),window.vuplex.postMessage({type:t?g.VOICE_RECOGNITION_START_REQUESTED:g.VOICE_RECOGNITION_FINISH_REQUESTED})},a._initMessages=function(){window.vuplex.addEventListener(\"message\",a._handleReceivedMessage),window.vuplex.postMessage({type:g.KEYBOARD_INITIALIZED})},a._keySet.on(\"layoutChanged\",a._handleLayoutChange),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"componentDidMount\",value:function(){window.vuplex?this._initMessages():window.addEventListener(\"vuplexready\",this._initMessages)}},{key:\"render\",value:function(){return i.a.createElement(\"div\",{className:\"keyboard\"},i.a.createElement(\"div\",{className:\"num-pad-container\"},i.a.createElement(F,null)),i.a.createElement(\"div\",{className:\"board-margin\"}),i.a.createElement(\"div\",{className:\"center-board-container\"},i.a.createElement(O,{rows:this._keySet.getRows(),spacebarText:this._keySet.language})),i.a.createElement(\"div\",{className:\"enter-key-area\"},i.a.createElement(d,{className:\"backspace-icon\",definition:this._backspaceKeyDefinition},i.a.createElement(\"img\",{src:V.a,alt:\"backspace\"})),i.a.createElement(\"div\",{className:\"return-key-container\"},i.a.createElement(d,{definition:this._returnKeyDefinition,className:\"return-key-component\"},i.a.createElement(\"div\",{className:\"return-key\"},i.a.createElement(\"div\",{className:\"return-key-text\"},i.a.createElement(\"img\",{src:W.a,alt:\"return\"}))))),this._renderVoiceButton()),i.a.createElement(\"div\",{className:\"right-pad-container\"},i.a.createElement(H,null)))}},{key:\"_renderVoiceButton\",value:function(){if(this.state.voiceRecognitionEnabled)return i.a.createElement(\"div\",{className:\"voice-button-container\"},i.a.createElement(z,{onMouseDown:this._handleVoiceButtonMouseDown,active:this.state.voiceRecognitionActive}))}}]),t}(r.Component));o.a.render(i.a.createElement(Q,null),document.getElementById(\"root\"))}],[[17,2,1]]]);//# sourceMappingURL=main.d5c58ea6.chunk.js.map</script></body></html>");
			};
		}

		private void WebView_MessageEmitted(object sender, EventArgs<string> e)
		{
			string value = e.Value;
			string type = UnityEngine.JsonUtility.FromJson<BridgeMessage>(value).type;
			if (!(type == "keyboard.inputReceived"))
			{
				if (type == "keyboard.initialized")
				{
					_sendKeyboardLanguageMessage();
					if (this.Initialized != null)
					{
						this.Initialized(this, EventArgs.Empty);
					}
				}
			}
			else
			{
				string val = StringBridgeMessage.ParseValue(value);
				if (this.InputReceived != null)
				{
					this.InputReceived(this, new EventArgs<string>(val));
				}
			}
		}

		private string _getKeyboardLanguage()
		{
			return UnityEngine.Application.systemLanguage switch
			{
				SystemLanguage.Danish => "da", 
				SystemLanguage.French => "fr", 
				SystemLanguage.German => "de", 
				SystemLanguage.Norwegian => "no", 
				SystemLanguage.Russian => "ru", 
				SystemLanguage.Spanish => "es", 
				SystemLanguage.Swedish => "sv", 
				_ => "en", 
			};
		}

		private void _sendKeyboardLanguageMessage()
		{
			string data = UnityEngine.JsonUtility.ToJson(new StringBridgeMessage
			{
				type = "keyboard.setLanguage",
				value = _getKeyboardLanguage()
			});
			WebViewPrefab.WebView.PostMessage(data);
		}
	}
	internal class KeyboardUi
	{
		public const string Html = "<!DOCTYPE html><html lang=\"en\"><head><meta charset=\"utf-8\"><meta name=\"transparent\" content=\"true\"><meta name=\"viewport\" content=\"viewport-fit=cover,width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0\"><meta name=\"theme-color\" content=\"#000000\"><link rel=\"manifest\" href=\"./manifest.json\"><link rel=\"shortcut icon\" href=\"./favicon.ico\"><title>Unity Keyboard</title><style>html{width:100vw;height:100vh}body{margin:0;padding:0;font-family:Helvetica,Ariel,sans-serif;font-size:20px}#root,body{width:100%;height:100%}.key-component{display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center;border-radius:.5rem}.key-component>img,.key-component div,.key-component span{pointer-events:none}.key-component.hover,.key-component:hover{background-color:#485a63}.key-component.key-down{background-color:#a2b3bc}.key-component.key-up{-webkit-animation:highlight 1s;animation:highlight 1s}@-webkit-keyframes highlight{0%{background-color:#a2b3bc}to{background-color:auto}}@keyframes highlight{0%{background-color:#a2b3bc}to{background-color:auto}}.center-board{background-color:#283237;color:#fff;height:100%;width:100%;border-radius:.6rem;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.center-board .key-area{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;width:95%;height:90%}.center-board .key-area .key-row{display:-webkit-flex;display:flex;-webkit-justify-content:space-around;justify-content:space-around;-webkit-flex:1 1 auto;flex:1 1 auto}.center-board .key-area .key-row .key{-webkit-flex:2 0 auto;flex:2 0 auto}.center-board .key-area .key-row .key-offset-margin{-webkit-flex:1 0 auto;flex:1 0 auto}.center-board .key-area .key-row .spacebar-container{-webkit-flex:12 0 auto;flex:12 0 auto;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.center-board .key-area .key-row .spacebar-container .spacebar{width:98%;height:80%;background-color:#3d4d55;border-radius:.6rem;color:#a6a6a6}.center-board .key-area .key-row .spacebar-container .spacebar.hover,.center-board .key-area .key-row .spacebar-container .spacebar:hover{background-color:#485a63}.center-board .key-area .key-row .spacebar-container .spacebar:active{background-color:#688390}.shift-key-icon{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;justify-conten:center;-webkit-align-items:center;align-items:center}.shift-key-icon .shift-arrow-triangle{width:0;height:0;border-left:.45em solid transparent;border-bottom:.45em solid #fff;border-right:.45em solid transparent}.shift-key-icon .shift-arrow-triangle.shift-arrow-colored{border-bottom-color:#4fbea0}.shift-key-icon .regular-arrow-line{height:.6em;width:.35em;background-color:#fff}.shift-key-icon .regular-arrow-line.shift-arrow-colored{background-color:#4fbea0}.shift-key-icon .caps-lock-arrow-line .caps-lock-line-top{height:.3em;width:.35em;background-color:#4fbea0}.shift-key-icon .caps-lock-arrow-line .caps-lock-line-middle{height:.2em}.shift-key-icon .caps-lock-arrow-line .caps-lock-line-bottom{height:.1em;width:.35em;background-color:#4fbea0}.num-pad{width:100%;height:100%;border-radius:.6rem;background-color:#283237;color:#fff;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.num-pad,.num-pad .key-area{display:-webkit-flex;display:flex}.num-pad .key-area{-webkit-flex-direction:column;flex-direction:column;width:85%;height:90%}.num-pad .key-area .key-row{display:-webkit-flex;display:flex;-webkit-justify-content:space-around;justify-content:space-around;-webkit-flex:1 1 auto;flex:1 1 auto}.num-pad .key-area .key-row .key{-webkit-flex:1 0 auto;flex:1 0 auto}.right-pad{width:100%;height:100%;background-color:#283237;border-radius:.6rem;color:#fff;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.right-pad,.right-pad .key-area{display:-webkit-flex;display:flex}.right-pad .key-area{width:90%;height:75%;-webkit-justify-content:space-between;justify-content:space-between}.right-pad .right-key-area{-webkit-flex:0 0 100%;flex:0 0 100%;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;-webkit-justify-content:center;justify-content:center}.right-pad .right-key-area .arrow-pad{width:90%;height:3.75em;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;font-size:1.25em}.right-pad .right-key-area .arrow-pad .arrow-pad-row{-webkit-flex:1 1 auto;flex:1 1 auto;width:100%;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.right-pad .right-key-area .arrow-pad .arrow-pad-row.arrow-pad-middle{-webkit-justify-content:space-between;justify-content:space-between}.voice-button{width:100%;padding-top:100%;position:relative;border-radius:50%;background-color:#a6a6a6}.voice-button .voice-button-icon{position:absolute;top:0;right:0;bottom:0;left:0;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center;pointer-events:none}.voice-button .voice-button-icon>div{width:50%;height:50%}.voice-button .voice-button-icon>div img{width:100%;height:100%}.voice-button svg{position:absolute;top:-224px;left:-224px;-webkit-transform:scale(.05);transform:scale(.05);fill:rgba(0,0,0,.5);pointer-events:none}.voice-button.hover,.voice-button:hover{background-color:#62c5aa}.voice-button.hover svg,.voice-button:hover svg{fill:#283237}@-webkit-keyframes recordingBackground{0%{background:#f30}50%{background:#ff8000}to{background:#f30}}@keyframes recordingBackground{0%{background:#f30}50%{background:#ff8000}to{background:#f30}}.voice-button.voice-button-active{-webkit-animation:recordingBackground 5s infinite;animation:recordingBackground 5s infinite}.voice-button.voice-button-active svg{fill:#fff}.keyboard{width:100%;height:100%;display:-webkit-flex;display:flex;-webkit-justify-content:space-between;justify-content:space-between}.keyboard .num-pad-container{-webkit-flex:1 1 15%;flex:1 1 15%}.keyboard .center-board-container{-webkit-flex:1 1 55%;flex:1 1 55%}.keyboard .right-pad-container{-webkit-flex:1 1 15%;flex:1 1 15%}.keyboard .board-margin{-webkit-flex:1 1 2.5%;flex:1 1 2.5%}.keyboard .enter-key-area{height:100%;-webkit-flex:1 1 10%;flex:1 1 10%;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.keyboard .enter-key-area .backspace-icon{width:60%;border-radius:.5rem}.keyboard .enter-key-area .backspace-icon:hover{background-color:#dde4e7}.keyboard .enter-key-area .backspace-icon img{width:100%}.keyboard .enter-key-area .return-key-container{width:60%;padding-top:10px}.keyboard .enter-key-area .return-key-container .return-key-component{border-radius:50%;background-color:#09f}.keyboard .enter-key-area .return-key-container .return-key-component.hover,.keyboard .enter-key-area .return-key-container .return-key-component:hover{background-color:#008ae6}.keyboard .enter-key-area .return-key-container .return-key{width:100%;padding-top:100%;position:relative;border-radius:50%;pointer-events:none}.keyboard .enter-key-area .voice-button-container{width:60%;padding-top:15px}.keyboard .enter-key-area .return-key-text{position:absolute;top:0;left:0;bottom:0;right:0;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center;font-size:45px;font-weight:700}.keyboard .enter-key-area .return-key-text img{width:60%}/*# sourceMappingURL=main.047c931b.chunk.css.map */</style></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id=\"root\"></div><script>!function(l){function e(e){for(var r,t,n=e[0],o=e[1],u=e[2],f=0,i=[];f<n.length;f++)t=n[f],p[t]&&i.push(p[t][0]),p[t]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(l[r]=o[r]);for(s&&s(e);i.length;)i.shift()();return c.push.apply(c,u||[]),a()}function a(){for(var e,r=0;r<c.length;r++){for(var t=c[r],n=!0,o=1;o<t.length;o++){var u=t[o];0!==p[u]&&(n=!1)}n&&(c.splice(r--,1),e=f(f.s=t[0]))}return e}var t={},p={2:0},c=[];function f(e){if(t[e])return t[e].exports;var r=t[e]={i:e,l:!1,exports:{}};return l[e].call(r.exports,r,r.exports,f),r.l=!0,r.exports}f.m=l,f.c=t,f.d=function(e,r,t){f.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},f.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},f.t=function(r,e){if(1&e&&(r=f(r)),8&e)return r;if(4&e&&\"object\"==typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(f.r(t),Object.defineProperty(t,\"default\",{enumerable:!0,value:r}),2&e&&\"string\"!=typeof r)for(var n in r)f.d(t,n,function(e){return r[e]}.bind(null,n));return t},f.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(r,\"a\",r),r},f.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},f.p=\"\";var r=window.webpackJsonp=window.webpackJsonp||[],n=r.push.bind(r);r.push=e,r=r.slice();for(var o=0;o<r.length;o++)e(r[o]);var s=n;a()}([])</script><script>(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[function(e,t,n){\"use strict\";e.exports=n(18)},function(e,t,n){\"use strict\";function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,\"a\",function(){return r})},function(e,t,n){\"use strict\";function r(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}n.d(t,\"a\",function(){return r})},function(e,t,n){\"use strict\";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,\"a\",function(){return i})},function(e,t,n){\"use strict\";function r(e){return(r=\"function\"===typeof Symbol&&\"symbol\"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function i(e){return(i=\"function\"===typeof Symbol&&\"symbol\"===r(Symbol.iterator)?function(e){return r(e)}:function(e){return e&&\"function\"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":r(e)})(e)}var l=n(7);function o(e,t){return!t||\"object\"!==i(t)&&\"function\"!==typeof t?Object(l.a)(e):t}n.d(t,\"a\",function(){return o})},function(e,t,n){\"use strict\";function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e,t){if(\"function\"!==typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}n.d(t,\"a\",function(){return i})},function(e,t,n){\"use strict\";var r=n(1);function i(e,t,n){return(i=\"undefined\"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Object(r.a)(e)););return e}(e,t);if(i){var l=Object.getOwnPropertyDescriptor(i,t);return l.get?l.get.call(n):l.value}})(e,t,n||e)}n.d(t,\"a\",function(){return i})},function(e,t,n){\"use strict\";function r(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}n.d(t,\"a\",function(){return r})},function(e,t,n){\"use strict\";function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}()}n.d(t,\"a\",function(){return r})},function(e,t,n){\"use strict\";var r,i=\"object\"===typeof Reflect?Reflect:null,l=i&&\"function\"===typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&\"function\"===typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!==e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var u=10;function c(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function s(e,t,n,r){var i,l,o,a;if(\"function\"!==typeof n)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof n);if(void 0===(l=e._events)?(l=e._events=Object.create(null),e._eventsCount=0):(void 0!==l.newListener&&(e.emit(\"newListener\",t,n.listener?n.listener:n),l=e._events),o=l[t]),void 0===o)o=l[t]=n,++e._eventsCount;else if(\"function\"===typeof o?o=l[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=c(e))>0&&o.length>i&&!o.warned){o.warned=!0;var u=new Error(\"Possible EventEmitter memory leak detected. \"+o.length+\" \"+String(t)+\" listeners added. Use emitter.setMaxListeners() to increase limit\");u.name=\"MaxListenersExceededWarning\",u.emitter=e,u.type=t,u.count=o.length,a=u,console&&console.warn&&console.warn(a)}return e}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,l(this.listener,this.target,e))}.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:\"function\"===typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):m(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if(\"function\"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(a,\"defaultMaxListeners\",{enumerable:!0,get:function(){return u},set:function(e){if(\"number\"!==typeof e||e<0||o(e))throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received '+e+\".\");u=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if(\"number\"!==typeof e||e<0||o(e))throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received '+e+\".\");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r=\"error\"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error(\"Unhandled error.\"+(o?\" (\"+o.message+\")\":\"\"));throw a.context=o,a}var u=i[e];if(void 0===u)return!1;if(\"function\"===typeof u)l(u,this,t);else{var c=u.length,s=m(u,c);for(n=0;n<c;++n)l(s[n],this,t)}return!0},a.prototype.addListener=function(e,t){return s(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return s(this,e,t,!0)},a.prototype.once=function(e,t){if(\"function\"!==typeof t)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof t);return this.on(e,f(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if(\"function\"!==typeof t)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,f(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,l,o;if(\"function\"!==typeof t)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit(\"removeListener\",e,n.listener||t));else if(\"function\"!==typeof n){for(i=-1,l=n.length-1;l>=0;l--)if(n[l]===t||n[l].listener===t){o=n[l].listener,i=l;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit(\"removeListener\",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,l=Object.keys(n);for(r=0;r<l.length;++r)\"removeListener\"!==(i=l[r])&&this.removeAllListeners(i);return this.removeAllListeners(\"removeListener\"),this._events=Object.create(null),this._eventsCount=0,this}if(\"function\"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return d(this,e,!0)},a.prototype.rawListeners=function(e){return d(this,e,!1)},a.listenerCount=function(e,t){return\"function\"===typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){\"use strict\";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String(\"abc\");if(e[5]=\"de\",\"5\"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t[\"_\"+String.fromCharCode(n)]=n;if(\"0123456789\"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(\"\"))return!1;var r={};return\"abcdefghijklmnopqrst\".split(\"\").forEach(function(e){r[e]=e}),\"abcdefghijklmnopqrst\"===Object.keys(Object.assign({},r)).join(\"\")}catch(i){return!1}}()?Object.assign:function(e,t){for(var n,o,a=function(e){if(null===e||void 0===e)throw new TypeError(\"Object.assign cannot be called with null or undefined\");return Object(e)}(e),u=1;u<arguments.length;u++){for(var c in n=Object(arguments[u]))i.call(n,c)&&(a[c]=n[c]);if(r){o=r(n);for(var s=0;s<o.length;s++)l.call(n,o[s])&&(a[o[s]]=n[o[s]])}}return a}},function(e,t,n){\"use strict\";!function e(){if(\"undefined\"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&\"function\"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(19)},,,,,function(e,t,n){\"use strict\";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,l=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(u){i=!0,l=u}finally{try{r||null==a.return||a.return()}finally{if(i)throw l}}return n}(e,t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}()}n.d(t,\"a\",function(){return r})},,function(e,t,n){\"use strict\";var r=n(10),i=\"function\"===typeof Symbol&&Symbol.for,l=i?Symbol.for(\"react.element\"):60103,o=i?Symbol.for(\"react.portal\"):60106,a=i?Symbol.for(\"react.fragment\"):60107,u=i?Symbol.for(\"react.strict_mode\"):60108,c=i?Symbol.for(\"react.profiler\"):60114,s=i?Symbol.for(\"react.provider\"):60109,f=i?Symbol.for(\"react.context\"):60110,d=i?Symbol.for(\"react.concurrent_mode\"):60111,p=i?Symbol.for(\"react.forward_ref\"):60112,m=i?Symbol.for(\"react.suspense\"):60113,h=i?Symbol.for(\"react.memo\"):60115,v=i?Symbol.for(\"react.lazy\"):60116,y=\"function\"===typeof Symbol&&Symbol.iterator;function g(e){for(var t=arguments.length-1,n=\"https://reactjs.org/docs/error-decoder.html?invariant=\"+e,r=0;r<t;r++)n+=\"&args[]=\"+encodeURIComponent(arguments[r+1]);!function(e,t,n,r,i,l,o,a){if(!e){if(e=void 0,void 0===t)e=Error(\"Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.\");else{var u=[n,r,i,l,o,a],c=0;(e=Error(t.replace(/%s/g,function(){return u[c++]}))).name=\"Invariant Violation\"}throw e.framesToPop=1,e}}(!1,\"Minified React error #\"+e+\"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. \",n)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w={};function k(e,t,n){this.props=e,this.context=t,this.refs=w,this.updater=n||b}function x(){}function T(e,t,n){this.props=e,this.context=t,this.refs=w,this.updater=n||b}k.prototype.isReactComponent={},k.prototype.setState=function(e,t){\"object\"!==typeof e&&\"function\"!==typeof e&&null!=e&&g(\"85\"),this.updater.enqueueSetState(this,e,t,\"setState\")},k.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,\"forceUpdate\")},x.prototype=k.prototype;var _=T.prototype=new x;_.constructor=T,r(_,k.prototype),_.isPureReactComponent=!0;var S={current:null},E={current:null},C=Object.prototype.hasOwnProperty,P={key:!0,ref:!0,__self:!0,__source:!0};function N(e,t,n){var r=void 0,i={},o=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=\"\"+t.key),t)C.call(t,r)&&!P.hasOwnProperty(r)&&(i[r]=t[r]);var u=arguments.length-2;if(1===u)i.children=n;else if(1<u){for(var c=Array(u),s=0;s<u;s++)c[s]=arguments[s+2];i.children=c}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===i[r]&&(i[r]=u[r]);return{$$typeof:l,type:e,key:o,ref:a,props:i,_owner:E.current}}function O(e){return\"object\"===typeof e&&null!==e&&e.$$typeof===l}var R=/\\/+/g,L=[];function M(e,t,n,r){if(L.length){var i=L.pop();return i.result=e,i.keyPrefix=t,i.func=n,i.context=r,i.count=0,i}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function z(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>L.length&&L.push(e)}function I(e,t,n){return null==e?0:function e(t,n,r,i){var a=typeof t;\"undefined\"!==a&&\"boolean\"!==a||(t=null);var u=!1;if(null===t)u=!0;else switch(a){case\"string\":case\"number\":u=!0;break;case\"object\":switch(t.$$typeof){case l:case o:u=!0}}if(u)return r(i,t,\"\"===n?\".\"+U(t,0):n),1;if(u=0,n=\"\"===n?\".\":n+\":\",Array.isArray(t))for(var c=0;c<t.length;c++){var s=n+U(a=t[c],c);u+=e(a,s,r,i)}else if(s=null===t||\"object\"!==typeof t?null:\"function\"===typeof(s=y&&t[y]||t[\"@@iterator\"])?s:null,\"function\"===typeof s)for(t=s.call(t),c=0;!(a=t.next()).done;)u+=e(a=a.value,s=n+U(a,c++),r,i);else\"object\"===a&&g(\"31\",\"[object Object]\"===(r=\"\"+t)?\"object with keys {\"+Object.keys(t).join(\", \")+\"}\":r,\"\");return u}(e,\"\",t,n)}function U(e,t){return\"object\"===typeof e&&null!==e&&null!=e.key?function(e){var t={\"=\":\"=0\",\":\":\"=2\"};return\"$\"+(\"\"+e).replace(/[=:]/g,function(e){return t[e]})}(e.key):t.toString(36)}function F(e,t){e.func.call(e.context,t,e.count++)}function D(e,t,n){var r=e.result,i=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?A(e,r,n,function(e){return e}):null!=e&&(O(e)&&(e=function(e,t){return{$$typeof:l,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,i+(!e.key||t&&t.key===e.key?\"\":(\"\"+e.key).replace(R,\"$&/\")+\"/\")+n)),r.push(e))}function A(e,t,n,r,i){var l=\"\";null!=n&&(l=(\"\"+n).replace(R,\"$&/\")+\"/\"),I(e,D,t=M(t,l,r,i)),z(t)}function j(){var e=S.current;return null===e&&g(\"307\"),e}var W={Children:{map:function(e,t,n){if(null==e)return e;var r=[];return A(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;I(e,F,t=M(null,null,t,n)),z(t)},count:function(e){return I(e,function(){return null},null)},toArray:function(e){var t=[];return A(e,t,null,function(e){return e}),t},only:function(e){return O(e)||g(\"143\"),e}},createRef:function(){return{current:null}},Component:k,PureComponent:T,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:f,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},forwardRef:function(e){return{$$typeof:p,render:e}},lazy:function(e){return{$$typeof:v,_ctor:e,_status:-1,_result:null}},memo:function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},useCallback:function(e,t){return j().useCallback(e,t)},useContext:function(e,t){return j().useContext(e,t)},useEffect:function(e,t){return j().useEffect(e,t)},useImperativeHandle:function(e,t,n){return j().useImperativeHandle(e,t,n)},useDebugValue:function(){},useLayoutEffect:function(e,t){return j().useLayoutEffect(e,t)},useMemo:function(e,t){return j().useMemo(e,t)},useReducer:function(e,t,n){return j().useReducer(e,t,n)},useRef:function(e){return j().useRef(e)},useState:function(e){return j().useState(e)},Fragment:a,StrictMode:u,Suspense:m,createElement:N,cloneElement:function(e,t,n){(null===e||void 0===e)&&g(\"267\",e);var i=void 0,o=r({},e.props),a=e.key,u=e.ref,c=e._owner;if(null!=t){void 0!==t.ref&&(u=t.ref,c=E.current),void 0!==t.key&&(a=\"\"+t.key);var s=void 0;for(i in e.type&&e.type.defaultProps&&(s=e.type.defaultProps),t)C.call(t,i)&&!P.hasOwnProperty(i)&&(o[i]=void 0===t[i]&&void 0!==s?s[i]:t[i])}if(1===(i=arguments.length-2))o.children=n;else if(1<i){s=Array(i);for(var f=0;f<i;f++)s[f]=arguments[f+2];o.children=s}return{$$typeof:l,type:e.type,key:a,ref:u,props:o,_owner:c}},createFactory:function(e){var t=N.bind(null,e);return t.type=e,t},isValidElement:O,version:\"16.8.2\",unstable_ConcurrentMode:d,unstable_Profiler:c,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:S,ReactCurrentOwner:E,assign:r}},V={default:W},B=V&&W||V;e.exports=B.default||B},function(e,t,n){\"use strict\";var r=n(0),i=n(10),l=n(20);function o(e){for(var t=arguments.length-1,n=\"https://reactjs.org/docs/error-decoder.html?invariant=\"+e,r=0;r<t;r++)n+=\"&args[]=\"+encodeURIComponent(arguments[r+1]);!function(e,t,n,r,i,l,o,a){if(!e){if(e=void 0,void 0===t)e=Error(\"Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.\");else{var u=[n,r,i,l,o,a],c=0;(e=Error(t.replace(/%s/g,function(){return u[c++]}))).name=\"Invariant Violation\"}throw e.framesToPop=1,e}}(!1,\"Minified React error #\"+e+\"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. \",n)}r||o(\"227\");var a=!1,u=null,c=!1,s=null,f={onError:function(e){a=!0,u=e}};function d(e,t,n,r,i,l,o,c,s){a=!1,u=null,function(e,t,n,r,i,l,o,a,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(s){this.onError(s)}}.apply(f,arguments)}var p=null,m={};function h(){if(p)for(var e in m){var t=m[e],n=p.indexOf(e);if(-1<n||o(\"96\",e),!y[n])for(var r in t.extractEvents||o(\"97\",e),y[n]=t,n=t.eventTypes){var i=void 0,l=n[r],a=t,u=r;g.hasOwnProperty(u)&&o(\"99\",u),g[u]=l;var c=l.phasedRegistrationNames;if(c){for(i in c)c.hasOwnProperty(i)&&v(c[i],a,u);i=!0}else l.registrationName?(v(l.registrationName,a,u),i=!0):i=!1;i||o(\"98\",r,e)}}}function v(e,t,n){b[e]&&o(\"100\",e),b[e]=t,w[e]=t.eventTypes[n].dependencies}var y=[],g={},b={},w={},k=null,x=null,T=null;function _(e,t,n){var r=e.type||\"unknown-event\";e.currentTarget=T(n),function(e,t,n,r,i,l,f,p,m){if(d.apply(this,arguments),a){if(a){var h=u;a=!1,u=null}else o(\"198\"),h=void 0;c||(c=!0,s=h)}}(r,t,void 0,e),e.currentTarget=null}function S(e,t){return null==t&&o(\"30\"),null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function E(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var C=null;function P(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var r=0;r<t.length&&!e.isPropagationStopped();r++)_(e,t[r],n[r]);else t&&_(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}var N={injectEventPluginOrder:function(e){p&&o(\"101\"),p=Array.prototype.slice.call(e),h()},injectEventPluginsByName:function(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var r=e[t];m.hasOwnProperty(t)&&m[t]===r||(m[t]&&o(\"102\",t),m[t]=r,n=!0)}n&&h()}};function O(e,t){var n=e.stateNode;if(!n)return null;var r=k(n);if(!r)return null;n=r[t];e:switch(t){case\"onClick\":case\"onClickCapture\":case\"onDoubleClick\":case\"onDoubleClickCapture\":case\"onMouseDown\":case\"onMouseDownCapture\":case\"onMouseMove\":case\"onMouseMoveCapture\":case\"onMouseUp\":case\"onMouseUpCapture\":(r=!r.disabled)||(r=!(\"button\"===(e=e.type)||\"input\"===e||\"select\"===e||\"textarea\"===e)),e=!r;break e;default:e=!1}return e?null:(n&&\"function\"!==typeof n&&o(\"231\",t,typeof n),n)}function R(e){if(null!==e&&(C=S(C,e)),e=C,C=null,e&&(E(e,P),C&&o(\"95\"),c))throw e=s,c=!1,s=null,e}var L=Math.random().toString(36).slice(2),M=\"__reactInternalInstance$\"+L,z=\"__reactEventHandlers$\"+L;function I(e){if(e[M])return e[M];for(;!e[M];){if(!e.parentNode)return null;e=e.parentNode}return 5===(e=e[M]).tag||6===e.tag?e:null}function U(e){return!(e=e[M])||5!==e.tag&&6!==e.tag?null:e}function F(e){if(5===e.tag||6===e.tag)return e.stateNode;o(\"33\")}function D(e){return e[z]||null}function A(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function j(e,t,n){(t=O(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=S(n._dispatchListeners,t),n._dispatchInstances=S(n._dispatchInstances,e))}function W(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=A(t);for(t=n.length;0<t--;)j(n[t],\"captured\",e);for(t=0;t<n.length;t++)j(n[t],\"bubbled\",e)}}function V(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=O(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=S(n._dispatchListeners,t),n._dispatchInstances=S(n._dispatchInstances,e))}function B(e){e&&e.dispatchConfig.registrationName&&V(e._targetInst,null,e)}function H(e){E(e,W)}var $=!(\"undefined\"===typeof window||!window.document||!window.document.createElement);function Q(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n[\"Webkit\"+e]=\"webkit\"+t,n[\"Moz\"+e]=\"moz\"+t,n}var K={animationend:Q(\"Animation\",\"AnimationEnd\"),animationiteration:Q(\"Animation\",\"AnimationIteration\"),animationstart:Q(\"Animation\",\"AnimationStart\"),transitionend:Q(\"Transition\",\"TransitionEnd\")},q={},Y={};function X(e){if(q[e])return q[e];if(!K[e])return e;var t,n=K[e];for(t in n)if(n.hasOwnProperty(t)&&t in Y)return q[e]=n[t];return e}$&&(Y=document.createElement(\"div\").style,\"AnimationEvent\"in window||(delete K.animationend.animation,delete K.animationiteration.animation,delete K.animationstart.animation),\"TransitionEvent\"in window||delete K.transitionend.transition);var G=X(\"animationend\"),J=X(\"animationiteration\"),Z=X(\"animationstart\"),ee=X(\"transitionend\"),te=\"abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting\".split(\" \"),ne=null,re=null,ie=null;function le(){if(ie)return ie;var e,t,n=re,r=n.length,i=\"value\"in ne?ne.value:ne.textContent,l=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[l-t];t++);return ie=i.slice(e,1<t?1-t:void 0)}function oe(){return!0}function ae(){return!1}function ue(e,t,n,r){for(var i in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(i)&&((t=e[i])?this[i]=t(n):\"target\"===i?this.target=r:this[i]=n[i]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?oe:ae,this.isPropagationStopped=ae,this}function ce(e,t,n,r){if(this.eventPool.length){var i=this.eventPool.pop();return this.call(i,e,t,n,r),i}return new this(e,t,n,r)}function se(e){e instanceof this||o(\"279\"),e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function fe(e){e.eventPool=[],e.getPooled=ce,e.release=se}i(ue.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():\"unknown\"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=oe)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():\"unknown\"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=oe)},persist:function(){this.isPersistent=oe},isPersistent:ae,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=ae,this._dispatchInstances=this._dispatchListeners=null}}),ue.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},ue.extend=function(e){function t(){}function n(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var l=new t;return i(l,n.prototype),n.prototype=l,n.prototype.constructor=n,n.Interface=i({},r.Interface,e),n.extend=r.extend,fe(n),n},fe(ue);var de=ue.extend({data:null}),pe=ue.extend({data:null}),me=[9,13,27,32],he=$&&\"CompositionEvent\"in window,ve=null;$&&\"documentMode\"in document&&(ve=document.documentMode);var ye=$&&\"TextEvent\"in window&&!ve,ge=$&&(!he||ve&&8<ve&&11>=ve),be=String.fromCharCode(32),we={beforeInput:{phasedRegistrationNames:{bubbled:\"onBeforeInput\",captured:\"onBeforeInputCapture\"},dependencies:[\"compositionend\",\"keypress\",\"textInput\",\"paste\"]},compositionEnd:{phasedRegistrationNames:{bubbled:\"onCompositionEnd\",captured:\"onCompositionEndCapture\"},dependencies:\"blur compositionend keydown keypress keyup mousedown\".split(\" \")},compositionStart:{phasedRegistrationNames:{bubbled:\"onCompositionStart\",captured:\"onCompositionStartCapture\"},dependencies:\"blur compositionstart keydown keypress keyup mousedown\".split(\" \")},compositionUpdate:{phasedRegistrationNames:{bubbled:\"onCompositionUpdate\",captured:\"onCompositionUpdateCapture\"},dependencies:\"blur compositionupdate keydown keypress keyup mousedown\".split(\" \")}},ke=!1;function xe(e,t){switch(e){case\"keyup\":return-1!==me.indexOf(t.keyCode);case\"keydown\":return 229!==t.keyCode;case\"keypress\":case\"mousedown\":case\"blur\":return!0;default:return!1}}function Te(e){return\"object\"===typeof(e=e.detail)&&\"data\"in e?e.data:null}var _e=!1;var Se={eventTypes:we,extractEvents:function(e,t,n,r){var i=void 0,l=void 0;if(he)e:{switch(e){case\"compositionstart\":i=we.compositionStart;break e;case\"compositionend\":i=we.compositionEnd;break e;case\"compositionupdate\":i=we.compositionUpdate;break e}i=void 0}else _e?xe(e,n)&&(i=we.compositionEnd):\"keydown\"===e&&229===n.keyCode&&(i=we.compositionStart);return i?(ge&&\"ko\"!==n.locale&&(_e||i!==we.compositionStart?i===we.compositionEnd&&_e&&(l=le()):(re=\"value\"in(ne=r)?ne.value:ne.textContent,_e=!0)),i=de.getPooled(i,t,n,r),l?i.data=l:null!==(l=Te(n))&&(i.data=l),H(i),l=i):l=null,(e=ye?function(e,t){switch(e){case\"compositionend\":return Te(t);case\"keypress\":return 32!==t.which?null:(ke=!0,be);case\"textInput\":return(e=t.data)===be&&ke?null:e;default:return null}}(e,n):function(e,t){if(_e)return\"compositionend\"===e||!he&&xe(e,t)?(e=le(),ie=re=ne=null,_e=!1,e):null;switch(e){case\"paste\":return null;case\"keypress\":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case\"compositionend\":return ge&&\"ko\"!==t.locale?null:t.data;default:return null}}(e,n))?((t=pe.getPooled(we.beforeInput,t,n,r)).data=e,H(t)):t=null,null===l?t:null===t?l:[l,t]}},Ee=null,Ce=null,Pe=null;function Ne(e){if(e=x(e)){\"function\"!==typeof Ee&&o(\"280\");var t=k(e.stateNode);Ee(e.stateNode,e.type,t)}}function Oe(e){Ce?Pe?Pe.push(e):Pe=[e]:Ce=e}function Re(){if(Ce){var e=Ce,t=Pe;if(Pe=Ce=null,Ne(e),t)for(e=0;e<t.length;e++)Ne(t[e])}}function Le(e,t){return e(t)}function Me(e,t,n){return e(t,n)}function ze(){}var Ie=!1;function Ue(e,t){if(Ie)return e(t);Ie=!0;try{return Le(e,t)}finally{Ie=!1,(null!==Ce||null!==Pe)&&(ze(),Re())}}var Fe={color:!0,date:!0,datetime:!0,\"datetime-local\":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function De(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return\"input\"===t?!!Fe[e.type]:\"textarea\"===t}function Ae(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function je(e){if(!$)return!1;var t=(e=\"on\"+e)in document;return t||((t=document.createElement(\"div\")).setAttribute(e,\"return;\"),t=\"function\"===typeof t[e]),t}function We(e){var t=e.type;return(e=e.nodeName)&&\"input\"===e.toLowerCase()&&(\"checkbox\"===t||\"radio\"===t)}function Ve(e){e._valueTracker||(e._valueTracker=function(e){var t=We(e)?\"checked\":\"value\",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=\"\"+e[t];if(!e.hasOwnProperty(t)&&\"undefined\"!==typeof n&&\"function\"===typeof n.get&&\"function\"===typeof n.set){var i=n.get,l=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=\"\"+e,l.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=\"\"+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Be(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r=\"\";return e&&(r=We(e)?e.checked?\"true\":\"false\":e.value),(e=r)!==n&&(t.setValue(e),!0)}var He=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;He.hasOwnProperty(\"ReactCurrentDispatcher\")||(He.ReactCurrentDispatcher={current:null});var $e=/^(.*)[\\\\\\/]/,Qe=\"function\"===typeof Symbol&&Symbol.for,Ke=Qe?Symbol.for(\"react.element\"):60103,qe=Qe?Symbol.for(\"react.portal\"):60106,Ye=Qe?Symbol.for(\"react.fragment\"):60107,Xe=Qe?Symbol.for(\"react.strict_mode\"):60108,Ge=Qe?Symbol.for(\"react.profiler\"):60114,Je=Qe?Symbol.for(\"react.provider\"):60109,Ze=Qe?Symbol.for(\"react.context\"):60110,et=Qe?Symbol.for(\"react.concurrent_mode\"):60111,tt=Qe?Symbol.for(\"react.forward_ref\"):60112,nt=Qe?Symbol.for(\"react.suspense\"):60113,rt=Qe?Symbol.for(\"react.memo\"):60115,it=Qe?Symbol.for(\"react.lazy\"):60116,lt=\"function\"===typeof Symbol&&Symbol.iterator;function ot(e){return null===e||\"object\"!==typeof e?null:\"function\"===typeof(e=lt&&e[lt]||e[\"@@iterator\"])?e:null}function at(e){if(null==e)return null;if(\"function\"===typeof e)return e.displayName||e.name||null;if(\"string\"===typeof e)return e;switch(e){case et:return\"ConcurrentMode\";case Ye:return\"Fragment\";case qe:return\"Portal\";case Ge:return\"Profiler\";case Xe:return\"StrictMode\";case nt:return\"Suspense\"}if(\"object\"===typeof e)switch(e.$$typeof){case Ze:return\"Context.Consumer\";case Je:return\"Context.Provider\";case tt:var t=e.render;return t=t.displayName||t.name||\"\",e.displayName||(\"\"!==t?\"ForwardRef(\"+t+\")\":\"ForwardRef\");case rt:return at(e.type);case it:if(e=1===e._status?e._result:null)return at(e)}return null}function ut(e){var t=\"\";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n=\"\";break e;default:var r=e._debugOwner,i=e._debugSource,l=at(e.type);n=null,r&&(n=at(r.type)),r=l,l=\"\",i?l=\" (at \"+i.fileName.replace($e,\"\")+\":\"+i.lineNumber+\")\":n&&(l=\" (created by \"+n+\")\"),n=\"\\n    in \"+(r||\"Unknown\")+l}t+=n,e=e.return}while(e);return t}var ct=/^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$/,st=Object.prototype.hasOwnProperty,ft={},dt={};function pt(e,t,n,r,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t}var mt={};\"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style\".split(\" \").forEach(function(e){mt[e]=new pt(e,0,!1,e,null)}),[[\"acceptCharset\",\"accept-charset\"],[\"className\",\"class\"],[\"htmlFor\",\"for\"],[\"httpEquiv\",\"http-equiv\"]].forEach(function(e){var t=e[0];mt[t]=new pt(t,1,!1,e[1],null)}),[\"contentEditable\",\"draggable\",\"spellCheck\",\"value\"].forEach(function(e){mt[e]=new pt(e,2,!1,e.toLowerCase(),null)}),[\"autoReverse\",\"externalResourcesRequired\",\"focusable\",\"preserveAlpha\"].forEach(function(e){mt[e]=new pt(e,2,!1,e,null)}),\"allowFullScreen async autoFocus autoPlay controls default defer disabled formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope\".split(\" \").forEach(function(e){mt[e]=new pt(e,3,!1,e.toLowerCase(),null)}),[\"checked\",\"multiple\",\"muted\",\"selected\"].forEach(function(e){mt[e]=new pt(e,3,!0,e,null)}),[\"capture\",\"download\"].forEach(function(e){mt[e]=new pt(e,4,!1,e,null)}),[\"cols\",\"rows\",\"size\",\"span\"].forEach(function(e){mt[e]=new pt(e,6,!1,e,null)}),[\"rowSpan\",\"start\"].forEach(function(e){mt[e]=new pt(e,5,!1,e.toLowerCase(),null)});var ht=/[\\-:]([a-z])/g;function vt(e){return e[1].toUpperCase()}function yt(e,t,n,r){var i=mt.hasOwnProperty(t)?mt[t]:null;(null!==i?0===i.type:!r&&(2<t.length&&(\"o\"===t[0]||\"O\"===t[0])&&(\"n\"===t[1]||\"N\"===t[1])))||(function(e,t,n,r){if(null===t||\"undefined\"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case\"function\":case\"symbol\":return!0;case\"boolean\":return!r&&(null!==n?!n.acceptsBooleans:\"data-\"!==(e=e.toLowerCase().slice(0,5))&&\"aria-\"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!st.call(dt,e)||!st.call(ft,e)&&(ct.test(e)?dt[e]=!0:(ft[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,\"\"+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&\"\":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?\"\":\"\"+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}function gt(e){switch(typeof e){case\"boolean\":case\"number\":case\"object\":case\"string\":case\"undefined\":return e;default:return\"\"}}function bt(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function wt(e,t){var n=null==t.defaultValue?\"\":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=gt(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:\"checkbox\"===t.type||\"radio\"===t.type?null!=t.checked:null!=t.value}}function kt(e,t){null!=(t=t.checked)&&yt(e,\"checked\",t,!1)}function xt(e,t){kt(e,t);var n=gt(t.value),r=t.type;if(null!=n)\"number\"===r?(0===n&&\"\"===e.value||e.value!=n)&&(e.value=\"\"+n):e.value!==\"\"+n&&(e.value=\"\"+n);else if(\"submit\"===r||\"reset\"===r)return void e.removeAttribute(\"value\");t.hasOwnProperty(\"value\")?_t(e,t.type,n):t.hasOwnProperty(\"defaultValue\")&&_t(e,t.type,gt(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Tt(e,t,n){if(t.hasOwnProperty(\"value\")||t.hasOwnProperty(\"defaultValue\")){var r=t.type;if(!(\"submit\"!==r&&\"reset\"!==r||void 0!==t.value&&null!==t.value))return;t=\"\"+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}\"\"!==(n=e.name)&&(e.name=\"\"),e.defaultChecked=!e.defaultChecked,e.defaultChecked=!!e._wrapperState.initialChecked,\"\"!==n&&(e.name=n)}function _t(e,t,n){\"number\"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=\"\"+e._wrapperState.initialValue:e.defaultValue!==\"\"+n&&(e.defaultValue=\"\"+n))}\"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height\".split(\" \").forEach(function(e){var t=e.replace(ht,vt);mt[t]=new pt(t,1,!1,e,null)}),\"xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type\".split(\" \").forEach(function(e){var t=e.replace(ht,vt);mt[t]=new pt(t,1,!1,e,\"http://www.w3.org/1999/xlink\")}),[\"xml:base\",\"xml:lang\",\"xml:space\"].forEach(function(e){var t=e.replace(ht,vt);mt[t]=new pt(t,1,!1,e,\"http://www.w3.org/XML/1998/namespace\")}),[\"tabIndex\",\"crossOrigin\"].forEach(function(e){mt[e]=new pt(e,1,!1,e.toLowerCase(),null)});var St={change:{phasedRegistrationNames:{bubbled:\"onChange\",captured:\"onChangeCapture\"},dependencies:\"blur change click focus input keydown keyup selectionchange\".split(\" \")}};function Et(e,t,n){return(e=ue.getPooled(St.change,e,t,n)).type=\"change\",Oe(n),H(e),e}var Ct=null,Pt=null;function Nt(e){R(e)}function Ot(e){if(Be(F(e)))return e}function Rt(e,t){if(\"change\"===e)return t}var Lt=!1;function Mt(){Ct&&(Ct.detachEvent(\"onpropertychange\",zt),Pt=Ct=null)}function zt(e){\"value\"===e.propertyName&&Ot(Pt)&&Ue(Nt,e=Et(Pt,e,Ae(e)))}function It(e,t,n){\"focus\"===e?(Mt(),Pt=n,(Ct=t).attachEvent(\"onpropertychange\",zt)):\"blur\"===e&&Mt()}function Ut(e){if(\"selectionchange\"===e||\"keyup\"===e||\"keydown\"===e)return Ot(Pt)}function Ft(e,t){if(\"click\"===e)return Ot(t)}function Dt(e,t){if(\"input\"===e||\"change\"===e)return Ot(t)}$&&(Lt=je(\"input\")&&(!document.documentMode||9<document.documentMode));var At={eventTypes:St,_isInputEventSupported:Lt,extractEvents:function(e,t,n,r){var i=t?F(t):window,l=void 0,o=void 0,a=i.nodeName&&i.nodeName.toLowerCase();if(\"select\"===a||\"input\"===a&&\"file\"===i.type?l=Rt:De(i)?Lt?l=Dt:(l=Ut,o=It):(a=i.nodeName)&&\"input\"===a.toLowerCase()&&(\"checkbox\"===i.type||\"radio\"===i.type)&&(l=Ft),l&&(l=l(e,t)))return Et(l,n,r);o&&o(e,i,t),\"blur\"===e&&(e=i._wrapperState)&&e.controlled&&\"number\"===i.type&&_t(i,\"number\",i.value)}},jt=ue.extend({view:null,detail:null}),Wt={Alt:\"altKey\",Control:\"ctrlKey\",Meta:\"metaKey\",Shift:\"shiftKey\"};function Vt(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Wt[e])&&!!t[e]}function Bt(){return Vt}var Ht=0,$t=0,Qt=!1,Kt=!1,qt=jt.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Bt,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if(\"movementX\"in e)return e.movementX;var t=Ht;return Ht=e.screenX,Qt?\"mousemove\"===e.type?e.screenX-t:0:(Qt=!0,0)},movementY:function(e){if(\"movementY\"in e)return e.movementY;var t=$t;return $t=e.screenY,Kt?\"mousemove\"===e.type?e.screenY-t:0:(Kt=!0,0)}}),Yt=qt.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Xt={mouseEnter:{registrationName:\"onMouseEnter\",dependencies:[\"mouseout\",\"mouseover\"]},mouseLeave:{registrationName:\"onMouseLeave\",dependencies:[\"mouseout\",\"mouseover\"]},pointerEnter:{registrationName:\"onPointerEnter\",dependencies:[\"pointerout\",\"pointerover\"]},pointerLeave:{registrationName:\"onPointerLeave\",dependencies:[\"pointerout\",\"pointerover\"]}},Gt={eventTypes:Xt,extractEvents:function(e,t,n,r){var i=\"mouseover\"===e||\"pointerover\"===e,l=\"mouseout\"===e||\"pointerout\"===e;if(i&&(n.relatedTarget||n.fromElement)||!l&&!i)return null;if(i=r.window===r?r:(i=r.ownerDocument)?i.defaultView||i.parentWindow:window,l?(l=t,t=(t=n.relatedTarget||n.toElement)?I(t):null):l=null,l===t)return null;var o=void 0,a=void 0,u=void 0,c=void 0;\"mouseout\"===e||\"mouseover\"===e?(o=qt,a=Xt.mouseLeave,u=Xt.mouseEnter,c=\"mouse\"):\"pointerout\"!==e&&\"pointerover\"!==e||(o=Yt,a=Xt.pointerLeave,u=Xt.pointerEnter,c=\"pointer\");var s=null==l?i:F(l);if(i=null==t?i:F(t),(e=o.getPooled(a,l,n,r)).type=c+\"leave\",e.target=s,e.relatedTarget=i,(n=o.getPooled(u,t,n,r)).type=c+\"enter\",n.target=i,n.relatedTarget=s,r=t,l&&r)e:{for(i=r,c=0,o=t=l;o;o=A(o))c++;for(o=0,u=i;u;u=A(u))o++;for(;0<c-o;)t=A(t),c--;for(;0<o-c;)i=A(i),o--;for(;c--;){if(t===i||t===i.alternate)break e;t=A(t),i=A(i)}t=null}else t=null;for(i=t,t=[];l&&l!==i&&(null===(c=l.alternate)||c!==i);)t.push(l),l=A(l);for(l=[];r&&r!==i&&(null===(c=r.alternate)||c!==i);)l.push(r),r=A(r);for(r=0;r<t.length;r++)V(t[r],\"bubbled\",e);for(r=l.length;0<r--;)V(l[r],\"captured\",n);return[e,n]}};function Jt(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t}var Zt=Object.prototype.hasOwnProperty;function en(e,t){if(Jt(e,t))return!0;if(\"object\"!==typeof e||null===e||\"object\"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!Zt.call(t,n[r])||!Jt(e[n[r]],t[n[r]]))return!1;return!0}function tn(e){var t=e;if(e.alternate)for(;t.return;)t=t.return;else{if(0!==(2&t.effectTag))return 1;for(;t.return;)if(0!==(2&(t=t.return).effectTag))return 1}return 3===t.tag?2:3}function nn(e){2!==tn(e)&&o(\"188\")}function rn(e){if(!(e=function(e){var t=e.alternate;if(!t)return 3===(t=tn(e))&&o(\"188\"),1===t?null:e;for(var n=e,r=t;;){var i=n.return,l=i?i.alternate:null;if(!i||!l)break;if(i.child===l.child){for(var a=i.child;a;){if(a===n)return nn(i),e;if(a===r)return nn(i),t;a=a.sibling}o(\"188\")}if(n.return!==r.return)n=i,r=l;else{a=!1;for(var u=i.child;u;){if(u===n){a=!0,n=i,r=l;break}if(u===r){a=!0,r=i,n=l;break}u=u.sibling}if(!a){for(u=l.child;u;){if(u===n){a=!0,n=l,r=i;break}if(u===r){a=!0,r=l,n=i;break}u=u.sibling}a||o(\"189\")}}n.alternate!==r&&o(\"190\")}return 3!==n.tag&&o(\"188\"),n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}var ln=ue.extend({animationName:null,elapsedTime:null,pseudoElement:null}),on=ue.extend({clipboardData:function(e){return\"clipboardData\"in e?e.clipboardData:window.clipboardData}}),an=jt.extend({relatedTarget:null});function un(e){var t=e.keyCode;return\"charCode\"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var cn={Esc:\"Escape\",Spacebar:\" \",Left:\"ArrowLeft\",Up:\"ArrowUp\",Right:\"ArrowRight\",Down:\"ArrowDown\",Del:\"Delete\",Win:\"OS\",Menu:\"ContextMenu\",Apps:\"ContextMenu\",Scroll:\"ScrollLock\",MozPrintableKey:\"Unidentified\"},sn={8:\"Backspace\",9:\"Tab\",12:\"Clear\",13:\"Enter\",16:\"Shift\",17:\"Control\",18:\"Alt\",19:\"Pause\",20:\"CapsLock\",27:\"Escape\",32:\" \",33:\"PageUp\",34:\"PageDown\",35:\"End\",36:\"Home\",37:\"ArrowLeft\",38:\"ArrowUp\",39:\"ArrowRight\",40:\"ArrowDown\",45:\"Insert\",46:\"Delete\",112:\"F1\",113:\"F2\",114:\"F3\",115:\"F4\",116:\"F5\",117:\"F6\",118:\"F7\",119:\"F8\",120:\"F9\",121:\"F10\",122:\"F11\",123:\"F12\",144:\"NumLock\",145:\"ScrollLock\",224:\"Meta\"},fn=jt.extend({key:function(e){if(e.key){var t=cn[e.key]||e.key;if(\"Unidentified\"!==t)return t}return\"keypress\"===e.type?13===(e=un(e))?\"Enter\":String.fromCharCode(e):\"keydown\"===e.type||\"keyup\"===e.type?sn[e.keyCode]||\"Unidentified\":\"\"},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Bt,charCode:function(e){return\"keypress\"===e.type?un(e):0},keyCode:function(e){return\"keydown\"===e.type||\"keyup\"===e.type?e.keyCode:0},which:function(e){return\"keypress\"===e.type?un(e):\"keydown\"===e.type||\"keyup\"===e.type?e.keyCode:0}}),dn=qt.extend({dataTransfer:null}),pn=jt.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Bt}),mn=ue.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),hn=qt.extend({deltaX:function(e){return\"deltaX\"in e?e.deltaX:\"wheelDeltaX\"in e?-e.wheelDeltaX:0},deltaY:function(e){return\"deltaY\"in e?e.deltaY:\"wheelDeltaY\"in e?-e.wheelDeltaY:\"wheelDelta\"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),vn=[[\"abort\",\"abort\"],[G,\"animationEnd\"],[J,\"animationIteration\"],[Z,\"animationStart\"],[\"canplay\",\"canPlay\"],[\"canplaythrough\",\"canPlayThrough\"],[\"drag\",\"drag\"],[\"dragenter\",\"dragEnter\"],[\"dragexit\",\"dragExit\"],[\"dragleave\",\"dragLeave\"],[\"dragover\",\"dragOver\"],[\"durationchange\",\"durationChange\"],[\"emptied\",\"emptied\"],[\"encrypted\",\"encrypted\"],[\"ended\",\"ended\"],[\"error\",\"error\"],[\"gotpointercapture\",\"gotPointerCapture\"],[\"load\",\"load\"],[\"loadeddata\",\"loadedData\"],[\"loadedmetadata\",\"loadedMetadata\"],[\"loadstart\",\"loadStart\"],[\"lostpointercapture\",\"lostPointerCapture\"],[\"mousemove\",\"mouseMove\"],[\"mouseout\",\"mouseOut\"],[\"mouseover\",\"mouseOver\"],[\"playing\",\"playing\"],[\"pointermove\",\"pointerMove\"],[\"pointerout\",\"pointerOut\"],[\"pointerover\",\"pointerOver\"],[\"progress\",\"progress\"],[\"scroll\",\"scroll\"],[\"seeking\",\"seeking\"],[\"stalled\",\"stalled\"],[\"suspend\",\"suspend\"],[\"timeupdate\",\"timeUpdate\"],[\"toggle\",\"toggle\"],[\"touchmove\",\"touchMove\"],[ee,\"transitionEnd\"],[\"waiting\",\"waiting\"],[\"wheel\",\"wheel\"]],yn={},gn={};function bn(e,t){var n=e[0],r=\"on\"+((e=e[1])[0].toUpperCase()+e.slice(1));t={phasedRegistrationNames:{bubbled:r,captured:r+\"Capture\"},dependencies:[n],isInteractive:t},yn[e]=t,gn[n]=t}[[\"blur\",\"blur\"],[\"cancel\",\"cancel\"],[\"click\",\"click\"],[\"close\",\"close\"],[\"contextmenu\",\"contextMenu\"],[\"copy\",\"copy\"],[\"cut\",\"cut\"],[\"auxclick\",\"auxClick\"],[\"dblclick\",\"doubleClick\"],[\"dragend\",\"dragEnd\"],[\"dragstart\",\"dragStart\"],[\"drop\",\"drop\"],[\"focus\",\"focus\"],[\"input\",\"input\"],[\"invalid\",\"invalid\"],[\"keydown\",\"keyDown\"],[\"keypress\",\"keyPress\"],[\"keyup\",\"keyUp\"],[\"mousedown\",\"mouseDown\"],[\"mouseup\",\"mouseUp\"],[\"paste\",\"paste\"],[\"pause\",\"pause\"],[\"play\",\"play\"],[\"pointercancel\",\"pointerCancel\"],[\"pointerdown\",\"pointerDown\"],[\"pointerup\",\"pointerUp\"],[\"ratechange\",\"rateChange\"],[\"reset\",\"reset\"],[\"seeked\",\"seeked\"],[\"submit\",\"submit\"],[\"touchcancel\",\"touchCancel\"],[\"touchend\",\"touchEnd\"],[\"touchstart\",\"touchStart\"],[\"volumechange\",\"volumeChange\"]].forEach(function(e){bn(e,!0)}),vn.forEach(function(e){bn(e,!1)});var wn={eventTypes:yn,isInteractiveTopLevelEventType:function(e){return void 0!==(e=gn[e])&&!0===e.isInteractive},extractEvents:function(e,t,n,r){var i=gn[e];if(!i)return null;switch(e){case\"keypress\":if(0===un(n))return null;case\"keydown\":case\"keyup\":e=fn;break;case\"blur\":case\"focus\":e=an;break;case\"click\":if(2===n.button)return null;case\"auxclick\":case\"dblclick\":case\"mousedown\":case\"mousemove\":case\"mouseup\":case\"mouseout\":case\"mouseover\":case\"contextmenu\":e=qt;break;case\"drag\":case\"dragend\":case\"dragenter\":case\"dragexit\":case\"dragleave\":case\"dragover\":case\"dragstart\":case\"drop\":e=dn;break;case\"touchcancel\":case\"touchend\":case\"touchmove\":case\"touchstart\":e=pn;break;case G:case J:case Z:e=ln;break;case ee:e=mn;break;case\"scroll\":e=jt;break;case\"wheel\":e=hn;break;case\"copy\":case\"cut\":case\"paste\":e=on;break;case\"gotpointercapture\":case\"lostpointercapture\":case\"pointercancel\":case\"pointerdown\":case\"pointermove\":case\"pointerout\":case\"pointerover\":case\"pointerup\":e=Yt;break;default:e=ue}return H(t=e.getPooled(i,t,n,r)),t}},kn=wn.isInteractiveTopLevelEventType,xn=[];function Tn(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var r;for(r=n;r.return;)r=r.return;if(!(r=3!==r.tag?null:r.stateNode.containerInfo))break;e.ancestors.push(n),n=I(r)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var i=Ae(e.nativeEvent);r=e.topLevelType;for(var l=e.nativeEvent,o=null,a=0;a<y.length;a++){var u=y[a];u&&(u=u.extractEvents(r,t,l,i))&&(o=S(o,u))}R(o)}}var _n=!0;function Sn(e,t){if(!t)return null;var n=(kn(e)?Cn:Pn).bind(null,e);t.addEventListener(e,n,!1)}function En(e,t){if(!t)return null;var n=(kn(e)?Cn:Pn).bind(null,e);t.addEventListener(e,n,!0)}function Cn(e,t){Me(Pn,e,t)}function Pn(e,t){if(_n){var n=Ae(t);if(null===(n=I(n))||\"number\"!==typeof n.tag||2===tn(n)||(n=null),xn.length){var r=xn.pop();r.topLevelType=e,r.nativeEvent=t,r.targetInst=n,e=r}else e={topLevelType:e,nativeEvent:t,targetInst:n,ancestors:[]};try{Ue(Tn,e)}finally{e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>xn.length&&xn.push(e)}}}var Nn={},On=0,Rn=\"_reactListenersID\"+(\"\"+Math.random()).slice(2);function Ln(e){return Object.prototype.hasOwnProperty.call(e,Rn)||(e[Rn]=On++,Nn[e[Rn]]={}),Nn[e[Rn]]}function Mn(e){if(\"undefined\"===typeof(e=e||(\"undefined\"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function zn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function In(e,t){var n,r=zn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=zn(r)}}function Un(){for(var e=window,t=Mn();t instanceof e.HTMLIFrameElement;){try{e=t.contentDocument.defaultView}catch(n){break}t=Mn(e.document)}return t}function Fn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(\"input\"===t&&(\"text\"===e.type||\"search\"===e.type||\"tel\"===e.type||\"url\"===e.type||\"password\"===e.type)||\"textarea\"===t||\"true\"===e.contentEditable)}function Dn(e){var t=Un(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&function e(t,n){return!(!t||!n)&&(t===n||(!t||3!==t.nodeType)&&(n&&3===n.nodeType?e(t,n.parentNode):\"contains\"in t?t.contains(n):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(n))))}(n.ownerDocument.documentElement,n)){if(null!==r&&Fn(n))if(t=r.start,void 0===(e=r.end)&&(e=t),\"selectionStart\"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,l=Math.min(r.start,i);r=void 0===r.end?l:Math.min(r.end,i),!e.extend&&l>r&&(i=r,r=l,l=i),i=In(n,l);var o=In(n,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),l>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(\"function\"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var An=$&&\"documentMode\"in document&&11>=document.documentMode,jn={select:{phasedRegistrationNames:{bubbled:\"onSelect\",captured:\"onSelectCapture\"},dependencies:\"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange\".split(\" \")}},Wn=null,Vn=null,Bn=null,Hn=!1;function $n(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return Hn||null==Wn||Wn!==Mn(n)?null:(\"selectionStart\"in(n=Wn)&&Fn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Bn&&en(Bn,n)?null:(Bn=n,(e=ue.getPooled(jn.select,Vn,e,t)).type=\"select\",e.target=Wn,H(e),e))}var Qn={eventTypes:jn,extractEvents:function(e,t,n,r){var i,l=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;if(!(i=!l)){e:{l=Ln(l),i=w.onSelect;for(var o=0;o<i.length;o++){var a=i[o];if(!l.hasOwnProperty(a)||!l[a]){l=!1;break e}}l=!0}i=!l}if(i)return null;switch(l=t?F(t):window,e){case\"focus\":(De(l)||\"true\"===l.contentEditable)&&(Wn=l,Vn=t,Bn=null);break;case\"blur\":Bn=Vn=Wn=null;break;case\"mousedown\":Hn=!0;break;case\"contextmenu\":case\"mouseup\":case\"dragend\":return Hn=!1,$n(n,r);case\"selectionchange\":if(An)break;case\"keydown\":case\"keyup\":return $n(n,r)}return null}};function Kn(e,t){return e=i({children:void 0},t),(t=function(e){var t=\"\";return r.Children.forEach(e,function(e){null!=e&&(t+=e)}),t}(t.children))&&(e.children=t),e}function qn(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t[\"$\"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty(\"$\"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=\"\"+gt(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function Yn(e,t){return null!=t.dangerouslySetInnerHTML&&o(\"91\"),i({},t,{value:void 0,defaultValue:void 0,children:\"\"+e._wrapperState.initialValue})}function Xn(e,t){var n=t.value;null==n&&(n=t.defaultValue,null!=(t=t.children)&&(null!=n&&o(\"92\"),Array.isArray(t)&&(1>=t.length||o(\"93\"),t=t[0]),n=t),null==n&&(n=\"\")),e._wrapperState={initialValue:gt(n)}}function Gn(e,t){var n=gt(t.value),r=gt(t.defaultValue);null!=n&&((n=\"\"+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=\"\"+r)}function Jn(e){var t=e.textContent;t===e._wrapperState.initialValue&&(e.value=t)}N.injectEventPluginOrder(\"ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin\".split(\" \")),k=D,x=U,T=F,N.injectEventPluginsByName({SimpleEventPlugin:wn,EnterLeaveEventPlugin:Gt,ChangeEventPlugin:At,SelectEventPlugin:Qn,BeforeInputEventPlugin:Se});var Zn={html:\"http://www.w3.org/1999/xhtml\",mathml:\"http://www.w3.org/1998/Math/MathML\",svg:\"http://www.w3.org/2000/svg\"};function er(e){switch(e){case\"svg\":return\"http://www.w3.org/2000/svg\";case\"math\":return\"http://www.w3.org/1998/Math/MathML\";default:return\"http://www.w3.org/1999/xhtml\"}}function tr(e,t){return null==e||\"http://www.w3.org/1999/xhtml\"===e?er(t):\"http://www.w3.org/2000/svg\"===e&&\"foreignObject\"===t?\"http://www.w3.org/1999/xhtml\":e}var nr,rr=void 0,ir=(nr=function(e,t){if(e.namespaceURI!==Zn.svg||\"innerHTML\"in e)e.innerHTML=t;else{for((rr=rr||document.createElement(\"div\")).innerHTML=\"<svg>\"+t+\"</svg>\",t=rr.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},\"undefined\"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return nr(e,t)})}:nr);function lr(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var or={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ar=[\"Webkit\",\"ms\",\"Moz\",\"O\"];function ur(e,t,n){return null==t||\"boolean\"===typeof t||\"\"===t?\"\":n||\"number\"!==typeof t||0===t||or.hasOwnProperty(e)&&or[e]?(\"\"+t).trim():t+\"px\"}function cr(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf(\"--\"),i=ur(n,t[n],r);\"float\"===n&&(n=\"cssFloat\"),r?e.setProperty(n,i):e[n]=i}}Object.keys(or).forEach(function(e){ar.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),or[t]=or[e]})});var sr=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fr(e,t){t&&(sr[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML)&&o(\"137\",e,\"\"),null!=t.dangerouslySetInnerHTML&&(null!=t.children&&o(\"60\"),\"object\"===typeof t.dangerouslySetInnerHTML&&\"__html\"in t.dangerouslySetInnerHTML||o(\"61\")),null!=t.style&&\"object\"!==typeof t.style&&o(\"62\",\"\"))}function dr(e,t){if(-1===e.indexOf(\"-\"))return\"string\"===typeof t.is;switch(e){case\"annotation-xml\":case\"color-profile\":case\"font-face\":case\"font-face-src\":case\"font-face-uri\":case\"font-face-format\":case\"font-face-name\":case\"missing-glyph\":return!1;default:return!0}}function pr(e,t){var n=Ln(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=w[t];for(var r=0;r<t.length;r++){var i=t[r];if(!n.hasOwnProperty(i)||!n[i]){switch(i){case\"scroll\":En(\"scroll\",e);break;case\"focus\":case\"blur\":En(\"focus\",e),En(\"blur\",e),n.blur=!0,n.focus=!0;break;case\"cancel\":case\"close\":je(i)&&En(i,e);break;case\"invalid\":case\"submit\":case\"reset\":break;default:-1===te.indexOf(i)&&Sn(i,e)}n[i]=!0}}}function mr(){}var hr=null,vr=null;function yr(e,t){switch(e){case\"button\":case\"input\":case\"select\":case\"textarea\":return!!t.autoFocus}return!1}function gr(e,t){return\"textarea\"===e||\"option\"===e||\"noscript\"===e||\"string\"===typeof t.children||\"number\"===typeof t.children||\"object\"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var br=\"function\"===typeof setTimeout?setTimeout:void 0,wr=\"function\"===typeof clearTimeout?clearTimeout:void 0,kr=l.unstable_scheduleCallback,xr=l.unstable_cancelCallback;function Tr(e){for(e=e.nextSibling;e&&1!==e.nodeType&&3!==e.nodeType;)e=e.nextSibling;return e}function _r(e){for(e=e.firstChild;e&&1!==e.nodeType&&3!==e.nodeType;)e=e.nextSibling;return e}new Set;var Sr=[],Er=-1;function Cr(e){0>Er||(e.current=Sr[Er],Sr[Er]=null,Er--)}function Pr(e,t){Sr[++Er]=e.current,e.current=t}var Nr={},Or={current:Nr},Rr={current:!1},Lr=Nr;function Mr(e,t){var n=e.type.contextTypes;if(!n)return Nr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,l={};for(i in n)l[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=l),l}function zr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ir(e){Cr(Rr),Cr(Or)}function Ur(e){Cr(Rr),Cr(Or)}function Fr(e,t,n){Or.current!==Nr&&o(\"168\"),Pr(Or,t),Pr(Rr,n)}function Dr(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,\"function\"!==typeof r.getChildContext)return n;for(var l in r=r.getChildContext())l in e||o(\"108\",at(t)||\"Unknown\",l);return i({},n,r)}function Ar(e){var t=e.stateNode;return t=t&&t.__reactInternalMemoizedMergedChildContext||Nr,Lr=Or.current,Pr(Or,t),Pr(Rr,Rr.current),!0}function jr(e,t,n){var r=e.stateNode;r||o(\"169\"),n?(t=Dr(e,t,Lr),r.__reactInternalMemoizedMergedChildContext=t,Cr(Rr),Cr(Or),Pr(Or,t)):Cr(Rr),Pr(Rr,n)}var Wr=null,Vr=null;function Br(e){return function(t){try{return e(t)}catch(n){}}}function Hr(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.contextDependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function $r(e,t,n,r){return new Hr(e,t,n,r)}function Qr(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Kr(e,t){var n=e.alternate;return null===n?((n=$r(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,n.contextDependencies=e.contextDependencies,n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function qr(e,t,n,r,i,l){var a=2;if(r=e,\"function\"===typeof e)Qr(e)&&(a=1);else if(\"string\"===typeof e)a=5;else e:switch(e){case Ye:return Yr(n.children,i,l,t);case et:return Xr(n,3|i,l,t);case Xe:return Xr(n,2|i,l,t);case Ge:return(e=$r(12,n,t,4|i)).elementType=Ge,e.type=Ge,e.expirationTime=l,e;case nt:return(e=$r(13,n,t,i)).elementType=nt,e.type=nt,e.expirationTime=l,e;default:if(\"object\"===typeof e&&null!==e)switch(e.$$typeof){case Je:a=10;break e;case Ze:a=9;break e;case tt:a=11;break e;case rt:a=14;break e;case it:a=16,r=null;break e}o(\"130\",null==e?e:typeof e,\"\")}return(t=$r(a,n,t,i)).elementType=e,t.type=r,t.expirationTime=l,t}function Yr(e,t,n,r){return(e=$r(7,e,r,t)).expirationTime=n,e}function Xr(e,t,n,r){return e=$r(8,e,r,t),t=0===(1&t)?Xe:et,e.elementType=t,e.type=t,e.expirationTime=n,e}function Gr(e,t,n){return(e=$r(6,e,null,t)).expirationTime=n,e}function Jr(e,t,n){return(t=$r(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Zr(e,t){e.didError=!1;var n=e.earliestPendingTime;0===n?e.earliestPendingTime=e.latestPendingTime=t:n<t?e.earliestPendingTime=t:e.latestPendingTime>t&&(e.latestPendingTime=t),ni(t,e)}function ei(e,t){e.didError=!1,e.latestPingedTime>=t&&(e.latestPingedTime=0);var n=e.earliestPendingTime,r=e.latestPendingTime;n===t?e.earliestPendingTime=r===t?e.latestPendingTime=0:r:r===t&&(e.latestPendingTime=n),n=e.earliestSuspendedTime,r=e.latestSuspendedTime,0===n?e.earliestSuspendedTime=e.latestSuspendedTime=t:n<t?e.earliestSuspendedTime=t:r>t&&(e.latestSuspendedTime=t),ni(t,e)}function ti(e,t){var n=e.earliestPendingTime;return n>t&&(t=n),(e=e.earliestSuspendedTime)>t&&(t=e),t}function ni(e,t){var n=t.earliestSuspendedTime,r=t.latestSuspendedTime,i=t.earliestPendingTime,l=t.latestPingedTime;0===(i=0!==i?i:l)&&(0===e||r<e)&&(i=r),0!==(e=i)&&n>e&&(e=n),t.nextExpirationTimeToWorkOn=i,t.expirationTime=e}function ri(e,t){if(e&&e.defaultProps)for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var ii=(new r.Component).refs;function li(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:i({},t,n),e.memoizedState=n,null!==(r=e.updateQueue)&&0===e.expirationTime&&(r.baseState=n)}var oi={isMounted:function(e){return!!(e=e._reactInternalFiber)&&2===tn(e)},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var r=xa(),i=Yl(r=Yo(r,e));i.payload=t,void 0!==n&&null!==n&&(i.callback=n),Bo(),Gl(e,i),Jo(e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var r=xa(),i=Yl(r=Yo(r,e));i.tag=Bl,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),Bo(),Gl(e,i),Jo(e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=xa(),r=Yl(n=Yo(n,e));r.tag=Hl,void 0!==t&&null!==t&&(r.callback=t),Bo(),Gl(e,r),Jo(e,n)}};function ai(e,t,n,r,i,l,o){return\"function\"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,l,o):!t.prototype||!t.prototype.isPureReactComponent||(!en(n,r)||!en(i,l))}function ui(e,t,n){var r=!1,i=Nr,l=t.contextType;return\"object\"===typeof l&&null!==l?l=Wl(l):(i=zr(t)?Lr:Or.current,l=(r=null!==(r=t.contextTypes)&&void 0!==r)?Mr(e,i):Nr),t=new t(n,l),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=oi,e.stateNode=t,t._reactInternalFiber=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=l),t}function ci(e,t,n,r){e=t.state,\"function\"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),\"function\"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&oi.enqueueReplaceState(t,t.state,null)}function si(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=ii;var l=t.contextType;\"object\"===typeof l&&null!==l?i.context=Wl(l):(l=zr(t)?Lr:Or.current,i.context=Mr(e,l)),null!==(l=e.updateQueue)&&(to(e,l,n,i,r),i.state=e.memoizedState),\"function\"===typeof(l=t.getDerivedStateFromProps)&&(li(e,t,l,n),i.state=e.memoizedState),\"function\"===typeof t.getDerivedStateFromProps||\"function\"===typeof i.getSnapshotBeforeUpdate||\"function\"!==typeof i.UNSAFE_componentWillMount&&\"function\"!==typeof i.componentWillMount||(t=i.state,\"function\"===typeof i.componentWillMount&&i.componentWillMount(),\"function\"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&oi.enqueueReplaceState(i,i.state,null),null!==(l=e.updateQueue)&&(to(e,l,n,i,r),i.state=e.memoizedState)),\"function\"===typeof i.componentDidMount&&(e.effectTag|=4)}var fi=Array.isArray;function di(e,t,n){if(null!==(e=n.ref)&&\"function\"!==typeof e&&\"object\"!==typeof e){if(n._owner){n=n._owner;var r=void 0;n&&(1!==n.tag&&o(\"309\"),r=n.stateNode),r||o(\"147\",e);var i=\"\"+e;return null!==t&&null!==t.ref&&\"function\"===typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=r.refs;t===ii&&(t=r.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}\"string\"!==typeof e&&o(\"284\"),n._owner||o(\"290\",e)}return e}function pi(e,t){\"textarea\"!==e.type&&o(\"31\",\"[object Object]\"===Object.prototype.toString.call(t)?\"object with keys {\"+Object.keys(t).join(\", \")+\"}\":t,\"\")}function mi(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t,n){return(e=Kr(e,t)).index=0,e.sibling=null,e}function l(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.effectTag=2,n):r:(t.effectTag=2,n):n}function a(t){return e&&null===t.alternate&&(t.effectTag=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Gr(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=di(e,t,n),r.return=e,r):((r=qr(n.type,n.key,n.props,null,e.mode,r)).ref=di(e,t,n),r.return=e,r)}function s(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Jr(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function f(e,t,n,r,l){return null===t||7!==t.tag?((t=Yr(n,e.mode,r,l)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if(\"string\"===typeof t||\"number\"===typeof t)return(t=Gr(\"\"+t,e.mode,n)).return=e,t;if(\"object\"===typeof t&&null!==t){switch(t.$$typeof){case Ke:return(n=qr(t.type,t.key,t.props,null,e.mode,n)).ref=di(e,null,t),n.return=e,n;case qe:return(t=Jr(t,e.mode,n)).return=e,t}if(fi(t)||ot(t))return(t=Yr(t,e.mode,n,null)).return=e,t;pi(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if(\"string\"===typeof n||\"number\"===typeof n)return null!==i?null:u(e,t,\"\"+n,r);if(\"object\"===typeof n&&null!==n){switch(n.$$typeof){case Ke:return n.key===i?n.type===Ye?f(e,t,n.props.children,r,i):c(e,t,n,r):null;case qe:return n.key===i?s(e,t,n,r):null}if(fi(n)||ot(n))return null!==i?null:f(e,t,n,r,null);pi(e,n)}return null}function m(e,t,n,r,i){if(\"string\"===typeof r||\"number\"===typeof r)return u(t,e=e.get(n)||null,\"\"+r,i);if(\"object\"===typeof r&&null!==r){switch(r.$$typeof){case Ke:return e=e.get(null===r.key?n:r.key)||null,r.type===Ye?f(t,e,r.props.children,i,r.key):c(t,e,r,i);case qe:return s(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(fi(r)||ot(r))return f(t,e=e.get(n)||null,r,i,null);pi(t,r)}return null}function h(i,o,a,u){for(var c=null,s=null,f=o,h=o=0,v=null;null!==f&&h<a.length;h++){f.index>h?(v=f,f=null):v=f.sibling;var y=p(i,f,a[h],u);if(null===y){null===f&&(f=v);break}e&&f&&null===y.alternate&&t(i,f),o=l(y,o,h),null===s?c=y:s.sibling=y,s=y,f=v}if(h===a.length)return n(i,f),c;if(null===f){for(;h<a.length;h++)(f=d(i,a[h],u))&&(o=l(f,o,h),null===s?c=f:s.sibling=f,s=f);return c}for(f=r(i,f);h<a.length;h++)(v=m(f,i,h,a[h],u))&&(e&&null!==v.alternate&&f.delete(null===v.key?h:v.key),o=l(v,o,h),null===s?c=v:s.sibling=v,s=v);return e&&f.forEach(function(e){return t(i,e)}),c}function v(i,a,u,c){var s=ot(u);\"function\"!==typeof s&&o(\"150\"),null==(u=s.call(u))&&o(\"151\");for(var f=s=null,h=a,v=a=0,y=null,g=u.next();null!==h&&!g.done;v++,g=u.next()){h.index>v?(y=h,h=null):y=h.sibling;var b=p(i,h,g.value,c);if(null===b){h||(h=y);break}e&&h&&null===b.alternate&&t(i,h),a=l(b,a,v),null===f?s=b:f.sibling=b,f=b,h=y}if(g.done)return n(i,h),s;if(null===h){for(;!g.done;v++,g=u.next())null!==(g=d(i,g.value,c))&&(a=l(g,a,v),null===f?s=g:f.sibling=g,f=g);return s}for(h=r(i,h);!g.done;v++,g=u.next())null!==(g=m(h,i,v,g.value,c))&&(e&&null!==g.alternate&&h.delete(null===g.key?v:g.key),a=l(g,a,v),null===f?s=g:f.sibling=g,f=g);return e&&h.forEach(function(e){return t(i,e)}),s}return function(e,r,l,u){var c=\"object\"===typeof l&&null!==l&&l.type===Ye&&null===l.key;c&&(l=l.props.children);var s=\"object\"===typeof l&&null!==l;if(s)switch(l.$$typeof){case Ke:e:{for(s=l.key,c=r;null!==c;){if(c.key===s){if(7===c.tag?l.type===Ye:c.elementType===l.type){n(e,c.sibling),(r=i(c,l.type===Ye?l.props.children:l.props)).ref=di(e,c,l),r.return=e,e=r;break e}n(e,c);break}t(e,c),c=c.sibling}l.type===Ye?((r=Yr(l.props.children,e.mode,u,l.key)).return=e,e=r):((u=qr(l.type,l.key,l.props,null,e.mode,u)).ref=di(e,r,l),u.return=e,e=u)}return a(e);case qe:e:{for(c=l.key;null!==r;){if(r.key===c){if(4===r.tag&&r.stateNode.containerInfo===l.containerInfo&&r.stateNode.implementation===l.implementation){n(e,r.sibling),(r=i(r,l.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Jr(l,e.mode,u)).return=e,e=r}return a(e)}if(\"string\"===typeof l||\"number\"===typeof l)return l=\"\"+l,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,l)).return=e,e=r):(n(e,r),(r=Gr(l,e.mode,u)).return=e,e=r),a(e);if(fi(l))return h(e,r,l,u);if(ot(l))return v(e,r,l,u);if(s&&pi(e,l),\"undefined\"===typeof l&&!c)switch(e.tag){case 1:case 0:o(\"152\",(u=e.type).displayName||u.name||\"Component\")}return n(e,r)}}var hi=mi(!0),vi=mi(!1),yi={},gi={current:yi},bi={current:yi},wi={current:yi};function ki(e){return e===yi&&o(\"174\"),e}function xi(e,t){Pr(wi,t),Pr(bi,e),Pr(gi,yi);var n=t.nodeType;switch(n){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:tr(null,\"\");break;default:t=tr(t=(n=8===n?t.parentNode:t).namespaceURI||null,n=n.tagName)}Cr(gi),Pr(gi,t)}function Ti(e){Cr(gi),Cr(bi),Cr(wi)}function _i(e){ki(wi.current);var t=ki(gi.current),n=tr(t,e.type);t!==n&&(Pr(bi,e),Pr(gi,n))}function Si(e){bi.current===e&&(Cr(gi),Cr(bi))}var Ei=0,Ci=2,Pi=4,Ni=8,Oi=16,Ri=32,Li=64,Mi=128,zi=He.ReactCurrentDispatcher,Ii=0,Ui=null,Fi=null,Di=null,Ai=null,ji=null,Wi=null,Vi=0,Bi=null,Hi=0,$i=!1,Qi=null,Ki=0;function qi(){o(\"307\")}function Yi(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Jt(e[n],t[n]))return!1;return!0}function Xi(e,t,n,r,i,l){if(Ii=l,Ui=t,Di=null!==e?e.memoizedState:null,zi.current=null===Di?cl:sl,t=n(r,i),$i){do{$i=!1,Ki+=1,Di=null!==e?e.memoizedState:null,Wi=Ai,Bi=ji=Fi=null,zi.current=sl,t=n(r,i)}while($i);Qi=null,Ki=0}return zi.current=ul,(e=Ui).memoizedState=Ai,e.expirationTime=Vi,e.updateQueue=Bi,e.effectTag|=Hi,e=null!==Fi&&null!==Fi.next,Ii=0,Wi=ji=Ai=Di=Fi=Ui=null,Vi=0,Bi=null,Hi=0,e&&o(\"300\"),t}function Gi(){zi.current=ul,Ii=0,Wi=ji=Ai=Di=Fi=Ui=null,Vi=0,Bi=null,Hi=0,$i=!1,Qi=null,Ki=0}function Ji(){var e={memoizedState:null,baseState:null,queue:null,baseUpdate:null,next:null};return null===ji?Ai=ji=e:ji=ji.next=e,ji}function Zi(){if(null!==Wi)Wi=(ji=Wi).next,Di=null!==(Fi=Di)?Fi.next:null;else{null===Di&&o(\"310\");var e={memoizedState:(Fi=Di).memoizedState,baseState:Fi.baseState,queue:Fi.queue,baseUpdate:Fi.baseUpdate,next:null};ji=null===ji?Ai=e:ji.next=e,Di=Fi.next}return ji}function el(e,t){return\"function\"===typeof t?t(e):t}function tl(e){var t=Zi(),n=t.queue;if(null===n&&o(\"311\"),0<Ki){var r=n.dispatch;if(null!==Qi){var i=Qi.get(n);if(void 0!==i){Qi.delete(n);var l=t.memoizedState;do{l=e(l,i.action),i=i.next}while(null!==i);return Jt(l,t.memoizedState)||(kl=!0),t.memoizedState=l,t.baseUpdate===n.last&&(t.baseState=l),[l,r]}}return[t.memoizedState,r]}r=n.last;var a=t.baseUpdate;if(l=t.baseState,null!==a?(null!==r&&(r.next=null),r=a.next):r=null!==r?r.next:null,null!==r){var u=i=null,c=r,s=!1;do{var f=c.expirationTime;f<Ii?(s||(s=!0,u=a,i=l),f>Vi&&(Vi=f)):l=c.eagerReducer===e?c.eagerState:e(l,c.action),a=c,c=c.next}while(null!==c&&c!==r);s||(u=a,i=l),Jt(l,t.memoizedState)||(kl=!0),t.memoizedState=l,t.baseUpdate=u,t.baseState=i,n.eagerReducer=e,n.eagerState=l}return[t.memoizedState,n.dispatch]}function nl(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===Bi?(Bi={lastEffect:null}).lastEffect=e.next=e:null===(t=Bi.lastEffect)?Bi.lastEffect=e.next=e:(n=t.next,t.next=e,e.next=n,Bi.lastEffect=e),e}function rl(e,t,n,r){var i=Ji();Hi|=e,i.memoizedState=nl(t,n,void 0,void 0===r?null:r)}function il(e,t,n,r){var i=Zi();r=void 0===r?null:r;var l=void 0;if(null!==Fi){var o=Fi.memoizedState;if(l=o.destroy,null!==r&&Yi(r,o.deps))return void nl(Ei,n,l,r)}Hi|=e,i.memoizedState=nl(t,n,l,r)}function ll(e,t){return\"function\"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function ol(){}function al(e,t,n){25>Ki||o(\"301\");var r=e.alternate;if(e===Ui||null!==r&&r===Ui)if($i=!0,e={expirationTime:Ii,action:n,eagerReducer:null,eagerState:null,next:null},null===Qi&&(Qi=new Map),void 0===(n=Qi.get(t)))Qi.set(t,e);else{for(t=n;null!==t.next;)t=t.next;t.next=e}else{Bo();var i=xa(),l={expirationTime:i=Yo(i,e),action:n,eagerReducer:null,eagerState:null,next:null},a=t.last;if(null===a)l.next=l;else{var u=a.next;null!==u&&(l.next=u),a.next=l}if(t.last=l,0===e.expirationTime&&(null===r||0===r.expirationTime)&&null!==(r=t.eagerReducer))try{var c=t.eagerState,s=r(c,n);if(l.eagerReducer=r,l.eagerState=s,Jt(s,c))return}catch(f){}Jo(e,i)}}var ul={readContext:Wl,useCallback:qi,useContext:qi,useEffect:qi,useImperativeHandle:qi,useLayoutEffect:qi,useMemo:qi,useReducer:qi,useRef:qi,useState:qi,useDebugValue:qi},cl={readContext:Wl,useCallback:function(e,t){return Ji().memoizedState=[e,void 0===t?null:t],e},useContext:Wl,useEffect:function(e,t){return rl(516,Mi|Li,e,t)},useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,rl(4,Pi|Ri,ll.bind(null,t,e),n)},useLayoutEffect:function(e,t){return rl(4,Pi|Ri,e,t)},useMemo:function(e,t){var n=Ji();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ji();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={last:null,dispatch:null,eagerReducer:e,eagerState:t}).dispatch=al.bind(null,Ui,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ji().memoizedState=e},useState:function(e){var t=Ji();return\"function\"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={last:null,dispatch:null,eagerReducer:el,eagerState:e}).dispatch=al.bind(null,Ui,e),[t.memoizedState,e]},useDebugValue:ol},sl={readContext:Wl,useCallback:function(e,t){var n=Zi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Yi(t,r[1])?r[0]:(n.memoizedState=[e,t],e)},useContext:Wl,useEffect:function(e,t){return il(516,Mi|Li,e,t)},useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,il(4,Pi|Ri,ll.bind(null,t,e),n)},useLayoutEffect:function(e,t){return il(4,Pi|Ri,e,t)},useMemo:function(e,t){var n=Zi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Yi(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)},useReducer:tl,useRef:function(){return Zi().memoizedState},useState:function(e){return tl(el)},useDebugValue:ol},fl=null,dl=null,pl=!1;function ml(e,t){var n=$r(5,null,null,0);n.elementType=\"DELETED\",n.type=\"DELETED\",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function hl(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=\"\"===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function vl(e){if(pl){var t=dl;if(t){var n=t;if(!hl(e,t)){if(!(t=Tr(n))||!hl(e,t))return e.effectTag|=2,pl=!1,void(fl=e);ml(fl,n)}fl=e,dl=_r(t)}else e.effectTag|=2,pl=!1,fl=e}}function yl(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&18!==e.tag;)e=e.return;fl=e}function gl(e){if(e!==fl)return!1;if(!pl)return yl(e),pl=!0,!1;var t=e.type;if(5!==e.tag||\"head\"!==t&&\"body\"!==t&&!gr(t,e.memoizedProps))for(t=dl;t;)ml(e,t),t=Tr(t);return yl(e),dl=fl?Tr(e.stateNode):null,!0}function bl(){dl=fl=null,pl=!1}var wl=He.ReactCurrentOwner,kl=!1;function xl(e,t,n,r){t.child=null===e?vi(t,null,n,r):hi(t,e.child,n,r)}function Tl(e,t,n,r,i){n=n.render;var l=t.ref;return jl(t,i),r=Xi(e,t,n,r,l,i),null===e||kl?(t.effectTag|=1,xl(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Ll(e,t,i))}function _l(e,t,n,r,i,l){if(null===e){var o=n.type;return\"function\"!==typeof o||Qr(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=qr(n.type,null,r,null,t.mode,l)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Sl(e,t,o,r,i,l))}return o=e.child,i<l&&(i=o.memoizedProps,(n=null!==(n=n.compare)?n:en)(i,r)&&e.ref===t.ref)?Ll(e,t,l):(t.effectTag|=1,(e=Kr(o,r)).ref=t.ref,e.return=t,t.child=e)}function Sl(e,t,n,r,i,l){return null!==e&&en(e.memoizedProps,r)&&e.ref===t.ref&&(kl=!1,i<l)?Ll(e,t,l):Cl(e,t,n,r,l)}function El(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function Cl(e,t,n,r,i){var l=zr(n)?Lr:Or.current;return l=Mr(t,l),jl(t,i),n=Xi(e,t,n,r,l,i),null===e||kl?(t.effectTag|=1,xl(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Ll(e,t,i))}function Pl(e,t,n,r,i){if(zr(n)){var l=!0;Ar(t)}else l=!1;if(jl(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),ui(t,n,r),si(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,a=t.memoizedProps;o.props=a;var u=o.context,c=n.contextType;\"object\"===typeof c&&null!==c?c=Wl(c):c=Mr(t,c=zr(n)?Lr:Or.current);var s=n.getDerivedStateFromProps,f=\"function\"===typeof s||\"function\"===typeof o.getSnapshotBeforeUpdate;f||\"function\"!==typeof o.UNSAFE_componentWillReceiveProps&&\"function\"!==typeof o.componentWillReceiveProps||(a!==r||u!==c)&&ci(t,o,r,c),Ql=!1;var d=t.memoizedState;u=o.state=d;var p=t.updateQueue;null!==p&&(to(t,p,r,o,i),u=t.memoizedState),a!==r||d!==u||Rr.current||Ql?(\"function\"===typeof s&&(li(t,n,s,r),u=t.memoizedState),(a=Ql||ai(t,n,a,r,d,u,c))?(f||\"function\"!==typeof o.UNSAFE_componentWillMount&&\"function\"!==typeof o.componentWillMount||(\"function\"===typeof o.componentWillMount&&o.componentWillMount(),\"function\"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),\"function\"===typeof o.componentDidMount&&(t.effectTag|=4)):(\"function\"===typeof o.componentDidMount&&(t.effectTag|=4),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=c,r=a):(\"function\"===typeof o.componentDidMount&&(t.effectTag|=4),r=!1)}else o=t.stateNode,a=t.memoizedProps,o.props=t.type===t.elementType?a:ri(t.type,a),u=o.context,\"object\"===typeof(c=n.contextType)&&null!==c?c=Wl(c):c=Mr(t,c=zr(n)?Lr:Or.current),(f=\"function\"===typeof(s=n.getDerivedStateFromProps)||\"function\"===typeof o.getSnapshotBeforeUpdate)||\"function\"!==typeof o.UNSAFE_componentWillReceiveProps&&\"function\"!==typeof o.componentWillReceiveProps||(a!==r||u!==c)&&ci(t,o,r,c),Ql=!1,u=t.memoizedState,d=o.state=u,null!==(p=t.updateQueue)&&(to(t,p,r,o,i),d=t.memoizedState),a!==r||u!==d||Rr.current||Ql?(\"function\"===typeof s&&(li(t,n,s,r),d=t.memoizedState),(s=Ql||ai(t,n,a,r,u,d,c))?(f||\"function\"!==typeof o.UNSAFE_componentWillUpdate&&\"function\"!==typeof o.componentWillUpdate||(\"function\"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,d,c),\"function\"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,d,c)),\"function\"===typeof o.componentDidUpdate&&(t.effectTag|=4),\"function\"===typeof o.getSnapshotBeforeUpdate&&(t.effectTag|=256)):(\"function\"!==typeof o.componentDidUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),\"function\"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),t.memoizedProps=r,t.memoizedState=d),o.props=r,o.state=d,o.context=c,r=s):(\"function\"!==typeof o.componentDidUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),\"function\"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),r=!1);return Nl(e,t,n,r,l,i)}function Nl(e,t,n,r,i,l){El(e,t);var o=0!==(64&t.effectTag);if(!r&&!o)return i&&jr(t,n,!1),Ll(e,t,l);r=t.stateNode,wl.current=t;var a=o&&\"function\"!==typeof n.getDerivedStateFromError?null:r.render();return t.effectTag|=1,null!==e&&o?(t.child=hi(t,e.child,null,l),t.child=hi(t,null,a,l)):xl(e,t,a,l),t.memoizedState=r.state,i&&jr(t,n,!0),t.child}function Ol(e){var t=e.stateNode;t.pendingContext?Fr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Fr(0,t.context,!1),xi(e,t.containerInfo)}function Rl(e,t,n){var r=t.mode,i=t.pendingProps,l=t.memoizedState;if(0===(64&t.effectTag)){l=null;var o=!1}else l={timedOutAt:null!==l?l.timedOutAt:0},o=!0,t.effectTag&=-65;if(null===e)if(o){var a=i.fallback;e=Yr(null,r,0,null),0===(1&t.mode)&&(e.child=null!==t.memoizedState?t.child.child:t.child),r=Yr(a,r,n,null),e.sibling=r,(n=e).return=r.return=t}else n=r=vi(t,null,i.children,n);else null!==e.memoizedState?(a=(r=e.child).sibling,o?(n=i.fallback,i=Kr(r,r.pendingProps),0===(1&t.mode)&&((o=null!==t.memoizedState?t.child.child:t.child)!==r.child&&(i.child=o)),r=i.sibling=Kr(a,n,a.expirationTime),n=i,i.childExpirationTime=0,n.return=r.return=t):n=r=hi(t,r.child,i.children,n)):(a=e.child,o?(o=i.fallback,(i=Yr(null,r,0,null)).child=a,0===(1&t.mode)&&(i.child=null!==t.memoizedState?t.child.child:t.child),(r=i.sibling=Yr(o,r,n,null)).effectTag|=2,n=i,i.childExpirationTime=0,n.return=r.return=t):r=n=hi(t,a,i.children,n)),t.stateNode=e.stateNode;return t.memoizedState=l,t.child=n,r}function Ll(e,t,n){if(null!==e&&(t.contextDependencies=e.contextDependencies),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child&&o(\"153\"),null!==t.child){for(n=Kr(e=t.child,e.pendingProps,e.expirationTime),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Kr(e,e.pendingProps,e.expirationTime)).return=t;n.sibling=null}return t.child}function Ml(e,t,n){var r=t.expirationTime;if(null!==e){if(e.memoizedProps!==t.pendingProps||Rr.current)kl=!0;else if(r<n){switch(kl=!1,t.tag){case 3:Ol(t),bl();break;case 5:_i(t);break;case 1:zr(t.type)&&Ar(t);break;case 4:xi(t,t.stateNode.containerInfo);break;case 10:Dl(t,t.memoizedProps.value);break;case 13:if(null!==t.memoizedState)return 0!==(r=t.child.childExpirationTime)&&r>=n?Rl(e,t,n):null!==(t=Ll(e,t,n))?t.sibling:null}return Ll(e,t,n)}}else kl=!1;switch(t.expirationTime=0,t.tag){case 2:r=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps;var i=Mr(t,Or.current);if(jl(t,n),i=Xi(null,t,r,e,i,n),t.effectTag|=1,\"object\"===typeof i&&null!==i&&\"function\"===typeof i.render&&void 0===i.$$typeof){if(t.tag=1,Gi(),zr(r)){var l=!0;Ar(t)}else l=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null;var a=r.getDerivedStateFromProps;\"function\"===typeof a&&li(t,r,a,e),i.updater=oi,t.stateNode=i,i._reactInternalFiber=t,si(t,r,e,n),t=Nl(null,t,r,!0,l,n)}else t.tag=0,xl(null,t,i,n),t=t.child;return t;case 16:switch(i=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),l=t.pendingProps,e=function(e){var t=e._result;switch(e._status){case 1:return t;case 2:case 0:throw t;default:switch(e._status=0,(t=(t=e._ctor)()).then(function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)},function(t){0===e._status&&(e._status=2,e._result=t)}),e._status){case 1:return e._result;case 2:throw e._result}throw e._result=t,t}}(i),t.type=e,i=t.tag=function(e){if(\"function\"===typeof e)return Qr(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===tt)return 11;if(e===rt)return 14}return 2}(e),l=ri(e,l),a=void 0,i){case 0:a=Cl(null,t,e,l,n);break;case 1:a=Pl(null,t,e,l,n);break;case 11:a=Tl(null,t,e,l,n);break;case 14:a=_l(null,t,e,ri(e.type,l),r,n);break;default:o(\"306\",e,\"\")}return a;case 0:return r=t.type,i=t.pendingProps,Cl(e,t,r,i=t.elementType===r?i:ri(r,i),n);case 1:return r=t.type,i=t.pendingProps,Pl(e,t,r,i=t.elementType===r?i:ri(r,i),n);case 3:return Ol(t),null===(r=t.updateQueue)&&o(\"282\"),i=null!==(i=t.memoizedState)?i.element:null,to(t,r,t.pendingProps,null,n),(r=t.memoizedState.element)===i?(bl(),t=Ll(e,t,n)):(i=t.stateNode,(i=(null===e||null===e.child)&&i.hydrate)&&(dl=_r(t.stateNode.containerInfo),fl=t,i=pl=!0),i?(t.effectTag|=2,t.child=vi(t,null,r,n)):(xl(e,t,r,n),bl()),t=t.child),t;case 5:return _i(t),null===e&&vl(t),r=t.type,i=t.pendingProps,l=null!==e?e.memoizedProps:null,a=i.children,gr(r,i)?a=null:null!==l&&gr(r,l)&&(t.effectTag|=16),El(e,t),1!==n&&1&t.mode&&i.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(xl(e,t,a,n),t=t.child),t;case 6:return null===e&&vl(t),null;case 13:return Rl(e,t,n);case 4:return xi(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=hi(t,null,r,n):xl(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Tl(e,t,r,i=t.elementType===r?i:ri(r,i),n);case 7:return xl(e,t,t.pendingProps,n),t.child;case 8:case 12:return xl(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,a=t.memoizedProps,Dl(t,l=i.value),null!==a){var u=a.value;if(0===(l=Jt(u,l)?0:0|(\"function\"===typeof r._calculateChangedBits?r._calculateChangedBits(u,l):1073741823))){if(a.children===i.children&&!Rr.current){t=Ll(e,t,n);break e}}else for(null!==(u=t.child)&&(u.return=t);null!==u;){var c=u.contextDependencies;if(null!==c){a=u.child;for(var s=c.first;null!==s;){if(s.context===r&&0!==(s.observedBits&l)){1===u.tag&&((s=Yl(n)).tag=Hl,Gl(u,s)),u.expirationTime<n&&(u.expirationTime=n),null!==(s=u.alternate)&&s.expirationTime<n&&(s.expirationTime=n),s=n;for(var f=u.return;null!==f;){var d=f.alternate;if(f.childExpirationTime<s)f.childExpirationTime=s,null!==d&&d.childExpirationTime<s&&(d.childExpirationTime=s);else{if(!(null!==d&&d.childExpirationTime<s))break;d.childExpirationTime=s}f=f.return}c.expirationTime<n&&(c.expirationTime=n);break}s=s.next}}else a=10===u.tag&&u.type===t.type?null:u.child;if(null!==a)a.return=u;else for(a=u;null!==a;){if(a===t){a=null;break}if(null!==(u=a.sibling)){u.return=a.return,a=u;break}a=a.return}u=a}}xl(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(l=t.pendingProps).children,jl(t,n),r=r(i=Wl(i,l.unstable_observedBits)),t.effectTag|=1,xl(e,t,r,n),t.child;case 14:return l=ri(i=t.type,t.pendingProps),_l(e,t,i,l=ri(i.type,l),r,n);case 15:return Sl(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:ri(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,zr(r)?(e=!0,Ar(t)):e=!1,jl(t,n),ui(t,r,i),si(t,r,i,n),Nl(null,t,r,!0,e,n)}o(\"156\")}var zl={current:null},Il=null,Ul=null,Fl=null;function Dl(e,t){var n=e.type._context;Pr(zl,n._currentValue),n._currentValue=t}function Al(e){var t=zl.current;Cr(zl),e.type._context._currentValue=t}function jl(e,t){Il=e,Fl=Ul=null;var n=e.contextDependencies;null!==n&&n.expirationTime>=t&&(kl=!0),e.contextDependencies=null}function Wl(e,t){return Fl!==e&&!1!==t&&0!==t&&(\"number\"===typeof t&&1073741823!==t||(Fl=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Ul?(null===Il&&o(\"308\"),Ul=t,Il.contextDependencies={first:t,expirationTime:0}):Ul=Ul.next=t),e._currentValue}var Vl=0,Bl=1,Hl=2,$l=3,Ql=!1;function Kl(e){return{baseState:e,firstUpdate:null,lastUpdate:null,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function ql(e){return{baseState:e.baseState,firstUpdate:e.firstUpdate,lastUpdate:e.lastUpdate,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function Yl(e){return{expirationTime:e,tag:Vl,payload:null,callback:null,next:null,nextEffect:null}}function Xl(e,t){null===e.lastUpdate?e.firstUpdate=e.lastUpdate=t:(e.lastUpdate.next=t,e.lastUpdate=t)}function Gl(e,t){var n=e.alternate;if(null===n){var r=e.updateQueue,i=null;null===r&&(r=e.updateQueue=Kl(e.memoizedState))}else r=e.updateQueue,i=n.updateQueue,null===r?null===i?(r=e.updateQueue=Kl(e.memoizedState),i=n.updateQueue=Kl(n.memoizedState)):r=e.updateQueue=ql(i):null===i&&(i=n.updateQueue=ql(r));null===i||r===i?Xl(r,t):null===r.lastUpdate||null===i.lastUpdate?(Xl(r,t),Xl(i,t)):(Xl(r,t),i.lastUpdate=t)}function Jl(e,t){var n=e.updateQueue;null===(n=null===n?e.updateQueue=Kl(e.memoizedState):Zl(e,n)).lastCapturedUpdate?n.firstCapturedUpdate=n.lastCapturedUpdate=t:(n.lastCapturedUpdate.next=t,n.lastCapturedUpdate=t)}function Zl(e,t){var n=e.alternate;return null!==n&&t===n.updateQueue&&(t=e.updateQueue=ql(t)),t}function eo(e,t,n,r,l,o){switch(n.tag){case Bl:return\"function\"===typeof(e=n.payload)?e.call(o,r,l):e;case $l:e.effectTag=-2049&e.effectTag|64;case Vl:if(null===(l=\"function\"===typeof(e=n.payload)?e.call(o,r,l):e)||void 0===l)break;return i({},r,l);case Hl:Ql=!0}return r}function to(e,t,n,r,i){Ql=!1;for(var l=(t=Zl(e,t)).baseState,o=null,a=0,u=t.firstUpdate,c=l;null!==u;){var s=u.expirationTime;s<i?(null===o&&(o=u,l=c),a<s&&(a=s)):(c=eo(e,0,u,c,n,r),null!==u.callback&&(e.effectTag|=32,u.nextEffect=null,null===t.lastEffect?t.firstEffect=t.lastEffect=u:(t.lastEffect.nextEffect=u,t.lastEffect=u))),u=u.next}for(s=null,u=t.firstCapturedUpdate;null!==u;){var f=u.expirationTime;f<i?(null===s&&(s=u,null===o&&(l=c)),a<f&&(a=f)):(c=eo(e,0,u,c,n,r),null!==u.callback&&(e.effectTag|=32,u.nextEffect=null,null===t.lastCapturedEffect?t.firstCapturedEffect=t.lastCapturedEffect=u:(t.lastCapturedEffect.nextEffect=u,t.lastCapturedEffect=u))),u=u.next}null===o&&(t.lastUpdate=null),null===s?t.lastCapturedUpdate=null:e.effectTag|=32,null===o&&null===s&&(l=c),t.baseState=l,t.firstUpdate=o,t.firstCapturedUpdate=s,e.expirationTime=a,e.memoizedState=c}function no(e,t,n){null!==t.firstCapturedUpdate&&(null!==t.lastUpdate&&(t.lastUpdate.next=t.firstCapturedUpdate,t.lastUpdate=t.lastCapturedUpdate),t.firstCapturedUpdate=t.lastCapturedUpdate=null),ro(t.firstEffect,n),t.firstEffect=t.lastEffect=null,ro(t.firstCapturedEffect,n),t.firstCapturedEffect=t.lastCapturedEffect=null}function ro(e,t){for(;null!==e;){var n=e.callback;if(null!==n){e.callback=null;var r=t;\"function\"!==typeof n&&o(\"191\",n),n.call(r)}e=e.nextEffect}}function io(e,t){return{value:e,source:t,stack:ut(t)}}function lo(e){e.effectTag|=4}var oo=void 0,ao=void 0,uo=void 0,co=void 0;oo=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},ao=function(){},uo=function(e,t,n,r,l){var o=e.memoizedProps;if(o!==r){var a=t.stateNode;switch(ki(gi.current),e=null,n){case\"input\":o=bt(a,o),r=bt(a,r),e=[];break;case\"option\":o=Kn(a,o),r=Kn(a,r),e=[];break;case\"select\":o=i({},o,{value:void 0}),r=i({},r,{value:void 0}),e=[];break;case\"textarea\":o=Yn(a,o),r=Yn(a,r),e=[];break;default:\"function\"!==typeof o.onClick&&\"function\"===typeof r.onClick&&(a.onclick=mr)}fr(n,r),a=n=void 0;var u=null;for(n in o)if(!r.hasOwnProperty(n)&&o.hasOwnProperty(n)&&null!=o[n])if(\"style\"===n){var c=o[n];for(a in c)c.hasOwnProperty(a)&&(u||(u={}),u[a]=\"\")}else\"dangerouslySetInnerHTML\"!==n&&\"children\"!==n&&\"suppressContentEditableWarning\"!==n&&\"suppressHydrationWarning\"!==n&&\"autoFocus\"!==n&&(b.hasOwnProperty(n)?e||(e=[]):(e=e||[]).push(n,null));for(n in r){var s=r[n];if(c=null!=o?o[n]:void 0,r.hasOwnProperty(n)&&s!==c&&(null!=s||null!=c))if(\"style\"===n)if(c){for(a in c)!c.hasOwnProperty(a)||s&&s.hasOwnProperty(a)||(u||(u={}),u[a]=\"\");for(a in s)s.hasOwnProperty(a)&&c[a]!==s[a]&&(u||(u={}),u[a]=s[a])}else u||(e||(e=[]),e.push(n,u)),u=s;else\"dangerouslySetInnerHTML\"===n?(s=s?s.__html:void 0,c=c?c.__html:void 0,null!=s&&c!==s&&(e=e||[]).push(n,\"\"+s)):\"children\"===n?c===s||\"string\"!==typeof s&&\"number\"!==typeof s||(e=e||[]).push(n,\"\"+s):\"suppressContentEditableWarning\"!==n&&\"suppressHydrationWarning\"!==n&&(b.hasOwnProperty(n)?(null!=s&&pr(l,n),e||c===s||(e=[])):(e=e||[]).push(n,s))}u&&(e=e||[]).push(\"style\",u),l=e,(t.updateQueue=l)&&lo(t)}},co=function(e,t,n,r){n!==r&&lo(t)};var so=\"function\"===typeof WeakSet?WeakSet:Set;function fo(e,t){var n=t.source,r=t.stack;null===r&&null!==n&&(r=ut(n)),null!==n&&at(n.type),t=t.value,null!==e&&1===e.tag&&at(e.type);try{console.error(t)}catch(i){setTimeout(function(){throw i})}}function po(e){var t=e.ref;if(null!==t)if(\"function\"===typeof t)try{t(null)}catch(n){qo(e,n)}else t.current=null}function mo(e,t,n){if(null!==(n=null!==(n=n.updateQueue)?n.lastEffect:null)){var r=n=n.next;do{if((r.tag&e)!==Ei){var i=r.destroy;r.destroy=void 0,void 0!==i&&i()}(r.tag&t)!==Ei&&(i=r.create,r.destroy=i()),r=r.next}while(r!==n)}}function ho(e){switch(\"function\"===typeof Vr&&Vr(e),e.tag){case 0:case 11:case 14:case 15:var t=e.updateQueue;if(null!==t&&null!==(t=t.lastEffect)){var n=t=t.next;do{var r=n.destroy;if(void 0!==r){var i=e;try{r()}catch(l){qo(i,l)}}n=n.next}while(n!==t)}break;case 1:if(po(e),\"function\"===typeof(t=e.stateNode).componentWillUnmount)try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(l){qo(e,l)}break;case 5:po(e);break;case 4:go(e)}}function vo(e){return 5===e.tag||3===e.tag||4===e.tag}function yo(e){e:{for(var t=e.return;null!==t;){if(vo(t)){var n=t;break e}t=t.return}o(\"160\"),n=void 0}var r=t=void 0;switch(n.tag){case 5:t=n.stateNode,r=!1;break;case 3:case 4:t=n.stateNode.containerInfo,r=!0;break;default:o(\"161\")}16&n.effectTag&&(lr(t,\"\"),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||vo(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}for(var i=e;;){if(5===i.tag||6===i.tag)if(n)if(r){var l=t,a=i.stateNode,u=n;8===l.nodeType?l.parentNode.insertBefore(a,u):l.insertBefore(a,u)}else t.insertBefore(i.stateNode,n);else r?(a=t,u=i.stateNode,8===a.nodeType?(l=a.parentNode).insertBefore(u,a):(l=a).appendChild(u),null!==(a=a._reactRootContainer)&&void 0!==a||null!==l.onclick||(l.onclick=mr)):t.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===e)break;for(;null===i.sibling;){if(null===i.return||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}function go(e){for(var t=e,n=!1,r=void 0,i=void 0;;){if(!n){n=t.return;e:for(;;){switch(null===n&&o(\"160\"),n.tag){case 5:r=n.stateNode,i=!1;break e;case 3:case 4:r=n.stateNode.containerInfo,i=!0;break e}n=n.return}n=!0}if(5===t.tag||6===t.tag){e:for(var l=t,a=l;;)if(ho(a),null!==a.child&&4!==a.tag)a.child.return=a,a=a.child;else{if(a===l)break;for(;null===a.sibling;){if(null===a.return||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}i?(l=r,a=t.stateNode,8===l.nodeType?l.parentNode.removeChild(a):l.removeChild(a)):r.removeChild(t.stateNode)}else if(4===t.tag){if(null!==t.child){r=t.stateNode.containerInfo,i=!0,t.child.return=t,t=t.child;continue}}else if(ho(t),null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return;4===(t=t.return).tag&&(n=!1)}t.sibling.return=t.return,t=t.sibling}}function bo(e,t){switch(t.tag){case 0:case 11:case 14:case 15:mo(Pi,Ni,t);break;case 1:break;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps;e=null!==e?e.memoizedProps:r;var i=t.type,l=t.updateQueue;t.updateQueue=null,null!==l&&function(e,t,n,r,i){e[z]=i,\"input\"===n&&\"radio\"===i.type&&null!=i.name&&kt(e,i),dr(n,r),r=dr(n,i);for(var l=0;l<t.length;l+=2){var o=t[l],a=t[l+1];\"style\"===o?cr(e,a):\"dangerouslySetInnerHTML\"===o?ir(e,a):\"children\"===o?lr(e,a):yt(e,o,a,r)}switch(n){case\"input\":xt(e,i);break;case\"textarea\":Gn(e,i);break;case\"select\":t=e._wrapperState.wasMultiple,e._wrapperState.wasMultiple=!!i.multiple,null!=(n=i.value)?qn(e,!!i.multiple,n,!1):t!==!!i.multiple&&(null!=i.defaultValue?qn(e,!!i.multiple,i.defaultValue,!0):qn(e,!!i.multiple,i.multiple?[]:\"\",!1))}}(n,l,i,e,r)}break;case 6:null===t.stateNode&&o(\"162\"),t.stateNode.nodeValue=t.memoizedProps;break;case 3:case 12:break;case 13:if(n=t.memoizedState,r=void 0,e=t,null===n?r=!1:(r=!0,e=t.child,0===n.timedOutAt&&(n.timedOutAt=xa())),null!==e&&function(e,t){for(var n=e;;){if(5===n.tag){var r=n.stateNode;if(t)r.style.display=\"none\";else{r=n.stateNode;var i=n.memoizedProps.style;i=void 0!==i&&null!==i&&i.hasOwnProperty(\"display\")?i.display:null,r.style.display=ur(\"display\",i)}}else if(6===n.tag)n.stateNode.nodeValue=t?\"\":n.memoizedProps;else{if(13===n.tag&&null!==n.memoizedState){(r=n.child.sibling).return=n,n=r;continue}if(null!==n.child){n.child.return=n,n=n.child;continue}}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}(e,r),null!==(n=t.updateQueue)){t.updateQueue=null;var a=t.stateNode;null===a&&(a=t.stateNode=new so),n.forEach(function(e){var n=function(e,t){var n=e.stateNode;null!==n&&n.delete(t),t=Yo(t=xa(),e),null!==(e=Go(e,t))&&(Zr(e,t),0!==(t=e.expirationTime)&&Ta(e,t))}.bind(null,t,e);a.has(e)||(a.add(e),e.then(n,n))})}break;case 17:break;default:o(\"163\")}}var wo=\"function\"===typeof WeakMap?WeakMap:Map;function ko(e,t,n){(n=Yl(n)).tag=$l,n.payload={element:null};var r=t.value;return n.callback=function(){La(r),fo(e,t)},n}function xo(e,t,n){(n=Yl(n)).tag=$l;var r=e.type.getDerivedStateFromError;if(\"function\"===typeof r){var i=t.value;n.payload=function(){return r(i)}}var l=e.stateNode;return null!==l&&\"function\"===typeof l.componentDidCatch&&(n.callback=function(){\"function\"!==typeof r&&(null===Do?Do=new Set([this]):Do.add(this));var n=t.value,i=t.stack;fo(e,t),this.componentDidCatch(n,{componentStack:null!==i?i:\"\"})}),n}function To(e){switch(e.tag){case 1:zr(e.type)&&Ir();var t=e.effectTag;return 2048&t?(e.effectTag=-2049&t|64,e):null;case 3:return Ti(),Ur(),0!==(64&(t=e.effectTag))&&o(\"285\"),e.effectTag=-2049&t|64,e;case 5:return Si(e),null;case 13:return 2048&(t=e.effectTag)?(e.effectTag=-2049&t|64,e):null;case 18:return null;case 4:return Ti(),null;case 10:return Al(e),null;default:return null}}var _o=He.ReactCurrentDispatcher,So=He.ReactCurrentOwner,Eo=1073741822,Co=!1,Po=null,No=null,Oo=0,Ro=-1,Lo=!1,Mo=null,zo=!1,Io=null,Uo=null,Fo=null,Do=null;function Ao(){if(null!==Po)for(var e=Po.return;null!==e;){var t=e;switch(t.tag){case 1:var n=t.type.childContextTypes;null!==n&&void 0!==n&&Ir();break;case 3:Ti(),Ur();break;case 5:Si(t);break;case 4:Ti();break;case 10:Al(t)}e=e.return}No=null,Oo=0,Ro=-1,Lo=!1,Po=null}function jo(){for(;null!==Mo;){var e=Mo.effectTag;if(16&e&&lr(Mo.stateNode,\"\"),128&e){var t=Mo.alternate;null!==t&&(null!==(t=t.ref)&&(\"function\"===typeof t?t(null):t.current=null))}switch(14&e){case 2:yo(Mo),Mo.effectTag&=-3;break;case 6:yo(Mo),Mo.effectTag&=-3,bo(Mo.alternate,Mo);break;case 4:bo(Mo.alternate,Mo);break;case 8:go(e=Mo),e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,null!==(e=e.alternate)&&(e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null)}Mo=Mo.nextEffect}}function Wo(){for(;null!==Mo;){if(256&Mo.effectTag)e:{var e=Mo.alternate,t=Mo;switch(t.tag){case 0:case 11:case 15:mo(Ci,Ei,t);break e;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:ri(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}break e;case 3:case 5:case 6:case 4:case 17:break e;default:o(\"163\")}}Mo=Mo.nextEffect}}function Vo(e,t){for(;null!==Mo;){var n=Mo.effectTag;if(36&n){var r=Mo.alternate,i=Mo,l=t;switch(i.tag){case 0:case 11:case 15:mo(Oi,Ri,i);break;case 1:var a=i.stateNode;if(4&i.effectTag)if(null===r)a.componentDidMount();else{var u=i.elementType===i.type?r.memoizedProps:ri(i.type,r.memoizedProps);a.componentDidUpdate(u,r.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}null!==(r=i.updateQueue)&&no(0,r,a);break;case 3:if(null!==(r=i.updateQueue)){if(a=null,null!==i.child)switch(i.child.tag){case 5:a=i.child.stateNode;break;case 1:a=i.child.stateNode}no(0,r,a)}break;case 5:l=i.stateNode,null===r&&4&i.effectTag&&yr(i.type,i.memoizedProps)&&l.focus();break;case 6:case 4:case 12:case 13:case 17:break;default:o(\"163\")}}128&n&&(null!==(i=Mo.ref)&&(l=Mo.stateNode,\"function\"===typeof i?i(l):i.current=l)),512&n&&(Io=e),Mo=Mo.nextEffect}}function Bo(){null!==Uo&&xr(Uo),null!==Fo&&Fo()}function Ho(e,t){zo=Co=!0,e.current===t&&o(\"177\");var n=e.pendingCommitExpirationTime;0===n&&o(\"261\"),e.pendingCommitExpirationTime=0;var r=t.expirationTime,i=t.childExpirationTime;for(function(e,t){if(e.didError=!1,0===t)e.earliestPendingTime=0,e.latestPendingTime=0,e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0;else{t<e.latestPingedTime&&(e.latestPingedTime=0);var n=e.latestPendingTime;0!==n&&(n>t?e.earliestPendingTime=e.latestPendingTime=0:e.earliestPendingTime>t&&(e.earliestPendingTime=e.latestPendingTime)),0===(n=e.earliestSuspendedTime)?Zr(e,t):t<e.latestSuspendedTime?(e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0,Zr(e,t)):t>n&&Zr(e,t)}ni(0,e)}(e,i>r?i:r),So.current=null,r=void 0,1<t.effectTag?null!==t.lastEffect?(t.lastEffect.nextEffect=t,r=t.firstEffect):r=t:r=t.firstEffect,hr=_n,vr=function(){var e=Un();if(Fn(e)){if(\"selectionStart\"in e)var t={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(t=(t=e.ownerDocument)&&t.defaultView||window).getSelection&&t.getSelection();if(n&&0!==n.rangeCount){t=n.anchorNode;var r=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{t.nodeType,i.nodeType}catch(p){t=null;break e}var l=0,o=-1,a=-1,u=0,c=0,s=e,f=null;t:for(;;){for(var d;s!==t||0!==r&&3!==s.nodeType||(o=l+r),s!==i||0!==n&&3!==s.nodeType||(a=l+n),3===s.nodeType&&(l+=s.nodeValue.length),null!==(d=s.firstChild);)f=s,s=d;for(;;){if(s===e)break t;if(f===t&&++u===r&&(o=l),f===i&&++c===n&&(a=l),null!==(d=s.nextSibling))break;f=(s=f).parentNode}s=d}t=-1===o||-1===a?null:{start:o,end:a}}else t=null}t=t||{start:0,end:0}}else t=null;return{focusedElem:e,selectionRange:t}}(),_n=!1,Mo=r;null!==Mo;){i=!1;var a=void 0;try{Wo()}catch(c){i=!0,a=c}i&&(null===Mo&&o(\"178\"),qo(Mo,a),null!==Mo&&(Mo=Mo.nextEffect))}for(Mo=r;null!==Mo;){i=!1,a=void 0;try{jo()}catch(c){i=!0,a=c}i&&(null===Mo&&o(\"178\"),qo(Mo,a),null!==Mo&&(Mo=Mo.nextEffect))}for(Dn(vr),vr=null,_n=!!hr,hr=null,e.current=t,Mo=r;null!==Mo;){i=!1,a=void 0;try{Vo(e,n)}catch(c){i=!0,a=c}i&&(null===Mo&&o(\"178\"),qo(Mo,a),null!==Mo&&(Mo=Mo.nextEffect))}if(null!==r&&null!==Io){var u=function(e,t){Fo=Uo=Io=null;var n=ia;ia=!0;do{if(512&t.effectTag){var r=!1,i=void 0;try{var l=t;mo(Mi,Ei,l),mo(Ei,Li,l)}catch(u){r=!0,i=u}r&&qo(t,i)}t=t.nextEffect}while(null!==t);ia=n,0!==(n=e.expirationTime)&&Ta(e,n),sa||ia||Pa(1073741823,!1)}.bind(null,e,r);Uo=l.unstable_runWithPriority(l.unstable_NormalPriority,function(){return kr(u)}),Fo=u}Co=zo=!1,\"function\"===typeof Wr&&Wr(t.stateNode),n=t.expirationTime,0===(t=(t=t.childExpirationTime)>n?t:n)&&(Do=null),function(e,t){e.expirationTime=t,e.finishedWork=null}(e,t)}function $o(e){for(;;){var t=e.alternate,n=e.return,r=e.sibling;if(0===(1024&e.effectTag)){Po=e;e:{var l=t,a=Oo,u=(t=e).pendingProps;switch(t.tag){case 2:case 16:break;case 15:case 0:break;case 1:zr(t.type)&&Ir();break;case 3:Ti(),Ur(),(u=t.stateNode).pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),null!==l&&null!==l.child||(gl(t),t.effectTag&=-3),ao(t);break;case 5:Si(t);var c=ki(wi.current);if(a=t.type,null!==l&&null!=t.stateNode)uo(l,t,a,u,c),l.ref!==t.ref&&(t.effectTag|=128);else if(u){var s=ki(gi.current);if(gl(t)){l=(u=t).stateNode;var f=u.type,d=u.memoizedProps,p=c;switch(l[M]=u,l[z]=d,a=void 0,c=f){case\"iframe\":case\"object\":Sn(\"load\",l);break;case\"video\":case\"audio\":for(f=0;f<te.length;f++)Sn(te[f],l);break;case\"source\":Sn(\"error\",l);break;case\"img\":case\"image\":case\"link\":Sn(\"error\",l),Sn(\"load\",l);break;case\"form\":Sn(\"reset\",l),Sn(\"submit\",l);break;case\"details\":Sn(\"toggle\",l);break;case\"input\":wt(l,d),Sn(\"invalid\",l),pr(p,\"onChange\");break;case\"select\":l._wrapperState={wasMultiple:!!d.multiple},Sn(\"invalid\",l),pr(p,\"onChange\");break;case\"textarea\":Xn(l,d),Sn(\"invalid\",l),pr(p,\"onChange\")}for(a in fr(c,d),f=null,d)d.hasOwnProperty(a)&&(s=d[a],\"children\"===a?\"string\"===typeof s?l.textContent!==s&&(f=[\"children\",s]):\"number\"===typeof s&&l.textContent!==\"\"+s&&(f=[\"children\",\"\"+s]):b.hasOwnProperty(a)&&null!=s&&pr(p,a));switch(c){case\"input\":Ve(l),Tt(l,d,!0);break;case\"textarea\":Ve(l),Jn(l);break;case\"select\":case\"option\":break;default:\"function\"===typeof d.onClick&&(l.onclick=mr)}a=f,u.updateQueue=a,(u=null!==a)&&lo(t)}else{d=t,l=a,p=u,f=9===c.nodeType?c:c.ownerDocument,s===Zn.html&&(s=er(l)),s===Zn.html?\"script\"===l?((l=f.createElement(\"div\")).innerHTML=\"<script><\\/script>\",f=l.removeChild(l.firstChild)):\"string\"===typeof p.is?f=f.createElement(l,{is:p.is}):(f=f.createElement(l),\"select\"===l&&p.multiple&&(f.multiple=!0)):f=f.createElementNS(s,l),(l=f)[M]=d,l[z]=u,oo(l,t,!1,!1),p=l;var m=c,h=dr(f=a,d=u);switch(f){case\"iframe\":case\"object\":Sn(\"load\",p),c=d;break;case\"video\":case\"audio\":for(c=0;c<te.length;c++)Sn(te[c],p);c=d;break;case\"source\":Sn(\"error\",p),c=d;break;case\"img\":case\"image\":case\"link\":Sn(\"error\",p),Sn(\"load\",p),c=d;break;case\"form\":Sn(\"reset\",p),Sn(\"submit\",p),c=d;break;case\"details\":Sn(\"toggle\",p),c=d;break;case\"input\":wt(p,d),c=bt(p,d),Sn(\"invalid\",p),pr(m,\"onChange\");break;case\"option\":c=Kn(p,d);break;case\"select\":p._wrapperState={wasMultiple:!!d.multiple},c=i({},d,{value:void 0}),Sn(\"invalid\",p),pr(m,\"onChange\");break;case\"textarea\":Xn(p,d),c=Yn(p,d),Sn(\"invalid\",p),pr(m,\"onChange\");break;default:c=d}fr(f,c),s=void 0;var v=f,y=p,g=c;for(s in g)if(g.hasOwnProperty(s)){var w=g[s];\"style\"===s?cr(y,w):\"dangerouslySetInnerHTML\"===s?null!=(w=w?w.__html:void 0)&&ir(y,w):\"children\"===s?\"string\"===typeof w?(\"textarea\"!==v||\"\"!==w)&&lr(y,w):\"number\"===typeof w&&lr(y,\"\"+w):\"suppressContentEditableWarning\"!==s&&\"suppressHydrationWarning\"!==s&&\"autoFocus\"!==s&&(b.hasOwnProperty(s)?null!=w&&pr(m,s):null!=w&&yt(y,s,w,h))}switch(f){case\"input\":Ve(p),Tt(p,d,!1);break;case\"textarea\":Ve(p),Jn(p);break;case\"option\":null!=d.value&&p.setAttribute(\"value\",\"\"+gt(d.value));break;case\"select\":(c=p).multiple=!!d.multiple,null!=(p=d.value)?qn(c,!!d.multiple,p,!1):null!=d.defaultValue&&qn(c,!!d.multiple,d.defaultValue,!0);break;default:\"function\"===typeof c.onClick&&(p.onclick=mr)}(u=yr(a,u))&&lo(t),t.stateNode=l}null!==t.ref&&(t.effectTag|=128)}else null===t.stateNode&&o(\"166\");break;case 6:l&&null!=t.stateNode?co(l,t,l.memoizedProps,u):(\"string\"!==typeof u&&(null===t.stateNode&&o(\"166\")),l=ki(wi.current),ki(gi.current),gl(t)?(a=(u=t).stateNode,l=u.memoizedProps,a[M]=u,(u=a.nodeValue!==l)&&lo(t)):(a=t,(u=(9===l.nodeType?l:l.ownerDocument).createTextNode(u))[M]=t,a.stateNode=u));break;case 11:break;case 13:if(u=t.memoizedState,0!==(64&t.effectTag)){t.expirationTime=a,Po=t;break e}u=null!==u,a=null!==l&&null!==l.memoizedState,null!==l&&!u&&a&&(null!==(l=l.child.sibling)&&(null!==(c=t.firstEffect)?(t.firstEffect=l,l.nextEffect=c):(t.firstEffect=t.lastEffect=l,l.nextEffect=null),l.effectTag=8)),(u||a)&&(t.effectTag|=4);break;case 7:case 8:case 12:break;case 4:Ti(),ao(t);break;case 10:Al(t);break;case 9:case 14:break;case 17:zr(t.type)&&Ir();break;case 18:break;default:o(\"156\")}Po=null}if(t=e,1===Oo||1!==t.childExpirationTime){for(u=0,a=t.child;null!==a;)(l=a.expirationTime)>u&&(u=l),(c=a.childExpirationTime)>u&&(u=c),a=a.sibling;t.childExpirationTime=u}if(null!==Po)return Po;null!==n&&0===(1024&n.effectTag)&&(null===n.firstEffect&&(n.firstEffect=e.firstEffect),null!==e.lastEffect&&(null!==n.lastEffect&&(n.lastEffect.nextEffect=e.firstEffect),n.lastEffect=e.lastEffect),1<e.effectTag&&(null!==n.lastEffect?n.lastEffect.nextEffect=e:n.firstEffect=e,n.lastEffect=e))}else{if(null!==(e=To(e)))return e.effectTag&=1023,e;null!==n&&(n.firstEffect=n.lastEffect=null,n.effectTag|=1024)}if(null!==r)return r;if(null===n)break;e=n}return null}function Qo(e){var t=Ml(e.alternate,e,Oo);return e.memoizedProps=e.pendingProps,null===t&&(t=$o(e)),So.current=null,t}function Ko(e,t){Co&&o(\"243\"),Bo(),Co=!0;var n=_o.current;_o.current=ul;var r=e.nextExpirationTimeToWorkOn;r===Oo&&e===No&&null!==Po||(Ao(),Oo=r,Po=Kr((No=e).current,null),e.pendingCommitExpirationTime=0);for(var i=!1;;){try{if(t)for(;null!==Po&&!Ea();)Po=Qo(Po);else for(;null!==Po;)Po=Qo(Po)}catch(y){if(Fl=Ul=Il=null,Gi(),null===Po)i=!0,La(y);else{null===Po&&o(\"271\");var l=Po,a=l.return;if(null!==a){e:{var u=e,c=a,s=l,f=y;if(a=Oo,s.effectTag|=1024,s.firstEffect=s.lastEffect=null,null!==f&&\"object\"===typeof f&&\"function\"===typeof f.then){var d=f;f=c;var p=-1,m=-1;do{if(13===f.tag){var h=f.alternate;if(null!==h&&null!==(h=h.memoizedState)){m=10*(1073741822-h.timedOutAt);break}\"number\"===typeof(h=f.pendingProps.maxDuration)&&(0>=h?p=0:(-1===p||h<p)&&(p=h))}f=f.return}while(null!==f);f=c;do{if((h=13===f.tag)&&(h=void 0!==f.memoizedProps.fallback&&null===f.memoizedState),h){if(null===(c=f.updateQueue)?((c=new Set).add(d),f.updateQueue=c):c.add(d),0===(1&f.mode)){f.effectTag|=64,s.effectTag&=-1957,1===s.tag&&(null===s.alternate?s.tag=17:((a=Yl(1073741823)).tag=Hl,Gl(s,a))),s.expirationTime=1073741823;break e}c=a;var v=(s=u).pingCache;null===v?(v=s.pingCache=new wo,h=new Set,v.set(d,h)):void 0===(h=v.get(d))&&(h=new Set,v.set(d,h)),h.has(c)||(h.add(c),s=Xo.bind(null,s,d,c),d.then(s,s)),-1===p?u=1073741823:(-1===m&&(m=10*(1073741822-ti(u,a))-5e3),u=m+p),0<=u&&Ro<u&&(Ro=u),f.effectTag|=2048,f.expirationTime=a;break e}f=f.return}while(null!==f);f=Error((at(s.type)||\"A React component\")+\" suspended while rendering, but no fallback UI was specified.\\n\\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.\"+ut(s))}Lo=!0,f=io(f,s),u=c;do{switch(u.tag){case 3:u.effectTag|=2048,u.expirationTime=a,Jl(u,a=ko(u,f,a));break e;case 1:if(p=f,m=u.type,s=u.stateNode,0===(64&u.effectTag)&&(\"function\"===typeof m.getDerivedStateFromError||null!==s&&\"function\"===typeof s.componentDidCatch&&(null===Do||!Do.has(s)))){u.effectTag|=2048,u.expirationTime=a,Jl(u,a=xo(u,p,a));break e}}u=u.return}while(null!==u)}Po=$o(l);continue}i=!0,La(y)}}break}if(Co=!1,_o.current=n,Fl=Ul=Il=null,Gi(),i)No=null,e.finishedWork=null;else if(null!==Po)e.finishedWork=null;else{if(null===(n=e.current.alternate)&&o(\"281\"),No=null,Lo){if(i=e.latestPendingTime,l=e.latestSuspendedTime,a=e.latestPingedTime,0!==i&&i<r||0!==l&&l<r||0!==a&&a<r)return ei(e,r),void ka(e,n,r,e.expirationTime,-1);if(!e.didError&&t)return e.didError=!0,r=e.nextExpirationTimeToWorkOn=r,t=e.expirationTime=1073741823,void ka(e,n,r,t,-1)}t&&-1!==Ro?(ei(e,r),(t=10*(1073741822-ti(e,r)))<Ro&&(Ro=t),t=10*(1073741822-xa()),t=Ro-t,ka(e,n,r,e.expirationTime,0>t?0:t)):(e.pendingCommitExpirationTime=r,e.finishedWork=n)}}function qo(e,t){for(var n=e.return;null!==n;){switch(n.tag){case 1:var r=n.stateNode;if(\"function\"===typeof n.type.getDerivedStateFromError||\"function\"===typeof r.componentDidCatch&&(null===Do||!Do.has(r)))return Gl(n,e=xo(n,e=io(t,e),1073741823)),void Jo(n,1073741823);break;case 3:return Gl(n,e=ko(n,e=io(t,e),1073741823)),void Jo(n,1073741823)}n=n.return}3===e.tag&&(Gl(e,n=ko(e,n=io(t,e),1073741823)),Jo(e,1073741823))}function Yo(e,t){var n=l.unstable_getCurrentPriorityLevel(),r=void 0;if(0===(1&t.mode))r=1073741823;else if(Co&&!zo)r=Oo;else{switch(n){case l.unstable_ImmediatePriority:r=1073741823;break;case l.unstable_UserBlockingPriority:r=1073741822-10*(1+((1073741822-e+15)/10|0));break;case l.unstable_NormalPriority:r=1073741822-25*(1+((1073741822-e+500)/25|0));break;case l.unstable_LowPriority:case l.unstable_IdlePriority:r=1;break;default:o(\"313\")}null!==No&&r===Oo&&--r}return n===l.unstable_UserBlockingPriority&&(0===aa||r<aa)&&(aa=r),r}function Xo(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),null!==No&&Oo===n?No=null:(t=e.earliestSuspendedTime,r=e.latestSuspendedTime,0!==t&&n<=t&&n>=r&&(e.didError=!1,(0===(t=e.latestPingedTime)||t>n)&&(e.latestPingedTime=n),ni(n,e),0!==(n=e.expirationTime)&&Ta(e,n)))}function Go(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var r=e.return,i=null;if(null===r&&3===e.tag)i=e.stateNode;else for(;null!==r;){if(n=r.alternate,r.childExpirationTime<t&&(r.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===r.return&&3===r.tag){i=r.stateNode;break}r=r.return}return i}function Jo(e,t){null!==(e=Go(e,t))&&(!Co&&0!==Oo&&t>Oo&&Ao(),Zr(e,t),Co&&!zo&&No===e||Ta(e,e.expirationTime),ya>va&&(ya=0,o(\"185\")))}function Zo(e,t,n,r,i){return l.unstable_runWithPriority(l.unstable_ImmediatePriority,function(){return e(t,n,r,i)})}var ea=null,ta=null,na=0,ra=void 0,ia=!1,la=null,oa=0,aa=0,ua=!1,ca=null,sa=!1,fa=!1,da=null,pa=l.unstable_now(),ma=1073741822-(pa/10|0),ha=ma,va=50,ya=0,ga=null;function ba(){ma=1073741822-((l.unstable_now()-pa)/10|0)}function wa(e,t){if(0!==na){if(t<na)return;null!==ra&&l.unstable_cancelCallback(ra)}na=t,e=l.unstable_now()-pa,ra=l.unstable_scheduleCallback(Ca,{timeout:10*(1073741822-t)-e})}function ka(e,t,n,r,i){e.expirationTime=r,0!==i||Ea()?0<i&&(e.timeoutHandle=br(function(e,t,n){e.pendingCommitExpirationTime=n,e.finishedWork=t,ba(),ha=ma,Na(e,n)}.bind(null,e,t,n),i)):(e.pendingCommitExpirationTime=n,e.finishedWork=t)}function xa(){return ia?ha:(_a(),0!==oa&&1!==oa||(ba(),ha=ma),ha)}function Ta(e,t){null===e.nextScheduledRoot?(e.expirationTime=t,null===ta?(ea=ta=e,e.nextScheduledRoot=e):(ta=ta.nextScheduledRoot=e).nextScheduledRoot=ea):t>e.expirationTime&&(e.expirationTime=t),ia||(sa?fa&&(la=e,oa=1073741823,Oa(e,1073741823,!1)):1073741823===t?Pa(1073741823,!1):wa(e,t))}function _a(){var e=0,t=null;if(null!==ta)for(var n=ta,r=ea;null!==r;){var i=r.expirationTime;if(0===i){if((null===n||null===ta)&&o(\"244\"),r===r.nextScheduledRoot){ea=ta=r.nextScheduledRoot=null;break}if(r===ea)ea=i=r.nextScheduledRoot,ta.nextScheduledRoot=i,r.nextScheduledRoot=null;else{if(r===ta){(ta=n).nextScheduledRoot=ea,r.nextScheduledRoot=null;break}n.nextScheduledRoot=r.nextScheduledRoot,r.nextScheduledRoot=null}r=n.nextScheduledRoot}else{if(i>e&&(e=i,t=r),r===ta)break;if(1073741823===e)break;n=r,r=r.nextScheduledRoot}}la=t,oa=e}var Sa=!1;function Ea(){return!!Sa||!!l.unstable_shouldYield()&&(Sa=!0)}function Ca(){try{if(!Ea()&&null!==ea){ba();var e=ea;do{var t=e.expirationTime;0!==t&&ma<=t&&(e.nextExpirationTimeToWorkOn=ma),e=e.nextScheduledRoot}while(e!==ea)}Pa(0,!0)}finally{Sa=!1}}function Pa(e,t){if(_a(),t)for(ba(),ha=ma;null!==la&&0!==oa&&e<=oa&&!(Sa&&ma>oa);)Oa(la,oa,ma>oa),_a(),ba(),ha=ma;else for(;null!==la&&0!==oa&&e<=oa;)Oa(la,oa,!1),_a();if(t&&(na=0,ra=null),0!==oa&&wa(la,oa),ya=0,ga=null,null!==da)for(e=da,da=null,t=0;t<e.length;t++){var n=e[t];try{n._onComplete()}catch(r){ua||(ua=!0,ca=r)}}if(ua)throw e=ca,ca=null,ua=!1,e}function Na(e,t){ia&&o(\"253\"),la=e,oa=t,Oa(e,t,!1),Pa(1073741823,!1)}function Oa(e,t,n){if(ia&&o(\"245\"),ia=!0,n){var r=e.finishedWork;null!==r?Ra(e,r,t):(e.finishedWork=null,-1!==(r=e.timeoutHandle)&&(e.timeoutHandle=-1,wr(r)),Ko(e,n),null!==(r=e.finishedWork)&&(Ea()?e.finishedWork=r:Ra(e,r,t)))}else null!==(r=e.finishedWork)?Ra(e,r,t):(e.finishedWork=null,-1!==(r=e.timeoutHandle)&&(e.timeoutHandle=-1,wr(r)),Ko(e,n),null!==(r=e.finishedWork)&&Ra(e,r,t));ia=!1}function Ra(e,t,n){var r=e.firstBatch;if(null!==r&&r._expirationTime>=n&&(null===da?da=[r]:da.push(r),r._defer))return e.finishedWork=t,void(e.expirationTime=0);e.finishedWork=null,e===ga?ya++:(ga=e,ya=0),l.unstable_runWithPriority(l.unstable_ImmediatePriority,function(){Ho(e,t)})}function La(e){null===la&&o(\"246\"),la.expirationTime=0,ua||(ua=!0,ca=e)}function Ma(e,t){var n=sa;sa=!0;try{return e(t)}finally{(sa=n)||ia||Pa(1073741823,!1)}}function za(e,t){if(sa&&!fa){fa=!0;try{return e(t)}finally{fa=!1}}return e(t)}function Ia(e,t,n){sa||ia||0===aa||(Pa(aa,!1),aa=0);var r=sa;sa=!0;try{return l.unstable_runWithPriority(l.unstable_UserBlockingPriority,function(){return e(t,n)})}finally{(sa=r)||ia||Pa(1073741823,!1)}}function Ua(e,t,n,r,i){var l=t.current;e:if(n){t:{2===tn(n=n._reactInternalFiber)&&1===n.tag||o(\"170\");var a=n;do{switch(a.tag){case 3:a=a.stateNode.context;break t;case 1:if(zr(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break t}}a=a.return}while(null!==a);o(\"171\"),a=void 0}if(1===n.tag){var u=n.type;if(zr(u)){n=Dr(n,u,a);break e}}n=a}else n=Nr;return null===t.context?t.context=n:t.pendingContext=n,t=i,(i=Yl(r)).payload={element:e},null!==(t=void 0===t?null:t)&&(i.callback=t),Bo(),Gl(l,i),Jo(l,r),r}function Fa(e,t,n,r){var i=t.current;return Ua(e,t,n,i=Yo(xa(),i),r)}function Da(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Aa(e){var t=1073741822-25*(1+((1073741822-xa()+500)/25|0));t>=Eo&&(t=Eo-1),this._expirationTime=Eo=t,this._root=e,this._callbacks=this._next=null,this._hasChildren=this._didComplete=!1,this._children=null,this._defer=!0}function ja(){this._callbacks=null,this._didCommit=!1,this._onCommit=this._onCommit.bind(this)}function Wa(e,t,n){e={current:t=$r(3,null,null,t?3:0),containerInfo:e,pendingChildren:null,pingCache:null,earliestPendingTime:0,latestPendingTime:0,earliestSuspendedTime:0,latestSuspendedTime:0,latestPingedTime:0,didError:!1,pendingCommitExpirationTime:0,finishedWork:null,timeoutHandle:-1,context:null,pendingContext:null,hydrate:n,nextExpirationTimeToWorkOn:0,expirationTime:0,firstBatch:null,nextScheduledRoot:null},this._internalRoot=t.stateNode=e}function Va(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||\" react-mount-point-unstable \"!==e.nodeValue))}function Ba(e,t,n,r,i){var l=n._reactRootContainer;if(l){if(\"function\"===typeof i){var o=i;i=function(){var e=Da(l._internalRoot);o.call(e)}}null!=e?l.legacy_renderSubtreeIntoContainer(e,t,i):l.render(t,i)}else{if(l=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute(\"data-reactroot\"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new Wa(e,!1,t)}(n,r),\"function\"===typeof i){var a=i;i=function(){var e=Da(l._internalRoot);a.call(e)}}za(function(){null!=e?l.legacy_renderSubtreeIntoContainer(e,t,i):l.render(t,i)})}return Da(l._internalRoot)}function Ha(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return Va(t)||o(\"200\"),function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:qe,key:null==r?null:\"\"+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)}Ee=function(e,t,n){switch(t){case\"input\":if(xt(e,n),t=n.name,\"radio\"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll(\"input[name=\"+JSON.stringify(\"\"+t)+'][type=\"radio\"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=D(r);i||o(\"90\"),Be(r),xt(r,i)}}}break;case\"textarea\":Gn(e,n);break;case\"select\":null!=(t=n.value)&&qn(e,!!n.multiple,t,!1)}},Aa.prototype.render=function(e){this._defer||o(\"250\"),this._hasChildren=!0,this._children=e;var t=this._root._internalRoot,n=this._expirationTime,r=new ja;return Ua(e,t,null,n,r._onCommit),r},Aa.prototype.then=function(e){if(this._didComplete)e();else{var t=this._callbacks;null===t&&(t=this._callbacks=[]),t.push(e)}},Aa.prototype.commit=function(){var e=this._root._internalRoot,t=e.firstBatch;if(this._defer&&null!==t||o(\"251\"),this._hasChildren){var n=this._expirationTime;if(t!==this){this._hasChildren&&(n=this._expirationTime=t._expirationTime,this.render(this._children));for(var r=null,i=t;i!==this;)r=i,i=i._next;null===r&&o(\"251\"),r._next=i._next,this._next=t,e.firstBatch=this}this._defer=!1,Na(e,n),t=this._next,this._next=null,null!==(t=e.firstBatch=t)&&t._hasChildren&&t.render(t._children)}else this._next=null,this._defer=!1},Aa.prototype._onComplete=function(){if(!this._didComplete){this._didComplete=!0;var e=this._callbacks;if(null!==e)for(var t=0;t<e.length;t++)(0,e[t])()}},ja.prototype.then=function(e){if(this._didCommit)e();else{var t=this._callbacks;null===t&&(t=this._callbacks=[]),t.push(e)}},ja.prototype._onCommit=function(){if(!this._didCommit){this._didCommit=!0;var e=this._callbacks;if(null!==e)for(var t=0;t<e.length;t++){var n=e[t];\"function\"!==typeof n&&o(\"191\",n),n()}}},Wa.prototype.render=function(e,t){var n=this._internalRoot,r=new ja;return null!==(t=void 0===t?null:t)&&r.then(t),Fa(e,n,null,r._onCommit),r},Wa.prototype.unmount=function(e){var t=this._internalRoot,n=new ja;return null!==(e=void 0===e?null:e)&&n.then(e),Fa(null,t,null,n._onCommit),n},Wa.prototype.legacy_renderSubtreeIntoContainer=function(e,t,n){var r=this._internalRoot,i=new ja;return null!==(n=void 0===n?null:n)&&i.then(n),Fa(t,r,e,i._onCommit),i},Wa.prototype.createBatch=function(){var e=new Aa(this),t=e._expirationTime,n=this._internalRoot,r=n.firstBatch;if(null===r)n.firstBatch=e,e._next=null;else{for(n=null;null!==r&&r._expirationTime>=t;)n=r,r=r._next;e._next=r,null!==n&&(n._next=e)}return e},Le=Ma,Me=Ia,ze=function(){ia||0===aa||(Pa(aa,!1),aa=0)};var $a={createPortal:Ha,findDOMNode:function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;return void 0===t&&(\"function\"===typeof e.render?o(\"188\"):o(\"268\",Object.keys(e))),e=null===(e=rn(t))?null:e.stateNode},hydrate:function(e,t,n){return Va(t)||o(\"200\"),Ba(null,e,t,!0,n)},render:function(e,t,n){return Va(t)||o(\"200\"),Ba(null,e,t,!1,n)},unstable_renderSubtreeIntoContainer:function(e,t,n,r){return Va(n)||o(\"200\"),(null==e||void 0===e._reactInternalFiber)&&o(\"38\"),Ba(e,t,n,!1,r)},unmountComponentAtNode:function(e){return Va(e)||o(\"40\"),!!e._reactRootContainer&&(za(function(){Ba(null,null,e,!1,function(){e._reactRootContainer=null})}),!0)},unstable_createPortal:function(){return Ha.apply(void 0,arguments)},unstable_batchedUpdates:Ma,unstable_interactiveUpdates:Ia,flushSync:function(e,t){ia&&o(\"187\");var n=sa;sa=!0;try{return Zo(e,t)}finally{sa=n,Pa(1073741823,!1)}},unstable_createRoot:function(e,t){return Va(e)||o(\"299\",\"unstable_createRoot\"),new Wa(e,!0,null!=t&&!0===t.hydrate)},unstable_flushControlled:function(e){var t=sa;sa=!0;try{Zo(e)}finally{(sa=t)||ia||Pa(1073741823,!1)}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{Events:[U,F,D,N.injectEventPluginsByName,g,H,function(e){E(e,B)},Oe,Re,Pn,R]}};!function(e){var t=e.findFiberByHostInstance;(function(e){if(\"undefined\"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);Wr=Br(function(e){return t.onCommitFiberRoot(n,e)}),Vr=Br(function(e){return t.onCommitFiberUnmount(n,e)})}catch(r){}})(i({},e,{overrideProps:null,currentDispatcherRef:He.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=rn(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null}}))}({findFiberByHostInstance:I,bundleType:0,version:\"16.8.2\",rendererPackageName:\"react-dom\"});var Qa={default:$a},Ka=Qa&&$a||Qa;e.exports=Ka.default||Ka},function(e,t,n){\"use strict\";e.exports=n(21)},function(e,t,n){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=null,r=!1,i=3,l=-1,o=-1,a=!1,u=!1;function c(){if(!a){var e=n.expirationTime;u?T():u=!0,x(d,e)}}function s(){var e=n,t=n.next;if(n===t)n=null;else{var r=n.previous;n=r.next=t,t.previous=r}e.next=e.previous=null,r=e.callback,t=e.expirationTime,e=e.priorityLevel;var l=i,a=o;i=e,o=t;try{var u=r()}finally{i=l,o=a}if(\"function\"===typeof u)if(u={callback:u,priorityLevel:e,expirationTime:t,next:null,previous:null},null===n)n=u.next=u.previous=u;else{r=null,e=n;do{if(e.expirationTime>=t){r=e;break}e=e.next}while(e!==n);null===r?r=n:r===n&&(n=u,c()),(t=r.previous).next=r.previous=u,u.next=r,u.previous=t}}function f(){if(-1===l&&null!==n&&1===n.priorityLevel){a=!0;try{do{s()}while(null!==n&&1===n.priorityLevel)}finally{a=!1,null!==n?c():u=!1}}}function d(e){a=!0;var i=r;r=e;try{if(e)for(;null!==n;){var l=t.unstable_now();if(!(n.expirationTime<=l))break;do{s()}while(null!==n&&n.expirationTime<=l)}else if(null!==n)do{s()}while(null!==n&&!_())}finally{a=!1,r=i,null!==n?c():u=!1,f()}}var p,m,h=Date,v=\"function\"===typeof setTimeout?setTimeout:void 0,y=\"function\"===typeof clearTimeout?clearTimeout:void 0,g=\"function\"===typeof requestAnimationFrame?requestAnimationFrame:void 0,b=\"function\"===typeof cancelAnimationFrame?cancelAnimationFrame:void 0;function w(e){p=g(function(t){y(m),e(t)}),m=v(function(){b(p),e(t.unstable_now())},100)}if(\"object\"===typeof performance&&\"function\"===typeof performance.now){var k=performance;t.unstable_now=function(){return k.now()}}else t.unstable_now=function(){return h.now()};var x,T,_,S=null;if(\"undefined\"!==typeof window?S=window:\"undefined\"!==typeof e&&(S=e),S&&S._schedMock){var E=S._schedMock;x=E[0],T=E[1],_=E[2],t.unstable_now=E[3]}else if(\"undefined\"===typeof window||\"function\"!==typeof MessageChannel){var C=null,P=function(e){if(null!==C)try{C(e)}finally{C=null}};x=function(e){null!==C?setTimeout(x,0,e):(C=e,setTimeout(P,0,!1))},T=function(){C=null},_=function(){return!1}}else{\"undefined\"!==typeof console&&(\"function\"!==typeof g&&console.error(\"This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills\"),\"function\"!==typeof b&&console.error(\"This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills\"));var N=null,O=!1,R=-1,L=!1,M=!1,z=0,I=33,U=33;_=function(){return z<=t.unstable_now()};var F=new MessageChannel,D=F.port2;F.port1.onmessage=function(){O=!1;var e=N,n=R;N=null,R=-1;var r=t.unstable_now(),i=!1;if(0>=z-r){if(!(-1!==n&&n<=r))return L||(L=!0,w(A)),N=e,void(R=n);i=!0}if(null!==e){M=!0;try{e(i)}finally{M=!1}}};var A=function e(t){if(null!==N){w(e);var n=t-z+U;n<U&&I<U?(8>n&&(n=8),U=n<I?I:n):I=n,z=t+U,O||(O=!0,D.postMessage(void 0))}else L=!1};x=function(e,t){N=e,R=t,M||0>t?D.postMessage(void 0):L||(L=!0,w(A))},T=function(){N=null,O=!1,R=-1}}t.unstable_ImmediatePriority=1,t.unstable_UserBlockingPriority=2,t.unstable_NormalPriority=3,t.unstable_IdlePriority=5,t.unstable_LowPriority=4,t.unstable_runWithPriority=function(e,n){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=i,o=l;i=e,l=t.unstable_now();try{return n()}finally{i=r,l=o,f()}},t.unstable_next=function(e){switch(i){case 1:case 2:case 3:var n=3;break;default:n=i}var r=i,o=l;i=n,l=t.unstable_now();try{return e()}finally{i=r,l=o,f()}},t.unstable_scheduleCallback=function(e,r){var o=-1!==l?l:t.unstable_now();if(\"object\"===typeof r&&null!==r&&\"number\"===typeof r.timeout)r=o+r.timeout;else switch(i){case 1:r=o+-1;break;case 2:r=o+250;break;case 5:r=o+1073741823;break;case 4:r=o+1e4;break;default:r=o+5e3}if(e={callback:e,priorityLevel:i,expirationTime:r,next:null,previous:null},null===n)n=e.next=e.previous=e,c();else{o=null;var a=n;do{if(a.expirationTime>r){o=a;break}a=a.next}while(a!==n);null===o?o=n:o===n&&(n=e,c()),(r=o.previous).next=o.previous=e,e.next=o,e.previous=r}return e},t.unstable_cancelCallback=function(e){var t=e.next;if(null!==t){if(t===e)n=null;else{e===n&&(n=t);var r=e.previous;r.next=t,t.previous=r}e.next=e.previous=null}},t.unstable_wrapCallback=function(e){var n=i;return function(){var r=i,o=l;i=n,l=t.unstable_now();try{return e.apply(this,arguments)}finally{i=r,l=o,f()}}},t.unstable_getCurrentPriorityLevel=function(){return i},t.unstable_shouldYield=function(){return!r&&(null!==n&&n.expirationTime<o||_())},t.unstable_continueExecution=function(){null!==n&&c()},t.unstable_pauseExecution=function(){},t.unstable_getFirstCallbackNode=function(){return n}}).call(this,n(22))},function(e,t){var n;n=function(){return this}();try{n=n||Function(\"return this\")()||(0,eval)(\"this\")}catch(r){\"object\"===typeof window&&(n=window)}e.exports=n}]]);//# sourceMappingURL=1.84e4dc26.chunk.js.map</script><script>(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,,,function(e,t,a){e.exports=a.p+\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiB2aWV3Qm94PSIwIDAgNjEyIDYxMiI+PHBhdGggZD0iTTU4Ny41NzIgMTg2Ljg4MWMtMzIuMjY2LTc1LjIyNS04Ny4wOTYtMTI5LjkzNC0xNjIuOTQ5LTE2Mi4yODVDMzg2LjcxMSA4LjQyNyAzNDcuMzI4LjE2OCAzMDUuODMyLjE2OGMtNDEuNDg4IDAtODAuOTE0IDguMTgxLTExOC43ODQgMjQuNDI4LTc1LjIyNCAzMi4yNjUtMTMwLjYzMyA4Ni45MzktMTYyLjk1NiAxNjIuMjg1QzcuODk1IDIyNC42MjkgMCAyNjQuMTc2IDAgMzA1LjY2NGMwIDQxLjQ5NiA3Ljg5NSA4MS4zNzEgMjQuMDkyIDExOS4xMjcgMzIuMzIzIDc1LjM0NiA4Ny43MzEgMTMwLjM0OCAxNjIuOTU2IDE2Mi42MjEgMzcuODcgMTYuMjQ3IDc3LjI5NSAyNC40MiAxMTguNzg0IDI0LjQyIDQxLjQ5NiAwIDgwLjg3OS04LjI1OSAxMTguNzkxLTI0LjQyIDc1Ljg1NC0zMi4zNTIgMTMwLjY4NC04Ny40MDMgMTYyLjk0OS0xNjIuNjIxQzYwMy44MTkgMzg2LjkxNCA2MTIgMzQ3LjE2IDYxMiAzMDUuNjY0YzAtNDEuNDg4LTguMTgxLTgwLjkwNy0yNC40MjgtMTE4Ljc4M3pNMjA0LjEwOSA1Ny4wNTRjLTI2LjQzNCAzMy40NTgtNDUuODM2IDc1Ljk1My01OC4yMjEgMTI3LjQ4NUg2NS45MTdjMjkuNDQ1LTU3LjIyMSA3OC45NzItMTAzLjA2NCAxMzguMTkyLTEyNy40ODV6TTM3LjE0MSAzMDUuNjY0YzAtMjkuMTEgNC42ODMtNTcuMjE0IDEzLjcyLTg0LjMxOWg4Ny42NjdjLTQuMzQ4IDI4LjQzOS02LjM2IDU2LjU1MS02LjM2IDg0LjMxOSAwIDI3LjQ0IDIuMDEzIDU1LjIxNyA2LjM2IDgzLjY1Nkg1MC4xOWMtOC43MDEtMjcuMTA1LTEzLjA0OS01NS4yMDktMTMuMDQ5LTgzLjY1NnptMjguNzc2IDEyMC40NjJoNzkuOTcyYzEyLjM4NSA1Mi41MzEgMzEuNzg4IDk1LjY5NyA1OC4yMjEgMTI4LjgyNy02MC4yMjgtMjUuMDk5LTEwOS43NTQtNzAuOTQxLTEzOC4xOTMtMTI4LjgyN3ptMjIxLjE3NyAxNDUuNTUzYy0yMS43NTEtNi4zNTQtNDIuMTYtMjIuNDE1LTYwLjU2Mi00OC41MTMtMTguNDAzLTI2LjEwNS0zMi40NTgtNTguNTU3LTQyLjE2LTk3LjA0aDEwMi43MjJ2MTQ1LjU1M3ptMC0xODIuMzU5SDE3Ni4wMDVjLTQuMzU0LTI5Ljc4Mi02LjY5Ni01Ny41NTgtNi42OTYtODMuNjU2IDAtMjguMTA0IDIuMzQxLTU2LjIxNSA3LjM2Ny04NC4zMTloMTEwLjQxN1YzODkuMzJoLjAwMXptMC0yMDQuNzhIMTg0LjM3MmMxMC4zNzItMzguMTQ4IDI0LjUwNi03MC4yMTQgNDIuODMxLTk2LjAzNCAxOC40ODEtMjYuMDQ4IDM4LjE0MS00Mi4xNiA1OS44OTItNDguMTg1VjE4NC41NHptMjU4Ljk5IDBoLTc5Ljk3M2MtMTIuMzc4LTUxLjUzMy0zMS43ODctOTQuMDI4LTU4LjIyMS0xMjcuNDg1IDU5LjIyOCAyNC40MiAxMDguNzQ4IDcwLjI2MyAxMzguMTk0IDEyNy40ODV6TTMyNC45MDYgNDAuMzIxYzIxLjc1MSA2LjAyNSA0MS40MSAyMi4xMzcgNTkuODkyIDQ4LjE4NSAxOC4zMzEgMjUuODIgMzIuNDU4IDU3Ljg4NiA0Mi44MyA5Ni4wMzRIMzI0LjkwNlY0MC4zMjF6bTAgMTgxLjAyNGgxMTAuNDE3YzUuMDI1IDI4LjEwNCA3LjM2NyA1Ni4yMTUgNy4zNjcgODQuMzE5IDAgMjYuMDk5LTIuMzQyIDUzLjg3NC02LjY5NiA4My42NTZIMzI0LjkwNlYyMjEuMzQ1em0wIDM1MC4zMzRWNDI2LjEyNmgxMDIuNzIyYy0xMC4wMzYgMzguNDgzLTI0LjI3NyA3MC44MDYtNDIuNDk1IDk3LjA0LTE4LjI2IDI2LjI5OC0zOC4xNDEgNDIuNDk1LTYwLjIyNyA0OC41MTN6bTgyLjk4NS0xNi43MjZjMjYuNDM0LTMzLjEzIDQ1Ljg0My03Ni4yOTYgNTguMjIxLTEyOC44MjdoNzkuOTczYy0yOC40NCA1Ny44ODYtNzcuOTY4IDEwMy43MjgtMTM4LjE5NCAxMjguODI3ek01NjEuODEgMzg5LjMyaC04OC4zMzhhNTUwLjc1NiA1NTAuNzU2IDAgMCAwIDYuMzYtODMuNjU2YzAtMjcuNzY4LTIuMDA2LTU1Ljg3OS02LjM2LTg0LjMxOWg4Ny42NjdjOS4wMzcgMjcuMTA0IDEzLjcyIDU1LjIwOCAxMy43MiA4NC4zMTktLjAwMSAyOC40NDctNC4zNDcgNTYuNTUxLTEzLjA0OSA4My42NTZ6IiBmaWxsPSIjRkZGIi8+PC9zdmc+\"},function(e,t,a){e.exports=a.p+\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiB2aWV3Qm94PSIwIDAgNjEyIDYxMiI+PHBhdGggZD0iTTU2MSA3Ni41SDE3OC41Yy0xNy44NSAwLTMwLjYgNy42NS00MC44IDIyLjk1TDAgMzA2bDEzNy43IDIwNi41NWMxMC4yIDEyLjc1IDIyLjk1IDIyLjk1IDQwLjggMjIuOTVINTYxYzI4LjA1IDAgNTEtMjIuOTUgNTEtNTF2LTM1N2MwLTI4LjA1LTIyLjk1LTUxLTUxLTUxem0tNzYuNSAzMjEuM2wtMzUuNyAzNS43LTkxLjgtOTEuOC05MS44IDkxLjgtMzUuNy0zNS43IDkxLjgtOTEuOC05MS44LTkxLjggMzUuNy0zNS43IDkxLjggOTEuOCA5MS44LTkxLjggMzUuNyAzNS43LTkxLjggOTEuOCA5MS44IDkxLjh6IiBmaWxsPSIjN2E5MjlmIi8+PC9zdmc+Cg==\"},function(e,t,a){e.exports=a.p+\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNC4xIDI0LjEiPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0yMy4xIDE3LjA1Yy42IDAgMS0uNCAxLTF2LTEzYzAtLjYtLjQtMS0xLTFoLTJjLS42IDAtMSAuNC0xIDF2OS41YzAgLjMtLjIuNS0uNS41SDguNWMtLjQgMC0uNy0uNS0uNC0uOWwxLTFjLjItLjIuMy0uNC4zLS43IDAtLjMtLjEtLjUtLjMtLjdsLTEuNC0xLjRjLS4yLS4yLS40LS4zLS43LS4zLS4zIDAtLjUuMS0uNy4zbC02IDZjLS4yLjItLjMuNS0uMy43cy4xLjUuMy43bDYgNmMuMi4yLjQuMy43LjMuMyAwIC41LS4xLjctLjNsMS40LTEuNGMuMi0uMi4zLS40LjMtLjdzLS4xLS41LS4zLS43bC0xLTFjLS4zLS4zLS4xLS45LjQtLjloMTQuNnoiLz48L3N2Zz4K\"},function(e,t,a){e.exports=a.p+\"data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjZmZmIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0ODQuNSIgaGVpZ2h0PSI0ODQuNSI+PHBhdGggZD0iTTI0Mi4yNSAzMDZjNDMuMzUgMCA3Ni41LTMzLjE1IDc2LjUtNzYuNXYtMTUzYzAtNDMuMzUtMzMuMTUtNzYuNS03Ni41LTc2LjVzLTc2LjUgMzMuMTUtNzYuNSA3Ni41djE1M2MwIDQzLjM1IDMzLjE1IDc2LjUgNzYuNSA3Ni41em0xMzUuMTUtNzYuNWMwIDc2LjUtNjMuNzUgMTMwLjA1LTEzNS4xNSAxMzAuMDVTMTA3LjEgMzA2IDEwNy4xIDIyOS41SDYzLjc1YzAgODYuNyA2OC44NSAxNTguMSAxNTMgMTcwLjg1djg0LjE1aDUxdi04NC4xNWM4NC4xNS0xMi43NSAxNTMtODQuMTQ5IDE1My0xNzAuODVIMzc3LjR6Ii8+PC9zdmc+Cg==\"},,function(e,t,a){e.exports=a(39)},,,,,,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){\"use strict\";a.r(t);var n,r=a(0),i=a.n(r),c=a(11),o=a.n(c),s=(a(23),a(2)),u=a(3),l=a(4),y=a(1),h=a(5);a(25);!function(e){e[e.DOWN=0]=\"DOWN\",e[e.DOWN_CONTINUOUSLY=1]=\"DOWN_CONTINUOUSLY\",e[e.UP=2]=\"UP\",e[e.NORMAL=3]=\"NORMAL\"}(n||(n={}));var p,d=function(e){function t(){var e,a;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),c=0;c<r;c++)i[c]=arguments[c];return(a=Object(l.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(i)))).state={keyState:n.NORMAL},a._clearTimers=function(){clearTimeout(a._keyUpTimeoutId),clearTimeout(a._keyDownTimeoutId),clearInterval(a._keyDownContinuouslyIntervalId)},a._handleMouseDown=function(){a._clearTimers(),a.setState({keyState:n.DOWN}),a.props.definition.onClick(),a._keyDownTimeoutId=setTimeout(function(){a.setState({keyState:n.DOWN_CONTINUOUSLY}),a._keyDownContinuouslyIntervalId=setInterval(a.props.definition.onClick,100)},1e3)},a._handleMouseUp=function(){a._clearTimers(),a.setState({keyState:n.UP}),a._keyUpTimeoutId=setTimeout(function(){return a.setState({keyState:n.NORMAL})},1e3)},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"componentWillUnmount\",value:function(){this._clearTimers()}},{key:\"render\",value:function(){var e=[\"key-component\"];switch(this.props.className&&e.push(this.props.className),this.state.keyState){case n.DOWN:case n.DOWN_CONTINUOUSLY:e.push(\"key-down\");break;case n.UP:e.push(\"key-up\")}return i.a.createElement(\"div\",{className:e.join(\" \"),onMouseDown:this._handleMouseDown,onMouseUp:this._handleMouseUp},this.props.children||this.props.definition.value)}}]),t}(r.Component),f=function e(t,a){var n=this;Object(s.a)(this,e),this.value=t,this._clickHandler=a,this.onClick=function(){n._clickHandler&&n._clickHandler(n)}};!function(e){e.SET_LANGUAGE=\"keyboard.setLanguage\",e.VOICE_RECOGNITION_DISABLED=\"keyboard.voiceRecognitionDisabled\",e.VOICE_RECOGNITION_ENABLED=\"keyboard.voiceRecognitionEnabled\",e.VOICE_RECOGNITION_FINISHED=\"keyboard.voiceRecognitionFinished\",e.VOICE_RECOGNITION_STARTED=\"keyboard.voiceRecognitionStarted\",e.INPUT_RECEIVED=\"keyboard.inputReceived\",e.KEYBOARD_INITIALIZED=\"keyboard.initialized\",e.VOICE_RECOGNITION_FINISH_REQUESTED=\"keyboard.voiceRecognitionFinishRequested\",e.VOICE_RECOGNITION_START_REQUESTED=\"keyboard.voiceRecognitionStartRequested\"}(p||(p={}));var g=p;function m(e){window.vuplex&&window.vuplex.postMessage({type:g.INPUT_RECEIVED,value:e.value})}a(27);var v,O=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(l.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r))))._spacebarKeyDefinition=new f(\" \",m),a._renderKey=function(e){return i.a.createElement(d,{className:\"key\",definition:e,key:e.value})},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"render\",value:function(){return i.a.createElement(\"div\",{className:\"center-board\"},i.a.createElement(\"div\",{className:\"key-area\"},i.a.createElement(\"div\",{className:\"key-row\"},this.props.rows[0].map(this._renderKey)),i.a.createElement(\"div\",{className:\"key-row\"},i.a.createElement(\"div\",{className:\"key-offset-margin\"}),this.props.rows[1].map(this._renderKey),i.a.createElement(\"div\",{className:\"key-offset-margin\"})),i.a.createElement(\"div\",{className:\"key-row\"},this.props.rows[2].map(this._renderKey)),i.a.createElement(\"div\",{className:\"key-row\"},this.props.rows[3].slice(0,2).map(this._renderKey),i.a.createElement(\"div\",{className:\"spacebar-container\"},i.a.createElement(d,{className:\"spacebar\",definition:this._spacebarKeyDefinition},this.props.spacebarText)),this.props.rows[3].slice(2).map(this._renderKey))))}}]),t}(r.Component),k=a(7),b=a(9),_=a.n(b),E=a(6),C=a(16),w=a(8);!function(e){e[e.LOWERCASE=0]=\"LOWERCASE\",e[e.UPPERCASE=1]=\"UPPERCASE\",e[e.CAPS_LOCK=2]=\"CAPS_LOCK\",e[e.SPECIAL=3]=\"SPECIAL\"}(v||(v={}));var S=v,j=(a(29),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"render\",value:function(){var e=[S.UPPERCASE,S.CAPS_LOCK].includes(this.props.keyboardLayout);return i.a.createElement(\"div\",{className:\"shift-key-icon\"},i.a.createElement(\"div\",{className:\"shift-arrow-triangle \".concat(e?\"shift-arrow-colored\":\"\")}),this._renderArrowLine(e))}},{key:\"_renderArrowLine\",value:function(e){return this.props.keyboardLayout===S.CAPS_LOCK?i.a.createElement(\"div\",{className:\"caps-lock-arrow-line\"},i.a.createElement(\"div\",{className:\"caps-lock-line-top\"}),i.a.createElement(\"div\",{className:\"caps-lock-line-middle\"}),i.a.createElement(\"div\",{className:\"caps-lock-line-bottom\"})):i.a.createElement(\"div\",{className:\"regular-arrow-line \".concat(e?\"shift-arrow-colored\":\"\")})}}]),t}(r.Component)),N=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(l.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r))))._layout=S.LOWERCASE,a._createSimpleKeyDefinition=function(e){return new f(e,a._handleSimpleKeyPress)},a._handleShiftKeyPressed=function(){switch(a._layout){case S.LOWERCASE:a._setLayout(S.UPPERCASE);break;case S.UPPERCASE:a._setLayout(S.CAPS_LOCK);break;default:a._setLayout(S.LOWERCASE)}},a._handleSimpleKeyPress=function(e){a._layout===S.UPPERCASE&&a._setLayout(S.LOWERCASE),m(e)},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getAlphabeticCharacterSetKeySymbol\",value:function(){return\"ABC\"}},{key:\"getCurrencyCharacters\",value:function(){return[\"$\",\"\\u20ac\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){return[[\"q\",\"w\",\"e\",\"r\",\"t\",\"y\",\"u\",\"i\",\"o\",\"p\"],[\"a\",\"s\",\"d\",\"f\",\"g\",\"h\",\"j\",\"k\",\"l\"],[\"z\",\"x\",\"c\",\"v\",\"b\",\"n\",\"m\",\"!\",\"?\"]]}},{key:\"getSpecialCharactersByRow\",value:function(){return[[\"@\",\"#\"].concat(Object(w.a)(this.getCurrencyCharacters()),[\"%\",\"&\",\"*\",\"-\",\"+\"]),[\"~\",\"`\",'\"',\"'\",\":\",\";\",\"_\",\"=\",\"\\\\\",\"/\"],[\"{\",\"}\",\"[\",\"]\",\"<\",\">\",\"^\",\"|\",\"(\",\")\"],[\"@\",\",\",\".\"]]}},{key:\"getRows\",value:function(){return this._layout===S.SPECIAL?this._getSpecialCharacterRows():this._getAlphabeticCharactersRows()}},{key:\"getUpperCaseCharactersByRow\",value:function(){return this.getLowerCaseCharactersByRow().map(function(e){return e.map(function(e){return e.toUpperCase()})})}},{key:\"_getAlphabeticCharactersRows\",value:function(){var e=[S.UPPERCASE,S.CAPS_LOCK].includes(this._layout)?this.getUpperCaseCharactersByRow():this.getLowerCaseCharactersByRow();return[e[0].map(this._createSimpleKeyDefinition),e[1].map(this._createSimpleKeyDefinition),[this._getShiftKey()].concat(Object(w.a)(e[2].map(this._createSimpleKeyDefinition))),[this._getSpecialCharacterSetKey()].concat(Object(w.a)([\"@\",\",\",\".\"].map(this._createSimpleKeyDefinition)))]}},{key:\"_getAlphabeticCharacterSetKey\",value:function(){var e=this,t=this.getAlphabeticCharacterSetKeySymbol();return new f(t,function(){return e._setLayout(S.LOWERCASE)})}},{key:\"_getShiftKey\",value:function(){return new f(i.a.createElement(j,{keyboardLayout:this._layout}),this._handleShiftKeyPressed)}},{key:\"_getSpecialCharacterRows\",value:function(){var e=this.getSpecialCharactersByRow(),t=Object(C.a)(e,4),a=t[0],n=t[1],r=t[2],i=t[3];return[a.map(this._createSimpleKeyDefinition),n.map(this._createSimpleKeyDefinition),r.map(this._createSimpleKeyDefinition),[this._getAlphabeticCharacterSetKey()].concat(Object(w.a)(i.map(this._createSimpleKeyDefinition)))]}},{key:\"_getSpecialCharacterSetKey\",value:function(){var e=this;return new f(\"#+=\",function(){return e._setLayout(S.SPECIAL)})}},{key:\"_setLayout\",value:function(e){this._layout=e,this.emit(\"layoutChanged\",this)}},{key:\"layout\",get:function(){return this._layout}}]),t}(_.a),R=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\xa3\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){var e=Object(E.a)(Object(y.a)(t.prototype),\"getLowerCaseCharactersByRow\",this).call(this);return e[0].push(\"\\xe5\"),e[1].push(\"\\xe6\",\"\\xf8\"),e}},{key:\"language\",get:function(){return\"Dansk\"}},{key:\"languageCode\",get:function(){return\"da\"}}]),t}(N),I=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"$\",\"\\u20ac\",\"\\xa3\",\"\\u20b9\"]}},{key:\"language\",get:function(){return\"English\"}},{key:\"languageCode\",get:function(){return\"en\"}}]),t}(N),L=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\u20ac\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){return[[\"a\",\"z\",\"e\",\"r\",\"t\",\"y\",\"u\",\"i\",\"o\",\"p\"],[\"q\",\"s\",\"d\",\"f\",\"g\",\"h\",\"j\",\"k\",\"l\",\"m\"],[\"z\",\"x\",\"c\",\"v\",\"b\",\"n\",\"'\",\"/\"]]}},{key:\"language\",get:function(){return\"Fran\\xe7ais\"}},{key:\"languageCode\",get:function(){return\"fr\"}}]),t}(N),A=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\u20ac\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){return[[\"q\",\"w\",\"e\",\"r\",\"t\",\"z\",\"u\",\"i\",\"o\",\"p\"],[\"a\",\"s\",\"d\",\"f\",\"g\",\"h\",\"j\",\"k\",\"l\"],[\"y\",\"x\",\"c\",\"v\",\"b\",\"n\",\"m\",\"!\",\"?\"]]}},{key:\"language\",get:function(){return\"Deutsche\"}},{key:\"languageCode\",get:function(){return\"de\"}}]),t}(N),D=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\xa3\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){var e=Object(E.a)(Object(y.a)(t.prototype),\"getLowerCaseCharactersByRow\",this).call(this);return e[0].push(\"\\xe5\"),e[1].push(\"\\xf8\",\"\\xe6\"),e}},{key:\"language\",get:function(){return\"Norsk\"}},{key:\"languageCode\",get:function(){return\"no\"}}]),t}(N),K=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\u20bd\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){return[[\"\\u0439\",\"\\u0446\",\"\\u0443\",\"\\u043a\",\"\\u0435\",\"\\u043d\",\"\\u0433\",\"\\u0448\",\"\\u0449\",\"\\u0437\",\"\\u0445\",\"\\u044a\"],[\"\\u0444\",\"\\u044b\",\"\\u0432\",\"\\u0430\",\"\\u043f\",\"\\u0440\",\"\\u043e\",\"\\u043b\",\"\\u0434\",\"\\u0436\",\"\\u044d\"],[\"\\u044f\",\"\\u0447\",\"\\u0441\",\"\\u043c\",\"\\u0438\",\"\\u0442\",\"\\u044c\",\"\\u0431\",\"\\u044e\",\"!\",\"?\"]]}},{key:\"getAlphabeticCharacterSetKeySymbol\",value:function(){return\"\\u0410\\u0411\\u0412\"}},{key:\"language\",get:function(){return\"\\u0440\\u0443\\u0441\\u0441\\u043a\\u0438\\u0439\"}},{key:\"languageCode\",get:function(){return\"ru\"}}]),t}(N),T=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"$\",\"\\u20ac\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){var e=Object(E.a)(Object(y.a)(t.prototype),\"getLowerCaseCharactersByRow\",this).call(this);return e[1].push(\"\\xf1\"),e}},{key:\"getSpecialCharactersByRow\",value:function(){var e=Object(E.a)(Object(y.a)(t.prototype),\"getSpecialCharactersByRow\",this).call(this);return e[3].splice(1,2,\"\\xba\",\"\\xaa\"),e}},{key:\"language\",get:function(){return\"Espa\\xf1ol\"}},{key:\"languageCode\",get:function(){return\"es\"}}]),t}(N),U=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getCurrencyCharacters\",value:function(){return[\"\\xa3\"]}},{key:\"getLowerCaseCharactersByRow\",value:function(){var e=Object(E.a)(Object(y.a)(t.prototype),\"getLowerCaseCharactersByRow\",this).call(this);return e[0].push(\"\\xe5\"),e[1].push(\"\\xf6\",\"\\xe4\"),e}},{key:\"language\",get:function(){return\"Svenska\"}},{key:\"languageCode\",get:function(){return\"sv\"}}]),t}(N),P=a(12),B=a.n(P),x=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(l.a)(this,Object(y.a)(t).call(this)))._keySetIndex=0,e._keySets=[new I,new T,new L,new A,new K,new R,new D,new U],e._handleLayoutChanged=function(){e.emit(\"layoutChanged\",Object(k.a)(Object(k.a)(e)))},e._handleSwitchLanguageKeyClick=function(){e._keySetIndex=e._keySetIndex>=e._keySets.length-1?0:e._keySetIndex+1,e.emit(\"layoutChanged\",Object(k.a)(Object(k.a)(e)))},e._keySets.forEach(function(t){return t.on(\"layoutChanged\",e._handleLayoutChanged)}),e}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"getRows\",value:function(){var e=this._getKeySet().getRows();return e[3][1]=new f(this._getSwitchLanguageIcon(),this._handleSwitchLanguageKeyClick),e}},{key:\"setLanguage\",value:function(e){this._keySetIndex=this._keySets.findIndex(function(t){return t.languageCode===e}),-1===this._keySetIndex&&(this._keySetIndex=this._keySets.findIndex(function(e){return\"en\"===e.languageCode})),this.emit(\"layoutChanged\",this)}},{key:\"_getKeySet\",value:function(){return this._keySets[this._keySetIndex]}},{key:\"_getSwitchLanguageIcon\",value:function(){return i.a.createElement(\"img\",{style:{width:\"1.2em\",height:\"1.2em\"},src:B.a,alt:\"globe\"})}},{key:\"language\",get:function(){return this._getKeySet().language}},{key:\"layout\",get:function(){return this._getKeySet().layout}}]),t}(_.a),M=a(13),V=a.n(M),G=a(14),W=a.n(G),F=(a(31),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(l.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r))))._keyRows=[[new f(\"1\",m),new f(\"2\",m),new f(\"3\",m)],[new f(\"4\",m),new f(\"5\",m),new f(\"6\",m)],[new f(\"7\",m),new f(\"8\",m),new f(\"9\",m)],[new f(\".\",m),new f(\"0\",m),new f(\"-\",m)]],a._renderKeyRow=function(e,t){return i.a.createElement(\"div\",{className:\"key-row\",key:t},e.map(function(e){return i.a.createElement(d,{className:\"key\",definition:e,key:e.value})}))},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"render\",value:function(){return i.a.createElement(\"div\",{className:\"num-pad\"},i.a.createElement(\"div\",{className:\"key-area\"},this._keyRows.map(this._renderKeyRow)))}}]),t}(r.Component)),H=(a(33),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(l.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r))))._upKeyDefinition=new f(\"ArrowUp\",m),a._leftKeyDefinition=new f(\"ArrowLeft\",m),a._rightKeyDefinition=new f(\"ArrowRight\",m),a._downKeyDefinition=new f(\"ArrowDown\",m),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"render\",value:function(){return i.a.createElement(\"div\",{className:\"right-pad\"},i.a.createElement(\"div\",{className:\"key-area\"},i.a.createElement(\"div\",{className:\"right-key-area\"},i.a.createElement(\"div\",{className:\"arrow-pad\"},i.a.createElement(\"div\",{className:\"arrow-pad-row\"},i.a.createElement(d,{definition:this._upKeyDefinition},\"\\u25b2\")),i.a.createElement(\"div\",{className:\"arrow-pad-row arrow-pad-middle\"},i.a.createElement(d,{definition:this._leftKeyDefinition},i.a.createElement(\"span\",{style:{transform:\"rotate(-90deg)\"}},\"\\u25b2\")),i.a.createElement(d,{definition:this._rightKeyDefinition},i.a.createElement(\"span\",{style:{transform:\"rotate(90deg)\"}},\"\\u25b2\"))),i.a.createElement(\"div\",{className:\"arrow-pad-row\"},i.a.createElement(d,{definition:this._downKeyDefinition},i.a.createElement(\"span\",{style:{transform:\"rotate(180deg)\"}},\"\\u25b2\")))))))}}]),t}(r.Component)),Y=a(15),q=a.n(Y),z=(a(35),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"render\",value:function(){return i.a.createElement(\"div\",{className:\"voice-button \".concat(this.props.active?\"voice-button-active\":\"\"),onMouseDown:this.props.onMouseDown},i.a.createElement(\"div\",{className:\"voice-button-icon\"},i.a.createElement(\"div\",null,i.a.createElement(\"img\",{src:q.a,alt:\"voice control\"}))))}}]),t}(r.Component)),Q=(a(37),function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(y.a)(t).call(this,e)))._keySet=new x,a.state={language:a._keySet.language,layout:a._keySet.layout,voiceRecognitionEnabled:!1,voiceRecognitionActive:!1},a._backspaceKeyDefinition=new f(\"Backspace\",m),a._returnKeyDefinition=new f(\"Enter\",m),a._handleReceivedMessage=function(e){var t=JSON.parse(e.data);switch(t.type){case g.SET_LANGUAGE:a._keySet.setLanguage(t.value);break;case g.VOICE_RECOGNITION_DISABLED:a.setState({voiceRecognitionEnabled:!1});break;case g.VOICE_RECOGNITION_ENABLED:a.setState({voiceRecognitionEnabled:!0});break;case g.VOICE_RECOGNITION_FINISHED:a.setState({voiceRecognitionActive:!1});break;case g.VOICE_RECOGNITION_STARTED:a.setState({voiceRecognitionActive:!0})}},a._handleLayoutChange=function(e){return a.setState({language:e.language,layout:e.layout})},a._handleVoiceButtonMouseDown=function(e){e.preventDefault();var t=!a.state.voiceRecognitionActive;a.setState({voiceRecognitionActive:t}),window.vuplex.postMessage({type:t?g.VOICE_RECOGNITION_START_REQUESTED:g.VOICE_RECOGNITION_FINISH_REQUESTED})},a._initMessages=function(){window.vuplex.addEventListener(\"message\",a._handleReceivedMessage),window.vuplex.postMessage({type:g.KEYBOARD_INITIALIZED})},a._keySet.on(\"layoutChanged\",a._handleLayoutChange),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:\"componentDidMount\",value:function(){window.vuplex?this._initMessages():window.addEventListener(\"vuplexready\",this._initMessages)}},{key:\"render\",value:function(){return i.a.createElement(\"div\",{className:\"keyboard\"},i.a.createElement(\"div\",{className:\"num-pad-container\"},i.a.createElement(F,null)),i.a.createElement(\"div\",{className:\"board-margin\"}),i.a.createElement(\"div\",{className:\"center-board-container\"},i.a.createElement(O,{rows:this._keySet.getRows(),spacebarText:this._keySet.language})),i.a.createElement(\"div\",{className:\"enter-key-area\"},i.a.createElement(d,{className:\"backspace-icon\",definition:this._backspaceKeyDefinition},i.a.createElement(\"img\",{src:V.a,alt:\"backspace\"})),i.a.createElement(\"div\",{className:\"return-key-container\"},i.a.createElement(d,{definition:this._returnKeyDefinition,className:\"return-key-component\"},i.a.createElement(\"div\",{className:\"return-key\"},i.a.createElement(\"div\",{className:\"return-key-text\"},i.a.createElement(\"img\",{src:W.a,alt:\"return\"}))))),this._renderVoiceButton()),i.a.createElement(\"div\",{className:\"right-pad-container\"},i.a.createElement(H,null)))}},{key:\"_renderVoiceButton\",value:function(){if(this.state.voiceRecognitionEnabled)return i.a.createElement(\"div\",{className:\"voice-button-container\"},i.a.createElement(z,{onMouseDown:this._handleVoiceButtonMouseDown,active:this.state.voiceRecognitionActive}))}}]),t}(r.Component));o.a.render(i.a.createElement(Q,null),document.getElementById(\"root\"))}],[[17,2,1]]]);//# sourceMappingURL=main.d5c58ea6.chunk.js.map</script></body></html>";
	}
	public class LabelAttribute : PropertyAttribute
	{
		public string Label { get; private set; }

		public LabelAttribute(string label)
		{
			Label = label;
		}
	}
	internal class MockWebPlugin : IWebPlugin
	{
		private static MockWebPlugin _instance;

		public static MockWebPlugin Instance
		{
			get
			{
				if (_instance == null)
				{
					_instance = new MockWebPlugin();
				}
				return _instance;
			}
		}

		public void ClearAllData()
		{
		}

		public void CreateTexture(float width, float height, Action<Texture2D> callback)
		{
			Dispatcher.RunOnMainThread(delegate
			{
				callback(new Texture2D((int)width, (int)height, TextureFormat.RGBA32, mipChain: false));
			});
		}

		public void CreateMaterial(Action<Material> callback)
		{
			Material material = Resources.Load<Material>("MockViewportMaterial");
			material.mainTexture = Resources.Load<Texture2D>("MockWebViewTexture");
			Dispatcher.RunOnMainThread(delegate
			{
				callback(material);
			});
		}

		public void CreateVideoMaterial(Action<Material> callback)
		{
			callback(null);
		}

		public virtual IWebView CreateWebView()
		{
			return MockWebView.Instantiate();
		}

		public void SetStorageEnabled(bool enabled)
		{
		}

		public void SetUserAgent(bool mobile)
		{
		}

		public void SetUserAgent(string userAgent)
		{
		}
	}
	internal class MockWebView : MonoBehaviour, IWebView
	{
		private int _numberOfPixelsPerUnityUnit = 1300;

		public int Resolution => _numberOfPixelsPerUnityUnit;

		public Vector2 Size { get; private set; }

		public Vector2 SizeInPixels => new Vector2(Size.x * (float)_numberOfPixelsPerUnityUnit, Size.y * (float)_numberOfPixelsPerUnityUnit);

		public Texture2D Texture { get; private set; }

		public string Url { get; private set; }

		public Texture2D VideoTexture { get; private set; }

		public event EventHandler<ProgressChangedEventArgs> LoadProgressChanged;

		public event EventHandler<EventArgs<string>> MessageEmitted;

		public event EventHandler PageLoadFailed;

		public event EventHandler<EventArgs<string>> TitleChanged;

		public event EventHandler<UrlChangedEventArgs> UrlChanged;

		public event EventHandler<EventArgs<Rect>> VideoRectChanged;

		public void Init(Texture2D viewportTexture, float width, float height)
		{
			Init(viewportTexture, width, height, null);
		}

		public static MockWebView Instantiate()
		{
			return new GameObject("MockWebView").AddComponent<MockWebView>();
		}

		public void Init(Texture2D viewportTexture, float width, float height, Texture2D videoTexture)
		{
			Texture = viewportTexture;
			VideoTexture = videoTexture;
			Size = new Vector2(width, height);
			_log("Init() width: {0}, height: {1}", width.ToString("n4"), height.ToString("n4"));
		}

		public void Blur()
		{
			_log("Blur()");
		}

		public Task<bool> CanGoBack()
		{
			TaskCompletionSource<bool> taskCompletionSource = new TaskCompletionSource<bool>();
			CanGoBack(taskCompletionSource.SetResult);
			return taskCompletionSource.Task;
		}

		public Task<bool> CanGoForward()
		{
			TaskCompletionSource<bool> taskCompletionSource = new TaskCompletionSource<bool>();
			CanGoForward(taskCompletionSource.SetResult);
			return taskCompletionSource.Task;
		}

		public void CanGoBack(Action<bool> callback)
		{
			_log("CanGoBack()");
			callback(obj: false);
		}

		public void CanGoForward(Action<bool> callback)
		{
			_log("CanGoForward()");
			callback(obj: false);
		}

		public Task<byte[]> CaptureScreenshot()
		{
			TaskCompletionSource<byte[]> taskCompletionSource = new TaskCompletionSource<byte[]>();
			CaptureScreenshot(taskCompletionSource.SetResult);
			return taskCompletionSource.Task;
		}

		public void CaptureScreenshot(Action<byte[]> callback)
		{
			_log("CaptureScreenshot()");
			callback(new byte[0]);
		}

		public void Click(Vector2 point)
		{
			_log("Click({0})", point.ToString("n4"));
		}

		public void DisableViewUpdates()
		{
			_log("DisableViewUpdates()");
		}

		public void Dispose()
		{
			_log("Dispose()");
		}

		public void EnableViewUpdates()
		{
			_log("EnableViewUpdates()");
		}

		public Task<string> ExecuteJavaScript(string javaScript)
		{
			TaskCompletionSource<string> taskCompletionSource = new TaskCompletionSource<string>();
			ExecuteJavaScript(javaScript, taskCompletionSource.SetResult);
			return taskCompletionSource.Task;
		}

		public void ExecuteJavaScript(string javaScript, Action<string> callback)
		{
			_log("ExecuteJavaScript(\"{0}...\")", javaScript.Substring(0, 25));
			callback("");
		}

		public void Focus()
		{
			_log("Focus()");
		}

		public Task<byte[]> GetRawTextureData()
		{
			TaskCompletionSource<byte[]> taskCompletionSource = new TaskCompletionSource<byte[]>();
			GetRawTextureData(taskCompletionSource.SetResult);
			return taskCompletionSource.Task;
		}

		public void GetRawTextureData(Action<byte[]> callback)
		{
			_log("GetRawTextureData()");
			callback(new byte[0]);
		}

		public void GoBack()
		{
			_log("GoBack()");
		}

		public void GoForward()
		{
			_log("GoForward()");
		}

		public void HandleKeyboardInput(string input)
		{
			_log("HandleKeyboardInput(\"{0}\")", input);
		}

		public virtual void LoadHtml(string html)
		{
			Url = html.Substring(0, 25);
			_log("LoadHtml(\"{0}...\")", Url);
			if (this.UrlChanged != null)
			{
				this.UrlChanged(this, new UrlChangedEventArgs(Url, "Title", UrlActionType.Load));
			}
			if (this.LoadProgressChanged != null)
			{
				this.LoadProgressChanged(this, new ProgressChangedEventArgs(ProgressChangeType.Finished, 1f));
			}
		}

		public virtual void LoadUrl(string url)
		{
			LoadUrl(url, null);
		}

		public virtual void LoadUrl(string url, Dictionary<string, string> additionalHttpHeaders)
		{
			Url = url;
			_log("LoadUrl(\"{0}\")", url);
			if (this.UrlChanged != null)
			{
				this.UrlChanged(this, new UrlChangedEventArgs(url, "Title", UrlActionType.Load));
			}
			if (this.LoadProgressChanged != null)
			{
				this.LoadProgressChanged(this, new ProgressChangedEventArgs(ProgressChangeType.Finished, 1f));
			}
		}

		public void PostMessage(string data)
		{
			_log("PostMessage(\"{0}\")", data);
		}

		public void Reload()
		{
			_log("Reload()");
		}

		public void Resize(float width, float height)
		{
			Size = new Vector2(width, height);
			_log("Resize({0}, {1})", width.ToString("n4"), height.ToString("n4"));
		}

		public void Scroll(Vector2 delta)
		{
			_log("Scroll({0})", delta.ToString("n4"));
		}

		public void Scroll(Vector2 delta, Vector2 mousePosition)
		{
			_log("Scroll({0}, {1})", delta.ToString("n4"), mousePosition.ToString("n4"));
		}

		public void SetResolution(int pixelsPerUnityUnit)
		{
			_numberOfPixelsPerUnityUnit = pixelsPerUnityUnit;
			_log("SetResolution({0})", pixelsPerUnityUnit);
		}

		public void ZoomIn()
		{
			_log("ZoomIn()");
		}

		public void ZoomOut()
		{
			_log("ZoomOut()");
		}

		private void _log(string message, params object[] args)
		{
			UnityEngine.Debug.LogFormat("[MockWebView] " + message, args);
		}
	}
	public class ProgressChangedEventArgs : EventArgs
	{
		public readonly float Progress;

		public readonly ProgressChangeType Type;

		public ProgressChangedEventArgs(ProgressChangeType type, float progress)
		{
			Type = type;
			Progress = progress;
		}
	}
	public enum ProgressChangeType
	{
		Started,
		Finished,
		Failed,
		Updated
	}
	[Serializable]
	internal class SerializableRect
	{
		public float left;

		public float top;

		public float width;

		public float height;

		public Rect toRect()
		{
			return new Rect(left, top, width, height);
		}
	}
	[Serializable]
	internal class StringBridgeMessage : BridgeMessage
	{
		public string value;

		public static string ParseValue(string serializedMessage)
		{
			return UnityEngine.JsonUtility.FromJson<StringBridgeMessage>(serializedMessage).value;
		}
	}
	[Serializable]
	public class StringWithIdBridgeMessage : BridgeMessage
	{
		public string id;

		public string value;
	}
	[Serializable]
	public class UrlAction
	{
		public string Url;

		public string Title;

		public string Type;

		public UrlAction()
		{
		}

		public UrlAction(string url, string title, string type)
		{
			Url = url;
			Title = title;
			Type = type;
		}
	}
	public class UrlActionType
	{
		public static readonly string Load = "LOAD";

		public static readonly string PushState = "PUSH_STATE";

		public static readonly string ReplaceState = "REPLACE_STATE";

		public static readonly string HashChange = "HASH_CHANGE";
	}
	public class UrlChangedEventArgs : EventArgs
	{
		public string Url;

		public string Title;

		public string Type;

		public UrlChangedEventArgs(string url, string title, string type)
		{
			Url = url;
			Title = title;
			Type = type;
		}
	}
	[Serializable]
	internal class UrlChangedMessage : BridgeMessage
	{
		public UrlAction urlAction;
	}
	internal static class Utils
	{
		public static void EnableGammaCorrection(Material material)
		{
			if (QualitySettings.activeColorSpace == ColorSpace.Linear)
			{
				material.SetFloat("_EnableGammaCorrection", 1f);
			}
		}
	}
	[Serializable]
	internal class Video
	{
		public string videoUrl;
	}
	[Serializable]
	internal class VideoRectChangedMessage : BridgeMessage
	{
		public VideoRectChangedMessageValue value;
	}
	[Serializable]
	internal class VideoRectChangedMessageValue
	{
		public SerializableRect rect;
	}
	public class ViewportMaterialView : MonoBehaviour
	{
		public Texture2D Texture
		{
			get
			{
				return (Texture2D)GetComponent<Renderer>().material.mainTexture;
			}
			set
			{
				GetComponent<Renderer>().material.mainTexture = value;
			}
		}

		public bool Visible
		{
			get
			{
				return GetComponent<Renderer>().enabled;
			}
			set
			{
				GetComponent<Renderer>().enabled = value;
			}
		}

		public void SetCropRect(Rect rect)
		{
			GetComponent<Renderer>().material.SetVector("_CropRect", _rectToVector(rect));
		}

		public void SetCutoutRect(Rect rect)
		{
			Vector4 vector = _rectToVector(rect);
			float num = rect.width * 0.01f;
			float num2 = rect.height * 0.01f;
			Vector4 value = new Vector4(vector.x + num, vector.y + num2, vector.z - 2f * num, vector.w - 2f * num2);
			GetComponent<Renderer>().material.SetVector("_VideoCutoutRect", value);
		}

		public void SetMaterial(Material material)
		{
			GetComponent<Renderer>().material = material;
		}

		public void SetStereoToMonoOverride(bool overrideStereoToMono)
		{
			GetComponent<Renderer>().material.SetFloat("_OverrideStereoToMono", overrideStereoToMono ? 1f : 0f);
		}

		private Vector4 _rectToVector(Rect rect)
		{
			return new Vector4(rect.x, rect.y, rect.width, rect.height);
		}
	}
	public static class Web
	{
		private static WebPluginFactory _pluginFactory = new WebPluginFactory();

		public static void ClearAllData()
		{
			_pluginFactory.GetPlugin().ClearAllData();
		}

		public static void CreateMaterial(Action<Material> callback)
		{
			_pluginFactory.GetPlugin().CreateMaterial(callback);
		}

		public static void CreateVideoMaterial(Action<Material> callback)
		{
			_pluginFactory.GetPlugin().CreateVideoMaterial(callback);
		}

		public static void CreateTexture(float width, float height, Action<Texture2D> callback)
		{
			_pluginFactory.GetPlugin().CreateTexture(width, height, callback);
		}

		public static IWebView CreateWebView()
		{
			return _pluginFactory.GetPlugin().CreateWebView();
		}

		public static IWebView CreateWebView(WebPluginType[] preferredPlugins)
		{
			return _pluginFactory.GetPlugin(preferredPlugins).CreateWebView();
		}

		public static void SetStorageEnabled(bool enabled)
		{
			_pluginFactory.GetPlugin().SetStorageEnabled(enabled);
		}

		public static void SetUserAgent(bool mobile)
		{
			_pluginFactory.GetPlugin().SetUserAgent(mobile);
		}

		public static void SetUserAgent(string userAgent)
		{
			_pluginFactory.GetPlugin().SetUserAgent(userAgent);
		}

		internal static void SetPluginFactory(WebPluginFactory pluginFactory)
		{
			_pluginFactory = pluginFactory;
		}
	}
	internal class WebPluginFactory
	{
		protected static IWebPlugin _androidPlugin;

		protected static IWebPlugin _androidGeckoPlugin;

		protected static IWebPlugin _iosPlugin;

		protected static IWebPlugin _macPlugin;

		protected static IWebPlugin _mockPlugin = MockWebPlugin.Instance;

		private const string MORE_INFO_TEXT = " For more info, please visit https://developer.vuplex.com";

		protected static IWebPlugin _windowsPlugin;

		public virtual IWebPlugin GetPlugin()
		{
			return GetPlugin(null);
		}

		public virtual IWebPlugin GetPlugin(WebPluginType[] preferredPlugins)
		{
			bool flag = preferredPlugins?.Contains(WebPluginType.Android) ?? false;
			if (_androidPlugin != null && (_androidGeckoPlugin == null || flag))
			{
				return _androidPlugin;
			}
			if (_androidGeckoPlugin != null)
			{
				return _androidGeckoPlugin;
			}
			throw new WebViewUnavailableException("The 3D WebView for Android plugin is not currently installed. For more info, please visit https://developer.vuplex.com");
		}

		public static void RegisterAndroidPlugin(IWebPlugin plugin)
		{
			_androidPlugin = plugin;
		}

		public static void RegisterAndroidGeckoPlugin(IWebPlugin plugin)
		{
			_androidGeckoPlugin = plugin;
		}

		public static void RegisterIOSPlugin(IWebPlugin plugin)
		{
			_iosPlugin = plugin;
		}

		public static void RegisterMacPlugin(IWebPlugin plugin)
		{
			_macPlugin = plugin;
		}

		public static void RegisterMockPlugin(IWebPlugin plugin)
		{
			_mockPlugin = plugin;
		}

		public static void RegisterWindowsPlugin(IWebPlugin plugin)
		{
			_windowsPlugin = plugin;
		}
	}
	public struct WebViewOptions
	{
		public bool disableVideo;

		public WebPluginType[] preferredPlugins;
	}
	public class WebViewPrefab : MonoBehaviour
	{
		[Label("Initial URL to load (optional)")]
		public string InitialUrl;

		private Vector2 _beginningDragPoint;

		private Vector2 _beginningDragRatioPoint;

		private bool _clickingEnabled = true;

		private bool _clickIsPending;

		private float _dragToScrollThreshold = 0.15f;

		private WebViewOptions _options;

		private Vector2 _previousDragPoint;

		private bool _scrollingEnabled = true;

		private static float _scrollSensitivity = 0.005f;

		private ViewportMaterialView _videoLayer;

		private bool _videoLayerDisabled;

		private Transform _videoRectPositioner;

		protected WebViewPrefabView _view;

		private Transform _viewResizer;

		protected IWebView _webView;

		private GameObject _webViewGameObject;

		public bool ClickingEnabled
		{
			get
			{
				return _clickingEnabled;
			}
			set
			{
				_clickingEnabled = value;
			}
		}

		public float DragToScrollThreshold
		{
			get
			{
				return _dragToScrollThreshold;
			}
			set
			{
				_dragToScrollThreshold = value;
			}
		}

		public bool ScrollingEnabled
		{
			get
			{
				return _scrollingEnabled;
			}
			set
			{
				_scrollingEnabled = value;
			}
		}

		public static float ScrollSensitivity
		{
			get
			{
				return _scrollSensitivity;
			}
			set
			{
				_scrollSensitivity = value;
			}
		}

		public bool Visible
		{
			get
			{
				if (!_getView().Visible)
				{
					return _getVideoLayer().Visible;
				}
				return true;
			}
			set
			{
				_getView().Visible = value;
				_getVideoLayer().Visible = value;
			}
		}

		public IWebView WebView => _webView;

		public event EventHandler Clicked;

		public event EventHandler Initialized;

		public static WebViewPrefab Instantiate(float width, float height)
		{
			return Instantiate(width, height, default(WebViewOptions));
		}

		public static WebViewPrefab Instantiate(float width, float height, WebViewOptions options)
		{
			WebViewPrefab component = UnityEngine.Object.Instantiate((GameObject)Resources.Load("WebViewPrefab")).GetComponent<WebViewPrefab>();
			component.Init(width, height, options);
			return component;
		}

		public void Init(WebViewOptions options)
		{
			Vector3 localScale = base.transform.localScale;
			_ = base.transform.localPosition;
			base.transform.localScale = new Vector3(1f, 1f, localScale.z);
			float x = 0.5f * localScale.x;
			base.transform.localPosition = base.transform.localPosition + Quaternion.Euler(base.transform.localEulerAngles) * new Vector3(x, 0f, 0f);
			Init(localScale.x, localScale.y, options);
		}

		public virtual void Init(float width, float height)
		{
			Init(width, height, default(WebViewOptions));
		}

		public virtual void Init(float width, float height, WebViewOptions options)
		{
			_options = options;
			_viewResizer = base.transform.GetChild(0);
			_setViewSize(width, height);
			_initView();
			Web.CreateMaterial(delegate(Material viewportMaterial)
			{
				_view.SetMaterial(viewportMaterial);
				_initWebViewIfReady();
			});
			_videoRectPositioner = _getVideoRectPositioner();
			_initVideoLayer();
			if (options.disableVideo)
			{
				_videoLayerDisabled = true;
				_videoRectPositioner.gameObject.SetActive(value: false);
				_initWebViewIfReady();
				return;
			}
			Web.CreateVideoMaterial(delegate(Material videoMaterial)
			{
				if (videoMaterial == null)
				{
					_videoLayerDisabled = true;
					_videoRectPositioner.gameObject.SetActive(value: false);
				}
				else
				{
					_videoLayer.SetMaterial(videoMaterial);
				}
				_initWebViewIfReady();
			});
		}

		public void Destroy()
		{
			UnityEngine.Object.Destroy(base.gameObject);
		}

		public void Resize(float width, float height)
		{
			if (_webView != null)
			{
				_webView.Resize(width, height);
			}
			_setViewSize(width, height);
		}

		private void _attachWebViewEventHandlers()
		{
			if (!_options.disableVideo)
			{
				_webView.VideoRectChanged += delegate(object sender, EventArgs<Rect> e)
				{
					_setVideoRect(e.Value);
				};
			}
		}

		private void Awake()
		{
			if (!string.IsNullOrEmpty(InitialUrl))
			{
				Init(default(WebViewOptions));
			}
		}

		private Vector2 _convertRatioPointToUnityUnits(Vector2 point)
		{
			float x = _viewResizer.transform.localScale.x * point.x;
			float y = _viewResizer.transform.localScale.y * point.y;
			return new Vector2(x, y);
		}

		protected Vector2 _convertToScreenPosition(RaycastResult raycastResult)
		{
			Vector3 vector = _viewResizer.transform.InverseTransformPoint(raycastResult.worldPosition);
			return new Vector2(1f - vector.x, -1f * vector.y);
		}

		private void _scrollIfNeeded(Vector2 scrollDelta, Vector2 mousePosition)
		{
			if (_scrollingEnabled && (scrollDelta.x != 0f || scrollDelta.y != 0f))
			{
				_webView.Scroll(scrollDelta, mousePosition);
			}
		}

		private ViewportMaterialView _getVideoLayer()
		{
			return _getVideoRectPositioner().GetComponentInChildren<ViewportMaterialView>();
		}

		private Transform _getVideoRectPositioner()
		{
			return base.transform.GetChild(0).Find("VideoRectPositioner");
		}

		protected virtual WebViewPrefabView _getView()
		{
			return base.transform.GetComponentInChildren<WebViewPrefabView>();
		}

		private void _initVideoLayer()
		{
			_videoLayer = _getVideoLayer();
		}

		private void _initView()
		{
			_view = _getView();
			_view.gameObject.layer = LayerMask.NameToLayer("Physics");
			_view.gameObject.tag = "WebView";
			_view.BeganDrag += View_BeganDrag;
			_view.Dragged += View_Dragged;
			_view.PointerDown += View_PointerDown;
			_view.PointerUp += View_PointerUp;
			_view.Scrolled += View_Scrolled;
		}

		private void _initWebViewIfReady()
		{
			if (_view.Texture == null || (!_videoLayerDisabled && _videoLayer.Texture == null))
			{
				return;
			}
			_webView = Web.CreateWebView(_options.preferredPlugins);
			MonoBehaviour monoBehaviour = _webView as MonoBehaviour;
			if (monoBehaviour != null)
			{
				_webViewGameObject = monoBehaviour.gameObject;
			}
			_attachWebViewEventHandlers();
			_webView.Init(_view.Texture, _viewResizer.localScale.x, _viewResizer.localScale.y, _videoLayer.Texture);
			_setVideoRect(new Rect(0f, 0f, 0f, 0f));
			this.Initialized?.Invoke(this, EventArgs.Empty);
			if (!string.IsNullOrEmpty(InitialUrl))
			{
				string text = InitialUrl.Trim();
				if (!text.StartsWith("http"))
				{
					text = "http://" + text;
				}
				_webView.LoadUrl(text);
			}
		}

		private void OnDestroy()
		{
			if (_webView != null)
			{
				_webView.Dispose();
			}
		}

		private void _reinitAfterScriptsReloaded()
		{
			if (_webViewGameObject == null)
			{
				UnityEngine.Debug.LogWarning("The IWebView is not a MonoBehaviour, so the reference to it cannot be recovered after the scripts were recompiled in the editor.");
				return;
			}
			_webView = _webViewGameObject.GetComponentInChildren<IWebView>();
			_attachWebViewEventHandlers();
			_initView();
			_initVideoLayer();
		}

		private void _setVideoRect(Rect videoRect)
		{
			_view.SetCutoutRect(videoRect);
			_videoRectPositioner.localPosition = new Vector3(1f - (videoRect.x + videoRect.width), -1f * videoRect.y, _videoRectPositioner.localPosition.z);
			_videoRectPositioner.localScale = new Vector3(videoRect.width, videoRect.height, _videoRectPositioner.localScale.z);
			float xmin = Math.Max(0f, -1f * videoRect.x / videoRect.width);
			float ymin = Math.Max(0f, -1f * videoRect.y / videoRect.height);
			float xmax = Math.Min(1f, (1f - videoRect.x) / videoRect.width);
			float ymax = Math.Min(1f, (1f - videoRect.y) / videoRect.height);
			Rect rect = Rect.MinMaxRect(xmin, ymin, xmax, ymax);
			if (rect == new Rect(0f, 0f, 1f, 1f))
			{
				rect = new Rect(0f, 0f, 0f, 0f);
			}
			_videoLayer.SetCropRect(rect);
		}

		private void _setViewSize(float width, float height)
		{
			float z = _viewResizer.localScale.z;
			_viewResizer.localScale = new Vector3(width, height, z);
			Vector3 localPosition = _viewResizer.localPosition;
			localPosition.x = width * -0.5f;
			_viewResizer.localPosition = localPosition;
		}

		private void View_BeganDrag(object sender, EventArgs<PointerEventData> e)
		{
			_beginningDragRatioPoint = _convertToScreenPosition(e.Value.pointerCurrentRaycast);
			_beginningDragPoint = _convertRatioPointToUnityUnits(_beginningDragRatioPoint);
			_previousDragPoint = _beginningDragPoint;
		}

		private void View_Dragged(object sender, EventArgs<PointerEventData> e)
		{
			if (e.Value.pointerCurrentRaycast.worldPosition == new Vector3(0f, 0f, 0f))
			{
				return;
			}
			Vector2 point = _convertToScreenPosition(e.Value.pointerCurrentRaycast);
			Vector2 vector = _convertRatioPointToUnityUnits(point);
			Vector2 scrollDelta = _previousDragPoint - vector;
			_scrollIfNeeded(scrollDelta, _beginningDragRatioPoint);
			_previousDragPoint = vector;
			if (_clickIsPending)
			{
				Vector2 vector2 = _beginningDragPoint - vector;
				if (Math.Abs(vector2.x) > _dragToScrollThreshold || Math.Abs(vector2.y) > _dragToScrollThreshold)
				{
					_clickIsPending = false;
				}
			}
		}

		protected virtual void View_PointerDown(object sender, EventArgs<PointerEventData> e)
		{
			if (_clickingEnabled)
			{
				_clickIsPending = true;
			}
		}

		protected virtual void View_PointerUp(object sender, EventArgs<PointerEventData> e)
		{
			if (_clickingEnabled && _clickIsPending)
			{
				_clickIsPending = false;
				Vector2 point = _convertToScreenPosition(e.Value.pointerPressRaycast);
				_webView.Click(point);
				if (this.Clicked != null)
				{
					this.Clicked(this, EventArgs.Empty);
				}
			}
		}

		private void View_Scrolled(object sender, EventArgs<PointerEventData> e)
		{
			Vector2 scrollDelta = new Vector2((0f - e.Value.scrollDelta.x) * _scrollSensitivity, (0f - e.Value.scrollDelta.y) * _scrollSensitivity);
			Vector2 mousePosition = _convertToScreenPosition(e.Value.pointerCurrentRaycast);
			_scrollIfNeeded(scrollDelta, mousePosition);
		}
	}
	public class WebViewPrefabView : ViewportMaterialView, IBeginDragHandler, IEventSystemHandler, IDragHandler, IPointerDownHandler, IPointerUpHandler, IScrollHandler
	{
		public event EventHandler<EventArgs<PointerEventData>> BeganDrag;

		public event EventHandler<EventArgs<PointerEventData>> Dragged;

		public event EventHandler<EventArgs<PointerEventData>> PointerDown;

		public event EventHandler<EventArgs<PointerEventData>> PointerUp;

		public event EventHandler<EventArgs<PointerEventData>> Scrolled;

		public void OnBeginDrag(PointerEventData data)
		{
			if (this.BeganDrag != null)
			{
				this.BeganDrag(this, new EventArgs<PointerEventData>(data));
			}
		}

		public void OnDrag(PointerEventData eventData)
		{
			if (this.Dragged != null)
			{
				this.Dragged(this, new EventArgs<PointerEventData>(eventData));
			}
		}

		public virtual void OnPointerDown(PointerEventData eventData)
		{
			if (this.PointerDown != null)
			{
				this.PointerDown(this, new EventArgs<PointerEventData>(eventData));
			}
		}

		public virtual void OnPointerUp(PointerEventData eventData)
		{
			if (this.PointerUp != null)
			{
				this.PointerUp(this, new EventArgs<PointerEventData>(eventData));
			}
		}

		public void OnScroll(PointerEventData eventData)
		{
			if (this.Scrolled != null)
			{
				this.Scrolled(this, new EventArgs<PointerEventData>(eventData));
			}
		}
	}
	internal class WebViewUnavailableException : Exception
	{
		public WebViewUnavailableException(string message)
			: base(message)
		{
		}
	}
}
namespace Vuplex.WebView.Demos
{
	internal class AdvancedWebViewDemo : MonoBehaviour
	{
		private System.Timers.Timer _buttonRefreshTimer = new System.Timers.Timer();

		private WebViewPrefab _controlsWebViewPrefab;

		private HardwareKeyboardListener _hardwareKeyboardListener;

		private WebViewPrefab _mainWebViewPrefab;

		private const string CONTROLS_HTML = "\n            <!DOCTYPE html>\n            <html>\n                <head>\n                    <!-- This transparent meta tag instructs 3D WebView to allow the page to be transparent. -->\n                    <meta name='transparent' content='true'>\n                    <meta charset='UTF-8'>\n                    <style>\n                        body {\n                            font-family: Helvetica, Arial, Sans-Serif;\n                            margin: 0;\n                            height: 100vh;\n                            color: white;\n                        }\n                        .controls {\n                            display: flex;\n                            justify-content: space-between;\n                            align-items: center;\n                            height: 100%;\n                        }\n                        .controls > div {\n                            background-color: rgba(0, 0, 0, 0.3);\n                            border-radius: 8px;\n                            height: 100%;\n                        }\n                        .url-display {\n                            flex: 0 0 75%;\n                            width: 75%;\n                            display: flex;\n                            align-items: center;\n                            overflow: hidden;\n                        }\n                        #url {\n                            width: 100%;\n                            white-space: nowrap;\n                            overflow: hidden;\n                            text-overflow: ellipsis;\n                            padding: 0 15px;\n                            font-size: 18px;\n                        }\n                        .buttons {\n                            flex: 0 0 20%;\n                            width: 20%;\n                            display: flex;\n                            justify-content: space-around;\n                            align-items: center;\n                        }\n                        .buttons > button {\n                            font-size: 40px;\n                            background: none;\n                            border: none;\n                            outline: none;\n                            color: white;\n                            margin: 0;\n                            padding: 0;\n                        }\n                        .buttons > button:disabled {\n                            color: rgba(255, 255, 255, 0.3);\n                        }\n                        .buttons > button:last-child {\n                            transform: scaleX(-1);\n                        }\n                    </style>\n                </head>\n                <body>\n                    <div class='controls'>\n                        <div class='url-display'>\n                            <div id='url'></div>\n                        </div>\n                        <div class='buttons'>\n                            <button id='back-button' disabled='true' onclick='vuplex.postMessage({ type: \"GO_BACK\" })'>←</button>\n                            <button id='forward-button' disabled='true' onclick='vuplex.postMessage({ type: \"GO_FORWARD\" })'>←</button>\n                        </div>\n                    </div>\n                    <script>\n                        // Handle messages sent from C#\n                        function handleMessage(message) {\n                            var data = JSON.parse(message.data);\n                            if (data.type === 'SET_URL') {\n                                document.getElementById('url').innerText = data.url;\n                            } else if (data.type === 'SET_BUTTONS') {\n                                document.getElementById('back-button').disabled = !data.canGoBack;\n                                document.getElementById('forward-button').disabled = !data.canGoForward;\n                            }\n                        }\n\n                        function attachMessageListener() {\n                            window.vuplex.addEventListener('message', handleMessage);\n                        }\n\n                        if (window.vuplex) {\n                            attachMessageListener();\n                        } else {\n                            window.addEventListener('vuplexready', attachMessageListener);\n                        }\n                    </script>\n                </body>\n            </html>\n        ";

		private void Start()
		{
			_mainWebViewPrefab = WebViewPrefab.Instantiate(0.6f, 0.3f);
			_mainWebViewPrefab.transform.parent = base.transform;
			_mainWebViewPrefab.transform.localPosition = new Vector3(0f, -0.05f, 0.4f);
			_mainWebViewPrefab.transform.localEulerAngles = new Vector3(0f, 180f, 0f);
			_mainWebViewPrefab.Initialized += delegate
			{
				_mainWebViewPrefab.WebView.UrlChanged += MainWebView_UrlChanged;
				_mainWebViewPrefab.WebView.LoadUrl("https://www.google.com");
			};
			_hardwareKeyboardListener = HardwareKeyboardListener.Instantiate();
			HardwareKeyboardListener hardwareKeyboardListener = _hardwareKeyboardListener;
			hardwareKeyboardListener.InputReceived = (EventHandler<EventArgs<string>>)Delegate.Combine(hardwareKeyboardListener.InputReceived, (EventHandler<EventArgs<string>>)delegate(object sender, EventArgs<string> eventArgs)
			{
				_mainWebViewPrefab.WebView.HandleKeyboardInput(eventArgs.Value);
			});
			Keyboard keyboard = Keyboard.Instantiate();
			keyboard.transform.parent = _mainWebViewPrefab.transform;
			keyboard.transform.localPosition = new Vector3(0f, -0.31f, 0f);
			keyboard.transform.localEulerAngles = Vector3.zero;
			keyboard.InputReceived += delegate(object sender, EventArgs<string> eventArgs)
			{
				_mainWebViewPrefab.WebView.HandleKeyboardInput(eventArgs.Value);
			};
			_controlsWebViewPrefab = WebViewPrefab.Instantiate(0.6f, 0.05f);
			_controlsWebViewPrefab.transform.parent = _mainWebViewPrefab.transform;
			_controlsWebViewPrefab.transform.localPosition = new Vector3(0f, 0.06f, 0f);
			_controlsWebViewPrefab.transform.localEulerAngles = Vector3.zero;
			_controlsWebViewPrefab.Initialized += delegate
			{
				_controlsWebViewPrefab.WebView.LoadHtml("\n            <!DOCTYPE html>\n            <html>\n                <head>\n                    <!-- This transparent meta tag instructs 3D WebView to allow the page to be transparent. -->\n                    <meta name='transparent' content='true'>\n                    <meta charset='UTF-8'>\n                    <style>\n                        body {\n                            font-family: Helvetica, Arial, Sans-Serif;\n                            margin: 0;\n                            height: 100vh;\n                            color: white;\n                        }\n                        .controls {\n                            display: flex;\n                            justify-content: space-between;\n                            align-items: center;\n                            height: 100%;\n                        }\n                        .controls > div {\n                            background-color: rgba(0, 0, 0, 0.3);\n                            border-radius: 8px;\n                            height: 100%;\n                        }\n                        .url-display {\n                            flex: 0 0 75%;\n                            width: 75%;\n                            display: flex;\n                            align-items: center;\n                            overflow: hidden;\n                        }\n                        #url {\n                            width: 100%;\n                            white-space: nowrap;\n                            overflow: hidden;\n                            text-overflow: ellipsis;\n                            padding: 0 15px;\n                            font-size: 18px;\n                        }\n                        .buttons {\n                            flex: 0 0 20%;\n                            width: 20%;\n                            display: flex;\n                            justify-content: space-around;\n                            align-items: center;\n                        }\n                        .buttons > button {\n                            font-size: 40px;\n                            background: none;\n                            border: none;\n                            outline: none;\n                            color: white;\n                            margin: 0;\n                            padding: 0;\n                        }\n                        .buttons > button:disabled {\n                            color: rgba(255, 255, 255, 0.3);\n                        }\n                        .buttons > button:last-child {\n                            transform: scaleX(-1);\n                        }\n                    </style>\n                </head>\n                <body>\n                    <div class='controls'>\n                        <div class='url-display'>\n                            <div id='url'></div>\n                        </div>\n                        <div class='buttons'>\n                            <button id='back-button' disabled='true' onclick='vuplex.postMessage({ type: \"GO_BACK\" })'>←</button>\n                            <button id='forward-button' disabled='true' onclick='vuplex.postMessage({ type: \"GO_FORWARD\" })'>←</button>\n                        </div>\n                    </div>\n                    <script>\n                        // Handle messages sent from C#\n                        function handleMessage(message) {\n                            var data = JSON.parse(message.data);\n                            if (data.type === 'SET_URL') {\n                                document.getElementById('url').innerText = data.url;\n                            } else if (data.type === 'SET_BUTTONS') {\n                                document.getElementById('back-button').disabled = !data.canGoBack;\n                                document.getElementById('forward-button').disabled = !data.canGoForward;\n                            }\n                        }\n\n                        function attachMessageListener() {\n                            window.vuplex.addEventListener('message', handleMessage);\n                        }\n\n                        if (window.vuplex) {\n                            attachMessageListener();\n                        } else {\n                            window.addEventListener('vuplexready', attachMessageListener);\n                        }\n                    </script>\n                </body>\n            </html>\n        ");
				_controlsWebViewPrefab.WebView.MessageEmitted += Controls_MessageEmitted;
			};
			_buttonRefreshTimer.AutoReset = false;
			_buttonRefreshTimer.Interval = 1000.0;
			_buttonRefreshTimer.Elapsed += ButtonRefreshTimer_Elapsed;
		}

		private void ButtonRefreshTimer_Elapsed(object sender, ElapsedEventArgs eventArgs)
		{
			Dispatcher.RunOnMainThread(delegate
			{
				_mainWebViewPrefab.WebView.CanGoBack(delegate(bool canGoBack)
				{
					_mainWebViewPrefab.WebView.CanGoForward(delegate(bool canGoForward)
					{
						string data = $"{{ \"type\": \"SET_BUTTONS\", \"canGoBack\": {canGoBack.ToString().ToLower()}, \"canGoForward\": {canGoForward.ToString().ToLower()} }}";
						_controlsWebViewPrefab.WebView.PostMessage(data);
					});
				});
			});
		}

		private void Controls_MessageEmitted(object sender, EventArgs<string> eventArgs)
		{
			string text = BridgeMessage.ParseType(eventArgs.Value);
			if (text == "GO_BACK")
			{
				_mainWebViewPrefab.WebView.GoBack();
			}
			else if (text == "GO_FORWARD")
			{
				_mainWebViewPrefab.WebView.GoForward();
			}
		}

		private void MainWebView_UrlChanged(object sender, UrlChangedEventArgs eventArgs)
		{
			if (_controlsWebViewPrefab.WebView != null)
			{
				string data = $"{{ \"type\": \"SET_URL\", \"url\": \"{eventArgs.Url}\" }}";
				_controlsWebViewPrefab.WebView.PostMessage(data);
			}
			_buttonRefreshTimer.Start();
		}
	}
	internal class CameraRotator : MonoBehaviour
	{
		public GameObject InstructionMessage;

		private Vector2 _rotationFromMouse;

		private void Start()
		{
			if (!XRSettings.enabled)
			{
				Input.gyro.enabled = true;
			}
			if (UnityEngine.Application.isEditor && InstructionMessage != null)
			{
				InstructionMessage.SetActive(value: true);
			}
			else
			{
				InstructionMessage = null;
			}
		}

		private void Update()
		{
			if (InstructionMessage != null && Input.GetMouseButtonDown(0))
			{
				InstructionMessage.SetActive(value: false);
				InstructionMessage = null;
			}
			if (!XRSettings.enabled)
			{
				if (SystemInfo.supportsGyroscope)
				{
					Camera.main.transform.Rotate(0f - Input.gyro.rotationRateUnbiased.x, 0f - Input.gyro.rotationRateUnbiased.y, Input.gyro.rotationRateUnbiased.z);
				}
				else if (Input.GetKey(KeyCode.LeftControl) || Input.GetKey(KeyCode.RightControl))
				{
					float num = 10f;
					float num2 = 80f;
					_rotationFromMouse.x += Input.GetAxis("Mouse X") * num;
					_rotationFromMouse.y -= Input.GetAxis("Mouse Y") * num;
					_rotationFromMouse.x = Mathf.Repeat(_rotationFromMouse.x, 360f);
					_rotationFromMouse.y = Mathf.Clamp(_rotationFromMouse.y, 0f - num2, num2);
					Camera.main.transform.rotation = Quaternion.Euler(_rotationFromMouse.y, _rotationFromMouse.x, 0f);
				}
			}
		}
	}
	internal class CanvasWebViewDemo : MonoBehaviour
	{
		private CanvasWebViewPrefab _canvasWebViewPrefab;

		private HardwareKeyboardListener _hardwareKeyboardListener;

		private void Start()
		{
			_canvasWebViewPrefab = GameObject.Find("CanvasWebViewPrefab").GetComponent<CanvasWebViewPrefab>();
			_hardwareKeyboardListener = HardwareKeyboardListener.Instantiate();
			HardwareKeyboardListener hardwareKeyboardListener = _hardwareKeyboardListener;
			hardwareKeyboardListener.InputReceived = (EventHandler<EventArgs<string>>)Delegate.Combine(hardwareKeyboardListener.InputReceived, (EventHandler<EventArgs<string>>)delegate(object sender, EventArgs<string> eventArgs)
			{
				_canvasWebViewPrefab.WebView.HandleKeyboardInput(eventArgs.Value);
			});
		}
	}
	internal class HardwareKeyboardListener : MonoBehaviour
	{
		public EventHandler<EventArgs<string>> InputReceived;

		public static HardwareKeyboardListener Instantiate()
		{
			return new GameObject("HardwareKeyboardListener").AddComponent<HardwareKeyboardListener>();
		}

		private void Update()
		{
			EventHandler<EventArgs<string>> inputReceived = InputReceived;
			if (inputReceived != null)
			{
				string inputString = Input.inputString;
				for (int i = 0; i < inputString.Length; i++)
				{
					char c = inputString[i];
					inputReceived(this, new EventArgs<string>(c switch
					{
						'\b' => "Backspace", 
						'\n' => "Enter", 
						_ => c.ToString(), 
					}));
				}
				if (Input.GetKeyDown(KeyCode.UpArrow))
				{
					inputReceived(this, new EventArgs<string>("ArrowUp"));
				}
				if (Input.GetKeyDown(KeyCode.DownArrow))
				{
					inputReceived(this, new EventArgs<string>("ArrowDown"));
				}
				if (Input.GetKeyDown(KeyCode.RightArrow))
				{
					inputReceived(this, new EventArgs<string>("ArrowRight"));
				}
				if (Input.GetKeyDown(KeyCode.LeftArrow))
				{
					inputReceived(this, new EventArgs<string>("ArrowLeft"));
				}
			}
		}
	}
	internal class SimpleWebViewDemo : MonoBehaviour
	{
		private HardwareKeyboardListener _hardwareKeyboardListener;

		private WebViewPrefab _webViewPrefab;

		private void Start()
		{
			_webViewPrefab = GameObject.Find("WebViewPrefab").GetComponent<WebViewPrefab>();
			_hardwareKeyboardListener = HardwareKeyboardListener.Instantiate();
			HardwareKeyboardListener hardwareKeyboardListener = _hardwareKeyboardListener;
			hardwareKeyboardListener.InputReceived = (EventHandler<EventArgs<string>>)Delegate.Combine(hardwareKeyboardListener.InputReceived, (EventHandler<EventArgs<string>>)delegate(object sender, EventArgs<string> eventArgs)
			{
				_webViewPrefab.WebView.HandleKeyboardInput(eventArgs.Value);
			});
			Keyboard keyboard = Keyboard.Instantiate();
			keyboard.transform.parent = _webViewPrefab.transform;
			keyboard.transform.localPosition = new Vector3(0f, -0.31f, 0f);
			keyboard.transform.localEulerAngles = new Vector3(0f, 0f, 0f);
			keyboard.InputReceived += delegate(object sender, EventArgs<string> e)
			{
				_webViewPrefab.WebView.HandleKeyboardInput(e.Value);
			};
		}
	}
}
namespace UnityStandardAssets.Utility
{
	public class AutoMoveAndRotate : MonoBehaviour
	{
		[Serializable]
		public class Vector3andSpace
		{
			public Vector3 value;

			public Space space = Space.Self;
		}

		public Vector3andSpace moveUnitsPerSecond;

		public Vector3andSpace rotateDegreesPerSecond;

		public bool ignoreTimescale;

		private float m_LastRealTime;

		private void Start()
		{
			m_LastRealTime = Time.realtimeSinceStartup;
		}

		private void Update()
		{
			float num = Time.deltaTime;
			if (ignoreTimescale)
			{
				num = Time.realtimeSinceStartup - m_LastRealTime;
				m_LastRealTime = Time.realtimeSinceStartup;
			}
			base.transform.Translate(moveUnitsPerSecond.value * num, moveUnitsPerSecond.space);
			base.transform.Rotate(rotateDegreesPerSecond.value * num, moveUnitsPerSecond.space);
		}
	}
}
namespace Obi
{
	[ExecuteInEditMode]
	[RequireComponent(typeof(Camera))]
	public abstract class ObiBaseFluidRenderer : MonoBehaviour
	{
		public ObiParticleRenderer[] particleRenderers;

		public bool autoupdate = true;

		protected CommandBuffer renderFluid;

		protected Camera currentCam;

		private void Awake()
		{
			currentCam = GetComponent<Camera>();
		}

		public void OnEnable()
		{
			GetComponent<Camera>().forceIntoRenderTexture = true;
			DestroyCommandBuffer();
			Cleanup();
		}

		public void OnDisable()
		{
			DestroyCommandBuffer();
			Cleanup();
		}

		protected Material CreateMaterial(Shader shader)
		{
			if (!shader || !shader.isSupported)
			{
				return null;
			}
			return new Material(shader)
			{
				hideFlags = HideFlags.HideAndDontSave
			};
		}

		protected virtual void Setup()
		{
		}

		protected virtual void Cleanup()
		{
		}

		public abstract void UpdateFluidRenderingCommandBuffer();

		private void DestroyCommandBuffer()
		{
			if (renderFluid != null)
			{
				GetComponent<Camera>().RemoveCommandBuffer(CameraEvent.BeforeImageEffectsOpaque, renderFluid);
				renderFluid = null;
			}
		}

		private void OnPreRender()
		{
			if (!base.gameObject.activeInHierarchy || !base.enabled || particleRenderers == null || particleRenderers.Length == 0)
			{
				DestroyCommandBuffer();
				Cleanup();
				return;
			}
			Setup();
			if (renderFluid == null)
			{
				renderFluid = new CommandBuffer();
				renderFluid.name = "Render fluid";
				UpdateFluidRenderingCommandBuffer();
				currentCam.AddCommandBuffer(CameraEvent.BeforeImageEffectsOpaque, renderFluid);
			}
			else if (autoupdate)
			{
				UpdateFluidRenderingCommandBuffer();
			}
		}
	}
	[ExecuteInEditMode]
	[RequireComponent(typeof(ObiCollider))]
	public class ObiDistanceFieldRenderer : MonoBehaviour
	{
		public enum Axis
		{
			X,
			Y,
			Z
		}

		public Axis axis;

		[Range(0f, 1f)]
		public float slice = 0.25f;

		public float maxDistance = 0.5f;

		private ObiCollider unityCollider;

		private Material material;

		private Mesh planeMesh;

		private Texture2D cutawayTexture;

		private float sampleSize;

		private int sampleCount;

		private Color boundsColor = new Color(1f, 1f, 1f, 0.5f);

		public void Awake()
		{
			unityCollider = GetComponent<ObiCollider>();
		}

		public void OnEnable()
		{
			material = UnityEngine.Object.Instantiate(Resources.Load<Material>("ObiMaterials/DistanceFieldRendering"));
			material.hideFlags = HideFlags.HideAndDontSave;
		}

		public void OnDisable()
		{
			Cleanup();
		}

		private void Cleanup()
		{
			UnityEngine.Object.DestroyImmediate(cutawayTexture);
			UnityEngine.Object.DestroyImmediate(planeMesh);
			UnityEngine.Object.DestroyImmediate(material);
		}

		private void ResizeTexture()
		{
			if (cutawayTexture == null)
			{
				cutawayTexture = new Texture2D(sampleCount, sampleCount, TextureFormat.RHalf, mipChain: false);
				cutawayTexture.wrapMode = TextureWrapMode.Clamp;
				cutawayTexture.hideFlags = HideFlags.HideAndDontSave;
			}
			else
			{
				cutawayTexture.Resize(sampleCount, sampleCount);
			}
		}

		private void CreatePlaneMesh(ObiDistanceField field)
		{
			if (field != null && planeMesh == null)
			{
				float num = (1f - field.FieldBounds.size[0] / (sampleSize * (float)sampleCount)) * 0.5f;
				planeMesh = new Mesh();
				planeMesh.vertices = new Vector3[4]
				{
					new Vector3(-0.5f, -0.5f, 0f),
					new Vector3(0.5f, -0.5f, 0f),
					new Vector3(-0.5f, 0.5f, 0f),
					new Vector3(0.5f, 0.5f, 0f)
				};
				planeMesh.uv = new Vector2[4]
				{
					new Vector2(num, num),
					new Vector2(1f - num, num),
					new Vector2(num, 1f - num),
					new Vector2(1f - num, 1f - num)
				};
				planeMesh.normals = new Vector3[4]
				{
					-Vector3.forward,
					-Vector3.forward,
					-Vector3.forward,
					-Vector3.forward
				};
				planeMesh.triangles = new int[6] { 0, 2, 1, 2, 3, 1 };
			}
		}

		private void RefreshCutawayTexture(ObiDistanceField field)
		{
			if (field == null)
			{
				return;
			}
			Bounds fieldBounds = field.FieldBounds;
			sampleSize = field.EffectiveSampleSize;
			sampleCount = (int)(fieldBounds.size[0] / sampleSize) + 1;
			CreatePlaneMesh(field);
			ResizeTexture();
			float num = (float)sampleCount * slice * sampleSize;
			Vector3 vector = fieldBounds.center - fieldBounds.extents;
			for (int i = 0; i < sampleCount; i++)
			{
				for (int j = 0; j < sampleCount; j++)
				{
					Vector3 vector2 = Vector3.zero;
					switch (axis)
					{
					case Axis.X:
						vector2 = new Vector3(num, (float)j * sampleSize, (float)i * sampleSize);
						break;
					case Axis.Y:
						vector2 = new Vector3((float)i * sampleSize, num, (float)j * sampleSize);
						break;
					case Axis.Z:
						vector2 = new Vector3((float)i * sampleSize, (float)j * sampleSize, num);
						break;
					}
					Vector4 vector3 = vector + vector2;
					float r = Oni.SampleDistanceField(field.OniDistanceField, vector3.x, vector3.y, vector3.z).Remap(0f - maxDistance, maxDistance, 0f, 1f);
					cutawayTexture.SetPixel(i, j, new Color(r, 0f, 0f));
				}
			}
			cutawayTexture.Apply();
		}

		private void DrawCutawayPlane(ObiDistanceField field, Matrix4x4 matrix)
		{
			if (!(field == null))
			{
				RefreshCutawayTexture(field);
				material.mainTexture = cutawayTexture;
				material.SetPass(0);
				Quaternion q = Quaternion.identity;
				Vector3 zero = Vector3.zero;
				zero[(int)axis] = field.FieldBounds.size[0];
				if (axis == Axis.Y)
				{
					q = Quaternion.Euler(90f, 0f, 0f);
				}
				else if (axis == Axis.X)
				{
					q = Quaternion.Euler(0f, -90f, 0f);
				}
				Matrix4x4 matrix4x = Matrix4x4.TRS(field.FieldBounds.center + zero * (slice - 0.5f), q, Vector3.one * field.FieldBounds.size[0]);
				Graphics.DrawMeshNow(planeMesh, matrix * matrix4x);
			}
		}

		public void OnDrawGizmos()
		{
			if (unityCollider != null && unityCollider.distanceField != null && unityCollider.distanceField.Initialized && material != null)
			{
				DrawCutawayPlane(unityCollider.distanceField, base.transform.localToWorldMatrix);
				Gizmos.color = boundsColor;
				Gizmos.DrawWireCube(unityCollider.distanceField.FieldBounds.center, unityCollider.distanceField.FieldBounds.size);
			}
		}
	}
	[ExecuteInEditMode]
	[RequireComponent(typeof(ObiActor))]
	public class ObiParticleRenderer : MonoBehaviour
	{
		public bool render = true;

		public Shader shader;

		public Color particleColor = Color.white;

		public float radiusScale = 1f;

		private ObiActor actor;

		private List<Mesh> meshes = new List<Mesh>();

		private Material material;

		private List<Vector3> vertices = new List<Vector3>(4000);

		private List<Vector3> normals = new List<Vector3>(4000);

		private List<Color> colors = new List<Color>(4000);

		private List<int> triangles = new List<int>(6000);

		private List<Vector4> anisotropy1 = new List<Vector4>(4000);

		private List<Vector4> anisotropy2 = new List<Vector4>(4000);

		private List<Vector4> anisotropy3 = new List<Vector4>(4000);

		private int particlesPerDrawcall;

		private int drawcallCount;

		private bool subscribed;

		private Vector3[] particleOffsets = new Vector3[4]
		{
			new Vector3(1f, 1f, 0f),
			new Vector3(-1f, 1f, 0f),
			new Vector3(-1f, -1f, 0f),
			new Vector3(1f, -1f, 0f)
		};

		public IEnumerable<Mesh> ParticleMeshes => meshes;

		public Material ParticleMaterial => material;

		public void Awake()
		{
			actor = GetComponent<ObiActor>();
			particlesPerDrawcall = 16250;
			drawcallCount = actor.positions.Length / particlesPerDrawcall + 1;
			particlesPerDrawcall = Mathf.Min(particlesPerDrawcall, actor.positions.Length);
			actor.OnAddedToSolver += delegate
			{
				Subscribe();
			};
			actor.OnRemovedFromSolver += delegate
			{
				Unsubscribe();
			};
		}

		private void Subscribe()
		{
			if (!subscribed && actor.Solver != null)
			{
				subscribed = true;
				actor.Solver.RequireRenderablePositions();
				actor.Solver.OnFrameEnd += Actor_solver_OnFrameEnd;
			}
		}

		private void Unsubscribe()
		{
			if (subscribed && actor.Solver != null)
			{
				subscribed = false;
				actor.Solver.RelinquishRenderablePositions();
				actor.Solver.OnFrameEnd -= Actor_solver_OnFrameEnd;
			}
		}

		public void OnEnable()
		{
			Subscribe();
		}

		public void OnDisable()
		{
			Unsubscribe();
			ClearMeshes();
			UnityEngine.Object.DestroyImmediate(material);
		}

		private void CreateMaterialIfNeeded()
		{
			if (shader != null)
			{
				if (!shader.isSupported)
				{
					UnityEngine.Debug.LogWarning("Particle rendering shader not suported.");
				}
				if (material == null || material.shader != shader)
				{
					UnityEngine.Object.DestroyImmediate(material);
					material = new Material(shader);
					material.hideFlags = HideFlags.HideAndDontSave;
				}
			}
		}

		private void Actor_solver_OnFrameEnd(object sender, EventArgs e)
		{
			if (!base.isActiveAndEnabled || !actor.isActiveAndEnabled || !actor.InSolver)
			{
				ClearMeshes();
				return;
			}
			CreateMaterialIfNeeded();
			ObiSolver solver = actor.Solver;
			if (drawcallCount != meshes.Count)
			{
				ClearMeshes();
				for (int i = 0; i < drawcallCount; i++)
				{
					Mesh mesh = new Mesh();
					mesh.name = "Particle imposters";
					mesh.hideFlags = HideFlags.HideAndDontSave;
					mesh.MarkDynamic();
					meshes.Add(mesh);
				}
			}
			for (int j = 0; j < drawcallCount; j++)
			{
				vertices.Clear();
				normals.Clear();
				colors.Clear();
				triangles.Clear();
				anisotropy1.Clear();
				anisotropy2.Clear();
				anisotropy3.Clear();
				int num = 0;
				for (int k = j * particlesPerDrawcall; k < (j + 1) * particlesPerDrawcall && k < actor.active.Length; k++)
				{
					if (actor.active[k])
					{
						AddParticle(num, solver.renderablePositions[actor.particleIndices[k]], solver.anisotropies[actor.particleIndices[k]], (actor.colors != null && k < actor.colors.Length) ? actor.colors[k] : Color.white);
						num += 4;
					}
				}
				Apply(meshes[j]);
			}
			DrawParticles();
		}

		private void DrawParticles()
		{
			if (!(material != null))
			{
				return;
			}
			material.SetFloat("_RadiusScale", radiusScale);
			material.SetColor("_Color", particleColor);
			if (!render)
			{
				return;
			}
			foreach (Mesh mesh in meshes)
			{
				Graphics.DrawMesh(mesh, Matrix4x4.identity, material, base.gameObject.layer);
			}
		}

		private void Apply(Mesh mesh)
		{
			mesh.Clear();
			mesh.SetVertices(vertices);
			mesh.SetNormals(normals);
			mesh.SetColors(colors);
			mesh.SetUVs(0, anisotropy1);
			mesh.SetUVs(1, anisotropy2);
			mesh.SetUVs(2, anisotropy3);
			mesh.SetTriangles(triangles, 0, calculateBounds: true);
		}

		private void ClearMeshes()
		{
			foreach (Mesh mesh in meshes)
			{
				UnityEngine.Object.DestroyImmediate(mesh);
			}
			meshes.Clear();
		}

		private void AddParticle(int i, Vector3 position, Oni.Anisotropy anisotropy, Color color)
		{
			vertices.Add(position);
			vertices.Add(position);
			vertices.Add(position);
			vertices.Add(position);
			normals.Add(particleOffsets[0]);
			normals.Add(particleOffsets[1]);
			normals.Add(particleOffsets[2]);
			normals.Add(particleOffsets[3]);
			colors.Add(color);
			colors.Add(color);
			colors.Add(color);
			colors.Add(color);
			anisotropy1.Add(anisotropy.b1);
			anisotropy1.Add(anisotropy.b1);
			anisotropy1.Add(anisotropy.b1);
			anisotropy1.Add(anisotropy.b1);
			anisotropy2.Add(anisotropy.b2);
			anisotropy2.Add(anisotropy.b2);
			anisotropy2.Add(anisotropy.b2);
			anisotropy2.Add(anisotropy.b2);
			anisotropy3.Add(anisotropy.b3);
			anisotropy3.Add(anisotropy.b3);
			anisotropy3.Add(anisotropy.b3);
			anisotropy3.Add(anisotropy.b3);
			triangles.Add(i + 2);
			triangles.Add(i + 1);
			triangles.Add(i);
			triangles.Add(i + 3);
			triangles.Add(i + 2);
			triangles.Add(i);
		}
	}
	public class ShadowmapExposer : MonoBehaviour
	{
		private Light unityLight;

		private CommandBuffer afterShadow;

		public ObiParticleRenderer[] particleRenderers;

		public void Awake()
		{
			unityLight = GetComponent<Light>();
		}

		public void OnEnable()
		{
			Cleanup();
			afterShadow = new CommandBuffer();
			afterShadow.name = "FluidShadows";
			unityLight.AddCommandBuffer(LightEvent.AfterShadowMapPass, afterShadow);
		}

		public void OnDisable()
		{
			Cleanup();
		}

		private void Cleanup()
		{
			if (afterShadow != null)
			{
				unityLight.RemoveCommandBuffer(LightEvent.AfterShadowMapPass, afterShadow);
				afterShadow = null;
			}
		}

		public void SetupFluidShadowsCommandBuffer()
		{
			afterShadow.Clear();
			if (particleRenderers == null)
			{
				return;
			}
			ObiParticleRenderer[] array = particleRenderers;
			foreach (ObiParticleRenderer obiParticleRenderer in array)
			{
				if (!(obiParticleRenderer != null))
				{
					continue;
				}
				foreach (Mesh particleMesh in obiParticleRenderer.ParticleMeshes)
				{
					afterShadow.DrawMesh(particleMesh, Matrix4x4.identity, obiParticleRenderer.ParticleMaterial, 0, 1);
				}
			}
		}

		private void Update()
		{
			if (!base.gameObject.activeInHierarchy || !base.enabled || particleRenderers == null || particleRenderers.Length == 0)
			{
				Cleanup();
			}
			else if (afterShadow != null)
			{
				SetupFluidShadowsCommandBuffer();
			}
		}
	}
	[RequireComponent(typeof(Rigidbody))]
	[RequireComponent(typeof(CapsuleCollider))]
	[RequireComponent(typeof(Animator))]
	public class ObiCharacter : MonoBehaviour
	{
		[SerializeField]
		private float m_MovingTurnSpeed = 360f;

		[SerializeField]
		private float m_StationaryTurnSpeed = 180f;

		[SerializeField]
		private float m_JumpPower = 12f;

		[Range(1f, 4f)]
		[SerializeField]
		private float m_GravityMultiplier = 2f;

		[SerializeField]
		private float m_RunCycleLegOffset = 0.2f;

		[SerializeField]
		private float m_MoveSpeedMultiplier = 1f;

		[SerializeField]
		private float m_AnimSpeedMultiplier = 1f;

		[SerializeField]
		private float m_GroundCheckDistance = 0.1f;

		private Rigidbody m_Rigidbody;

		private Animator m_Animator;

		private bool m_IsGrounded;

		private float m_OrigGroundCheckDistance;

		private const float k_Half = 0.5f;

		private float m_TurnAmount;

		private float m_ForwardAmount;

		private Vector3 m_GroundNormal;

		private float m_CapsuleHeight;

		private Vector3 m_CapsuleCenter;

		private CapsuleCollider m_Capsule;

		private bool m_Crouching;

		private void Start()
		{
			Physics.IgnoreLayerCollision(LayerMask.NameToLayer("Default"), LayerMask.NameToLayer("Ignore Raycast"), ignore: true);
			m_Animator = GetComponent<Animator>();
			m_Rigidbody = GetComponent<Rigidbody>();
			m_Capsule = GetComponent<CapsuleCollider>();
			m_CapsuleHeight = m_Capsule.height;
			m_CapsuleCenter = m_Capsule.center;
			m_Rigidbody.constraints = RigidbodyConstraints.FreezeRotation;
			m_OrigGroundCheckDistance = m_GroundCheckDistance;
		}

		public void Move(Vector3 move, bool crouch, bool jump)
		{
			if (move.magnitude > 1f)
			{
				move.Normalize();
			}
			move = base.transform.InverseTransformDirection(move);
			CheckGroundStatus();
			move = Vector3.ProjectOnPlane(move, m_GroundNormal);
			m_TurnAmount = Mathf.Atan2(move.x, move.z);
			m_ForwardAmount = move.z;
			ApplyExtraTurnRotation();
			if (m_IsGrounded)
			{
				HandleGroundedMovement(crouch, jump);
			}
			else
			{
				HandleAirborneMovement();
			}
			ScaleCapsuleForCrouching(crouch);
			PreventStandingInLowHeadroom();
			UpdateAnimator(move);
		}

		private void ScaleCapsuleForCrouching(bool crouch)
		{
			if (m_IsGrounded && crouch)
			{
				if (!m_Crouching)
				{
					m_Capsule.height /= 2f;
					m_Capsule.center /= 2f;
					m_Crouching = true;
				}
			}
			else if (Physics.SphereCast(new Ray(m_Rigidbody.position + Vector3.up * m_Capsule.radius * 0.5f, Vector3.up), maxDistance: m_CapsuleHeight - m_Capsule.radius * 0.5f, radius: m_Capsule.radius * 0.5f, layerMask: -5, queryTriggerInteraction: QueryTriggerInteraction.Ignore))
			{
				m_Crouching = true;
			}
			else
			{
				m_Capsule.height = m_CapsuleHeight;
				m_Capsule.center = m_CapsuleCenter;
				m_Crouching = false;
			}
		}

		private void PreventStandingInLowHeadroom()
		{
			if (!m_Crouching && Physics.SphereCast(new Ray(m_Rigidbody.position + Vector3.up * m_Capsule.radius * 0.5f, Vector3.up), maxDistance: m_CapsuleHeight - m_Capsule.radius * 0.5f, radius: m_Capsule.radius * 0.5f, layerMask: -5, queryTriggerInteraction: QueryTriggerInteraction.Ignore))
			{
				m_Crouching = true;
			}
		}

		private void UpdateAnimator(Vector3 move)
		{
			m_Animator.SetFloat("Forward", m_ForwardAmount, 0.1f, Time.deltaTime);
			m_Animator.SetFloat("Turn", m_TurnAmount, 0.1f, Time.deltaTime);
			m_Animator.SetBool("Crouch", m_Crouching);
			m_Animator.SetBool("OnGround", m_IsGrounded);
			if (!m_IsGrounded)
			{
				m_Animator.SetFloat("Jump", m_Rigidbody.velocity.y);
			}
			float value = (float)((Mathf.Repeat(m_Animator.GetCurrentAnimatorStateInfo(0).normalizedTime + m_RunCycleLegOffset, 1f) < 0.5f) ? 1 : (-1)) * m_ForwardAmount;
			if (m_IsGrounded)
			{
				m_Animator.SetFloat("JumpLeg", value);
			}
			if (m_IsGrounded && move.magnitude > 0f)
			{
				m_Animator.speed = m_AnimSpeedMultiplier;
			}
			else
			{
				m_Animator.speed = 1f;
			}
		}

		private void HandleAirborneMovement()
		{
			Vector3 force = Physics.gravity * m_GravityMultiplier - Physics.gravity;
			m_Rigidbody.AddForce(force);
			m_GroundCheckDistance = ((m_Rigidbody.velocity.y < 0f) ? m_OrigGroundCheckDistance : 0.01f);
		}

		private void HandleGroundedMovement(bool crouch, bool jump)
		{
			if (jump && !crouch && m_Animator.GetCurrentAnimatorStateInfo(0).IsName("Grounded"))
			{
				m_Rigidbody.velocity = new Vector3(m_Rigidbody.velocity.x, m_JumpPower, m_Rigidbody.velocity.z);
				m_IsGrounded = false;
				m_Animator.applyRootMotion = false;
				m_GroundCheckDistance = 0.1f;
			}
		}

		private void ApplyExtraTurnRotation()
		{
			float num = Mathf.Lerp(m_StationaryTurnSpeed, m_MovingTurnSpeed, m_ForwardAmount);
			base.transform.Rotate(0f, m_TurnAmount * num * Time.deltaTime, 0f);
		}

		public void OnAnimatorMove()
		{
			if (m_IsGrounded && Time.deltaTime > 0f)
			{
				Vector3 velocity = m_Animator.deltaPosition * m_MoveSpeedMultiplier / Time.deltaTime;
				velocity.y = m_Rigidbody.velocity.y;
				m_Rigidbody.velocity = velocity;
			}
		}

		private void CheckGroundStatus()
		{
			if (Physics.Raycast(base.transform.position + Vector3.up * 0.1f, Vector3.down, out var hitInfo, m_GroundCheckDistance, -5))
			{
				m_GroundNormal = hitInfo.normal;
				m_IsGrounded = true;
				m_Animator.applyRootMotion = true;
			}
			else
			{
				m_IsGrounded = false;
				m_GroundNormal = Vector3.up;
				m_Animator.applyRootMotion = false;
			}
		}
	}
	[RequireComponent(typeof(ObiCharacter))]
	public class ObiCharacterController : MonoBehaviour
	{
		private ObiCharacter m_Character;

		private Transform m_Cam;

		private Vector3 m_CamForward;

		private Vector3 m_Move;

		private bool m_Jump;

		private void Start()
		{
			if (Camera.main != null)
			{
				m_Cam = Camera.main.transform;
			}
			else
			{
				UnityEngine.Debug.LogWarning("Warning: no main camera found. Third person character needs a Camera tagged \"MainCamera\", for camera-relative controls.");
			}
			m_Character = GetComponent<ObiCharacter>();
		}

		private void Update()
		{
			if (!m_Jump)
			{
				m_Jump = Input.GetButtonDown("Jump");
			}
		}

		private void FixedUpdate()
		{
			float axis = Input.GetAxis("Horizontal");
			float axis2 = Input.GetAxis("Vertical");
			bool key = Input.GetKey(KeyCode.C);
			if (m_Cam != null)
			{
				m_CamForward = Vector3.Scale(m_Cam.forward, new Vector3(1f, 0f, 1f)).normalized;
				m_Move = axis2 * m_CamForward + axis * m_Cam.right;
			}
			else
			{
				m_Move = axis2 * Vector3.forward + axis * Vector3.right;
			}
			m_Character.Move(m_Move, key, m_Jump);
			m_Jump = false;
		}
	}
	[ExecuteInEditMode]
	[DisallowMultipleComponent]
	public abstract class ObiActor : MonoBehaviour, IObiSolverClient
	{
		public class ObiActorSolverArgs : EventArgs
		{
			private ObiSolver solver;

			public ObiSolver Solver => solver;

			public ObiActorSolverArgs(ObiSolver solver)
			{
				this.solver = solver;
			}
		}

		public enum TetherType
		{
			AnchorToFixed,
			Hierarchical
		}

		[SerializeProperty("Solver")]
		[SerializeField]
		protected ObiSolver solver;

		[SerializeProperty("CollisionMaterial")]
		[SerializeField]
		protected ObiCollisionMaterial collisionMaterial;

		[SerializeProperty("SelfCollisions")]
		[SerializeField]
		protected bool selfCollisions;

		[NonSerialized]
		[HideInInspector]
		public int[] particleIndices;

		protected ObiBatchedConstraints[] constraints;

		[HideInInspector]
		public bool[] active;

		[HideInInspector]
		public Vector3[] positions;

		[HideInInspector]
		public Vector4[] restPositions;

		[HideInInspector]
		public Quaternion[] orientations;

		[HideInInspector]
		public Vector3[] velocities;

		[HideInInspector]
		public Vector3[] angularVelocities;

		[HideInInspector]
		public float[] invMasses;

		[HideInInspector]
		public float[] solidRadii;

		[HideInInspector]
		public Vector2[] principalRadii;

		[HideInInspector]
		public int[] phases;

		[HideInInspector]
		public Color[] colors;

		[HideInInspector]
		public int[] deformableTriangles = new int[0];

		[NonSerialized]
		protected int trianglesOffset;

		[SerializeField]
		[HideInInspector]
		protected Matrix4x4 initialScaleMatrix = Matrix4x4.identity;

		private bool inSolver;

		protected bool initializing;

		[HideInInspector]
		[SerializeField]
		protected bool initialized;

		public ObiSolver Solver
		{
			get
			{
				return solver;
			}
			set
			{
				if (solver != value)
				{
					RemoveFromSolver(null);
					solver = value;
				}
			}
		}

		public ObiCollisionMaterial CollisionMaterial
		{
			get
			{
				return collisionMaterial;
			}
			set
			{
				if (collisionMaterial != value)
				{
					collisionMaterial = value;
					PushDataToSolver(ParticleData.COLLISION_MATERIAL);
				}
			}
		}

		public bool Initializing => initializing;

		public bool Initialized => initialized;

		public bool InSolver => inSolver;

		public bool SelfCollisions
		{
			get
			{
				return selfCollisions;
			}
			set
			{
				if (value != selfCollisions)
				{
					selfCollisions = value;
					UpdateParticlePhases();
				}
			}
		}

		public Matrix4x4 InitialScaleMatrix => initialScaleMatrix;

		public virtual Matrix4x4 ActorLocalToWorldMatrix => base.transform.localToWorldMatrix;

		public virtual Matrix4x4 ActorWorldToLocalMatrix => base.transform.worldToLocalMatrix;

		public virtual bool UsesCustomExternalForces => false;

		public event EventHandler<ObiActorSolverArgs> OnAddedToSolver;

		public event EventHandler<ObiActorSolverArgs> OnRemovedFromSolver;

		public event EventHandler OnInitialized;

		public virtual void Awake()
		{
		}

		public virtual void Start()
		{
			if (UnityEngine.Application.isPlaying)
			{
				AddToSolver(null);
			}
		}

		public virtual void OnDestroy()
		{
			RemoveFromSolver(null);
		}

		public virtual void DestroyRequiredComponents()
		{
		}

		public virtual void OnEnable()
		{
			ObiBatchedConstraints[] components = GetComponents<ObiBatchedConstraints>();
			constraints = new ObiBatchedConstraints[12];
			ObiBatchedConstraints[] array = components;
			foreach (ObiBatchedConstraints obiBatchedConstraints in array)
			{
				constraints[(int)obiBatchedConstraints.GetConstraintType()] = obiBatchedConstraints;
				obiBatchedConstraints.GrabActor();
				if (obiBatchedConstraints.isActiveAndEnabled)
				{
					obiBatchedConstraints.OnEnable();
				}
			}
			if (InSolver)
			{
				solver.UpdateActiveParticles();
				solver.UpdateVisibility();
			}
		}

		public virtual void OnDisable()
		{
			if (!InSolver)
			{
				return;
			}
			solver.UpdateActiveParticles();
			PullDataFromSolver(ParticleData.POSITIONS | ParticleData.VELOCITIES);
			ObiBatchedConstraints[] array = constraints;
			foreach (ObiBatchedConstraints obiBatchedConstraints in array)
			{
				if (obiBatchedConstraints != null)
				{
					obiBatchedConstraints.OnDisable();
				}
			}
			solver.UpdateVisibility();
		}

		public IEnumerator GeneratePhysicRepresentationForMesh()
		{
			IEnumerator g = Initialize();
			while (g.MoveNext())
			{
				yield return g.Current;
			}
			if (this.OnInitialized != null)
			{
				this.OnInitialized(this, null);
			}
		}

		protected abstract IEnumerator Initialize();

		public virtual void ResetActor()
		{
		}

		public virtual void UpdateParticlePhases()
		{
			if (InSolver)
			{
				for (int i = 0; i < phases.Length; i++)
				{
					phases[i] = Oni.MakePhase(Oni.GetGroupFromPhase(phases[i]), selfCollisions ? Oni.ParticlePhase.SelfCollide : ((Oni.ParticlePhase)0));
				}
				PushDataToSolver(ParticleData.PHASES);
			}
		}

		public virtual bool AddToSolver(object info)
		{
			if (solver != null && !InSolver)
			{
				if (!solver.AddActor(this, positions.Length))
				{
					UnityEngine.Debug.LogWarning("Obi: Solver could not allocate enough particles for this actor. Please increase max particles.");
					return false;
				}
				inSolver = true;
				UpdateParticlePhases();
				trianglesOffset = Oni.GetDeformableTriangleCount(solver.OniSolver);
				UpdateDeformableTriangles();
				PushDataToSolver(ParticleData.ALL);
				ObiBatchedConstraints[] array = constraints;
				foreach (ObiBatchedConstraints obiBatchedConstraints in array)
				{
					if (obiBatchedConstraints != null)
					{
						obiBatchedConstraints.AddToSolver(null);
					}
				}
				if (this.OnAddedToSolver != null)
				{
					this.OnAddedToSolver(this, new ObiActorSolverArgs(solver));
				}
				return true;
			}
			return false;
		}

		public void UpdateDeformableTriangles()
		{
			int[] array = new int[deformableTriangles.Length];
			for (int i = 0; i < deformableTriangles.Length; i++)
			{
				array[i] = particleIndices[deformableTriangles[i]];
			}
			Oni.SetDeformableTriangles(solver.OniSolver, array, array.Length / 3, trianglesOffset);
		}

		public virtual bool RemoveFromSolver(object info)
		{
			if (solver != null && InSolver)
			{
				ObiBatchedConstraints[] array = constraints;
				foreach (ObiBatchedConstraints obiBatchedConstraints in array)
				{
					if (obiBatchedConstraints != null)
					{
						obiBatchedConstraints.RemoveFromSolver(null);
					}
				}
				Vector4[] array2 = new Vector4[1]
				{
					new Vector4(0f, 0f, 0f, 1f)
				};
				for (int j = 0; j < particleIndices.Length; j++)
				{
					Oni.SetRestPositions(solver.OniSolver, array2, 1, particleIndices[j]);
				}
				int num = solver.RemoveActor(this);
				particleIndices = null;
				for (int k = num; k < solver.actors.Count; k++)
				{
					solver.actors[k].trianglesOffset -= deformableTriangles.Length / 3;
				}
				Oni.RemoveDeformableTriangles(solver.OniSolver, deformableTriangles.Length / 3, trianglesOffset);
				inSolver = false;
				if (this.OnRemovedFromSolver != null)
				{
					this.OnRemovedFromSolver(this, new ObiActorSolverArgs(solver));
				}
				return true;
			}
			return false;
		}

		public virtual void PushDataToSolver(ParticleData data = ParticleData.NONE)
		{
			if (!InSolver)
			{
				return;
			}
			Matrix4x4 matrix4x = ((!Solver.simulateInLocalSpace) ? (ActorLocalToWorldMatrix * initialScaleMatrix.inverse) : (Solver.transform.worldToLocalMatrix * ActorLocalToWorldMatrix * initialScaleMatrix.inverse));
			for (int i = 0; i < particleIndices.Length; i++)
			{
				int destOffset = particleIndices[i];
				if ((data & ParticleData.POSITIONS) != 0 && i < positions.Length)
				{
					Oni.SetParticlePositions(solver.OniSolver, new Vector4[1] { matrix4x.MultiplyPoint3x4(positions[i]) }, 1, destOffset);
				}
				if ((data & ParticleData.ORIENTATIONS) != 0 && orientations != null && i < orientations.Length)
				{
					Oni.SetParticleOrientations(solver.OniSolver, new Quaternion[1] { orientations[i] }, 1, destOffset);
				}
				if ((data & ParticleData.VELOCITIES) != 0 && i < velocities.Length)
				{
					Oni.SetParticleVelocities(solver.OniSolver, new Vector4[1] { matrix4x.MultiplyVector(velocities[i]) }, 1, destOffset);
				}
				if ((data & ParticleData.ANGULAR_VELOCITIES) != 0 && angularVelocities != null && i < angularVelocities.Length)
				{
					Oni.SetParticleAngularVelocities(solver.OniSolver, new Vector4[1] { matrix4x.MultiplyVector(angularVelocities[i]) }, 1, destOffset);
				}
				if ((data & ParticleData.INV_MASSES) != 0 && i < invMasses.Length)
				{
					Oni.SetParticleInverseMasses(solver.OniSolver, new float[1] { invMasses[i] }, 1, destOffset);
				}
				if ((data & ParticleData.SOLID_RADII) != 0 && i < solidRadii.Length)
				{
					Oni.SetParticleSolidRadii(solver.OniSolver, new float[1] { solidRadii[i] }, 1, destOffset);
				}
				if ((data & ParticleData.PRINCIPAL_RADII) != 0 && principalRadii != null && i < principalRadii.Length)
				{
					Oni.SetParticlePrincipalRadii(solver.OniSolver, new Vector2[1] { principalRadii[i] }, 1, destOffset);
				}
				if ((data & ParticleData.PHASES) != 0 && i < phases.Length)
				{
					Oni.SetParticlePhases(solver.OniSolver, new int[1] { phases[i] }, 1, destOffset);
				}
				if ((data & ParticleData.REST_POSITIONS) != 0 && i < restPositions.Length)
				{
					Oni.SetRestPositions(solver.OniSolver, new Vector4[1] { restPositions[i] }, 1, destOffset);
				}
			}
			if ((data & ParticleData.COLLISION_MATERIAL) != 0)
			{
				IntPtr[] array = new IntPtr[particleIndices.Length];
				for (int j = 0; j < particleIndices.Length; j++)
				{
					array[j] = ((collisionMaterial != null) ? collisionMaterial.OniCollisionMaterial : IntPtr.Zero);
				}
				Oni.SetCollisionMaterials(solver.OniSolver, array, particleIndices, particleIndices.Length);
			}
			if ((data & ParticleData.ACTIVE_STATUS) != 0)
			{
				solver.UpdateActiveParticles();
			}
		}

		public virtual void PullDataFromSolver(ParticleData data = ParticleData.NONE)
		{
			if (!InSolver)
			{
				return;
			}
			Matrix4x4 inverse = ((!Solver.simulateInLocalSpace) ? (ActorLocalToWorldMatrix * initialScaleMatrix.inverse) : (Solver.transform.worldToLocalMatrix * ActorLocalToWorldMatrix * initialScaleMatrix.inverse)).inverse;
			for (int i = 0; i < particleIndices.Length; i++)
			{
				int sourceOffset = particleIndices[i];
				if ((data & ParticleData.POSITIONS) != 0)
				{
					Vector4[] array = new Vector4[1] { positions[i] };
					Oni.GetParticlePositions(solver.OniSolver, array, 1, sourceOffset);
					positions[i] = inverse.MultiplyPoint3x4(array[0]);
				}
				if ((data & ParticleData.ORIENTATIONS) != 0 && orientations != null)
				{
					Quaternion[] array2 = new Quaternion[1] { orientations[i] };
					Oni.GetParticleOrientations(solver.OniSolver, array2, 1, sourceOffset);
					orientations[i] = array2[0];
				}
				if ((data & ParticleData.VELOCITIES) != 0)
				{
					Vector4[] array3 = new Vector4[1] { velocities[i] };
					Oni.GetParticleVelocities(solver.OniSolver, array3, 1, sourceOffset);
					velocities[i] = inverse.MultiplyVector(array3[0]);
				}
				if ((data & ParticleData.ANGULAR_VELOCITIES) != 0 && angularVelocities != null)
				{
					Vector4[] array4 = new Vector4[1] { angularVelocities[i] };
					Oni.GetParticleAngularVelocities(solver.OniSolver, array4, 1, sourceOffset);
					angularVelocities[i] = inverse.MultiplyVector(array4[0]);
				}
			}
		}

		public Vector3 GetParticlePosition(int index)
		{
			if (InSolver)
			{
				return solver.renderablePositions[particleIndices[index]];
			}
			return (ActorLocalToWorldMatrix * initialScaleMatrix.inverse).MultiplyPoint3x4(positions[index]);
		}

		public virtual bool GenerateTethers(TetherType type)
		{
			return true;
		}

		public void ClearTethers()
		{
			if (constraints[0] != null)
			{
				((ObiTetherConstraints)constraints[0]).Clear();
			}
		}

		public virtual void OnSolverPreInterpolation()
		{
		}

		public virtual void OnSolverStepBegin()
		{
			if (!base.transform.hasChanged && !Solver.transform.hasChanged)
			{
				return;
			}
			base.transform.hasChanged = false;
			Solver.transform.hasChanged = false;
			bool flag = base.enabled;
			int num = particleIndices.Length;
			Vector4[] array = new Vector4[1] { Vector4.zero };
			Matrix4x4 matrix4x = ((!Solver.simulateInLocalSpace) ? (ActorLocalToWorldMatrix * initialScaleMatrix.inverse) : (Solver.transform.worldToLocalMatrix * ActorLocalToWorldMatrix * initialScaleMatrix.inverse));
			for (int i = 0; i < num; i++)
			{
				if (!flag || invMasses[i] == 0f)
				{
					array[0] = matrix4x.MultiplyPoint3x4(positions[i]);
					Oni.SetParticlePositions(solver.OniSolver, array, 1, particleIndices[i]);
				}
			}
		}

		public virtual void OnSolverStepEnd()
		{
		}

		public virtual void OnSolverFrameBegin()
		{
		}

		public virtual void OnSolverFrameEnd()
		{
		}

		public virtual void OnSolverVisibilityChanged(bool visible)
		{
		}

		public virtual bool ReadParticlePropertyFromTexture(Texture2D source, Action<int, Color> onReadProperty)
		{
			return false;
		}
	}
	[ExecuteInEditMode]
	[AddComponentMenu("Physics/Obi/Obi Bone")]
	[RequireComponent(typeof(ObiDistanceConstraints))]
	[RequireComponent(typeof(ObiBendingConstraints))]
	[RequireComponent(typeof(ObiSkinConstraints))]
	public class ObiBone : ObiActor
	{
		public const float DEFAULT_PARTICLE_MASS = 0.1f;

		public const float MAX_YOUNG_MODULUS = 20f;

		public const float MIN_YOUNG_MODULUS = 0.0001f;

		[Tooltip("Initial particle radius.")]
		public float particleRadius = 0.05f;

		[HideInInspector]
		[SerializeField]
		private List<Transform> bones;

		[HideInInspector]
		[SerializeField]
		private int[] parentIndices;

		[HideInInspector]
		public bool[] frozen;

		protected ObiAnimatorController animatorController;

		public ObiSkinConstraints SkinConstraints => constraints[8] as ObiSkinConstraints;

		public ObiDistanceConstraints DistanceConstraints => constraints[3] as ObiDistanceConstraints;

		public ObiBendingConstraints BendingConstraints => constraints[2] as ObiBendingConstraints;

		public override void Awake()
		{
			base.Awake();
			SetupAnimatorController();
		}

		public void OnValidate()
		{
			particleRadius = Mathf.Max(0f, particleRadius);
		}

		public override void OnSolverFrameEnd()
		{
			base.OnSolverFrameEnd();
			UpdateBones();
		}

		public override bool AddToSolver(object info)
		{
			if (base.Initialized && base.AddToSolver(info))
			{
				solver.RequireRenderablePositions();
				return true;
			}
			return false;
		}

		public override bool RemoveFromSolver(object info)
		{
			if (solver != null)
			{
				solver.RelinquishRenderablePositions();
			}
			return base.RemoveFromSolver(info);
		}

		private void SetupAnimatorController()
		{
			Animator componentInParent = GetComponentInParent<Animator>();
			if (componentInParent != null)
			{
				animatorController = componentInParent.GetComponent<ObiAnimatorController>();
				if (animatorController == null)
				{
					animatorController = componentInParent.gameObject.AddComponent<ObiAnimatorController>();
				}
			}
		}

		private IEnumerable EnumerateBonesBreadthFirst()
		{
			int count = 0;
			Queue<Transform> queue = new Queue<Transform>();
			queue.Enqueue(base.transform);
			while (queue.Count > 0)
			{
				Transform current = queue.Dequeue();
				if (!(current != null))
				{
					continue;
				}
				count++;
				yield return current;
				foreach (Transform item in current.transform)
				{
					queue.Enqueue(item);
				}
				if (current == base.transform && count > 1)
				{
					yield return null;
				}
			}
		}

		protected override IEnumerator Initialize()
		{
			initialized = false;
			initializing = true;
			RemoveFromSolver(null);
			bones = new List<Transform>();
			foreach (Transform item in EnumerateBonesBreadthFirst())
			{
				bones.Add(item);
			}
			parentIndices = new int[bones.Count];
			active = new bool[bones.Count];
			positions = new Vector3[bones.Count];
			velocities = new Vector3[bones.Count];
			invMasses = new float[bones.Count];
			solidRadii = new float[bones.Count];
			phases = new int[bones.Count];
			restPositions = new Vector4[bones.Count];
			frozen = new bool[bones.Count];
			DistanceConstraints.Clear();
			ObiDistanceConstraintBatch distanceBatch = new ObiDistanceConstraintBatch(cooked: false, sharesParticles: false, 0.0001f, 20f);
			DistanceConstraints.AddBatch(distanceBatch);
			BendingConstraints.Clear();
			ObiBendConstraintBatch bendingBatch = new ObiBendConstraintBatch(cooked: false, sharesParticles: false, 0.0001f, 20f);
			BendingConstraints.AddBatch(bendingBatch);
			SkinConstraints.Clear();
			ObiSkinConstraintBatch skinBatch = new ObiSkinConstraintBatch(cooked: true, sharesParticles: false, 0.0001f, 20f);
			SkinConstraints.AddBatch(skinBatch);
			int i = 0;
			while (i < bones.Count)
			{
				active[i] = true;
				invMasses[i] = 10f;
				positions[i] = base.transform.InverseTransformPoint(bones[i].position);
				restPositions[i] = positions[i];
				restPositions[i][3] = 0f;
				solidRadii[i] = particleRadius;
				frozen[i] = false;
				phases[i] = Oni.MakePhase(1, selfCollisions ? Oni.ParticlePhase.SelfCollide : ((Oni.ParticlePhase)0));
				parentIndices[i] = -1;
				if (bones[i].parent != null)
				{
					parentIndices[i] = bones.IndexOf(bones[i].parent);
				}
				skinBatch.AddConstraint(i, positions[i], Vector3.up, 0.05f, 0f, 0f, 1f);
				foreach (Transform item2 in bones[i])
				{
					int num = bones.IndexOf(item2);
					if (num >= 0)
					{
						distanceBatch.AddConstraint(i, num, Vector3.Distance(bones[i].position, item2.position), 1f, 1f);
						if (parentIndices[i] >= 0)
						{
							Transform transform2 = bones[parentIndices[i]];
							float restBend = Oni.BendingConstraintRest(new float[9]
							{
								transform2.position[0],
								transform2.position[1],
								transform2.position[2],
								item2.position[0],
								item2.position[1],
								item2.position[2],
								bones[i].position[0],
								bones[i].position[1],
								bones[i].position[2]
							});
							bendingBatch.AddConstraint(parentIndices[i], num, i, restBend, 0f, 0f);
						}
					}
				}
				if (i % 10 == 0)
				{
					yield return new CoroutineJob.ProgressInfo("ObiBone: generating particles...", (float)i / (float)bones.Count);
				}
				int num2 = i + 1;
				i = num2;
			}
			skinBatch.Cook();
			initializing = false;
			initialized = true;
		}

		public override void OnSolverStepBegin()
		{
			bool flag = base.enabled;
			if (animatorController != null)
			{
				animatorController.UpdateAnimation();
			}
			Vector4[] array = new Vector4[1] { Vector4.zero };
			Matrix4x4 matrix4x = ((!base.Solver.simulateInLocalSpace) ? ActorLocalToWorldMatrix : (base.Solver.transform.worldToLocalMatrix * ActorLocalToWorldMatrix));
			ObiSkinConstraintBatch firstBatch = SkinConstraints.GetFirstBatch();
			for (int i = 0; i < particleIndices.Length; i++)
			{
				Vector3 vector = matrix4x.MultiplyPoint3x4(base.transform.InverseTransformPoint(bones[i].position));
				if (!flag || invMasses[i] == 0f)
				{
					array[0] = vector;
					Oni.SetParticlePositions(solver.OniSolver, array, 1, particleIndices[i]);
				}
				firstBatch.skinPoints[i] = vector;
			}
			firstBatch.PushDataToSolver(SkinConstraints);
		}

		public override void OnSolverStepEnd()
		{
			base.OnSolverStepEnd();
			if (animatorController != null)
			{
				animatorController.ResetUpdateFlag();
			}
		}

		public void UpdateBones()
		{
			for (int i = 0; i < bones.Count; i++)
			{
				if (frozen[i])
				{
					continue;
				}
				Vector3 particlePosition = GetParticlePosition(i);
				if (parentIndices[i] >= 0 && !frozen[parentIndices[i]])
				{
					Transform transform = bones[parentIndices[i]];
					if (transform.childCount <= 1)
					{
						Vector3 fromDirection = transform.TransformDirection(bones[i].localPosition);
						Vector3 toDirection = particlePosition - GetParticlePosition(parentIndices[i]);
						transform.rotation = Quaternion.FromToRotation(fromDirection, toDirection) * transform.rotation;
					}
				}
				bones[i].position = particlePosition;
			}
		}

		public override void ResetActor()
		{
			PushDataToSolver(ParticleData.POSITIONS | ParticleData.VELOCITIES);
			if (particleIndices != null)
			{
				for (int i = 0; i < particleIndices.Length; i++)
				{
					solver.renderablePositions[particleIndices[i]] = positions[i];
					bones[i].position = base.transform.TransformPoint(positions[i]);
				}
			}
		}
	}
	[ExecuteInEditMode]
	[AddComponentMenu("Physics/Obi/Obi Emitter")]
	public class ObiEmitter : ObiActor
	{
		public enum EmissionMethod
		{
			STREAM,
			BURST
		}

		public int fluidPhase = 1;

		[SerializeProperty("EmitterMaterial")]
		[SerializeField]
		private ObiEmitterMaterial emitterMaterial;

		[Tooltip("Amount of solver particles used by this emitter.")]
		[SerializeProperty("NumParticles")]
		[SerializeField]
		private int numParticles = 1000;

		[Tooltip("Changes how the emitter behaves. Available modes are Stream and Burst.")]
		public EmissionMethod emissionMethod;

		[Tooltip("Speed (in units/second) of emitted particles. Setting it to zero will stop emission. Large values will cause more particles to be emitted.")]
		public float speed = 0.25f;

		[Tooltip("Lifespan of each particle.")]
		public float lifespan = 4f;

		[Range(0f, 1f)]
		[Tooltip("Amount of randomization applied to particles.")]
		public float randomVelocity;

		[HideInInspector]
		[SerializeField]
		private List<ObiEmitterShape> emitterShapes = new List<ObiEmitterShape>();

		private IEnumerator<ObiEmitterShape.DistributionPoint> distEnumerator;

		private int activeParticleCount;

		[HideInInspector]
		public float[] life;

		private float unemittedBursts;

		public int NumParticles
		{
			get
			{
				return numParticles;
			}
			set
			{
				if (numParticles != value)
				{
					numParticles = value;
					IEnumerator enumerator = Initialize();
					while (enumerator.MoveNext())
					{
					}
				}
			}
		}

		public int ActiveParticles => activeParticleCount;

		public ObiEmitterMaterial EmitterMaterial
		{
			get
			{
				return emitterMaterial;
			}
			set
			{
				if (emitterMaterial != value)
				{
					if (emitterMaterial != null)
					{
						emitterMaterial.OnChangesMade -= EmitterMaterial_OnChangesMade;
					}
					emitterMaterial = value;
					if (emitterMaterial != null)
					{
						emitterMaterial.OnChangesMade += EmitterMaterial_OnChangesMade;
						EmitterMaterial_OnChangesMade(emitterMaterial, new ObiEmitterMaterial.MaterialChangeEventArgs(ObiEmitterMaterial.MaterialChanges.PER_PARTICLE_DATA));
					}
				}
			}
		}

		public override bool UsesCustomExternalForces => true;

		public override void Awake()
		{
			base.Awake();
			selfCollisions = true;
			distEnumerator = GetDistributionEnumerator();
			IEnumerator enumerator = Initialize();
			while (enumerator.MoveNext())
			{
			}
		}

		public override void OnEnable()
		{
			if (emitterMaterial != null)
			{
				emitterMaterial.OnChangesMade += EmitterMaterial_OnChangesMade;
			}
			base.OnEnable();
		}

		public override void OnDisable()
		{
			if (emitterMaterial != null)
			{
				emitterMaterial.OnChangesMade -= EmitterMaterial_OnChangesMade;
			}
			base.OnDisable();
		}

		public override void DestroyRequiredComponents()
		{
		}

		public override bool AddToSolver(object info)
		{
			if (base.Initialized && base.AddToSolver(info))
			{
				solver.RequireRenderablePositions();
				CalculateParticleMass();
				return true;
			}
			return false;
		}

		public override bool RemoveFromSolver(object info)
		{
			if (solver != null)
			{
				solver.RelinquishRenderablePositions();
			}
			return base.RemoveFromSolver(info);
		}

		public void AddShape(ObiEmitterShape shape)
		{
			if (!emitterShapes.Contains(shape))
			{
				emitterShapes.Add(shape);
				UpdateEmitterDistribution();
				distEnumerator = GetDistributionEnumerator();
			}
		}

		public void RemoveShape(ObiEmitterShape shape)
		{
			emitterShapes.Remove(shape);
			UpdateEmitterDistribution();
			distEnumerator = GetDistributionEnumerator();
		}

		public void CalculateParticleMass()
		{
			float num = ((emitterMaterial != null) ? emitterMaterial.GetParticleMass(solver.parameters.mode) : 0.1f);
			for (int i = 0; i < invMasses.Length; i++)
			{
				invMasses[i] = 1f / num;
			}
			PushDataToSolver(ParticleData.INV_MASSES);
		}

		public void SetParticleRestRadius()
		{
			if (base.InSolver)
			{
				float num = ((emitterMaterial != null) ? emitterMaterial.GetParticleSize(solver.parameters.mode) : 0.1f);
				for (int i = 0; i < particleIndices.Length; i++)
				{
					solidRadii[i] = num * 0.5f;
				}
				PushDataToSolver(ParticleData.SOLID_RADII);
			}
		}

		protected override IEnumerator Initialize()
		{
			initialized = false;
			initializing = true;
			RemoveFromSolver(null);
			active = new bool[numParticles];
			life = new float[numParticles];
			positions = new Vector3[numParticles];
			velocities = new Vector3[numParticles];
			invMasses = new float[numParticles];
			solidRadii = new float[numParticles];
			principalRadii = new Vector2[numParticles];
			phases = new int[numParticles];
			colors = new Color[numParticles];
			float num = ((emitterMaterial != null) ? emitterMaterial.GetParticleSize(solver.parameters.mode) : 0.1f);
			float num2 = ((emitterMaterial != null) ? emitterMaterial.GetParticleMass(solver.parameters.mode) : 0.1f);
			for (int i = 0; i < numParticles; i++)
			{
				active[i] = false;
				life[i] = 0f;
				invMasses[i] = 1f / num2;
				positions[i] = Vector3.zero;
				if (emitterMaterial != null && !(emitterMaterial is ObiEmitterMaterialFluid))
				{
					float num3 = UnityEngine.Random.Range(0f, num / 100f * (emitterMaterial as ObiEmitterMaterialGranular).randomness);
					solidRadii[i] = Mathf.Max(0.001f + num * 0.5f - num3);
				}
				else
				{
					solidRadii[i] = num * 0.5f;
				}
				principalRadii[i] = new Vector2(solidRadii[i], solidRadii[i]);
				colors[i] = Color.white;
				phases[i] = Oni.MakePhase(fluidPhase, (selfCollisions ? Oni.ParticlePhase.SelfCollide : ((Oni.ParticlePhase)0)) | ((emitterMaterial != null && emitterMaterial is ObiEmitterMaterialFluid) ? Oni.ParticlePhase.Fluid : ((Oni.ParticlePhase)0)));
			}
			initializing = false;
			initialized = true;
			yield return null;
		}

		public override void UpdateParticlePhases()
		{
			if (base.InSolver)
			{
				Oni.ParticlePhase particlePhase = Oni.ParticlePhase.Fluid;
				if (emitterMaterial != null && !(emitterMaterial is ObiEmitterMaterialFluid))
				{
					particlePhase = (Oni.ParticlePhase)0;
				}
				for (int i = 0; i < particleIndices.Length; i++)
				{
					phases[i] = Oni.MakePhase(fluidPhase, (selfCollisions ? Oni.ParticlePhase.SelfCollide : ((Oni.ParticlePhase)0)) | particlePhase);
				}
				PushDataToSolver(ParticleData.PHASES);
			}
		}

		private void UpdateEmitterDistribution()
		{
			for (int i = 0; i < emitterShapes.Count; i++)
			{
				emitterShapes[i].particleSize = ((emitterMaterial != null) ? emitterMaterial.GetParticleSize(solver.parameters.mode) : 0.1f);
				emitterShapes[i].GenerateDistribution();
			}
		}

		private IEnumerator<ObiEmitterShape.DistributionPoint> GetDistributionEnumerator()
		{
			if (emitterShapes.Count == 0)
			{
				while (true)
				{
					Matrix4x4 matrix4x = ((!base.Solver.simulateInLocalSpace) ? (base.transform.localToWorldMatrix * initialScaleMatrix.inverse) : (base.Solver.transform.worldToLocalMatrix * base.transform.localToWorldMatrix * initialScaleMatrix.inverse));
					yield return new ObiEmitterShape.DistributionPoint(matrix4x.GetColumn(3), matrix4x.GetColumn(2), Color.white);
				}
			}
			while (true)
			{
				int j = 0;
				while (j < emitterShapes.Count)
				{
					ObiEmitterShape shape = emitterShapes[j];
					if (shape.distribution.Count == 0)
					{
						yield return new ObiEmitterShape.DistributionPoint(shape.ShapeLocalToSolverMatrix.GetColumn(3), shape.ShapeLocalToSolverMatrix.GetColumn(2), Color.white);
					}
					int num;
					for (int i = 0; i < shape.distribution.Count; i = num)
					{
						yield return shape.distribution[i].GetTransformed(shape.ShapeLocalToSolverMatrix, shape.color);
						num = i + 1;
					}
					num = j + 1;
					j = num;
				}
			}
		}

		private void EmitterMaterial_OnChangesMade(object sender, ObiEmitterMaterial.MaterialChangeEventArgs e)
		{
			if ((e.changes & ObiEmitterMaterial.MaterialChanges.PER_PARTICLE_DATA) != 0)
			{
				CalculateParticleMass();
				SetParticleRestRadius();
				UpdateParticlePhases();
			}
			UpdateEmitterDistribution();
		}

		public void ResetParticlePosition(int index, float offset)
		{
			distEnumerator.MoveNext();
			ObiEmitterShape.DistributionPoint current = distEnumerator.Current;
			Vector3 vector = Vector3.Lerp(current.velocity, UnityEngine.Random.onUnitSphere, randomVelocity);
			Vector3 vector2 = vector * (speed * Time.fixedDeltaTime) * offset;
			Vector4[] array = new Vector4[1] { current.position + vector2 };
			Vector4[] array2 = new Vector4[1] { vector * speed };
			Oni.SetParticlePositions(solver.OniSolver, array, 1, particleIndices[index]);
			Oni.SetParticleVelocities(solver.OniSolver, array2, 1, particleIndices[index]);
			colors[index] = current.color;
		}

		public bool EmitParticle(float offset)
		{
			if (activeParticleCount == numParticles)
			{
				return false;
			}
			life[activeParticleCount] = lifespan;
			ResetParticlePosition(activeParticleCount, offset);
			active[activeParticleCount] = true;
			activeParticleCount++;
			return true;
		}

		private bool KillParticle(int index)
		{
			if (activeParticleCount == 0 || index >= activeParticleCount)
			{
				return false;
			}
			activeParticleCount--;
			active[activeParticleCount] = false;
			int indexInActor = solver.particleToActor[particleIndices[activeParticleCount]].indexInActor;
			solver.particleToActor[particleIndices[activeParticleCount]].indexInActor = index;
			solver.particleToActor[particleIndices[index]].indexInActor = indexInActor;
			indexInActor = particleIndices[activeParticleCount];
			particleIndices[activeParticleCount] = particleIndices[index];
			particleIndices[index] = indexInActor;
			float num = life[activeParticleCount];
			life[activeParticleCount] = life[index];
			life[index] = num;
			Color color = colors[activeParticleCount];
			colors[activeParticleCount] = colors[index];
			colors[index] = color;
			return true;
		}

		public void KillAll()
		{
			for (int num = activeParticleCount - 1; num >= 0; num--)
			{
				KillParticle(num);
			}
			PushDataToSolver(ParticleData.ACTIVE_STATUS);
		}

		private int GetDistributionPointsCount()
		{
			int num = 0;
			for (int i = 0; i < emitterShapes.Count; i++)
			{
				num += emitterShapes[i].distribution.Count;
			}
			return Mathf.Max(1, num);
		}

		public override void OnSolverStepBegin()
		{
			base.OnSolverStepBegin();
			bool flag = false;
			bool flag2 = false;
			for (int i = 0; i < emitterShapes.Count; i++)
			{
				emitterShapes[i].UpdateLocalToSolverMatrix();
			}
			for (int num = activeParticleCount - 1; num >= 0; num--)
			{
				life[num] -= Time.deltaTime;
				if (life[num] <= 0f)
				{
					flag2 |= KillParticle(num);
				}
			}
			int distributionPointsCount = GetDistributionPointsCount();
			if (emissionMethod == EmissionMethod.STREAM)
			{
				float num2 = speed * Time.fixedDeltaTime / ((emitterMaterial != null) ? emitterMaterial.GetParticleSize(solver.parameters.mode) : 0.1f);
				unemittedBursts += num2;
				int num3 = 0;
				while (unemittedBursts > 0f)
				{
					for (int j = 0; j < distributionPointsCount; j++)
					{
						flag |= EmitParticle((float)num3 / num2);
					}
					unemittedBursts -= 1f;
					num3++;
				}
			}
			else if (activeParticleCount == 0)
			{
				for (int k = 0; k < distributionPointsCount; k++)
				{
					flag |= EmitParticle(0f);
				}
			}
			if (flag || flag2)
			{
				PushDataToSolver(ParticleData.ACTIVE_STATUS);
			}
		}
	}
	[ExecuteInEditMode]
	[AddComponentMenu("Physics/Obi/Obi Rope")]
	[RequireComponent(typeof(MeshRenderer))]
	[RequireComponent(typeof(MeshFilter))]
	[RequireComponent(typeof(ObiDistanceConstraints))]
	[RequireComponent(typeof(ObiBendingConstraints))]
	[RequireComponent(typeof(ObiTetherConstraints))]
	[RequireComponent(typeof(ObiPinConstraints))]
	[DisallowMultipleComponent]
	public class ObiRope : ObiActor
	{
		public enum RenderingMode
		{
			ProceduralRope,
			Chain,
			Line,
			CustomMesh
		}

		public class CurveFrame
		{
			public Vector3 position = Vector3.zero;

			public Vector3 tangent = Vector3.forward;

			public Vector3 normal = Vector3.up;

			public Vector3 binormal = Vector3.left;

			public void Reset()
			{
				position = Vector3.zero;
				tangent = Vector3.forward;
				normal = Vector3.up;
				binormal = Vector3.left;
			}

			public void SetTwist(float twist)
			{
				Quaternion quaternion = Quaternion.AngleAxis(twist, tangent);
				normal = quaternion * normal;
				binormal = quaternion * binormal;
			}

			public void SetTwistAndTangent(float twist, Vector3 tangent)
			{
				this.tangent = tangent;
				normal = new Vector3(0f - tangent.y, tangent.x, 0f).normalized;
				binormal = Vector3.Cross(tangent, normal);
				Quaternion quaternion = Quaternion.AngleAxis(twist, tangent);
				normal = quaternion * normal;
				binormal = quaternion * binormal;
			}

			public void Transport(Vector3 newPosition, Vector3 newTangent, float twist)
			{
				Quaternion quaternion = Quaternion.FromToRotation(tangent, newTangent);
				Quaternion quaternion2 = Quaternion.AngleAxis(twist, newTangent) * quaternion;
				normal = quaternion2 * normal;
				binormal = quaternion2 * binormal;
				tangent = newTangent;
				position = newPosition;
			}

			public void DrawDebug()
			{
				UnityEngine.Debug.DrawRay(position, normal, Color.blue);
				UnityEngine.Debug.DrawRay(position, tangent, Color.red);
				UnityEngine.Debug.DrawRay(position, binormal, Color.green);
			}
		}

		public struct CurveSection
		{
			public Vector4 positionAndRadius;

			public Vector4 color;

			public CurveSection(Vector4 positionAndRadius, Vector4 color)
			{
				this.positionAndRadius = positionAndRadius;
				this.color = color;
			}

			public CurveSection(Vector3 position, float radius, Vector4 color)
			{
				positionAndRadius = new Vector4(position.x, position.y, position.z, radius);
				this.color = color;
			}

			public static CurveSection operator +(CurveSection c1, CurveSection c2)
			{
				return new CurveSection(c1.positionAndRadius + c2.positionAndRadius, c1.color + c2.color);
			}

			public static CurveSection operator *(float f, CurveSection c)
			{
				return new CurveSection(c.positionAndRadius * f, c.color * f);
			}
		}

		public const float DEFAULT_PARTICLE_MASS = 0.1f;

		public const float MAX_YOUNG_MODULUS = 200f;

		public const float MIN_YOUNG_MODULUS = 0.0001f;

		[Tooltip("Amount of additional particles in this rope's pool that can be used to extend its lenght, or to tear it.")]
		public int pooledParticles = 10;

		[Tooltip("Path used to generate the rope.")]
		public ObiCurve ropePath;

		public bool thicknessFromParticles = true;

		[Tooltip("Thickness of the rope, it is equivalent to particle radius.")]
		[Indent]
		[VisibleIf("thicknessFromParticles", true)]
		public float thickness = 0.05f;

		[Tooltip("Modulates the amount of particles per lenght unit. 1 means as many particles as needed for the given length/thickness will be used, whichcan be a lot in very thin and long ropes. Setting values between 0 and 1 allows you to override the amount of particles used.")]
		[Range(0f, 1f)]
		public float resolution = 0.5f;

		[Range(0f, 3f)]
		public uint smoothing = 1u;

		public bool tearable;

		[Tooltip("Maximum strain betweeen particles before the spring constraint holding them together would break.")]
		[Indent(order = 0)]
		[VisibleIf("tearable", false, order = 1)]
		[MultiDelayed(order = 2)]
		public float tearResistanceMultiplier = 1000f;

		[Indent]
		[VisibleIf("tearable", false)]
		public GameObject tearPrefab;

		public GameObject startPrefab;

		public GameObject endPrefab;

		[HideInInspector]
		public float[] tearResistance;

		[NonSerialized]
		[HideInInspector]
		public Mesh ropeMesh;

		[Header("Rendering")]
		[SerializeProperty("RenderMode")]
		public RenderingMode renderMode;

		[VisibleIf("IsRenderModeLine", false, order = 0)]
		[ChildrenOnly(order = 1)]
		public ObiRopeLineRenderMode lineRenderMode = new ObiRopeLineRenderMode();

		[VisibleIf("IsRenderModeThick", false, order = 0)]
		[ChildrenOnly(order = 1)]
		public ObiRopeThickRenderMode thickRenderMode = new ObiRopeThickRenderMode();

		[VisibleIf("IsRenderModeChain", false, order = 0)]
		[ChildrenOnly(order = 1)]
		public ObiRopeChainRenderMode chainRenderMode = new ObiRopeChainRenderMode();

		[VisibleIf("IsRenderModeMesh", false, order = 0)]
		[ChildrenOnly(order = 1)]
		public ObiRopeMeshRenderMode meshRenderMode = new ObiRopeMeshRenderMode();

		[VisibleIf("IsRenderModeProcedural", false, order = 0)]
		[MultiRange(0f, 1f, order = 1)]
		public float uvAnchor;

		[VisibleIf("IsRenderModeProcedural", false)]
		public Vector2 uvScale = Vector2.one;

		[VisibleIf("IsRenderModeProcedural", false)]
		public bool normalizeV = true;

		[VisibleIf("IsRenderModeProcedural", false)]
		public ObiRopeSection section;

		[VisibleIf("RenderModeSupportsTwist", false)]
		public float sectionTwist;

		[VisibleIf("IsRenderModeProcedural", false)]
		public float sectionThicknessScale = 0.8f;

		public List<GameObject> chainLinks = new List<GameObject>();

		[NonSerialized]
		[HideInInspector]
		public GameObject[] tearPrefabPool;

		[HideInInspector]
		[SerializeField]
		private bool closed;

		[HideInInspector]
		[SerializeField]
		private float interParticleDistance;

		[HideInInspector]
		[SerializeField]
		private float restLength;

		[HideInInspector]
		[SerializeField]
		private int usedParticles;

		[HideInInspector]
		[SerializeField]
		private int totalParticles;

		[HideInInspector]
		public GameObject startPrefabInstance;

		[HideInInspector]
		public GameObject endPrefabInstance;

		private float curveLength;

		private int curveSections;

		[NonSerialized]
		[HideInInspector]
		public ObiList<ObiList<CurveSection>> rawCurves = new ObiList<ObiList<CurveSection>>();

		[NonSerialized]
		[HideInInspector]
		public ObiList<ObiList<CurveSection>> curves = new ObiList<ObiList<CurveSection>>();

		public ObiDistanceConstraints DistanceConstraints => constraints[3] as ObiDistanceConstraints;

		public ObiBendingConstraints BendingConstraints => constraints[2] as ObiBendingConstraints;

		public ObiTetherConstraints TetherConstraints => constraints[0] as ObiTetherConstraints;

		public ObiPinConstraints PinConstraints => constraints[4] as ObiPinConstraints;

		public RenderingMode RenderMode
		{
			get
			{
				return renderMode;
			}
			set
			{
				if (value != renderMode)
				{
					TearDownVisualRepresentation();
					renderMode = value;
					InitializeVisualRepresentation();
				}
			}
		}

		public float InterparticleDistance => interParticleDistance * DistanceConstraints.stretchingScale;

		public int TotalParticles => totalParticles;

		public int UsedParticles
		{
			get
			{
				return usedParticles;
			}
			set
			{
				usedParticles = value;
				pooledParticles = totalParticles - usedParticles;
			}
		}

		public float RestLength
		{
			get
			{
				return restLength;
			}
			set
			{
				restLength = value;
			}
		}

		public float SmoothLength => curveLength;

		public int SmoothSections => curveSections;

		public bool Closed => closed;

		public int PooledParticles => pooledParticles;

		private bool IsRenderModeProcedural()
		{
			if (renderMode != 0)
			{
				return renderMode == RenderingMode.Line;
			}
			return true;
		}

		private bool IsRenderModeThick()
		{
			return renderMode == RenderingMode.ProceduralRope;
		}

		private bool IsRenderModeChain()
		{
			return renderMode == RenderingMode.Chain;
		}

		private bool IsRenderModeLine()
		{
			return renderMode == RenderingMode.Line;
		}

		private bool IsRenderModeMesh()
		{
			return renderMode == RenderingMode.CustomMesh;
		}

		private bool RenderModeSupportsTwist()
		{
			return renderMode != RenderingMode.Line;
		}

		public override void Awake()
		{
			base.Awake();
			ropeMesh = new Mesh();
			ropeMesh.name = "ropeMesh";
			ropeMesh.MarkDynamic();
			GetComponent<MeshFilter>().mesh = ropeMesh;
			chainRenderMode.linkInstances = new List<GameObject>();
		}

		public override void Start()
		{
			base.Start();
			ObiRopeThickRenderMode obiRopeThickRenderMode = thickRenderMode;
			ObiRopeLineRenderMode obiRopeLineRenderMode = lineRenderMode;
			ObiRopeChainRenderMode obiRopeChainRenderMode = chainRenderMode;
			ObiRope obiRope2 = (meshRenderMode.Rope = this);
			ObiRope obiRope4 = (obiRopeChainRenderMode.Rope = obiRope2);
			ObiRope rope = (obiRopeLineRenderMode.Rope = obiRope4);
			obiRopeThickRenderMode.Rope = rope;
			Camera.onPreCull = (Camera.CameraCallback)Delegate.Combine(Camera.onPreCull, new Camera.CameraCallback(RopePreCull));
			InitializeVisualRepresentation();
		}

		public void OnValidate()
		{
			thickness = Mathf.Max(0.0001f, thickness);
			uvAnchor = Mathf.Clamp01(uvAnchor);
			tearResistanceMultiplier = Mathf.Max(0.1f, tearResistanceMultiplier);
			resolution = Mathf.Max(0.0001f, resolution);
			UpdateVisualRepresentation();
		}

		public void RopePreCull(Camera cam)
		{
			if (base.Initialized && renderMode == RenderingMode.Line)
			{
				lineRenderMode.Update(cam);
			}
		}

		public override void OnSolverStepEnd()
		{
			base.OnSolverStepEnd();
			if (base.isActiveAndEnabled)
			{
				ApplyTearing();
				PinConstraints.BreakConstraints();
			}
		}

		public override void OnSolverFrameEnd()
		{
			base.OnSolverFrameEnd();
			UpdateVisualRepresentation();
		}

		public override void OnDestroy()
		{
			base.OnDestroy();
			Camera.onPreCull = (Camera.CameraCallback)Delegate.Remove(Camera.onPreCull, new Camera.CameraCallback(RopePreCull));
			thickRenderMode.TearDown();
			lineRenderMode.TearDown();
			chainRenderMode.TearDown();
			meshRenderMode.TearDown();
			UnityEngine.Object.DestroyImmediate(ropeMesh);
			ClearPrefabInstances();
		}

		public override bool AddToSolver(object info)
		{
			if (base.Initialized && base.AddToSolver(info))
			{
				solver.RequireRenderablePositions();
				return true;
			}
			return false;
		}

		public override bool RemoveFromSolver(object info)
		{
			if (solver != null)
			{
				solver.RelinquishRenderablePositions();
			}
			return base.RemoveFromSolver(info);
		}

		protected override IEnumerator Initialize()
		{
			initialized = false;
			initializing = true;
			interParticleDistance = -1f;
			RemoveFromSolver(null);
			if (ropePath == null)
			{
				UnityEngine.Debug.LogError("Cannot initialize rope. There's no ropePath present. Please provide a spline to define the shape of the rope");
				yield break;
			}
			ropePath.RecalculateSplineLenght(1E-05f, 7);
			closed = ropePath.Closed;
			restLength = ropePath.Length;
			usedParticles = Mathf.CeilToInt(restLength / thickness * resolution) + ((!closed) ? 1 : 0);
			totalParticles = usedParticles + pooledParticles;
			active = new bool[totalParticles];
			positions = new Vector3[totalParticles];
			velocities = new Vector3[totalParticles];
			invMasses = new float[totalParticles];
			solidRadii = new float[totalParticles];
			principalRadii = new Vector2[totalParticles];
			phases = new int[totalParticles];
			restPositions = new Vector4[totalParticles];
			tearResistance = new float[totalParticles];
			colors = new Color[totalParticles];
			int numSegments = usedParticles - ((!closed) ? 1 : 0);
			if (numSegments > 0)
			{
				interParticleDistance = restLength / (float)numSegments;
			}
			else
			{
				interParticleDistance = 0f;
			}
			float radius = interParticleDistance * resolution;
			for (int j = 0; j < usedParticles; j++)
			{
				active[j] = true;
				invMasses[j] = 10f;
				float muAtLenght = ropePath.GetMuAtLenght(interParticleDistance * (float)j);
				positions[j] = base.transform.InverseTransformPoint(ropePath.transform.TransformPoint(ropePath.GetPositionAt(muAtLenght)));
				solidRadii[j] = radius;
				principalRadii[j] = new Vector2(solidRadii[j], solidRadii[j]);
				phases[j] = Oni.MakePhase(1, selfCollisions ? Oni.ParticlePhase.SelfCollide : ((Oni.ParticlePhase)0));
				tearResistance[j] = 1f;
				colors[j] = Color.white;
				if (j % 100 == 0)
				{
					yield return new CoroutineJob.ProgressInfo("ObiRope: generating particles...", (float)j / (float)usedParticles);
				}
			}
			for (int j = usedParticles; j < totalParticles; j++)
			{
				active[j] = false;
				invMasses[j] = 10f;
				solidRadii[j] = radius;
				principalRadii[j] = new Vector2(solidRadii[j], solidRadii[j]);
				phases[j] = Oni.MakePhase(1, selfCollisions ? Oni.ParticlePhase.SelfCollide : ((Oni.ParticlePhase)0));
				tearResistance[j] = 1f;
				colors[j] = Color.white;
				if (j % 100 == 0)
				{
					yield return new CoroutineJob.ProgressInfo("ObiRope: generating particles...", (float)j / (float)usedParticles);
				}
			}
			DistanceConstraints.Clear();
			ObiDistanceConstraintBatch distanceBatch = new ObiDistanceConstraintBatch(cooked: false, sharesParticles: false, 0.0001f, 200f);
			DistanceConstraints.AddBatch(distanceBatch);
			for (int j = 0; j < numSegments; j++)
			{
				distanceBatch.AddConstraint(j, (j + 1) % (ropePath.Closed ? usedParticles : (usedParticles + 1)), interParticleDistance, 1f, 1f);
				if (j % 500 == 0)
				{
					yield return new CoroutineJob.ProgressInfo("ObiRope: generating structural constraints...", (float)j / (float)numSegments);
				}
			}
			BendingConstraints.Clear();
			ObiBendConstraintBatch bendingBatch = new ObiBendConstraintBatch(cooked: false, sharesParticles: false, 0.0001f, 200f);
			BendingConstraints.AddBatch(bendingBatch);
			for (int j = 0; j < usedParticles - ((!closed) ? 2 : 0); j++)
			{
				bendingBatch.AddConstraint(j, (j + 2) % usedParticles, (j + 1) % usedParticles, 0f, 0f, 1f);
				if (j % 500 == 0)
				{
					yield return new CoroutineJob.ProgressInfo("ObiRope: adding bend constraints...", (float)j / (float)usedParticles);
				}
			}
			TetherConstraints.Clear();
			PinConstraints.Clear();
			ObiPinConstraintBatch batch = new ObiPinConstraintBatch(cooked: false, sharesParticles: false, 0f, 200f);
			PinConstraints.AddBatch(batch);
			initializing = false;
			initialized = true;
			RegenerateRestPositions();
			InitializeVisualRepresentation();
		}

		public void RegenerateRestPositions()
		{
			ObiDistanceConstraintBatch firstBatch = DistanceConstraints.GetFirstBatch();
			int num = -1;
			int num2 = -1;
			float num3 = 0f;
			for (int i = 0; i < firstBatch.ConstraintCount; i++)
			{
				if (i == 0)
				{
					num2 = (num = firstBatch.springIndices[i * 2]);
					restPositions[num] = Vector4.zero;
				}
				num3 += Mathf.Min(interParticleDistance, solidRadii[num], solidRadii[num2]);
				num = firstBatch.springIndices[i * 2 + 1];
				restPositions[num] = Vector3.right * num3;
				restPositions[num][3] = 0f;
			}
			PushDataToSolver(ParticleData.REST_POSITIONS);
		}

		public void RecalculateLenght()
		{
			ObiDistanceConstraintBatch firstBatch = DistanceConstraints.GetFirstBatch();
			restLength = 0f;
			for (int i = 0; i < firstBatch.ConstraintCount; i++)
			{
				restLength += firstBatch.restLengths[i];
			}
		}

		public float CalculateLength()
		{
			ObiDistanceConstraintBatch firstBatch = DistanceConstraints.GetFirstBatch();
			float num = 0f;
			for (int i = 0; i < firstBatch.ConstraintCount; i++)
			{
				Vector3 particlePosition = GetParticlePosition(firstBatch.springIndices[i * 2]);
				Vector3 particlePosition2 = GetParticlePosition(firstBatch.springIndices[i * 2 + 1]);
				num += Vector3.Distance(particlePosition, particlePosition2);
			}
			return num;
		}

		protected void InitializeVisualRepresentation()
		{
			if (base.Initialized)
			{
				GeneratePrefabInstances();
				switch (renderMode)
				{
				case RenderingMode.Chain:
					chainRenderMode.Initialize();
					break;
				case RenderingMode.Line:
					lineRenderMode.Initialize();
					break;
				case RenderingMode.ProceduralRope:
					thickRenderMode.Initialize();
					break;
				case RenderingMode.CustomMesh:
					meshRenderMode.Initialize();
					break;
				}
			}
		}

		protected void UpdateVisualRepresentation()
		{
			if (base.isActiveAndEnabled && base.Initialized)
			{
				switch (renderMode)
				{
				case RenderingMode.Chain:
					chainRenderMode.Update(null);
					break;
				case RenderingMode.ProceduralRope:
					thickRenderMode.Update(null);
					break;
				case RenderingMode.CustomMesh:
					meshRenderMode.Update(null);
					break;
				case RenderingMode.Line:
					break;
				}
			}
		}

		protected void TearDownVisualRepresentation()
		{
			if (base.Initialized)
			{
				switch (renderMode)
				{
				case RenderingMode.Chain:
					chainRenderMode.TearDown();
					break;
				case RenderingMode.Line:
					lineRenderMode.TearDown();
					break;
				case RenderingMode.ProceduralRope:
					thickRenderMode.TearDown();
					break;
				case RenderingMode.CustomMesh:
					meshRenderMode.TearDown();
					break;
				}
			}
		}

		protected void GeneratePrefabInstances()
		{
			ClearPrefabInstances();
			if (tearPrefab != null)
			{
				tearPrefabPool = new GameObject[pooledParticles * 2];
				for (int i = 0; i < tearPrefabPool.Length; i++)
				{
					GameObject gameObject = UnityEngine.Object.Instantiate(tearPrefab);
					gameObject.hideFlags = HideFlags.HideAndDontSave;
					gameObject.SetActive(value: false);
					tearPrefabPool[i] = gameObject;
				}
			}
			if (startPrefabInstance == null && startPrefab != null)
			{
				startPrefabInstance = UnityEngine.Object.Instantiate(startPrefab);
				startPrefabInstance.hideFlags = HideFlags.HideAndDontSave;
			}
			if (endPrefabInstance == null && endPrefab != null)
			{
				endPrefabInstance = UnityEngine.Object.Instantiate(endPrefab);
				endPrefabInstance.hideFlags = HideFlags.HideAndDontSave;
			}
		}

		protected void ClearPrefabInstances()
		{
			UnityEngine.Object.DestroyImmediate(startPrefabInstance);
			UnityEngine.Object.DestroyImmediate(endPrefabInstance);
			if (tearPrefabPool == null)
			{
				return;
			}
			for (int i = 0; i < tearPrefabPool.Length; i++)
			{
				if (tearPrefabPool[i] != null)
				{
					UnityEngine.Object.DestroyImmediate(tearPrefabPool[i]);
					tearPrefabPool[i] = null;
				}
			}
		}

		protected void ChaikinSmoothing(ObiList<CurveSection> input, ObiList<CurveSection> output, uint k)
		{
			if (k == 0 || input.Count < 3)
			{
				output.SetCount(input.Count);
				for (int i = 0; i < input.Count; i++)
				{
					output[i] = input[i];
				}
				return;
			}
			int num = (int)Mathf.Pow(2f, k);
			int num2 = input.Count - 1;
			float num3 = Mathf.Pow(2f, 0L - (long)(k + 1));
			float num4 = Mathf.Pow(2f, 0L - (long)k);
			float num5 = Mathf.Pow(2f, -2 * k);
			float num6 = Mathf.Pow(2f, -2 * k - 1);
			output.SetCount((num2 - 1) * num + 2);
			output[0] = (0.5f + num3) * input[0] + (0.5f - num3) * input[1];
			output[num * num2 - num + 1] = (0.5f - num3) * input[num2 - 1] + (0.5f + num3) * input[num2];
			for (int j = 1; j <= num; j++)
			{
				float num7 = 0.5f - num3 - (float)(j - 1) * (num4 - (float)j * num6);
				float num8 = 0.5f + num3 + (float)(j - 1) * (num4 - (float)j * num5);
				float num9 = (float)((j - 1) * j) * num6;
				for (int l = 1; l < num2; l++)
				{
					output[(l - 1) * num + j] = num7 * input[l - 1] + num8 * input[l] + num9 * input[l + 1];
				}
			}
			output[0] = input[0];
			output[output.Count - 1] = input[input.Count - 1];
		}

		protected float CalculateCurveLength(ObiList<CurveSection> curve)
		{
			float num = 0f;
			for (int i = 1; i < curve.Count; i++)
			{
				num += Vector3.Distance(curve[i].positionAndRadius, curve[i - 1].positionAndRadius);
			}
			return num;
		}

		public int GetConstraintIndexAtNormalizedCoordinate(float coord)
		{
			ObiDistanceConstraintBatch firstBatch = DistanceConstraints.GetFirstBatch();
			return Mathf.Clamp(Mathf.FloorToInt(coord * (float)firstBatch.ConstraintCount), 0, firstBatch.ConstraintCount - 1);
		}

		protected void AddCurve(int sections)
		{
			if (sections > 1)
			{
				if (rawCurves.Data[rawCurves.Count] == null)
				{
					rawCurves.Data[rawCurves.Count] = new ObiList<CurveSection>();
					curves.Data[curves.Count] = new ObiList<CurveSection>();
				}
				rawCurves.Data[rawCurves.Count].SetCount(sections);
				rawCurves.SetCount(rawCurves.Count + 1);
				curves.SetCount(curves.Count + 1);
			}
		}

		protected void CountContinuousSegments()
		{
			rawCurves.Clear();
			ObiDistanceConstraintBatch firstBatch = DistanceConstraints.GetFirstBatch();
			int num = 0;
			int num2 = -1;
			for (int i = 0; i < firstBatch.ConstraintCount; i++)
			{
				int num3 = firstBatch.springIndices[i * 2];
				int num4 = firstBatch.springIndices[i * 2 + 1];
				if (num3 != num2 && num > 0)
				{
					AddCurve(num + 1);
					num = 0;
				}
				num2 = num4;
				num++;
			}
			AddCurve(num + 1);
		}

		public void SmoothCurvesFromParticles()
		{
			curves.Clear();
			curveSections = 0;
			curveLength = 0f;
			CountContinuousSegments();
			ObiDistanceConstraintBatch firstBatch = DistanceConstraints.GetFirstBatch();
			Matrix4x4 worldToLocalMatrix = base.transform.worldToLocalMatrix;
			int num = 0;
			for (int i = 0; i < rawCurves.Count; i++)
			{
				int num2 = rawCurves[i].Count - 1;
				ObiList<CurveSection> obiList = rawCurves[i];
				for (int j = 0; j < num2; j++)
				{
					int num3 = firstBatch.springIndices[(num + j) * 2];
					obiList[j] = new CurveSection(worldToLocalMatrix.MultiplyPoint3x4(GetParticlePosition(num3)), solidRadii[num3], (colors != null && num3 < colors.Length) ? colors[num3] : Color.white);
					if (j == num2 - 1)
					{
						num3 = firstBatch.springIndices[(num + j) * 2 + 1];
						obiList[j + 1] = new CurveSection(worldToLocalMatrix.MultiplyPoint3x4(GetParticlePosition(num3)), solidRadii[num3], (colors != null && num3 < colors.Length) ? colors[num3] : Color.white);
					}
				}
				num += num2;
				ChaikinSmoothing(obiList, curves[i], smoothing);
				curveSections += curves[i].Count - 1;
				curveLength += CalculateCurveLength(curves[i]);
			}
		}

		public void PlaceObjectAtCurveFrame(CurveFrame frame, GameObject obj, Space space, bool reverseLookDirection)
		{
			if (space == Space.Self)
			{
				Matrix4x4 localToWorldMatrix = base.transform.localToWorldMatrix;
				obj.transform.position = localToWorldMatrix.MultiplyPoint3x4(frame.position);
				if (frame.tangent != Vector3.zero)
				{
					obj.transform.rotation = Quaternion.LookRotation(localToWorldMatrix.MultiplyVector(reverseLookDirection ? frame.tangent : (-frame.tangent)), localToWorldMatrix.MultiplyVector(frame.normal));
				}
			}
			else
			{
				obj.transform.position = frame.position;
				if (frame.tangent != Vector3.zero)
				{
					obj.transform.rotation = Quaternion.LookRotation(reverseLookDirection ? frame.tangent : (-frame.tangent), frame.normal);
				}
			}
		}

		public override void ResetActor()
		{
			PushDataToSolver(ParticleData.POSITIONS | ParticleData.VELOCITIES);
			if (particleIndices != null)
			{
				for (int i = 0; i < particleIndices.Length; i++)
				{
					solver.renderablePositions[particleIndices[i]] = positions[i];
				}
			}
			UpdateVisualRepresentation();
		}

		protected void ApplyTearing()
		{
			if (!tearable)
			{
				return;
			}
			ObiDistanceConstraintBatch firstBatch = DistanceConstraints.GetFirstBatch();
			float[] array = new float[firstBatch.ConstraintCount];
			Oni.GetBatchConstraintForces(firstBatch.OniBatch, array, firstBatch.ConstraintCount, 0);
			List<int> list = new List<int>();
			for (int i = 0; i < array.Length; i++)
			{
				float num = tearResistance[firstBatch.springIndices[i * 2]];
				float num2 = tearResistance[firstBatch.springIndices[i * 2 + 1]];
				float num3 = (num + num2) * 0.5f * tearResistanceMultiplier;
				if ((0f - array[i]) * 1000f > num3)
				{
					list.Add(i);
				}
			}
			if (list.Count > 0)
			{
				DistanceConstraints.RemoveFromSolver(null);
				BendingConstraints.RemoveFromSolver(null);
				for (int j = 0; j < list.Count; j++)
				{
					Tear(list[j]);
				}
				BendingConstraints.AddToSolver(this);
				DistanceConstraints.AddToSolver(this);
				BendingConstraints.SetActiveConstraints();
				solver.UpdateActiveParticles();
			}
		}

		public bool DoesBendConstraintSpanDistanceConstraint(ObiDistanceConstraintBatch dbatch, ObiBendConstraintBatch bbatch, int d, int b)
		{
			if ((bbatch.bendingIndices[b * 3 + 2] != dbatch.springIndices[d * 2] || bbatch.bendingIndices[b * 3 + 1] != dbatch.springIndices[d * 2 + 1]) && (bbatch.bendingIndices[b * 3 + 1] != dbatch.springIndices[d * 2] || bbatch.bendingIndices[b * 3 + 2] != dbatch.springIndices[d * 2 + 1]) && (bbatch.bendingIndices[b * 3 + 2] != dbatch.springIndices[d * 2] || bbatch.bendingIndices[b * 3] != dbatch.springIndices[d * 2 + 1]))
			{
				if (bbatch.bendingIndices[b * 3] == dbatch.springIndices[d * 2])
				{
					return bbatch.bendingIndices[b * 3 + 2] == dbatch.springIndices[d * 2 + 1];
				}
				return false;
			}
			return true;
		}

		public void Tear(int constraintIndex)
		{
			if (usedParticles >= totalParticles)
			{
				return;
			}
			ObiDistanceConstraintBatch firstBatch = DistanceConstraints.GetFirstBatch();
			ObiBendConstraintBatch firstBatch2 = BendingConstraints.GetFirstBatch();
			int num = firstBatch.springIndices[constraintIndex * 2];
			int num2 = firstBatch.springIndices[constraintIndex * 2 + 1];
			bool flag = (constraintIndex < firstBatch.ConstraintCount - 1 && firstBatch.springIndices[(constraintIndex + 1) * 2] == num) || (constraintIndex > 0 && firstBatch.springIndices[(constraintIndex - 1) * 2 + 1] == num);
			bool flag2 = (constraintIndex < firstBatch.ConstraintCount - 1 && firstBatch.springIndices[(constraintIndex + 1) * 2] == num2) || (constraintIndex > 0 && firstBatch.springIndices[(constraintIndex - 1) * 2 + 1] == num2);
			if ((invMasses[num] > invMasses[num2] || invMasses[num] == 0f) && flag2)
			{
				int num3 = num;
				num = num2;
				num2 = num3;
			}
			if (invMasses[num] == 0f || !flag)
			{
				return;
			}
			invMasses[num] *= 2f;
			positions[usedParticles] = positions[num];
			velocities[usedParticles] = velocities[num];
			active[usedParticles] = active[num];
			invMasses[usedParticles] = invMasses[num];
			solidRadii[usedParticles] = solidRadii[num];
			principalRadii[usedParticles] = principalRadii[num];
			phases[usedParticles] = phases[num];
			if (colors != null && colors.Length != 0)
			{
				colors[usedParticles] = colors[num];
			}
			tearResistance[usedParticles] = tearResistance[num];
			restPositions[usedParticles] = positions[num];
			restPositions[usedParticles][3] = 0f;
			Vector4[] array = new Vector4[1] { Vector4.zero };
			Oni.GetParticleVelocities(solver.OniSolver, array, 1, particleIndices[num]);
			Oni.SetParticleVelocities(solver.OniSolver, array, 1, particleIndices[usedParticles]);
			Vector4[] array2 = new Vector4[1] { Vector4.zero };
			Oni.GetParticlePositions(solver.OniSolver, array2, 1, particleIndices[num]);
			Oni.SetParticlePositions(solver.OniSolver, array2, 1, particleIndices[usedParticles]);
			Oni.SetParticleInverseMasses(solver.OniSolver, new float[1] { invMasses[num] }, 1, particleIndices[usedParticles]);
			Oni.SetParticleSolidRadii(solver.OniSolver, new float[1] { solidRadii[num] }, 1, particleIndices[usedParticles]);
			Oni.SetParticlePrincipalRadii(solver.OniSolver, new Vector2[1] { principalRadii[num] }, 1, particleIndices[usedParticles]);
			Oni.SetParticlePhases(solver.OniSolver, new int[1] { phases[num] }, 1, particleIndices[usedParticles]);
			for (int i = 0; i < firstBatch2.ConstraintCount; i++)
			{
				if (firstBatch2.bendingIndices[i * 3 + 2] == num)
				{
					firstBatch2.DeactivateConstraint(i);
				}
				else if (!DoesBendConstraintSpanDistanceConstraint(firstBatch, firstBatch2, constraintIndex, i))
				{
					if (firstBatch2.bendingIndices[i * 3] == num)
					{
						firstBatch2.bendingIndices[i * 3] = usedParticles;
					}
					else if (firstBatch2.bendingIndices[i * 3 + 1] == num)
					{
						firstBatch2.bendingIndices[i * 3 + 1] = usedParticles;
					}
				}
			}
			if (constraintIndex < firstBatch.ConstraintCount - 1)
			{
				if (firstBatch.springIndices[(constraintIndex + 1) * 2] == num)
				{
					firstBatch.springIndices[(constraintIndex + 1) * 2] = usedParticles;
				}
				if (firstBatch.springIndices[(constraintIndex + 1) * 2 + 1] == num)
				{
					firstBatch.springIndices[(constraintIndex + 1) * 2 + 1] = usedParticles;
				}
			}
			if (constraintIndex > 0)
			{
				if (firstBatch.springIndices[(constraintIndex - 1) * 2] == num)
				{
					firstBatch.springIndices[(constraintIndex - 1) * 2] = usedParticles;
				}
				if (firstBatch.springIndices[(constraintIndex - 1) * 2 + 1] == num)
				{
					firstBatch.springIndices[(constraintIndex - 1) * 2 + 1] = usedParticles;
				}
			}
			usedParticles++;
			pooledParticles--;
		}

		public override bool GenerateTethers(TetherType type)
		{
			if (!base.Initialized)
			{
				return false;
			}
			TetherConstraints.Clear();
			if (type == TetherType.Hierarchical)
			{
				GenerateHierarchicalTethers(5);
			}
			else
			{
				GenerateFixedTethers(2);
			}
			return true;
		}

		private void GenerateFixedTethers(int maxTethers)
		{
			ObiTetherConstraintBatch obiTetherConstraintBatch = new ObiTetherConstraintBatch(cooked: true, sharesParticles: false, 0.0001f, 200f);
			TetherConstraints.AddBatch(obiTetherConstraintBatch);
			List<HashSet<int>> list = new List<HashSet<int>>();
			for (int i = 0; i < usedParticles; i++)
			{
				if (invMasses[i] > 0f || !active[i])
				{
					continue;
				}
				int num = -1;
				List<int> list2 = new List<int>();
				int num2 = Mathf.Max(i - 1, 0);
				int num3 = Mathf.Min(i + 1, usedParticles - 1);
				for (int j = 0; j < list.Count; j++)
				{
					if ((active[num2] && list[j].Contains(num2)) || (active[num3] && list[j].Contains(num3)))
					{
						if (num < 0)
						{
							num = j;
							list[j].Add(i);
						}
						else if (num != j && !list2.Contains(j))
						{
							list2.Add(j);
						}
					}
				}
				foreach (int item in list2)
				{
					list[num].UnionWith(list[item]);
				}
				list2.Sort();
				list2.Reverse();
				foreach (int item2 in list2)
				{
					list.RemoveAt(item2);
				}
				if (num < 0)
				{
					list.Add(new HashSet<int> { i });
				}
			}
			for (int k = 0; k < usedParticles; k++)
			{
				if (invMasses[k] == 0f)
				{
					continue;
				}
				List<KeyValuePair<float, int>> list3 = new List<KeyValuePair<float, int>>(list.Count);
				foreach (HashSet<int> item3 in list)
				{
					int num4 = -1;
					float num5 = float.PositiveInfinity;
					foreach (int item4 in item3)
					{
						int num6 = Mathf.Min(k, item4);
						int num7 = Mathf.Max(k, item4);
						float num8 = 0f;
						for (int l = num6; l < num7; l++)
						{
							num8 += Vector3.Distance(positions[l], positions[l + 1]);
						}
						if (num8 < num5)
						{
							num5 = num8;
							num4 = item4;
						}
					}
					if (num4 >= 0)
					{
						list3.Add(new KeyValuePair<float, int>(num5, num4));
					}
				}
				list3.Sort((KeyValuePair<float, int> x, KeyValuePair<float, int> y) => x.Key.CompareTo(y.Key));
				for (int m = 0; m < Mathf.Min(maxTethers, list3.Count); m++)
				{
					obiTetherConstraintBatch.AddConstraint(k, list3[m].Value, list3[m].Key, 1f, 1f);
				}
			}
			obiTetherConstraintBatch.Cook();
		}

		private void GenerateHierarchicalTethers(int maxLevels)
		{
			ObiTetherConstraintBatch obiTetherConstraintBatch = new ObiTetherConstraintBatch(cooked: true, sharesParticles: false, 0.0001f, 200f);
			TetherConstraints.AddBatch(obiTetherConstraintBatch);
			for (int i = 1; i <= maxLevels; i++)
			{
				int num = i * 2;
				for (int j = 0; j < usedParticles - num; j++)
				{
					int num2 = j + num;
					obiTetherConstraintBatch.AddConstraint(j, num2 % usedParticles, interParticleDistance * (float)num, 1f, 1f);
				}
			}
			obiTetherConstraintBatch.Cook();
		}
	}
	[Serializable]
	public class ObiRopeChainRenderMode : ObiRopeRenderMode
	{
		[HideInInspector]
		public List<GameObject> linkInstances;

		[SerializeProperty("RandomizeLinks")]
		[SerializeField]
		private bool randomizeLinks;

		public Vector3 linkScale = Vector3.one;

		public List<GameObject> chainLinks = new List<GameObject>();

		private ObiRope.CurveFrame frame;

		public bool RandomizeLinks
		{
			get
			{
				return randomizeLinks;
			}
			set
			{
				if (value != randomizeLinks)
				{
					randomizeLinks = value;
					Initialize();
				}
			}
		}

		private void ClearChainLinkInstances()
		{
			if (linkInstances == null)
			{
				return;
			}
			for (int i = 0; i < linkInstances.Count; i++)
			{
				if (linkInstances[i] != null)
				{
					UnityEngine.Object.DestroyImmediate(linkInstances[i]);
				}
			}
			linkInstances.Clear();
		}

		public override void Initialize()
		{
			if (rope.ropeMesh != null)
			{
				rope.ropeMesh.Clear();
			}
			ClearChainLinkInstances();
			if (chainLinks.Count > 0)
			{
				for (int i = 0; i < rope.TotalParticles; i++)
				{
					int index = (randomizeLinks ? UnityEngine.Random.Range(0, chainLinks.Count) : (i % chainLinks.Count));
					GameObject gameObject = null;
					if (chainLinks[index] != null)
					{
						gameObject = UnityEngine.Object.Instantiate(chainLinks[index]);
						gameObject.transform.SetParent(rope.transform, worldPositionStays: false);
						gameObject.hideFlags = HideFlags.HideAndDontSave;
						gameObject.SetActive(value: false);
					}
					linkInstances.Add(gameObject);
				}
			}
			Update(null);
		}

		public override void TearDown()
		{
			ClearChainLinkInstances();
		}

		public override void Update(Camera camera)
		{
			if (linkInstances.Count == 0)
			{
				return;
			}
			ObiDistanceConstraintBatch firstBatch = rope.DistanceConstraints.GetFirstBatch();
			if (frame == null)
			{
				frame = new ObiRope.CurveFrame();
			}
			frame.Reset();
			frame.SetTwist((0f - rope.sectionTwist) * (float)firstBatch.ConstraintCount * rope.uvAnchor);
			int num = -1;
			int num2 = 0;
			for (int i = 0; i < firstBatch.ConstraintCount; i++)
			{
				int num3 = firstBatch.springIndices[i * 2];
				int num4 = firstBatch.springIndices[i * 2 + 1];
				Vector3 particlePosition = rope.GetParticlePosition(num3);
				Vector3 particlePosition2 = rope.GetParticlePosition(num4);
				Vector3 vector = particlePosition2 - particlePosition;
				Vector3 normalized = vector.normalized;
				if (i > 0 && num3 != num)
				{
					if (rope.tearPrefabPool != null && num2 < rope.tearPrefabPool.Length)
					{
						if (!rope.tearPrefabPool[num2].activeSelf)
						{
							rope.tearPrefabPool[num2].SetActive(value: true);
						}
						rope.PlaceObjectAtCurveFrame(frame, rope.tearPrefabPool[num2], Space.World, reverseLookDirection: true);
						num2++;
					}
					frame.Reset();
				}
				frame.Transport(particlePosition2, normalized, rope.sectionTwist);
				if (i > 0 && num3 != num && rope.tearPrefabPool != null && num2 < rope.tearPrefabPool.Length)
				{
					if (!rope.tearPrefabPool[num2].activeSelf)
					{
						rope.tearPrefabPool[num2].SetActive(value: true);
					}
					frame.position = particlePosition;
					rope.PlaceObjectAtCurveFrame(frame, rope.tearPrefabPool[num2], Space.World, reverseLookDirection: false);
					num2++;
				}
				if (!rope.Closed)
				{
					if (i == 0 && rope.startPrefabInstance != null)
					{
						rope.PlaceObjectAtCurveFrame(frame, rope.startPrefabInstance, Space.World, reverseLookDirection: false);
					}
					else if (i == firstBatch.ConstraintCount - 1 && rope.endPrefabInstance != null)
					{
						frame.position = particlePosition2;
						rope.PlaceObjectAtCurveFrame(frame, rope.endPrefabInstance, Space.World, reverseLookDirection: true);
					}
				}
				if (linkInstances[i] != null)
				{
					linkInstances[i].SetActive(value: true);
					Transform transform = linkInstances[i].transform;
					transform.position = particlePosition + vector * 0.5f;
					transform.localScale = (rope.thicknessFromParticles ? (rope.solidRadii[num3] / rope.thickness * linkScale) : linkScale);
					transform.rotation = Quaternion.LookRotation(normalized, frame.normal);
				}
				num = num4;
			}
			for (int j = firstBatch.ConstraintCount; j < linkInstances.Count; j++)
			{
				if (linkInstances[j] != null)
				{
					linkInstances[j].SetActive(value: false);
				}
			}
		}
	}
	[Serializable]
	public class ObiRopeLineRenderMode : ObiRopeRenderMode
	{
		private List<Vector3> vertices = new List<Vector3>();

		private List<Vector3> normals = new List<Vector3>();

		private List<Vector4> tangents = new List<Vector4>();

		private List<Vector2> uvs = new List<Vector2>();

		private List<Color> vertColors = new List<Color>();

		private List<int> tris = new List<int>();

		private ObiRope.CurveFrame frame;

		public override void Initialize()
		{
			Update(null);
		}

		public override void TearDown()
		{
		}

		public override void Update(Camera camera)
		{
			if (camera == null || rope.ropeMesh == null || !rope.gameObject.activeInHierarchy)
			{
				return;
			}
			rope.SmoothCurvesFromParticles();
			ClearMeshData();
			float num = rope.SmoothLength / rope.RestLength;
			float num2 = (0f - rope.uvScale.y) * rope.RestLength * rope.uvAnchor;
			int num3 = 0;
			int num4 = 0;
			Vector3 vector = rope.transform.InverseTransformPoint(camera.transform.position);
			if (frame == null)
			{
				frame = new ObiRope.CurveFrame();
			}
			frame.Reset();
			frame.SetTwist((0f - rope.sectionTwist) * (float)rope.SmoothSections * rope.uvAnchor);
			Vector3 vector2 = Vector3.forward;
			Vector4 zero = Vector4.zero;
			Vector2 zero2 = Vector2.zero;
			for (int i = 0; i < rope.curves.Count; i++)
			{
				ObiList<ObiRope.CurveSection> obiList = rope.curves[i];
				frame.Reset();
				for (int j = 0; j < obiList.Count; j++)
				{
					int index = Mathf.Min(j + 1, obiList.Count - 1);
					int index2 = Mathf.Max(j - 1, 0);
					Vector3 vector3 = ((!rope.Closed || i != rope.curves.Count - 1 || j != obiList.Count - 1) ? ((Vector3)(obiList[index].positionAndRadius - obiList[j].positionAndRadius)) : vector2);
					Vector3 vector4 = obiList[j].positionAndRadius - obiList[index2].positionAndRadius;
					Vector3 vector5 = vector3 + vector4;
					frame.Transport(obiList[j].positionAndRadius, vector5, rope.sectionTwist);
					if (rope.tearPrefabPool != null)
					{
						if (num4 < rope.tearPrefabPool.Length && i > 0 && j == 0)
						{
							if (!rope.tearPrefabPool[num4].activeSelf)
							{
								rope.tearPrefabPool[num4].SetActive(value: true);
							}
							rope.PlaceObjectAtCurveFrame(frame, rope.tearPrefabPool[num4], Space.Self, reverseLookDirection: false);
							num4++;
						}
						if (num4 < rope.tearPrefabPool.Length && i < rope.curves.Count - 1 && j == obiList.Count - 1)
						{
							if (!rope.tearPrefabPool[num4].activeSelf)
							{
								rope.tearPrefabPool[num4].SetActive(value: true);
							}
							rope.PlaceObjectAtCurveFrame(frame, rope.tearPrefabPool[num4], Space.Self, reverseLookDirection: true);
							num4++;
						}
					}
					if (i == 0 && j == 0)
					{
						vector2 = vector5;
						if (rope.startPrefabInstance != null && !rope.Closed)
						{
							rope.PlaceObjectAtCurveFrame(frame, rope.startPrefabInstance, Space.Self, reverseLookDirection: false);
						}
					}
					else if (i == rope.curves.Count - 1 && j == obiList.Count - 1 && rope.endPrefabInstance != null && !rope.Closed)
					{
						rope.PlaceObjectAtCurveFrame(frame, rope.endPrefabInstance, Space.Self, reverseLookDirection: true);
					}
					num2 += rope.uvScale.y * (Vector3.Distance(obiList[j].positionAndRadius, obiList[index2].positionAndRadius) / (rope.normalizeV ? rope.SmoothLength : num));
					float num5 = (rope.thicknessFromParticles ? obiList[j].positionAndRadius.w : rope.thickness) * rope.sectionThicknessScale;
					Vector3 vector6 = frame.position - vector;
					vector6.Normalize();
					Vector3 vector7 = Vector3.Cross(frame.tangent, vector6);
					vector7.Normalize();
					vertices.Add(frame.position + vector7 * num5);
					vertices.Add(frame.position - vector7 * num5);
					normals.Add(-vector6);
					normals.Add(-vector6);
					zero = -vector7;
					zero.w = 1f;
					tangents.Add(zero);
					tangents.Add(zero);
					vertColors.Add(obiList[j].color);
					vertColors.Add(obiList[j].color);
					zero2.Set(0f, num2);
					uvs.Add(zero2);
					zero2.Set(1f, num2);
					uvs.Add(zero2);
					if (j < obiList.Count - 1)
					{
						tris.Add(num3 * 2);
						tris.Add(num3 * 2 + 1);
						tris.Add((num3 + 1) * 2);
						tris.Add(num3 * 2 + 1);
						tris.Add((num3 + 1) * 2 + 1);
						tris.Add((num3 + 1) * 2);
					}
					num3++;
				}
			}
			CommitMeshData();
		}

		private void ClearMeshData()
		{
			rope.ropeMesh.Clear();
			vertices.Clear();
			normals.Clear();
			tangents.Clear();
			uvs.Clear();
			vertColors.Clear();
			tris.Clear();
		}

		private void CommitMeshData()
		{
			rope.ropeMesh.SetVertices(vertices);
			rope.ropeMesh.SetNormals(normals);
			rope.ropeMesh.SetTangents(tangents);
			rope.ropeMesh.SetColors(vertColors);
			rope.ropeMesh.SetUVs(0, uvs);
			rope.ropeMesh.SetTriangles(tris, 0, calculateBounds: true);
		}
	}
	[Serializable]
	public class ObiRopeMeshRenderMode : ObiRopeRenderMode
	{
		public enum Axis
		{
			X,
			Y,
			Z
		}

		[SerializeProperty("SourceMesh")]
		[SerializeField]
		private Mesh mesh;

		[SerializeProperty("SweepAxis")]
		[SerializeField]
		private Axis axis;

		public float volumeScaling;

		public bool stretchWithRope = true;

		public bool spanEntireLength = true;

		[SerializeProperty("Instances")]
		[SerializeField]
		private int instances = 1;

		[SerializeProperty("InstanceSpacing")]
		[SerializeField]
		private float instanceSpacing = 1f;

		public float offset;

		public Vector3 scale = Vector3.one;

		[HideInInspector]
		[SerializeField]
		private float meshSizeAlongAxis = 1f;

		private Vector3[] inputVertices;

		private Vector3[] inputNormals;

		private Vector4[] inputTangents;

		private Vector3[] vertices;

		private Vector3[] normals;

		private Vector4[] tangents;

		private int[] orderedVertices = new int[0];

		private ObiRope.CurveFrame frame;

		public Mesh SourceMesh
		{
			get
			{
				return mesh;
			}
			set
			{
				mesh = value;
				PreprocessInputMesh();
				Update(null);
			}
		}

		public Axis SweepAxis
		{
			get
			{
				return axis;
			}
			set
			{
				axis = value;
				PreprocessInputMesh();
				Update(null);
			}
		}

		public int Instances
		{
			get
			{
				return instances;
			}
			set
			{
				instances = value;
				PreprocessInputMesh();
				Update(null);
			}
		}

		public float InstanceSpacing
		{
			get
			{
				return instanceSpacing;
			}
			set
			{
				instanceSpacing = value;
				PreprocessInputMesh();
				Update(null);
			}
		}

		public override void Initialize()
		{
			PreprocessInputMesh();
			Update(null);
		}

		public override void TearDown()
		{
		}

		private void PreprocessInputMesh()
		{
			rope.ropeMesh.Clear();
			if (this.mesh == null)
			{
				orderedVertices = new int[0];
				return;
			}
			instances = Mathf.Max(0, instances);
			Mesh mesh = new Mesh();
			CombineInstance[] array = new CombineInstance[instances];
			Vector3 zero = Vector3.zero;
			zero[(int)axis] = this.mesh.bounds.extents[(int)axis];
			for (int i = 0; i < instances; i++)
			{
				array[i].mesh = this.mesh;
				array[i].transform = Matrix4x4.TRS(zero, Quaternion.identity, Vector3.one);
				zero[(int)axis] = this.mesh.bounds.extents[(int)axis] + (float)(i + 1) * this.mesh.bounds.size[(int)axis] * instanceSpacing;
			}
			mesh.CombineMeshes(array, mergeSubMeshes: true, useMatrices: true);
			inputVertices = mesh.vertices;
			inputNormals = mesh.normals;
			inputTangents = mesh.tangents;
			float[] array2 = new float[inputVertices.Length];
			orderedVertices = new int[inputVertices.Length];
			for (int j = 0; j < array2.Length; j++)
			{
				array2[j] = inputVertices[j][(int)axis];
				orderedVertices[j] = j;
			}
			Array.Sort(array2, orderedVertices);
			rope.ropeMesh.vertices = mesh.vertices;
			rope.ropeMesh.normals = mesh.normals;
			rope.ropeMesh.tangents = mesh.tangents;
			rope.ropeMesh.uv = mesh.uv;
			rope.ropeMesh.uv2 = mesh.uv2;
			rope.ropeMesh.uv3 = mesh.uv3;
			rope.ropeMesh.uv4 = mesh.uv4;
			rope.ropeMesh.colors = mesh.colors;
			rope.ropeMesh.triangles = mesh.triangles;
			vertices = rope.ropeMesh.vertices;
			normals = rope.ropeMesh.normals;
			tangents = rope.ropeMesh.tangents;
			meshSizeAlongAxis = mesh.bounds.size[(int)axis];
			UnityEngine.Object.DestroyImmediate(mesh);
		}

		public override void Update(Camera camera)
		{
			if (mesh == null || rope.ropeMesh == null)
			{
				return;
			}
			rope.SmoothCurvesFromParticles();
			if (rope.curves.Count == 0)
			{
				return;
			}
			ObiList<ObiRope.CurveSection> obiList = rope.curves[0];
			if (obiList.Count < 2)
			{
				return;
			}
			float num = (stretchWithRope ? (rope.SmoothLength / rope.RestLength) : 1f);
			float num2 = Mathf.Clamp(1f + volumeScaling * (1f / Mathf.Max(num, 0.01f) - 1f), 0.01f, 2f);
			Vector3 vector = scale;
			if (spanEntireLength)
			{
				vector[(int)axis] = rope.RestLength / meshSizeAlongAxis;
			}
			float num3 = 0f;
			float num4 = 0f;
			int num5 = 0;
			int index = 1;
			int index2 = 0;
			Vector3 vector2 = obiList[index].positionAndRadius - obiList[num5].positionAndRadius;
			Vector3 vector3 = obiList[num5].positionAndRadius - obiList[index2].positionAndRadius;
			Vector3 normalized = (vector2 + vector3).normalized;
			float magnitude = vector2.magnitude;
			if (frame == null)
			{
				frame = new ObiRope.CurveFrame();
			}
			frame.Reset();
			frame.SetTwistAndTangent((0f - rope.sectionTwist) * (float)rope.SmoothSections * rope.uvAnchor, normalized);
			frame.position = obiList[num5].positionAndRadius;
			Matrix4x4 matrix4x = default(Matrix4x4);
			int num6 = (int)axis % 3 * 4;
			int num7 = (int)(axis + 1) % 3 * 4;
			int num8 = (int)(axis + 2) % 3 * 4;
			matrix4x[num6] = frame.tangent[0];
			matrix4x[num6 + 1] = frame.tangent[1];
			matrix4x[num6 + 2] = frame.tangent[2];
			matrix4x[num7] = frame.normal[0];
			matrix4x[num7 + 1] = frame.normal[1];
			matrix4x[num7 + 2] = frame.normal[2];
			matrix4x[num8] = frame.binormal[0];
			matrix4x[num8 + 1] = frame.binormal[1];
			matrix4x[num8 + 2] = frame.binormal[2];
			for (int i = 0; i < orderedVertices.Length; i++)
			{
				int num9 = orderedVertices[i];
				float num10 = inputVertices[num9][(int)axis] * vector[(int)axis] + offset;
				num4 += (num10 - num3) * num;
				num3 = num10;
				while (num4 > magnitude && magnitude > Mathf.Epsilon)
				{
					num4 -= magnitude;
					num5 = Mathf.Min(num5 + 1, obiList.Count - 1);
					index = Mathf.Min(num5 + 1, obiList.Count - 1);
					index2 = Mathf.Max(num5 - 1, 0);
					vector2 = obiList[index].positionAndRadius - obiList[num5].positionAndRadius;
					vector3 = obiList[num5].positionAndRadius - obiList[index2].positionAndRadius;
					normalized = (vector2 + vector3).normalized;
					magnitude = vector2.magnitude;
					frame.Transport(obiList[num5].positionAndRadius, normalized, rope.sectionTwist);
					matrix4x[num6] = frame.tangent[0];
					matrix4x[num6 + 1] = frame.tangent[1];
					matrix4x[num6 + 2] = frame.tangent[2];
					matrix4x[num7] = frame.normal[0];
					matrix4x[num7 + 1] = frame.normal[1];
					matrix4x[num7 + 2] = frame.normal[2];
					matrix4x[num8] = frame.binormal[0];
					matrix4x[num8 + 1] = frame.binormal[1];
					matrix4x[num8 + 2] = frame.binormal[2];
				}
				float num11 = (rope.thicknessFromParticles ? obiList[num5].positionAndRadius.w : rope.thickness);
				Vector3 vector4 = Vector3.Scale(inputVertices[num9], vector * num11 * num2);
				vector4[(int)axis] = num4;
				vertices[num9] = frame.position + matrix4x.MultiplyVector(vector4);
				normals[num9] = matrix4x.MultiplyVector(inputNormals[num9]);
				tangents[num9] = matrix4x * inputTangents[num9];
				tangents[num9].w = inputTangents[num9].w;
			}
			CommitMeshData();
		}

		private void CommitMeshData()
		{
			rope.ropeMesh.vertices = vertices;
			rope.ropeMesh.normals = normals;
			rope.ropeMesh.tangents = tangents;
			rope.ropeMesh.RecalculateBounds();
		}
	}
	[Serializable]
	public abstract class ObiRopeRenderMode
	{
		protected ObiRope rope;

		public ObiRope Rope
		{
			set
			{
				rope = value;
			}
		}

		public abstract void Initialize();

		public abstract void Update(Camera camera);

		public abstract void TearDown();
	}
	[Serializable]
	public class ObiRopeThickRenderMode : ObiRopeRenderMode
	{
		private List<Vector3> vertices = new List<Vector3>();

		private List<Vector3> normals = new List<Vector3>();

		private List<Vector4> tangents = new List<Vector4>();

		private List<Vector2> uvs = new List<Vector2>();

		private List<Color> vertColors = new List<Color>();

		private List<int> tris = new List<int>();

		private ObiRope.CurveFrame frame;

		public override void Initialize()
		{
			Update(null);
		}

		public override void TearDown()
		{
		}

		public override void Update(Camera camera)
		{
			if (rope.section == null || rope.ropeMesh == null)
			{
				return;
			}
			rope.SmoothCurvesFromParticles();
			ClearMeshData();
			float num = rope.SmoothLength / rope.RestLength;
			int segments = rope.section.Segments;
			int num2 = segments + 1;
			float num3 = (0f - rope.uvScale.y) * rope.RestLength * rope.uvAnchor;
			int num4 = 0;
			int num5 = 0;
			if (frame == null)
			{
				frame = new ObiRope.CurveFrame();
			}
			frame.Reset();
			frame.SetTwist((0f - rope.sectionTwist) * (float)rope.SmoothSections * rope.uvAnchor);
			Vector3 vector = Vector3.forward;
			Vector4 zero = Vector4.zero;
			Vector2 zero2 = Vector2.zero;
			for (int i = 0; i < rope.curves.Count; i++)
			{
				ObiList<ObiRope.CurveSection> obiList = rope.curves[i];
				frame.Reset();
				for (int j = 0; j < obiList.Count; j++)
				{
					int index = Mathf.Min(j + 1, obiList.Count - 1);
					int index2 = Mathf.Max(j - 1, 0);
					Vector3 vector2 = ((!rope.Closed || i != rope.curves.Count - 1 || j != obiList.Count - 1) ? ((Vector3)(obiList[index].positionAndRadius - obiList[j].positionAndRadius)) : vector);
					Vector3 vector3 = obiList[j].positionAndRadius - obiList[index2].positionAndRadius;
					Vector3 vector4 = vector2 + vector3;
					frame.Transport(obiList[j].positionAndRadius, vector4, rope.sectionTwist);
					if (rope.tearPrefabPool != null)
					{
						if (num5 < rope.tearPrefabPool.Length && i > 0 && j == 0)
						{
							if (!rope.tearPrefabPool[num5].activeSelf)
							{
								rope.tearPrefabPool[num5].SetActive(value: true);
							}
							rope.PlaceObjectAtCurveFrame(frame, rope.tearPrefabPool[num5], Space.Self, reverseLookDirection: false);
							num5++;
						}
						if (num5 < rope.tearPrefabPool.Length && i < rope.curves.Count - 1 && j == obiList.Count - 1)
						{
							if (!rope.tearPrefabPool[num5].activeSelf)
							{
								rope.tearPrefabPool[num5].SetActive(value: true);
							}
							rope.PlaceObjectAtCurveFrame(frame, rope.tearPrefabPool[num5], Space.Self, reverseLookDirection: true);
							num5++;
						}
					}
					if (i == 0 && j == 0)
					{
						vector = vector4;
						if (rope.startPrefabInstance != null && !rope.Closed)
						{
							rope.PlaceObjectAtCurveFrame(frame, rope.startPrefabInstance, Space.Self, reverseLookDirection: false);
						}
					}
					else if (i == rope.curves.Count - 1 && j == obiList.Count - 1 && rope.endPrefabInstance != null && !rope.Closed)
					{
						rope.PlaceObjectAtCurveFrame(frame, rope.endPrefabInstance, Space.Self, reverseLookDirection: true);
					}
					num3 += rope.uvScale.y * (Vector3.Distance(obiList[j].positionAndRadius, obiList[index2].positionAndRadius) / (rope.normalizeV ? rope.SmoothLength : num));
					float num6 = (rope.thicknessFromParticles ? obiList[j].positionAndRadius.w : rope.thickness) * rope.sectionThicknessScale;
					for (int k = 0; k <= segments; k++)
					{
						vertices.Add(frame.position + (rope.section.vertices[k].x * frame.normal + rope.section.vertices[k].y * frame.binormal) * num6);
						normals.Add(vertices[vertices.Count - 1] - frame.position);
						zero = -Vector3.Cross(normals[normals.Count - 1], frame.tangent);
						zero.w = 1f;
						tangents.Add(zero);
						vertColors.Add(obiList[j].color);
						zero2.Set((float)k / (float)segments * rope.uvScale.x, num3);
						uvs.Add(zero2);
						if (k < segments && j < obiList.Count - 1)
						{
							tris.Add(num4 * num2 + k);
							tris.Add(num4 * num2 + (k + 1));
							tris.Add((num4 + 1) * num2 + k);
							tris.Add(num4 * num2 + (k + 1));
							tris.Add((num4 + 1) * num2 + (k + 1));
							tris.Add((num4 + 1) * num2 + k);
						}
					}
					num4++;
				}
			}
			CommitMeshData();
		}

		private void ClearMeshData()
		{
			rope.ropeMesh.Clear();
			vertices.Clear();
			normals.Clear();
			tangents.Clear();
			uvs.Clear();
			vertColors.Clear();
			tris.Clear();
		}

		private void CommitMeshData()
		{
			rope.ropeMesh.SetVertices(vertices);
			rope.ropeMesh.SetNormals(normals);
			rope.ropeMesh.SetTangents(tangents);
			rope.ropeMesh.SetColors(vertColors);
			rope.ropeMesh.SetUVs(0, uvs);
			rope.ropeMesh.SetTriangles(tris, 0, calculateBounds: true);
		}
	}
	[ExecuteInEditMode]
	[AddComponentMenu("Physics/Obi/Obi Stitcher")]
	public class ObiStitcher : MonoBehaviour, IObiSolverClient
	{
		[Serializable]
		public class Stitch
		{
			public int particleIndex1;

			public int particleIndex2;

			public Stitch(int particleIndex1, int particleIndex2)
			{
				this.particleIndex1 = particleIndex1;
				this.particleIndex2 = particleIndex2;
			}
		}

		[SerializeField]
		[HideInInspector]
		private List<Stitch> stitches = new List<Stitch>();

		[SerializeField]
		[HideInInspector]
		private ObiActor actor1;

		[SerializeField]
		[HideInInspector]
		private ObiActor actor2;

		private IntPtr batch;

		private bool inSolver;

		public ObiActor Actor1
		{
			get
			{
				return actor1;
			}
			set
			{
				if (!(actor1 != value))
				{
					return;
				}
				if (actor1 != null)
				{
					actor1.OnAddedToSolver -= Actor_OnAddedToSolver;
					actor1.OnRemovedFromSolver -= Actor_OnRemovedFromSolver;
					if (actor1.InSolver)
					{
						Actor_OnRemovedFromSolver(actor1, new ObiActor.ObiActorSolverArgs(actor1.Solver));
					}
				}
				actor1 = value;
				if (actor1 != null)
				{
					actor1.OnAddedToSolver += Actor_OnAddedToSolver;
					actor1.OnRemovedFromSolver += Actor_OnRemovedFromSolver;
					if (actor1.InSolver)
					{
						Actor_OnAddedToSolver(actor1, new ObiActor.ObiActorSolverArgs(actor1.Solver));
					}
				}
			}
		}

		public ObiActor Actor2
		{
			get
			{
				return actor2;
			}
			set
			{
				if (!(actor2 != value))
				{
					return;
				}
				if (actor2 != null)
				{
					actor2.OnAddedToSolver -= Actor_OnAddedToSolver;
					actor2.OnRemovedFromSolver -= Actor_OnRemovedFromSolver;
					if (actor2.InSolver)
					{
						Actor_OnRemovedFromSolver(actor2, new ObiActor.ObiActorSolverArgs(actor2.Solver));
					}
				}
				actor2 = value;
				if (actor2 != null)
				{
					actor2.OnAddedToSolver += Actor_OnAddedToSolver;
					actor2.OnRemovedFromSolver += Actor_OnRemovedFromSolver;
					if (actor2.InSolver)
					{
						Actor_OnAddedToSolver(actor2, new ObiActor.ObiActorSolverArgs(actor2.Solver));
					}
				}
			}
		}

		public int StitchCount => stitches.Count;

		public IEnumerable<Stitch> Stitches => stitches.AsReadOnly();

		public void OnEnable()
		{
			if (actor1 != null)
			{
				actor1.OnAddedToSolver += Actor_OnAddedToSolver;
				actor1.OnRemovedFromSolver += Actor_OnRemovedFromSolver;
			}
			if (actor2 != null)
			{
				actor2.OnAddedToSolver += Actor_OnAddedToSolver;
				actor2.OnRemovedFromSolver += Actor_OnRemovedFromSolver;
			}
			if (actor1 != null && actor2 != null)
			{
				Oni.EnableBatch(batch, enabled: true);
			}
		}

		public void OnDisable()
		{
			Oni.EnableBatch(batch, enabled: false);
		}

		public int AddStitch(int particle1, int particle2)
		{
			stitches.Add(new Stitch(particle1, particle2));
			return stitches.Count - 1;
		}

		public void RemoveStitch(int index)
		{
			if (index >= 0 && index < stitches.Count)
			{
				stitches.RemoveAt(index);
			}
		}

		public void Clear()
		{
			stitches.Clear();
			PushDataToSolver();
		}

		private void Actor_OnRemovedFromSolver(object sender, ObiActor.ObiActorSolverArgs e)
		{
			RemoveFromSolver(null);
		}

		private void Actor_OnAddedToSolver(object sender, ObiActor.ObiActorSolverArgs e)
		{
			if (actor1.InSolver && actor2.InSolver)
			{
				if (actor1.Solver != actor2.Solver)
				{
					UnityEngine.Debug.LogError("ObiStitcher cannot handle actors in different solvers.");
				}
				else
				{
					AddToSolver(null);
				}
			}
		}

		public bool AddToSolver(object info)
		{
			batch = Oni.CreateBatch(10, cooked: false);
			Oni.AddBatch(actor1.Solver.OniSolver, batch, sharesParticles: false);
			inSolver = true;
			PushDataToSolver();
			if (base.isActiveAndEnabled)
			{
				OnEnable();
			}
			else
			{
				OnDisable();
			}
			return true;
		}

		public bool RemoveFromSolver(object info)
		{
			Oni.RemoveBatch(actor1.Solver.OniSolver, batch);
			batch = IntPtr.Zero;
			inSolver = false;
			return true;
		}

		public void PushDataToSolver(ParticleData data = ParticleData.NONE)
		{
			if (inSolver)
			{
				int[] array = new int[stitches.Count * 2];
				float[] array2 = new float[stitches.Count];
				for (int i = 0; i < stitches.Count; i++)
				{
					array[i * 2] = actor1.particleIndices[stitches[i].particleIndex1];
					array[i * 2 + 1] = actor2.particleIndices[stitches[i].particleIndex2];
					array2[i] = 0f;
				}
				Oni.SetStitchConstraints(batch, array, array2, stitches.Count);
				int[] array3 = new int[stitches.Count];
				for (int j = 0; j < stitches.Count; j++)
				{
					array3[j] = j;
				}
				Oni.SetActiveConstraints(batch, array3, stitches.Count);
			}
		}

		public void PullDataFromSolver(ParticleData data = ParticleData.NONE)
		{
		}
	}
	[AttributeUsage(AttributeTargets.Field)]
	public class ChildrenOnly : MultiPropertyAttribute
	{
	}
	[AttributeUsage(AttributeTargets.Field)]
	public class Indent : MultiPropertyAttribute
	{
	}
	[AttributeUsage(AttributeTargets.Field)]
	public class MultiDelayed : MultiPropertyAttribute
	{
	}
	[AttributeUsage(AttributeTargets.Field)]
	public abstract class MultiPropertyAttribute : PropertyAttribute
	{
	}
	[AttributeUsage(AttributeTargets.Field)]
	public class MultiRange : MultiPropertyAttribute
	{
		private float min;

		private float max;

		public MultiRange(float min, float max)
		{
			this.min = min;
			this.max = max;
		}
	}
	[AttributeUsage(AttributeTargets.Field)]
	public class SerializeProperty : PropertyAttribute
	{
		public string PropertyName { get; private set; }

		public SerializeProperty(string propertyName)
		{
			PropertyName = propertyName;
		}
	}
	[AttributeUsage(AttributeTargets.Field)]
	public class VisibleIf : MultiPropertyAttribute
	{
		private MethodInfo eventMethodInfo;

		private FieldInfo fieldInfo;

		public string MethodName { get; private set; }

		public bool Negate { get; private set; }

		public VisibleIf(string methodName, bool negate = false)
		{
			MethodName = methodName;
			Negate = negate;
		}
	}
	public class ObiBoxShapeTracker2D : ObiShapeTracker
	{
		private Vector2 size;

		private Vector2 center;

		public ObiBoxShapeTracker2D(BoxCollider2D collider)
		{
			base.collider = collider;
			adaptor.is2D = true;
			oniShape = Oni.CreateShape(Oni.ShapeType.Box);
		}

		public override bool UpdateIfNeeded()
		{
			BoxCollider2D boxCollider2D = collider as BoxCollider2D;
			if (boxCollider2D != null && (boxCollider2D.size != size || boxCollider2D.offset != center))
			{
				size = boxCollider2D.size;
				center = boxCollider2D.offset;
				adaptor.Set(center, size);
				Oni.UpdateShape(oniShape, ref adaptor);
				return true;
			}
			return false;
		}
	}
	public class ObiCapsuleShapeTracker2D : ObiShapeTracker
	{
		private CapsuleDirection2D direction;

		private Vector2 size;

		private Vector2 center;

		public ObiCapsuleShapeTracker2D(CapsuleCollider2D collider)
		{
			base.collider = collider;
			adaptor.is2D = true;
			oniShape = Oni.CreateShape(Oni.ShapeType.Capsule);
		}

		public override bool UpdateIfNeeded()
		{
			CapsuleCollider2D capsuleCollider2D = collider as CapsuleCollider2D;
			if (capsuleCollider2D != null && (capsuleCollider2D.size != size || capsuleCollider2D.direction != direction || capsuleCollider2D.offset != center))
			{
				size = capsuleCollider2D.size;
				direction = capsuleCollider2D.direction;
				center = capsuleCollider2D.offset;
				adaptor.Set(center, ((capsuleCollider2D.direction == CapsuleDirection2D.Horizontal) ? size.y : size.x) * 0.5f, Mathf.Max(size.x, size.y), (capsuleCollider2D.direction != CapsuleDirection2D.Horizontal) ? 1 : 0);
				Oni.UpdateShape(oniShape, ref adaptor);
				return true;
			}
			return false;
		}
	}
	public class ObiCircleShapeTracker2D : ObiShapeTracker
	{
		private float radius;

		private Vector2 center;

		public ObiCircleShapeTracker2D(CircleCollider2D collider)
		{
			base.collider = collider;
			adaptor.is2D = true;
			oniShape = Oni.CreateShape(Oni.ShapeType.Sphere);
		}

		public override bool UpdateIfNeeded()
		{
			CircleCollider2D circleCollider2D = collider as CircleCollider2D;
			if (circleCollider2D != null && (circleCollider2D.radius != radius || circleCollider2D.offset != center))
			{
				radius = circleCollider2D.radius;
				center = circleCollider2D.offset;
				adaptor.Set(center, radius);
				Oni.UpdateShape(oniShape, ref adaptor);
				return true;
			}
			return false;
		}
	}
	public class ObiEdgeShapeTracker2D : ObiShapeTracker
	{
		private int pointCount;

		private GCHandle pointsHandle;

		private GCHandle indicesHandle;

		private bool edgeDataHasChanged;

		public ObiEdgeShapeTracker2D(EdgeCollider2D collider)
		{
			base.collider = collider;
			adaptor.is2D = true;
			oniShape = Oni.CreateShape(Oni.ShapeType.EdgeMesh);
			UpdateEdgeData();
		}

		public void UpdateEdgeData()
		{
			EdgeCollider2D edgeCollider2D = collider as EdgeCollider2D;
			if (edgeCollider2D != null)
			{
				Vector3[] array = new Vector3[edgeCollider2D.pointCount];
				int[] array2 = new int[edgeCollider2D.edgeCount * 2];
				Vector2[] points = edgeCollider2D.points;
				for (int i = 0; i < edgeCollider2D.pointCount; i++)
				{
					array[i] = points[i];
				}
				for (int j = 0; j < edgeCollider2D.edgeCount; j++)
				{
					array2[j * 2] = j;
					array2[j * 2 + 1] = j + 1;
				}
				Oni.UnpinMemory(pointsHandle);
				Oni.UnpinMemory(indicesHandle);
				pointsHandle = Oni.PinMemory(array);
				indicesHandle = Oni.PinMemory(array2);
				edgeDataHasChanged = true;
			}
		}

		public override bool UpdateIfNeeded()
		{
			EdgeCollider2D edgeCollider2D = collider as EdgeCollider2D;
			if (edgeCollider2D != null && (edgeCollider2D.pointCount != pointCount || edgeDataHasChanged))
			{
				pointCount = edgeCollider2D.pointCount;
				edgeDataHasChanged = false;
				adaptor.Set(pointsHandle.AddrOfPinnedObject(), indicesHandle.AddrOfPinnedObject(), edgeCollider2D.pointCount, edgeCollider2D.edgeCount * 2);
				Oni.UpdateShape(oniShape, ref adaptor);
				return true;
			}
			return false;
		}

		public override void Destroy()
		{
			base.Destroy();
			Oni.UnpinMemory(pointsHandle);
			Oni.UnpinMemory(indicesHandle);
		}
	}
	public class ObiBoxShapeTracker : ObiShapeTracker
	{
		private Vector3 size;

		private Vector3 center;

		public ObiBoxShapeTracker(BoxCollider collider)
		{
			base.collider = collider;
			adaptor.is2D = false;
			oniShape = Oni.CreateShape(Oni.ShapeType.Box);
		}

		public override bool UpdateIfNeeded()
		{
			BoxCollider boxCollider = collider as BoxCollider;
			if (boxCollider != null && (boxCollider.size != size || boxCollider.center != center))
			{
				size = boxCollider.size;
				center = boxCollider.center;
				adaptor.Set(center, size);
				Oni.UpdateShape(oniShape, ref adaptor);
				return true;
			}
			return false;
		}
	}
	public class ObiCapsuleShapeTracker : ObiShapeTracker
	{
		private int direction;

		private float radius;

		private float height;

		private Vector3 center;

		public ObiCapsuleShapeTracker(CapsuleCollider collider)
		{
			base.collider = collider;
			adaptor.is2D = false;
			oniShape = Oni.CreateShape(Oni.ShapeType.Capsule);
		}

		public ObiCapsuleShapeTracker(CharacterController collider)
		{
			base.collider = collider;
			adaptor.is2D = false;
			oniShape = Oni.CreateShape(Oni.ShapeType.Capsule);
		}

		public override bool UpdateIfNeeded()
		{
			CapsuleCollider capsuleCollider = collider as CapsuleCollider;
			if (capsuleCollider != null && (capsuleCollider.radius != radius || capsuleCollider.height != height || capsuleCollider.direction != direction || capsuleCollider.center != center))
			{
				radius = capsuleCollider.radius;
				height = capsuleCollider.height;
				direction = capsuleCollider.direction;
				center = capsuleCollider.center;
				adaptor.Set(center, radius, height, direction);
				Oni.UpdateShape(oniShape, ref adaptor);
				return true;
			}
			CharacterController characterController = collider as CharacterController;
			if (characterController != null && (characterController.radius != radius || characterController.height != height || characterController.center != center))
			{
				radius = characterController.radius;
				height = characterController.height;
				center = characterController.center;
				adaptor.Set(center, radius, height, 1);
				Oni.UpdateShape(oniShape, ref adaptor);
				return true;
			}
			return false;
		}
	}
	public class ObiDistanceFieldShapeTracker : ObiShapeTracker
	{
		public ObiDistanceField distanceField;

		private bool fieldDataHasChanged;

		public ObiDistanceFieldShapeTracker(ObiDistanceField distanceField)
		{
			this.distanceField = distanceField;
			adaptor.is2D = false;
			oniShape = Oni.CreateShape(Oni.ShapeType.SignedDistanceField);
			fieldDataHasChanged = true;
		}

		public override bool UpdateIfNeeded()
		{
			if (distanceField != null && distanceField.Initialized && fieldDataHasChanged)
			{
				Oni.SetShapeDistanceField(oniShape, distanceField.OniDistanceField);
				fieldDataHasChanged = false;
				return true;
			}
			return false;
		}
	}
	public class ObiMeshShapeTracker : ObiShapeTracker
	{
		private class MeshDataHandles
		{
			private int refCount = 1;

			private GCHandle verticesHandle;

			private GCHandle indicesHandle;

			public int RefCount => refCount;

			public IntPtr VerticesAddress => verticesHandle.AddrOfPinnedObject();

			public IntPtr IndicesAddress => indicesHandle.AddrOfPinnedObject();

			public void FromMesh(Mesh mesh)
			{
				Oni.UnpinMemory(verticesHandle);
				Oni.UnpinMemory(indicesHandle);
				verticesHandle = Oni.PinMemory(mesh.vertices);
				indicesHandle = Oni.PinMemory(mesh.triangles);
			}

			public void Ref()
			{
				refCount++;
			}

			public void Unref()
			{
				refCount--;
				if (refCount <= 0)
				{
					refCount = 0;
					Oni.UnpinMemory(verticesHandle);
					Oni.UnpinMemory(indicesHandle);
				}
			}
		}

		private static Dictionary<Mesh, MeshDataHandles> meshDataCache = new Dictionary<Mesh, MeshDataHandles>();

		private bool meshDataHasChanged;

		private MeshDataHandles handles;

		public ObiMeshShapeTracker(MeshCollider collider)
		{
			base.collider = collider;
			adaptor.is2D = false;
			oniShape = Oni.CreateShape(Oni.ShapeType.TriangleMesh);
			UpdateMeshData();
		}

		public void UpdateMeshData()
		{
			MeshCollider meshCollider = collider as MeshCollider;
			if (meshCollider != null)
			{
				Mesh sharedMesh = meshCollider.sharedMesh;
				if (handles != null)
				{
					handles.Unref();
				}
				if (!meshDataCache.TryGetValue(sharedMesh, out var value))
				{
					handles = new MeshDataHandles();
					meshDataCache[sharedMesh] = handles;
				}
				else
				{
					value.Ref();
					handles = value;
				}
				handles.FromMesh(meshCollider.sharedMesh);
				meshDataHasChanged = true;
			}
		}

		public override bool UpdateIfNeeded()
		{
			MeshCollider meshCollider = collider as MeshCollider;
			if (meshCollider != null)
			{
				Mesh sharedMesh = meshCollider.sharedMesh;
				if (sharedMesh != null && meshDataHasChanged)
				{
					meshDataHasChanged = false;
					adaptor.Set(handles.VerticesAddress, handles.IndicesAddress, sharedMesh.vertexCount, sharedMesh.triangles.Length);
					Oni.UpdateShape(oniShape, ref adaptor);
					return true;
				}
			}
			return false;
		}

		public override void Destroy()
		{
			base.Destroy();
			MeshCollider meshCollider = collider as MeshCollider;
			if (meshCollider != null && handles != null)
			{
				handles.Unref();
				if (handles.RefCount <= 0)
				{
					meshDataCache.Remove(meshCollider.sharedMesh);
				}
			}
		}
	}
	public abstract class ObiShapeTracker
	{
		protected UnityEngine.Component collider;

		protected Oni.Shape adaptor;

		protected IntPtr oniShape = IntPtr.Zero;

		public IntPtr OniShape => oniShape;

		public virtual void Destroy()
		{
			Oni.DestroyShape(oniShape);
			oniShape = IntPtr.Zero;
		}

		public abstract bool UpdateIfNeeded();
	}
	public class ObiSphereShapeTracker : ObiShapeTracker
	{
		private float radius;

		private Vector3 center;

		public ObiSphereShapeTracker(SphereCollider collider)
		{
			base.collider = collider;
			adaptor.is2D = false;
			oniShape = Oni.CreateShape(Oni.ShapeType.Sphere);
		}

		public override bool UpdateIfNeeded()
		{
			SphereCollider sphereCollider = collider as SphereCollider;
			if (sphereCollider != null && (sphereCollider.radius != radius || sphereCollider.center != center))
			{
				radius = sphereCollider.radius;
				center = sphereCollider.center;
				adaptor.Set(center, radius);
				Oni.UpdateShape(oniShape, ref adaptor);
				return true;
			}
			return false;
		}
	}
	public class ObiTerrainShapeTracker : ObiShapeTracker
	{
		private Vector3 size;

		private int resolutionU;

		private int resolutionV;

		private GCHandle dataHandle;

		private bool heightmapDataHasChanged;

		public ObiTerrainShapeTracker(TerrainCollider collider)
		{
			base.collider = collider;
			adaptor.is2D = false;
			oniShape = Oni.CreateShape(Oni.ShapeType.Heightmap);
			UpdateHeightData();
		}

		public void UpdateHeightData()
		{
			TerrainCollider terrainCollider = collider as TerrainCollider;
			if (!(terrainCollider != null))
			{
				return;
			}
			TerrainData terrainData = terrainCollider.terrainData;
			float[,] heights = terrainData.GetHeights(0, 0, terrainData.heightmapWidth, terrainData.heightmapHeight);
			float[] array = new float[terrainData.heightmapWidth * terrainData.heightmapHeight];
			for (int i = 0; i < terrainData.heightmapHeight; i++)
			{
				for (int j = 0; j < terrainData.heightmapWidth; j++)
				{
					array[i * terrainData.heightmapWidth + j] = heights[i, j];
				}
			}
			Oni.UnpinMemory(dataHandle);
			dataHandle = Oni.PinMemory(array);
			heightmapDataHasChanged = true;
		}

		public override bool UpdateIfNeeded()
		{
			TerrainCollider terrainCollider = collider as TerrainCollider;
			if (terrainCollider != null)
			{
				TerrainData terrainData = terrainCollider.terrainData;
				if (terrainData != null && (terrainData.size != size || terrainData.heightmapWidth != resolutionU || terrainData.heightmapHeight != resolutionV || heightmapDataHasChanged))
				{
					size = terrainData.size;
					resolutionU = terrainData.heightmapWidth;
					resolutionV = terrainData.heightmapHeight;
					heightmapDataHasChanged = false;
					adaptor.Set(size, resolutionU, resolutionV, dataHandle.AddrOfPinnedObject());
					Oni.UpdateShape(oniShape, ref adaptor);
					return true;
				}
			}
			return false;
		}

		public override void Destroy()
		{
			base.Destroy();
			Oni.UnpinMemory(dataHandle);
		}
	}
	[ExecuteInEditMode]
	[RequireComponent(typeof(Collider))]
	public class ObiCollider : ObiColliderBase
	{
		[SerializeProperty("SourceCollider")]
		[SerializeField]
		private Collider sourceCollider;

		[SerializeProperty("UseDistanceFields")]
		[SerializeField]
		private bool useDistanceFields;

		[Indent]
		[VisibleIf("useDistanceFields", false)]
		public ObiDistanceField distanceField;

		public Collider SourceCollider
		{
			get
			{
				return sourceCollider;
			}
			set
			{
				if (value != null && value.gameObject != base.gameObject)
				{
					UnityEngine.Debug.LogError("The Collider component must reside in the same GameObject as ObiCollider.");
					return;
				}
				sourceCollider = value;
				RemoveCollider();
				AddCollider();
			}
		}

		public bool UseDistanceFields
		{
			get
			{
				return useDistanceFields;
			}
			set
			{
				if (useDistanceFields != value)
				{
					useDistanceFields = value;
					CreateTracker();
				}
			}
		}

		protected override void CreateTracker()
		{
			if (useDistanceFields)
			{
				tracker = new ObiDistanceFieldShapeTracker(distanceField);
			}
			else if (sourceCollider is SphereCollider)
			{
				tracker = new ObiSphereShapeTracker((SphereCollider)sourceCollider);
			}
			else if (sourceCollider is BoxCollider)
			{
				tracker = new ObiBoxShapeTracker((BoxCollider)sourceCollider);
			}
			else if (sourceCollider is CapsuleCollider)
			{
				tracker = new ObiCapsuleShapeTracker((CapsuleCollider)sourceCollider);
			}
			else if (sourceCollider is CharacterController)
			{
				tracker = new ObiCapsuleShapeTracker((CharacterController)sourceCollider);
			}
			else if (sourceCollider is TerrainCollider)
			{
				tracker = new ObiTerrainShapeTracker((TerrainCollider)sourceCollider);
			}
			else if (sourceCollider is MeshCollider)
			{
				tracker = new ObiMeshShapeTracker((MeshCollider)sourceCollider);
			}
			else
			{
				UnityEngine.Debug.LogWarning("Collider type not supported by Obi.");
			}
		}

		protected override UnityEngine.Component GetUnityCollider(ref bool enabled)
		{
			if (sourceCollider != null)
			{
				enabled = sourceCollider.enabled;
			}
			return sourceCollider;
		}

		protected override void UpdateAdaptor()
		{
			adaptor.Set(sourceCollider, base.Phase, base.Thickness);
			Oni.UpdateCollider(oniCollider, ref adaptor);
		}

		private void Awake()
		{
			if (SourceCollider == null)
			{
				SourceCollider = GetComponent<Collider>();
			}
			else
			{
				AddCollider();
			}
		}
	}
	[ExecuteInEditMode]
	[RequireComponent(typeof(Collider2D))]
	public class ObiCollider2D : ObiColliderBase
	{
		[SerializeProperty("SourceCollider")]
		[SerializeField]
		private Collider2D sourceCollider;

		public Collider2D SourceCollider
		{
			get
			{
				return sourceCollider;
			}
			set
			{
				if (value.gameObject != base.gameObject)
				{
					UnityEngine.Debug.LogError("The Collider component must reside in the same GameObject as ObiCollider.");
					return;
				}
				sourceCollider = value;
				RemoveCollider();
				AddCollider();
			}
		}

		protected override void CreateTracker()
		{
			if (sourceCollider is CircleCollider2D)
			{
				tracker = new ObiCircleShapeTracker2D((CircleCollider2D)sourceCollider);
			}
			else if (sourceCollider is BoxCollider2D)
			{
				tracker = new ObiBoxShapeTracker2D((BoxCollider2D)sourceCollider);
			}
			else if (sourceCollider is CapsuleCollider2D)
			{
				tracker = new ObiCapsuleShapeTracker2D((CapsuleCollider2D)sourceCollider);
			}
			else if (sourceCollider is EdgeCollider2D)
			{
				tracker = new ObiEdgeShapeTracker2D((EdgeCollider2D)sourceCollider);
			}
			else
			{
				UnityEngine.Debug.LogWarning("Collider2D type not supported by Obi.");
			}
		}

		protected override UnityEngine.Component GetUnityCollider(ref bool enabled)
		{
			if (sourceCollider != null)
			{
				enabled = sourceCollider.enabled;
			}
			return sourceCollider;
		}

		protected override void UpdateAdaptor()
		{
			adaptor.Set(sourceCollider, base.Phase, base.Thickness);
			Oni.UpdateCollider(oniCollider, ref adaptor);
		}

		private void Awake()
		{
			if (SourceCollider == null)
			{
				SourceCollider = GetComponent<Collider2D>();
			}
			else
			{
				AddCollider();
			}
		}
	}
	public abstract class ObiColliderBase : MonoBehaviour
	{
		public static Dictionary<int, UnityEngine.Component> idToCollider = new Dictionary<int, UnityEngine.Component>();

		[SerializeProperty("CollisionMaterial")]
		[SerializeField]
		private ObiCollisionMaterial material;

		[SerializeProperty("Phase")]
		[SerializeField]
		private int phase;

		[SerializeProperty("Thickness")]
		[SerializeField]
		private float thickness;

		protected IntPtr oniCollider = IntPtr.Zero;

		protected ObiRigidbodyBase obiRigidbody;

		protected bool wasUnityColliderEnabled = true;

		protected bool dirty;

		protected ObiShapeTracker tracker;

		protected Oni.Collider adaptor;

		public ObiCollisionMaterial CollisionMaterial
		{
			get
			{
				return material;
			}
			set
			{
				material = value;
				UpdateMaterial();
			}
		}

		public int Phase
		{
			get
			{
				return phase;
			}
			set
			{
				if (phase != value)
				{
					phase = value;
					dirty = true;
				}
			}
		}

		public float Thickness
		{
			get
			{
				return thickness;
			}
			set
			{
				if (thickness != value)
				{
					thickness = value;
					dirty = true;
				}
			}
		}

		public IntPtr OniCollider => oniCollider;

		protected abstract void CreateTracker();

		protected abstract UnityEngine.Component GetUnityCollider(ref bool enabled);

		protected abstract void UpdateAdaptor();

		protected void CreateRigidbody()
		{
			obiRigidbody = null;
			Rigidbody componentInParent = GetComponentInParent<Rigidbody>();
			Rigidbody2D componentInParent2 = GetComponentInParent<Rigidbody2D>();
			if (componentInParent != null)
			{
				obiRigidbody = componentInParent.GetComponent<ObiRigidbody>();
				if (obiRigidbody == null)
				{
					obiRigidbody = componentInParent.gameObject.AddComponent<ObiRigidbody>();
				}
				Oni.SetColliderRigidbody(oniCollider, obiRigidbody.OniRigidbody);
			}
			else if (componentInParent2 != null)
			{
				obiRigidbody = componentInParent2.GetComponent<ObiRigidbody2D>();
				if (obiRigidbody == null)
				{
					obiRigidbody = componentInParent2.gameObject.AddComponent<ObiRigidbody2D>();
				}
				Oni.SetColliderRigidbody(oniCollider, obiRigidbody.OniRigidbody);
			}
			else
			{
				Oni.SetColliderRigidbody(oniCollider, IntPtr.Zero);
			}
		}

		private void UpdateMaterial()
		{
			if (material != null)
			{
				Oni.SetColliderMaterial(oniCollider, material.OniCollisionMaterial);
			}
			else
			{
				Oni.SetColliderMaterial(oniCollider, IntPtr.Zero);
			}
		}

		private void OnTransformParentChanged()
		{
			CreateRigidbody();
		}

		protected void AddCollider()
		{
			UnityEngine.Component unityCollider = GetUnityCollider(ref wasUnityColliderEnabled);
			if (unityCollider != null)
			{
				idToCollider[unityCollider.GetInstanceID()] = unityCollider;
				CreateTracker();
				oniCollider = Oni.CreateCollider();
				if (tracker != null)
				{
					Oni.SetColliderShape(oniCollider, tracker.OniShape);
				}
				UpdateAdaptor();
				UpdateMaterial();
				CreateRigidbody();
				ObiSolver.OnUpdateColliders += UpdateIfNeeded;
				ObiSolver.OnAfterUpdateColliders += ResetTransformChanges;
			}
		}

		protected void RemoveCollider()
		{
			UnityEngine.Component unityCollider = GetUnityCollider(ref wasUnityColliderEnabled);
			if (unityCollider != null)
			{
				idToCollider.Remove(unityCollider.GetInstanceID());
			}
			ObiSolver.OnUpdateColliders -= UpdateIfNeeded;
			ObiSolver.OnAfterUpdateColliders -= ResetTransformChanges;
			Oni.RemoveCollider(oniCollider);
			Oni.DestroyCollider(oniCollider);
			oniCollider = IntPtr.Zero;
			if (tracker != null)
			{
				tracker.Destroy();
				tracker = null;
			}
		}

		private void UpdateIfNeeded(object sender, EventArgs e)
		{
			bool flag = false;
			if (GetUnityCollider(ref flag) != null)
			{
				if ((tracker != null && tracker.UpdateIfNeeded()) || base.transform.hasChanged || dirty || flag != wasUnityColliderEnabled)
				{
					dirty = false;
					wasUnityColliderEnabled = flag;
					Oni.RemoveCollider(oniCollider);
					UpdateAdaptor();
					if (flag)
					{
						Oni.AddCollider(oniCollider);
					}
				}
			}
			else if (oniCollider != IntPtr.Zero)
			{
				RemoveCollider();
			}
		}

		private void ResetTransformChanges(object sender, EventArgs e)
		{
			base.transform.hasChanged = false;
		}

		private void OnDestroy()
		{
			RemoveCollider();
		}

		private void OnEnable()
		{
			Oni.AddCollider(oniCollider);
		}

		private void OnDisable()
		{
			Oni.RemoveCollider(oniCollider);
		}
	}
	public class ObiCollisionMaterial : ScriptableObject
	{
		private IntPtr oniCollisionMaterial = IntPtr.Zero;

		private Oni.CollisionMaterial adaptor;

		public float friction;

		public float stickiness;

		public float stickDistance;

		public Oni.MaterialCombineMode frictionCombine;

		public Oni.MaterialCombineMode stickinessCombine;

		public IntPtr OniCollisionMaterial => oniCollisionMaterial;

		public void OnEnable()
		{
			OnValidate();
		}

		public void OnDisable()
		{
			oniCollisionMaterial = IntPtr.Zero;
		}

		public void OnValidate()
		{
			adaptor.friction = friction;
			adaptor.stickiness = stickiness;
			adaptor.stickDistance = stickDistance;
			adaptor.frictionCombine = frictionCombine;
			adaptor.stickinessCombine = stickinessCombine;
			Oni.UpdateCollisionMaterial(oniCollisionMaterial, ref adaptor);
		}
	}
	[ExecuteInEditMode]
	public class ObiDistanceField : ScriptableObject
	{
		[SerializeProperty("InputMesh")]
		[SerializeField]
		private Mesh input;

		[HideInInspector]
		[SerializeField]
		private float minNodeSize;

		[HideInInspector]
		[SerializeField]
		private Bounds bounds;

		[HideInInspector]
		public Oni.DFNode[] nodes;

		[Range(1E-05f, 0.1f)]
		public float maxError = 0.01f;

		[Range(1f, 8f)]
		public int maxDepth = 5;

		private IntPtr oniDistanceField;

		public bool Initialized => nodes != null;

		public IntPtr OniDistanceField => oniDistanceField;

		public Bounds FieldBounds => bounds;

		public float EffectiveSampleSize => minNodeSize;

		public Mesh InputMesh
		{
			get
			{
				return input;
			}
			set
			{
				if (value != input)
				{
					Reset();
					input = value;
				}
			}
		}

		public void OnEnable()
		{
			oniDistanceField = Oni.CreateDistanceField();
			if (nodes != null)
			{
				Oni.SetDistanceFieldNodes(oniDistanceField, nodes, nodes.Length);
			}
		}

		public void OnDisable()
		{
			Oni.DestroyDistanceField(oniDistanceField);
		}

		public void Reset()
		{
			nodes = null;
			if (input != null)
			{
				bounds = input.bounds;
			}
		}

		public IEnumerator Generate()
		{
			Reset();
			if (input == null)
			{
				yield break;
			}
			int[] triangles = input.triangles;
			Vector3[] vertices = input.vertices;
			Oni.StartBuildingDistanceField(oniDistanceField, maxError, maxDepth, vertices, triangles, vertices.Length, triangles.Length / 3);
			int i = 0;
			bool done = false;
			while (!done)
			{
				for (int j = 0; j < 16; j++)
				{
					done |= Oni.ContinueBuildingDistanceField(oniDistanceField);
				}
				i += 16;
				yield return new CoroutineJob.ProgressInfo("Processed nodes: " + i, 1f);
			}
			int distanceFieldNodeCount = Oni.GetDistanceFieldNodeCount(oniDistanceField);
			nodes = new Oni.DFNode[distanceFieldNodeCount];
			Oni.GetDistanceFieldNodes(oniDistanceField, nodes);
			minNodeSize = float.PositiveInfinity;
			for (int k = 0; k < nodes.Length; k++)
			{
				minNodeSize = Mathf.Min(minNodeSize, nodes[k].center[3] * 2f);
			}
			float num = Mathf.Max(bounds.size[0], Mathf.Max(bounds.size[1], bounds.size[2])) + 0.2f;
			bounds.size = new Vector3(num, num, num);
		}

		public Texture3D GetVolumeTexture(int size)
		{
			if (!Initialized)
			{
				return null;
			}
			float num = Mathf.Max(bounds.size.x, bounds.size.y, bounds.size.z);
			float num2 = bounds.size.x / (float)size;
			float num3 = bounds.size.y / (float)size;
			float num4 = bounds.size.z / (float)size;
			Texture3D texture3D = new Texture3D(size, size, size, TextureFormat.Alpha8, mipChain: false);
			Color[] array = new Color[size * size * size];
			int num5 = 0;
			Color black = Color.black;
			for (int i = 0; i < size; i++)
			{
				for (int j = 0; j < size; j++)
				{
					int num6 = 0;
					while (num6 < size)
					{
						Vector3 vector = bounds.min + new Vector3(num2 * (float)num6 + num2 * 0.5f, num3 * (float)j + num3 * 0.5f, num4 * (float)i + num4 * 0.5f);
						float num7 = Oni.SampleDistanceField(oniDistanceField, vector.x, vector.y, vector.z);
						if (num7 >= 0f)
						{
							black.a = num7.Remap(0f, num * 0.1f, 0.5f, 1f);
						}
						else
						{
							black.a = num7.Remap((0f - num) * 0.1f, 0f, 0f, 0.5f);
						}
						array[num5] = black;
						num6++;
						num5++;
					}
				}
			}
			texture3D.SetPixels(array);
			texture3D.Apply();
			return texture3D;
		}
	}
	[ExecuteInEditMode]
	[RequireComponent(typeof(Rigidbody))]
	public class ObiRigidbody : ObiRigidbodyBase
	{
		private Rigidbody unityRigidbody;

		public override void Awake()
		{
			unityRigidbody = GetComponent<Rigidbody>();
			base.Awake();
		}

		public override void UpdateIfNeeded(object sender, EventArgs e)
		{
			velocity = unityRigidbody.velocity;
			angularVelocity = unityRigidbody.angularVelocity;
			adaptor.Set(unityRigidbody, kinematicForParticles);
			Oni.UpdateRigidbody(oniRigidbody, ref adaptor);
		}

		public override void UpdateVelocities(object sender, EventArgs e)
		{
			if (UnityEngine.Application.isPlaying && (unityRigidbody.isKinematic || !kinematicForParticles))
			{
				Oni.GetRigidbodyVelocity(oniRigidbody, ref oniVelocities);
				unityRigidbody.velocity += oniVelocities.linearVelocity - velocity;
				unityRigidbody.angularVelocity += oniVelocities.angularVelocity - angularVelocity;
			}
		}
	}
	[ExecuteInEditMode]
	[RequireComponent(typeof(Rigidbody2D))]
	public class ObiRigidbody2D : ObiRigidbodyBase
	{
		private Rigidbody2D unityRigidbody;

		public override void Awake()
		{
			unityRigidbody = GetComponent<Rigidbody2D>();
			base.Awake();
		}

		public override void UpdateIfNeeded(object sender, EventArgs e)
		{
			velocity = new Vector3(unityRigidbody.velocity.x, unityRigidbody.velocity.y, 0f);
			angularVelocity = new Vector3(0f, 0f, unityRigidbody.angularVelocity * ((float)Math.PI / 180f));
			adaptor.Set(unityRigidbody, kinematicForParticles);
			Oni.UpdateRigidbody(oniRigidbody, ref adaptor);
		}

		public override void UpdateVelocities(object sender, EventArgs e)
		{
			if (UnityEngine.Application.isPlaying && (unityRigidbody.isKinematic || !kinematicForParticles))
			{
				Oni.GetRigidbodyVelocity(oniRigidbody, ref oniVelocities);
				Vector3 vector = oniVelocities.linearVelocity - velocity;
				unityRigidbody.velocity += new Vector2(vector.x, vector.y);
				unityRigidbody.angularVelocity += (oniVelocities.angularVelocity[2] - angularVelocity[2]) * 57.29578f;
			}
		}
	}
	[ExecuteInEditMode]
	public abstract class ObiRigidbodyBase : MonoBehaviour
	{
		public bool kinematicForParticles;

		protected IntPtr oniRigidbody = IntPtr.Zero;

		protected Oni.Rigidbody adaptor;

		protected Oni.RigidbodyVelocities oniVelocities;

		protected Vector3 velocity;

		protected Vector3 angularVelocity;

		public IntPtr OniRigidbody => oniRigidbody;

		public virtual void Awake()
		{
			oniRigidbody = Oni.CreateRigidbody();
			UpdateIfNeeded(this, null);
			ObiSolver.OnUpdateColliders += UpdateIfNeeded;
			ObiSolver.OnUpdateRigidbodies += UpdateVelocities;
		}

		public void OnDestroy()
		{
			ObiSolver.OnUpdateColliders -= UpdateIfNeeded;
			ObiSolver.OnUpdateRigidbodies -= UpdateVelocities;
			Oni.DestroyRigidbody(oniRigidbody);
			oniRigidbody = IntPtr.Zero;
		}

		public abstract void UpdateIfNeeded(object sender, EventArgs e);

		public abstract void UpdateVelocities(object sender, EventArgs e);
	}
	[Serializable]
	public class ObiAerodynamicConstraintBatch : ObiConstraintBatch
	{
		[HideInInspector]
		public List<int> aerodynamicIndices = new List<int>();

		[HideInInspector]
		public List<float> aerodynamicCoeffs = new List<float>();

		private int[] solverIndices = new int[0];

		public ObiAerodynamicConstraintBatch(bool cooked, bool sharesParticles)
			: base(cooked, sharesParticles)
		{
		}

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.Aerodynamics;
		}

		public override void Clear()
		{
			activeConstraints.Clear();
			aerodynamicIndices.Clear();
			aerodynamicCoeffs.Clear();
			constraintCount = 0;
		}

		public void AddConstraint(int index, float area, float drag, float lift)
		{
			activeConstraints.Add(constraintCount);
			aerodynamicIndices.Add(index);
			aerodynamicCoeffs.Add(area);
			aerodynamicCoeffs.Add(drag);
			aerodynamicCoeffs.Add(lift);
			constraintCount++;
		}

		public void RemoveConstraint(int index)
		{
			if (index < 0 || index >= base.ConstraintCount)
			{
				return;
			}
			activeConstraints.Remove(index);
			for (int i = 0; i < activeConstraints.Count; i++)
			{
				if (activeConstraints[i] > index)
				{
					activeConstraints[i]--;
				}
			}
			aerodynamicIndices.RemoveAt(index);
			aerodynamicCoeffs.RemoveRange(index * 3, 3);
			constraintCount--;
		}

		public override List<int> GetConstraintsInvolvingParticle(int particleIndex)
		{
			List<int> list = new List<int>(1);
			for (int i = 0; i < base.ConstraintCount; i++)
			{
				if (aerodynamicIndices[i] == particleIndex)
				{
					list.Add(i);
				}
			}
			return list;
		}

		protected override void OnAddToSolver(ObiBatchedConstraints constraints)
		{
			solverIndices = new int[aerodynamicIndices.Count];
			for (int i = 0; i < aerodynamicIndices.Count; i++)
			{
				solverIndices[i] = constraints.Actor.particleIndices[aerodynamicIndices[i]];
			}
		}

		protected override void OnRemoveFromSolver(ObiBatchedConstraints constraints)
		{
		}

		public override void PushDataToSolver(ObiBatchedConstraints constraints)
		{
			if (!(constraints == null) && !(constraints.Actor == null) && constraints.Actor.InSolver)
			{
				ObiAerodynamicConstraints obiAerodynamicConstraints = (ObiAerodynamicConstraints)constraints;
				for (int i = 0; i < aerodynamicCoeffs.Count; i += 3)
				{
					aerodynamicCoeffs[i + 1] = obiAerodynamicConstraints.dragCoefficient * obiAerodynamicConstraints.airDensity;
					aerodynamicCoeffs[i + 2] = obiAerodynamicConstraints.liftCoefficient * obiAerodynamicConstraints.airDensity;
				}
				Oni.SetAerodynamicConstraints(batch, solverIndices, aerodynamicCoeffs.ToArray(), base.ConstraintCount);
			}
		}

		public override void PullDataFromSolver(ObiBatchedConstraints constraints)
		{
		}
	}
	[Serializable]
	public class ObiBendConstraintBatch : ObiConstraintBatch
	{
		public enum BendIndexType
		{
			First,
			Second,
			Pivot
		}

		[HideInInspector]
		public List<int> bendingIndices = new List<int>();

		[HideInInspector]
		public List<float> restBends = new List<float>();

		[HideInInspector]
		public List<Vector2> bendingStiffnesses = new List<Vector2>();

		private int[] solverIndices = new int[0];

		public ObiBendConstraintBatch(bool cooked, bool sharesParticles)
			: base(cooked, sharesParticles)
		{
		}

		public ObiBendConstraintBatch(bool cooked, bool sharesParticles, float minYoungModulus, float maxYoungModulus)
			: base(cooked, sharesParticles, minYoungModulus, maxYoungModulus)
		{
		}

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.Bending;
		}

		public override void Clear()
		{
			activeConstraints.Clear();
			bendingIndices.Clear();
			restBends.Clear();
			bendingStiffnesses.Clear();
			constraintCount = 0;
		}

		public void AddConstraint(int index1, int index2, int index3, float restBend, float bending, float stiffness)
		{
			activeConstraints.Add(constraintCount);
			bendingIndices.Add(index1);
			bendingIndices.Add(index2);
			bendingIndices.Add(index3);
			restBends.Add(restBend);
			bendingStiffnesses.Add(new Vector2(bending, stiffness));
			constraintCount++;
		}

		public void InsertConstraint(int constraintIndex, int index1, int index2, int index3, float restBend, float bending, float stiffness)
		{
			if (constraintIndex < 0 || constraintIndex > base.ConstraintCount)
			{
				return;
			}
			for (int i = 0; i < activeConstraints.Count; i++)
			{
				if (activeConstraints[i] >= constraintIndex)
				{
					activeConstraints[i]++;
				}
			}
			activeConstraints.Add(constraintIndex);
			bendingIndices.Insert(constraintIndex * 3, index1);
			bendingIndices.Insert(constraintIndex * 3 + 1, index2);
			bendingIndices.Insert(constraintIndex * 3 + 2, index3);
			restBends.Insert(constraintIndex, restBend);
			bendingStiffnesses.Insert(constraintIndex, new Vector2(bending, stiffness));
			constraintCount++;
		}

		public void SetParticleIndex(int constraintIndex, int particleIndex, BendIndexType type, bool wraparound)
		{
			if (!wraparound)
			{
				if (constraintIndex >= 0 && constraintIndex < base.ConstraintCount)
				{
					bendingIndices[(int)(constraintIndex * 3 + type)] = particleIndex;
				}
			}
			else
			{
				bendingIndices[(int)((int)ObiUtils.Mod(constraintIndex, base.ConstraintCount) * 3 + type)] = particleIndex;
			}
		}

		public void RemoveConstraint(int index)
		{
			if (index < 0 || index >= base.ConstraintCount)
			{
				return;
			}
			activeConstraints.Remove(index);
			for (int i = 0; i < activeConstraints.Count; i++)
			{
				if (activeConstraints[i] > index)
				{
					activeConstraints[i]--;
				}
			}
			bendingIndices.RemoveRange(index * 3, 3);
			restBends.RemoveAt(index);
			bendingStiffnesses.RemoveAt(index);
			constraintCount--;
		}

		public override List<int> GetConstraintsInvolvingParticle(int particleIndex)
		{
			List<int> list = new List<int>(5);
			for (int i = 0; i < base.ConstraintCount; i++)
			{
				if (bendingIndices[i * 3] == particleIndex || bendingIndices[i * 3 + 1] == particleIndex || bendingIndices[i * 3 + 2] == particleIndex)
				{
					list.Add(i);
				}
			}
			return list;
		}

		public override void Cook()
		{
			batch = Oni.CreateBatch(2, cooked: true);
			Oni.SetBendingConstraints(batch, bendingIndices.ToArray(), restBends.ToArray(), bendingStiffnesses.ToArray(), base.ConstraintCount);
			if (Oni.CookBatch(batch))
			{
				constraintCount = Oni.GetBatchConstraintCount(batch);
				activeConstraints = Enumerable.Range(0, constraintCount).ToList();
				int[] array = new int[constraintCount * 3];
				float[] collection = new float[constraintCount];
				Vector2[] collection2 = new Vector2[constraintCount];
				Oni.GetBendingConstraints(batch, array, collection, collection2);
				bendingIndices = new List<int>(array);
				restBends = new List<float>(collection);
				bendingStiffnesses = new List<Vector2>(collection2);
				int[] collection3 = new int[Oni.GetBatchPhaseCount(batch)];
				Oni.GetBatchPhaseSizes(batch, collection3);
				phaseSizes = new List<int>(collection3);
			}
			Oni.DestroyBatch(batch);
			batch = IntPtr.Zero;
		}

		protected override void OnAddToSolver(ObiBatchedConstraints constraints)
		{
			solverIndices = new int[bendingIndices.Count];
			for (int i = 0; i < restBends.Count; i++)
			{
				solverIndices[i * 3] = constraints.Actor.particleIndices[bendingIndices[i * 3]];
				solverIndices[i * 3 + 1] = constraints.Actor.particleIndices[bendingIndices[i * 3 + 1]];
				solverIndices[i * 3 + 2] = constraints.Actor.particleIndices[bendingIndices[i * 3 + 2]];
			}
		}

		protected override void OnRemoveFromSolver(ObiBatchedConstraints constraints)
		{
		}

		public override void PushDataToSolver(ObiBatchedConstraints constraints)
		{
			if (!(constraints == null) && !(constraints.Actor == null) && constraints.Actor.InSolver)
			{
				ObiBendingConstraints obiBendingConstraints = (ObiBendingConstraints)constraints;
				for (int i = 0; i < bendingStiffnesses.Count; i++)
				{
					bendingStiffnesses[i] = new Vector2(obiBendingConstraints.maxBending, StiffnessToCompliance(obiBendingConstraints.stiffness));
				}
				Oni.SetBendingConstraints(batch, solverIndices, restBends.ToArray(), bendingStiffnesses.ToArray(), base.ConstraintCount);
				Oni.SetBatchPhaseSizes(batch, phaseSizes.ToArray(), phaseSizes.Count);
			}
		}

		public override void PullDataFromSolver(ObiBatchedConstraints constraints)
		{
		}
	}
	[Serializable]
	public abstract class ObiConstraintBatch
	{
		protected IntPtr batch;

		public float maxYoungModulus = 0.02f;

		public float minYoungModulus = 0.0001f;

		[SerializeField]
		[HideInInspector]
		protected int constraintCount;

		[SerializeField]
		[HideInInspector]
		protected bool cooked;

		[SerializeField]
		[HideInInspector]
		protected bool sharesParticles;

		[SerializeField]
		[HideInInspector]
		protected List<int> activeConstraints = new List<int>();

		[SerializeField]
		[HideInInspector]
		protected List<int> phaseSizes = new List<int>();

		public IntPtr OniBatch => batch;

		public int ConstraintCount => constraintCount;

		public bool IsCooked => cooked;

		public bool SharesParticles => sharesParticles;

		public IEnumerable<int> ActiveConstraints => activeConstraints.AsReadOnly();

		public abstract Oni.ConstraintType GetConstraintType();

		public abstract void Clear();

		public virtual void Cook()
		{
		}

		protected abstract void OnAddToSolver(ObiBatchedConstraints constraints);

		protected abstract void OnRemoveFromSolver(ObiBatchedConstraints constraints);

		public abstract void PushDataToSolver(ObiBatchedConstraints constraints);

		public abstract void PullDataFromSolver(ObiBatchedConstraints constraints);

		public abstract List<int> GetConstraintsInvolvingParticle(int particleIndex);

		protected float StiffnessToCompliance(float stiffness)
		{
			float a = 1f / Mathf.Max(minYoungModulus, 1E-05f);
			float b = 1f / Mathf.Max(maxYoungModulus, minYoungModulus);
			return Mathf.Lerp(a, b, stiffness);
		}

		public void ActivateConstraint(int index)
		{
			if (!activeConstraints.Contains(index))
			{
				activeConstraints.Add(index);
			}
		}

		public void DeactivateConstraint(int index)
		{
			activeConstraints.Remove(index);
		}

		public ObiConstraintBatch(bool cooked, bool sharesParticles)
		{
			this.cooked = cooked;
			this.sharesParticles = sharesParticles;
		}

		public ObiConstraintBatch(bool cooked, bool sharesParticles, float minYoungModulus, float maxYoungModulus)
		{
			this.cooked = cooked;
			this.sharesParticles = sharesParticles;
			this.maxYoungModulus = maxYoungModulus;
			this.minYoungModulus = minYoungModulus;
		}

		public void AddToSolver(ObiBatchedConstraints constraints)
		{
			batch = Oni.CreateBatch((int)GetConstraintType(), cooked);
			Oni.AddBatch(constraints.Actor.Solver.OniSolver, batch, sharesParticles);
			OnAddToSolver(constraints);
		}

		public void RemoveFromSolver(ObiBatchedConstraints constraints)
		{
			OnRemoveFromSolver(constraints);
			Oni.RemoveBatch(constraints.Actor.Solver.OniSolver, batch);
			batch = IntPtr.Zero;
		}

		public void SetActiveConstraints()
		{
			Oni.SetActiveConstraints(batch, activeConstraints.ToArray(), activeConstraints.Count);
		}

		public void Enable()
		{
			Oni.EnableBatch(batch, enabled: true);
		}

		public void Disable()
		{
			Oni.EnableBatch(batch, enabled: false);
		}
	}
	[Serializable]
	public class ObiDistanceConstraintBatch : ObiConstraintBatch
	{
		public enum DistanceIndexType
		{
			First,
			Second
		}

		[HideInInspector]
		public List<int> springIndices = new List<int>();

		[HideInInspector]
		public List<float> restLengths = new List<float>();

		[HideInInspector]
		public List<Vector2> stiffnesses = new List<Vector2>();

		private int[] solverIndices = new int[0];

		public ObiDistanceConstraintBatch(bool cooked, bool sharesParticles)
			: base(cooked, sharesParticles)
		{
		}

		public ObiDistanceConstraintBatch(bool cooked, bool sharesParticles, float minYoungModulus, float maxYoungModulus)
			: base(cooked, sharesParticles, minYoungModulus, maxYoungModulus)
		{
		}

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.Distance;
		}

		public override void Clear()
		{
			activeConstraints.Clear();
			springIndices.Clear();
			restLengths.Clear();
			stiffnesses.Clear();
			constraintCount = 0;
		}

		public void AddConstraint(int index1, int index2, float restLength, float stretchStiffness, float compressionStiffness)
		{
			activeConstraints.Add(constraintCount);
			springIndices.Add(index1);
			springIndices.Add(index2);
			restLengths.Add(restLength);
			stiffnesses.Add(new Vector2(stretchStiffness, compressionStiffness));
			constraintCount++;
		}

		public void InsertConstraint(int constraintIndex, int index1, int index2, float restLength, float stretchStiffness, float compressionStiffness)
		{
			if (constraintIndex < 0 || constraintIndex > base.ConstraintCount)
			{
				return;
			}
			for (int i = 0; i < activeConstraints.Count; i++)
			{
				if (activeConstraints[i] >= constraintIndex)
				{
					activeConstraints[i]++;
				}
			}
			activeConstraints.Add(constraintIndex);
			springIndices.Insert(constraintIndex * 2, index1);
			springIndices.Insert(constraintIndex * 2 + 1, index2);
			restLengths.Insert(constraintIndex, restLength);
			stiffnesses.Insert(constraintIndex, new Vector2(stretchStiffness, compressionStiffness));
			constraintCount++;
		}

		public void SetParticleIndex(int constraintIndex, int particleIndex, DistanceIndexType type, bool wraparound)
		{
			if (!wraparound)
			{
				if (constraintIndex >= 0 && constraintIndex < base.ConstraintCount)
				{
					springIndices[(int)(constraintIndex * 2 + type)] = particleIndex;
				}
			}
			else
			{
				springIndices[(int)((int)ObiUtils.Mod(constraintIndex, base.ConstraintCount) * 2 + type)] = particleIndex;
			}
		}

		public void RemoveConstraint(int index)
		{
			if (index < 0 || index >= base.ConstraintCount)
			{
				return;
			}
			activeConstraints.Remove(index);
			for (int i = 0; i < activeConstraints.Count; i++)
			{
				if (activeConstraints[i] > index)
				{
					activeConstraints[i]--;
				}
			}
			springIndices.RemoveRange(index * 2, 2);
			restLengths.RemoveAt(index);
			stiffnesses.RemoveAt(index);
			constraintCount--;
		}

		public override List<int> GetConstraintsInvolvingParticle(int particleIndex)
		{
			List<int> list = new List<int>(10);
			for (int i = 0; i < base.ConstraintCount; i++)
			{
				if (springIndices[i * 2] == particleIndex || springIndices[i * 2 + 1] == particleIndex)
				{
					list.Add(i);
				}
			}
			return list;
		}

		public override void Cook()
		{
			batch = Oni.CreateBatch(3, cooked: true);
			Oni.SetDistanceConstraints(batch, springIndices.ToArray(), restLengths.ToArray(), stiffnesses.ToArray(), base.ConstraintCount);
			if (Oni.CookBatch(batch))
			{
				constraintCount = Oni.GetBatchConstraintCount(batch);
				activeConstraints = Enumerable.Range(0, constraintCount).ToList();
				int[] array = new int[constraintCount * 2];
				float[] collection = new float[constraintCount];
				Vector2[] collection2 = new Vector2[constraintCount];
				Oni.GetDistanceConstraints(batch, array, collection, collection2);
				springIndices = new List<int>(array);
				restLengths = new List<float>(collection);
				stiffnesses = new List<Vector2>(collection2);
				int[] collection3 = new int[Oni.GetBatchPhaseCount(batch)];
				Oni.GetBatchPhaseSizes(batch, collection3);
				phaseSizes = new List<int>(collection3);
			}
			Oni.DestroyBatch(batch);
			batch = IntPtr.Zero;
		}

		protected override void OnAddToSolver(ObiBatchedConstraints constraints)
		{
			solverIndices = new int[springIndices.Count];
			for (int i = 0; i < restLengths.Count; i++)
			{
				solverIndices[i * 2] = constraints.Actor.particleIndices[springIndices[i * 2]];
				solverIndices[i * 2 + 1] = constraints.Actor.particleIndices[springIndices[i * 2 + 1]];
			}
		}

		protected override void OnRemoveFromSolver(ObiBatchedConstraints constraints)
		{
		}

		public override void PushDataToSolver(ObiBatchedConstraints constraints)
		{
			if (!(constraints == null) && !(constraints.Actor == null) && constraints.Actor.InSolver)
			{
				ObiDistanceConstraints obiDistanceConstraints = (ObiDistanceConstraints)constraints;
				float[] array = new float[restLengths.Count];
				for (int i = 0; i < restLengths.Count; i++)
				{
					array[i] = restLengths[i] * obiDistanceConstraints.stretchingScale;
					stiffnesses[i] = new Vector2(StiffnessToCompliance(obiDistanceConstraints.stiffness), obiDistanceConstraints.slack * array[i]);
				}
				Oni.SetDistanceConstraints(batch, solverIndices, array, stiffnesses.ToArray(), base.ConstraintCount);
				Oni.SetBatchPhaseSizes(batch, phaseSizes.ToArray(), phaseSizes.Count);
			}
		}

		public override void PullDataFromSolver(ObiBatchedConstraints constraints)
		{
		}
	}
	[Serializable]
	public class ObiPinConstraintBatch : ObiConstraintBatch
	{
		[HideInInspector]
		public List<int> pinIndices = new List<int>();

		[HideInInspector]
		public List<ObiColliderBase> pinBodies = new List<ObiColliderBase>();

		[HideInInspector]
		public List<Vector4> pinOffsets = new List<Vector4>();

		[HideInInspector]
		public List<float> stiffnesses = new List<float>();

		[HideInInspector]
		public List<float> pinBreakResistance = new List<float>();

		private int[] solverIndices = new int[0];

		private IntPtr[] solverColliders = new IntPtr[0];

		private float[] constraintForces;

		public ObiPinConstraintBatch(bool cooked, bool sharesParticles)
			: base(cooked, sharesParticles)
		{
		}

		public ObiPinConstraintBatch(bool cooked, bool sharesParticles, float minYoungModulus, float maxYoungModulus)
			: base(cooked, sharesParticles, minYoungModulus, maxYoungModulus)
		{
		}

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.Pin;
		}

		public override void Clear()
		{
			activeConstraints.Clear();
			pinIndices.Clear();
			pinBodies.Clear();
			pinOffsets.Clear();
			stiffnesses.Clear();
			pinBreakResistance.Clear();
			constraintCount = 0;
		}

		public void AddConstraint(int index1, ObiColliderBase body, Vector3 offset, float stiffness)
		{
			activeConstraints.Add(constraintCount);
			pinIndices.Add(index1);
			pinBodies.Add(body);
			pinOffsets.Add(offset);
			stiffnesses.Add(stiffness);
			pinBreakResistance.Add(float.MaxValue);
			constraintCount++;
		}

		public void RemoveConstraint(int index)
		{
			if (index < 0 || index >= base.ConstraintCount)
			{
				return;
			}
			activeConstraints.Remove(index);
			for (int i = 0; i < activeConstraints.Count; i++)
			{
				if (activeConstraints[i] > index)
				{
					activeConstraints[i]--;
				}
			}
			pinIndices.RemoveAt(index);
			pinBodies.RemoveAt(index);
			pinOffsets.RemoveAt(index);
			stiffnesses.RemoveAt(index);
			pinBreakResistance.RemoveAt(index);
			constraintCount--;
		}

		public override List<int> GetConstraintsInvolvingParticle(int particleIndex)
		{
			List<int> list = new List<int>(5);
			for (int i = 0; i < base.ConstraintCount; i++)
			{
				if (pinIndices[i] == particleIndex)
				{
					list.Add(i);
				}
			}
			return list;
		}

		protected override void OnAddToSolver(ObiBatchedConstraints constraints)
		{
			solverIndices = new int[pinIndices.Count];
			solverColliders = new IntPtr[pinIndices.Count];
			for (int i = 0; i < pinOffsets.Count; i++)
			{
				solverIndices[i] = constraints.Actor.particleIndices[pinIndices[i]];
				solverColliders[i] = ((pinBodies[i] != null) ? pinBodies[i].OniCollider : IntPtr.Zero);
			}
		}

		protected override void OnRemoveFromSolver(ObiBatchedConstraints constraints)
		{
		}

		public override void PushDataToSolver(ObiBatchedConstraints constraints)
		{
			if (!(constraints == null) && !(constraints.Actor == null) && constraints.Actor.InSolver)
			{
				ObiPinConstraints obiPinConstraints = (ObiPinConstraints)constraints;
				for (int i = 0; i < stiffnesses.Count; i++)
				{
					stiffnesses[i] = StiffnessToCompliance(obiPinConstraints.stiffness);
				}
				Oni.SetPinConstraints(batch, solverIndices, pinOffsets.ToArray(), solverColliders, stiffnesses.ToArray(), base.ConstraintCount);
			}
		}

		public override void PullDataFromSolver(ObiBatchedConstraints constraints)
		{
		}

		public void BreakConstraints()
		{
			if (constraintForces == null || constraintForces.Length != base.ConstraintCount)
			{
				constraintForces = new float[base.ConstraintCount];
			}
			Oni.GetBatchConstraintForces(batch, constraintForces, base.ConstraintCount, 0);
			bool flag = false;
			for (int i = 0; i < constraintForces.Length; i++)
			{
				if ((0f - constraintForces[i]) * 1000f > pinBreakResistance[i])
				{
					activeConstraints.Remove(i);
					flag = true;
				}
			}
			if (flag)
			{
				SetActiveConstraints();
			}
		}
	}
	[Serializable]
	public class ObiShapeMatchingConstraintBatch : ObiConstraintBatch
	{
		[HideInInspector]
		public List<int> shapeIndices = new List<int>();

		[HideInInspector]
		public List<int> firstIndex = new List<int>();

		[HideInInspector]
		public List<int> numIndices = new List<int>();

		[HideInInspector]
		public List<float> shapeStiffness = new List<float>();

		private int[] solverIndices;

		public ObiShapeMatchingConstraintBatch(bool cooked, bool sharesParticles)
			: base(cooked, sharesParticles)
		{
		}

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.ShapeMatching;
		}

		public override void Clear()
		{
			activeConstraints.Clear();
			shapeIndices.Clear();
			firstIndex.Clear();
			numIndices.Clear();
			shapeStiffness.Clear();
			constraintCount = 0;
		}

		public void AddConstraint(int[] particleIndices, float stiffness)
		{
			activeConstraints.Add(constraintCount);
			firstIndex.Add(shapeIndices.Count);
			numIndices.Add(particleIndices.Length);
			shapeIndices.AddRange(particleIndices);
			shapeStiffness.Add(stiffness);
			constraintCount++;
		}

		public void RemoveConstraint(int index)
		{
			if (index < 0 || index >= base.ConstraintCount)
			{
				return;
			}
			activeConstraints.Remove(index);
			for (int i = 0; i < activeConstraints.Count; i++)
			{
				if (activeConstraints[i] > index)
				{
					activeConstraints[i]--;
				}
			}
			shapeIndices.RemoveRange(firstIndex[index], numIndices[index]);
			firstIndex.RemoveAt(index);
			numIndices.RemoveAt(index);
			shapeStiffness.RemoveAt(index);
			constraintCount--;
		}

		public override List<int> GetConstraintsInvolvingParticle(int particleIndex)
		{
			List<int> list = new List<int>(4);
			for (int i = 0; i < base.ConstraintCount; i++)
			{
				for (int j = 0; j < numIndices[i]; j++)
				{
					if (shapeIndices[firstIndex[i] + j] == particleIndex)
					{
						list.Add(i);
					}
				}
			}
			return list;
		}

		protected override void OnAddToSolver(ObiBatchedConstraints constraints)
		{
			solverIndices = new int[shapeIndices.Count];
			for (int i = 0; i < shapeIndices.Count; i++)
			{
				solverIndices[i] = constraints.Actor.particleIndices[shapeIndices[i]];
			}
		}

		protected override void OnRemoveFromSolver(ObiBatchedConstraints constraints)
		{
		}

		public override void PushDataToSolver(ObiBatchedConstraints constraints)
		{
			if (!(constraints == null) && !(constraints.Actor == null) && constraints.Actor.InSolver)
			{
				for (int i = 0; i < shapeStiffness.Count; i++)
				{
					shapeStiffness[i] = 1f;
				}
				Oni.SetShapeMatchingConstraints(batch, solverIndices, firstIndex.ToArray(), numIndices.ToArray(), shapeStiffness.ToArray(), base.ConstraintCount);
				Oni.CalculateRestShapeMatching(constraints.Actor.Solver.OniSolver, batch);
			}
		}

		public override void PullDataFromSolver(ObiBatchedConstraints constraints)
		{
		}
	}
	[Serializable]
	public class ObiSkinConstraintBatch : ObiConstraintBatch
	{
		[HideInInspector]
		public List<int> skinIndices = new List<int>();

		[HideInInspector]
		public List<Vector4> skinPoints = new List<Vector4>();

		[HideInInspector]
		public List<Vector4> skinNormals = new List<Vector4>();

		[HideInInspector]
		public List<float> skinRadiiBackstop = new List<float>();

		[HideInInspector]
		public List<float> skinStiffnesses = new List<float>();

		private int[] solverIndices = new int[0];

		public ObiSkinConstraintBatch(bool cooked, bool sharesParticles)
			: base(cooked, sharesParticles)
		{
		}

		public ObiSkinConstraintBatch(bool cooked, bool sharesParticles, float minYoungModulus, float maxYoungModulus)
			: base(cooked, sharesParticles, minYoungModulus, maxYoungModulus)
		{
		}

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.Skin;
		}

		public override void Clear()
		{
			activeConstraints.Clear();
			skinIndices.Clear();
			skinPoints.Clear();
			skinNormals.Clear();
			skinRadiiBackstop.Clear();
			skinStiffnesses.Clear();
			constraintCount = 0;
		}

		public void AddConstraint(int index, Vector4 point, Vector4 normal, float radius, float collisionRadius, float backstop, float stiffness)
		{
			activeConstraints.Add(constraintCount);
			skinIndices.Add(index);
			skinPoints.Add(point);
			skinNormals.Add(normal);
			skinRadiiBackstop.Add(radius);
			skinRadiiBackstop.Add(collisionRadius);
			skinRadiiBackstop.Add(backstop);
			skinStiffnesses.Add(stiffness);
			constraintCount++;
		}

		public void RemoveConstraint(int index)
		{
			if (index < 0 || index >= base.ConstraintCount)
			{
				return;
			}
			activeConstraints.Remove(index);
			for (int i = 0; i < activeConstraints.Count; i++)
			{
				if (activeConstraints[i] > index)
				{
					activeConstraints[i]--;
				}
			}
			skinIndices.RemoveAt(index);
			skinPoints.RemoveAt(index);
			skinNormals.RemoveAt(index);
			skinStiffnesses.RemoveAt(index);
			skinRadiiBackstop.RemoveRange(index * 3, 3);
			constraintCount--;
		}

		public override List<int> GetConstraintsInvolvingParticle(int particleIndex)
		{
			List<int> list = new List<int>(1);
			for (int i = 0; i < base.ConstraintCount; i++)
			{
				if (skinIndices[i] == particleIndex)
				{
					list.Add(i);
				}
			}
			return list;
		}

		public override void Cook()
		{
			batch = Oni.CreateBatch(8, cooked: true);
			Oni.SetSkinConstraints(batch, skinIndices.ToArray(), skinPoints.ToArray(), skinNormals.ToArray(), skinRadiiBackstop.ToArray(), skinStiffnesses.ToArray(), base.ConstraintCount);
			if (Oni.CookBatch(batch))
			{
				constraintCount = Oni.GetBatchConstraintCount(batch);
				activeConstraints = Enumerable.Range(0, constraintCount).ToList();
				int[] array = new int[constraintCount];
				Vector4[] array2 = new Vector4[constraintCount];
				Vector4[] array3 = new Vector4[constraintCount];
				float[] array4 = new float[constraintCount * 3];
				float[] array5 = new float[constraintCount];
				Oni.GetSkinConstraints(batch, array, array2, array3, array4, array5);
				skinIndices = new List<int>(array);
				skinPoints = new List<Vector4>(array2);
				skinNormals = new List<Vector4>(array3);
				skinRadiiBackstop = new List<float>(array4);
				skinStiffnesses = new List<float>(array5);
				int[] collection = new int[Oni.GetBatchPhaseCount(batch)];
				Oni.GetBatchPhaseSizes(batch, collection);
				phaseSizes = new List<int>(collection);
			}
			Oni.DestroyBatch(batch);
			batch = IntPtr.Zero;
		}

		protected override void OnAddToSolver(ObiBatchedConstraints constraints)
		{
			solverIndices = new int[skinIndices.Count];
			for (int i = 0; i < skinIndices.Count; i++)
			{
				solverIndices[i] = constraints.Actor.particleIndices[skinIndices[i]];
				solverIndices[i] = constraints.Actor.particleIndices[skinIndices[i]];
			}
		}

		protected override void OnRemoveFromSolver(ObiBatchedConstraints constraints)
		{
		}

		public override void PushDataToSolver(ObiBatchedConstraints constraints)
		{
			if (!(constraints == null) && !(constraints.Actor == null) && constraints.Actor.InSolver)
			{
				ObiSkinConstraints obiSkinConstraints = (ObiSkinConstraints)constraints;
				float[] array = new float[skinStiffnesses.Count];
				for (int i = 0; i < array.Length; i++)
				{
					array[i] = StiffnessToCompliance(skinStiffnesses[i] * obiSkinConstraints.stiffness);
				}
				Oni.SetSkinConstraints(batch, solverIndices, skinPoints.ToArray(), skinNormals.ToArray(), skinRadiiBackstop.ToArray(), array, base.ConstraintCount);
				Oni.SetBatchPhaseSizes(batch, phaseSizes.ToArray(), phaseSizes.Count);
			}
		}

		public override void PullDataFromSolver(ObiBatchedConstraints constraints)
		{
			if (!(constraints == null) && !(constraints.Actor == null) && constraints.Actor.InSolver)
			{
				int[] indices = new int[constraintCount];
				Vector4[] array = new Vector4[constraintCount];
				Vector4[] array2 = new Vector4[constraintCount];
				float[] radiiBackstops = new float[constraintCount * 3];
				float[] stiffnesses = new float[constraintCount];
				Oni.GetSkinConstraints(batch, indices, array, array2, radiiBackstops, stiffnesses);
				skinPoints = new List<Vector4>(array);
				skinNormals = new List<Vector4>(array2);
			}
		}

		public Vector3 GetSkinPosition(int index)
		{
			return skinPoints[index];
		}

		public Vector3 GetSkinNormal(int index)
		{
			return skinNormals[index];
		}
	}
	[Serializable]
	public class ObiTetherConstraintBatch : ObiConstraintBatch
	{
		[HideInInspector]
		public List<int> tetherIndices = new List<int>();

		[HideInInspector]
		public List<Vector2> maxLengthsScales = new List<Vector2>();

		[HideInInspector]
		public List<float> stiffnesses = new List<float>();

		private int[] solverIndices = new int[0];

		public ObiTetherConstraintBatch(bool cooked, bool sharesParticles)
			: base(cooked, sharesParticles)
		{
		}

		public ObiTetherConstraintBatch(bool cooked, bool sharesParticles, float minYoungModulus, float maxYoungModulus)
			: base(cooked, sharesParticles, minYoungModulus, maxYoungModulus)
		{
		}

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.Tether;
		}

		public override void Clear()
		{
			activeConstraints.Clear();
			tetherIndices.Clear();
			maxLengthsScales.Clear();
			stiffnesses.Clear();
			constraintCount = 0;
		}

		public void AddConstraint(int index1, int index2, float maxLength, float scale, float stiffness)
		{
			activeConstraints.Add(constraintCount);
			tetherIndices.Add(index1);
			tetherIndices.Add(index2);
			maxLengthsScales.Add(new Vector2(maxLength, scale));
			stiffnesses.Add(stiffness);
			constraintCount++;
		}

		public void RemoveConstraint(int index)
		{
			if (index < 0 || index >= base.ConstraintCount)
			{
				return;
			}
			activeConstraints.Remove(index);
			for (int i = 0; i < activeConstraints.Count; i++)
			{
				if (activeConstraints[i] > index)
				{
					activeConstraints[i]--;
				}
			}
			tetherIndices.RemoveRange(index * 2, 2);
			maxLengthsScales.RemoveAt(index);
			stiffnesses.RemoveAt(index);
			constraintCount--;
		}

		public override List<int> GetConstraintsInvolvingParticle(int particleIndex)
		{
			List<int> list = new List<int>(4);
			for (int i = 0; i < base.ConstraintCount; i++)
			{
				if (tetherIndices[i * 2] == particleIndex || tetherIndices[i * 2 + 1] == particleIndex)
				{
					list.Add(i);
				}
			}
			return list;
		}

		public override void Cook()
		{
			batch = Oni.CreateBatch(0, cooked: true);
			Oni.SetTetherConstraints(batch, tetherIndices.ToArray(), maxLengthsScales.ToArray(), stiffnesses.ToArray(), base.ConstraintCount);
			if (Oni.CookBatch(batch))
			{
				constraintCount = Oni.GetBatchConstraintCount(batch);
				activeConstraints = Enumerable.Range(0, constraintCount).ToList();
				int[] array = new int[constraintCount * 2];
				Vector2[] array2 = new Vector2[constraintCount];
				float[] collection = new float[constraintCount];
				Oni.GetTetherConstraints(batch, array, array2, collection);
				tetherIndices = new List<int>(array);
				maxLengthsScales = new List<Vector2>(array2);
				stiffnesses = new List<float>(collection);
				int[] collection2 = new int[Oni.GetBatchPhaseCount(batch)];
				Oni.GetBatchPhaseSizes(batch, collection2);
				phaseSizes = new List<int>(collection2);
			}
			Oni.DestroyBatch(batch);
			batch = IntPtr.Zero;
		}

		protected override void OnAddToSolver(ObiBatchedConstraints constraints)
		{
			solverIndices = new int[tetherIndices.Count];
			for (int i = 0; i < base.ConstraintCount; i++)
			{
				solverIndices[i * 2] = constraints.Actor.particleIndices[tetherIndices[i * 2]];
				solverIndices[i * 2 + 1] = constraints.Actor.particleIndices[tetherIndices[i * 2 + 1]];
			}
		}

		protected override void OnRemoveFromSolver(ObiBatchedConstraints constraints)
		{
		}

		public override void PushDataToSolver(ObiBatchedConstraints constraints)
		{
			if (!(constraints == null) && !(constraints.Actor == null) && constraints.Actor.InSolver)
			{
				ObiTetherConstraints obiTetherConstraints = (ObiTetherConstraints)constraints;
				for (int i = 0; i < base.ConstraintCount; i++)
				{
					maxLengthsScales[i] = new Vector2(maxLengthsScales[i].x, obiTetherConstraints.tetherScale);
					stiffnesses[i] = StiffnessToCompliance(obiTetherConstraints.stiffness);
				}
				Oni.SetTetherConstraints(batch, solverIndices, maxLengthsScales.ToArray(), stiffnesses.ToArray(), base.ConstraintCount);
				Oni.SetBatchPhaseSizes(batch, phaseSizes.ToArray(), phaseSizes.Count);
			}
		}

		public override void PullDataFromSolver(ObiBatchedConstraints constraints)
		{
		}
	}
	[Serializable]
	public class ObiVolumeConstraintBatch : ObiConstraintBatch
	{
		[HideInInspector]
		public List<int> triangleIndices = new List<int>();

		[HideInInspector]
		public List<int> firstTriangle = new List<int>();

		[HideInInspector]
		public List<int> numTriangles = new List<int>();

		[HideInInspector]
		public List<float> restVolumes = new List<float>();

		[HideInInspector]
		public List<Vector2> pressureStiffness = new List<Vector2>();

		private int[] solverIndices;

		public ObiVolumeConstraintBatch(bool cooked, bool sharesParticles)
			: base(cooked, sharesParticles)
		{
		}

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.Volume;
		}

		public override void Clear()
		{
			activeConstraints.Clear();
			triangleIndices.Clear();
			firstTriangle.Clear();
			numTriangles.Clear();
			restVolumes.Clear();
			pressureStiffness.Clear();
			constraintCount = 0;
		}

		public void AddConstraint(int[] triangles, float restVolume, float pressure, float stiffness)
		{
			activeConstraints.Add(constraintCount);
			firstTriangle.Add(triangleIndices.Count / 3);
			numTriangles.Add(triangles.Length / 3);
			triangleIndices.AddRange(triangles);
			restVolumes.Add(restVolume);
			pressureStiffness.Add(new Vector2(pressure, stiffness));
			constraintCount++;
		}

		public void RemoveConstraint(int index)
		{
			if (index < 0 || index >= base.ConstraintCount)
			{
				return;
			}
			activeConstraints.Remove(index);
			for (int i = 0; i < activeConstraints.Count; i++)
			{
				if (activeConstraints[i] > index)
				{
					activeConstraints[i]--;
				}
			}
			triangleIndices.RemoveRange(firstTriangle[index], numTriangles[index]);
			firstTriangle.RemoveAt(index);
			numTriangles.RemoveAt(index);
			restVolumes.RemoveAt(index);
			pressureStiffness.RemoveAt(index);
			constraintCount--;
		}

		public override List<int> GetConstraintsInvolvingParticle(int particleIndex)
		{
			List<int> list = new List<int>(4);
			for (int i = 0; i < base.ConstraintCount; i++)
			{
				if (triangleIndices[i * 3] == particleIndex || triangleIndices[i * 3 + 1] == particleIndex || triangleIndices[i * 3 + 2] == particleIndex)
				{
					list.Add(i);
				}
			}
			return list;
		}

		protected override void OnAddToSolver(ObiBatchedConstraints constraints)
		{
			solverIndices = new int[triangleIndices.Count];
			for (int i = 0; i < triangleIndices.Count; i++)
			{
				solverIndices[i] = constraints.Actor.particleIndices[triangleIndices[i]];
			}
		}

		protected override void OnRemoveFromSolver(ObiBatchedConstraints constraints)
		{
		}

		public override void PushDataToSolver(ObiBatchedConstraints constraints)
		{
			if (!(constraints == null) && !(constraints.Actor == null) && constraints.Actor.InSolver)
			{
				ObiVolumeConstraints obiVolumeConstraints = (ObiVolumeConstraints)constraints;
				for (int i = 0; i < pressureStiffness.Count; i++)
				{
					pressureStiffness[i] = new Vector2(obiVolumeConstraints.overpressure, StiffnessToCompliance(obiVolumeConstraints.stiffness));
				}
				Oni.SetVolumeConstraints(batch, solverIndices, firstTriangle.ToArray(), numTriangles.ToArray(), restVolumes.ToArray(), pressureStiffness.ToArray(), base.ConstraintCount);
			}
		}

		public override void PullDataFromSolver(ObiBatchedConstraints constraints)
		{
		}
	}
	[DisallowMultipleComponent]
	public class ObiAerodynamicConstraints : ObiBatchedConstraints
	{
		[Tooltip("Air density in kg/m3. Higher densities will make both drag and lift forces stronger.")]
		public float airDensity = 1.225f;

		[Tooltip("How much is the cloth affected by drag forces. Extreme values can cause the cloth to behave unrealistically, so use with care.")]
		public float dragCoefficient = 0.05f;

		[Tooltip("How much is the cloth affected by lift forces. Extreme values can cause the cloth to behave unrealistically, so use with care.")]
		public float liftCoefficient = 0.05f;

		[SerializeField]
		[HideInInspector]
		private List<ObiAerodynamicConstraintBatch> batches = new List<ObiAerodynamicConstraintBatch>();

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.Aerodynamics;
		}

		public override IEnumerable<ObiConstraintBatch> GetBatches()
		{
			return batches.Cast<ObiConstraintBatch>();
		}

		public ObiAerodynamicConstraintBatch GetFirstBatch()
		{
			if (batches.Count <= 0)
			{
				return null;
			}
			return batches[0];
		}

		public void OnValidate()
		{
			airDensity = Mathf.Max(0f, airDensity);
			dragCoefficient = Mathf.Max(0f, dragCoefficient);
			liftCoefficient = Mathf.Max(0f, liftCoefficient);
		}

		public override void Clear()
		{
			RemoveFromSolver(null);
			batches.Clear();
		}

		public void AddBatch(ObiAerodynamicConstraintBatch batch)
		{
			if (batch != null && batch.GetConstraintType() == GetConstraintType())
			{
				batches.Add(batch);
			}
		}

		public void RemoveBatch(ObiAerodynamicConstraintBatch batch)
		{
			batches.Remove(batch);
		}

		public void OnDrawGizmosSelected()
		{
			if (!visualize)
			{
				return;
			}
			Gizmos.color = Color.blue;
			foreach (ObiAerodynamicConstraintBatch batch in batches)
			{
				foreach (int activeConstraint in batch.ActiveConstraints)
				{
					Gizmos.DrawWireSphere(actor.GetParticlePosition(batch.aerodynamicIndices[activeConstraint]), 0.01f);
				}
			}
		}
	}
	[ExecuteInEditMode]
	public abstract class ObiBatchedConstraints : MonoBehaviour, IObiSolverClient
	{
		public bool visualize;

		[NonSerialized]
		protected ObiActor actor;

		[NonSerialized]
		protected bool inSolver;

		public ObiActor Actor => actor;

		public bool InSolver => inSolver;

		public abstract Oni.ConstraintType GetConstraintType();

		public abstract IEnumerable<ObiConstraintBatch> GetBatches();

		public abstract void Clear();

		protected void OnAddToSolver(object info)
		{
			foreach (ObiConstraintBatch batch in GetBatches())
			{
				batch.AddToSolver(this);
			}
		}

		protected void OnRemoveFromSolver(object info)
		{
			foreach (ObiConstraintBatch batch in GetBatches())
			{
				batch.RemoveFromSolver(this);
			}
		}

		public void PushDataToSolver(ParticleData data = ParticleData.NONE)
		{
			foreach (ObiConstraintBatch batch in GetBatches())
			{
				batch.PushDataToSolver(this);
			}
		}

		public void PullDataFromSolver(ParticleData data = ParticleData.NONE)
		{
			foreach (ObiConstraintBatch batch in GetBatches())
			{
				batch.PullDataFromSolver(this);
			}
		}

		public void SetActiveConstraints()
		{
			foreach (ObiConstraintBatch batch in GetBatches())
			{
				batch.SetActiveConstraints();
			}
		}

		public void Enable()
		{
			foreach (ObiConstraintBatch batch in GetBatches())
			{
				batch.Enable();
			}
		}

		public void Disable()
		{
			foreach (ObiConstraintBatch batch in GetBatches())
			{
				batch.Disable();
			}
		}

		public bool AddToSolver(object info)
		{
			if (inSolver || actor == null || !actor.InSolver)
			{
				return false;
			}
			OnAddToSolver(info);
			inSolver = true;
			PushDataToSolver();
			SetActiveConstraints();
			if (base.isActiveAndEnabled)
			{
				Enable();
			}
			else
			{
				Disable();
			}
			return true;
		}

		public bool RemoveFromSolver(object info)
		{
			if (!inSolver || actor == null || !actor.InSolver)
			{
				return false;
			}
			OnRemoveFromSolver(null);
			inSolver = false;
			return true;
		}

		public void GrabActor()
		{
			actor = GetComponent<ObiActor>();
		}

		public void OnEnable()
		{
			GrabActor();
			if (actor != null && actor.enabled)
			{
				Enable();
			}
		}

		public void OnDisable()
		{
			if (!(actor == null) && actor.InSolver)
			{
				Disable();
			}
		}

		public void OnDestroy()
		{
			RemoveFromSolver(null);
		}
	}
	[DisallowMultipleComponent]
	public class ObiBendingConstraints : ObiBatchedConstraints
	{
		[Tooltip("Bending offset. Leave at zero to keep the original bending amount.")]
		public float maxBending;

		[Range(0f, 1f)]
		[Tooltip("Cloth resistance to bending. Higher values will yield more stiff cloth.")]
		public float stiffness = 1f;

		[SerializeField]
		[HideInInspector]
		private List<ObiBendConstraintBatch> batches = new List<ObiBendConstraintBatch>();

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.Bending;
		}

		public override IEnumerable<ObiConstraintBatch> GetBatches()
		{
			return batches.Cast<ObiConstraintBatch>();
		}

		public ObiBendConstraintBatch GetFirstBatch()
		{
			if (batches.Count <= 0)
			{
				return null;
			}
			return batches[0];
		}

		public override void Clear()
		{
			RemoveFromSolver(null);
			batches.Clear();
		}

		public void AddBatch(ObiBendConstraintBatch batch)
		{
			if (batch != null && batch.GetConstraintType() == GetConstraintType())
			{
				batches.Add(batch);
			}
		}

		public void RemoveBatch(ObiBendConstraintBatch batch)
		{
			batches.Remove(batch);
		}

		public void OnDrawGizmosSelected()
		{
			if (!visualize)
			{
				return;
			}
			Gizmos.color = new Color(0.5f, 0f, 1f, 1f);
			foreach (ObiBendConstraintBatch batch in batches)
			{
				foreach (int activeConstraint in batch.ActiveConstraints)
				{
					Gizmos.DrawLine(actor.GetParticlePosition(batch.bendingIndices[activeConstraint * 3]), actor.GetParticlePosition(batch.bendingIndices[activeConstraint * 3 + 1]));
				}
			}
		}
	}
	[DisallowMultipleComponent]
	public class ObiDistanceConstraints : ObiBatchedConstraints
	{
		[Tooltip("Scale of stretching constraints. Values > 1 will expand initial cloth size, values < 1 will make it shrink.")]
		public float stretchingScale = 1f;

		[Range(0f, 1f)]
		[Tooltip("Cloth resistance to stretching. Lower values will yield more elastic cloth.")]
		public float stiffness = 1f;

		[Range(0f, 1f)]
		[Tooltip("Amount of compression slack. 0 means total resistance to compression, 1 no resistance at all. 0.5 means constraints will allow a compression of up to 50% of their rest length.")]
		public float slack;

		[SerializeField]
		[HideInInspector]
		private List<ObiDistanceConstraintBatch> batches = new List<ObiDistanceConstraintBatch>();

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.Distance;
		}

		public override IEnumerable<ObiConstraintBatch> GetBatches()
		{
			return batches.Cast<ObiConstraintBatch>();
		}

		public ObiDistanceConstraintBatch GetFirstBatch()
		{
			if (batches.Count <= 0)
			{
				return null;
			}
			return batches[0];
		}

		public override void Clear()
		{
			RemoveFromSolver(null);
			batches.Clear();
		}

		public void AddBatch(ObiDistanceConstraintBatch batch)
		{
			if (batch != null && batch.GetConstraintType() == GetConstraintType())
			{
				batches.Add(batch);
			}
		}

		public void RemoveBatch(ObiDistanceConstraintBatch batch)
		{
			batches.Remove(batch);
		}

		public void OnDrawGizmosSelected()
		{
			if (!visualize)
			{
				return;
			}
			Gizmos.color = Color.green;
			foreach (ObiDistanceConstraintBatch batch in batches)
			{
				foreach (int activeConstraint in batch.ActiveConstraints)
				{
					Gizmos.DrawLine(actor.GetParticlePosition(batch.springIndices[activeConstraint * 2]), actor.GetParticlePosition(batch.springIndices[activeConstraint * 2 + 1]));
				}
			}
		}
	}
	[DisallowMultipleComponent]
	public class ObiPinConstraints : ObiBatchedConstraints
	{
		[Range(0f, 1f)]
		[Tooltip("Pin resistance to stretching. Lower values will yield more elastic pin constraints.")]
		public float stiffness = 1f;

		[SerializeField]
		[HideInInspector]
		private List<ObiPinConstraintBatch> batches = new List<ObiPinConstraintBatch>();

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.Pin;
		}

		public override IEnumerable<ObiConstraintBatch> GetBatches()
		{
			return batches.Cast<ObiConstraintBatch>();
		}

		public ObiPinConstraintBatch GetFirstBatch()
		{
			if (batches.Count <= 0)
			{
				return null;
			}
			return batches[0];
		}

		public override void Clear()
		{
			RemoveFromSolver(null);
			batches.Clear();
		}

		public void AddBatch(ObiPinConstraintBatch batch)
		{
			if (batch != null && batch.GetConstraintType() == GetConstraintType())
			{
				batches.Add(batch);
			}
		}

		public void RemoveBatch(ObiPinConstraintBatch batch)
		{
			batches.Remove(batch);
		}

		public void BreakConstraints()
		{
			for (int i = 0; i < batches.Count; i++)
			{
				batches[i].BreakConstraints();
			}
		}

		public void OnDrawGizmosSelected()
		{
			if (!visualize)
			{
				return;
			}
			Gizmos.color = Color.cyan;
			foreach (ObiPinConstraintBatch batch in batches)
			{
				foreach (int activeConstraint in batch.ActiveConstraints)
				{
					if (batch.pinBodies[activeConstraint] != null)
					{
						Vector3 to = batch.pinBodies[activeConstraint].transform.TransformPoint(batch.pinOffsets[activeConstraint]);
						Gizmos.DrawLine(actor.GetParticlePosition(batch.pinIndices[activeConstraint]), to);
					}
				}
			}
		}
	}
	[DisallowMultipleComponent]
	public class ObiShapeMatchingConstraints : ObiBatchedConstraints
	{
		[Range(0f, 1f)]
		[Tooltip("Stiffness of the volume constraints. Higher values will make the constraints to try harder to enforce the set volume.")]
		public float stiffness = 1f;

		[SerializeField]
		[HideInInspector]
		private List<ObiShapeMatchingConstraintBatch> batches = new List<ObiShapeMatchingConstraintBatch>();

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.ShapeMatching;
		}

		public override IEnumerable<ObiConstraintBatch> GetBatches()
		{
			return batches.Cast<ObiConstraintBatch>();
		}

		public ObiShapeMatchingConstraintBatch GetFirstBatch()
		{
			if (batches.Count <= 0)
			{
				return null;
			}
			return batches[0];
		}

		public override void Clear()
		{
			RemoveFromSolver(null);
			batches.Clear();
		}

		public void AddBatch(ObiShapeMatchingConstraintBatch batch)
		{
			if (batch != null && batch.GetConstraintType() == GetConstraintType())
			{
				batches.Add(batch);
			}
		}

		public void RemoveBatch(ObiShapeMatchingConstraintBatch batch)
		{
			batches.Remove(batch);
		}

		public void OnDrawGizmosSelected()
		{
			if (!visualize)
			{
				return;
			}
			Gizmos.color = Color.black;
			foreach (ObiShapeMatchingConstraintBatch batch in batches)
			{
				foreach (int activeConstraint in batch.ActiveConstraints)
				{
					int num = batch.firstIndex[activeConstraint];
					Vector3 particlePosition = actor.GetParticlePosition(batch.shapeIndices[num]);
					for (int i = 1; i < batch.numIndices[activeConstraint]; i++)
					{
						int index = num + i;
						Vector3 particlePosition2 = actor.GetParticlePosition(batch.shapeIndices[index]);
						Gizmos.DrawLine(particlePosition, particlePosition2);
					}
				}
			}
		}
	}
	[DisallowMultipleComponent]
	public class ObiSkinConstraints : ObiBatchedConstraints
	{
		[Range(0f, 1f)]
		[Tooltip("Skin constraints stiffness.")]
		public float stiffness = 1f;

		[SerializeField]
		[HideInInspector]
		private List<ObiSkinConstraintBatch> batches = new List<ObiSkinConstraintBatch>();

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.Skin;
		}

		public override IEnumerable<ObiConstraintBatch> GetBatches()
		{
			return batches.Cast<ObiConstraintBatch>();
		}

		public ObiSkinConstraintBatch GetFirstBatch()
		{
			if (batches.Count <= 0)
			{
				return null;
			}
			return batches[0];
		}

		public override void Clear()
		{
			RemoveFromSolver(null);
			batches.Clear();
		}

		public void AddBatch(ObiSkinConstraintBatch batch)
		{
			if (batch != null && batch.GetConstraintType() == GetConstraintType())
			{
				batches.Add(batch);
			}
		}

		public void RemoveBatch(ObiSkinConstraintBatch batch)
		{
			batches.Remove(batch);
		}

		public void OnDrawGizmosSelected()
		{
			if (!visualize)
			{
				return;
			}
			Gizmos.color = Color.magenta;
			Matrix4x4 localToWorldMatrix = actor.Solver.transform.localToWorldMatrix;
			foreach (ObiSkinConstraintBatch batch in batches)
			{
				batch.PullDataFromSolver(this);
				foreach (int activeConstraint in batch.ActiveConstraints)
				{
					Vector3 vector = batch.GetSkinPosition(activeConstraint);
					if (!base.InSolver)
					{
						vector = base.transform.TransformPoint(vector);
					}
					else if (actor.Solver.simulateInLocalSpace)
					{
						vector = localToWorldMatrix.MultiplyPoint3x4(vector);
					}
					if (actor.invMasses[batch.skinIndices[activeConstraint]] > 0f)
					{
						Gizmos.DrawLine(vector, actor.GetParticlePosition(batch.skinIndices[activeConstraint]));
					}
				}
			}
		}
	}
	[DisallowMultipleComponent]
	public class ObiTetherConstraints : ObiBatchedConstraints
	{
		[Range(0.1f, 2f)]
		[Tooltip("Scale of tether constraints. Values > 1 will expand initial tether length, values < 1 will make it shrink.")]
		public float tetherScale = 1f;

		[Range(0f, 1f)]
		[Tooltip("Tether resistance to stretching. Lower values will enforce tethers with more strenght.")]
		public float stiffness = 1f;

		[SerializeField]
		[HideInInspector]
		private List<ObiTetherConstraintBatch> batches = new List<ObiTetherConstraintBatch>();

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.Tether;
		}

		public override IEnumerable<ObiConstraintBatch> GetBatches()
		{
			return batches.Cast<ObiConstraintBatch>();
		}

		public ObiTetherConstraintBatch GetFirstBatch()
		{
			if (batches.Count <= 0)
			{
				return null;
			}
			return batches[0];
		}

		public override void Clear()
		{
			RemoveFromSolver(null);
			batches.Clear();
		}

		public void AddBatch(ObiTetherConstraintBatch batch)
		{
			if (batch != null && batch.GetConstraintType() == GetConstraintType())
			{
				batches.Add(batch);
			}
		}

		public void RemoveBatch(ObiTetherConstraintBatch batch)
		{
			batches.Remove(batch);
		}

		public void OnDrawGizmosSelected()
		{
			if (!visualize)
			{
				return;
			}
			Gizmos.color = Color.yellow;
			foreach (ObiTetherConstraintBatch batch in batches)
			{
				foreach (int activeConstraint in batch.ActiveConstraints)
				{
					Gizmos.DrawLine(actor.GetParticlePosition(batch.tetherIndices[activeConstraint * 2]), actor.GetParticlePosition(batch.tetherIndices[activeConstraint * 2 + 1]));
				}
			}
		}
	}
	[DisallowMultipleComponent]
	public class ObiVolumeConstraints : ObiBatchedConstraints
	{
		[Tooltip("Amount of pressure applied to the cloth.")]
		public float overpressure = 1f;

		[Range(0f, 1f)]
		[Tooltip("Stiffness of the volume constraints. Higher values will make the constraints to try harder to enforce the set volume.")]
		public float stiffness = 1f;

		[SerializeField]
		[HideInInspector]
		private List<ObiVolumeConstraintBatch> batches = new List<ObiVolumeConstraintBatch>();

		public override Oni.ConstraintType GetConstraintType()
		{
			return Oni.ConstraintType.Volume;
		}

		public override IEnumerable<ObiConstraintBatch> GetBatches()
		{
			return batches.Cast<ObiConstraintBatch>();
		}

		public ObiVolumeConstraintBatch GetFirstBatch()
		{
			if (batches.Count <= 0)
			{
				return null;
			}
			return batches[0];
		}

		public override void Clear()
		{
			RemoveFromSolver(null);
			batches.Clear();
		}

		public void AddBatch(ObiVolumeConstraintBatch batch)
		{
			if (batch != null && batch.GetConstraintType() == GetConstraintType())
			{
				batches.Add(batch);
			}
		}

		public void RemoveBatch(ObiVolumeConstraintBatch batch)
		{
			batches.Remove(batch);
		}

		public void OnDrawGizmosSelected()
		{
			if (!visualize)
			{
				return;
			}
			Gizmos.color = Color.red;
			foreach (ObiVolumeConstraintBatch batch in batches)
			{
				foreach (int activeConstraint in batch.ActiveConstraints)
				{
					int num = batch.firstTriangle[activeConstraint];
					for (int i = 0; i < batch.numTriangles[activeConstraint]; i++)
					{
						int num2 = num + i;
						Vector3 particlePosition = actor.GetParticlePosition(batch.triangleIndices[num2 * 3]);
						Vector3 particlePosition2 = actor.GetParticlePosition(batch.triangleIndices[num2 * 3 + 1]);
						Vector3 particlePosition3 = actor.GetParticlePosition(batch.triangleIndices[num2 * 3 + 2]);
						Gizmos.DrawLine(particlePosition, particlePosition2);
						Gizmos.DrawLine(particlePosition, particlePosition3);
						Gizmos.DrawLine(particlePosition2, particlePosition3);
					}
				}
			}
		}
	}
	public class CoroutineJob
	{
		public class ProgressInfo
		{
			public string userReadableInfo;

			public float progress;

			public ProgressInfo(string userReadableInfo, float progress)
			{
				this.userReadableInfo = userReadableInfo;
				this.progress = progress;
			}
		}

		private object result;

		private bool isDone;

		private bool raisedException;

		private bool stop;

		private Exception e;

		public int asyncThreshold;

		public object Result
		{
			get
			{
				if (e != null)
				{
					throw e;
				}
				return result;
			}
		}

		public bool IsDone => isDone;

		public bool RaisedException => raisedException;

		private void Init()
		{
			isDone = false;
			raisedException = false;
			stop = false;
			result = null;
		}

		public static object RunSynchronously(IEnumerator coroutine)
		{
			List<object> list = new List<object>();
			if (coroutine == null)
			{
				return list;
			}
			try
			{
				while (coroutine.MoveNext())
				{
					list.Add(coroutine.Current);
				}
				return list;
			}
			catch (Exception ex)
			{
				throw ex;
			}
		}

		public IEnumerator Start(IEnumerator coroutine)
		{
			Init();
			if (coroutine == null)
			{
				isDone = true;
				yield break;
			}
			Stopwatch sw = new Stopwatch();
			sw.Start();
			while (!stop)
			{
				try
				{
					if (!coroutine.MoveNext())
					{
						isDone = true;
						sw.Stop();
						break;
					}
				}
				catch (Exception ex)
				{
					Exception exception = (e = ex);
					raisedException = true;
					UnityEngine.Debug.LogException(exception);
					isDone = true;
					sw.Stop();
					break;
				}
				result = coroutine.Current;
				if (sw.ElapsedMilliseconds > asyncThreshold)
				{
					yield return result;
				}
			}
		}

		public void Stop()
		{
			stop = true;
		}
	}
	public class EditorCoroutine
	{
		private readonly IEnumerator routine;

		private object result;

		private bool isDone;

		public object Result => result;

		public bool IsDone => isDone;

		public static EditorCoroutine StartCoroutine(IEnumerator _routine)
		{
			EditorCoroutine editorCoroutine = new EditorCoroutine(_routine);
			editorCoroutine.Start();
			return editorCoroutine;
		}

		private EditorCoroutine(IEnumerator _routine)
		{
			routine = _routine;
		}

		private void Start()
		{
			isDone = false;
			result = null;
			Update();
		}

		public void Stop()
		{
			isDone = true;
		}

		private void Update()
		{
			bool num = routine.MoveNext();
			result = routine.Current;
			if (!num)
			{
				Stop();
			}
		}

		public static void ShowCoroutineProgressBar(string title, EditorCoroutine coroutine)
		{
		}
	}
	public class ObiList<T> : IList<T>, ICollection<T>, IEnumerable<T>, IEnumerable
	{
		private T[] data = new T[16];

		private int count;

		public int Count => count;

		public bool IsReadOnly => false;

		public T this[int index]
		{
			get
			{
				return data[index];
			}
			set
			{
				data[index] = value;
			}
		}

		public T[] Data => data;

		public IEnumerator<T> GetEnumerator()
		{
			int i = 0;
			while (i < count)
			{
				yield return data[i];
				int num = i + 1;
				i = num;
			}
		}

		IEnumerator IEnumerable.GetEnumerator()
		{
			return GetEnumerator();
		}

		public void Add(T item)
		{
			data[count] = item;
			EnsureCapacity(++count);
		}

		public void Clear()
		{
			count = 0;
		}

		public bool Contains(T item)
		{
			for (int i = 0; i < count; i++)
			{
				if (data[i].Equals(item))
				{
					return true;
				}
			}
			return false;
		}

		public void CopyTo(T[] array, int arrayIndex)
		{
			if (array == null)
			{
				throw new ArgumentNullException();
			}
			if (array.Length - arrayIndex < count)
			{
				throw new ArgumentException();
			}
			Array.Copy(data, 0, array, arrayIndex, count);
		}

		public bool Remove(T item)
		{
			bool flag = false;
			for (int i = 0; i < count; i++)
			{
				if (!flag && data[i].Equals(item))
				{
					flag = true;
				}
				if (flag && i < count - 1)
				{
					data[i] = data[i + 1];
				}
			}
			if (flag)
			{
				count--;
			}
			return flag;
		}

		public int IndexOf(T item)
		{
			return Array.IndexOf(data, item);
		}

		public void Insert(int index, T item)
		{
			if (index < 0 || index > count)
			{
				throw new ArgumentOutOfRangeException();
			}
			EnsureCapacity(++count);
			for (int i = count - 1; i > index; i++)
			{
				data[i] = data[i - 1];
			}
			data[index] = item;
		}

		public void RemoveAt(int index)
		{
			for (int i = index; i < count; i++)
			{
				if (i < count - 1)
				{
					data[i] = data[i + 1];
				}
			}
			count--;
		}

		public void SetCount(int count)
		{
			EnsureCapacity(count);
			this.count = count;
		}

		public void EnsureCapacity(int capacity)
		{
			if (capacity >= data.Length)
			{
				Array.Resize(ref data, capacity * 2);
			}
		}
	}
	public class ObiParticleCache : ScriptableObject
	{
		public class UncompressedFrame
		{
			public List<int> indices = new List<int>();

			public List<Vector3> positions = new List<Vector3>();
		}

		[Serializable]
		public class Frame
		{
			public float time;

			public List<Vector3> positions;

			public List<int> indices;

			public Frame()
			{
				time = 0f;
				positions = new List<Vector3>();
				indices = new List<int>();
			}

			public void Clear()
			{
				time = 0f;
				positions.Clear();
				indices.Clear();
			}

			public int SizeInBytes()
			{
				return 4 + positions.Count * 4 * 3 + indices.Count * 4;
			}

			public static void Lerp(Frame a, Frame b, ref Frame result, float mu)
			{
				result.Clear();
				result.time = Mathf.Lerp(a.time, b.time, mu);
				int num = 0;
				int num2 = 0;
				int count = a.indices.Count;
				int count2 = b.indices.Count;
				float num3 = 1f - mu;
				Vector3 zero = Vector3.zero;
				while (num < count && num2 < count2)
				{
					int num4 = a.indices[num];
					int num5 = b.indices[num2];
					if (num4 > num5)
					{
						result.indices.Add(num5);
						result.positions.Add(b.positions[num2]);
						num2++;
						continue;
					}
					if (num4 < num5)
					{
						result.indices.Add(num4);
						result.positions.Add(a.positions[num]);
						num++;
						continue;
					}
					result.indices.Add(num4);
					Vector3 vector = a.positions[num];
					Vector3 vector2 = b.positions[num2];
					zero.Set(vector.x * num3 + vector2.x * mu, vector.y * num3 + vector2.y * mu, vector.z * num3 + vector2.z * mu);
					result.positions.Add(zero);
					num++;
					num2++;
				}
			}
		}

		public float referenceIntervalSeconds = 0.5f;

		public bool localSpace = true;

		[SerializeField]
		private float duration;

		[SerializeField]
		private List<Frame> frames;

		[SerializeField]
		private List<int> references;

		public float Duration => duration;

		public int FrameCount => frames.Count;

		public void OnEnable()
		{
			if (frames == null)
			{
				frames = new List<Frame>();
			}
			if (references == null)
			{
				references = new List<int> { 0 };
			}
		}

		public int SizeInBytes()
		{
			int num = 0;
			foreach (Frame frame in frames)
			{
				num += frame.SizeInBytes();
			}
			return num + references.Count * 4;
		}

		public void Clear()
		{
			duration = 0f;
			frames.Clear();
			references.Clear();
			references.Add(0);
		}

		private int GetBaseFrame(float time)
		{
			int num = Mathf.FloorToInt(time / referenceIntervalSeconds);
			if (num >= 0 && num < references.Count)
			{
				return references[num];
			}
			return int.MaxValue;
		}

		public void AddFrame(Frame frame)
		{
			int num = Mathf.FloorToInt(frame.time / referenceIntervalSeconds);
			if (num >= references.Count)
			{
				for (float num2 = frame.time - (float)Mathf.Max(0, references.Count - 1) * referenceIntervalSeconds; num2 >= referenceIntervalSeconds; num2 -= referenceIntervalSeconds)
				{
					references.Add(frames.Count);
				}
			}
			if (frame.time >= duration)
			{
				frames.Add(frame);
				duration = frame.time;
				return;
			}
			for (int i = references[num]; i < frames.Count; i++)
			{
				if (frames[i].time > frame.time)
				{
					frames[i] = frame;
					break;
				}
			}
		}

		public void GetFrame(float time, bool interpolate, ref Frame result)
		{
			time = Mathf.Clamp(time, 0f, duration);
			for (int i = GetBaseFrame(time); i < frames.Count; i++)
			{
				if (!(frames[i].time > time))
				{
					continue;
				}
				if (interpolate)
				{
					int num = Mathf.Max(0, i - 1);
					float mu = 0f;
					if (i != num)
					{
						mu = (time - frames[num].time) / (frames[i].time - frames[num].time);
					}
					Frame.Lerp(frames[num], frames[i], ref result, mu);
				}
				else
				{
					result = frames[i];
				}
				break;
			}
		}
	}
	public class ObiRopeSection : ScriptableObject
	{
		[HideInInspector]
		public List<Vector2> vertices;

		public int snapX;

		public int snapY;

		public int Segments => vertices.Count - 1;

		public void OnEnable()
		{
			if (vertices == null)
			{
				vertices = new List<Vector2>();
				CirclePreset(8);
			}
		}

		public void CirclePreset(int segments)
		{
			vertices.Clear();
			for (int i = 0; i <= segments; i++)
			{
				float f = (float)Math.PI * 2f / (float)segments * (float)i;
				vertices.Add(Mathf.Cos(f) * Vector2.right + Mathf.Sin(f) * Vector2.up);
			}
		}

		public static int SnapTo(float val, int snapInterval, int threshold)
		{
			int num = (int)val;
			if (snapInterval <= 0)
			{
				return num;
			}
			int num2 = Mathf.FloorToInt(val / (float)snapInterval) * snapInterval;
			int num3 = num2 + snapInterval;
			if (num - num2 < threshold)
			{
				return num2;
			}
			if (num3 - num < threshold)
			{
				return num3;
			}
			return num;
		}
	}
	public abstract class ObiEmitterMaterial : ScriptableObject
	{
		public class MaterialChangeEventArgs : EventArgs
		{
			public MaterialChanges changes;

			public MaterialChangeEventArgs(MaterialChanges changes)
			{
				this.changes = changes;
			}
		}

		[Flags]
		public enum MaterialChanges
		{
			PER_MATERIAL_DATA = 0,
			PER_PARTICLE_DATA = 1
		}

		public float resolution = 1f;

		public float restDensity = 1000f;

		private EventHandler<MaterialChangeEventArgs> onChangesMade;

		public event EventHandler<MaterialChangeEventArgs> OnChangesMade
		{
			add
			{
				onChangesMade = (EventHandler<MaterialChangeEventArgs>)Delegate.Remove(onChangesMade, value);
				onChangesMade = (EventHandler<MaterialChangeEventArgs>)Delegate.Combine(onChangesMade, value);
			}
			remove
			{
				onChangesMade = (EventHandler<MaterialChangeEventArgs>)Delegate.Remove(onChangesMade, value);
			}
		}

		public void CommitChanges(MaterialChanges changes)
		{
			if (onChangesMade != null)
			{
				onChangesMade(this, new MaterialChangeEventArgs(changes));
			}
		}

		public float GetParticleSize(Oni.SolverParameters.Mode mode)
		{
			return 1f / (10f * Mathf.Pow(resolution, 1f / ((mode == Oni.SolverParameters.Mode.Mode3D) ? 3f : 2f)));
		}

		public float GetParticleMass(Oni.SolverParameters.Mode mode)
		{
			return restDensity * Mathf.Pow(GetParticleSize(mode), (mode == Oni.SolverParameters.Mode.Mode3D) ? 3 : 2);
		}

		public abstract Oni.FluidMaterial GetEquivalentOniMaterial(Oni.SolverParameters.Mode mode);
	}
	public class ObiEmitterMaterialFluid : ObiEmitterMaterial
	{
		public float smoothing = 1.5f;

		public float viscosity = 0.05f;

		public float surfaceTension = 0.1f;

		public float buoyancy = -1f;

		public float atmosphericDrag;

		public float atmosphericPressure;

		public float vorticity;

		public void OnValidate()
		{
			resolution = Mathf.Max(0.001f, resolution);
			restDensity = Mathf.Max(0.001f, restDensity);
			smoothing = Mathf.Max(1f, smoothing);
			viscosity = Mathf.Max(0f, viscosity);
			atmosphericDrag = Mathf.Max(0f, atmosphericDrag);
		}

		public override Oni.FluidMaterial GetEquivalentOniMaterial(Oni.SolverParameters.Mode mode)
		{
			Oni.FluidMaterial result = default(Oni.FluidMaterial);
			result.smoothingRadius = GetParticleSize(mode) * smoothing;
			result.restDensity = restDensity;
			result.viscosity = viscosity;
			result.surfaceTension = surfaceTension;
			result.buoyancy = buoyancy;
			result.atmosphericDrag = atmosphericDrag;
			result.atmosphericPressure = atmosphericPressure;
			result.vorticity = vorticity;
			return result;
		}
	}
	public class ObiEmitterMaterialGranular : ObiEmitterMaterial
	{
		public float randomness;

		public void OnValidate()
		{
			resolution = Mathf.Max(0.001f, resolution);
			restDensity = Mathf.Max(0.001f, restDensity);
			randomness = Mathf.Max(0f, randomness);
		}

		public override Oni.FluidMaterial GetEquivalentOniMaterial(Oni.SolverParameters.Mode mode)
		{
			Oni.FluidMaterial result = default(Oni.FluidMaterial);
			result.smoothingRadius = GetParticleSize(mode);
			result.restDensity = restDensity;
			result.viscosity = 0f;
			result.surfaceTension = 0f;
			result.buoyancy = -1f;
			result.atmosphericDrag = 0f;
			result.atmosphericPressure = 0f;
			result.vorticity = 0f;
			return result;
		}
	}
	[ExecuteInEditMode]
	public abstract class ObiEmitterShape : MonoBehaviour
	{
		[Serializable]
		public struct DistributionPoint
		{
			public Vector3 position;

			public Vector3 velocity;

			public Color color;

			public DistributionPoint(Vector3 position, Vector3 velocity)
			{
				this.position = position;
				this.velocity = velocity;
				color = Color.white;
			}

			public DistributionPoint(Vector3 position, Vector3 velocity, Color color)
			{
				this.position = position;
				this.velocity = velocity;
				this.color = color;
			}

			public DistributionPoint GetTransformed(Matrix4x4 transform, Color multiplyColor)
			{
				return new DistributionPoint(transform.MultiplyPoint3x4(position), transform.MultiplyVector(velocity), color * multiplyColor);
			}
		}

		[SerializeProperty("Emitter")]
		[SerializeField]
		protected ObiEmitter emitter;

		public Color color = Color.white;

		[HideInInspector]
		public float particleSize;

		[HideInInspector]
		public List<DistributionPoint> distribution = new List<DistributionPoint>();

		protected Matrix4x4 l2sTransform;

		public ObiEmitter Emitter
		{
			get
			{
				return emitter;
			}
			set
			{
				if (emitter != value)
				{
					if (emitter != null)
					{
						emitter.RemoveShape(this);
					}
					emitter = value;
					if (emitter != null)
					{
						emitter.AddShape(this);
					}
				}
			}
		}

		public Matrix4x4 ShapeLocalToSolverMatrix => l2sTransform;

		public void OnEnable()
		{
			if (emitter != null)
			{
				emitter.AddShape(this);
			}
		}

		public void OnDisable()
		{
			if (emitter != null)
			{
				emitter.RemoveShape(this);
			}
		}

		public void UpdateLocalToSolverMatrix()
		{
			if (emitter != null && emitter.InSolver)
			{
				if (emitter.Solver.simulateInLocalSpace)
				{
					l2sTransform = emitter.Solver.transform.worldToLocalMatrix * base.transform.localToWorldMatrix * emitter.InitialScaleMatrix.inverse;
				}
				else
				{
					l2sTransform = base.transform.localToWorldMatrix * emitter.InitialScaleMatrix.inverse;
				}
			}
			else
			{
				l2sTransform = base.transform.localToWorldMatrix;
			}
		}

		public abstract void GenerateDistribution();
	}
	[Flags]
	public enum ParticleData
	{
		NONE = 0,
		ACTIVE_STATUS = 1,
		ACTOR_ID = 2,
		POSITIONS = 4,
		VELOCITIES = 8,
		INV_MASSES = 0x10,
		VORTICITIES = 0x20,
		SOLID_RADII = 0x40,
		PHASES = 0x80,
		REST_POSITIONS = 0x100,
		COLLISION_MATERIAL = 0x200,
		ANGULAR_VELOCITIES = 0x400,
		PRINCIPAL_RADII = 0x800,
		ORIENTATIONS = 0x1000,
		ALL = -1
	}
	public interface IObiSolverClient
	{
		bool AddToSolver(object info);

		bool RemoveFromSolver(object info);

		void PushDataToSolver(ParticleData data = ParticleData.NONE);

		void PullDataFromSolver(ParticleData data = ParticleData.NONE);
	}
	[RequireComponent(typeof(Animator))]
	[DisallowMultipleComponent]
	public class ObiAnimatorController : MonoBehaviour
	{
		private bool updatedThisStep;

		private Animator animator;

		public void Awake()
		{
			animator = GetComponent<Animator>();
		}

		public void UpdateAnimation()
		{
			if (animator != null && animator.enabled && !updatedThisStep)
			{
				animator.playableGraph.Stop();
				animator.Update(Time.fixedDeltaTime);
				updatedThisStep = true;
			}
		}

		public void ResetUpdateFlag()
		{
			updatedThisStep = false;
		}

		public void ResumeAutonomousUpdate()
		{
			if (animator != null && animator.enabled)
			{
				animator.playableGraph.Play();
			}
		}
	}
	public class ObiArbiter
	{
		private HashSet<ObiSolver> solvers = new HashSet<ObiSolver>();

		private int solverCounter;

		public void RegisterSolver(ObiSolver solver)
		{
			if (solver != null)
			{
				solvers.Add(solver);
			}
		}

		public void UnregisterSolver(ObiSolver solver)
		{
			if (solver != null)
			{
				solvers.Remove(solver);
			}
		}

		public bool WaitForAllSolvers()
		{
			solverCounter++;
			if (solverCounter >= solvers.Count)
			{
				solverCounter = 0;
				Oni.WaitForAllTasks();
				foreach (ObiSolver solver in solvers)
				{
					solver.AllSolversStepEnd();
				}
				return true;
			}
			return false;
		}
	}
	[ExecuteInEditMode]
	[AddComponentMenu("Physics/Obi/Obi Solver")]
	[DisallowMultipleComponent]
	public sealed class ObiSolver : MonoBehaviour
	{
		public enum SimulationOrder
		{
			FixedUpdate,
			AfterFixedUpdate,
			LateUpdate
		}

		public class ObiCollisionEventArgs : EventArgs
		{
			public ObiList<Oni.Contact> contacts = new ObiList<Oni.Contact>();
		}

		public class ObiFluidEventArgs : EventArgs
		{
			public ObiList<int> indices = new ObiList<int>();

			public ObiList<Vector4> vorticities = new ObiList<Vector4>();

			public ObiList<float> densities = new ObiList<float>();
		}

		public class ParticleInActor
		{
			public ObiActor actor;

			public int indexInActor;

			public ParticleInActor(ObiActor actor, int indexInActor)
			{
				this.actor = actor;
				this.indexInActor = indexInActor;
			}
		}

		public const int MAX_NEIGHBOURS = 92;

		public const int CONSTRAINT_GROUPS = 12;

		public int maxParticles = 5000;

		[NonSerialized]
		[HideInInspector]
		public bool simulate = true;

		public uint substeps = 1u;

		[Tooltip("If enabled, will force the solver to keep simulating even when not visible from any camera.")]
		public bool simulateWhenInvisible = true;

		[Tooltip("If enabled, the solver object transform will be used as the frame of reference for all actors using this solver, instead of the world's frame.")]
		public bool simulateInLocalSpace;

		[Indent]
		[VisibleIf("simulateInLocalSpace", false)]
		public float worldLinearVelocityScale;

		[Indent]
		[VisibleIf("simulateInLocalSpace", false)]
		public float worldAngularVelocityScale;

		[Indent]
		[VisibleIf("simulateInLocalSpace", false)]
		public float worldLinearInertiaScale;

		[Indent]
		[VisibleIf("simulateInLocalSpace", false)]
		public float worldAngularInertiaScale;

		[Tooltip("Determines when will the solver update particles.")]
		[SerializeProperty("UpdateOrder")]
		[SerializeField]
		private SimulationOrder simulationOrder;

		[ChildrenOnly]
		public Oni.SolverParameters parameters = new Oni.SolverParameters(Oni.SolverParameters.Interpolation.None, new Vector4(0f, -9.81f, 0f, 0f));

		[NonSerialized]
		[HideInInspector]
		public List<ObiActor> actors = new List<ObiActor>();

		private int allocatedParticleCount;

		[NonSerialized]
		[HideInInspector]
		public ParticleInActor[] particleToActor;

		[NonSerialized]
		[HideInInspector]
		public int[] materialIndices;

		[NonSerialized]
		[HideInInspector]
		public int[] fluidMaterialIndices;

		private int[] activeParticles;

		private List<ObiEmitterMaterial> emitterMaterials = new List<ObiEmitterMaterial>();

		[NonSerialized]
		[HideInInspector]
		public Vector4[] renderablePositions;

		[NonSerialized]
		[HideInInspector]
		public Oni.Anisotropy[] anisotropies;

		[Header("Constraints")]
		public Oni.ConstraintParameters distanceConstraintParameters = new Oni.ConstraintParameters(enabled: true, Oni.ConstraintParameters.EvaluationOrder.Sequential, 3);

		public Oni.ConstraintParameters bendingConstraintParameters = new Oni.ConstraintParameters(enabled: true, Oni.ConstraintParameters.EvaluationOrder.Parallel, 3);

		public Oni.ConstraintParameters particleCollisionConstraintParameters = new Oni.ConstraintParameters(enabled: true, Oni.ConstraintParameters.EvaluationOrder.Parallel, 3);

		public Oni.ConstraintParameters collisionConstraintParameters = new Oni.ConstraintParameters(enabled: true, Oni.ConstraintParameters.EvaluationOrder.Parallel, 3);

		public Oni.ConstraintParameters skinConstraintParameters = new Oni.ConstraintParameters(enabled: true, Oni.ConstraintParameters.EvaluationOrder.Sequential, 3);

		public Oni.ConstraintParameters volumeConstraintParameters = new Oni.ConstraintParameters(enabled: true, Oni.ConstraintParameters.EvaluationOrder.Parallel, 3);

		public Oni.ConstraintParameters shapeMatchingConstraintParameters = new Oni.ConstraintParameters(enabled: true, Oni.ConstraintParameters.EvaluationOrder.Parallel, 3);

		public Oni.ConstraintParameters tetherConstraintParameters = new Oni.ConstraintParameters(enabled: true, Oni.ConstraintParameters.EvaluationOrder.Parallel, 3);

		public Oni.ConstraintParameters pinConstraintParameters = new Oni.ConstraintParameters(enabled: true, Oni.ConstraintParameters.EvaluationOrder.Parallel, 3);

		public Oni.ConstraintParameters stitchConstraintParameters = new Oni.ConstraintParameters(enabled: true, Oni.ConstraintParameters.EvaluationOrder.Parallel, 2);

		public Oni.ConstraintParameters densityConstraintParameters = new Oni.ConstraintParameters(enabled: true, Oni.ConstraintParameters.EvaluationOrder.Parallel, 2);

		private IntPtr oniSolver;

		private ObiCollisionEventArgs collisionArgs = new ObiCollisionEventArgs();

		private ObiFluidEventArgs fluidArgs = new ObiFluidEventArgs();

		private ObiEmitterMaterial defaultFluidMaterial;

		private Bounds bounds;

		private bool initialized;

		private bool isVisible = true;

		private float smoothDelta = 0.02f;

		private int renderablePositionsClients;

		private static bool firstFixedUpdate = true;

		public static ObiArbiter fixedUpdateArbiter = new ObiArbiter();

		public static ObiArbiter afterFixedUpdateArbiter = new ObiArbiter();

		public static ObiArbiter lateUpdateArbiter = new ObiArbiter();

		public IntPtr OniSolver => oniSolver;

		public Bounds Bounds => bounds;

		public bool IsVisible => isVisible;

		public SimulationOrder UpdateOrder
		{
			get
			{
				return simulationOrder;
			}
			set
			{
				if (simulationOrder != value)
				{
					switch (simulationOrder)
					{
					case SimulationOrder.FixedUpdate:
						fixedUpdateArbiter.UnregisterSolver(this);
						break;
					case SimulationOrder.AfterFixedUpdate:
						afterFixedUpdateArbiter.UnregisterSolver(this);
						break;
					case SimulationOrder.LateUpdate:
						lateUpdateArbiter.UnregisterSolver(this);
						break;
					}
					simulationOrder = value;
					switch (simulationOrder)
					{
					case SimulationOrder.FixedUpdate:
						fixedUpdateArbiter.RegisterSolver(this);
						break;
					case SimulationOrder.AfterFixedUpdate:
						afterFixedUpdateArbiter.RegisterSolver(this);
						break;
					case SimulationOrder.LateUpdate:
						lateUpdateArbiter.RegisterSolver(this);
						break;
					}
				}
			}
		}

		public int AllocParticleCount => allocatedParticleCount;

		public bool IsUpdating
		{
			get
			{
				if (initialized && simulate)
				{
					if (!simulateWhenInvisible)
					{
						return IsVisible;
					}
					return true;
				}
				return false;
			}
		}

		public static event EventHandler OnUpdateColliders;

		public static event EventHandler OnAfterUpdateColliders;

		public static event EventHandler OnUpdateRigidbodies;

		public event EventHandler OnFrameBegin;

		public event EventHandler OnStepBegin;

		public event EventHandler OnFixedParticlesUpdated;

		public event EventHandler OnStepEnd;

		public event EventHandler OnBeforePositionInterpolation;

		public event EventHandler OnBeforeActorsFrameEnd;

		public event EventHandler OnFrameEnd;

		public event EventHandler<ObiCollisionEventArgs> OnCollision;

		public event EventHandler<ObiFluidEventArgs> OnFluidUpdated;

		public void RequireRenderablePositions()
		{
			renderablePositionsClients++;
		}

		public void RelinquishRenderablePositions()
		{
			if (renderablePositionsClients > 0)
			{
				renderablePositionsClients--;
			}
		}

		private void OnValidate()
		{
			if (substeps < 1)
			{
				substeps = 1u;
			}
		}

		private void Awake()
		{
			if (UnityEngine.Application.isPlaying)
			{
				Initialize();
			}
		}

		private void OnDestroy()
		{
			if (UnityEngine.Application.isPlaying)
			{
				Teardown();
			}
		}

		private void OnEnable()
		{
			if (!UnityEngine.Application.isPlaying)
			{
				Initialize();
			}
			StartCoroutine("RunLateFixedUpdate");
			switch (simulationOrder)
			{
			case SimulationOrder.FixedUpdate:
				fixedUpdateArbiter.RegisterSolver(this);
				break;
			case SimulationOrder.AfterFixedUpdate:
				afterFixedUpdateArbiter.RegisterSolver(this);
				break;
			case SimulationOrder.LateUpdate:
				lateUpdateArbiter.RegisterSolver(this);
				break;
			}
		}

		private void OnDisable()
		{
			if (!UnityEngine.Application.isPlaying)
			{
				Teardown();
			}
			StopCoroutine("RunLateFixedUpdate");
			switch (simulationOrder)
			{
			case SimulationOrder.FixedUpdate:
				fixedUpdateArbiter.UnregisterSolver(this);
				break;
			case SimulationOrder.AfterFixedUpdate:
				afterFixedUpdateArbiter.UnregisterSolver(this);
				break;
			case SimulationOrder.LateUpdate:
				lateUpdateArbiter.UnregisterSolver(this);
				break;
			}
		}

		public void Initialize()
		{
			Teardown();
			try
			{
				defaultFluidMaterial = ScriptableObject.CreateInstance<ObiEmitterMaterialFluid>();
				defaultFluidMaterial.hideFlags = HideFlags.HideAndDontSave;
				oniSolver = Oni.CreateSolver(maxParticles, 92);
				InitializeTransformFrame();
				actors = new List<ObiActor>();
				activeParticles = new int[maxParticles];
				particleToActor = new ParticleInActor[maxParticles];
				materialIndices = new int[maxParticles];
				fluidMaterialIndices = new int[maxParticles];
				renderablePositions = new Vector4[maxParticles];
				anisotropies = new Oni.Anisotropy[maxParticles];
				UpdateEmitterMaterials();
				UpdateParameters();
			}
			catch (Exception exception)
			{
				UnityEngine.Debug.LogException(exception);
			}
			finally
			{
				initialized = true;
			}
		}

		private void Teardown()
		{
			if (!initialized)
			{
				return;
			}
			try
			{
				while (actors.Count > 0)
				{
					actors[actors.Count - 1].RemoveFromSolver(null);
				}
				Oni.DestroySolver(oniSolver);
				oniSolver = IntPtr.Zero;
				UnityEngine.Object.DestroyImmediate(defaultFluidMaterial);
			}
			catch (Exception exception)
			{
				UnityEngine.Debug.LogException(exception);
			}
			finally
			{
				initialized = false;
			}
		}

		private void InitializeTransformFrame()
		{
			Vector4 translation = base.transform.position;
			Vector4 scale = base.transform.lossyScale;
			Quaternion rotation = base.transform.rotation;
			Oni.InitializeFrame(oniSolver, ref translation, ref scale, ref rotation);
		}

		private void UpdateTransformFrame(float dt)
		{
			if (simulateInLocalSpace)
			{
				Vector4 translation = base.transform.position;
				Vector4 scale = base.transform.lossyScale;
				Quaternion rotation = base.transform.rotation;
				Oni.UpdateFrame(oniSolver, ref translation, ref scale, ref rotation, dt);
				Oni.ApplyFrame(oniSolver, worldLinearVelocityScale, worldAngularVelocityScale, worldLinearInertiaScale, worldAngularInertiaScale, dt);
			}
			else
			{
				Vector4 translation2 = Vector4.zero;
				Vector4 scale2 = Vector4.one;
				Quaternion rotation2 = Quaternion.identity;
				Oni.InitializeFrame(oniSolver, ref translation2, ref scale2, ref rotation2);
			}
		}

		public bool AddActor(ObiActor actor, int numParticles)
		{
			if (particleToActor == null || actor == null)
			{
				return false;
			}
			int[] array = new int[numParticles];
			int num = 0;
			for (int i = 0; i < maxParticles; i++)
			{
				if (num >= numParticles)
				{
					break;
				}
				if (particleToActor[i] == null)
				{
					array[num] = i;
					num++;
				}
			}
			if (num < numParticles)
			{
				return false;
			}
			allocatedParticleCount += numParticles;
			for (int j = 0; j < numParticles; j++)
			{
				particleToActor[array[j]] = new ParticleInActor(actor, j);
			}
			actor.particleIndices = array;
			actors.Add(actor);
			UpdateActiveParticles();
			UpdateEmitterMaterials();
			return true;
		}

		public int RemoveActor(ObiActor actor)
		{
			if (particleToActor == null || actor == null)
			{
				return -1;
			}
			int num = actors.IndexOf(actor);
			if (num > -1)
			{
				allocatedParticleCount -= actor.particleIndices.Length;
				for (int i = 0; i < actor.particleIndices.Length; i++)
				{
					particleToActor[actor.particleIndices[i]] = null;
				}
				actors.RemoveAt(num);
				UpdateActiveParticles();
				UpdateEmitterMaterials();
			}
			return num;
		}

		public void UpdateParameters()
		{
			Oni.SetSolverParameters(oniSolver, ref parameters);
			Oni.SetConstraintGroupParameters(oniSolver, 3, ref distanceConstraintParameters);
			Oni.SetConstraintGroupParameters(oniSolver, 2, ref bendingConstraintParameters);
			Oni.SetConstraintGroupParameters(oniSolver, 5, ref particleCollisionConstraintParameters);
			Oni.SetConstraintGroupParameters(oniSolver, 7, ref collisionConstraintParameters);
			Oni.SetConstraintGroupParameters(oniSolver, 6, ref densityConstraintParameters);
			Oni.SetConstraintGroupParameters(oniSolver, 8, ref skinConstraintParameters);
			Oni.SetConstraintGroupParameters(oniSolver, 1, ref volumeConstraintParameters);
			Oni.SetConstraintGroupParameters(oniSolver, 11, ref shapeMatchingConstraintParameters);
			Oni.SetConstraintGroupParameters(oniSolver, 0, ref tetherConstraintParameters);
			Oni.SetConstraintGroupParameters(oniSolver, 4, ref pinConstraintParameters);
			Oni.SetConstraintGroupParameters(oniSolver, 10, ref stitchConstraintParameters);
		}

		public void UpdateActiveParticles()
		{
			int num = 0;
			for (int i = 0; i < actors.Count; i++)
			{
				ObiActor obiActor = actors[i];
				if (!obiActor.isActiveAndEnabled)
				{
					continue;
				}
				for (int j = 0; j < obiActor.particleIndices.Length; j++)
				{
					if (obiActor.active[j])
					{
						activeParticles[num] = obiActor.particleIndices[j];
						num++;
					}
				}
			}
			Oni.SetActiveParticles(oniSolver, activeParticles, num);
		}

		public void UpdateEmitterMaterials()
		{
			emitterMaterials = new List<ObiEmitterMaterial> { defaultFluidMaterial };
			foreach (ObiActor actor in actors)
			{
				ObiEmitter obiEmitter = actor as ObiEmitter;
				if (obiEmitter == null)
				{
					continue;
				}
				int num = 0;
				if (obiEmitter.EmitterMaterial != null)
				{
					num = emitterMaterials.IndexOf(obiEmitter.EmitterMaterial);
					if (num < 0)
					{
						num = emitterMaterials.Count;
						emitterMaterials.Add(obiEmitter.EmitterMaterial);
						obiEmitter.EmitterMaterial.OnChangesMade += emitterMaterial_OnChangesMade;
					}
				}
				for (int i = 0; i < actor.particleIndices.Length; i++)
				{
					fluidMaterialIndices[actor.particleIndices[i]] = num;
				}
			}
			Oni.SetFluidMaterialIndices(oniSolver, fluidMaterialIndices, fluidMaterialIndices.Length, 0);
			Oni.FluidMaterial[] array = emitterMaterials.ConvertAll((ObiEmitterMaterial a) => a.GetEquivalentOniMaterial(parameters.mode)).ToArray();
			Oni.SetFluidMaterials(oniSolver, array, array.Length, 0);
		}

		private void emitterMaterial_OnChangesMade(object sender, ObiEmitterMaterial.MaterialChangeEventArgs e)
		{
			ObiEmitterMaterial obiEmitterMaterial = sender as ObiEmitterMaterial;
			int num = emitterMaterials.IndexOf(obiEmitterMaterial);
			if (num >= 0)
			{
				Oni.SetFluidMaterials(oniSolver, new Oni.FluidMaterial[1] { obiEmitterMaterial.GetEquivalentOniMaterial(parameters.mode) }, 1, num);
			}
		}

		public void AccumulateSimulationTime(float dt)
		{
			Oni.AddSimulationTime(oniSolver, dt);
		}

		public void ResetSimulationTime()
		{
			Oni.ResetSimulationTime(oniSolver);
		}

		public void SimulateStep(float stepTime)
		{
			UpdateTransformFrame(stepTime);
			if (!IsUpdating)
			{
				return;
			}
			Oni.ClearDiffuseParticles(oniSolver);
			if (this.OnStepBegin != null)
			{
				this.OnStepBegin(this, null);
			}
			foreach (ObiActor actor in actors)
			{
				actor.OnSolverStepBegin();
			}
			Oni.UpdateSkeletalAnimation(oniSolver);
			if (this.OnFixedParticlesUpdated != null)
			{
				this.OnFixedParticlesUpdated(this, null);
			}
			Oni.UpdateSolver(oniSolver, substeps, stepTime / (float)substeps);
			WaitForAllSolvers();
		}

		public void EndFrame(float stepTime)
		{
			foreach (ObiActor actor in actors)
			{
				actor.OnSolverPreInterpolation();
			}
			if (this.OnBeforePositionInterpolation != null)
			{
				this.OnBeforePositionInterpolation(this, null);
			}
			Oni.ApplyPositionInterpolation(oniSolver, stepTime);
			if (renderablePositionsClients > 0)
			{
				Oni.GetParticleAnisotropies(oniSolver, anisotropies, anisotropies.Length, 0);
				Oni.GetRenderableParticlePositions(oniSolver, renderablePositions, renderablePositions.Length, 0);
			}
			TriggerFluidUpdateEvents();
			if (this.OnBeforeActorsFrameEnd != null)
			{
				this.OnBeforeActorsFrameEnd(this, null);
			}
			UpdateVisibility();
			foreach (ObiActor actor2 in actors)
			{
				actor2.OnSolverFrameEnd();
			}
		}

		private void TriggerFluidUpdateEvents()
		{
			int constraintCount = Oni.GetConstraintCount(oniSolver, 6);
			if (this.OnFluidUpdated != null)
			{
				fluidArgs.indices.SetCount(constraintCount);
				fluidArgs.vorticities.SetCount(maxParticles);
				fluidArgs.densities.SetCount(maxParticles);
				if (constraintCount > 0)
				{
					Oni.GetActiveConstraintIndices(oniSolver, fluidArgs.indices.Data, constraintCount, 6);
					Oni.GetParticleVorticities(oniSolver, fluidArgs.vorticities.Data, maxParticles, 0);
					Oni.GetParticleDensities(oniSolver, fluidArgs.densities.Data, maxParticles, 0);
				}
				this.OnFluidUpdated(this, fluidArgs);
			}
		}

		private void TriggerCollisionEvents()
		{
			int constraintCount = Oni.GetConstraintCount(oniSolver, 7);
			if (this.OnCollision != null)
			{
				collisionArgs.contacts.SetCount(constraintCount);
				if (constraintCount > 0)
				{
					Oni.GetCollisionContacts(oniSolver, collisionArgs.contacts.Data, constraintCount);
				}
				this.OnCollision(this, collisionArgs);
			}
		}

		private bool AreBoundsValid(Bounds bounds)
		{
			if (!float.IsNaN(bounds.center.x) && !float.IsInfinity(bounds.center.x) && !float.IsNaN(bounds.center.y) && !float.IsInfinity(bounds.center.y) && !float.IsNaN(bounds.center.z))
			{
				return !float.IsInfinity(bounds.center.z);
			}
			return false;
		}

		public void UpdateColliders()
		{
			if (ObiSolver.OnUpdateColliders != null)
			{
				ObiSolver.OnUpdateColliders(this, null);
			}
			if (ObiSolver.OnAfterUpdateColliders != null)
			{
				ObiSolver.OnAfterUpdateColliders(this, null);
			}
		}

		public void UpdateRigidbodies()
		{
			if (ObiSolver.OnUpdateRigidbodies != null)
			{
				ObiSolver.OnUpdateRigidbodies(this, null);
			}
		}

		public void WaitForAllSolvers()
		{
			switch (simulationOrder)
			{
			case SimulationOrder.FixedUpdate:
				if (fixedUpdateArbiter.WaitForAllSolvers())
				{
					UpdateRigidbodies();
				}
				break;
			case SimulationOrder.AfterFixedUpdate:
				afterFixedUpdateArbiter.WaitForAllSolvers();
				break;
			case SimulationOrder.LateUpdate:
				lateUpdateArbiter.WaitForAllSolvers();
				break;
			}
		}

		public void UpdateVisibility()
		{
			Vector3 min = Vector3.zero;
			Vector3 max = Vector3.zero;
			Oni.GetBounds(oniSolver, ref min, ref max);
			bounds.SetMinMax(min, max);
			if (AreBoundsValid(bounds))
			{
				Camera[] allCameras = Camera.allCameras;
				for (int i = 0; i < allCameras.Length; i++)
				{
					if (!GeometryUtility.TestPlanesAABB(GeometryUtility.CalculateFrustumPlanes(allCameras[i]), bounds))
					{
						continue;
					}
					if (isVisible)
					{
						return;
					}
					isVisible = true;
					{
						foreach (ObiActor actor in actors)
						{
							actor.OnSolverVisibilityChanged(isVisible);
						}
						return;
					}
				}
			}
			if (!isVisible)
			{
				return;
			}
			isVisible = false;
			foreach (ObiActor actor2 in actors)
			{
				actor2.OnSolverVisibilityChanged(isVisible);
			}
		}

		private void Update()
		{
			if (!UnityEngine.Application.isPlaying)
			{
				return;
			}
			if (this.OnFrameBegin != null)
			{
				this.OnFrameBegin(this, null);
			}
			foreach (ObiActor actor in actors)
			{
				actor.OnSolverFrameBegin();
			}
			if (IsUpdating && simulationOrder != SimulationOrder.LateUpdate)
			{
				AccumulateSimulationTime(Time.deltaTime);
			}
		}

		private IEnumerator RunLateFixedUpdate()
		{
			while (true)
			{
				yield return new WaitForFixedUpdate();
				firstFixedUpdate = true;
				if (UnityEngine.Application.isPlaying && simulationOrder == SimulationOrder.AfterFixedUpdate)
				{
					SimulateStep(Time.fixedDeltaTime);
				}
			}
		}

		private void FixedUpdate()
		{
			if (!UnityEngine.Application.isPlaying)
			{
				return;
			}
			if (firstFixedUpdate)
			{
				firstFixedUpdate = false;
				UpdateColliders();
				if (ObiProfiler.Instance != null)
				{
					ObiProfiler.Instance.StartStep();
				}
			}
			if (simulationOrder == SimulationOrder.FixedUpdate)
			{
				SimulateStep(Time.fixedDeltaTime);
			}
		}

		public void AllSolversStepEnd()
		{
			TriggerCollisionEvents();
			foreach (ObiActor actor in actors)
			{
				actor.OnSolverStepEnd();
			}
			if (this.OnStepEnd != null)
			{
				this.OnStepEnd(this, null);
			}
		}

		private void LateUpdate()
		{
			float num = 0f;
			if (UnityEngine.Application.isPlaying && simulationOrder == SimulationOrder.LateUpdate)
			{
				if (Time.deltaTime > 0f)
				{
					num = (smoothDelta = Mathf.Lerp(Time.deltaTime, smoothDelta, 0.95f));
					AccumulateSimulationTime(num);
					SimulateStep(num);
				}
				else
				{
					num = 0f;
				}
			}
			if (UnityEngine.Application.isPlaying)
			{
				EndFrame((simulationOrder == SimulationOrder.LateUpdate) ? num : Time.fixedDeltaTime);
				if (this.OnFrameEnd != null)
				{
					this.OnFrameEnd(this, null);
				}
			}
		}
	}
	public class ObiSolverData
	{
		public ParticleData particleData;

		public ObiSolverData(ParticleData particleData)
		{
			this.particleData = particleData;
		}
	}
	public class ObiAmbientForceZone : ObiExternalForce
	{
		public override void ApplyForcesToActor(ObiActor actor)
		{
			Vector4 force = ((!actor.Solver.simulateInLocalSpace) ? base.transform.localToWorldMatrix : (actor.Solver.transform.worldToLocalMatrix * base.transform.localToWorldMatrix)).MultiplyVector(Vector3.forward * (intensity + GetTurbulence(turbulence)));
			if (actor.UsesCustomExternalForces)
			{
				Oni.AddParticleWind(actor.Solver.OniSolver, ref force, actor.particleIndices, actor.particleIndices.Length);
			}
			else
			{
				Oni.AddParticleExternalForce(actor.Solver.OniSolver, ref force, actor.particleIndices, actor.particleIndices.Length);
			}
		}

		public void OnDrawGizmosSelected()
		{
			Gizmos.matrix = base.transform.localToWorldMatrix;
			Gizmos.color = new Color(0f, 0.7f, 1f, 1f);
			ObiUtils.DrawArrowGizmo(0.5f + GetTurbulence(1f), 0.2f, 0.3f, 0.2f);
		}
	}
	public abstract class ObiExternalForce : MonoBehaviour
	{
		public float intensity;

		public float turbulence;

		public float turbulenceFrequency = 1f;

		public float turbulenceSeed;

		public ObiSolver[] affectedSolvers;

		public void FixedUpdate()
		{
			ObiSolver[] array = affectedSolvers;
			foreach (ObiSolver obiSolver in array)
			{
				if (!(obiSolver != null))
				{
					continue;
				}
				foreach (ObiActor actor in obiSolver.actors)
				{
					if (actor != null)
					{
						ApplyForcesToActor(actor);
					}
				}
			}
		}

		protected float GetTurbulence(float turbulenceIntensity)
		{
			return Mathf.PerlinNoise(Time.fixedTime * turbulenceFrequency, turbulenceSeed) * turbulenceIntensity;
		}

		public abstract void ApplyForcesToActor(ObiActor actor);
	}
	public class ObiSphericalForceZone : ObiExternalForce
	{
		public float radius = 5f;

		public bool radial = true;

		public void OnEnable()
		{
			ObiSolver[] array = affectedSolvers;
			for (int i = 0; i < array.Length; i++)
			{
				array[i].RequireRenderablePositions();
			}
		}

		public void OnDisable()
		{
			ObiSolver[] array = affectedSolvers;
			for (int i = 0; i < array.Length; i++)
			{
				array[i].RelinquishRenderablePositions();
			}
		}

		public override void ApplyForcesToActor(ObiActor actor)
		{
			Vector4 vector = ((!actor.Solver.simulateInLocalSpace) ? base.transform.localToWorldMatrix : (actor.Solver.transform.worldToLocalMatrix * base.transform.localToWorldMatrix)).MultiplyVector(Vector3.forward * (intensity + GetTurbulence(turbulence)));
			float num = radius * radius;
			Vector4[] array = new Vector4[actor.particleIndices.Length];
			Vector4 vector2 = new Vector4(base.transform.position.x, base.transform.position.y, base.transform.position.z);
			for (int i = 0; i < array.Length; i++)
			{
				Vector4 vector3 = actor.Solver.renderablePositions[actor.particleIndices[i]] - vector2;
				float sqrMagnitude = vector3.sqrMagnitude;
				float num2 = Mathf.Clamp01((num - sqrMagnitude) / num);
				if (radial)
				{
					array[i] = vector3 / (Mathf.Sqrt(sqrMagnitude) + float.Epsilon) * num2 * intensity;
				}
				else
				{
					array[i] = vector * num2;
				}
			}
			if (actor.UsesCustomExternalForces)
			{
				Oni.AddParticleWinds(actor.Solver.OniSolver, array, actor.particleIndices, actor.particleIndices.Length);
			}
			else
			{
				Oni.AddParticleExternalForces(actor.Solver.OniSolver, array, actor.particleIndices, actor.particleIndices.Length);
			}
		}

		public void OnDrawGizmosSelected()
		{
			Gizmos.matrix = base.transform.localToWorldMatrix;
			Gizmos.color = new Color(0f, 0.7f, 1f, 1f);
			Gizmos.DrawWireSphere(Vector3.zero, radius);
			float num = GetTurbulence(1f);
			if (!radial)
			{
				ObiUtils.DrawArrowGizmo(radius + num, radius * 0.2f, radius * 0.3f, radius * 0.2f);
				return;
			}
			Gizmos.DrawLine(new Vector3(0f, 0f, (0f - radius) * 0.5f) * num, new Vector3(0f, 0f, radius * 0.5f) * num);
			Gizmos.DrawLine(new Vector3(0f, (0f - radius) * 0.5f, 0f) * num, new Vector3(0f, radius * 0.5f, 0f) * num);
			Gizmos.DrawLine(new Vector3((0f - radius) * 0.5f, 0f, 0f) * num, new Vector3(radius * 0.5f, 0f, 0f) * num);
		}
	}
	[ExecuteInEditMode]
	public class ObiBezierCurve : ObiCurve
	{
		public enum BezierCPMode
		{
			Free,
			Aligned,
			Mirrored
		}

		[HideInInspector]
		public List<BezierCPMode> controlPointModes;

		[HideInInspector]
		public BezierCPMode lastOpenCPMode;

		[HideInInspector]
		public Vector3 lastOpenCP;

		public override void Awake()
		{
			minPoints = 4;
			unusedPoints = 2;
			pointStride = 3;
			base.Awake();
			if (controlPointModes == null)
			{
				controlPointModes = new List<BezierCPMode>
				{
					BezierCPMode.Free,
					BezierCPMode.Free
				};
			}
		}

		protected override void SetClosed(bool closed)
		{
			if (base.closed != closed)
			{
				if (!base.closed && closed)
				{
					lastOpenCP = controlPoints[0];
					lastOpenCPMode = controlPointModes[0];
					controlPoints[0] = controlPoints[controlPoints.Count - 1];
					controlPointModes[0] = controlPointModes[controlPointModes.Count - 1];
				}
				else
				{
					controlPoints[0] = lastOpenCP;
					controlPointModes[0] = lastOpenCPMode;
				}
				base.closed = closed;
				EnforceMode(0);
			}
		}

		public override int GetNumSpans()
		{
			return (controlPoints.Count + (controlPoints.Count - 4) / 3) / 4;
		}

		public bool IsHandle(int index)
		{
			return index % 3 != 0;
		}

		public int GetHandleControlPointIndex(int index)
		{
			if (index < 0 || index >= controlPoints.Count)
			{
				return -1;
			}
			if (index % 3 == 1)
			{
				return index - 1;
			}
			if (index % 3 == 2)
			{
				return index + 1;
			}
			return index;
		}

		public List<int> GetHandleIndicesForControlPoint(int index)
		{
			List<int> list = new List<int>();
			if (index < 0 || index >= controlPoints.Count)
			{
				return list;
			}
			if (!IsHandle(index))
			{
				if (closed)
				{
					if (index == 0)
					{
						list.Add(1);
						list.Add(controlPoints.Count - 2);
					}
					else if (index == controlPoints.Count - 1)
					{
						list.Add(1);
						list.Add(index - 1);
					}
					else
					{
						list.Add(index + 1);
						list.Add(index - 1);
					}
				}
				else
				{
					if (index > 0)
					{
						list.Add(index - 1);
					}
					if (index + 1 < controlPoints.Count)
					{
						list.Add(index + 1);
					}
				}
			}
			return list;
		}

		public override void DisplaceControlPoint(int index, Vector3 delta)
		{
			if (index < 0 || index >= controlPoints.Count)
			{
				return;
			}
			if (!IsHandle(index))
			{
				if (closed)
				{
					if (index == 0)
					{
						controlPoints[1] += delta;
						controlPoints[controlPoints.Count - 2] += delta;
						controlPoints[controlPoints.Count - 1] += delta;
					}
					else if (index == controlPoints.Count - 1)
					{
						controlPoints[0] += delta;
						controlPoints[1] += delta;
						controlPoints[index - 1] += delta;
					}
					else
					{
						controlPoints[index - 1] += delta;
						controlPoints[index + 1] += delta;
					}
				}
				else
				{
					if (index > 0)
					{
						controlPoints[index - 1] += delta;
					}
					if (index + 1 < controlPoints.Count)
					{
						controlPoints[index + 1] += delta;
					}
				}
			}
			controlPoints[index] += delta;
			EnforceMode(index);
		}

		public override int GetSpanControlPointForMu(float mu, out float spanMu)
		{
			int numSpans = GetNumSpans();
			spanMu = mu * (float)numSpans;
			int num = ((mu >= 1f) ? (numSpans - 1) : ((int)spanMu));
			spanMu -= num;
			return num * 3;
		}

		public BezierCPMode GetControlPointMode(int index)
		{
			int index2 = (index + 1) / 3;
			return controlPointModes[index2];
		}

		public void SetControlPointMode(int index, BezierCPMode mode)
		{
			int num = (index + 1) / 3;
			controlPointModes[num] = mode;
			if (closed)
			{
				if (num == 0)
				{
					controlPointModes[controlPointModes.Count - 1] = mode;
				}
				else if (num == controlPointModes.Count - 1)
				{
					controlPointModes[0] = mode;
				}
			}
			EnforceMode(index);
		}

		public void EnforceMode(int index)
		{
			int num = (index + 1) / 3;
			BezierCPMode bezierCPMode = controlPointModes[num];
			if (bezierCPMode == BezierCPMode.Free || (!closed && (num == 0 || num == controlPointModes.Count - 1)))
			{
				return;
			}
			int num2 = num * 3;
			int num3;
			int num4;
			if (index <= num2)
			{
				num3 = num2 - 1;
				if (num3 < 0)
				{
					num3 = controlPoints.Count - 2;
				}
				num4 = num2 + 1;
				if (num4 >= controlPoints.Count)
				{
					num4 = 1;
				}
			}
			else
			{
				num3 = num2 + 1;
				if (num3 >= controlPoints.Count)
				{
					num3 = 1;
				}
				num4 = num2 - 1;
				if (num4 < 0)
				{
					num4 = controlPoints.Count - 2;
				}
			}
			Vector3 vector = controlPoints[num2];
			Vector3 vector2 = vector - controlPoints[num3];
			if (bezierCPMode == BezierCPMode.Aligned)
			{
				vector2 = vector2.normalized * Vector3.Distance(vector, controlPoints[num4]);
			}
			controlPoints[num4] = vector + vector2;
		}

		public void AddSpan()
		{
			int index = controlPoints.Count - 1;
			Vector3 vector = controlPoints[index];
			controlPoints.Add(vector + Vector3.right * 0.5f);
			controlPoints.Add(vector + Vector3.right);
			controlPoints.Add(vector + Vector3.right * 1.5f);
			controlPointModes.Add(BezierCPMode.Free);
			EnforceMode(index);
			if (closed)
			{
				controlPoints[controlPoints.Count - 1] = controlPoints[0];
				controlPointModes[controlPointModes.Count - 1] = controlPointModes[0];
				EnforceMode(0);
			}
		}

		public void RemoveCurvePoint(int curvePoint)
		{
			if (controlPoints.Count <= 4)
			{
				return;
			}
			int num = Mathf.Max(0, curvePoint * 3 - 1);
			int count = 3;
			if (num == controlPoints.Count - 2)
			{
				num--;
			}
			controlPoints.RemoveRange(num, count);
			controlPointModes.RemoveAt(curvePoint);
			if (closed)
			{
				if (num == controlPoints.Count)
				{
					controlPoints[0] = controlPoints[controlPoints.Count - 1];
					controlPointModes[0] = controlPointModes[controlPointModes.Count - 1];
				}
				else if (num == 0)
				{
					controlPoints[controlPoints.Count - 1] = controlPoints[0];
					controlPointModes[controlPointModes.Count - 1] = controlPointModes[0];
				}
			}
			EnforceMode(num);
		}

		protected override float Evaluate1D(float y0, float y1, float y2, float y3, float mu)
		{
			float num = 1f - mu;
			return num * num * num * y0 + 3f * num * num * mu * y1 + 3f * num * mu * mu * y2 + mu * mu * mu * y3;
		}

		protected override float EvaluateFirstDerivative1D(float y0, float y1, float y2, float y3, float mu)
		{
			float num = 1f - mu;
			return 3f * num * num * (y1 - y0) + 6f * num * mu * (y2 - y1) + 3f * mu * mu * (y3 - y2);
		}

		protected override float EvaluateSecondDerivative1D(float y0, float y1, float y2, float y3, float mu)
		{
			float num = 1f - mu;
			return 3f * num * num * (y1 - y0) + 6f * num * mu * (y2 - y1) + 3f * mu * mu * (y3 - y2);
		}
	}
	[ExecuteInEditMode]
	public class ObiCatmullRomCurve : ObiCurve
	{
		[HideInInspector]
		public Vector3 lastOpenCP0;

		[HideInInspector]
		public Vector3 lastOpenCP1;

		[HideInInspector]
		public Vector3 lastOpenCPN;

		public override void Awake()
		{
			minPoints = 4;
			unusedPoints = 2;
			base.Awake();
		}

		protected override void SetClosed(bool closed)
		{
			if (base.closed != closed)
			{
				if (!base.closed && closed)
				{
					lastOpenCP0 = controlPoints[0];
					lastOpenCP1 = controlPoints[1];
					lastOpenCPN = controlPoints[controlPoints.Count - 1];
					controlPoints[0] = controlPoints[controlPoints.Count - 3];
					controlPoints[1] = controlPoints[controlPoints.Count - 2];
					controlPoints[controlPoints.Count - 1] = controlPoints[2];
				}
				else
				{
					controlPoints[0] = lastOpenCP0;
					controlPoints[1] = lastOpenCP1;
					controlPoints[controlPoints.Count - 1] = lastOpenCPN;
				}
				base.closed = closed;
			}
		}

		public override void DisplaceControlPoint(int index, Vector3 delta)
		{
			if (index < 0 || index >= controlPoints.Count)
			{
				return;
			}
			if (closed)
			{
				if (index == 0 || index == controlPoints.Count - 3)
				{
					controlPoints[0] += delta;
					controlPoints[controlPoints.Count - 3] += delta;
				}
				else if (index == 1 || index == controlPoints.Count - 2)
				{
					controlPoints[1] += delta;
					controlPoints[controlPoints.Count - 2] += delta;
				}
				else if (index == 2 || index == controlPoints.Count - 1)
				{
					controlPoints[2] += delta;
					controlPoints[controlPoints.Count - 1] += delta;
				}
				else
				{
					controlPoints[index] += delta;
				}
			}
			else
			{
				controlPoints[index] += delta;
			}
		}

		public override int GetNumSpans()
		{
			return controlPoints.Count - unusedPoints - 1;
		}

		public override int GetSpanControlPointForMu(float mu, out float spanMu)
		{
			int numSpans = GetNumSpans();
			spanMu = mu * (float)numSpans;
			int num = ((mu >= 1f) ? (numSpans - 1) : ((int)spanMu));
			spanMu -= num;
			return num;
		}

		protected override float Evaluate1D(float y0, float y1, float y2, float y3, float mu)
		{
			float num = mu * mu;
			float num2 = -0.5f * y0 + 1.5f * y1 - 1.5f * y2 + 0.5f * y3;
			float num3 = y0 - 2.5f * y1 + 2f * y2 - 0.5f * y3;
			float num4 = -0.5f * y0 + 0.5f * y2;
			return num2 * mu * num + num3 * num + num4 * mu + y1;
		}

		protected override float EvaluateFirstDerivative1D(float y0, float y1, float y2, float y3, float mu)
		{
			float num = mu * mu;
			float num2 = -0.5f * y0 + 1.5f * y1 - 1.5f * y2 + 0.5f * y3;
			float num3 = y0 - 2.5f * y1 + 2f * y2 - 0.5f * y3;
			float num4 = -0.5f * y0 + 0.5f * y2;
			return 3f * num2 * num + 2f * num3 * mu + num4;
		}

		protected override float EvaluateSecondDerivative1D(float y0, float y1, float y2, float y3, float mu)
		{
			float num = -0.5f * y0 + 1.5f * y1 - 1.5f * y2 + 0.5f * y3;
			float num2 = y0 - 2.5f * y1 + 2f * y2 - 0.5f * y3;
			return 6f * num * mu + 2f * num2;
		}
	}
	[ExecuteInEditMode]
	public abstract class ObiCurve : MonoBehaviour
	{
		protected int arcLenghtSamples = 5;

		protected int minPoints = 4;

		protected int unusedPoints = 2;

		protected int pointStride = 1;

		[HideInInspector]
		public List<Vector3> controlPoints;

		[HideInInspector]
		[SerializeField]
		protected List<float> arcLengthTable;

		[HideInInspector]
		[SerializeField]
		protected float totalSplineLenght;

		[HideInInspector]
		[SerializeField]
		protected bool closed;

		public bool Closed
		{
			get
			{
				return closed;
			}
			set
			{
				SetClosed(value);
			}
		}

		public float Length => totalSplineLenght;

		public virtual void Awake()
		{
			if (controlPoints == null)
			{
				controlPoints = new List<Vector3>
				{
					Vector3.left,
					Vector3.zero,
					Vector3.right,
					Vector3.right * 2f
				};
			}
			if (arcLengthTable == null)
			{
				arcLengthTable = new List<float>();
				RecalculateSplineLenght(1E-05f, 7);
			}
		}

		protected abstract void SetClosed(bool closed);

		public abstract void DisplaceControlPoint(int index, Vector3 delta);

		public abstract int GetNumSpans();

		public float RecalculateSplineLenght(float acc, int maxevals)
		{
			totalSplineLenght = 0f;
			arcLengthTable.Clear();
			arcLengthTable.Add(0f);
			float num = 1f / (float)(arcLenghtSamples + 1);
			if (controlPoints.Count >= minPoints)
			{
				for (int i = 1; i < controlPoints.Count - unusedPoints; i += pointStride)
				{
					Vector3 vector = base.transform.TransformPoint(controlPoints[i - 1]);
					Vector3 vector2 = base.transform.TransformPoint(controlPoints[i]);
					Vector3 vector3 = base.transform.TransformPoint(controlPoints[i + 1]);
					Vector3 vector4 = base.transform.TransformPoint(controlPoints[i + 2]);
					for (int j = 0; j <= Mathf.Max(1, arcLenghtSamples); j++)
					{
						float num2 = (float)j * num;
						float num3 = (float)(j + 1) * num;
						float num4 = GaussLobattoIntegrationStep(vector, vector2, vector3, vector4, num2, num3, EvaluateFirstDerivative3D(vector, vector2, vector3, vector4, num2).magnitude, EvaluateFirstDerivative3D(vector, vector2, vector3, vector4, num3).magnitude, 0, maxevals, acc);
						totalSplineLenght += num4;
						arcLengthTable.Add(totalSplineLenght);
					}
				}
			}
			else
			{
				UnityEngine.Debug.LogWarning("Catmull-Rom spline needs at least 4 control points to be defined.");
			}
			return totalSplineLenght;
		}

		private float GaussLobattoIntegrationStep(Vector3 p1, Vector3 p2, Vector3 p3, Vector3 p4, float a, float b, float fa, float fb, int nevals, int maxevals, float acc)
		{
			if (nevals >= maxevals)
			{
				return 0f;
			}
			float num = Mathf.Sqrt(2f / 3f);
			float num2 = 1f / Mathf.Sqrt(5f);
			float num3 = (b - a) / 2f;
			float num4 = (a + b) / 2f;
			float num5 = num4 - num * num3;
			float num6 = num4 - num2 * num3;
			float num7 = num4 + num2 * num3;
			float num8 = num4 + num * num3;
			nevals += 5;
			float magnitude = EvaluateFirstDerivative3D(p1, p2, p3, p4, num5).magnitude;
			float magnitude2 = EvaluateFirstDerivative3D(p1, p2, p3, p4, num6).magnitude;
			float magnitude3 = EvaluateFirstDerivative3D(p1, p2, p3, p4, num4).magnitude;
			float magnitude4 = EvaluateFirstDerivative3D(p1, p2, p3, p4, num7).magnitude;
			float magnitude5 = EvaluateFirstDerivative3D(p1, p2, p3, p4, num8).magnitude;
			float num9 = num3 / 6f * (fa + fb + 5f * (magnitude2 + magnitude4));
			float num10 = num3 / 1470f * (77f * (fa + fb) + 432f * (magnitude + magnitude5) + 625f * (magnitude2 + magnitude4) + 672f * magnitude3);
			if (num9 - num10 < acc || num5 <= a || b <= num8)
			{
				if (!(num4 > a) || !(b > num4))
				{
					UnityEngine.Debug.LogError("Spline integration reached an interval with no more machine numbers");
				}
				return num10;
			}
			return GaussLobattoIntegrationStep(p1, p2, p3, p4, a, num5, fa, magnitude, nevals, maxevals, acc) + GaussLobattoIntegrationStep(p1, p2, p3, p4, num5, num6, magnitude, magnitude2, nevals, maxevals, acc) + GaussLobattoIntegrationStep(p1, p2, p3, p4, num6, num4, magnitude2, magnitude3, nevals, maxevals, acc) + GaussLobattoIntegrationStep(p1, p2, p3, p4, num4, num7, magnitude3, magnitude4, nevals, maxevals, acc) + GaussLobattoIntegrationStep(p1, p2, p3, p4, num7, num8, magnitude4, magnitude5, nevals, maxevals, acc) + GaussLobattoIntegrationStep(p1, p2, p3, p4, num8, b, magnitude5, fb, nevals, maxevals, acc);
		}

		public float GetMuAtLenght(float length)
		{
			if (length <= 0f)
			{
				return 0f;
			}
			if (length >= totalSplineLenght)
			{
				return 1f;
			}
			int i;
			for (i = 1; i < arcLengthTable.Count && !(length < arcLengthTable[i]); i++)
			{
			}
			float num = (float)(i - 1) / (float)(arcLengthTable.Count - 1);
			float num2 = (float)i / (float)(arcLengthTable.Count - 1);
			float num3 = (length - arcLengthTable[i - 1]) / (arcLengthTable[i] - arcLengthTable[i - 1]);
			return num + (num2 - num) * num3;
		}

		public abstract int GetSpanControlPointForMu(float mu, out float spanMu);

		public Vector3 GetPositionAt(float mu)
		{
			if (controlPoints.Count >= minPoints)
			{
				if (!float.IsNaN(mu))
				{
					float spanMu;
					int spanControlPointForMu = GetSpanControlPointForMu(mu, out spanMu);
					return Evaluate3D(controlPoints[spanControlPointForMu], controlPoints[spanControlPointForMu + 1], controlPoints[spanControlPointForMu + 2], controlPoints[spanControlPointForMu + 3], spanMu);
				}
				return controlPoints[0];
			}
			if (controlPoints.Count >= 2)
			{
				if (!float.IsNaN(mu))
				{
					return Vector3.Lerp(controlPoints[0], controlPoints[controlPoints.Count - 1], mu);
				}
				return controlPoints[0];
			}
			if (controlPoints.Count == 1)
			{
				return controlPoints[0];
			}
			throw new InvalidOperationException("Cannot get position in Catmull-Rom spline because it has zero control points.");
		}

		public Vector3 GetFirstDerivativeAt(float mu)
		{
			if (controlPoints.Count >= minPoints)
			{
				if (!float.IsNaN(mu))
				{
					float spanMu;
					int spanControlPointForMu = GetSpanControlPointForMu(mu, out spanMu);
					return EvaluateFirstDerivative3D(controlPoints[spanControlPointForMu], controlPoints[spanControlPointForMu + 1], controlPoints[spanControlPointForMu + 2], controlPoints[spanControlPointForMu + 3], spanMu);
				}
				return controlPoints[controlPoints.Count - 1] - controlPoints[0];
			}
			if (controlPoints.Count >= 2)
			{
				return controlPoints[controlPoints.Count - 1] - controlPoints[0];
			}
			throw new InvalidOperationException("Cannot get tangent in Catmull-Rom spline because it has zero or one control points.");
		}

		public Vector3 GetSecondDerivativeAt(float mu)
		{
			if (controlPoints.Count >= minPoints)
			{
				if (!float.IsNaN(mu))
				{
					float spanMu;
					int spanControlPointForMu = GetSpanControlPointForMu(mu, out spanMu);
					return EvaluateSecondDerivative3D(controlPoints[spanControlPointForMu], controlPoints[spanControlPointForMu + 1], controlPoints[spanControlPointForMu + 2], controlPoints[spanControlPointForMu + 3], spanMu);
				}
				return Vector3.zero;
			}
			return Vector3.zero;
		}

		private Vector3 Evaluate3D(Vector3 y0, Vector3 y1, Vector3 y2, Vector3 y3, float mu)
		{
			return new Vector3(Evaluate1D(y0.x, y1.x, y2.x, y3.x, mu), Evaluate1D(y0.y, y1.y, y2.y, y3.y, mu), Evaluate1D(y0.z, y1.z, y2.z, y3.z, mu));
		}

		protected abstract float Evaluate1D(float y0, float y1, float y2, float y3, float mu);

		private Vector3 EvaluateFirstDerivative3D(Vector3 y0, Vector3 y1, Vector3 y2, Vector3 y3, float mu)
		{
			return new Vector3(EvaluateFirstDerivative1D(y0.x, y1.x, y2.x, y3.x, mu), EvaluateFirstDerivative1D(y0.y, y1.y, y2.y, y3.y, mu), EvaluateFirstDerivative1D(y0.z, y1.z, y2.z, y3.z, mu));
		}

		protected abstract float EvaluateFirstDerivative1D(float y0, float y1, float y2, float y3, float mu);

		private Vector3 EvaluateSecondDerivative3D(Vector3 y0, Vector3 y1, Vector3 y2, Vector3 y3, float mu)
		{
			return new Vector3(EvaluateSecondDerivative1D(y0.x, y1.x, y2.x, y3.x, mu), EvaluateSecondDerivative1D(y0.y, y1.y, y2.y, y3.y, mu), EvaluateSecondDerivative1D(y0.z, y1.z, y2.z, y3.z, mu));
		}

		protected abstract float EvaluateSecondDerivative1D(float y0, float y1, float y2, float y3, float mu);
	}
	[ExecuteInEditMode]
	[RequireComponent(typeof(ObiSolver))]
	public class ObiParticleBaker : MonoBehaviour
	{
		public ObiParticleCache cache;

		public float playhead;

		public int frameSkip = 8;

		public int fixedBakeFramerate = 60;

		public bool interpolate = true;

		public bool loopPlayback = true;

		public bool bakeOnAwake;

		public bool playOnAwake;

		private bool baking;

		private bool playing;

		private bool paused;

		private int framesToSkip;

		private ObiSolver solver;

		private ObiParticleCache.Frame frame = new ObiParticleCache.Frame();

		public bool Baking
		{
			get
			{
				return baking;
			}
			set
			{
				baking = value;
				if (baking)
				{
					Time.captureFramerate = Mathf.Max(0, fixedBakeFramerate);
					playing = false;
					solver.simulate = true;
					solver.RequireRenderablePositions();
				}
				else
				{
					framesToSkip = 0;
					Time.captureFramerate = 0;
					solver.RelinquishRenderablePositions();
				}
			}
		}

		public bool Playing
		{
			get
			{
				return playing;
			}
			set
			{
				playing = value;
				solver.simulate = !playing;
				if (playing)
				{
					baking = false;
				}
			}
		}

		public bool Paused
		{
			get
			{
				return paused;
			}
			set
			{
				paused = value;
			}
		}

		private void Awake()
		{
			solver = GetComponent<ObiSolver>();
			if (UnityEngine.Application.isPlaying)
			{
				if (bakeOnAwake)
				{
					playhead = 0f;
					Baking = true;
				}
				else if (playOnAwake)
				{
					playhead = 0f;
					Playing = true;
				}
			}
		}

		private void OnEnable()
		{
			solver.OnFrameEnd += Solver_OnFrameEnd;
			solver.OnBeforeActorsFrameEnd += Solver_OnBeforeActorsFrameEnd;
		}

		private void OnDisable()
		{
			Baking = false;
			solver.OnFrameEnd -= Solver_OnFrameEnd;
			solver.OnBeforeActorsFrameEnd -= Solver_OnBeforeActorsFrameEnd;
		}

		private void Solver_OnFrameEnd(object sender, EventArgs e)
		{
			if (cache != null && !playing && baking)
			{
				playhead += Time.deltaTime;
				if (framesToSkip <= 0)
				{
					BakeFrame(playhead);
					framesToSkip = frameSkip;
				}
				else
				{
					framesToSkip--;
				}
			}
		}

		private void Solver_OnBeforeActorsFrameEnd(object sender, EventArgs e)
		{
			if (!(cache != null) || !playing)
			{
				return;
			}
			if (!paused)
			{
				playhead += Time.deltaTime;
				if (loopPlayback)
				{
					playhead = ((cache.Duration == 0f) ? 0f : (playhead % cache.Duration));
				}
				else if (playhead > cache.Duration)
				{
					playhead = cache.Duration;
				}
			}
			PlaybackFrame(playhead);
		}

		public void BakeFrame(float time)
		{
			if (cache == null)
			{
				return;
			}
			ObiParticleCache.Frame frame = new ObiParticleCache.Frame();
			frame.time = time;
			for (int i = 0; i < solver.renderablePositions.Length; i++)
			{
				ObiSolver.ParticleInActor particleInActor = solver.particleToActor[i];
				if (particleInActor != null && particleInActor.actor.active[particleInActor.indexInActor])
				{
					frame.indices.Add(i);
					if (cache.localSpace)
					{
						frame.positions.Add(solver.transform.InverseTransformPoint(solver.renderablePositions[i]));
					}
					else
					{
						frame.positions.Add(solver.renderablePositions[i]);
					}
				}
			}
			cache.AddFrame(frame);
		}

		private void PlaybackFrame(float time)
		{
			if (cache == null || cache.Duration == 0f)
			{
				return;
			}
			cache.GetFrame(time, interpolate, ref frame);
			if (solver.AllocParticleCount < frame.indices.Count)
			{
				UnityEngine.Debug.LogError("The ObiSolver doesn't have enough allocated particles to playback this cache.");
				Playing = false;
				return;
			}
			Matrix4x4 matrix4x = (cache.localSpace ? solver.transform.localToWorldMatrix : Matrix4x4.identity);
			for (int i = 0; i < frame.indices.Count; i++)
			{
				if (frame.indices[i] >= 0 && frame.indices[i] < solver.renderablePositions.Length)
				{
					solver.renderablePositions[frame.indices[i]] = matrix4x.MultiplyPoint3x4(frame.positions[i]);
				}
			}
			Oni.SetParticlePositions(solver.OniSolver, solver.renderablePositions, solver.renderablePositions.Length, 0);
			solver.UpdateActiveParticles();
		}
	}
	[RequireComponent(typeof(ObiSolver))]
	public class ObiParticleGridDebugger : MonoBehaviour
	{
		private ObiSolver solver;

		private Oni.GridCell[] cells;

		private void OnEnable()
		{
			solver = GetComponent<ObiSolver>();
			solver.OnFrameEnd += Solver_OnFrameEnd;
		}

		private void OnDisable()
		{
			solver.OnFrameEnd -= Solver_OnFrameEnd;
		}

		private void Solver_OnFrameEnd(object sender, EventArgs e)
		{
			int particleGridSize = Oni.GetParticleGridSize(solver.OniSolver);
			cells = new Oni.GridCell[particleGridSize];
			Oni.GetParticleGrid(solver.OniSolver, cells);
		}

		private void OnDrawGizmos()
		{
			if (cells != null)
			{
				Oni.GridCell[] array = cells;
				for (int i = 0; i < array.Length; i++)
				{
					Oni.GridCell gridCell = array[i];
					Gizmos.color = ((gridCell.count > 0) ? Color.yellow : Color.red);
					Gizmos.DrawWireCube(gridCell.center, gridCell.size);
				}
			}
		}
	}
	[ExecuteInEditMode]
	public class ObiParticleHandle : MonoBehaviour
	{
		[SerializeField]
		[HideInInspector]
		private ObiActor actor;

		[SerializeField]
		[HideInInspector]
		private List<int> handledParticleIndices = new List<int>();

		[SerializeField]
		[HideInInspector]
		private List<Vector3> handledParticlePositions = new List<Vector3>();

		[SerializeField]
		[HideInInspector]
		private List<float> handledParticleInvMasses = new List<float>();

		public int ParticleCount => handledParticleIndices.Count;

		public ObiActor Actor
		{
			get
			{
				return actor;
			}
			set
			{
				if (actor != value)
				{
					if (actor != null && actor.Solver != null)
					{
						actor.Solver.OnFrameBegin -= Actor_solver_OnFrameBegin;
						actor.OnInitialized -= Actor_OnInitialized;
					}
					actor = value;
					if (actor != null && actor.Solver != null)
					{
						actor.Solver.OnFrameBegin += Actor_solver_OnFrameBegin;
						actor.OnInitialized += Actor_OnInitialized;
					}
				}
			}
		}

		private void OnEnable()
		{
			if (actor != null && actor.Solver != null)
			{
				actor.Solver.OnFrameBegin += Actor_solver_OnFrameBegin;
				actor.OnInitialized += Actor_OnInitialized;
			}
		}

		private void OnDisable()
		{
			if (actor != null && actor.Solver != null)
			{
				actor.Solver.OnFrameBegin -= Actor_solver_OnFrameBegin;
				actor.OnInitialized -= Actor_OnInitialized;
				ResetInvMasses();
			}
		}

		public void Clear()
		{
			ResetInvMasses();
			handledParticleIndices.Clear();
			handledParticlePositions.Clear();
			handledParticleInvMasses.Clear();
		}

		public void AddParticle(int index, Vector3 position, float invMass)
		{
			handledParticleIndices.Add(index);
			handledParticlePositions.Add(base.transform.InverseTransformPoint(position));
			handledParticleInvMasses.Add(invMass);
		}

		public void RemoveParticle(int index)
		{
			int num = handledParticleIndices.IndexOf(index);
			if (num > -1)
			{
				if (actor.InSolver)
				{
					int destOffset = actor.particleIndices[index];
					float[] invMasses = new float[1] { actor.invMasses[index] = handledParticleInvMasses[num] };
					Oni.SetParticleInverseMasses(actor.Solver.OniSolver, invMasses, 1, destOffset);
				}
				handledParticleIndices.RemoveAt(num);
				handledParticlePositions.RemoveAt(num);
				handledParticleInvMasses.RemoveAt(num);
			}
		}

		private void ResetInvMasses()
		{
			if (actor.InSolver)
			{
				float[] array = new float[1];
				for (int i = 0; i < handledParticleIndices.Count; i++)
				{
					int destOffset = actor.particleIndices[handledParticleIndices[i]];
					array[0] = (actor.invMasses[handledParticleIndices[i]] = handledParticleInvMasses[i]);
					Oni.SetParticleInverseMasses(actor.Solver.OniSolver, array, 1, destOffset);
				}
			}
		}

		private void Actor_OnInitialized(object sender, EventArgs e)
		{
			Clear();
		}

		private void Actor_solver_OnFrameBegin(object sender, EventArgs e)
		{
			if (actor.InSolver)
			{
				Vector4[] array = new Vector4[1];
				Vector4[] velocities = new Vector4[1] { Vector3.zero };
				float[] invMasses = new float[1];
				Matrix4x4 matrix4x = ((!actor.Solver.simulateInLocalSpace) ? base.transform.localToWorldMatrix : (actor.Solver.transform.worldToLocalMatrix * base.transform.localToWorldMatrix));
				for (int i = 0; i < handledParticleIndices.Count; i++)
				{
					int destOffset = actor.particleIndices[handledParticleIndices[i]];
					Oni.SetParticleVelocities(actor.Solver.OniSolver, velocities, 1, destOffset);
					Oni.SetParticleInverseMasses(actor.Solver.OniSolver, invMasses, 1, destOffset);
					array[0] = matrix4x.MultiplyPoint3x4(handledParticlePositions[i]);
					Oni.SetParticlePositions(actor.Solver.OniSolver, array, 1, destOffset);
				}
			}
		}
	}
	[DisallowMultipleComponent]
	public class ObiProfiler : MonoBehaviour
	{
		[Header("Appearance")]
		public GUISkin skin;

		public Color threadColor = Color.cyan;

		public Color taskColor = Color.green;

		public Color parallelTaskColor = new Color(1f, 0.8f, 0.2f);

		public Color idleColor = new Color(0.7f, 0.7f, 0.7f);

		[Header("Visualization")]
		public bool showPercentages;

		public int profileThrottle = 30;

		private Oni.ProfileInfo[] info;

		private double frameDuration;

		private int frameCounter;

		private int yPos = 25;

		private float zoom = 1f;

		private Vector2 scrollPosition = Vector2.zero;

		private static ObiProfiler _instance;

		public static ObiProfiler Instance => _instance;

		private void Awake()
		{
			if (_instance != null && _instance != this)
			{
				UnityEngine.Object.DestroyImmediate(this);
				return;
			}
			_instance = this;
			Oni.EnableProfiler(cooked: true);
		}

		public void OnDestroy()
		{
			if (this == _instance)
			{
				Oni.EnableProfiler(cooked: false);
			}
		}

		public void StartStep()
		{
			Oni.SignalFrameStart();
		}

		private void UpdateProfilerInfo()
		{
			frameCounter--;
			if (frameCounter <= 0)
			{
				int profilingInfoCount = Oni.GetProfilingInfoCount();
				info = new Oni.ProfileInfo[profilingInfoCount];
				Oni.GetProfilingInfo(info, profilingInfoCount);
				frameCounter = profileThrottle;
				double num = double.MaxValue;
				double num2 = double.MinValue;
				Oni.ProfileInfo[] array = info;
				for (int i = 0; i < array.Length; i++)
				{
					Oni.ProfileInfo profileInfo = array[i];
					num = Math.Min(num, profileInfo.start);
					num2 = Math.Max(num2, profileInfo.end);
				}
				frameDuration = num2 - num;
			}
		}

		public void OnGUI()
		{
			if (Event.current.type == EventType.Layout)
			{
				UpdateProfilerInfo();
			}
			if (info == null)
			{
				return;
			}
			GUI.skin = skin;
			int num = 20;
			int num2 = 20;
			int num3 = (int)((float)Screen.width / zoom);
			GUI.BeginGroup(new Rect(0f, 0f, Screen.width, num), "", "Box");
			GUI.Label(new Rect(5f, 0f, 50f, num), "Zoom:");
			zoom = GUI.HorizontalSlider(new Rect(50f, 5f, 100f, num), zoom, 0.005f, 1f);
			GUI.Label(new Rect(Screen.width - 100, 0f, 100f, num), (frameDuration / 1000.0).ToString("0.###") + " ms/step");
			GUI.EndGroup();
			scrollPosition = GUI.BeginScrollView(new Rect(0f, num, Screen.width, Screen.height - 20), scrollPosition, new Rect(0f, 0f, num3, yPos + 30));
			GUI.color = threadColor;
			GUI.Label(new Rect(5f, 0f, 200f, 20f), "Thread #1");
			GUI.Box(new Rect(0f, 0f, num3, 40f), "", "Thread");
			yPos = 25;
			uint num4 = 0u;
			uint num5 = 0u;
			Oni.ProfileInfo[] array = info;
			for (int i = 0; i < array.Length; i++)
			{
				Oni.ProfileInfo profileInfo = array[i];
				uint num6 = (profileInfo.info & 0xFFFF0000u) >> 16;
				uint num7 = (profileInfo.info & 0xFF00) >> 8;
				uint num8 = profileInfo.info & 0xFFu;
				if (num4 != num6)
				{
					yPos += num2 + 1;
					GUI.color = threadColor;
					GUI.Label(new Rect(5f, yPos + 5, 200f, 20f), "Thread #" + (num6 + 1));
					GUI.Box(new Rect(0f, yPos + 5, num3, 40f), "", "Thread");
					yPos += 30;
				}
				else if (num5 != num7)
				{
					yPos += num2 + 1;
				}
				num5 = num7;
				num4 = num6;
				switch (num8)
				{
				case 0u:
					GUI.color = taskColor;
					break;
				case 1u:
					GUI.color = idleColor;
					break;
				case 2u:
					GUI.color = parallelTaskColor;
					break;
				default:
					GUI.color = Color.red;
					break;
				}
				int num9 = (int)(profileInfo.start / frameDuration * (double)(Screen.width - 10) / (double)zoom);
				int num10 = (int)(profileInfo.end / frameDuration * (double)(Screen.width - 10) / (double)zoom) - num9;
				string text;
				if (showPercentages)
				{
					double num11 = (profileInfo.end - profileInfo.start) / frameDuration * 100.0;
					text = profileInfo.name + " (" + num11.ToString("0.#") + "%)";
				}
				else
				{
					double num12 = (profileInfo.end - profileInfo.start) / 1000.0;
					text = profileInfo.name + " (" + num12.ToString("0.##") + "ms)";
				}
				GUI.Box(new Rect(num9, yPos, num10 - 1, num2), text, "Task");
			}
			GUI.EndScrollView();
		}
	}
	[RequireComponent(typeof(ObiRope))]
	public class ObiRopeCursor : MonoBehaviour
	{
		[Range(0f, 1f)]
		public float normalizedCoord;

		public bool direction = true;

		private ObiRope rope;

		public void Awake()
		{
			rope = GetComponent<ObiRope>();
		}

		private int FindHotConstraint(ObiDistanceConstraintBatch distanceBatch, int constraint, int maxAmount)
		{
			if (direction)
			{
				int num = distanceBatch.springIndices[constraint * 2 + 1];
				for (int i = 1; i <= maxAmount; i++)
				{
					if (constraint + i == distanceBatch.ConstraintCount || distanceBatch.springIndices[(constraint + i) * 2] != num)
					{
						return constraint + i - 1;
					}
					num = distanceBatch.springIndices[(constraint + i) * 2 + 1];
				}
				return constraint + maxAmount;
			}
			int num2 = distanceBatch.springIndices[constraint * 2];
			for (int j = 1; j <= maxAmount; j++)
			{
				if (constraint - j < 0 || distanceBatch.springIndices[(constraint - j) * 2 + 1] != num2)
				{
					return constraint - j + 1;
				}
				num2 = distanceBatch.springIndices[(constraint - j) * 2];
			}
			return constraint - maxAmount;
		}

		private int AddParticles(int amount)
		{
			ObiDistanceConstraintBatch firstBatch = rope.DistanceConstraints.GetFirstBatch();
			ObiBendConstraintBatch firstBatch2 = rope.BendingConstraints.GetFirstBatch();
			amount = Mathf.Min(amount, rope.PooledParticles);
			if (amount == 0)
			{
				return 0;
			}
			int constraintIndexAtNormalizedCoordinate = rope.GetConstraintIndexAtNormalizedCoordinate(normalizedCoord);
			rope.DistanceConstraints.RemoveFromSolver(null);
			rope.BendingConstraints.RemoveFromSolver(null);
			int[] array = new int[amount + 2];
			int num = 0;
			int num2 = 0;
			while (num < amount && num2 < rope.TotalParticles)
			{
				if (!rope.active[num2])
				{
					array[num + 1] = num2;
					rope.active[num2] = true;
					rope.invMasses[num2] = 10f;
					num++;
				}
				num2++;
			}
			Vector4[] velocities = new Vector4[1] { Vector4.zero };
			Vector4[] array2 = new Vector4[1];
			Vector4[] array3 = new Vector4[1];
			if (direction)
			{
				array[0] = firstBatch.springIndices[constraintIndexAtNormalizedCoordinate * 2];
				array[array.Length - 1] = firstBatch.springIndices[constraintIndexAtNormalizedCoordinate * 2 + 1];
				normalizedCoord = (float)constraintIndexAtNormalizedCoordinate / (float)(firstBatch.ConstraintCount + amount);
				Oni.GetParticlePositions(rope.Solver.OniSolver, array2, 1, rope.particleIndices[array[0]]);
				Oni.GetParticlePositions(rope.Solver.OniSolver, array3, 1, rope.particleIndices[array[array.Length - 1]]);
				firstBatch.SetParticleIndex(constraintIndexAtNormalizedCoordinate, array[array.Length - 2], ObiDistanceConstraintBatch.DistanceIndexType.First, rope.Closed);
				firstBatch2.SetParticleIndex(constraintIndexAtNormalizedCoordinate, array[array.Length - 2], ObiBendConstraintBatch.BendIndexType.First, rope.Closed);
				firstBatch2.SetParticleIndex(constraintIndexAtNormalizedCoordinate - 1, array[1], ObiBendConstraintBatch.BendIndexType.Second, rope.Closed);
				for (int i = 1; i < array.Length - 1; i++)
				{
					Vector4[] positions = new Vector4[1] { array2[0] + (array3[0] - array2[0]) * i / (array.Length - 1) * 0.5f };
					Oni.SetParticlePositions(rope.Solver.OniSolver, positions, 1, rope.particleIndices[array[i]]);
					Oni.SetParticleVelocities(rope.Solver.OniSolver, velocities, 1, rope.particleIndices[array[i]]);
					int constraintIndex = constraintIndexAtNormalizedCoordinate + i - 1;
					firstBatch.InsertConstraint(constraintIndex, array[i - 1], array[i], rope.InterparticleDistance, 0f, 0f);
					firstBatch2.InsertConstraint(constraintIndex, array[i - 1], array[i + 1], array[i], 0f, 0f, 0f);
				}
			}
			else
			{
				array[0] = firstBatch.springIndices[constraintIndexAtNormalizedCoordinate * 2 + 1];
				array[array.Length - 1] = firstBatch.springIndices[constraintIndexAtNormalizedCoordinate * 2];
				normalizedCoord = (float)(constraintIndexAtNormalizedCoordinate + amount) / (float)(firstBatch.ConstraintCount + amount);
				Oni.GetParticlePositions(rope.Solver.OniSolver, array2, 1, rope.particleIndices[array[0]]);
				Oni.GetParticlePositions(rope.Solver.OniSolver, array3, 1, rope.particleIndices[array[array.Length - 1]]);
				firstBatch.SetParticleIndex(constraintIndexAtNormalizedCoordinate, array[array.Length - 2], ObiDistanceConstraintBatch.DistanceIndexType.Second, rope.Closed);
				firstBatch2.SetParticleIndex(constraintIndexAtNormalizedCoordinate, array[1], ObiBendConstraintBatch.BendIndexType.First, rope.Closed);
				firstBatch2.SetParticleIndex(constraintIndexAtNormalizedCoordinate - 1, array[array.Length - 2], ObiBendConstraintBatch.BendIndexType.Second, rope.Closed);
				for (int j = 1; j < array.Length - 1; j++)
				{
					Vector4[] positions2 = new Vector4[1] { array2[0] + (array3[0] - array2[0]) * j / (array.Length - 1) * 0.5f };
					Oni.SetParticlePositions(rope.Solver.OniSolver, positions2, 1, rope.particleIndices[array[j]]);
					Oni.SetParticleVelocities(rope.Solver.OniSolver, velocities, 1, rope.particleIndices[array[j]]);
					firstBatch.InsertConstraint(constraintIndexAtNormalizedCoordinate + 1, array[j], array[j - 1], rope.InterparticleDistance, 0f, 0f);
					firstBatch2.InsertConstraint(constraintIndexAtNormalizedCoordinate, array[j + 1], array[j - 1], array[j], 0f, 0f, 0f);
				}
			}
			rope.DistanceConstraints.AddToSolver(null);
			rope.BendingConstraints.AddToSolver(null);
			rope.PushDataToSolver(ParticleData.ACTIVE_STATUS);
			rope.UsedParticles += amount;
			rope.RegenerateRestPositions();
			return amount;
		}

		private int RemoveParticles(int amount)
		{
			ObiDistanceConstraintBatch firstBatch = rope.DistanceConstraints.GetFirstBatch();
			ObiBendConstraintBatch firstBatch2 = rope.BendingConstraints.GetFirstBatch();
			amount = Mathf.Min(amount, rope.UsedParticles - 2);
			int constraintIndexAtNormalizedCoordinate = rope.GetConstraintIndexAtNormalizedCoordinate(normalizedCoord);
			int num = FindHotConstraint(firstBatch, constraintIndexAtNormalizedCoordinate, amount);
			amount = Mathf.Min(amount, Mathf.Abs(num - constraintIndexAtNormalizedCoordinate));
			if (amount == 0)
			{
				return 0;
			}
			rope.DistanceConstraints.RemoveFromSolver(null);
			rope.BendingConstraints.RemoveFromSolver(null);
			if (direction)
			{
				normalizedCoord = (float)constraintIndexAtNormalizedCoordinate / (float)(firstBatch.ConstraintCount - amount);
				firstBatch.SetParticleIndex(constraintIndexAtNormalizedCoordinate, firstBatch.springIndices[num * 2 + 1], ObiDistanceConstraintBatch.DistanceIndexType.Second, rope.Closed);
				firstBatch2.SetParticleIndex(constraintIndexAtNormalizedCoordinate - 1, firstBatch.springIndices[num * 2 + 1], ObiBendConstraintBatch.BendIndexType.Second, rope.Closed);
				firstBatch2.SetParticleIndex(num, firstBatch.springIndices[constraintIndexAtNormalizedCoordinate * 2], ObiBendConstraintBatch.BendIndexType.First, rope.Closed);
				for (int num2 = constraintIndexAtNormalizedCoordinate + amount; num2 > constraintIndexAtNormalizedCoordinate; num2--)
				{
					rope.active[firstBatch.springIndices[num2 * 2]] = false;
					firstBatch.RemoveConstraint(num2);
					firstBatch2.RemoveConstraint(num2 - 1);
				}
			}
			else
			{
				normalizedCoord = (float)(constraintIndexAtNormalizedCoordinate - amount) / (float)(firstBatch.ConstraintCount - amount);
				firstBatch.SetParticleIndex(constraintIndexAtNormalizedCoordinate, firstBatch.springIndices[num * 2], ObiDistanceConstraintBatch.DistanceIndexType.First, rope.Closed);
				firstBatch2.SetParticleIndex(constraintIndexAtNormalizedCoordinate, firstBatch.springIndices[num * 2], ObiBendConstraintBatch.BendIndexType.First, rope.Closed);
				firstBatch2.SetParticleIndex(num - 1, firstBatch.springIndices[constraintIndexAtNormalizedCoordinate * 2 + 1], ObiBendConstraintBatch.BendIndexType.Second, rope.Closed);
				for (int num3 = constraintIndexAtNormalizedCoordinate - 1; num3 >= constraintIndexAtNormalizedCoordinate - amount; num3--)
				{
					rope.active[firstBatch.springIndices[num3 * 2 + 1]] = false;
					firstBatch.RemoveConstraint(num3);
					firstBatch2.RemoveConstraint(num3);
				}
			}
			rope.DistanceConstraints.AddToSolver(null);
			rope.BendingConstraints.AddToSolver(null);
			rope.PushDataToSolver(ParticleData.ACTIVE_STATUS);
			rope.UsedParticles -= amount;
			rope.RegenerateRestPositions();
			return amount;
		}

		public void ChangeLength(float newLength)
		{
			if (rope == null)
			{
				return;
			}
			newLength = Mathf.Clamp(newLength, 0f, (float)(rope.TotalParticles - 1) * rope.InterparticleDistance);
			int constraintIndexAtNormalizedCoordinate = rope.GetConstraintIndexAtNormalizedCoordinate(normalizedCoord);
			ObiDistanceConstraintBatch firstBatch = rope.DistanceConstraints.GetFirstBatch();
			float num = newLength - rope.RestLength;
			float num2 = Mathf.Clamp(num, 0f - firstBatch.restLengths[constraintIndexAtNormalizedCoordinate], rope.InterparticleDistance - firstBatch.restLengths[constraintIndexAtNormalizedCoordinate]);
			firstBatch.restLengths[constraintIndexAtNormalizedCoordinate] += num2;
			num -= num2;
			int num3 = ((num > 0f) ? Mathf.CeilToInt(num / rope.InterparticleDistance) : Mathf.FloorToInt(num / rope.InterparticleDistance));
			float value = ObiUtils.Mod(num, rope.InterparticleDistance);
			if (num3 > 0)
			{
				if (AddParticles(num3) == 0)
				{
					value = rope.InterparticleDistance;
				}
				constraintIndexAtNormalizedCoordinate = rope.GetConstraintIndexAtNormalizedCoordinate(normalizedCoord);
				firstBatch.restLengths[constraintIndexAtNormalizedCoordinate] = value;
			}
			else if (num3 < 0)
			{
				if (RemoveParticles(-num3) == 0)
				{
					value = 0f;
				}
				constraintIndexAtNormalizedCoordinate = rope.GetConstraintIndexAtNormalizedCoordinate(normalizedCoord);
				firstBatch.restLengths[constraintIndexAtNormalizedCoordinate] = value;
			}
			firstBatch.PushDataToSolver(rope.DistanceConstraints);
			rope.RecalculateLenght();
		}
	}
	[RequireComponent(typeof(ObiRope))]
	[RequireComponent(typeof(ObiCatmullRomCurve))]
	public class ObiRopeHelper : MonoBehaviour
	{
		public ObiSolver solver;

		public ObiRopeSection section;

		public Material material;

		public Transform start;

		public Transform end;

		private ObiRope rope;

		private ObiCatmullRomCurve path;

		private void Start()
		{
			rope = GetComponent<ObiRope>();
			path = GetComponent<ObiCatmullRomCurve>();
			rope.Solver = solver;
			rope.ropePath = path;
			rope.section = section;
			GetComponent<MeshRenderer>().material = material;
			Vector3 vector = base.transform.InverseTransformPoint(start.position);
			Vector3 vector2 = base.transform.InverseTransformPoint(end.position);
			Vector3 normalized = (vector2 - vector).normalized;
			path.controlPoints.Clear();
			path.controlPoints.Add(vector - normalized);
			path.controlPoints.Add(vector);
			path.controlPoints.Add(vector2);
			path.controlPoints.Add(vector2 + normalized);
			StartCoroutine(Setup());
		}

		private IEnumerator Setup()
		{
			yield return StartCoroutine(rope.GeneratePhysicRepresentationForMesh());
			rope.AddToSolver(null);
			rope.invMasses[0] = 0f;
			rope.invMasses[rope.UsedParticles - 1] = 0f;
			Oni.SetParticleInverseMasses(solver.OniSolver, new float[1], 1, rope.particleIndices[0]);
			Oni.SetParticleInverseMasses(solver.OniSolver, new float[1], 1, rope.particleIndices[rope.UsedParticles - 1]);
		}
	}
	public static class Constants
	{
		public const int maxVertsPerMesh = 65000;
	}
	public static class ObiUtils
	{
		public static void DrawArrowGizmo(float bodyLenght, float bodyWidth, float headLenght, float headWidth)
		{
			float num = bodyLenght * 0.5f;
			float num2 = bodyWidth * 0.5f;
			Gizmos.DrawLine(new Vector3(num2, 0f, 0f - num), new Vector3(num2, 0f, num));
			Gizmos.DrawLine(new Vector3(0f - num2, 0f, 0f - num), new Vector3(0f - num2, 0f, num));
			Gizmos.DrawLine(new Vector3(0f - num2, 0f, 0f - num), new Vector3(num2, 0f, 0f - num));
			Gizmos.DrawLine(new Vector3(num2, 0f, num), new Vector3(headWidth, 0f, num));
			Gizmos.DrawLine(new Vector3(0f - num2, 0f, num), new Vector3(0f - headWidth, 0f, num));
			Gizmos.DrawLine(new Vector3(0f, 0f, num + headLenght), new Vector3(headWidth, 0f, num));
			Gizmos.DrawLine(new Vector3(0f, 0f, num + headLenght), new Vector3(0f - headWidth, 0f, num));
		}

		public static Bounds Transform(this Bounds b, Matrix4x4 m)
		{
			Vector4 vector = m.GetColumn(0) * b.min.x;
			Vector4 vector2 = m.GetColumn(0) * b.max.x;
			Vector4 vector3 = m.GetColumn(1) * b.min.y;
			Vector4 vector4 = m.GetColumn(1) * b.max.y;
			Vector4 vector5 = m.GetColumn(2) * b.min.z;
			Vector4 vector6 = m.GetColumn(2) * b.max.z;
			Bounds result = default(Bounds);
			Vector3 vector7 = m.GetColumn(3);
			result.SetMinMax(Vector3.Min(vector, vector2) + Vector3.Min(vector3, vector4) + Vector3.Min(vector5, vector6) + vector7, Vector3.Max(vector, vector2) + Vector3.Max(vector3, vector4) + Vector3.Max(vector5, vector6) + vector7);
			return result;
		}

		public static float Remap(this float value, float from1, float to1, float from2, float to2)
		{
			return (value - from1) / (to1 - from1) * (to2 - from2) + from2;
		}

		public static float Mod(float a, float b)
		{
			return a - b * Mathf.Floor(a / b);
		}

		public static float TriangleArea(Vector3 p1, Vector3 p2, Vector3 p3)
		{
			return Mathf.Sqrt(Vector3.Cross(p2 - p1, p3 - p1).sqrMagnitude) / 2f;
		}
	}
}
namespace Miragesoft
{
	public class OculusManager : Singleton<OculusManager>
	{
		public ulong id;

		public string oculusID;

		public string oculusNonce;

		public bool created;

		public UnityEvent OnCompletedLoggedIn;

		public UnityEvent OnFailedLoggedIn;

		public UnityEvent OnFailedInit;

		private float t;

		private void Awake()
		{
			if (Singleton<OculusManager>.Instance != null && Singleton<OculusManager>.Instance != this)
			{
				UnityEngine.Object.Destroy(base.gameObject);
				return;
			}
			UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
			created = false;
			Core.AsyncInitialize().OnComplete(InitCallback);
		}

		public void Start()
		{
			MonoBehaviour.print("Oculus Manager Start");
			t = Time.time;
		}

		private void InitCallback(Message<PlatformInitialize> msg)
		{
			if (msg.IsError || msg.Data.Result == PlatformInitializeResult.Unknown)
			{
				if (msg.IsError)
				{
					UnityEngine.Debug.Log("Msg Error : " + msg.GetError().Message);
				}
				if (OnFailedInit != null)
				{
					OnFailedInit.Invoke();
				}
			}
			else
			{
				LaunchDetails launchDetails = ApplicationLifecycle.GetLaunchDetails();
				UnityEngine.Debug.Log("App launched with LaunchType " + launchDetails.LaunchType);
				Entitlements.IsUserEntitledToApplication().OnComplete(IsEntitledCallback);
			}
		}

		private void IsEntitledCallback(Message msg)
		{
			if (msg.IsError)
			{
				UnityEngine.Debug.Log("Msg Error : " + msg.GetError().Message);
				UnityEngine.Application.Quit();
			}
			else
			{
				UnityEngine.Debug.Log("You are entitled to use this app.");
				Users.GetLoggedInUser().OnComplete(GetLoggedInUserCallback);
			}
		}

		private void GetLoggedInUserCallback(Message<User> msg)
		{
			if (msg.IsError)
			{
				UnityEngine.Debug.Log("Msg Error : " + msg.GetError().Message);
				if (OnFailedLoggedIn != null)
				{
					OnFailedLoggedIn.Invoke();
				}
				return;
			}
			id = msg.Data.ID;
			oculusID = msg.Data.OculusID;
			if (OnCompletedLoggedIn != null)
			{
				OnCompletedLoggedIn.Invoke();
			}
			GetUserProof();
		}

		public void GetUserProof()
		{
			Users.GetUserProof().OnComplete(OnUserProofCallback);
		}

		private void OnUserProofCallback(Message<UserProof> msg)
		{
			if (msg.IsError)
			{
				UnityEngine.Debug.Log($"Oculus: Error getting user proof. Error Message: {msg.GetError().Message}");
			}
			else
			{
				oculusNonce = msg.Data.Value;
			}
		}

		public new void OnApplicationQuit()
		{
		}

		public void SetOculusUserInfo(UserData userData)
		{
			if (id != 0L && userData.id != 0L && userData.id != id && !UnityEngine.Application.isEditor && !Singleton<DataManager>.Instance.isBeta)
			{
				MonoBehaviour.print("saved file is used from other device!");
				File.Exists(UnityEngine.Application.persistentDataPath + "/Saves/userData.json");
				UnityEngine.Application.Quit();
			}
			else if (id != 0L)
			{
				userData.id = id;
				userData.nickName = oculusID;
			}
		}
	}
}
namespace Miragesoft.Utils.Web
{
	public static class WebUtility
	{
		public static void AddAllowCrossDomainHeader(this WWWForm form)
		{
			form.headers.Add("Access-Control-Allow-Credentials", "true");
			form.headers.Add("Access-Control-Allow-Headers", "Accept, X-Access-Token, X-Application-Name, X-Request-Sent-Time");
			form.headers.Add("Access-Control-Allow-Methods", "GET, POST, OPTIONS");
			form.headers.Add("Access-Control-Allow-Origin", "*");
		}

		public static void AddAllowCrossDomainHeader(this UnityWebRequest request)
		{
			request.SetRequestHeader("Access-Control-Allow-Credentials", "true");
			request.SetRequestHeader("Access-Control-Allow-Headers", "Accept, X-Access-Token, X-Application-Name, X-Request-Sent-Time");
			request.SetRequestHeader("Access-Control-Allow-Methods", "GET, POST, OPTIONS");
			request.SetRequestHeader("Access-Control-Allow-Origin", "*");
		}
	}
	public class WebRequestProgress : IProgress, IDisposable
	{
		private UnityWebRequest request;

		public float Progress => request.uploadProgress;

		public string Message { get; protected set; }

		public WebRequestProgress(UnityWebRequest www)
		{
			request = www;
			Message = "Request " + request.url + "...";
		}

		public void Dispose()
		{
			request.Dispose();
			request = null;
		}
	}
	public class WebResponseProgress : IProgress
	{
		private UnityWebRequest request;

		public float Progress => request.downloadProgress;

		public string Message { get; protected set; }

		public WebResponseProgress(UnityWebRequest www)
		{
			request = www;
			Message = "Request " + request.url + "...";
		}
	}
}
namespace Miragesoft.Utils.Json
{
	public static class JsonUtility
	{
		private static JsonConverter[] converters = new JsonConverter[6]
		{
			new Vector2Converter(),
			new Vector3Converter(),
			new Vector4Converter(),
			new ColorConverter(),
			new RectConverter(),
			new QuaternionConverter()
		};

		private static JsonSerializer jsonSerializer;

		private static JsonSerializerSettings jsonSerializerSettings;

		public static JsonSerializer JsonSerializer
		{
			get
			{
				if (jsonSerializer == null)
				{
					jsonSerializer = JsonSerializer.Create(JsonSerializerSettings);
				}
				return jsonSerializer;
			}
		}

		public static JsonSerializerSettings JsonSerializerSettings
		{
			get
			{
				if (jsonSerializerSettings == null)
				{
					jsonSerializerSettings = new JsonSerializerSettings();
					jsonSerializerSettings.NullValueHandling = NullValueHandling.Ignore;
					jsonSerializerSettings.MissingMemberHandling = MissingMemberHandling.Ignore;
					jsonSerializerSettings.ObjectCreationHandling = ObjectCreationHandling.Auto;
					jsonSerializerSettings.ReferenceLoopHandling = ReferenceLoopHandling.Ignore;
					jsonSerializerSettings.PreserveReferencesHandling = PreserveReferencesHandling.None;
					jsonSerializerSettings.TypeNameHandling = TypeNameHandling.None;
					jsonSerializerSettings.Formatting = Formatting.Indented;
					jsonSerializerSettings.DefaultValueHandling = DefaultValueHandling.Include;
					JsonConverter[] array = converters;
					foreach (JsonConverter item in array)
					{
						jsonSerializerSettings.Converters.Add(item);
					}
				}
				return jsonSerializerSettings;
			}
		}

		public static JToken ToJObject(this string text)
		{
			return JToken.Parse(text);
		}

		public static string ToString(this JToken target, Formatting formatting)
		{
			return target.ToString(formatting, converters);
		}

		public static JToken ToJson(this object target)
		{
			return JToken.FromObject(target, JsonSerializer);
		}

		public static T ToObject<T>(this JToken json)
		{
			return JsonConvert.DeserializeObject<T>(json.ToString());
		}

		public static T GetValue<T>(this JObject json, string propertyName, T defaultValue)
		{
			if (json.TryGetValue(propertyName, out var value))
			{
				return value.ToObject<T>();
			}
			return defaultValue;
		}

		public static T GetValue<T>(this JObject json, string propertyName)
		{
			if (json.TryGetValue(propertyName, out var value))
			{
				return value.ToObject<T>();
			}
			return default(T);
		}

		public static void AddValue(this JObject json, string propertyName, object value)
		{
			json.Add(new JProperty(propertyName, value.ToJson()));
		}

		public static bool FromJson(this object self, string json)
		{
			try
			{
				JsonConvert.PopulateObject(json, self, JsonSerializerSettings);
				return true;
			}
			catch (Exception exception)
			{
				UnityEngine.Debug.LogException(exception);
			}
			return false;
		}

		public static T FromJson<T>(string json)
		{
			try
			{
				return JsonConvert.DeserializeObject<T>(json);
			}
			catch (Exception exception)
			{
				UnityEngine.Debug.LogException(exception);
			}
			return default(T);
		}
	}
}
namespace Miragesoft.Localization
{
	public static class PersistentStorage
	{
		public enum FileType
		{
			Raw,
			Persistent,
			Temporal,
			Streaming
		}

		private static CustomPersistentStorage storage;

		public static void SetSetting_String(string key, string value)
		{
			if (storage == null)
			{
				storage = new CustomPersistentStorage();
			}
			storage.SetSetting_String(key, value);
		}

		public static string GetSetting_String(string key, string defaultValue)
		{
			if (storage == null)
			{
				storage = new CustomPersistentStorage();
			}
			return storage.GetSetting_String(key, defaultValue);
		}

		public static bool CanAccessFiles()
		{
			if (storage == null)
			{
				storage = new CustomPersistentStorage();
			}
			return storage.CanAccessFiles();
		}

		public static string LoadFile(FileType fileType, string fileName, bool logExceptions = true)
		{
			if (storage == null)
			{
				storage = new CustomPersistentStorage();
			}
			return storage.LoadFile(fileType, fileName, logExceptions);
		}

		public static bool HasFile(FileType fileType, string fileName, bool logExceptions = true)
		{
			if (storage == null)
			{
				storage = new CustomPersistentStorage();
			}
			return storage.HasFile(fileType, fileName, logExceptions);
		}
	}
	public abstract class BasePersistentStorage
	{
		public virtual void SetSetting_String(string key, string value)
		{
			try
			{
				int length = value.Length;
				int num = 8000;
				if (length <= num)
				{
					PlayerPrefs.SetString(key, value);
					return;
				}
				int num2 = Mathf.CeilToInt((float)length / (float)num);
				for (int i = 0; i < num2; i++)
				{
					int num3 = num * i;
					PlayerPrefs.SetString($"[I2split]{i}{key}", value.Substring(num3, Mathf.Min(num, length - num3)));
				}
				PlayerPrefs.SetString(key, "[$I2#@div$]" + num2);
			}
			catch (Exception)
			{
				UnityEngine.Debug.LogError("Error saving PlayerPrefs " + key);
			}
		}

		public virtual string GetSetting_String(string key, string defaultValue)
		{
			try
			{
				string text = PlayerPrefs.GetString(key, defaultValue);
				if (!string.IsNullOrEmpty(text) && text.StartsWith("[I2split]"))
				{
					int num = int.Parse(text.Substring("[I2split]".Length));
					text = "";
					for (int i = 0; i < num; i++)
					{
						text += PlayerPrefs.GetString($"[I2split]{i}{key}", "");
					}
				}
				return text;
			}
			catch (Exception)
			{
				UnityEngine.Debug.LogError("Error loading PlayerPrefs " + key);
				return defaultValue;
			}
		}

		public virtual bool CanAccessFiles()
		{
			return true;
		}

		private string UpdateFilename(PersistentStorage.FileType fileType, string fileName)
		{
			switch (fileType)
			{
			case PersistentStorage.FileType.Persistent:
				fileName = UnityEngine.Application.persistentDataPath + "/" + fileName;
				break;
			case PersistentStorage.FileType.Temporal:
				fileName = UnityEngine.Application.temporaryCachePath + "/" + fileName;
				break;
			case PersistentStorage.FileType.Streaming:
				fileName = UnityEngine.Application.streamingAssetsPath + "/" + fileName;
				break;
			}
			return fileName;
		}

		public virtual string LoadFile(PersistentStorage.FileType fileType, string fileName, bool logExceptions = true)
		{
			if (!CanAccessFiles())
			{
				return null;
			}
			try
			{
				fileName = UpdateFilename(fileType, fileName);
				return File.ReadAllText(fileName, Encoding.UTF8);
			}
			catch (Exception ex)
			{
				if (logExceptions)
				{
					UnityEngine.Debug.LogError("Error loading file '" + fileName + "'\n" + ex);
				}
				return null;
			}
		}

		public virtual bool HasFile(PersistentStorage.FileType fileType, string fileName, bool logExceptions = true)
		{
			if (!CanAccessFiles())
			{
				return false;
			}
			try
			{
				fileName = UpdateFilename(fileType, fileName);
				return File.Exists(fileName);
			}
			catch (Exception ex)
			{
				if (logExceptions)
				{
					UnityEngine.Debug.LogError("Error requesting file '" + fileName + "'\n" + ex);
				}
				return false;
			}
		}
	}
	public class CustomPersistentStorage : BasePersistentStorage
	{
	}
	public class BaseSpecializationManager
	{
		public string[] specializations;

		public virtual void InitializeSpecializations()
		{
			specializations = new string[6] { "Quest", "GO", "Rift", "Vive", "PS4", "Pico" };
		}

		public virtual string GetCurrentSpecialization()
		{
			if (specializations == null)
			{
				InitializeSpecializations();
			}
			return "Quest";
		}
	}
	public class SpecializationManager : BaseSpecializationManager
	{
		public static SpecializationManager Singleton = new SpecializationManager();

		private SpecializationManager()
		{
			InitializeSpecializations();
		}

		public static string GetSpecializedText(string text, string specialization = null)
		{
			int num = text.IndexOf("[i2s_");
			if (num < 0)
			{
				return text;
			}
			if (string.IsNullOrEmpty(specialization))
			{
				specialization = Singleton.GetCurrentSpecialization();
			}
			if (!string.IsNullOrEmpty(specialization) && specialization != "Quest")
			{
				string text2 = "[i2s_" + specialization + "]";
				int num2 = text.IndexOf(text2);
				num2 += text2.Length;
				int num3 = text.IndexOf("[i2s_", num2);
				if (num3 < 0)
				{
					num3 = text.Length;
				}
				return text.Substring(num2, num3 - num2);
			}
			return text.Substring(0, num);
		}

		public static string SetSpecializedText(string text, string newText, string specialization)
		{
			if (string.IsNullOrEmpty(specialization))
			{
				specialization = "Quest";
			}
			if ((text == null || !text.Contains("[i2s_")) && specialization == "Quest")
			{
				return newText;
			}
			Dictionary<string, string> dictionary = GetSpecializations(text);
			dictionary[specialization] = newText;
			return SetSpecializedText(dictionary);
		}

		public static string SetSpecializedText(Dictionary<string, string> specializations)
		{
			if (!specializations.TryGetValue("Quest", out var value))
			{
				value = string.Empty;
			}
			foreach (KeyValuePair<string, string> specialization in specializations)
			{
				if (specialization.Key != "Quest" && !string.IsNullOrEmpty(specialization.Value))
				{
					value = value + "[i2s_" + specialization.Key + "]" + specialization.Value;
				}
			}
			return value;
		}

		public static Dictionary<string, string> GetSpecializations(string text, Dictionary<string, string> buffer = null)
		{
			if (buffer == null)
			{
				buffer = new Dictionary<string, string>();
			}
			else
			{
				buffer.Clear();
			}
			if (text == null)
			{
				buffer["Quest"] = "";
				return buffer;
			}
			int num = 0;
			int num2 = text.IndexOf("[i2s_");
			if (num2 < 0)
			{
				num2 = text.Length;
			}
			buffer["Quest"] = text.Substring(0, num2);
			for (num = num2; num < text.Length; num = num2)
			{
				num += "[i2s_".Length;
				int num3 = text.IndexOf(']', num);
				if (num3 < 0)
				{
					break;
				}
				string key = text.Substring(num, num3 - num);
				num = num3 + 1;
				num2 = text.IndexOf("[i2s_", num);
				if (num2 < 0)
				{
					num2 = text.Length;
				}
				string value = text.Substring(num, num2 - num);
				buffer[key] = value;
			}
			return buffer;
		}

		public static void AppendSpecializations(string text, List<string> list = null)
		{
			if (text == null)
			{
				return;
			}
			if (list == null)
			{
				list = new List<string>();
			}
			if (!list.Contains("Quest"))
			{
				list.Add("Quest");
			}
			int num = 0;
			while (num < text.Length)
			{
				num = text.IndexOf("[i2s_", num);
				if (num >= 0)
				{
					num += "[i2s_".Length;
					int num2 = text.IndexOf(']', num);
					if (num2 >= 0)
					{
						string item = text.Substring(num, num2 - num);
						if (!list.Contains(item))
						{
							list.Add(item);
						}
						continue;
					}
					break;
				}
				break;
			}
		}
	}
	[Serializable]
	public class EventCallback
	{
		public MonoBehaviour Target;

		public string MethodName = string.Empty;

		public void Execute(UnityEngine.Object Sender = null)
		{
			if (HasCallback() && UnityEngine.Application.isPlaying)
			{
				Target.gameObject.SendMessage(MethodName, Sender, SendMessageOptions.DontRequireReceiver);
			}
		}

		public bool HasCallback()
		{
			if (Target != null)
			{
				return !string.IsNullOrEmpty(MethodName);
			}
			return false;
		}
	}
	public enum ePluralType
	{
		Zero,
		One,
		Two,
		Few,
		Many,
		Plural
	}
	public static class GoogleLanguages
	{
		public struct LanguageCodeDef
		{
			public string Code;

			public string GoogleCode;

			public bool HasJoinedWords;

			public int PluralRule;
		}

		public static Dictionary<string, LanguageCodeDef> mLanguageDef = new Dictionary<string, LanguageCodeDef>(StringComparer.Ordinal)
		{
			{
				"Abkhazian",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ab",
					GoogleCode = "-"
				}
			},
			{
				"Afar",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "aa",
					GoogleCode = "-"
				}
			},
			{
				"Afrikaans",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "af"
				}
			},
			{
				"Akan",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ak",
					GoogleCode = "-"
				}
			},
			{
				"Albanian",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "sq"
				}
			},
			{
				"Amharic",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "am"
				}
			},
			{
				"Arabic",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar"
				}
			},
			{
				"Arabic/Algeria",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-DZ",
					GoogleCode = "ar"
				}
			},
			{
				"Arabic/Bahrain",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-BH",
					GoogleCode = "ar"
				}
			},
			{
				"Arabic/Egypt",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-EG",
					GoogleCode = "ar"
				}
			},
			{
				"Arabic/Iraq",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-IQ",
					GoogleCode = "ar"
				}
			},
			{
				"Arabic/Jordan",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-JO",
					GoogleCode = "ar"
				}
			},
			{
				"Arabic/Kuwait",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-KW",
					GoogleCode = "ar"
				}
			},
			{
				"Arabic/Lebanon",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-LB",
					GoogleCode = "ar"
				}
			},
			{
				"Arabic/Libya",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-LY",
					GoogleCode = "ar"
				}
			},
			{
				"Arabic/Morocco",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-MA",
					GoogleCode = "ar"
				}
			},
			{
				"Arabic/Oman",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-OM",
					GoogleCode = "ar"
				}
			},
			{
				"Arabic/Qatar",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-QA",
					GoogleCode = "ar"
				}
			},
			{
				"Arabic/Saudi Arabia",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-SA",
					GoogleCode = "ar"
				}
			},
			{
				"Arabic/Syria",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-SY",
					GoogleCode = "ar"
				}
			},
			{
				"Arabic/Tunisia",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-TN",
					GoogleCode = "ar"
				}
			},
			{
				"Arabic/U.A.E.",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-AE",
					GoogleCode = "ar"
				}
			},
			{
				"Arabic/Yemen",
				new LanguageCodeDef
				{
					PluralRule = 11,
					Code = "ar-YE",
					GoogleCode = "ar"
				}
			},
			{
				"Aragonese",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "an",
					GoogleCode = "-"
				}
			},
			{
				"Armenian",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "hy"
				}
			},
			{
				"Assamese",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "as",
					GoogleCode = "-"
				}
			},
			{
				"Avaric",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "av",
					GoogleCode = "-"
				}
			},
			{
				"Avestan",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ae",
					GoogleCode = "-"
				}
			},
			{
				"Aymara",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ay",
					GoogleCode = "-"
				}
			},
			{
				"Azerbaijani",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "az"
				}
			},
			{
				"Bambara",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "bm",
					GoogleCode = "-"
				}
			},
			{
				"Bashkir",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ba",
					GoogleCode = "-"
				}
			},
			{
				"Basque",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "eu"
				}
			},
			{
				"Basque/Spain",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "eu-ES",
					GoogleCode = "eu"
				}
			},
			{
				"Belarusian",
				new LanguageCodeDef
				{
					PluralRule = 6,
					Code = "be"
				}
			},
			{
				"Bengali",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "bn"
				}
			},
			{
				"Bihari",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "bh",
					GoogleCode = "-"
				}
			},
			{
				"Bislama",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "bi",
					GoogleCode = "-"
				}
			},
			{
				"Bosnian",
				new LanguageCodeDef
				{
					PluralRule = 6,
					Code = "bs"
				}
			},
			{
				"Breton",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "br",
					GoogleCode = "-"
				}
			},
			{
				"Bulgariaa",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "bg"
				}
			},
			{
				"Burmese",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "my"
				}
			},
			{
				"Catalan",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ca"
				}
			},
			{
				"Chamorro",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ch",
					GoogleCode = "-"
				}
			},
			{
				"Chechen",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ce",
					GoogleCode = "-"
				}
			},
			{
				"Chichewa",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ny"
				}
			},
			{
				"Chinese",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "zh",
					GoogleCode = "zh-CN",
					HasJoinedWords = true
				}
			},
			{
				"Chinese/Hong Kong",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "zh-HK",
					GoogleCode = "zh-TW",
					HasJoinedWords = true
				}
			},
			{
				"Chinese/Macau",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "zh-MO",
					GoogleCode = "zh-CN",
					HasJoinedWords = true
				}
			},
			{
				"Chinese/PRC",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "zh-CN",
					GoogleCode = "zh-CN",
					HasJoinedWords = true
				}
			},
			{
				"Chinese/Simplified",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "zh-CN",
					GoogleCode = "zh-CN",
					HasJoinedWords = true
				}
			},
			{
				"Chinese/Singapore",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "zh-SG",
					GoogleCode = "zh-CN",
					HasJoinedWords = true
				}
			},
			{
				"Chinese/Taiwan",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "zh-TW",
					GoogleCode = "zh-TW",
					HasJoinedWords = true
				}
			},
			{
				"Chinese/Traditional",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "zh-TW",
					GoogleCode = "zh-TW",
					HasJoinedWords = true
				}
			},
			{
				"Chuvash",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "cv",
					GoogleCode = "-"
				}
			},
			{
				"Cornish",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "kw",
					GoogleCode = "-"
				}
			},
			{
				"Corsican",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "co"
				}
			},
			{
				"Cree",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "cr",
					GoogleCode = "-"
				}
			},
			{
				"Croatian",
				new LanguageCodeDef
				{
					PluralRule = 6,
					Code = "hr"
				}
			},
			{
				"Croatian/Bosnia and Herzegovina",
				new LanguageCodeDef
				{
					PluralRule = 5,
					Code = "hr-BA",
					GoogleCode = "hr"
				}
			},
			{
				"Czech",
				new LanguageCodeDef
				{
					PluralRule = 7,
					Code = "cs"
				}
			},
			{
				"Danish",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "da"
				}
			},
			{
				"Divehi",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "dv",
					GoogleCode = "-"
				}
			},
			{
				"Dutch",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "nl"
				}
			},
			{
				"Dutch/Belgium",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "nl-BE",
					GoogleCode = "nl"
				}
			},
			{
				"Dutch/Netherlands",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "nl-NL",
					GoogleCode = "nl"
				}
			},
			{
				"Dzongkha",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "dz",
					GoogleCode = "-"
				}
			},
			{
				"English",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "en"
				}
			},
			{
				"English/Australia",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "en-AU",
					GoogleCode = "en"
				}
			},
			{
				"English/Belize",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "en-BZ",
					GoogleCode = "en"
				}
			},
			{
				"English/Canada",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "en-CA",
					GoogleCode = "en"
				}
			},
			{
				"English/Caribbean",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "en-CB",
					GoogleCode = "en"
				}
			},
			{
				"English/Ireland",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "en-IE",
					GoogleCode = "en"
				}
			},
			{
				"English/Jamaica",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "en-JM",
					GoogleCode = "en"
				}
			},
			{
				"English/New Zealand",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "en-NZ",
					GoogleCode = "en"
				}
			},
			{
				"English/Republic of the Philippines",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "en-PH",
					GoogleCode = "en"
				}
			},
			{
				"English/South Africa",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "en-ZA",
					GoogleCode = "en"
				}
			},
			{
				"English/Trinidad",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "en-TT",
					GoogleCode = "en"
				}
			},
			{
				"English/United Kingdom",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "en-GB",
					GoogleCode = "en"
				}
			},
			{
				"English/United States",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "en-US",
					GoogleCode = "en"
				}
			},
			{
				"English/Zimbabwe",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "en-ZW",
					GoogleCode = "en"
				}
			},
			{
				"Esperanto",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "eo"
				}
			},
			{
				"Estonian",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "et"
				}
			},
			{
				"Ewe",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ee",
					GoogleCode = "-"
				}
			},
			{
				"Faeroese",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "fo",
					GoogleCode = "-"
				}
			},
			{
				"Fijian",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "fj",
					GoogleCode = "-"
				}
			},
			{
				"Finnish",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "fi"
				}
			},
			{
				"French",
				new LanguageCodeDef
				{
					PluralRule = 2,
					Code = "fr"
				}
			},
			{
				"French/Belgium",
				new LanguageCodeDef
				{
					PluralRule = 2,
					Code = "fr-BE",
					GoogleCode = "fr"
				}
			},
			{
				"French/Canada",
				new LanguageCodeDef
				{
					PluralRule = 2,
					Code = "fr-CA",
					GoogleCode = "fr"
				}
			},
			{
				"French/France",
				new LanguageCodeDef
				{
					PluralRule = 2,
					Code = "fr-FR",
					GoogleCode = "fr"
				}
			},
			{
				"French/Luxembourg",
				new LanguageCodeDef
				{
					PluralRule = 2,
					Code = "fr-LU",
					GoogleCode = "fr"
				}
			},
			{
				"French/Principality of Monaco",
				new LanguageCodeDef
				{
					PluralRule = 2,
					Code = "fr-MC",
					GoogleCode = "fr"
				}
			},
			{
				"French/Switzerland",
				new LanguageCodeDef
				{
					PluralRule = 2,
					Code = "fr-CH",
					GoogleCode = "fr"
				}
			},
			{
				"Fulah",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ff",
					GoogleCode = "-"
				}
			},
			{
				"Galician",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "gl"
				}
			},
			{
				"Galician/Spain",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "gl-ES",
					GoogleCode = "gl"
				}
			},
			{
				"Georgian",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "ka"
				}
			},
			{
				"German",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "de"
				}
			},
			{
				"German/Austria",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "de-AT",
					GoogleCode = "de"
				}
			},
			{
				"German/Germany",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "de-DE",
					GoogleCode = "de"
				}
			},
			{
				"German/Liechtenstein",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "de-LI",
					GoogleCode = "de"
				}
			},
			{
				"German/Luxembourg",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "de-LU",
					GoogleCode = "de"
				}
			},
			{
				"German/Switzerland",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "de-CH",
					GoogleCode = "de"
				}
			},
			{
				"Greek",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "el"
				}
			},
			{
				"Guaraní",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "gn",
					GoogleCode = "-"
				}
			},
			{
				"Gujarati",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "gu"
				}
			},
			{
				"Haitian",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ht"
				}
			},
			{
				"Hausa",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ha"
				}
			},
			{
				"Hebrew",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "he",
					GoogleCode = "iw"
				}
			},
			{
				"Herero",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "hz",
					GoogleCode = "-"
				}
			},
			{
				"Hindi",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "hi"
				}
			},
			{
				"Hiri Motu",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ho",
					GoogleCode = "-"
				}
			},
			{
				"Hungarian",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "hu"
				}
			},
			{
				"Interlingua",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ia",
					GoogleCode = "-"
				}
			},
			{
				"Indonesian",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "id"
				}
			},
			{
				"Interlingue",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ie",
					GoogleCode = "-"
				}
			},
			{
				"Irish",
				new LanguageCodeDef
				{
					PluralRule = 10,
					Code = "ga"
				}
			},
			{
				"Igbo",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ig"
				}
			},
			{
				"Inupiaq",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ik",
					GoogleCode = "-"
				}
			},
			{
				"Ido",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "io",
					GoogleCode = "-"
				}
			},
			{
				"Icelandic",
				new LanguageCodeDef
				{
					PluralRule = 14,
					Code = "is"
				}
			},
			{
				"Italian",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "it"
				}
			},
			{
				"Italian/Italy",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "it-IT",
					GoogleCode = "it"
				}
			},
			{
				"Italian/Switzerland",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "it-CH",
					GoogleCode = "it"
				}
			},
			{
				"Inuktitut",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "iu",
					GoogleCode = "-"
				}
			},
			{
				"Japanese",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "ja",
					HasJoinedWords = true
				}
			},
			{
				"Javanese",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "jv"
				}
			},
			{
				"Kalaallisut",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "kl",
					GoogleCode = "-"
				}
			},
			{
				"Kannada",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "kn"
				}
			},
			{
				"Kanuri",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "kr",
					GoogleCode = "-"
				}
			},
			{
				"Kashmiri",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ks",
					GoogleCode = "-"
				}
			},
			{
				"Kazakh",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "kk"
				}
			},
			{
				"Central Khmer",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "km"
				}
			},
			{
				"Kikuyu",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ki",
					GoogleCode = "-"
				}
			},
			{
				"Kinyarwanda",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "rw",
					GoogleCode = "-"
				}
			},
			{
				"Kirghiz",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ky"
				}
			},
			{
				"Komi",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "kv",
					GoogleCode = "-"
				}
			},
			{
				"Kongo",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "kg",
					GoogleCode = "-"
				}
			},
			{
				"Korean",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "ko"
				}
			},
			{
				"Kurdish",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ku"
				}
			},
			{
				"Kuanyama",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "kj",
					GoogleCode = "-"
				}
			},
			{
				"Latin",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "la"
				}
			},
			{
				"Luxembourgish",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "lb"
				}
			},
			{
				"Ganda",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "lg",
					GoogleCode = "-"
				}
			},
			{
				"Limburgan",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "li",
					GoogleCode = "-"
				}
			},
			{
				"Lingala",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ln",
					GoogleCode = "-"
				}
			},
			{
				"Lao",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "lo"
				}
			},
			{
				"Latvian",
				new LanguageCodeDef
				{
					PluralRule = 5,
					Code = "lv"
				}
			},
			{
				"Luba-Katanga",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "lu",
					GoogleCode = "-"
				}
			},
			{
				"Lithuanian",
				new LanguageCodeDef
				{
					PluralRule = 5,
					Code = "lt"
				}
			},
			{
				"Manx",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "gv",
					GoogleCode = "-"
				}
			},
			{
				"Macedonian",
				new LanguageCodeDef
				{
					PluralRule = 13,
					Code = "mk"
				}
			},
			{
				"Malagasy",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "mg"
				}
			},
			{
				"Malay",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "ms"
				}
			},
			{
				"Malay/Brunei Darussalam",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "ms-BN",
					GoogleCode = "ms"
				}
			},
			{
				"Malay/Malaysia",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "ms-MY",
					GoogleCode = "ms"
				}
			},
			{
				"Malayalam",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ml"
				}
			},
			{
				"Maltese",
				new LanguageCodeDef
				{
					PluralRule = 12,
					Code = "mt"
				}
			},
			{
				"Maori",
				new LanguageCodeDef
				{
					PluralRule = 2,
					Code = "mi"
				}
			},
			{
				"Marathi",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "mr"
				}
			},
			{
				"Marshallese",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "mh",
					GoogleCode = "-"
				}
			},
			{
				"Mongolian",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "mn"
				}
			},
			{
				"Nauru",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "na",
					GoogleCode = "-"
				}
			},
			{
				"Navajo",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "nv",
					GoogleCode = "-"
				}
			},
			{
				"North Ndebele",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "nd",
					GoogleCode = "-"
				}
			},
			{
				"Nepali",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ne"
				}
			},
			{
				"Ndonga",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ng",
					GoogleCode = "-"
				}
			},
			{
				"Northern Sotho",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ns",
					GoogleCode = "st"
				}
			},
			{
				"Norwegian",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "nb",
					GoogleCode = "no"
				}
			},
			{
				"Norwegian/Nynorsk",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "nn",
					GoogleCode = "no"
				}
			},
			{
				"Sichuan Yi",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ii",
					GoogleCode = "-"
				}
			},
			{
				"South Ndebele",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "nr",
					GoogleCode = "-"
				}
			},
			{
				"Occitan",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "oc",
					GoogleCode = "-"
				}
			},
			{
				"Ojibwa",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "oj",
					GoogleCode = "-"
				}
			},
			{
				"Church\u00a0Slavic",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "cu",
					GoogleCode = "-"
				}
			},
			{
				"Oromo",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "om",
					GoogleCode = "-"
				}
			},
			{
				"Oriya",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "or",
					GoogleCode = "-"
				}
			},
			{
				"Ossetian",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "os",
					GoogleCode = "-"
				}
			},
			{
				"Pali",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "pi",
					GoogleCode = "-"
				}
			},
			{
				"Pashto",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ps"
				}
			},
			{
				"Persian",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "fa"
				}
			},
			{
				"Polish",
				new LanguageCodeDef
				{
					PluralRule = 8,
					Code = "pl"
				}
			},
			{
				"Portuguese",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "pt"
				}
			},
			{
				"Portuguese/Brazil",
				new LanguageCodeDef
				{
					PluralRule = 2,
					Code = "pt-BR",
					GoogleCode = "pt"
				}
			},
			{
				"Portuguese/Portugal",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "pt-PT",
					GoogleCode = "pt"
				}
			},
			{
				"Punjabi",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "pa"
				}
			},
			{
				"Quechua",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "qu",
					GoogleCode = "-"
				}
			},
			{
				"Quechua/Bolivia",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "qu-BO",
					GoogleCode = "-"
				}
			},
			{
				"Quechua/Ecuador",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "qu-EC",
					GoogleCode = "-"
				}
			},
			{
				"Quechua/Peru",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "qu-PE",
					GoogleCode = "-"
				}
			},
			{
				"Rhaeto-Romanic",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "rm",
					GoogleCode = "ro"
				}
			},
			{
				"Romanian",
				new LanguageCodeDef
				{
					PluralRule = 4,
					Code = "ro"
				}
			},
			{
				"Rundi",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "rn",
					GoogleCode = "-"
				}
			},
			{
				"Russian",
				new LanguageCodeDef
				{
					PluralRule = 6,
					Code = "ru"
				}
			},
			{
				"Russian/Republic of Moldova",
				new LanguageCodeDef
				{
					PluralRule = 6,
					Code = "ru-MO",
					GoogleCode = "ru"
				}
			},
			{
				"Sanskrit",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "sa",
					GoogleCode = "-"
				}
			},
			{
				"Sardinian",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "sc",
					GoogleCode = "-"
				}
			},
			{
				"Sindhi",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "sd"
				}
			},
			{
				"Northern Sami",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "se",
					GoogleCode = "-"
				}
			},
			{
				"Samoan",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "sm"
				}
			},
			{
				"Sango",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "sg",
					GoogleCode = "-"
				}
			},
			{
				"Serbian",
				new LanguageCodeDef
				{
					PluralRule = 6,
					Code = "sr"
				}
			},
			{
				"Serbian/Bosnia and Herzegovina",
				new LanguageCodeDef
				{
					PluralRule = 5,
					Code = "sr-BA",
					GoogleCode = "sr"
				}
			},
			{
				"Serbian/Serbia and Montenegro",
				new LanguageCodeDef
				{
					PluralRule = 5,
					Code = "sr-SP",
					GoogleCode = "sr"
				}
			},
			{
				"Scottish Gaelic",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "gd"
				}
			},
			{
				"Shona",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "sn"
				}
			},
			{
				"Sinhala",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "si"
				}
			},
			{
				"Slovak",
				new LanguageCodeDef
				{
					PluralRule = 7,
					Code = "sk"
				}
			},
			{
				"Slovenian",
				new LanguageCodeDef
				{
					PluralRule = 9,
					Code = "sl"
				}
			},
			{
				"Somali",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "so"
				}
			},
			{
				"Southern Sotho",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "st"
				}
			},
			{
				"Spanish",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es"
				}
			},
			{
				"Spanish/Argentina",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-AR",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Bolivia",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-BO",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Castilian",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-ES",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Chile",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-CL",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Colombia",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-CO",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Costa Rica",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-CR",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Dominican Republic",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-DO",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Ecuador",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-EC",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/El Salvador",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-SV",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Guatemala",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-GT",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Honduras",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-HN",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Mexico",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-MX",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Nicaragua",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-NI",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Panama",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-PA",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Paraguay",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-PY",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Peru",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-PE",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Puerto Rico",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-PR",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Spain",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-ES",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Uruguay",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-UY",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Venezuela",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-VE",
					GoogleCode = "es"
				}
			},
			{
				"Spanish/Latin Americas",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "es-US",
					GoogleCode = "es"
				}
			},
			{
				"Sundanese",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "su"
				}
			},
			{
				"Swahili",
				new LanguageCodeDef
				{
					Code = "sw"
				}
			},
			{
				"Swati",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ss",
					GoogleCode = "-"
				}
			},
			{
				"Swedish",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "sv"
				}
			},
			{
				"Swedish/Finland",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "sv-FI",
					GoogleCode = "sv"
				}
			},
			{
				"Swedish/Sweden",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "sv-SE",
					GoogleCode = "sv"
				}
			},
			{
				"Tamil",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ta"
				}
			},
			{
				"Tatar",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "tt",
					GoogleCode = "-"
				}
			},
			{
				"Telugu",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "te"
				}
			},
			{
				"Tajik",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "tg"
				}
			},
			{
				"Thai",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "th",
					HasJoinedWords = true
				}
			},
			{
				"Tigrinya",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ti",
					GoogleCode = "-"
				}
			},
			{
				"Tibetan",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "bo",
					GoogleCode = "-"
				}
			},
			{
				"Turkmen",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "tk",
					GoogleCode = "-"
				}
			},
			{
				"Tagalog",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "tl"
				}
			},
			{
				"Tswana",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "tn",
					GoogleCode = "-"
				}
			},
			{
				"Tonga",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "to",
					GoogleCode = "-"
				}
			},
			{
				"Turkish",
				new LanguageCodeDef
				{
					PluralRule = 0,
					Code = "tr"
				}
			},
			{
				"Tsonga",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ts",
					GoogleCode = "-"
				}
			},
			{
				"Twi",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "tw",
					GoogleCode = "-"
				}
			},
			{
				"Tahitian",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ty",
					GoogleCode = "-"
				}
			},
			{
				"Uighur",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ug",
					GoogleCode = "-"
				}
			},
			{
				"Ukrainian",
				new LanguageCodeDef
				{
					PluralRule = 6,
					Code = "uk"
				}
			},
			{
				"Urdu",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ur"
				}
			},
			{
				"Uzbek",
				new LanguageCodeDef
				{
					PluralRule = 2,
					Code = "uz"
				}
			},
			{
				"Venda",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "ve",
					GoogleCode = "-"
				}
			},
			{
				"Vietnamese",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "vi"
				}
			},
			{
				"Volapük",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "vo",
					GoogleCode = "-"
				}
			},
			{
				"Walloon",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "wa",
					GoogleCode = "-"
				}
			},
			{
				"Welsh",
				new LanguageCodeDef
				{
					PluralRule = 16,
					Code = "cy"
				}
			},
			{
				"Wolof",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "wo",
					GoogleCode = "-"
				}
			},
			{
				"Frisian",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "fy"
				}
			},
			{
				"Xhosa",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "xh"
				}
			},
			{
				"Yiddish",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "yi"
				}
			},
			{
				"Yoruba",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "yo"
				}
			},
			{
				"Zhuang",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "za",
					GoogleCode = "-"
				}
			},
			{
				"Zulu",
				new LanguageCodeDef
				{
					PluralRule = 1,
					Code = "zu"
				}
			}
		};

		public static string GetLanguageCode(string Filter, bool ShowWarnings = false)
		{
			if (string.IsNullOrEmpty(Filter))
			{
				return string.Empty;
			}
			string[] filters = Filter.ToLowerInvariant().Split(" /(),".ToCharArray());
			foreach (KeyValuePair<string, LanguageCodeDef> item in mLanguageDef)
			{
				if (LanguageMatchesFilter(item.Key, filters))
				{
					return item.Value.Code;
				}
			}
			if (ShowWarnings)
			{
				UnityEngine.Debug.Log($"Language '{Filter}' not recognized. Please, add the language code to GoogleTranslation.cs");
			}
			return string.Empty;
		}

		public static List<string> GetLanguagesForDropdown(string Filter, string CodesToExclude)
		{
			string[] filters = Filter.ToLowerInvariant().Split(" /(),".ToCharArray());
			List<string> list = new List<string>();
			foreach (KeyValuePair<string, LanguageCodeDef> item in mLanguageDef)
			{
				if (string.IsNullOrEmpty(Filter) || LanguageMatchesFilter(item.Key, filters))
				{
					string text = string.Concat("[" + item.Value.Code + "]");
					if (!CodesToExclude.Contains(text))
					{
						list.Add(item.Key + " " + text);
					}
				}
			}
			for (int num = list.Count - 2; num >= 0; num--)
			{
				string text2 = list[num].Substring(0, list[num].IndexOf(" ["));
				if (list[num + 1].StartsWith(text2))
				{
					list[num] = text2 + "/" + list[num];
					list.Insert(num + 1, text2 + "/");
				}
			}
			return list;
		}

		private static bool LanguageMatchesFilter(string Language, string[] Filters)
		{
			Language = Language.ToLowerInvariant();
			int i = 0;
			for (int num = Filters.Length; i < num; i++)
			{
				if (Filters[i] != "")
				{
					if (!Language.Contains(Filters[i].ToLower()))
					{
						return false;
					}
					Language = Language.Remove(Language.IndexOf(Filters[i]), Filters[i].Length);
				}
			}
			return true;
		}

		public static string GetFormatedLanguageName(string Language)
		{
			string empty = string.Empty;
			int num = Language.IndexOf(" [");
			if (num > 0)
			{
				Language = Language.Substring(0, num);
			}
			num = Language.IndexOf('/');
			if (num > 0)
			{
				empty = Language.Substring(0, num);
				if (Language == empty + "/" + empty)
				{
					return empty;
				}
				Language = Language.Replace("/", " (") + ")";
			}
			return Language;
		}

		public static string GetCodedLanguage(string Language, string code)
		{
			string languageCode = GetLanguageCode(Language);
			if (string.Compare(code, languageCode, StringComparison.OrdinalIgnoreCase) == 0)
			{
				return Language;
			}
			return Language + " [" + code + "]";
		}

		public static void UnPackCodeFromLanguageName(string CodedLanguage, out string Language, out string code)
		{
			if (string.IsNullOrEmpty(CodedLanguage))
			{
				Language = string.Empty;
				code = string.Empty;
				return;
			}
			int num = CodedLanguage.IndexOf("[");
			if (num < 0)
			{
				Language = CodedLanguage;
				code = GetLanguageCode(Language);
			}
			else
			{
				Language = CodedLanguage.Substring(0, num).Trim();
				code = CodedLanguage.Substring(num + 1, CodedLanguage.IndexOf("]", num) - num - 1);
			}
		}

		public static string GetGoogleLanguageCode(string InternationalCode)
		{
			foreach (KeyValuePair<string, LanguageCodeDef> item in mLanguageDef)
			{
				if (InternationalCode == item.Value.Code)
				{
					if (item.Value.GoogleCode == "-")
					{
						return null;
					}
					return (!string.IsNullOrEmpty(item.Value.GoogleCode)) ? item.Value.GoogleCode : InternationalCode;
				}
			}
			return InternationalCode;
		}

		public static string GetLanguageName(string code, bool useParenthesesForRegion = false, bool allowDiscardRegion = true)
		{
			foreach (KeyValuePair<string, LanguageCodeDef> item in mLanguageDef)
			{
				if (!(code == item.Value.Code))
				{
					continue;
				}
				string text = item.Key;
				if (useParenthesesForRegion)
				{
					int num = text.IndexOf('/');
					if (num > 0)
					{
						text = text.Substring(0, num) + " (" + text.Substring(num + 1) + ")";
					}
				}
				return text;
			}
			if (allowDiscardRegion)
			{
				int num2 = code.IndexOf("-");
				if (num2 > 0)
				{
					return GetLanguageName(code.Substring(0, num2), useParenthesesForRegion, allowDiscardRegion: false);
				}
			}
			return null;
		}

		public static List<string> GetAllInternationalCodes()
		{
			HashSet<string> hashSet = new HashSet<string>();
			foreach (KeyValuePair<string, LanguageCodeDef> item in mLanguageDef)
			{
				hashSet.Add(item.Value.Code);
			}
			return new List<string>(hashSet);
		}

		public static bool LanguageCode_HasJoinedWord(string languageCode)
		{
			foreach (KeyValuePair<string, LanguageCodeDef> item in mLanguageDef)
			{
				if (languageCode == item.Value.GoogleCode || languageCode == item.Value.Code)
				{
					return item.Value.HasJoinedWords;
				}
			}
			return false;
		}

		private static int GetPluralRule(string langCode)
		{
			if (langCode.Length > 2)
			{
				langCode = langCode.Substring(0, 2);
			}
			langCode = langCode.ToLower();
			foreach (KeyValuePair<string, LanguageCodeDef> item in mLanguageDef)
			{
				if (item.Value.Code == langCode)
				{
					return item.Value.PluralRule;
				}
			}
			return 0;
		}

		public static bool LanguageHasPluralType(string langCode, string pluralType)
		{
			switch (pluralType)
			{
			case "Plural":
			case "Zero":
			case "One":
				return true;
			default:
				switch (GetPluralRule(langCode))
				{
				case 3:
					if (!(pluralType == "Two"))
					{
						return pluralType == "Few";
					}
					return true;
				case 4:
				case 5:
				case 6:
				case 7:
				case 8:
					return pluralType == "Few";
				case 9:
					if (!(pluralType == "Two"))
					{
						return pluralType == "Few";
					}
					return true;
				case 10:
				case 11:
				case 15:
				case 16:
					if (!(pluralType == "Two") && !(pluralType == "Few"))
					{
						return pluralType == "Many";
					}
					return true;
				case 12:
					if (!(pluralType == "Few"))
					{
						return pluralType == "Many";
					}
					return true;
				case 13:
					return pluralType == "Two";
				default:
					return false;
				}
			}
		}

		public static ePluralType GetPluralType(string langCode, int n)
		{
			switch (n)
			{
			case 0:
				return ePluralType.Zero;
			case 1:
				return ePluralType.One;
			default:
				switch (GetPluralRule(langCode))
				{
				case 0:
					return ePluralType.Plural;
				case 1:
					if (n != 1)
					{
						return ePluralType.Plural;
					}
					return ePluralType.One;
				case 2:
					if (n > 1)
					{
						return ePluralType.Plural;
					}
					return ePluralType.One;
				case 3:
					switch (n)
					{
					default:
						if (!inRange(n, 3, 10) && !inRange(n, 13, 19))
						{
							return ePluralType.Plural;
						}
						return ePluralType.Few;
					case 2:
					case 12:
						return ePluralType.Two;
					case 1:
					case 11:
						return ePluralType.One;
					}
				case 4:
					if (n != 1)
					{
						if (!inRange(n % 100, 1, 19))
						{
							return ePluralType.Plural;
						}
						return ePluralType.Few;
					}
					return ePluralType.One;
				case 5:
					if (n % 10 != 1 || n % 100 == 11)
					{
						if (n % 10 < 2 || (n % 100 >= 10 && n % 100 < 20))
						{
							return ePluralType.Plural;
						}
						return ePluralType.Few;
					}
					return ePluralType.One;
				case 6:
					if (n % 10 != 1 || n % 100 == 11)
					{
						if (!inRange(n % 10, 2, 4) || inRange(n % 100, 12, 14))
						{
							return ePluralType.Plural;
						}
						return ePluralType.Few;
					}
					return ePluralType.One;
				case 7:
					if (n != 1)
					{
						if (!inRange(n, 2, 4))
						{
							return ePluralType.Plural;
						}
						return ePluralType.Few;
					}
					return ePluralType.One;
				case 8:
					if (n != 1)
					{
						if (!inRange(n % 10, 2, 4) || inRange(n % 100, 12, 14))
						{
							return ePluralType.Plural;
						}
						return ePluralType.Few;
					}
					return ePluralType.One;
				case 9:
					if (n % 100 != 1)
					{
						if (n % 100 != 2)
						{
							if (!inRange(n % 100, 3, 4))
							{
								return ePluralType.Plural;
							}
							return ePluralType.Few;
						}
						return ePluralType.Two;
					}
					return ePluralType.One;
				case 10:
					switch (n)
					{
					default:
						if (!inRange(n, 3, 6))
						{
							if (!inRange(n, 7, 10))
							{
								return ePluralType.Plural;
							}
							return ePluralType.Many;
						}
						return ePluralType.Few;
					case 2:
						return ePluralType.Two;
					case 1:
						return ePluralType.One;
					}
				case 11:
					switch (n)
					{
					default:
						if (!inRange(n % 100, 3, 10))
						{
							if (n % 100 < 11)
							{
								return ePluralType.Plural;
							}
							return ePluralType.Many;
						}
						return ePluralType.Few;
					case 2:
						return ePluralType.Two;
					case 1:
						return ePluralType.One;
					case 0:
						return ePluralType.Zero;
					}
				case 12:
					if (n != 1)
					{
						if (!inRange(n % 100, 1, 10))
						{
							if (!inRange(n % 100, 11, 19))
							{
								return ePluralType.Plural;
							}
							return ePluralType.Many;
						}
						return ePluralType.Few;
					}
					return ePluralType.One;
				case 13:
					if (n % 10 != 1)
					{
						if (n % 10 != 2)
						{
							return ePluralType.Plural;
						}
						return ePluralType.Two;
					}
					return ePluralType.One;
				case 14:
					if (n % 10 != 1 || n % 100 == 11)
					{
						return ePluralType.Plural;
					}
					return ePluralType.One;
				case 15:
					if (n % 10 != 1 || n % 100 == 11 || n % 100 == 71 || n % 100 == 91)
					{
						if (n % 10 != 2 || n % 100 == 12 || n % 100 == 72 || n % 100 == 92)
						{
							if ((n % 10 != 3 && n % 10 != 4 && n % 10 != 9) || n % 100 == 13 || n % 100 == 14 || n % 100 == 19 || n % 100 == 73 || n % 100 == 74 || n % 100 == 79 || n % 100 == 93 || n % 100 == 94 || n % 100 == 99)
							{
								if (n % 1000000 != 0)
								{
									return ePluralType.Plural;
								}
								return ePluralType.Many;
							}
							return ePluralType.Few;
						}
						return ePluralType.Two;
					}
					return ePluralType.One;
				case 16:
					return n switch
					{
						6 => ePluralType.Many, 
						3 => ePluralType.Few, 
						2 => ePluralType.Two, 
						1 => ePluralType.One, 
						0 => ePluralType.Zero, 
						_ => ePluralType.Plural, 
					};
				default:
					return ePluralType.Plural;
				}
			}
		}

		public static int GetPluralTestNumber(string langCode, ePluralType pluralType)
		{
			switch (pluralType)
			{
			case ePluralType.Zero:
				return 0;
			case ePluralType.One:
				return 1;
			case ePluralType.Few:
				return 3;
			case ePluralType.Many:
				switch (GetPluralRule(langCode))
				{
				case 10:
					return 8;
				case 11:
				case 12:
					return 13;
				case 15:
					return 1000000;
				default:
					return 6;
				}
			default:
				return 936;
			}
		}

		private static bool inRange(int amount, int min, int max)
		{
			if (amount >= min)
			{
				return amount <= max;
			}
			return false;
		}
	}
	public enum KeyType
	{
		Text,
		Font
	}
	public enum TranslationFlag : byte
	{
		Normal = 1,
		AutoTranslated
	}
	[Serializable]
	public class KeyData
	{
		public string key = string.Empty;

		public KeyType keyType;

		public string[] Languages = new string[0];

		public byte[] Flags = new byte[0];

		public string GetTranslation(int idx, string specialization = null, bool editMode = false)
		{
			string text = Languages[idx];
			if (text != null)
			{
				text = SpecializationManager.GetSpecializedText(text, specialization);
				if (!editMode)
				{
					text = text.Replace("[i2nt]", "").Replace("[/i2nt]", "");
				}
			}
			return text;
		}

		public void SetTranslation(int idx, string translation, string specialization = null)
		{
			Languages[idx] = SpecializationManager.SetSpecializedText(Languages[idx], translation, specialization);
		}

		public void RemoveSpecialization(string specialization)
		{
			for (int i = 0; i < Languages.Length; i++)
			{
				RemoveSpecialization(i, specialization);
			}
		}

		public void RemoveSpecialization(int idx, string specialization)
		{
			string text = Languages[idx];
			if (!(specialization == "Quest") && text.Contains("[i2s_" + specialization + "]"))
			{
				Dictionary<string, string> specializations = SpecializationManager.GetSpecializations(text);
				specializations.Remove(specialization);
				Languages[idx] = SpecializationManager.SetSpecializedText(specializations);
			}
		}

		public bool IsAutoTranslated(int idx, bool IsTouch)
		{
			return (Flags[idx] & 2) > 0;
		}

		public void Validate()
		{
			int num = Mathf.Max(Languages.Length, Flags.Length);
			if (Languages.Length != num)
			{
				Array.Resize(ref Languages, num);
			}
			if (Flags.Length != num)
			{
				Array.Resize(ref Flags, num);
			}
		}

		public bool IsKey(string name, bool allowCategoryMistmatch)
		{
			if (!allowCategoryMistmatch)
			{
				return name == key;
			}
			return name == LanguageSourceData.GetKeyFromFullKey(key);
		}

		public bool HasSpecializations()
		{
			for (int i = 0; i < Languages.Length; i++)
			{
				if (!string.IsNullOrEmpty(Languages[i]) && Languages[i].Contains("[i2s_"))
				{
					return true;
				}
			}
			return false;
		}

		public List<string> GetAllSpecializations()
		{
			List<string> list = new List<string>();
			for (int i = 0; i < Languages.Length; i++)
			{
				SpecializationManager.AppendSpecializations(Languages[i], list);
			}
			return list;
		}
	}
	public class KeysPopup : PropertyAttribute
	{
		public string Filter { get; private set; }

		public KeysPopup(string filter = "")
		{
			Filter = filter;
		}
	}
	public enum eLanguageDataFlags
	{
		DISABLED = 1,
		KEEP_LOADED = 2,
		NOT_LOADED = 4
	}
	[Serializable]
	public class LanguageData
	{
		public string Name;

		public string Code;

		public byte Flags;

		[NonSerialized]
		public bool Compressed;

		public bool IsEnabled()
		{
			return (Flags & 1) == 0;
		}

		public void SetEnabled(bool bEnabled)
		{
			if (bEnabled)
			{
				Flags = (byte)(Flags & 0xFFFFFFFEu);
			}
			else
			{
				Flags |= 1;
			}
		}

		public bool IsLoaded()
		{
			return (Flags & 4) == 0;
		}

		public bool CanBeUnloaded()
		{
			return (Flags & 2) == 0;
		}

		public void SetLoaded(bool loaded)
		{
			if (loaded)
			{
				Flags = (byte)(Flags & 0xFFFFFFFBu);
			}
			else
			{
				Flags |= 4;
			}
		}

		public void SetCanBeUnLoaded(bool allowUnloading)
		{
			if (allowUnloading)
			{
				Flags = (byte)(Flags & 0xFFFFFFFDu);
			}
			else
			{
				Flags |= 2;
			}
		}
	}
	[ExecuteInEditMode]
	public class LanguageSource : MonoBehaviour, ISerializationCallbackReceiver, ILanguageSource
	{
		public LanguageSourceData source = new LanguageSourceData();

		public int version;

		public bool NeverDestroy;

		public bool userAgreesToHaveItOnTheScene;

		public bool userAgreesToHaveItInsideThePluginsFolder;

		public List<UnityEngine.Object> assets = new List<UnityEngine.Object>();

		public List<LanguageData> lLanguages = new List<LanguageData>();

		private bool IgnoreDeviceLanguage = true;

		public LanguageSourceData.AllowUnloadLanguages allowUnloadingLanguages;

		public List<KeyData> keys = new List<KeyData>();

		public LanguageSourceData.MissingTranslationAction OnMissingTranslation = LanguageSourceData.MissingTranslationAction.Fallback;

		public string key_AppName;

		public LanguageSourceData SourceData
		{
			get
			{
				return source;
			}
			set
			{
				source = value;
			}
		}

		private void Awake()
		{
			source.owner = this;
			source.Awake();
		}

		private void OnDestroy()
		{
			NeverDestroy = false;
			if (!NeverDestroy)
			{
				source.OnDestroy();
			}
		}

		public string GetSourceName()
		{
			string text = base.gameObject.name;
			Transform parent = base.transform.parent;
			while ((bool)parent)
			{
				text = parent.name + "_" + text;
				parent = parent.parent;
			}
			return text;
		}

		public void OnBeforeSerialize()
		{
			version = 1;
		}

		public void OnAfterDeserialize()
		{
			if (version != 0 && source != null)
			{
				return;
			}
			source = new LanguageSourceData();
			source.owner = this;
			source.userAgreesToHaveItOnTheScene = userAgreesToHaveItOnTheScene;
			source.userAgreesToHaveItInsideThePluginsFolder = userAgreesToHaveItInsideThePluginsFolder;
			source.ignoreDeviceLanguage = IgnoreDeviceLanguage;
			source.allowUnloadLanguages = allowUnloadingLanguages;
			source.OnMissingTranslation = OnMissingTranslation;
			source.key_AppName = key_AppName;
			if (lLanguages != null && lLanguages.Count > 0)
			{
				source.languages.Clear();
				source.languages.AddRange(lLanguages);
				lLanguages.Clear();
			}
			if (assets != null && assets.Count > 0)
			{
				source.assets.Clear();
				source.assets.AddRange(assets);
				assets.Clear();
			}
			if (keys != null && keys.Count > 0)
			{
				source.keys.Clear();
				for (int i = 0; i < keys.Count; i++)
				{
					source.keys.Add(keys[i]);
				}
				keys.Clear();
			}
			version = 1;
		}
	}
	[CreateAssetMenu(fileName = "Languages", menuName = "Localization/LanguageSource", order = 1)]
	public class LanguageSourceAsset : ScriptableObject, ILanguageSource
	{
		public LanguageSourceData source = new LanguageSourceData();

		public LanguageSourceData SourceData
		{
			get
			{
				return source;
			}
			set
			{
				source = value;
			}
		}
	}
	public enum FileUpdateMode
	{
		None,
		Replace,
		Merge,
		AddNewKeys
	}
	public interface ILanguageSource
	{
		LanguageSourceData SourceData { get; set; }
	}
	[Serializable]
	[ExecuteInEditMode]
	public class LanguageSourceData
	{
		public enum MissingTranslationAction
		{
			Empty,
			Fallback,
			ShowWarning,
			ShowKey
		}

		public enum AllowUnloadLanguages
		{
			Never,
			OnlyInDevice,
			EditorAndDevice
		}

		[NonSerialized]
		public ILanguageSource owner;

		public bool userAgreesToHaveItOnTheScene;

		public bool userAgreesToHaveItInsideThePluginsFolder;

		[NonSerialized]
		public bool mIsGlobalSource;

		public List<KeyData> keys = new List<KeyData>();

		[NonSerialized]
		public Dictionary<string, KeyData> dictionary = new Dictionary<string, KeyData>(StringComparer.Ordinal);

		public MissingTranslationAction OnMissingTranslation = MissingTranslationAction.Fallback;

		public string key_AppName;

		public List<LanguageData> languages = new List<LanguageData>();

		public bool ignoreDeviceLanguage = true;

		public AllowUnloadLanguages allowUnloadLanguages;

		public List<UnityEngine.Object> assets = new List<UnityEngine.Object>();

		[NonSerialized]
		public Dictionary<string, UnityEngine.Object> assetDictionary = new Dictionary<string, UnityEngine.Object>(StringComparer.Ordinal);

		public static string EmptyCategory = "Default";

		public static char[] CategorySeparators = "/\\".ToCharArray();

		public UnityEngine.Object ownerObject => owner as UnityEngine.Object;

		public void Awake()
		{
			LocalizationManager.AddSource(this);
			UpdateDictionary();
			UpdateAssetDictionary();
			LocalizationManager.LocalizeAll(Force: true);
		}

		public void OnDestroy()
		{
			LocalizationManager.RemoveSource(this);
		}

		public bool IsEqualTo(LanguageSourceData Source)
		{
			if (Source.languages.Count != languages.Count)
			{
				return false;
			}
			int i = 0;
			for (int count = languages.Count; i < count; i++)
			{
				if (Source.GetLanguageIndex(languages[i].Name) < 0)
				{
					return false;
				}
			}
			if (Source.keys.Count != keys.Count)
			{
				return false;
			}
			for (int j = 0; j < keys.Count; j++)
			{
				if (Source.GetKeyData(keys[j].key) == null)
				{
					return false;
				}
			}
			return true;
		}

		internal bool ManagerHasASimilarSource()
		{
			int i = 0;
			for (int count = LocalizationManager.Sources.Count; i < count; i++)
			{
				LanguageSourceData languageSourceData = LocalizationManager.Sources[i];
				if (languageSourceData != null && languageSourceData.IsEqualTo(this) && languageSourceData != this)
				{
					return true;
				}
			}
			return false;
		}

		public void ClearAllData()
		{
			keys.Clear();
			languages.Clear();
			dictionary.Clear();
			assetDictionary.Clear();
		}

		public bool IsGlobalSource()
		{
			return mIsGlobalSource;
		}

		public void Editor_SetDirty()
		{
		}

		public void UpdateAssetDictionary()
		{
			assets.RemoveAll((UnityEngine.Object x) => x == null);
			assetDictionary = (from o in assets.Distinct()
				group o by o.name).ToDictionary((IGrouping<string, UnityEngine.Object> g) => g.Key, (IGrouping<string, UnityEngine.Object> g) => g.First());
		}

		public UnityEngine.Object FindAsset(string Name)
		{
			if (assets != null)
			{
				if (assetDictionary == null || assetDictionary.Count != assets.Count)
				{
					UpdateAssetDictionary();
				}
				if (assetDictionary.TryGetValue(Name, out var value))
				{
					return value;
				}
			}
			return null;
		}

		public bool HasAsset(UnityEngine.Object Obj)
		{
			return assets.Contains(Obj);
		}

		public void AddAsset(UnityEngine.Object Obj)
		{
			if (!assets.Contains(Obj))
			{
				assets.Add(Obj);
				UpdateAssetDictionary();
			}
		}

		public string Import_CSV(string Category, string CSVstring, FileUpdateMode UpdateMode = FileUpdateMode.Replace, char Separator = ',')
		{
			List<string[]> cSV = LocalizationReader.ReadCSV(CSVstring, Separator);
			return Import_CSV(Category, cSV, UpdateMode);
		}

		public string Import_CSV(string Category, List<string[]> CSV, FileUpdateMode UpdateMode = FileUpdateMode.Replace)
		{
			string[] array = CSV[0];
			int num = 1;
			string[] texts = new string[1] { "Key" };
			string[] texts2 = new string[1] { "Type" };
			string[] texts3 = new string[2] { "Desc", "Description" };
			if (array.Length > 1 && ArrayContains(array[0], texts))
			{
				if (UpdateMode == FileUpdateMode.Replace)
				{
					ClearAllData();
				}
				if (array.Length > 2)
				{
					if (ArrayContains(array[1], texts2))
					{
						num = 2;
					}
					if (ArrayContains(array[1], texts3))
					{
						num = 2;
					}
				}
				if (array.Length > 3)
				{
					if (ArrayContains(array[2], texts2))
					{
						num = 3;
					}
					if (ArrayContains(array[2], texts3))
					{
						num = 3;
					}
				}
				int num2 = Mathf.Max(array.Length - num, 0);
				int[] array2 = new int[num2];
				for (int i = 0; i < num2; i++)
				{
					if (string.IsNullOrEmpty(array[i + num]))
					{
						array2[i] = -1;
						continue;
					}
					string text = array[i + num];
					bool flag = true;
					if (text.StartsWith("$"))
					{
						flag = false;
						text = text.Substring(1);
					}
					GoogleLanguages.UnPackCodeFromLanguageName(text, out var Language, out var code);
					int num3 = -1;
					num3 = (string.IsNullOrEmpty(code) ? GetLanguageIndex(Language, AllowDiscartingRegion: true, SkipDisabled: false) : GetLanguageIndexFromCode(code));
					if (num3 < 0)
					{
						LanguageData languageData = new LanguageData();
						languageData.Name = Language;
						languageData.Code = code;
						languageData.Flags = (byte)(0u | ((!flag) ? 1u : 0u));
						languages.Add(languageData);
						num3 = languages.Count - 1;
					}
					array2[i] = num3;
				}
				num2 = languages.Count;
				int j = 0;
				for (int count = keys.Count; j < count; j++)
				{
					KeyData keyData = keys[j];
					if (keyData.Languages.Length < num2)
					{
						Array.Resize(ref keyData.Languages, num2);
						Array.Resize(ref keyData.Flags, num2);
					}
				}
				int k = 1;
				for (int count2 = CSV.Count; k < count2; k++)
				{
					array = CSV[k];
					string key = (string.IsNullOrEmpty(Category) ? array[0] : (Category + "/" + array[0]));
					char[] array3 = key.ToCharArray();
					int num4 = key.LastIndexOf("_");
					if (num4 != -1)
					{
						array3[num4] = '/';
						key = new string(array3);
					}
					string text2 = null;
					if (key.EndsWith("]"))
					{
						int num5 = key.LastIndexOf('[');
						if (num5 > 0)
						{
							text2 = key.Substring(num5 + 1, key.Length - num5 - 2);
							if (text2 == "touch")
							{
								text2 = "Touch";
							}
							key = key.Remove(num5);
						}
					}
					ValidateFullKey(ref key);
					if (string.IsNullOrEmpty(key))
					{
						continue;
					}
					KeyData keyData2 = GetKeyData(key);
					if (keyData2 == null)
					{
						keyData2 = new KeyData();
						keyData2.key = key;
						keyData2.Languages = new string[languages.Count];
						keyData2.Flags = new byte[languages.Count];
						for (int l = 0; l < languages.Count; l++)
						{
							keyData2.Languages[l] = string.Empty;
						}
						keys.Add(keyData2);
						dictionary.Add(key, keyData2);
					}
					else if (UpdateMode == FileUpdateMode.AddNewKeys)
					{
						continue;
					}
					for (int m = 0; m < array2.Length && m < array.Length - num; m++)
					{
						if (string.IsNullOrEmpty(array[m + num]))
						{
							continue;
						}
						int num6 = array2[m];
						if (num6 >= 0)
						{
							string text3 = array[m + num];
							if (text3 == "-")
							{
								text3 = string.Empty;
							}
							else if (text3 == "")
							{
								text3 = null;
							}
							keyData2.SetTranslation(num6, text3, text2);
						}
					}
				}
				if (UnityEngine.Application.isPlaying)
				{
					SaveLanguages(HasUnloadedLanguages());
				}
				return string.Empty;
			}
			return "잘못된 포맷.";
		}

		private bool ArrayContains(string MainText, params string[] texts)
		{
			int i = 0;
			for (int num = texts.Length; i < num; i++)
			{
				if (MainText.IndexOf(texts[i], StringComparison.OrdinalIgnoreCase) >= 0)
				{
					return true;
				}
			}
			return false;
		}

		private void Import_Language_from_Cache(int langIndex, string langData, bool useFallback, bool onlyCurrentSpecialization)
		{
			int num = 0;
			while (num < langData.Length)
			{
				int num2 = langData.IndexOf("[i2t]", num);
				if (num2 < 0)
				{
					num2 = langData.Length;
				}
				int num3 = langData.IndexOf("=", num);
				if (num3 >= num2)
				{
					break;
				}
				string key = langData.Substring(num, num3 - num);
				num = num3 + 1;
				KeyData keyData = GetKeyData(key);
				if (keyData != null)
				{
					string text = null;
					if (num != num2)
					{
						text = langData.Substring(num, num2 - num);
						if (text.StartsWith("[i2fb]"))
						{
							text = (useFallback ? text.Substring(6) : null);
						}
						if (onlyCurrentSpecialization && text != null)
						{
							text = SpecializationManager.GetSpecializedText(text);
						}
					}
					keyData.Languages[langIndex] = text;
				}
				num = num2 + 5;
			}
		}

		public void UpdateDictionary(bool force = false)
		{
			if (force || dictionary == null || dictionary.Count != keys.Count)
			{
				StringComparer ordinal = StringComparer.Ordinal;
				if (dictionary.Comparer != ordinal)
				{
					dictionary = new Dictionary<string, KeyData>(ordinal);
				}
				else
				{
					dictionary.Clear();
				}
				int i = 0;
				for (int count = keys.Count; i < count; i++)
				{
					KeyData keyData = keys[i];
					ValidateFullKey(ref keyData.key);
					dictionary[keyData.key] = keys[i];
					keys[i].Validate();
				}
				if (Utils.IsPlaying())
				{
					SaveLanguages(unloadAll: true);
				}
			}
		}

		public string GetTranslation(string key, string overrideLanguage = null, string overrideSpecialization = null, bool skipDisabled = false, bool allowCategoryMistmatch = false)
		{
			if (TryGetTranslation(key, out var Translation, overrideLanguage, overrideSpecialization, skipDisabled, allowCategoryMistmatch))
			{
				return Translation;
			}
			return string.Empty;
		}

		public bool TryGetTranslation(string key, out string Translation, string overrideLanguage = null, string overrideSpecialization = null, bool skipDisabled = false, bool allowCategoryMistmatch = false)
		{
			int languageIndex = GetLanguageIndex((overrideLanguage == null) ? LocalizationManager.CurrentLanguage : overrideLanguage, AllowDiscartingRegion: true, SkipDisabled: false);
			if (languageIndex >= 0 && (!skipDisabled || languages[languageIndex].IsEnabled()))
			{
				KeyData keyData = GetKeyData(key, allowCategoryMistmatch);
				if (keyData != null)
				{
					Translation = keyData.GetTranslation(languageIndex, overrideSpecialization, editMode: true);
					if (Translation == "---")
					{
						Translation = string.Empty;
						return true;
					}
					if (!string.IsNullOrEmpty(Translation))
					{
						return true;
					}
					Translation = null;
				}
				if (OnMissingTranslation == MissingTranslationAction.ShowWarning)
				{
					Translation = $"<!-Missing Translation [{key}]-!>";
					return true;
				}
				if (OnMissingTranslation == MissingTranslationAction.Fallback && keyData != null)
				{
					return TryGetFallbackTranslation(keyData, out Translation, languageIndex, overrideSpecialization, skipDisabled);
				}
				if (OnMissingTranslation == MissingTranslationAction.Empty)
				{
					Translation = string.Empty;
					return true;
				}
				if (OnMissingTranslation == MissingTranslationAction.ShowKey)
				{
					Translation = key;
					return true;
				}
			}
			Translation = null;
			return false;
		}

		private bool TryGetFallbackTranslation(KeyData keyData, out string Translation, int langIndex, string overrideSpecialization = null, bool skipDisabled = false)
		{
			string text = languages[langIndex].Code;
			if (!string.IsNullOrEmpty(text))
			{
				if (text.Contains('-'))
				{
					text = text.Substring(0, text.IndexOf('-'));
				}
				for (int i = 0; i < languages.Count; i++)
				{
					if (i != langIndex && languages[i].Code.StartsWith(text) && (!skipDisabled || languages[i].IsEnabled()))
					{
						Translation = keyData.GetTranslation(i, overrideSpecialization, editMode: true);
						if (!string.IsNullOrEmpty(Translation))
						{
							return true;
						}
					}
				}
			}
			for (int j = 0; j < languages.Count; j++)
			{
				if (j != langIndex && (!skipDisabled || languages[j].IsEnabled()) && (text == null || !languages[j].Code.StartsWith(text)))
				{
					Translation = keyData.GetTranslation(j, overrideSpecialization, editMode: true);
					if (!string.IsNullOrEmpty(Translation))
					{
						return true;
					}
				}
			}
			Translation = null;
			return false;
		}

		public KeyData GetKeyData(string key, bool allowCategoryMistmatch = false)
		{
			if (string.IsNullOrEmpty(key))
			{
				return null;
			}
			if (dictionary.Count == 0)
			{
				UpdateDictionary();
			}
			if (dictionary.TryGetValue(key, out var value))
			{
				return value;
			}
			KeyData keyData = null;
			if (allowCategoryMistmatch)
			{
				string keyFromFullKey = GetKeyFromFullKey(key);
				foreach (KeyValuePair<string, KeyData> item in dictionary)
				{
					if (item.Value.IsKey(keyFromFullKey, allowCategoryMistmatch: true))
					{
						if (keyData != null)
						{
							return null;
						}
						keyData = item.Value;
					}
				}
			}
			return keyData;
		}

		public bool ContainsKey(string key)
		{
			return GetKeyData(key) != null;
		}

		public List<string> GetKeysList(string Category = null)
		{
			if (dictionary.Count != keys.Count)
			{
				UpdateDictionary();
			}
			if (string.IsNullOrEmpty(Category))
			{
				return new List<string>(dictionary.Keys);
			}
			List<string> list = new List<string>();
			for (int i = 0; i < keys.Count; i++)
			{
				KeyData keyData = keys[i];
				if (GetCategoryFromFullKey(keyData.key) == Category)
				{
					list.Add(keyData.key);
				}
			}
			return list;
		}

		public KeyData AddKey(string NewKey, KeyType keyType, bool SaveSource = true)
		{
			ValidateFullKey(ref NewKey);
			NewKey = NewKey.Trim();
			if (languages.Count == 0)
			{
				AddLanguage("English", "en");
			}
			KeyData keyData = GetKeyData(NewKey);
			if (keyData == null)
			{
				keyData = new KeyData();
				keyData.key = NewKey;
				keyData.keyType = keyType;
				keyData.Languages = new string[languages.Count];
				keyData.Flags = new byte[languages.Count];
				keys.Add(keyData);
				dictionary.Add(NewKey, keyData);
			}
			return keyData;
		}

		public void RemoveKey(string key)
		{
			int i = 0;
			for (int count = keys.Count; i < count; i++)
			{
				if (keys[i].key == key)
				{
					keys.RemoveAt(i);
					dictionary.Remove(key);
					break;
				}
			}
		}

		public static void ValidateFullKey(ref string key)
		{
			key = key.Replace('\\', '/');
			key = key.Trim();
			if (key.StartsWith(EmptyCategory, StringComparison.Ordinal) && key.Length > EmptyCategory.Length && key[EmptyCategory.Length] == '/')
			{
				key = key.Substring(EmptyCategory.Length + 1);
			}
			key = Utils.GetValidKeyName(key, allowCategory: true);
		}

		public int GetLanguageIndex(string language, bool AllowDiscartingRegion = true, bool SkipDisabled = true)
		{
			int i = 0;
			for (int count = languages.Count; i < count; i++)
			{
				if ((!SkipDisabled || languages[i].IsEnabled()) && string.Compare(languages[i].Name, language, StringComparison.OrdinalIgnoreCase) == 0)
				{
					return i;
				}
			}
			if (AllowDiscartingRegion)
			{
				int num = -1;
				int num2 = 0;
				int j = 0;
				for (int count2 = languages.Count; j < count2; j++)
				{
					if (!SkipDisabled || languages[j].IsEnabled())
					{
						int commonWordInLanguageNames = GetCommonWordInLanguageNames(languages[j].Name, language);
						if (commonWordInLanguageNames > num2)
						{
							num2 = commonWordInLanguageNames;
							num = j;
						}
					}
				}
				if (num >= 0)
				{
					return num;
				}
			}
			return -1;
		}

		public bool IsCurrentLanguage(int languageIndex)
		{
			return LocalizationManager.CurrentLanguage == languages[languageIndex].Name;
		}

		public int GetLanguageIndexFromCode(string Code, bool exactMatch = true, bool ignoreDisabled = false)
		{
			int i = 0;
			for (int count = languages.Count; i < count; i++)
			{
				if ((!ignoreDisabled || languages[i].IsEnabled()) && string.Compare(languages[i].Code, Code, StringComparison.OrdinalIgnoreCase) == 0)
				{
					return i;
				}
			}
			if (!exactMatch)
			{
				int j = 0;
				for (int count2 = languages.Count; j < count2; j++)
				{
					if ((!ignoreDisabled || languages[j].IsEnabled()) && string.Compare(languages[j].Code, 0, Code, 0, 2, StringComparison.OrdinalIgnoreCase) == 0)
					{
						return j;
					}
				}
			}
			return -1;
		}

		public static int GetCommonWordInLanguageNames(string Language1, string Language2)
		{
			if (string.IsNullOrEmpty(Language1) || string.IsNullOrEmpty(Language2))
			{
				return 0;
			}
			char[] separator = "( )-/\\".ToCharArray();
			string[] array = Language1.ToLower().Split(separator);
			string[] array2 = Language2.ToLower().Split(separator);
			int num = 0;
			string[] array3 = array;
			foreach (string value in array3)
			{
				if (!string.IsNullOrEmpty(value) && array2.Contains(value))
				{
					num++;
				}
			}
			array3 = array2;
			foreach (string value2 in array3)
			{
				if (!string.IsNullOrEmpty(value2) && array.Contains(value2))
				{
					num++;
				}
			}
			return num;
		}

		public static string GetLanguageWithoutRegion(string Language)
		{
			int num = Language.IndexOfAny("(/\\[,{".ToCharArray());
			if (num < 0)
			{
				return Language;
			}
			return Language.Substring(0, num).Trim();
		}

		public void AddLanguage(string LanguageName, string LanguageCode)
		{
			if (GetLanguageIndex(LanguageName, AllowDiscartingRegion: false) < 0)
			{
				LanguageData languageData = new LanguageData();
				languageData.Name = LanguageName;
				languageData.Code = LanguageCode;
				languages.Add(languageData);
				int count = languages.Count;
				int i = 0;
				for (int count2 = keys.Count; i < count2; i++)
				{
					Array.Resize(ref keys[i].Languages, count);
					Array.Resize(ref keys[i].Flags, count);
				}
				Editor_SetDirty();
			}
		}

		public void RemoveLanguage(string LanguageName)
		{
			int languageIndex = GetLanguageIndex(LanguageName, AllowDiscartingRegion: false, SkipDisabled: false);
			if (languageIndex < 0)
			{
				return;
			}
			int count = languages.Count;
			int i = 0;
			for (int count2 = keys.Count; i < count2; i++)
			{
				for (int j = languageIndex + 1; j < count; j++)
				{
					keys[i].Languages[j - 1] = keys[i].Languages[j];
					keys[i].Flags[j - 1] = keys[i].Flags[j];
				}
				Array.Resize(ref keys[i].Languages, count - 1);
				Array.Resize(ref keys[i].Flags, count - 1);
			}
			languages.RemoveAt(languageIndex);
			Editor_SetDirty();
		}

		public List<string> GetLanguages(bool skipDisabled = true)
		{
			List<string> list = new List<string>();
			int i = 0;
			for (int count = languages.Count; i < count; i++)
			{
				if (!skipDisabled || languages[i].IsEnabled())
				{
					list.Add(languages[i].Name);
				}
			}
			return list;
		}

		public List<string> GetLanguagesCode(bool allowRegions = true, bool skipDisabled = true)
		{
			List<string> list = new List<string>();
			int i = 0;
			for (int count = languages.Count; i < count; i++)
			{
				if (!skipDisabled || languages[i].IsEnabled())
				{
					string text = languages[i].Code;
					if (!allowRegions && text != null && text.Length > 2)
					{
						text = text.Substring(0, 2);
					}
					if (!string.IsNullOrEmpty(text) && !list.Contains(text))
					{
						list.Add(text);
					}
				}
			}
			return list;
		}

		public bool IsLanguageEnabled(string Language)
		{
			int languageIndex = GetLanguageIndex(Language, AllowDiscartingRegion: false);
			if (languageIndex >= 0)
			{
				return languages[languageIndex].IsEnabled();
			}
			return false;
		}

		public bool AllowUnloadingLanguages()
		{
			return allowUnloadLanguages != AllowUnloadLanguages.Never;
		}

		private string GetSavedLanguageFileName(int languageIndex)
		{
			if (languageIndex < 0)
			{
				return null;
			}
			return "LangSource_" + GetSourcePlayerPrefName() + "_" + languages[languageIndex].Name + ".loc";
		}

		public void LoadLanguage(int languageIndex, bool UnloadOtherLanguages, bool useFallback, bool onlyCurrentSpecialization, bool forceLoad)
		{
			if (!AllowUnloadingLanguages() || !PersistentStorage.CanAccessFiles())
			{
				return;
			}
			if (languageIndex >= 0 && (forceLoad || !languages[languageIndex].IsLoaded()))
			{
				string savedLanguageFileName = GetSavedLanguageFileName(languageIndex);
				string text = PersistentStorage.LoadFile(PersistentStorage.FileType.Temporal, savedLanguageFileName, logExceptions: false);
				if (!string.IsNullOrEmpty(text))
				{
					Import_Language_from_Cache(languageIndex, text, useFallback, onlyCurrentSpecialization);
					languages[languageIndex].SetLoaded(loaded: true);
				}
			}
			if (!UnloadOtherLanguages || !Utils.IsPlaying())
			{
				return;
			}
			for (int i = 0; i < languages.Count; i++)
			{
				if (i != languageIndex)
				{
					UnloadLanguage(i);
				}
			}
		}

		public void LoadAllLanguages(bool forceLoad = false)
		{
			for (int i = 0; i < languages.Count; i++)
			{
				LoadLanguage(i, UnloadOtherLanguages: false, useFallback: false, onlyCurrentSpecialization: false, forceLoad);
			}
		}

		public void UnloadLanguage(int languageIndex)
		{
			if (!AllowUnloadingLanguages() || !PersistentStorage.CanAccessFiles() || !Utils.IsPlaying() || !languages[languageIndex].IsLoaded() || !languages[languageIndex].CanBeUnloaded() || IsCurrentLanguage(languageIndex) || !PersistentStorage.HasFile(PersistentStorage.FileType.Temporal, GetSavedLanguageFileName(languageIndex)))
			{
				return;
			}
			foreach (KeyData key in keys)
			{
				key.Languages[languageIndex] = null;
			}
			languages[languageIndex].SetLoaded(loaded: false);
		}

		public void SaveLanguages(bool unloadAll, PersistentStorage.FileType fileLocation = PersistentStorage.FileType.Temporal)
		{
			if (!AllowUnloadingLanguages() || !PersistentStorage.CanAccessFiles() || !unloadAll)
			{
				return;
			}
			for (int i = 0; i < languages.Count; i++)
			{
				if (unloadAll && !IsCurrentLanguage(i))
				{
					UnloadLanguage(i);
				}
			}
		}

		public bool HasUnloadedLanguages()
		{
			for (int i = 0; i < languages.Count; i++)
			{
				if (!languages[i].IsLoaded())
				{
					return true;
				}
			}
			return false;
		}

		private string GetSourcePlayerPrefName()
		{
			if (owner == null)
			{
				return null;
			}
			string name = (owner as UnityEngine.Object).name;
			if (Array.IndexOf(LocalizationManager.GlobalSources, (owner as UnityEngine.Object).name) >= 0)
			{
				return name;
			}
			return SceneManager.GetActiveScene().name + "_" + name;
		}

		public List<string> GetCategories(bool OnlyMainCategory = false, List<string> Categories = null)
		{
			if (Categories == null)
			{
				Categories = new List<string>();
			}
			foreach (KeyData key in keys)
			{
				string categoryFromFullKey = GetCategoryFromFullKey(key.key, OnlyMainCategory);
				if (!Categories.Contains(categoryFromFullKey))
				{
					Categories.Add(categoryFromFullKey);
				}
			}
			Categories.Sort();
			return Categories;
		}

		public static string GetKeyFromFullKey(string fullKey, bool OnlyMainCategory = false)
		{
			int num = (OnlyMainCategory ? fullKey.IndexOfAny(CategorySeparators) : fullKey.LastIndexOfAny(CategorySeparators));
			if (num >= 0)
			{
				return fullKey.Substring(num + 1);
			}
			return fullKey;
		}

		public static string GetCategoryFromFullKey(string fullKey, bool OnlyMainCategory = false)
		{
			int num = (OnlyMainCategory ? fullKey.IndexOfAny(CategorySeparators) : fullKey.LastIndexOfAny(CategorySeparators));
			if (num >= 0)
			{
				return fullKey.Substring(0, num);
			}
			return EmptyCategory;
		}

		public static void DeserializeFullKey(string fullKey, out string Key, out string Category, bool OnlyMainCategory = false)
		{
			int num = (OnlyMainCategory ? fullKey.IndexOfAny(CategorySeparators) : fullKey.LastIndexOfAny(CategorySeparators));
			if (num < 0)
			{
				Category = EmptyCategory;
				Key = fullKey;
			}
			else
			{
				Category = fullKey.Substring(0, num);
				Key = fullKey.Substring(num + 1);
			}
		}
	}
	public class LocalizationReader
	{
		public static string ReadCSVfile(string Path, Encoding encoding)
		{
			string text = string.Empty;
			using (StreamReader streamReader = new StreamReader(Path, encoding))
			{
				text = streamReader.ReadToEnd();
			}
			text = text.Replace("\r\n", "\n");
			return text.Replace("\r", "\n");
		}

		public static List<string[]> ReadCSV(string Text, char Separator = ',')
		{
			int iStart = 0;
			List<string[]> list = new List<string[]>();
			while (iStart < Text.Length)
			{
				string[] array = ParseCSVline(Text, ref iStart, Separator);
				if (array == null)
				{
					break;
				}
				list.Add(array);
			}
			return list;
		}

		private static string[] ParseCSVline(string Line, ref int iStart, char Separator)
		{
			List<string> list = new List<string>();
			int length = Line.Length;
			int iWordStart = iStart;
			bool flag = false;
			while (iStart < length)
			{
				char c = Line[iStart];
				if (flag)
				{
					if (c == '"')
					{
						if (iStart + 1 >= length || Line[iStart + 1] != '"')
						{
							flag = false;
						}
						else if (iStart + 2 < length && Line[iStart + 2] == '"')
						{
							flag = false;
							iStart += 2;
						}
						else
						{
							iStart++;
						}
					}
				}
				else if (c == '\n' || c == Separator)
				{
					AddCSVtoken(ref list, ref Line, iStart, ref iWordStart);
					if (c == '\n')
					{
						iStart++;
						break;
					}
				}
				else if (c == '"')
				{
					flag = true;
				}
				iStart++;
			}
			if (iStart > iWordStart)
			{
				AddCSVtoken(ref list, ref Line, iStart, ref iWordStart);
			}
			return list.ToArray();
		}

		private static void AddCSVtoken(ref List<string> list, ref string Line, int iEnd, ref int iWordStart)
		{
			string text = Line.Substring(iWordStart, iEnd - iWordStart);
			iWordStart = iEnd + 1;
			text = text.Replace("\"\"", "\"");
			if (text.Length > 1 && text[0] == '"' && text[text.Length - 1] == '"')
			{
				text = text.Substring(1, text.Length - 2);
			}
			list.Add(text);
		}
	}
	public class Localize : MonoBehaviour
	{
		public enum KeyModification
		{
			DontModify,
			ToUpper,
			ToLower,
			ToUpperFirst,
			ToTitle
		}

		public string key = string.Empty;

		public string keySecondary = string.Empty;

		[NonSerialized]
		public string FinalKey;

		[NonSerialized]
		public string FinalSecondaryKey;

		public KeyModification PrimaryKeyModifier;

		public KeyModification SecondaryKeyModifier;

		public bool localizeOnAwake = true;

		private string LastLocalizedLanguage;

		public bool addSpacesToJoinedLanguages;

		public bool allowLocalizedParameters = true;

		public List<UnityEngine.Object> translatedObjects = new List<UnityEngine.Object>();

		[NonSerialized]
		public Dictionary<string, UnityEngine.Object> assetDictionary = new Dictionary<string, UnityEngine.Object>(StringComparer.Ordinal);

		public UnityEvent localizeEvent = new UnityEvent();

		public static string MainTranslation;

		public static string SecondaryTranslation;

		public static string CallBackKey;

		public static string CallBackSecondaryKey;

		public static Localize CurrentLocalizeComponent;

		public bool alwaysForceLocalize = true;

		[SerializeField]
		public EventCallback localizeCallBack = new EventCallback();

		public bool mGUI_ShowReferences;

		public bool mGUI_ShowTems = true;

		public bool mGUI_ShowCallback;

		public ILocalizeTarget localizeTarget;

		public string localizeTargetName;

		public string Key
		{
			get
			{
				return key;
			}
			set
			{
				SetKey(value);
			}
		}

		public string SecondaryKey
		{
			get
			{
				return keySecondary;
			}
			set
			{
				SetKey(null, value);
			}
		}

		private void Awake()
		{
			UpdateAssetDictionary();
			FindTarget();
			if (localizeOnAwake)
			{
				OnLocalize();
			}
		}

		private void OnEnable()
		{
			OnLocalize();
		}

		public bool HasCallback()
		{
			if (localizeCallBack.HasCallback())
			{
				return true;
			}
			return localizeEvent.GetPersistentEventCount() > 0;
		}

		public void OnLocalize(bool Force = false)
		{
			if ((!Force && (!base.enabled || base.gameObject == null || !base.gameObject.activeInHierarchy)) || string.IsNullOrEmpty(LocalizationManager.CurrentLanguage) || (!alwaysForceLocalize && !Force && !HasCallback() && LastLocalizedLanguage == LocalizationManager.CurrentLanguage))
			{
				return;
			}
			LastLocalizedLanguage = LocalizationManager.CurrentLanguage;
			if (string.IsNullOrEmpty(FinalKey) || string.IsNullOrEmpty(FinalSecondaryKey))
			{
				GetFinalKeys(out FinalKey, out FinalSecondaryKey);
			}
			bool flag = Utils.IsPlaying() && HasCallback();
			if (!flag && string.IsNullOrEmpty(FinalKey) && string.IsNullOrEmpty(FinalSecondaryKey))
			{
				return;
			}
			CallBackKey = FinalKey;
			CallBackSecondaryKey = FinalSecondaryKey;
			MainTranslation = ((string.IsNullOrEmpty(FinalKey) || FinalKey == "-") ? null : LocalizationManager.GetTranslation(FinalKey, FixForRTL: false));
			SecondaryTranslation = ((string.IsNullOrEmpty(FinalSecondaryKey) || FinalSecondaryKey == "-") ? null : LocalizationManager.GetTranslation(FinalSecondaryKey, FixForRTL: false));
			if (!flag && string.IsNullOrEmpty(FinalKey) && string.IsNullOrEmpty(SecondaryTranslation))
			{
				return;
			}
			CurrentLocalizeComponent = this;
			localizeCallBack.Execute(this);
			localizeEvent.Invoke();
			LocalizationManager.ApplyLocalizationParams(ref MainTranslation, base.gameObject, allowLocalizedParameters);
			if (!FindTarget())
			{
				return;
			}
			if (MainTranslation != null)
			{
				switch (PrimaryKeyModifier)
				{
				case KeyModification.ToUpper:
					MainTranslation = MainTranslation.ToUpper();
					break;
				case KeyModification.ToLower:
					MainTranslation = MainTranslation.ToLower();
					break;
				}
				if (addSpacesToJoinedLanguages && LocalizationManager.HasJoinedWords && !string.IsNullOrEmpty(MainTranslation))
				{
					StringBuilder stringBuilder = new StringBuilder();
					stringBuilder.Append(MainTranslation[0]);
					int i = 1;
					for (int length = MainTranslation.Length; i < length; i++)
					{
						stringBuilder.Append(' ');
						stringBuilder.Append(MainTranslation[i]);
					}
					MainTranslation = stringBuilder.ToString();
				}
			}
			if (SecondaryTranslation != null)
			{
				switch (SecondaryKeyModifier)
				{
				case KeyModification.ToUpper:
					SecondaryTranslation = SecondaryTranslation.ToUpper();
					break;
				case KeyModification.ToLower:
					SecondaryTranslation = SecondaryTranslation.ToLower();
					break;
				}
			}
			if (LocalizationManager.HighlightLocalizedTargets)
			{
				MainTranslation = "LOC:" + FinalKey;
			}
			localizeTarget.DoLocalize(this, MainTranslation, SecondaryTranslation);
			CurrentLocalizeComponent = null;
		}

		public bool FindTarget()
		{
			if (localizeTarget != null && localizeTarget.IsValid(this))
			{
				return true;
			}
			if (localizeTarget != null)
			{
				UnityEngine.Object.DestroyImmediate(localizeTarget);
				localizeTarget = null;
				localizeTargetName = null;
			}
			if (!string.IsNullOrEmpty(localizeTargetName))
			{
				foreach (ILocalizeTargetDescriptor mLocalizeTarget in LocalizationManager.mLocalizeTargets)
				{
					if (localizeTargetName == mLocalizeTarget.GetTargetType().ToString())
					{
						if (mLocalizeTarget.CanLocalize(this))
						{
							localizeTarget = mLocalizeTarget.CreateTarget(this);
						}
						if (localizeTarget != null)
						{
							return true;
						}
					}
				}
			}
			foreach (ILocalizeTargetDescriptor mLocalizeTarget2 in LocalizationManager.mLocalizeTargets)
			{
				if (mLocalizeTarget2.CanLocalize(this))
				{
					localizeTarget = mLocalizeTarget2.CreateTarget(this);
					localizeTargetName = mLocalizeTarget2.GetTargetType().ToString();
					if (localizeTarget != null)
					{
						return true;
					}
				}
			}
			return false;
		}

		public void GetFinalKeys(out string primaryKey, out string secondaryKey)
		{
			primaryKey = string.Empty;
			secondaryKey = string.Empty;
			if (FindTarget())
			{
				if (localizeTarget != null)
				{
					localizeTarget.GetFinalKeys(this, key, keySecondary, out primaryKey, out secondaryKey);
					primaryKey = Utils.GetValidKeyName(primaryKey);
				}
				if (!string.IsNullOrEmpty(key))
				{
					primaryKey = key;
				}
				if (!string.IsNullOrEmpty(keySecondary))
				{
					secondaryKey = keySecondary;
				}
				if (primaryKey != null)
				{
					primaryKey = primaryKey.Trim();
				}
				if (secondaryKey != null)
				{
					secondaryKey = secondaryKey.Trim();
				}
			}
		}

		public string GetMainTargetsText()
		{
			string primaryKey = null;
			string secondaryKey = null;
			if (localizeTarget != null)
			{
				localizeTarget.GetFinalKeys(this, null, null, out primaryKey, out secondaryKey);
			}
			if (!string.IsNullOrEmpty(primaryKey))
			{
				return primaryKey;
			}
			return key;
		}

		public void SetFinalKeys(string Main, string Secondary, out string primaryKey, out string secondaryKey, bool RemoveNonASCII)
		{
			primaryKey = (RemoveNonASCII ? Utils.GetValidKeyName(Main) : Main);
			secondaryKey = Secondary;
		}

		public void SetKey(string primary)
		{
			if (!string.IsNullOrEmpty(primary))
			{
				FinalKey = (key = primary);
			}
			OnLocalize(Force: true);
		}

		public void SetKey(string primary, string secondary)
		{
			if (!string.IsNullOrEmpty(primary))
			{
				FinalKey = (key = primary);
			}
			FinalSecondaryKey = (keySecondary = secondary);
			OnLocalize(Force: true);
		}

		internal T GetSecondaryTranslatedObj<T>(ref string mainTranslation, ref string secondaryTranslation) where T : UnityEngine.Object
		{
			DeserializeTranslation(mainTranslation, out var value, out var secondary);
			T val = null;
			if (!string.IsNullOrEmpty(secondary))
			{
				val = GetObject<T>(secondary);
				if (val != null)
				{
					mainTranslation = value;
					secondaryTranslation = secondary;
				}
			}
			if (val == null)
			{
				val = GetObject<T>(secondaryTranslation);
			}
			return val;
		}

		public void UpdateAssetDictionary()
		{
			translatedObjects.RemoveAll((UnityEngine.Object x) => x == null);
			assetDictionary = (from o in translatedObjects.Distinct()
				group o by o.name).ToDictionary((IGrouping<string, UnityEngine.Object> g) => g.Key, (IGrouping<string, UnityEngine.Object> g) => g.First());
		}

		internal T GetObject<T>(string Translation) where T : UnityEngine.Object
		{
			if (string.IsNullOrEmpty(Translation))
			{
				return null;
			}
			return GetTranslatedObject<T>(Translation);
		}

		private T GetTranslatedObject<T>(string Translation) where T : UnityEngine.Object
		{
			return FindTranslatedObject<T>(Translation);
		}

		private void DeserializeTranslation(string translation, out string value, out string secondary)
		{
			if (!string.IsNullOrEmpty(translation) && translation.Length > 1 && translation[0] == '[')
			{
				int num = translation.IndexOf(']');
				if (num > 0)
				{
					secondary = translation.Substring(1, num - 1);
					value = translation.Substring(num + 1);
					return;
				}
			}
			value = translation;
			secondary = string.Empty;
		}

		public T FindTranslatedObject<T>(string value) where T : UnityEngine.Object
		{
			if (string.IsNullOrEmpty(value))
			{
				return null;
			}
			if (assetDictionary == null || assetDictionary.Count != translatedObjects.Count)
			{
				UpdateAssetDictionary();
			}
			foreach (KeyValuePair<string, UnityEngine.Object> item in assetDictionary)
			{
				if (item.Value is T && value.EndsWith(item.Key, StringComparison.OrdinalIgnoreCase) && string.Compare(value, item.Key, StringComparison.OrdinalIgnoreCase) == 0)
				{
					return (T)item.Value;
				}
			}
			T val = LocalizationManager.FindAsset(value) as T;
			if ((bool)val)
			{
				return val;
			}
			return ResourceManager.pInstance.GetAsset<T>(value);
		}

		public bool HasTranslatedObject(UnityEngine.Object Obj)
		{
			if (translatedObjects.Contains(Obj))
			{
				return true;
			}
			return ResourceManager.pInstance.HasAsset(Obj);
		}

		public void AddTranslatedObject(UnityEngine.Object Obj)
		{
			if (!translatedObjects.Contains(Obj))
			{
				translatedObjects.Add(Obj);
				UpdateAssetDictionary();
			}
		}

		public void SetGlobalLanguage(string Language)
		{
			LocalizationManager.CurrentLanguage = Language;
		}
	}
	public static class LocalizationManager
	{
		public delegate object _GetParam(string param);

		public delegate void OnLocalizeCallback();

		private static string mCurrentLanguage;

		private static string mLanguageCode;

		private static CultureInfo mCurrentCulture;

		private static bool mChangeCultureInfo = false;

		public static bool HasJoinedWords = false;

		public static List<ILocalizationParamsManager> ParamManagers = new List<ILocalizationParamsManager>();

		public static List<LanguageSourceData> Sources = new List<LanguageSourceData>();

		public static string[] GlobalSources = new string[1] { "Languages" };

		private static string mCurrentDeviceLanguage;

		public static List<ILocalizeTargetDescriptor> mLocalizeTargets = new List<ILocalizeTargetDescriptor>();

		private static bool mLocalizeIsScheduled = false;

		private static bool mLocalizeIsScheduledWithForcedValue = false;

		public static bool HighlightLocalizedTargets = false;

		public static string CurrentLanguage
		{
			get
			{
				InitializeIfNeeded();
				return mCurrentLanguage;
			}
			set
			{
				InitializeIfNeeded();
				string supportedLanguage = GetSupportedLanguage(value);
				if (!string.IsNullOrEmpty(supportedLanguage) && mCurrentLanguage != supportedLanguage)
				{
					SetLanguageAndCode(supportedLanguage, GetLanguageCode(supportedLanguage));
				}
			}
		}

		public static string CurrentLanguageCode
		{
			get
			{
				InitializeIfNeeded();
				return mLanguageCode;
			}
			set
			{
				InitializeIfNeeded();
				if (mLanguageCode != value)
				{
					string languageFromCode = GetLanguageFromCode(value);
					if (!string.IsNullOrEmpty(languageFromCode))
					{
						SetLanguageAndCode(languageFromCode, value);
					}
				}
			}
		}

		public static string CurrentRegion
		{
			get
			{
				string currentLanguage = CurrentLanguage;
				int num = currentLanguage.IndexOfAny("/\\".ToCharArray());
				if (num > 0)
				{
					return currentLanguage.Substring(num + 1);
				}
				num = currentLanguage.IndexOfAny("[(".ToCharArray());
				int num2 = currentLanguage.LastIndexOfAny("])".ToCharArray());
				if (num > 0 && num != num2)
				{
					return currentLanguage.Substring(num + 1, num2 - num - 1);
				}
				return string.Empty;
			}
			set
			{
				string text = CurrentLanguage;
				int num = text.IndexOfAny("/\\".ToCharArray());
				if (num > 0)
				{
					CurrentLanguage = text.Substring(num + 1) + value;
					return;
				}
				num = text.IndexOfAny("[(".ToCharArray());
				int num2 = text.LastIndexOfAny("])".ToCharArray());
				if (num > 0 && num != num2)
				{
					text = text.Substring(num);
				}
				CurrentLanguage = text + "(" + value + ")";
			}
		}

		public static string CurrentRegionCode
		{
			get
			{
				string currentLanguageCode = CurrentLanguageCode;
				int num = currentLanguageCode.IndexOfAny(" -_/\\".ToCharArray());
				if (num >= 0)
				{
					return currentLanguageCode.Substring(num + 1);
				}
				return string.Empty;
			}
			set
			{
				string text = CurrentLanguageCode;
				int num = text.IndexOfAny(" -_/\\".ToCharArray());
				if (num > 0)
				{
					text = text.Substring(0, num);
				}
				CurrentLanguageCode = text + "-" + value;
			}
		}

		public static CultureInfo CurrentCulture => mCurrentCulture;

		public static event OnLocalizeCallback OnLocalizeEvent;

		public static void InitializeIfNeeded()
		{
			if (string.IsNullOrEmpty(mCurrentLanguage) || Sources.Count == 0)
			{
				AutoLoadGlobalParamManagers();
				UpdateSources();
				SelectStartupLanguage();
			}
		}

		public static string GetVersion()
		{
			return "2.8.13 f2";
		}

		public static void SetLanguageAndCode(string LanguageName, string LanguageCode, bool RememberLanguage = true, bool Force = false)
		{
			if (mCurrentLanguage != LanguageName || mLanguageCode != LanguageCode || Force)
			{
				if (RememberLanguage)
				{
					PersistentStorage.SetSetting_String("Language", LanguageName);
				}
				mCurrentLanguage = LanguageName;
				mLanguageCode = LanguageCode;
				mCurrentCulture = CreateCultureForCode(LanguageCode);
				if (mChangeCultureInfo)
				{
					SetCurrentCultureInfo();
				}
				HasJoinedWords = GoogleLanguages.LanguageCode_HasJoinedWord(mLanguageCode);
				LocalizeAll(Force);
			}
		}

		private static CultureInfo CreateCultureForCode(string code)
		{
			try
			{
				return CultureInfo.CreateSpecificCulture(code);
			}
			catch (Exception)
			{
				return CultureInfo.InvariantCulture;
			}
		}

		public static void EnableChangingCultureInfo(bool bEnable)
		{
			if (!mChangeCultureInfo && bEnable)
			{
				SetCurrentCultureInfo();
			}
			mChangeCultureInfo = bEnable;
		}

		private static void SetCurrentCultureInfo()
		{
			Thread.CurrentThread.CurrentCulture = mCurrentCulture;
		}

		private static void SelectStartupLanguage()
		{
			if (Sources.Count == 0)
			{
				return;
			}
			string setting_String = PersistentStorage.GetSetting_String("Language", string.Empty);
			string currentDeviceLanguage = GetCurrentDeviceLanguage();
			if (!string.IsNullOrEmpty(setting_String) && HasLanguage(setting_String, AllowDiscartingRegion: true, Initialize: false))
			{
				SetLanguageAndCode(setting_String, GetLanguageCode(setting_String));
				return;
			}
			if (!Sources[0].ignoreDeviceLanguage)
			{
				string supportedLanguage = GetSupportedLanguage(currentDeviceLanguage, ignoreDisabled: true);
				if (!string.IsNullOrEmpty(supportedLanguage))
				{
					SetLanguageAndCode(supportedLanguage, GetLanguageCode(supportedLanguage), RememberLanguage: false);
					return;
				}
			}
			int i = 0;
			for (int count = Sources.Count; i < count; i++)
			{
				if (Sources[i].languages.Count <= 0)
				{
					continue;
				}
				for (int j = 0; j < Sources[i].languages.Count; j++)
				{
					if (Sources[i].languages[j].IsEnabled())
					{
						SetLanguageAndCode(Sources[i].languages[j].Name, Sources[i].languages[j].Code, RememberLanguage: false);
						return;
					}
				}
			}
		}

		public static bool HasLanguage(string Language, bool AllowDiscartingRegion = true, bool Initialize = true, bool SkipDisabled = true)
		{
			if (Initialize)
			{
				InitializeIfNeeded();
			}
			int i = 0;
			for (int count = Sources.Count; i < count; i++)
			{
				if (Sources[i].GetLanguageIndex(Language, AllowDiscartingRegion: false, SkipDisabled) >= 0)
				{
					return true;
				}
			}
			if (AllowDiscartingRegion)
			{
				int j = 0;
				for (int count2 = Sources.Count; j < count2; j++)
				{
					if (Sources[j].GetLanguageIndex(Language, AllowDiscartingRegion: true, SkipDisabled) >= 0)
					{
						return true;
					}
				}
			}
			return false;
		}

		public static string GetSupportedLanguage(string Language, bool ignoreDisabled = false)
		{
			string languageCode = GoogleLanguages.GetLanguageCode(Language);
			if (!string.IsNullOrEmpty(languageCode))
			{
				int i = 0;
				for (int count = Sources.Count; i < count; i++)
				{
					int languageIndexFromCode = Sources[i].GetLanguageIndexFromCode(languageCode, exactMatch: true, ignoreDisabled);
					if (languageIndexFromCode >= 0)
					{
						return Sources[i].languages[languageIndexFromCode].Name;
					}
				}
				int j = 0;
				for (int count2 = Sources.Count; j < count2; j++)
				{
					int languageIndexFromCode2 = Sources[j].GetLanguageIndexFromCode(languageCode, exactMatch: false, ignoreDisabled);
					if (languageIndexFromCode2 >= 0)
					{
						return Sources[j].languages[languageIndexFromCode2].Name;
					}
				}
			}
			int k = 0;
			for (int count3 = Sources.Count; k < count3; k++)
			{
				int languageIndex = Sources[k].GetLanguageIndex(Language, AllowDiscartingRegion: false, ignoreDisabled);
				if (languageIndex >= 0)
				{
					return Sources[k].languages[languageIndex].Name;
				}
			}
			int l = 0;
			for (int count4 = Sources.Count; l < count4; l++)
			{
				int languageIndex2 = Sources[l].GetLanguageIndex(Language, AllowDiscartingRegion: true, ignoreDisabled);
				if (languageIndex2 >= 0)
				{
					return Sources[l].languages[languageIndex2].Name;
				}
			}
			return string.Empty;
		}

		public static string GetLanguageCode(string Language)
		{
			if (Sources.Count == 0)
			{
				UpdateSources();
			}
			int i = 0;
			for (int count = Sources.Count; i < count; i++)
			{
				int languageIndex = Sources[i].GetLanguageIndex(Language);
				if (languageIndex >= 0)
				{
					return Sources[i].languages[languageIndex].Code;
				}
			}
			return string.Empty;
		}

		public static string GetLanguageFromCode(string Code, bool exactMatch = true)
		{
			if (Sources.Count == 0)
			{
				UpdateSources();
			}
			int i = 0;
			for (int count = Sources.Count; i < count; i++)
			{
				int languageIndexFromCode = Sources[i].GetLanguageIndexFromCode(Code, exactMatch);
				if (languageIndexFromCode >= 0)
				{
					return Sources[i].languages[languageIndexFromCode].Name;
				}
			}
			return string.Empty;
		}

		public static List<string> GetAllLanguages(bool SkipDisabled = true)
		{
			if (Sources.Count == 0)
			{
				UpdateSources();
			}
			List<string> Languages = new List<string>();
			int i = 0;
			for (int count = Sources.Count; i < count; i++)
			{
				Languages.AddRange(from x in Sources[i].GetLanguages(SkipDisabled)
					where !Languages.Contains(x)
					select x);
			}
			return Languages;
		}

		public static List<string> GetAllLanguagesCode(bool allowRegions = true, bool SkipDisabled = true)
		{
			List<string> Languages = new List<string>();
			int i = 0;
			for (int count = Sources.Count; i < count; i++)
			{
				Languages.AddRange(from x in Sources[i].GetLanguagesCode(allowRegions, SkipDisabled)
					where !Languages.Contains(x)
					select x);
			}
			return Languages;
		}

		public static bool IsLanguageEnabled(string Language)
		{
			int i = 0;
			for (int count = Sources.Count; i < count; i++)
			{
				if (!Sources[i].IsLanguageEnabled(Language))
				{
					return false;
				}
			}
			return true;
		}

		private static void LoadCurrentLanguage()
		{
			for (int i = 0; i < Sources.Count; i++)
			{
				int languageIndex = Sources[i].GetLanguageIndex(mCurrentLanguage, AllowDiscartingRegion: true, SkipDisabled: false);
				Sources[i].LoadLanguage(languageIndex, UnloadOtherLanguages: true, useFallback: true, onlyCurrentSpecialization: true, forceLoad: false);
			}
		}

		public static void PreviewLanguage(string NewLanguage)
		{
			mCurrentLanguage = NewLanguage;
			mLanguageCode = GetLanguageCode(mCurrentLanguage);
			HasJoinedWords = GoogleLanguages.LanguageCode_HasJoinedWord(mLanguageCode);
		}

		public static void AutoLoadGlobalParamManagers()
		{
			LocalizationParamsManager[] array = UnityEngine.Object.FindObjectsOfType<LocalizationParamsManager>();
			foreach (LocalizationParamsManager localizationParamsManager in array)
			{
				if (localizationParamsManager._IsGlobalManager && !ParamManagers.Contains(localizationParamsManager))
				{
					UnityEngine.Debug.Log(localizationParamsManager);
					ParamManagers.Add(localizationParamsManager);
				}
			}
		}

		public static void ApplyLocalizationParams(ref string translation, bool allowLocalizedParameters = true)
		{
			ApplyLocalizationParams(ref translation, (string p) => GetLocalizationParam(p, null), allowLocalizedParameters);
		}

		public static void ApplyLocalizationParams(ref string translation, GameObject root, bool allowLocalizedParameters = true)
		{
			ApplyLocalizationParams(ref translation, (string p) => GetLocalizationParam(p, root), allowLocalizedParameters);
		}

		public static void ApplyLocalizationParams(ref string translation, Dictionary<string, object> parameters, bool allowLocalizedParameters = true)
		{
			ApplyLocalizationParams(ref translation, delegate(string p)
			{
				object value = null;
				return parameters.TryGetValue(p, out value) ? value : null;
			}, allowLocalizedParameters);
		}

		public static void ApplyLocalizationParams(ref string translation, _GetParam getParam, bool allowLocalizedParameters = true)
		{
			if (translation == null)
			{
				return;
			}
			string text = null;
			int num = 0;
			int length = translation.Length;
			int num2 = 0;
			while (num2 >= 0 && num2 < translation.Length)
			{
				int num3 = translation.IndexOf("{[", num2);
				if (num3 < 0)
				{
					break;
				}
				int num4 = translation.IndexOf("]}", num3);
				if (num4 < 0)
				{
					break;
				}
				int num5 = translation.IndexOf("{[", num3 + 1);
				if (num5 > 0 && num5 < num4)
				{
					num2 = num5;
					continue;
				}
				int num6 = ((translation[num3 + 2] == '#') ? 3 : 2);
				string param = translation.Substring(num3 + num6, num4 - num3 - num6);
				string text2 = (string)getParam(param);
				if (text2 != null && allowLocalizedParameters)
				{
					LanguageSourceData source;
					KeyData keyData = GetKeyData(text2, out source);
					if (keyData != null)
					{
						int languageIndex = source.GetLanguageIndex(CurrentLanguage);
						if (languageIndex >= 0)
						{
							text2 = keyData.GetTranslation(languageIndex);
						}
					}
					string oldValue = translation.Substring(num3, num4 - num3 + 2);
					translation = translation.Replace(oldValue, text2);
					int result = 0;
					if (int.TryParse(text2, out result))
					{
						text = GoogleLanguages.GetPluralType(CurrentLanguageCode, result).ToString();
					}
					num2 = num3 + text2.Length;
				}
				else
				{
					num2 = num4 + 2;
				}
			}
			if (text != null)
			{
				string text3 = "[i2p_" + text + "]";
				num = translation.IndexOf(text3, StringComparison.OrdinalIgnoreCase);
				num = ((num >= 0) ? (num + text3.Length) : 0);
				length = translation.IndexOf("[i2p_", num + 1, StringComparison.OrdinalIgnoreCase);
				if (length < 0)
				{
					length = translation.Length;
				}
				translation = translation.Substring(num, length - num);
			}
		}

		internal static string GetLocalizationParam(string ParamName, GameObject root)
		{
			string text = null;
			if ((bool)root)
			{
				MonoBehaviour[] components = root.GetComponents<MonoBehaviour>();
				int i = 0;
				for (int num = components.Length; i < num; i++)
				{
					if (components[i] is ILocalizationParamsManager localizationParamsManager && components[i].enabled)
					{
						text = localizationParamsManager.GetParameterValue(ParamName);
						if (text != null)
						{
							return text;
						}
					}
				}
			}
			int j = 0;
			for (int count = ParamManagers.Count; j < count; j++)
			{
				text = ParamManagers[j].GetParameterValue(ParamName);
				if (text != null)
				{
					return text;
				}
			}
			return null;
		}

		private static string GetPluralType(MatchCollection matches, string langCode, _GetParam getParam)
		{
			int i = 0;
			for (int count = matches.Count; i < count; i++)
			{
				Match match = matches[i];
				string value = match.Groups[match.Groups.Count - 1].Value;
				string text = (string)getParam(value);
				if (text != null)
				{
					int result = 0;
					if (int.TryParse(text, out result))
					{
						return GoogleLanguages.GetPluralType(langCode, result).ToString();
					}
				}
			}
			return null;
		}

		public static bool UpdateSources()
		{
			UnregisterDeletededSources();
			RegisterSourceInResources();
			RegisterSceneSources();
			return Sources.Count > 0;
		}

		private static void UnregisterDeletededSources()
		{
			for (int num = Sources.Count - 1; num >= 0; num--)
			{
				if (Sources[num] == null)
				{
					RemoveSource(Sources[num]);
				}
			}
		}

		private static void RegisterSceneSources()
		{
			LanguageSource[] array = (LanguageSource[])Resources.FindObjectsOfTypeAll(typeof(LanguageSource));
			foreach (LanguageSource languageSource in array)
			{
				if (!Sources.Contains(languageSource.source))
				{
					if (languageSource.source.owner == null)
					{
						languageSource.source.owner = languageSource;
					}
					AddSource(languageSource.source);
				}
			}
		}

		private static void RegisterSourceInResources()
		{
			string[] globalSources = GlobalSources;
			foreach (string name in globalSources)
			{
				LanguageSourceAsset asset = ResourceManager.pInstance.GetAsset<LanguageSourceAsset>(name);
				if ((bool)asset && !Sources.Contains(asset.source))
				{
					if (!asset.source.mIsGlobalSource)
					{
						asset.source.mIsGlobalSource = true;
					}
					asset.source.owner = asset;
					AddSource(asset.source);
				}
			}
		}

		internal static void AddSource(LanguageSourceData Source)
		{
			if (!Sources.Contains(Source))
			{
				Sources.Add(Source);
				for (int i = 0; i < Source.languages.Count(); i++)
				{
					Source.languages[i].SetLoaded(loaded: true);
				}
				if (Source.dictionary.Count == 0)
				{
					Source.UpdateDictionary(force: true);
				}
			}
		}

		internal static void RemoveSource(LanguageSourceData Source)
		{
			Sources.Remove(Source);
		}

		public static bool IsGlobalSource(string SourceName)
		{
			return Array.IndexOf(GlobalSources, SourceName) >= 0;
		}

		public static LanguageSourceData GetSourceContaining(string key, bool fallbackToFirst = true)
		{
			if (!string.IsNullOrEmpty(key))
			{
				int i = 0;
				for (int count = Sources.Count; i < count; i++)
				{
					if (Sources[i].GetKeyData(key) != null)
					{
						return Sources[i];
					}
				}
			}
			if (!fallbackToFirst || Sources.Count <= 0)
			{
				return null;
			}
			return Sources[0];
		}

		public static UnityEngine.Object FindAsset(string value)
		{
			int i = 0;
			for (int count = Sources.Count; i < count; i++)
			{
				UnityEngine.Object @object = Sources[i].FindAsset(value);
				if ((bool)@object)
				{
					return @object;
				}
			}
			return null;
		}

		public static string GetCurrentDeviceLanguage(bool force = false)
		{
			if (force || string.IsNullOrEmpty(mCurrentDeviceLanguage))
			{
				DetectDeviceLanguage();
			}
			return mCurrentDeviceLanguage;
		}

		private static void DetectDeviceLanguage()
		{
			try
			{
				mCurrentDeviceLanguage = new AndroidJavaClass("java/util/Locale").CallStatic<AndroidJavaObject>("getDefault", Array.Empty<object>()).Call<string>("toString", Array.Empty<object>());
				if (!string.IsNullOrEmpty(mCurrentDeviceLanguage))
				{
					mCurrentDeviceLanguage = mCurrentDeviceLanguage.Replace('_', '-');
					mCurrentDeviceLanguage = GoogleLanguages.GetLanguageName(mCurrentDeviceLanguage, useParenthesesForRegion: true);
					if (!string.IsNullOrEmpty(mCurrentDeviceLanguage))
					{
						return;
					}
				}
			}
			catch (Exception)
			{
			}
			mCurrentDeviceLanguage = UnityEngine.Application.systemLanguage.ToString();
			if (mCurrentDeviceLanguage == "ChineseSimplified")
			{
				mCurrentDeviceLanguage = "Chinese (Simplified)";
			}
			if (mCurrentDeviceLanguage == "ChineseTraditional")
			{
				mCurrentDeviceLanguage = "Chinese (Traditional)";
			}
		}

		public static void RegisterTarget(ILocalizeTargetDescriptor desc)
		{
			if (mLocalizeTargets.FindIndex((ILocalizeTargetDescriptor x) => x.Name == desc.Name) != -1)
			{
				return;
			}
			for (int i = 0; i < mLocalizeTargets.Count; i++)
			{
				if (mLocalizeTargets[i].Priority > desc.Priority)
				{
					mLocalizeTargets.Insert(i, desc);
					return;
				}
			}
			mLocalizeTargets.Add(desc);
		}

		public static string GetTranslation(string key, bool FixForRTL = true, int maxLineLengthForRTL = 0, bool ignoreRTLnumbers = true, bool applyParameters = false, GameObject localParametersRoot = null, string overrideLanguage = null)
		{
			string Translation = null;
			TryGetTranslation(key, out Translation, FixForRTL, maxLineLengthForRTL, ignoreRTLnumbers, applyParameters, localParametersRoot, overrideLanguage);
			return Translation;
		}

		public static string GetKeyTranslation(string key, bool FixForRTL = true, int maxLineLengthForRTL = 0, bool ignoreRTLnumbers = true, bool applyParameters = false, GameObject localParametersRoot = null, string overrideLanguage = null)
		{
			return GetTranslation(key, FixForRTL, maxLineLengthForRTL, ignoreRTLnumbers, applyParameters, localParametersRoot, overrideLanguage);
		}

		public static bool TryGetTranslation(string key, out string Translation, bool FixForRTL = true, int maxLineLengthForRTL = 0, bool ignoreRTLnumbers = true, bool applyParameters = false, GameObject localParametersRoot = null, string overrideLanguage = null)
		{
			Translation = null;
			if (string.IsNullOrEmpty(key))
			{
				return false;
			}
			InitializeIfNeeded();
			int i = 0;
			for (int count = Sources.Count; i < count; i++)
			{
				if (Sources[i].TryGetTranslation(key, out Translation, overrideLanguage))
				{
					if (applyParameters)
					{
						ApplyLocalizationParams(ref Translation, localParametersRoot);
					}
					return true;
				}
			}
			return false;
		}

		public static T GetTranslatedObject<T>(string AssetName, Localize optionalLocComp = null) where T : UnityEngine.Object
		{
			if (optionalLocComp != null)
			{
				return optionalLocComp.FindTranslatedObject<T>(AssetName);
			}
			T val = FindAsset(AssetName) as T;
			if ((bool)val)
			{
				return val;
			}
			return ResourceManager.pInstance.GetAsset<T>(AssetName);
		}

		public static T GetTranslatedObjectByKeyName<T>(string key, Localize optionalLocComp = null) where T : UnityEngine.Object
		{
			return GetTranslatedObject<T>(GetTranslation(key, FixForRTL: false));
		}

		public static string GetAppName(string languageCode)
		{
			if (!string.IsNullOrEmpty(languageCode))
			{
				for (int i = 0; i < Sources.Count; i++)
				{
					if (string.IsNullOrEmpty(Sources[i].key_AppName))
					{
						continue;
					}
					int languageIndexFromCode = Sources[i].GetLanguageIndexFromCode(languageCode, exactMatch: false);
					if (languageIndexFromCode < 0)
					{
						continue;
					}
					KeyData keyData = Sources[i].GetKeyData(Sources[i].key_AppName);
					if (keyData != null)
					{
						string translation = keyData.GetTranslation(languageIndexFromCode);
						if (!string.IsNullOrEmpty(translation))
						{
							return translation;
						}
					}
				}
			}
			return UnityEngine.Application.productName;
		}

		public static void LocalizeAll(bool Force = false)
		{
			LoadCurrentLanguage();
			if (!UnityEngine.Application.isPlaying)
			{
				DoLocalizeAll(Force);
				return;
			}
			mLocalizeIsScheduledWithForcedValue |= Force;
			if (!mLocalizeIsScheduled)
			{
				CoroutineManager.Start(Coroutine_LocalizeAll());
			}
		}

		private static IEnumerator Coroutine_LocalizeAll()
		{
			mLocalizeIsScheduled = true;
			yield return null;
			mLocalizeIsScheduled = false;
			bool force = mLocalizeIsScheduledWithForcedValue;
			mLocalizeIsScheduledWithForcedValue = false;
			DoLocalizeAll(force);
		}

		private static void DoLocalizeAll(bool Force = false)
		{
			Localize[] array = (Localize[])Resources.FindObjectsOfTypeAll(typeof(Localize));
			int i = 0;
			for (int num = array.Length; i < num; i++)
			{
				array[i].OnLocalize(Force);
			}
			if (LocalizationManager.OnLocalizeEvent != null)
			{
				LocalizationManager.OnLocalizeEvent();
			}
		}

		public static List<string> GetCategories()
		{
			List<string> list = new List<string>();
			int i = 0;
			for (int count = Sources.Count; i < count; i++)
			{
				Sources[i].GetCategories(OnlyMainCategory: false, list);
			}
			return list;
		}

		public static List<string> GetKeysList(string Category = null)
		{
			if (Sources.Count == 0)
			{
				UpdateSources();
			}
			if (Sources.Count == 1)
			{
				return Sources[0].GetKeysList(Category);
			}
			HashSet<string> hashSet = new HashSet<string>();
			int i = 0;
			for (int count = Sources.Count; i < count; i++)
			{
				hashSet.UnionWith(Sources[i].GetKeysList(Category));
			}
			return new List<string>(hashSet);
		}

		public static KeyData GetKeyData(string key)
		{
			InitializeIfNeeded();
			int i = 0;
			for (int count = Sources.Count; i < count; i++)
			{
				KeyData keyData = Sources[i].GetKeyData(key);
				if (keyData != null)
				{
					return keyData;
				}
			}
			return null;
		}

		public static KeyData GetKeyData(string key, out LanguageSourceData source)
		{
			InitializeIfNeeded();
			int i = 0;
			for (int count = Sources.Count; i < count; i++)
			{
				KeyData keyData = Sources[i].GetKeyData(key);
				if (keyData != null)
				{
					source = Sources[i];
					return keyData;
				}
			}
			source = null;
			return null;
		}
	}
	public abstract class ILocalizeTarget : ScriptableObject
	{
		public abstract bool IsValid(Localize cmp);

		public abstract void GetFinalKeys(Localize cmp, string Main, string Secondary, out string primaryKey, out string secondaryKey);

		public abstract void DoLocalize(Localize cmp, string mainTranslation, string secondaryTranslation);

		public abstract bool AllowMainKeyToBeRTL();

		public abstract bool AllowSecondKeyToBeRTL();

		public abstract KeyType GetPrimaryKeyType(Localize cmp);

		public abstract KeyType GetSecondaryKeyType(Localize cmp);
	}
	public abstract class LocalizeTarget<T> : ILocalizeTarget where T : UnityEngine.Object
	{
		public T mTarget;

		public override bool IsValid(Localize cmp)
		{
			if (mTarget != null)
			{
				UnityEngine.Component component = mTarget as UnityEngine.Component;
				if (component != null && component.gameObject != cmp.gameObject)
				{
					mTarget = null;
				}
			}
			if (mTarget == null)
			{
				mTarget = cmp.GetComponent<T>();
			}
			return mTarget != null;
		}
	}
	public abstract class ILocalizeTargetDescriptor
	{
		public string Name;

		public int Priority;

		public abstract bool CanLocalize(Localize cmp);

		public abstract ILocalizeTarget CreateTarget(Localize cmp);

		public abstract Type GetTargetType();
	}
	public abstract class LocalizeTargetDesc<T> : ILocalizeTargetDescriptor where T : ILocalizeTarget
	{
		public override ILocalizeTarget CreateTarget(Localize cmp)
		{
			return ScriptableObject.CreateInstance<T>();
		}

		public override Type GetTargetType()
		{
			return typeof(T);
		}
	}
	public class LocalizeTargetDesc_Type<T, G> : LocalizeTargetDesc<G> where T : UnityEngine.Object where G : LocalizeTarget<T>
	{
		public override bool CanLocalize(Localize cmp)
		{
			return cmp.GetComponent<T>() != null;
		}

		public override ILocalizeTarget CreateTarget(Localize cmp)
		{
			T component = cmp.GetComponent<T>();
			if (component == null)
			{
				return null;
			}
			G val = ScriptableObject.CreateInstance<G>();
			val.mTarget = component;
			return val;
		}
	}
	public class LocalizeTarget_UnityUI_Text : LocalizeTarget<Text>
	{
		private TextAnchor mAlignment_LTR;

		private bool mInitializeAlignment;

		static LocalizeTarget_UnityUI_Text()
		{
			AutoRegister();
		}

		[RuntimeInitializeOnLoadMethod(RuntimeInitializeLoadType.BeforeSceneLoad)]
		private static void AutoRegister()
		{
			LocalizationManager.RegisterTarget(new LocalizeTargetDesc_Type<Text, LocalizeTarget_UnityUI_Text>
			{
				Name = "Text",
				Priority = 100
			});
		}

		public override KeyType GetPrimaryKeyType(Localize cmp)
		{
			return KeyType.Text;
		}

		public override KeyType GetSecondaryKeyType(Localize cmp)
		{
			return KeyType.Font;
		}

		public override bool AllowMainKeyToBeRTL()
		{
			return true;
		}

		public override bool AllowSecondKeyToBeRTL()
		{
			return false;
		}

		public override void GetFinalKeys(Localize cmp, string Main, string Secondary, out string primaryKey, out string secondaryKey)
		{
			primaryKey = (mTarget ? mTarget.text : null);
			secondaryKey = ((mTarget.font != null) ? mTarget.font.name : string.Empty);
		}

		public override void DoLocalize(Localize cmp, string mainTranslation, string secondaryTranslation)
		{
			Font secondaryTranslatedObj = cmp.GetSecondaryTranslatedObj<Font>(ref mainTranslation, ref secondaryTranslation);
			if (secondaryTranslatedObj != null && secondaryTranslatedObj != mTarget.font)
			{
				mTarget.font = secondaryTranslatedObj;
			}
			if (mInitializeAlignment)
			{
				mInitializeAlignment = false;
				InitAlignment(mTarget.alignment, out mAlignment_LTR);
			}
			else
			{
				InitAlignment(mTarget.alignment, out var alignLTR);
				if (mAlignment_LTR != alignLTR)
				{
					mAlignment_LTR = alignLTR;
				}
			}
			if (mainTranslation != null && mTarget.text != mainTranslation)
			{
				mTarget.alignment = mAlignment_LTR;
				mTarget.text = mainTranslation;
				mTarget.SetVerticesDirty();
			}
		}

		private void InitAlignment(TextAnchor alignment, out TextAnchor alignLTR)
		{
			alignLTR = alignment;
		}
	}
	public class CoroutineManager : MonoBehaviour
	{
		private static CoroutineManager mInstance;

		private static CoroutineManager pInstance
		{
			get
			{
				if (mInstance == null)
				{
					GameObject gameObject = new GameObject("_Coroutiner");
					gameObject.hideFlags = HideFlags.HideAndDontSave;
					mInstance = gameObject.AddComponent<CoroutineManager>();
					if (UnityEngine.Application.isPlaying)
					{
						UnityEngine.Object.DontDestroyOnLoad(gameObject);
					}
				}
				return mInstance;
			}
		}

		private void Awake()
		{
			if (UnityEngine.Application.isPlaying)
			{
				UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
			}
		}

		public static Coroutine Start(IEnumerator coroutine)
		{
			return pInstance.StartCoroutine(coroutine);
		}
	}
	public class HindiFixer
	{
		internal static string Fix(string text)
		{
			char[] array = text.ToCharArray();
			bool flag = false;
			for (int i = 0; i < array.Length; i++)
			{
				if (array[i] == '\u093f' && !char.IsWhiteSpace(array[i - 1]) && array[i - 1] != 0)
				{
					array[i] = array[i - 1];
					array[i - 1] = '\u093f';
					flag = true;
				}
				if (i != array.Length - 1)
				{
					if (array[i] == 'इ' && array[i + 1] == '\u093c')
					{
						array[i] = 'ऌ';
						array[i + 1] = '\0';
						flag = true;
					}
					if (array[i] == '\u0943' && array[i + 1] == '\u093c')
					{
						array[i] = '\u0944';
						array[i + 1] = '\0';
						flag = true;
					}
					if (array[i] == '\u0901' && array[i + 1] == '\u093c')
					{
						array[i] = 'ॐ';
						array[i + 1] = '\0';
						flag = true;
					}
					if (array[i] == 'ऋ' && array[i + 1] == '\u093c')
					{
						array[i] = 'ॠ';
						array[i + 1] = '\0';
						flag = true;
					}
					if (array[i] == 'ई' && array[i + 1] == '\u093c')
					{
						array[i] = 'ॡ';
						array[i + 1] = '\0';
						flag = true;
					}
					if (array[i] == '\u093f' && array[i + 1] == '\u093c')
					{
						array[i] = '\u0962';
						array[i + 1] = '\0';
						flag = true;
					}
					if (array[i] == '\u0940' && array[i + 1] == '\u093c')
					{
						array[i] = '\u0963';
						array[i + 1] = '\0';
						flag = true;
					}
					if (array[i] == '।' && array[i + 1] == '\u093c')
					{
						array[i] = 'ऽ';
						array[i + 1] = '\0';
						flag = true;
					}
				}
			}
			if (!flag)
			{
				return text;
			}
			string text2 = new string(array.Where((char x) => x != '\0').ToArray());
			if (text2 == text)
			{
				return text2;
			}
			text = text2;
			return text;
		}
	}
	public static class Utils
	{
		public const string ValidChars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_";

		public const string NumberChars = "0123456789";

		public const string ValidNameSymbols = ".-_$#@*()[]{}+:?!&',^=<>~`";

		public static string ReverseText(string source)
		{
			int length = source.Length;
			char[] array = new char[length];
			for (int i = 0; i < length; i++)
			{
				array[length - 1 - i] = source[i];
			}
			return new string(array);
		}

		public static string RemoveNonASCII(string text, bool allowCategory = false)
		{
			if (string.IsNullOrEmpty(text))
			{
				return text;
			}
			int num = 0;
			char[] array = new char[text.Length];
			bool flag = false;
			char[] array2 = text.Trim().ToCharArray();
			foreach (char c in array2)
			{
				char c2 = ' ';
				if ((allowCategory && (c == '\\' || c == '"' || c == '/')) || char.IsLetterOrDigit(c) || ".-_$#@*()[]{}+:?!&',^=<>~`".IndexOf(c) >= 0)
				{
					c2 = c;
				}
				if (char.IsWhiteSpace(c2))
				{
					if (!flag)
					{
						if (num > 0)
						{
							array[num++] = ' ';
						}
						flag = true;
					}
				}
				else
				{
					flag = false;
					array[num++] = c2;
				}
			}
			return new string(array, 0, num);
		}

		public static string GetValidKeyName(string text, bool allowCategory = false)
		{
			if (text == null)
			{
				return null;
			}
			text = RemoveTags(text);
			return RemoveNonASCII(text, allowCategory);
		}

		public static string SplitLine(string line, int maxCharacters)
		{
			if (maxCharacters <= 0 || line.Length < maxCharacters)
			{
				return line;
			}
			char[] array = line.ToCharArray();
			bool flag = true;
			bool flag2 = false;
			int i = 0;
			int num = 0;
			for (; i < array.Length; i++)
			{
				if (flag)
				{
					num++;
					if (array[i] == '\n')
					{
						num = 0;
					}
					if (num >= maxCharacters && char.IsWhiteSpace(array[i]))
					{
						array[i] = '\n';
						flag = false;
						flag2 = false;
					}
				}
				else if (!char.IsWhiteSpace(array[i]))
				{
					flag = true;
					num = 0;
				}
				else if (array[i] != '\n')
				{
					array[i] = '\0';
				}
				else
				{
					if (!flag2)
					{
						array[i] = '\0';
					}
					flag2 = true;
				}
			}
			return new string(array.Where((char c) => c != '\0').ToArray());
		}

		public static bool FindNextTag(string line, int iStart, out int tagStart, out int tagEnd)
		{
			tagStart = -1;
			tagEnd = -1;
			int length = line.Length;
			tagStart = iStart;
			while (tagStart < length && line[tagStart] != '[' && line[tagStart] != '(' && line[tagStart] != '{' && line[tagStart] != '<')
			{
				tagStart++;
			}
			if (tagStart == length)
			{
				return false;
			}
			bool flag = false;
			for (tagEnd = tagStart + 1; tagEnd < length; tagEnd++)
			{
				char c = line[tagEnd];
				if (c == ']' || c == ')' || c == '}' || c == '>')
				{
					if (flag)
					{
						return FindNextTag(line, tagEnd + 1, out tagStart, out tagEnd);
					}
					return true;
				}
				if (c > 'ÿ')
				{
					flag = true;
				}
			}
			return false;
		}

		public static string RemoveTags(string text)
		{
			return Regex.Replace(text, "\\{\\[(.*?)]}|\\[(.*?)]|\\<(.*?)>", "");
		}

		public static bool RemoveResourcesPath(ref string sPath)
		{
			int num = sPath.IndexOf("\\Resources\\");
			int num2 = sPath.IndexOf("\\Resources/");
			int num3 = sPath.IndexOf("/Resources\\");
			int num4 = sPath.IndexOf("/Resources/");
			int num5 = Mathf.Max(num, num2, num3, num4);
			bool result = false;
			if (num5 >= 0)
			{
				sPath = sPath.Substring(num5 + 11);
				result = true;
			}
			else
			{
				num5 = sPath.LastIndexOfAny(LanguageSourceData.CategorySeparators);
				if (num5 > 0)
				{
					sPath = sPath.Substring(num5 + 1);
				}
			}
			string extension = System.IO.Path.GetExtension(sPath);
			if (!string.IsNullOrEmpty(extension))
			{
				sPath = sPath.Substring(0, sPath.Length - extension.Length);
			}
			return result;
		}

		public static bool IsPlaying()
		{
			if (UnityEngine.Application.isPlaying)
			{
				return true;
			}
			return false;
		}

		public static string GetPath(this Transform tr)
		{
			Transform parent = tr.parent;
			if (tr == null)
			{
				return tr.name;
			}
			return parent.GetPath() + "/" + tr.name;
		}

		public static Transform FindObject(string objectPath)
		{
			return FindObject(SceneManager.GetActiveScene(), objectPath);
		}

		public static Transform FindObject(Scene scene, string objectPath)
		{
			GameObject[] rootGameObjects = scene.GetRootGameObjects();
			for (int i = 0; i < rootGameObjects.Length; i++)
			{
				Transform transform = rootGameObjects[i].transform;
				if (transform.name == objectPath)
				{
					return transform;
				}
				if (objectPath.StartsWith(transform.name + "/"))
				{
					return FindObject(transform, objectPath.Substring(transform.name.Length + 1));
				}
			}
			return null;
		}

		public static Transform FindObject(Transform root, string objectPath)
		{
			for (int i = 0; i < root.childCount; i++)
			{
				Transform child = root.GetChild(i);
				if (child.name == objectPath)
				{
					return child;
				}
				if (objectPath.StartsWith(child.name + "/"))
				{
					return FindObject(child, objectPath.Substring(child.name.Length + 1));
				}
			}
			return null;
		}

		public static H FindInParents<H>(Transform tr) where H : UnityEngine.Component
		{
			if (!tr)
			{
				return null;
			}
			H component = tr.GetComponent<H>();
			while (!component && (bool)tr)
			{
				component = tr.GetComponent<H>();
				tr = tr.parent;
			}
			return component;
		}

		public static string GetCaptureMatch(Match match)
		{
			for (int num = match.Groups.Count - 1; num >= 0; num--)
			{
				if (match.Groups[num].Success)
				{
					return match.Groups[num].ToString();
				}
			}
			return match.ToString();
		}

		public static void SendWebRequest(UnityWebRequest www)
		{
			www.SendWebRequest();
		}
	}
	public interface ILocalizationParamsManager
	{
		string GetParameterValue(string Param);
	}
	public class LocalizationParamsManager : MonoBehaviour, ILocalizationParamsManager
	{
		[Serializable]
		public struct ParamValue
		{
			public string Name;

			public string Value;
		}

		[SerializeField]
		public List<ParamValue> _Params = new List<ParamValue>();

		public bool _IsGlobalManager;

		public string GetParameterValue(string ParamName)
		{
			if (_Params != null)
			{
				int i = 0;
				for (int count = _Params.Count; i < count; i++)
				{
					if (_Params[i].Name == ParamName)
					{
						return _Params[i].Value;
					}
				}
			}
			return null;
		}

		public void SetParameterValue(string ParamName, string ParamValue, bool localize = true)
		{
			bool flag = false;
			int i = 0;
			for (int count = _Params.Count; i < count; i++)
			{
				if (_Params[i].Name == ParamName)
				{
					ParamValue value = _Params[i];
					value.Value = ParamValue;
					_Params[i] = value;
					flag = true;
					break;
				}
			}
			if (!flag)
			{
				_Params.Add(new ParamValue
				{
					Name = ParamName,
					Value = ParamValue
				});
			}
			if (localize)
			{
				OnLocalize();
			}
		}

		public void OnLocalize()
		{
			Localize component = GetComponent<Localize>();
			if (component != null)
			{
				component.OnLocalize(Force: true);
			}
		}

		public virtual void OnEnable()
		{
			if (_IsGlobalManager)
			{
				DoAutoRegister();
			}
		}

		public void DoAutoRegister()
		{
			if (!LocalizationManager.ParamManagers.Contains(this))
			{
				LocalizationManager.ParamManagers.Add(this);
				LocalizationManager.LocalizeAll(Force: true);
			}
		}

		public void OnDisable()
		{
			LocalizationManager.ParamManagers.Remove(this);
		}
	}
	[Serializable]
	public struct LocalizedString
	{
		public string key;

		public bool mRTL_IgnoreArabicFix;

		public int mRTL_MaxLineLength;

		public bool mRTL_ConvertNumbers;

		public bool m_DontLocalizeParameters;

		public static implicit operator string(LocalizedString s)
		{
			return s.ToString();
		}

		public static implicit operator LocalizedString(string k)
		{
			LocalizedString result = default(LocalizedString);
			result.key = k;
			return result;
		}

		public LocalizedString(LocalizedString str)
		{
			key = str.key;
			mRTL_IgnoreArabicFix = str.mRTL_IgnoreArabicFix;
			mRTL_MaxLineLength = str.mRTL_MaxLineLength;
			mRTL_ConvertNumbers = str.mRTL_ConvertNumbers;
			m_DontLocalizeParameters = str.m_DontLocalizeParameters;
		}

		public override string ToString()
		{
			string translation = LocalizationManager.GetTranslation(key, !mRTL_IgnoreArabicFix, mRTL_MaxLineLength, !mRTL_ConvertNumbers, applyParameters: true);
			LocalizationManager.ApplyLocalizationParams(ref translation, !m_DontLocalizeParameters);
			return translation;
		}
	}
	public class RegisterGlobalParameters : MonoBehaviour, ILocalizationParamsManager
	{
		public virtual void OnEnable()
		{
			if (!LocalizationManager.ParamManagers.Contains(this))
			{
				LocalizationManager.ParamManagers.Add(this);
				LocalizationManager.LocalizeAll(Force: true);
			}
		}

		public virtual void OnDisable()
		{
			LocalizationManager.ParamManagers.Remove(this);
		}

		public virtual string GetParameterValue(string ParamName)
		{
			return null;
		}
	}
	public interface IResourceManager_Bundles
	{
		UnityEngine.Object LoadFromBundle(string path, Type assetType);
	}
	public class ResourceManager : MonoBehaviour
	{
		private static ResourceManager mInstance;

		public List<IResourceManager_Bundles> mBundleManagers = new List<IResourceManager_Bundles>();

		public UnityEngine.Object[] Assets;

		private readonly Dictionary<string, UnityEngine.Object> mResourcesCache = new Dictionary<string, UnityEngine.Object>(StringComparer.Ordinal);

		public static ResourceManager pInstance
		{
			get
			{
				bool flag = mInstance == null;
				if (mInstance == null)
				{
					mInstance = (ResourceManager)UnityEngine.Object.FindObjectOfType(typeof(ResourceManager));
				}
				if (mInstance == null)
				{
					GameObject obj = new GameObject("I2ResourceManager", typeof(ResourceManager));
					obj.hideFlags |= HideFlags.HideAndDontSave;
					mInstance = obj.GetComponent<ResourceManager>();
					SceneManager.sceneLoaded += MyOnLevelWasLoaded;
				}
				if (flag && UnityEngine.Application.isPlaying)
				{
					UnityEngine.Object.DontDestroyOnLoad(mInstance.gameObject);
				}
				return mInstance;
			}
		}

		public static void MyOnLevelWasLoaded(Scene scene, LoadSceneMode mode)
		{
			pInstance.CleanResourceCache();
			LocalizationManager.UpdateSources();
		}

		public T GetAsset<T>(string Name) where T : UnityEngine.Object
		{
			T val = FindAsset(Name) as T;
			if (val != null)
			{
				return val;
			}
			return LoadFromResources<T>(Name);
		}

		private UnityEngine.Object FindAsset(string Name)
		{
			if (Assets != null)
			{
				int i = 0;
				for (int num = Assets.Length; i < num; i++)
				{
					if (Assets[i] != null && Assets[i].name == Name)
					{
						return Assets[i];
					}
				}
			}
			return null;
		}

		public bool HasAsset(UnityEngine.Object Obj)
		{
			if (Assets == null)
			{
				return false;
			}
			return Array.IndexOf(Assets, Obj) >= 0;
		}

		public T LoadFromResources<T>(string Path) where T : UnityEngine.Object
		{
			try
			{
				if (string.IsNullOrEmpty(Path))
				{
					return null;
				}
				if (mResourcesCache.TryGetValue(Path, out var value) && value != null)
				{
					return value as T;
				}
				T val = null;
				if (Path.EndsWith("]", StringComparison.OrdinalIgnoreCase))
				{
					int num = Path.LastIndexOf("[", StringComparison.OrdinalIgnoreCase);
					int length = Path.Length - num - 2;
					string value2 = Path.Substring(num + 1, length);
					Path = Path.Substring(0, num);
					T[] array = Resources.LoadAll<T>(Path);
					int i = 0;
					for (int num2 = array.Length; i < num2; i++)
					{
						if (array[i].name.Equals(value2))
						{
							val = array[i];
							break;
						}
					}
				}
				else
				{
					val = Resources.Load(Path, typeof(T)) as T;
				}
				if (val == null)
				{
					val = LoadFromBundle<T>(Path);
				}
				if (val != null)
				{
					mResourcesCache[Path] = val;
				}
				return val;
			}
			catch (Exception ex)
			{
				UnityEngine.Debug.LogErrorFormat("Unable to load {0} '{1}'\nERROR: {2}", typeof(T), Path, ex.ToString());
				return null;
			}
		}

		public T LoadFromBundle<T>(string path) where T : UnityEngine.Object
		{
			int i = 0;
			for (int count = mBundleManagers.Count; i < count; i++)
			{
				if (mBundleManagers[i] != null)
				{
					T val = mBundleManagers[i].LoadFromBundle(path, typeof(T)) as T;
					if (val != null)
					{
						return val;
					}
				}
			}
			return null;
		}

		public void CleanResourceCache()
		{
			mResourcesCache.Clear();
			Resources.UnloadUnusedAssets();
			CancelInvoke();
		}
	}
	public class RTLFixer
	{
		public static string Fix(string str)
		{
			return Fix(str, showTashkeel: false, useHinduNumbers: true);
		}

		public static string Fix(string str, bool rtl)
		{
			if (rtl)
			{
				return Fix(str);
			}
			string[] array = str.Split(' ');
			string text = "";
			string text2 = "";
			string[] array2 = array;
			foreach (string text3 in array2)
			{
				if (char.IsLower(text3.ToLower()[text3.Length / 2]))
				{
					text = text + Fix(text2) + text3 + " ";
					text2 = "";
				}
				else
				{
					text2 = text2 + text3 + " ";
				}
			}
			if (text2 != "")
			{
				text += Fix(text2);
			}
			return text;
		}

		public static string Fix(string str, bool showTashkeel, bool useHinduNumbers)
		{
			string text = HindiFixer.Fix(str);
			if (text != str)
			{
				return text;
			}
			RTLFixerTool.showTashkeel = showTashkeel;
			RTLFixerTool.useHinduNumbers = useHinduNumbers;
			if (str.Contains("\n"))
			{
				str = str.Replace("\n", Environment.NewLine);
			}
			if (str.Contains(Environment.NewLine))
			{
				string[] separator = new string[1] { Environment.NewLine };
				string[] array = str.Split(separator, StringSplitOptions.None);
				if (array.Length == 0)
				{
					return RTLFixerTool.FixLine(str);
				}
				if (array.Length == 1)
				{
					return RTLFixerTool.FixLine(str);
				}
				string text2 = RTLFixerTool.FixLine(array[0]);
				int i = 1;
				if (array.Length > 1)
				{
					for (; i < array.Length; i++)
					{
						text2 = text2 + Environment.NewLine + RTLFixerTool.FixLine(array[i]);
					}
				}
				return text2;
			}
			return RTLFixerTool.FixLine(str);
		}
	}
	internal enum IsolatedArabicLetters
	{
		Hamza = 65152,
		Alef = 65165,
		AlefHamza = 65155,
		WawHamza = 65157,
		AlefMaksoor = 65159,
		AlefMaksora = 64508,
		HamzaNabera = 65161,
		Ba = 65167,
		Ta = 65173,
		Tha2 = 65177,
		Jeem = 65181,
		H7aa = 65185,
		Khaa2 = 65189,
		Dal = 65193,
		Thal = 65195,
		Ra2 = 65197,
		Zeen = 65199,
		Seen = 65201,
		Sheen = 65205,
		S9a = 65209,
		Dha = 65213,
		T6a = 65217,
		T6ha = 65221,
		Ain = 65225,
		Gain = 65229,
		Fa = 65233,
		Gaf = 65237,
		Kaf = 65241,
		Lam = 65245,
		Meem = 65249,
		Noon = 65253,
		Ha = 65257,
		Waw = 65261,
		Ya = 65265,
		AlefMad = 65153,
		TaMarboota = 65171,
		PersianPe = 64342,
		PersianChe = 64378,
		PersianZe = 64394,
		PersianGaf = 64402,
		PersianGaf2 = 64398
	}
	internal enum GeneralArabicLetters
	{
		Hamza = 1569,
		Alef = 1575,
		AlefHamza = 1571,
		WawHamza = 1572,
		AlefMaksoor = 1573,
		AlefMagsora = 1609,
		HamzaNabera = 1574,
		Ba = 1576,
		Ta = 1578,
		Tha2 = 1579,
		Jeem = 1580,
		H7aa = 1581,
		Khaa2 = 1582,
		Dal = 1583,
		Thal = 1584,
		Ra2 = 1585,
		Zeen = 1586,
		Seen = 1587,
		Sheen = 1588,
		S9a = 1589,
		Dha = 1590,
		T6a = 1591,
		T6ha = 1592,
		Ain = 1593,
		Gain = 1594,
		Fa = 1601,
		Gaf = 1602,
		Kaf = 1603,
		Lam = 1604,
		Meem = 1605,
		Noon = 1606,
		Ha = 1607,
		Waw = 1608,
		Ya = 1610,
		AlefMad = 1570,
		TaMarboota = 1577,
		PersianPe = 1662,
		PersianChe = 1670,
		PersianZe = 1688,
		PersianGaf = 1711,
		PersianGaf2 = 1705
	}
	internal class ArabicMapping
	{
		public int from;

		public int to;

		public ArabicMapping(int from, int to)
		{
			this.from = from;
			this.to = to;
		}
	}
	internal class ArabicTable
	{
		private static List<ArabicMapping> mapList;

		private static ArabicTable arabicMapper;

		internal static ArabicTable ArabicMapper
		{
			get
			{
				if (arabicMapper == null)
				{
					arabicMapper = new ArabicTable();
				}
				return arabicMapper;
			}
		}

		private ArabicTable()
		{
			mapList = new List<ArabicMapping>();
			mapList.Add(new ArabicMapping(1569, 65152));
			mapList.Add(new ArabicMapping(1575, 65165));
			mapList.Add(new ArabicMapping(1571, 65155));
			mapList.Add(new ArabicMapping(1572, 65157));
			mapList.Add(new ArabicMapping(1573, 65159));
			mapList.Add(new ArabicMapping(1609, 64508));
			mapList.Add(new ArabicMapping(1574, 65161));
			mapList.Add(new ArabicMapping(1576, 65167));
			mapList.Add(new ArabicMapping(1578, 65173));
			mapList.Add(new ArabicMapping(1579, 65177));
			mapList.Add(new ArabicMapping(1580, 65181));
			mapList.Add(new ArabicMapping(1581, 65185));
			mapList.Add(new ArabicMapping(1582, 65189));
			mapList.Add(new ArabicMapping(1583, 65193));
			mapList.Add(new ArabicMapping(1584, 65195));
			mapList.Add(new ArabicMapping(1585, 65197));
			mapList.Add(new ArabicMapping(1586, 65199));
			mapList.Add(new ArabicMapping(1587, 65201));
			mapList.Add(new ArabicMapping(1588, 65205));
			mapList.Add(new ArabicMapping(1589, 65209));
			mapList.Add(new ArabicMapping(1590, 65213));
			mapList.Add(new ArabicMapping(1591, 65217));
			mapList.Add(new ArabicMapping(1592, 65221));
			mapList.Add(new ArabicMapping(1593, 65225));
			mapList.Add(new ArabicMapping(1594, 65229));
			mapList.Add(new ArabicMapping(1601, 65233));
			mapList.Add(new ArabicMapping(1602, 65237));
			mapList.Add(new ArabicMapping(1603, 65241));
			mapList.Add(new ArabicMapping(1604, 65245));
			mapList.Add(new ArabicMapping(1605, 65249));
			mapList.Add(new ArabicMapping(1606, 65253));
			mapList.Add(new ArabicMapping(1607, 65257));
			mapList.Add(new ArabicMapping(1608, 65261));
			mapList.Add(new ArabicMapping(1610, 65265));
			mapList.Add(new ArabicMapping(1570, 65153));
			mapList.Add(new ArabicMapping(1577, 65171));
			mapList.Add(new ArabicMapping(1662, 64342));
			mapList.Add(new ArabicMapping(1670, 64378));
			mapList.Add(new ArabicMapping(1688, 64394));
			mapList.Add(new ArabicMapping(1711, 64402));
			mapList.Add(new ArabicMapping(1705, 64398));
		}

		internal int Convert(int toBeConverted)
		{
			foreach (ArabicMapping map in mapList)
			{
				if (map.from == toBeConverted)
				{
					return map.to;
				}
			}
			return toBeConverted;
		}
	}
	internal class TashkeelLocation
	{
		public char tashkeel;

		public int position;

		public TashkeelLocation(char tashkeel, int position)
		{
			this.tashkeel = tashkeel;
			this.position = position;
		}
	}
	internal class RTLFixerTool
	{
		internal static bool showTashkeel = true;

		internal static bool useHinduNumbers = false;

		internal static string RemoveTashkeel(string str, out List<TashkeelLocation> tashkeelLocation)
		{
			tashkeelLocation = new List<TashkeelLocation>();
			char[] array = str.ToCharArray();
			int num = 0;
			for (int i = 0; i < array.Length; i++)
			{
				if (array[i] == '\u064b')
				{
					tashkeelLocation.Add(new TashkeelLocation('\u064b', i));
					num++;
				}
				else if (array[i] == '\u064c')
				{
					tashkeelLocation.Add(new TashkeelLocation('\u064c', i));
					num++;
				}
				else if (array[i] == '\u064d')
				{
					tashkeelLocation.Add(new TashkeelLocation('\u064d', i));
					num++;
				}
				else if (array[i] == '\u064e')
				{
					if (num > 0 && tashkeelLocation[num - 1].tashkeel == '\u0651')
					{
						tashkeelLocation[num - 1].tashkeel = 'ﱠ';
						continue;
					}
					tashkeelLocation.Add(new TashkeelLocation('\u064e', i));
					num++;
				}
				else if (array[i] == '\u064f')
				{
					if (num > 0 && tashkeelLocation[num - 1].tashkeel == '\u0651')
					{
						tashkeelLocation[num - 1].tashkeel = 'ﱡ';
						continue;
					}
					tashkeelLocation.Add(new TashkeelLocation('\u064f', i));
					num++;
				}
				else if (array[i] == '\u0650')
				{
					if (num > 0 && tashkeelLocation[num - 1].tashkeel == '\u0651')
					{
						tashkeelLocation[num - 1].tashkeel = 'ﱢ';
						continue;
					}
					tashkeelLocation.Add(new TashkeelLocation('\u0650', i));
					num++;
				}
				else if (array[i] == '\u0651')
				{
					if (num > 0)
					{
						if (tashkeelLocation[num - 1].tashkeel == '\u064e')
						{
							tashkeelLocation[num - 1].tashkeel = 'ﱠ';
							continue;
						}
						if (tashkeelLocation[num - 1].tashkeel == '\u064f')
						{
							tashkeelLocation[num - 1].tashkeel = 'ﱡ';
							continue;
						}
						if (tashkeelLocation[num - 1].tashkeel == '\u0650')
						{
							tashkeelLocation[num - 1].tashkeel = 'ﱢ';
							continue;
						}
					}
					tashkeelLocation.Add(new TashkeelLocation('\u0651', i));
					num++;
				}
				else if (array[i] == '\u0652')
				{
					tashkeelLocation.Add(new TashkeelLocation('\u0652', i));
					num++;
				}
				else if (array[i] == '\u0653')
				{
					tashkeelLocation.Add(new TashkeelLocation('\u0653', i));
					num++;
				}
			}
			string[] array2 = str.Split('\u064b', '\u064c', '\u064d', '\u064e', '\u064f', '\u0650', '\u0651', '\u0652', '\u0653', 'ﱠ', 'ﱡ', 'ﱢ');
			str = "";
			string[] array3 = array2;
			foreach (string text in array3)
			{
				str += text;
			}
			return str;
		}

		internal static char[] ReturnTashkeel(char[] letters, List<TashkeelLocation> tashkeelLocation)
		{
			char[] array = new char[letters.Length + tashkeelLocation.Count];
			int num = 0;
			for (int i = 0; i < letters.Length; i++)
			{
				array[num] = letters[i];
				num++;
				foreach (TashkeelLocation item in tashkeelLocation)
				{
					if (item.position == num)
					{
						array[num] = item.tashkeel;
						num++;
					}
				}
			}
			return array;
		}

		internal static string FixLine(string str)
		{
			string text = "";
			List<TashkeelLocation> tashkeelLocation;
			string text2 = RemoveTashkeel(str, out tashkeelLocation);
			char[] array = text2.ToCharArray();
			char[] array2 = text2.ToCharArray();
			for (int i = 0; i < array.Length; i++)
			{
				array[i] = (char)ArabicTable.ArabicMapper.Convert(array[i]);
			}
			for (int j = 0; j < array.Length; j++)
			{
				bool flag = false;
				if (array[j] == 'ﻝ' && j < array.Length - 1)
				{
					if (array[j + 1] == 'ﺇ')
					{
						array[j] = 'ﻷ';
						array2[j + 1] = '\uffff';
						flag = true;
					}
					else if (array[j + 1] == 'ﺍ')
					{
						array[j] = 'ﻹ';
						array2[j + 1] = '\uffff';
						flag = true;
					}
					else if (array[j + 1] == 'ﺃ')
					{
						array[j] = 'ﻵ';
						array2[j + 1] = '\uffff';
						flag = true;
					}
					else if (array[j + 1] == 'ﺁ')
					{
						array[j] = 'ﻳ';
						array2[j + 1] = '\uffff';
						flag = true;
					}
				}
				if (!IsIgnoredCharacter(array[j]))
				{
					if (IsMiddleLetter(array, j))
					{
						array2[j] = (char)(array[j] + 3);
					}
					else if (IsFinishingLetter(array, j))
					{
						array2[j] = (char)(array[j] + 1);
					}
					else if (IsLeadingLetter(array, j))
					{
						array2[j] = (char)(array[j] + 2);
					}
				}
				text = text + Convert.ToString(array[j], 16) + " ";
				if (flag)
				{
					j++;
				}
				if (useHinduNumbers)
				{
					if (array[j] == '0')
					{
						array2[j] = '٠';
					}
					else if (array[j] == '1')
					{
						array2[j] = '١';
					}
					else if (array[j] == '2')
					{
						array2[j] = '٢';
					}
					else if (array[j] == '3')
					{
						array2[j] = '٣';
					}
					else if (array[j] == '4')
					{
						array2[j] = '٤';
					}
					else if (array[j] == '5')
					{
						array2[j] = '٥';
					}
					else if (array[j] == '6')
					{
						array2[j] = '٦';
					}
					else if (array[j] == '7')
					{
						array2[j] = '٧';
					}
					else if (array[j] == '8')
					{
						array2[j] = '٨';
					}
					else if (array[j] == '9')
					{
						array2[j] = '٩';
					}
				}
			}
			if (showTashkeel)
			{
				array2 = ReturnTashkeel(array2, tashkeelLocation);
			}
			List<char> list = new List<char>();
			List<char> list2 = new List<char>();
			for (int num = array2.Length - 1; num >= 0; num--)
			{
				if (char.IsPunctuation(array2[num]) && num > 0 && num < array2.Length - 1 && (char.IsPunctuation(array2[num - 1]) || char.IsPunctuation(array2[num + 1])))
				{
					if (array2[num] == '(')
					{
						list.Add(')');
					}
					else if (array2[num] == ')')
					{
						list.Add('(');
					}
					else if (array2[num] == '<')
					{
						list.Add('>');
					}
					else if (array2[num] == '>')
					{
						list.Add('<');
					}
					else if (array2[num] == '[')
					{
						list.Add(']');
					}
					else if (array2[num] == ']')
					{
						list.Add('[');
					}
					else if (array2[num] != '\uffff')
					{
						list.Add(array2[num]);
					}
				}
				else if (array2[num] == ' ' && num > 0 && num < array2.Length - 1 && (char.IsLower(array2[num - 1]) || char.IsUpper(array2[num - 1]) || char.IsNumber(array2[num - 1])) && (char.IsLower(array2[num + 1]) || char.IsUpper(array2[num + 1]) || char.IsNumber(array2[num + 1])))
				{
					list2.Add(array2[num]);
				}
				else if (char.IsNumber(array2[num]) || char.IsLower(array2[num]) || char.IsUpper(array2[num]) || char.IsSymbol(array2[num]) || char.IsPunctuation(array2[num]))
				{
					if (array2[num] == '(')
					{
						list2.Add(')');
					}
					else if (array2[num] == ')')
					{
						list2.Add('(');
					}
					else if (array2[num] == '<')
					{
						list2.Add('>');
					}
					else if (array2[num] == '>')
					{
						list2.Add('<');
					}
					else if (array2[num] == '[')
					{
						list.Add(']');
					}
					else if (array2[num] == ']')
					{
						list.Add('[');
					}
					else
					{
						list2.Add(array2[num]);
					}
				}
				else if ((array2[num] >= '\ud800' && array2[num] <= '\udbff') || (array2[num] >= '\udc00' && array2[num] <= '\udfff'))
				{
					list2.Add(array2[num]);
				}
				else
				{
					if (list2.Count > 0)
					{
						for (int k = 0; k < list2.Count; k++)
						{
							list.Add(list2[list2.Count - 1 - k]);
						}
						list2.Clear();
					}
					if (array2[num] != '\uffff')
					{
						list.Add(array2[num]);
					}
				}
			}
			if (list2.Count > 0)
			{
				for (int l = 0; l < list2.Count; l++)
				{
					list.Add(list2[list2.Count - 1 - l]);
				}
				list2.Clear();
			}
			array2 = new char[list.Count];
			for (int m = 0; m < array2.Length; m++)
			{
				array2[m] = list[m];
			}
			str = new string(array2);
			return str;
		}

		internal static bool IsIgnoredCharacter(char ch)
		{
			bool num = char.IsPunctuation(ch);
			bool flag = char.IsNumber(ch);
			bool flag2 = char.IsLower(ch);
			bool flag3 = char.IsUpper(ch);
			bool flag4 = char.IsSymbol(ch);
			bool flag5 = ch == 'ﭖ' || ch == 'ﭺ' || ch == 'ﮊ' || ch == 'ﮒ' || ch == 'ﮎ';
			bool flag6 = (ch <= '\ufeff' && ch >= 'ﹰ') || flag5 || ch == 'ﯼ';
			if (!(num || flag || flag2 || flag3 || flag4) && flag6 && ch != 'a' && ch != '>' && ch != '<')
			{
				return ch == '؛';
			}
			return true;
		}

		internal static bool IsLeadingLetter(char[] letters, int index)
		{
			bool num = index == 0 || letters[index - 1] == ' ' || letters[index - 1] == '*' || letters[index - 1] == 'A' || char.IsPunctuation(letters[index - 1]) || letters[index - 1] == '>' || letters[index - 1] == '<' || letters[index - 1] == 'ﺍ' || letters[index - 1] == 'ﺩ' || letters[index - 1] == 'ﺫ' || letters[index - 1] == 'ﺭ' || letters[index - 1] == 'ﺯ' || letters[index - 1] == 'ﮊ' || letters[index - 1] == 'ﻭ' || letters[index - 1] == 'ﺁ' || letters[index - 1] == 'ﺃ' || letters[index - 1] == 'ﺇ' || letters[index - 1] == 'ﺅ';
			bool flag = letters[index] != ' ' && letters[index] != 'ﺩ' && letters[index] != 'ﺫ' && letters[index] != 'ﺭ' && letters[index] != 'ﺯ' && letters[index] != 'ﮊ' && letters[index] != 'ﺍ' && letters[index] != 'ﺃ' && letters[index] != 'ﺇ' && letters[index] != 'ﺁ' && letters[index] != 'ﺅ' && letters[index] != 'ﻭ' && letters[index] != 'ﺀ';
			bool flag2 = index < letters.Length - 1 && letters[index + 1] != ' ' && !char.IsPunctuation(letters[index + 1]) && !char.IsNumber(letters[index + 1]) && !char.IsSymbol(letters[index + 1]) && !char.IsLower(letters[index + 1]) && !char.IsUpper(letters[index + 1]) && letters[index + 1] != 'ﺀ';
			if (num && flag && flag2)
			{
				return true;
			}
			return false;
		}

		internal static bool IsFinishingLetter(char[] letters, int index)
		{
			bool num = index != 0 && letters[index - 1] != ' ' && letters[index - 1] != 'ﺩ' && letters[index - 1] != 'ﺫ' && letters[index - 1] != 'ﺭ' && letters[index - 1] != 'ﺯ' && letters[index - 1] != 'ﮊ' && letters[index - 1] != 'ﻭ' && letters[index - 1] != 'ﺍ' && letters[index - 1] != 'ﺁ' && letters[index - 1] != 'ﺃ' && letters[index - 1] != 'ﺇ' && letters[index - 1] != 'ﺅ' && letters[index - 1] != 'ﺀ' && !char.IsPunctuation(letters[index - 1]) && letters[index - 1] != '>' && letters[index - 1] != '<';
			bool flag = letters[index] != ' ' && letters[index] != 'ﺀ';
			if (num && flag)
			{
				return true;
			}
			return false;
		}

		internal static bool IsMiddleLetter(char[] letters, int index)
		{
			bool flag = index != 0 && letters[index] != 'ﺍ' && letters[index] != 'ﺩ' && letters[index] != 'ﺫ' && letters[index] != 'ﺭ' && letters[index] != 'ﺯ' && letters[index] != 'ﮊ' && letters[index] != 'ﻭ' && letters[index] != 'ﺁ' && letters[index] != 'ﺃ' && letters[index] != 'ﺇ' && letters[index] != 'ﺅ' && letters[index] != 'ﺀ';
			bool flag2 = index != 0 && letters[index - 1] != 'ﺍ' && letters[index - 1] != 'ﺩ' && letters[index - 1] != 'ﺫ' && letters[index - 1] != 'ﺭ' && letters[index - 1] != 'ﺯ' && letters[index - 1] != 'ﮊ' && letters[index - 1] != 'ﻭ' && letters[index - 1] != 'ﺁ' && letters[index - 1] != 'ﺃ' && letters[index - 1] != 'ﺇ' && letters[index - 1] != 'ﺅ' && letters[index - 1] != 'ﺀ' && !char.IsPunctuation(letters[index - 1]) && letters[index - 1] != '>' && letters[index - 1] != '<' && letters[index - 1] != ' ' && letters[index - 1] != '*';
			if (index < letters.Length - 1 && letters[index + 1] != ' ' && letters[index + 1] != '\r' && letters[index + 1] != 'ﺀ' && !char.IsNumber(letters[index + 1]) && !char.IsSymbol(letters[index + 1]) && !char.IsPunctuation(letters[index + 1]) && flag2 && flag)
			{
				try
				{
					if (char.IsPunctuation(letters[index + 1]))
					{
						return false;
					}
					return true;
				}
				catch
				{
					return false;
				}
			}
			return false;
		}
	}
}
namespace UnityEngine.EventSystems
{
	public class VRInputModule : PointerInputModule
	{
		public RaycasterStatus raycasterStatusL;

		public RaycasterStatus raycasterStatusR;

		public VRPointerBase vRPointerL;

		public VRPointerBase vRPointerR;

		public bool useSphereCastForPointer;

		public bool useRightStickScroll = true;

		public float rightStickDeadZone = 0.15f;

		[NonSerialized]
		public VRUIRaycaster activeGraphicRaycaster;

		public float angleDragThreshold = 1f;

		[SerializeField]
		private float m_SpherecastRadius = 1f;

		public bool useRaycaster = true;

		[SerializeField]
		private string m_HorizontalAxis = "Horizontal";

		[SerializeField]
		private string m_VerticalAxis = "Vertical";

		[SerializeField]
		private string m_SubmitButton = "Submit";

		[SerializeField]
		private string m_CancelButton = "Cancel";

		[SerializeField]
		private bool m_AllowActivationOnMobileDevice;

		private float m_NextAction;

		private Vector2 m_LastMousePosition;

		private Vector2 m_MousePosition;

		public GameObject gameObjectOverL;

		public GameObject gameObjectOverR;

		public GameObject gameObjectClickL;

		public GameObject gameObjectClickR;

		protected Dictionary<int, VRPointerEventData> m_VRRayPointerDataLL = new Dictionary<int, VRPointerEventData>();

		protected Dictionary<int, VRPointerEventData> m_VRRayPointerDataRR = new Dictionary<int, VRPointerEventData>();

		private readonly MouseState m_MouseStateL = new MouseState();

		private readonly MouseState m_MouseStateR = new MouseState();

		public bool allowActivationOnMobileDevice
		{
			get
			{
				return m_AllowActivationOnMobileDevice;
			}
			set
			{
				m_AllowActivationOnMobileDevice = value;
			}
		}

		public override void UpdateModule()
		{
			m_LastMousePosition = m_MousePosition;
			m_MousePosition = Input.mousePosition;
		}

		public override bool IsModuleSupported()
		{
			if (!m_AllowActivationOnMobileDevice)
			{
				return Input.mousePresent;
			}
			return true;
		}

		public override bool ShouldActivateModule()
		{
			if (!base.ShouldActivateModule())
			{
				return false;
			}
			return Input.GetButtonDown(m_SubmitButton) | Input.GetButtonDown(m_CancelButton) | !Mathf.Approximately(Input.GetAxisRaw(m_HorizontalAxis), 0f) | !Mathf.Approximately(Input.GetAxisRaw(m_VerticalAxis), 0f) | ((m_MousePosition - m_LastMousePosition).sqrMagnitude > 0f) | Input.GetMouseButtonDown(0);
		}

		public override void ActivateModule()
		{
			base.ActivateModule();
			m_MousePosition = Input.mousePosition;
			m_LastMousePosition = Input.mousePosition;
			GameObject gameObject = base.eventSystem.currentSelectedGameObject;
			if (gameObject == null)
			{
				gameObject = base.eventSystem.firstSelectedGameObject;
			}
			base.eventSystem.SetSelectedGameObject(gameObject, GetBaseEventData());
		}

		public override void DeactivateModule()
		{
			base.DeactivateModule();
			ClearSelection();
		}

		private void ProcessMousePress(MouseButtonEventData data, bool isleft)
		{
			PointerEventData buttonData = data.buttonData;
			GameObject gameObject = buttonData.pointerCurrentRaycast.gameObject;
			if (data.PressedThisFrame())
			{
				buttonData.eligibleForClick = true;
				buttonData.delta = Vector2.zero;
				buttonData.dragging = false;
				buttonData.useDragThreshold = true;
				buttonData.pressPosition = buttonData.position;
				if (buttonData.isVRPointer())
				{
					buttonData.SetSwipeStartData(Input.mousePosition);
				}
				buttonData.pointerPressRaycast = buttonData.pointerCurrentRaycast;
				DeselectIfSelectionChanged(gameObject, buttonData);
				GameObject gameObject2 = ExecuteEvents.ExecuteHierarchy(gameObject, buttonData, ExecuteEvents.pointerDownHandler);
				if (gameObject2 == null)
				{
					gameObject2 = ExecuteEvents.GetEventHandler<IPointerClickHandler>(gameObject);
				}
				if (isleft)
				{
					gameObjectClickL = gameObject;
				}
				else
				{
					gameObjectClickR = gameObject;
				}
				float unscaledTime = Time.unscaledTime;
				if (gameObject2 == buttonData.lastPress)
				{
					if (unscaledTime - buttonData.clickTime < 0.3f)
					{
						int clickCount = buttonData.clickCount + 1;
						buttonData.clickCount = clickCount;
					}
					else
					{
						buttonData.clickCount = 1;
					}
					buttonData.clickTime = unscaledTime;
				}
				else
				{
					buttonData.clickCount = 1;
				}
				buttonData.pointerPress = gameObject2;
				buttonData.rawPointerPress = gameObject;
				buttonData.clickTime = unscaledTime;
				buttonData.pointerDrag = ExecuteEvents.GetEventHandler<IDragHandler>(gameObject);
				if (buttonData.pointerDrag != null)
				{
					ExecuteEvents.Execute(buttonData.pointerDrag, buttonData, ExecuteEvents.initializePotentialDrag);
				}
			}
			if (data.ReleasedThisFrame())
			{
				ExecuteEvents.Execute(buttonData.pointerPress, buttonData, ExecuteEvents.pointerUpHandler);
				GameObject eventHandler = ExecuteEvents.GetEventHandler<IPointerClickHandler>(gameObject);
				if (buttonData.pointerPress == eventHandler && buttonData.eligibleForClick)
				{
					ExecuteEvents.Execute(buttonData.pointerPress, buttonData, ExecuteEvents.pointerClickHandler);
				}
				else if (buttonData.pointerDrag != null)
				{
					ExecuteEvents.ExecuteHierarchy(gameObject, buttonData, ExecuteEvents.dropHandler);
				}
				buttonData.eligibleForClick = false;
				buttonData.pointerPress = null;
				buttonData.rawPointerPress = null;
				if (buttonData.pointerDrag != null && buttonData.dragging)
				{
					ExecuteEvents.Execute(buttonData.pointerDrag, buttonData, ExecuteEvents.endDragHandler);
				}
				buttonData.dragging = false;
				buttonData.pointerDrag = null;
				if (gameObject != buttonData.pointerEnter)
				{
					HandlePointerExitAndEnter(buttonData, null);
					HandlePointerExitAndEnter(buttonData, gameObject);
				}
				if (isleft)
				{
					gameObjectClickL = null;
				}
				else
				{
					gameObjectClickR = null;
				}
			}
		}

		private void ProcessMouseEvent(MouseState mouseData, bool isleft)
		{
			bool pressed = mouseData.AnyPressesThisFrame();
			bool released = mouseData.AnyReleasesThisFrame();
			MouseButtonEventData eventData = mouseData.GetButtonState(PointerEventData.InputButton.Left).eventData;
			if (UseMouse(pressed, released, eventData.buttonData))
			{
				ProcessMousePress(eventData, isleft);
				ProcessMove(eventData.buttonData);
				ProcessDrag(eventData.buttonData);
				ProcessMousePress(mouseData.GetButtonState(PointerEventData.InputButton.Right).eventData, isleft);
				ProcessDrag(mouseData.GetButtonState(PointerEventData.InputButton.Right).eventData.buttonData);
				ProcessMousePress(mouseData.GetButtonState(PointerEventData.InputButton.Middle).eventData, isleft);
				ProcessDrag(mouseData.GetButtonState(PointerEventData.InputButton.Middle).eventData.buttonData);
				if (!Mathf.Approximately(eventData.buttonData.scrollDelta.sqrMagnitude, 0f))
				{
					ExecuteEvents.ExecuteHierarchy(ExecuteEvents.GetEventHandler<IScrollHandler>(eventData.buttonData.pointerCurrentRaycast.gameObject), eventData.buttonData, ExecuteEvents.scrollHandler);
				}
			}
		}

		public override void Process()
		{
			if (useRaycaster && vRPointerL != null && vRPointerL.rayStartTransform != null)
			{
				if (Singleton<DataManager>.Instance.userData.bothHand)
				{
					ProcessMouseEvent(GetPointerDataL(), isleft: true);
				}
				else if (!Singleton<DataManager>.Instance.userData.rightHand)
				{
					ProcessMouseEvent(GetPointerDataL(), isleft: true);
				}
			}
			if (useRaycaster && vRPointerR != null && vRPointerR.rayStartTransform != null)
			{
				if (Singleton<DataManager>.Instance.userData.bothHand)
				{
					ProcessMouseEvent(GetPointerDataR(), isleft: false);
				}
				else if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					ProcessMouseEvent(GetPointerDataR(), isleft: false);
				}
			}
		}

		private static bool UseMouse(bool pressed, bool released, PointerEventData pointerData)
		{
			if (pressed || released || IsPointerMoving(pointerData) || pointerData.IsScrolling())
			{
				return true;
			}
			return false;
		}

		protected void CopyFromTo(VRPointerEventData from, VRPointerEventData to)
		{
			to.position = from.position;
			to.delta = from.delta;
			to.scrollDelta = from.scrollDelta;
			to.pointerCurrentRaycast = from.pointerCurrentRaycast;
			to.pointerEnter = from.pointerEnter;
			to.worldSpaceRay = from.worldSpaceRay;
		}

		protected new void CopyFromTo(PointerEventData from, PointerEventData to)
		{
			to.position = from.position;
			to.delta = from.delta;
			to.scrollDelta = from.scrollDelta;
			to.pointerCurrentRaycast = from.pointerCurrentRaycast;
			to.pointerEnter = from.pointerEnter;
		}

		protected bool GetPointerDataLL(int id, out VRPointerEventData data, bool create)
		{
			if (!m_VRRayPointerDataLL.TryGetValue(id, out data) && create)
			{
				data = new VRPointerEventData(base.eventSystem)
				{
					pointerId = id
				};
				m_VRRayPointerDataLL.Add(id, data);
				return true;
			}
			return false;
		}

		protected bool GetPointerDataRR(int id, out VRPointerEventData data, bool create)
		{
			if (!m_VRRayPointerDataRR.TryGetValue(id, out data) && create)
			{
				data = new VRPointerEventData(base.eventSystem)
				{
					pointerId = id
				};
				m_VRRayPointerDataRR.Add(id, data);
				return true;
			}
			return false;
		}

		protected new void ClearSelection()
		{
			BaseEventData baseEventData = GetBaseEventData();
			foreach (PointerEventData value in m_PointerData.Values)
			{
				HandlePointerExitAndEnter(value, null);
			}
			foreach (VRPointerEventData value2 in m_VRRayPointerDataLL.Values)
			{
				HandlePointerExitAndEnter(value2, null);
			}
			foreach (VRPointerEventData value3 in m_VRRayPointerDataRR.Values)
			{
				HandlePointerExitAndEnter(value3, null);
			}
			m_PointerData.Clear();
			base.eventSystem.SetSelectedGameObject(null, baseEventData);
		}

		private static Vector3 GetRectTransformNormal(RectTransform rectTransform)
		{
			Vector3[] array = new Vector3[4];
			rectTransform.GetWorldCorners(array);
			Vector3 lhs = array[3] - array[0];
			Vector3 rhs = array[1] - array[0];
			rectTransform.GetWorldCorners(array);
			return Vector3.Cross(lhs, rhs).normalized;
		}

		protected virtual MouseState GetPointerDataL()
		{
			raycasterStatusL = RaycasterStatus.None;
			GetPointerDataLL(-1, out var data, create: true);
			data.Reset();
			data.worldSpaceRay = new Ray(vRPointerL.rayStartTransform.position, vRPointerL.rayStartTransform.forward);
			data.scrollDelta = GetExtraScrollDeltaL();
			data.button = PointerEventData.InputButton.Left;
			data.useDragThreshold = true;
			base.eventSystem.RaycastAll(data, m_RaycastResultCache);
			RaycastResult raycastResult2 = (data.pointerCurrentRaycast = BaseInputModule.FindFirstRaycast(m_RaycastResultCache));
			m_RaycastResultCache.Clear();
			if (vRPointerL != null)
			{
				vRPointerL.SetCursorRay(vRPointerL.rayStartTransform);
			}
			VRUIRaycaster vRUIRaycaster = raycastResult2.module as VRUIRaycaster;
			if ((bool)vRUIRaycaster)
			{
				raycasterStatusL = RaycasterStatus.UI;
				data.position = vRUIRaycaster.GetScreenPosition(raycastResult2);
				RectTransform component = raycastResult2.gameObject.GetComponent<RectTransform>();
				gameObjectOverL = raycastResult2.gameObject;
				if (component != null)
				{
					Vector3 worldPosition = raycastResult2.worldPosition;
					Vector3 rectTransformNormal = GetRectTransformNormal(component);
					if (vRPointerL != null)
					{
						vRPointerL.SetCursorStartDest(vRPointerL.rayStartTransform.position, worldPosition, rectTransformNormal);
					}
				}
			}
			else if (gameObjectOverL != null)
			{
				gameObjectOverL = null;
			}
			VRPhysicsRaycaster vRPhysicsRaycaster = raycastResult2.module as VRPhysicsRaycaster;
			if ((bool)vRPhysicsRaycaster)
			{
				raycasterStatusL = RaycasterStatus.Physics;
				Vector3 worldPosition2 = raycastResult2.worldPosition;
				if (useSphereCastForPointer)
				{
					List<RaycastResult> list = new List<RaycastResult>();
					vRPhysicsRaycaster.Spherecast(data, list, m_SpherecastRadius);
					if (list.Count > 0 && list[0].distance < raycastResult2.distance)
					{
						worldPosition2 = list[0].worldPosition;
					}
				}
				data.position = vRPhysicsRaycaster.GetScreenPos(raycastResult2.worldPosition);
				if (vRPointerL != null)
				{
					vRPointerL.SetCursorStartDest(vRPointerL.rayStartTransform.position, worldPosition2, raycastResult2.worldNormal, vRPhysicsRaycaster.result);
				}
			}
			GetPointerDataLL(-2, out var data2, create: true);
			CopyFromTo(data, data2);
			data2.button = PointerEventData.InputButton.Right;
			GetPointerDataLL(-3, out var data3, create: true);
			CopyFromTo(data, data3);
			data3.button = PointerEventData.InputButton.Middle;
			m_MouseStateL.SetButtonState(PointerEventData.InputButton.Left, GetPointerButtonStateL(), data);
			m_MouseStateL.SetButtonState(PointerEventData.InputButton.Right, PointerEventData.FramePressState.NotChanged, data2);
			m_MouseStateL.SetButtonState(PointerEventData.InputButton.Middle, PointerEventData.FramePressState.NotChanged, data3);
			return m_MouseStateL;
		}

		protected virtual MouseState GetPointerDataR()
		{
			raycasterStatusR = RaycasterStatus.None;
			GetPointerDataRR(-1, out var data, create: true);
			data.Reset();
			data.worldSpaceRay = new Ray(vRPointerR.rayStartTransform.position, vRPointerR.rayStartTransform.forward);
			data.scrollDelta = GetExtraScrollDeltaR();
			data.button = PointerEventData.InputButton.Left;
			data.useDragThreshold = true;
			base.eventSystem.RaycastAll(data, m_RaycastResultCache);
			RaycastResult raycastResult2 = (data.pointerCurrentRaycast = BaseInputModule.FindFirstRaycast(m_RaycastResultCache));
			m_RaycastResultCache.Clear();
			if (vRPointerR != null)
			{
				vRPointerR.SetCursorRay(vRPointerR.rayStartTransform);
			}
			VRUIRaycaster vRUIRaycaster = raycastResult2.module as VRUIRaycaster;
			if ((bool)vRUIRaycaster)
			{
				raycasterStatusR = RaycasterStatus.UI;
				data.position = vRUIRaycaster.GetScreenPosition(raycastResult2);
				RectTransform component = raycastResult2.gameObject.GetComponent<RectTransform>();
				gameObjectOverR = raycastResult2.gameObject;
				if (component != null)
				{
					Vector3 worldPosition = raycastResult2.worldPosition;
					Vector3 rectTransformNormal = GetRectTransformNormal(component);
					if (vRPointerR != null)
					{
						vRPointerR.SetCursorStartDest(vRPointerR.rayStartTransform.position, worldPosition, rectTransformNormal);
					}
				}
			}
			else if (gameObjectOverR != null)
			{
				gameObjectOverR = null;
			}
			VRPhysicsRaycaster vRPhysicsRaycaster = raycastResult2.module as VRPhysicsRaycaster;
			if ((bool)vRPhysicsRaycaster)
			{
				raycasterStatusR = RaycasterStatus.Physics;
				Vector3 worldPosition2 = raycastResult2.worldPosition;
				if (useSphereCastForPointer)
				{
					List<RaycastResult> list = new List<RaycastResult>();
					vRPhysicsRaycaster.Spherecast(data, list, m_SpherecastRadius);
					if (list.Count > 0 && list[0].distance < raycastResult2.distance)
					{
						worldPosition2 = list[0].worldPosition;
					}
				}
				data.position = vRPhysicsRaycaster.GetScreenPos(raycastResult2.worldPosition);
				if (vRPointerR != null)
				{
					vRPointerR.SetCursorStartDest(vRPointerR.rayStartTransform.position, worldPosition2, raycastResult2.worldNormal, vRPhysicsRaycaster.result);
				}
			}
			GetPointerDataRR(-2, out var data2, create: true);
			CopyFromTo(data, data2);
			data2.button = PointerEventData.InputButton.Right;
			GetPointerDataRR(-3, out var data3, create: true);
			CopyFromTo(data, data3);
			data3.button = PointerEventData.InputButton.Middle;
			m_MouseStateR.SetButtonState(PointerEventData.InputButton.Left, GetPointerButtonStateR(), data);
			m_MouseStateR.SetButtonState(PointerEventData.InputButton.Right, PointerEventData.FramePressState.NotChanged, data2);
			m_MouseStateR.SetButtonState(PointerEventData.InputButton.Middle, PointerEventData.FramePressState.NotChanged, data3);
			return m_MouseStateR;
		}

		private bool ShouldStartDrag(PointerEventData pointerEvent)
		{
			if (!pointerEvent.useDragThreshold)
			{
				return true;
			}
			if (!pointerEvent.isVRPointer())
			{
				return (pointerEvent.pressPosition - pointerEvent.position).sqrMagnitude >= (float)(base.eventSystem.pixelDragThreshold * base.eventSystem.pixelDragThreshold);
			}
			Vector3 position = pointerEvent.pressEventCamera.transform.position;
			Vector3 normalized = (pointerEvent.pointerPressRaycast.worldPosition - position).normalized;
			Vector3 normalized2 = (pointerEvent.pointerCurrentRaycast.worldPosition - position).normalized;
			return Vector3.Dot(normalized, normalized2) < Mathf.Cos((float)Math.PI / 180f * angleDragThreshold);
		}

		private static bool IsPointerMoving(PointerEventData pointerEvent)
		{
			if (pointerEvent.isVRPointer())
			{
				return true;
			}
			return pointerEvent.IsPointerMoving();
		}

		protected override void ProcessDrag(PointerEventData pointerEvent)
		{
			Vector2 position = pointerEvent.position;
			bool flag = IsPointerMoving(pointerEvent);
			if (flag && pointerEvent.pointerDrag != null && !pointerEvent.dragging && ShouldStartDrag(pointerEvent))
			{
				if (pointerEvent.isVRPointer())
				{
					pointerEvent.position = position;
				}
				ExecuteEvents.Execute(pointerEvent.pointerDrag, pointerEvent, ExecuteEvents.beginDragHandler);
				pointerEvent.dragging = true;
			}
			if (pointerEvent.dragging && flag && pointerEvent.pointerDrag != null)
			{
				if (pointerEvent.isVRPointer())
				{
					pointerEvent.position = position;
				}
				if (pointerEvent.pointerPress != pointerEvent.pointerDrag)
				{
					ExecuteEvents.Execute(pointerEvent.pointerPress, pointerEvent, ExecuteEvents.pointerUpHandler);
					pointerEvent.eligibleForClick = false;
					pointerEvent.pointerPress = null;
					pointerEvent.rawPointerPress = null;
				}
				ExecuteEvents.Execute(pointerEvent.pointerDrag, pointerEvent, ExecuteEvents.dragHandler);
			}
		}

		protected virtual PointerEventData.FramePressState GetPointerButtonStateL()
		{
			bool flag = false;
			bool flag2 = false;
			if (Singleton<DataManager>.Instance.userData.bothHand)
			{
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					flag = VRInput.bInputTriggerDown(VRInput.eController.subhand);
					flag2 = VRInput.bInputTriggerUp(VRInput.eController.subhand);
				}
				else
				{
					flag = VRInput.bInputTriggerDown(VRInput.eController.mainhand);
					flag2 = VRInput.bInputTriggerUp(VRInput.eController.mainhand);
				}
			}
			else
			{
				flag = VRInput.bInputTriggerDown(VRInput.eController.mainhand);
				flag2 = VRInput.bInputTriggerUp(VRInput.eController.mainhand);
			}
			if (flag && flag2)
			{
				return PointerEventData.FramePressState.PressedAndReleased;
			}
			if (flag)
			{
				return PointerEventData.FramePressState.Pressed;
			}
			if (flag2)
			{
				return PointerEventData.FramePressState.Released;
			}
			return PointerEventData.FramePressState.NotChanged;
		}

		protected virtual PointerEventData.FramePressState GetPointerButtonStateR()
		{
			bool flag = false;
			bool flag2 = false;
			if (Singleton<DataManager>.Instance.userData.bothHand)
			{
				if (Singleton<DataManager>.Instance.userData.rightHand)
				{
					flag = VRInput.bInputTriggerDown(VRInput.eController.mainhand);
					flag2 = VRInput.bInputTriggerUp(VRInput.eController.mainhand);
				}
				else
				{
					flag = VRInput.bInputTriggerDown(VRInput.eController.subhand);
					flag2 = VRInput.bInputTriggerUp(VRInput.eController.subhand);
				}
			}
			else
			{
				flag = VRInput.bInputTriggerDown(VRInput.eController.mainhand);
				flag2 = VRInput.bInputTriggerUp(VRInput.eController.mainhand);
			}
			if (flag && flag2)
			{
				return PointerEventData.FramePressState.PressedAndReleased;
			}
			if (flag)
			{
				return PointerEventData.FramePressState.Pressed;
			}
			if (flag2)
			{
				return PointerEventData.FramePressState.Released;
			}
			return PointerEventData.FramePressState.NotChanged;
		}

		protected Vector2 GetExtraScrollDeltaL()
		{
			Vector2 result = default(Vector2);
			if (useRightStickScroll)
			{
				Vector2 zero = Vector2.zero;
				zero = ((!Singleton<DataManager>.Instance.userData.rightHand) ? VRInput.GetThumbstickData(VRInput.eController.mainhand) : VRInput.GetThumbstickData(VRInput.eController.subhand));
				if (Mathf.Abs(zero.x) < rightStickDeadZone)
				{
					zero.x = 0f;
				}
				if (Mathf.Abs(zero.y) < rightStickDeadZone)
				{
					zero.y = 0f;
				}
				return zero;
			}
			return result;
		}

		protected Vector2 GetExtraScrollDeltaR()
		{
			Vector2 result = default(Vector2);
			if (useRightStickScroll)
			{
				Vector2 zero = Vector2.zero;
				zero = ((!Singleton<DataManager>.Instance.userData.rightHand) ? VRInput.GetThumbstickData(VRInput.eController.subhand) : VRInput.GetThumbstickData(VRInput.eController.mainhand));
				if (Mathf.Abs(zero.x) < rightStickDeadZone)
				{
					zero.x = 0f;
				}
				if (Mathf.Abs(zero.y) < rightStickDeadZone)
				{
					zero.y = 0f;
				}
				return zero;
			}
			return result;
		}
	}
	public class VRPhysicsRaycaster : BaseRaycaster
	{
		protected const int kNoEventMaskSet = -1;

		[SerializeField]
		protected LayerMask showLayer = -1;

		public Camera leftEyeCamera;

		public RaycastHit result;

		public float distance = 4f;

		private DataManager dataManager;

		public int sortOrder = 20;

		public override Camera eventCamera
		{
			get
			{
				if (dataManager.targetPlatform != DEVICE_TYPE.OTHERS)
				{
					return GetComponent<OVRCameraRig>().leftEyeCamera;
				}
				return leftEyeCamera;
			}
		}

		public override int sortOrderPriority => sortOrder;

		public int finalEventMask => showLayer;

		protected override void Awake()
		{
			dataManager = Singleton<DataManager>.Instance;
		}

		public override void Raycast(PointerEventData eventData, List<RaycastResult> resultAppendList)
		{
			if (!(eventCamera == null) && eventData.isVRPointer())
			{
				Ray rayData = eventData.GetRayData();
				float maxDistance = distance;
				if (Physics.Raycast(rayData, out var hitInfo, maxDistance, finalEventMask))
				{
					RaycastResult raycastResult = default(RaycastResult);
					raycastResult.gameObject = hitInfo.collider.gameObject;
					raycastResult.module = this;
					raycastResult.distance = hitInfo.distance;
					raycastResult.index = resultAppendList.Count;
					raycastResult.worldPosition = hitInfo.point;
					raycastResult.worldNormal = hitInfo.normal;
					RaycastResult item = raycastResult;
					resultAppendList.Add(item);
					result = hitInfo;
				}
			}
		}

		public void Spherecast(PointerEventData eventData, List<RaycastResult> resultAppendList, float radius)
		{
			if (eventCamera == null || !eventData.isVRPointer())
			{
				return;
			}
			Ray rayData = eventData.GetRayData();
			float maxDistance = eventCamera.farClipPlane - eventCamera.nearClipPlane;
			RaycastHit[] array = Physics.SphereCastAll(rayData, radius, maxDistance, finalEventMask);
			if (array.Length > 1)
			{
				Array.Sort(array, (RaycastHit r1, RaycastHit r2) => r1.distance.CompareTo(r2.distance));
			}
			if (array.Length != 0)
			{
				int i = 0;
				for (int num = array.Length; i < num; i++)
				{
					RaycastResult raycastResult = default(RaycastResult);
					raycastResult.gameObject = array[i].collider.gameObject;
					raycastResult.module = this;
					raycastResult.distance = array[i].distance;
					raycastResult.index = resultAppendList.Count;
					raycastResult.worldPosition = array[0].point;
					raycastResult.worldNormal = array[0].normal;
					RaycastResult item = raycastResult;
					resultAppendList.Add(item);
				}
			}
		}

		public Vector2 GetScreenPos(Vector3 worldPosition)
		{
			return eventCamera.WorldToScreenPoint(worldPosition);
		}
	}
	public class VRPointerEventData : PointerEventData
	{
		public Ray worldSpaceRay;

		public Vector2 swipeStart;

		public VRPointerEventData(EventSystem eventSystem)
			: base(eventSystem)
		{
		}

		public override string ToString()
		{
			StringBuilder stringBuilder = new StringBuilder();
			stringBuilder.AppendLine("<b>Position</b>: " + base.position);
			stringBuilder.AppendLine("<b>delta</b>: " + base.delta);
			stringBuilder.AppendLine("<b>eligibleForClick</b>: " + base.eligibleForClick);
			stringBuilder.AppendLine("<b>pointerEnter</b>: " + base.pointerEnter);
			stringBuilder.AppendLine("<b>pointerPress</b>: " + base.pointerPress);
			stringBuilder.AppendLine("<b>lastPointerPress</b>: " + base.lastPress);
			stringBuilder.AppendLine("<b>pointerDrag</b>: " + base.pointerDrag);
			stringBuilder.AppendLine("<b>worldSpaceRay</b>: " + worldSpaceRay);
			stringBuilder.AppendLine("<b>swipeStart</b>: " + swipeStart);
			stringBuilder.AppendLine("<b>Use Drag Threshold</b>: " + base.useDragThreshold);
			return stringBuilder.ToString();
		}
	}
	public static class PointerEventData2Extension
	{
		public static bool isVRPointer(this PointerEventData pointerEventData)
		{
			return pointerEventData is VRPointerEventData;
		}

		public static Ray GetRayData(this PointerEventData pointerEventData)
		{
			return (pointerEventData as VRPointerEventData).worldSpaceRay;
		}

		public static void SetSwipeStartData(this PointerEventData pointerEventData, Vector2 start)
		{
			(pointerEventData as VRPointerEventData).swipeStart = start;
		}
	}
}
namespace UnityEngine.UI
{
	public class CustomOutline : Shadow
	{
		[Range(0f, 15f)]
		public float m_size = 3f;

		public bool glintEffect;

		[Range(0f, 5f)]
		public int glintVertex;

		[Range(0f, 3f)]
		public int glintWidth;

		public Color glintColor;

		public override void ModifyMesh(VertexHelper vh)
		{
			if (!IsActive())
			{
				return;
			}
			List<UIVertex> list = new List<UIVertex>();
			vh.GetUIVertexStream(list);
			int num = list.Count * 5;
			if (list.Capacity < num)
			{
				list.Capacity = num;
			}
			if (glintEffect)
			{
				for (int i = 0; i < list.Count; i++)
				{
					UIVertex value = list[i];
					for (int j = -glintWidth; j <= glintWidth; j++)
					{
						if ((float)(i % 6) == Mathf.Repeat(glintVertex + j, 6f))
						{
							value.color = glintColor;
						}
					}
					list[i] = value;
				}
			}
			Vector2 vector = new Vector2(m_size, m_size);
			int start = 0;
			int count = list.Count;
			ApplyShadowZeroAlloc(list, base.effectColor, start, list.Count, vector.x, vector.y);
			start = count;
			int count2 = list.Count;
			ApplyShadowZeroAlloc(list, base.effectColor, start, list.Count, vector.x, 0f - vector.y);
			start = count2;
			int count3 = list.Count;
			ApplyShadowZeroAlloc(list, base.effectColor, start, list.Count, 0f - vector.x, vector.y);
			start = count3;
			int count4 = list.Count;
			ApplyShadowZeroAlloc(list, base.effectColor, start, list.Count, 0f - vector.x, 0f - vector.y);
			start = count4;
			int count5 = list.Count;
			ApplyShadowZeroAlloc(list, base.effectColor, start, list.Count, 0f, vector.y * 1.5f);
			start = count5;
			int count6 = list.Count;
			ApplyShadowZeroAlloc(list, base.effectColor, start, list.Count, vector.x * 1.5f, 0f);
			start = count6;
			int count7 = list.Count;
			ApplyShadowZeroAlloc(list, base.effectColor, start, list.Count, (0f - vector.x) * 1.5f, 0f);
			start = count7;
			_ = list.Count;
			ApplyShadowZeroAlloc(list, base.effectColor, start, list.Count, 0f, (0f - vector.y) * 1.5f);
			vh.Clear();
			vh.AddUIVertexTriangleStream(list);
		}
	}
}
namespace Photon.Realtime.Demo
{
	public class ConnectAndJoinRandomLb : MonoBehaviour, IConnectionCallbacks, IMatchmakingCallbacks, ILobbyCallbacks
	{
		[SerializeField]
		private AppSettings appSettings = new AppSettings();

		private LoadBalancingClient lbc;

		private ConnectionHandler ch;

		public Text StateUiText;

		public void Start()
		{
			lbc = new LoadBalancingClient();
			lbc.AddCallbackTarget(this);
			lbc.SerializationProtocol = SerializationProtocol.GpBinaryV16;
			if (!lbc.ConnectUsingSettings(appSettings))
			{
				UnityEngine.Debug.LogError("Error while connecting");
			}
			ch = base.gameObject.GetComponent<ConnectionHandler>();
			if (ch != null)
			{
				ch.Client = lbc;
				ch.StartFallbackSendAckThread();
			}
		}

		public void Update()
		{
			LoadBalancingClient loadBalancingClient = lbc;
			if (loadBalancingClient != null)
			{
				loadBalancingClient.Service();
				Text stateUiText = StateUiText;
				string text = loadBalancingClient.State.ToString();
				if (stateUiText != null && !stateUiText.text.Equals(text))
				{
					stateUiText.text = "State: " + text;
				}
			}
		}

		public void OnConnected()
		{
		}

		public void OnConnectedToMaster()
		{
			UnityEngine.Debug.Log("OnConnectedToMaster");
			lbc.OpJoinRandomRoom();
		}

		public void OnDisconnected(DisconnectCause cause)
		{
			UnityEngine.Debug.Log(string.Concat("OnDisconnected(", cause, ")"));
		}

		public void OnCustomAuthenticationResponse(Dictionary<string, object> data)
		{
		}

		public void OnCustomAuthenticationFailed(string debugMessage)
		{
		}

		public void OnRegionListReceived(RegionHandler regionHandler)
		{
			UnityEngine.Debug.Log("OnRegionListReceived");
			regionHandler.PingMinimumOfRegions(OnRegionPingCompleted, null);
		}

		public void OnRoomListUpdate(List<RoomInfo> roomList)
		{
		}

		public void OnLobbyStatisticsUpdate(List<TypedLobbyInfo> lobbyStatistics)
		{
		}

		public void OnJoinedLobby()
		{
		}

		public void OnLeftLobby()
		{
		}

		public void OnFriendListUpdate(List<FriendInfo> friendList)
		{
		}

		public void OnCreatedRoom()
		{
		}

		public void OnCreateRoomFailed(short returnCode, string message)
		{
		}

		public void OnJoinedRoom()
		{
			UnityEngine.Debug.Log("OnJoinedRoom");
		}

		public void OnJoinRoomFailed(short returnCode, string message)
		{
		}

		public void OnJoinRandomFailed(short returnCode, string message)
		{
			UnityEngine.Debug.Log("OnJoinRandomFailed");
			lbc.OpCreateRoom(new EnterRoomParams());
		}

		public void OnLeftRoom()
		{
		}

		private void OnRegionPingCompleted(RegionHandler regionHandler)
		{
			UnityEngine.Debug.Log("OnRegionPingCompleted " + regionHandler.BestRegion);
			UnityEngine.Debug.Log("RegionPingSummary: " + regionHandler.SummaryToCache);
			lbc.ConnectToRegionMaster(regionHandler.BestRegion.Code);
		}
	}
}
namespace Photon.Chat.UtilityScripts
{
	public class EventSystemSpawner : MonoBehaviour
	{
		private void Start()
		{
			if (UnityEngine.Object.FindObjectOfType<EventSystem>() == null)
			{
				GameObject obj = new GameObject("EventSystem");
				obj.AddComponent<EventSystem>();
				obj.AddComponent<StandaloneInputModule>();
			}
		}
	}
	public class OnStartDelete : MonoBehaviour
	{
		private void Start()
		{
			UnityEngine.Object.Destroy(base.gameObject);
		}
	}
	[RequireComponent(typeof(Text))]
	public class TextButtonTransition : MonoBehaviour, IPointerEnterHandler, IEventSystemHandler, IPointerExitHandler
	{
		private Text _text;

		public Selectable Selectable;

		public Color NormalColor = Color.white;

		public Color HoverColor = Color.black;

		public void Awake()
		{
			_text = GetComponent<Text>();
		}

		public void OnEnable()
		{
			_text.color = NormalColor;
		}

		public void OnDisable()
		{
			_text.color = NormalColor;
		}

		public void OnPointerEnter(PointerEventData eventData)
		{
			if (Selectable == null || Selectable.IsInteractable())
			{
				_text.color = HoverColor;
			}
		}

		public void OnPointerExit(PointerEventData eventData)
		{
			if (Selectable == null || Selectable.IsInteractable())
			{
				_text.color = NormalColor;
			}
		}
	}
	[RequireComponent(typeof(Text))]
	public class TextToggleIsOnTransition : MonoBehaviour, IPointerEnterHandler, IEventSystemHandler, IPointerExitHandler
	{
		public Toggle toggle;

		private Text _text;

		public Color NormalOnColor = Color.white;

		public Color NormalOffColor = Color.black;

		public Color HoverOnColor = Color.black;

		public Color HoverOffColor = Color.black;

		private bool isHover;

		public void OnEnable()
		{
			_text = GetComponent<Text>();
			OnValueChanged(toggle.isOn);
			toggle.onValueChanged.AddListener(OnValueChanged);
		}

		public void OnDisable()
		{
			toggle.onValueChanged.RemoveListener(OnValueChanged);
		}

		public void OnValueChanged(bool isOn)
		{
			_text.color = ((!isOn) ? (isHover ? NormalOffColor : NormalOffColor) : (isHover ? HoverOnColor : HoverOnColor));
		}

		public void OnPointerEnter(PointerEventData eventData)
		{
			isHover = true;
			_text.color = (toggle.isOn ? HoverOnColor : HoverOffColor);
		}

		public void OnPointerExit(PointerEventData eventData)
		{
			isHover = false;
			_text.color = (toggle.isOn ? NormalOnColor : NormalOffColor);
		}
	}
}
namespace OculusSampleFramework
{
	public class ColorGrabbable : OVRGrabbable
	{
		public static readonly Color COLOR_GRAB = new Color(1f, 0.5f, 0f, 1f);

		public static readonly Color COLOR_HIGHLIGHT = new Color(1f, 0f, 1f, 1f);

		private Color m_color = Color.black;

		private MeshRenderer[] m_meshRenderers;

		private bool m_highlight;

		public bool Highlight
		{
			get
			{
				return m_highlight;
			}
			set
			{
				m_highlight = value;
				UpdateColor();
			}
		}

		protected void UpdateColor()
		{
			if (base.isGrabbed)
			{
				SetColor(COLOR_GRAB);
			}
			else if (Highlight)
			{
				SetColor(COLOR_HIGHLIGHT);
			}
			else
			{
				SetColor(m_color);
			}
		}

		public override void GrabBegin(OVRGrabber hand, Collider grabPoint)
		{
			base.GrabBegin(hand, grabPoint);
			UpdateColor();
		}

		public override void GrabEnd(Vector3 linearVelocity, Vector3 angularVelocity)
		{
			base.GrabEnd(linearVelocity, angularVelocity);
			UpdateColor();
		}

		private void Awake()
		{
			if (m_grabPoints.Length == 0)
			{
				Collider component = GetComponent<Collider>();
				if (component == null)
				{
					throw new ArgumentException("Grabbables cannot have zero grab points and no collider -- please add a grab point or collider.");
				}
				m_grabPoints = new Collider[1] { component };
				m_meshRenderers = new MeshRenderer[1];
				m_meshRenderers[0] = GetComponent<MeshRenderer>();
			}
			else
			{
				m_meshRenderers = GetComponentsInChildren<MeshRenderer>();
			}
			m_color = new Color(UnityEngine.Random.Range(0.1f, 0.95f), UnityEngine.Random.Range(0.1f, 0.95f), UnityEngine.Random.Range(0.1f, 0.95f), 1f);
			SetColor(m_color);
		}

		private void SetColor(Color color)
		{
			for (int i = 0; i < m_meshRenderers.Length; i++)
			{
				MeshRenderer meshRenderer = m_meshRenderers[i];
				for (int j = 0; j < meshRenderer.materials.Length; j++)
				{
					meshRenderer.materials[j].color = color;
				}
			}
		}
	}
	public class DistanceGrabbable : OVRGrabbable
	{
		public string m_materialColorField;

		private GrabbableCrosshair m_crosshair;

		private GrabManager m_crosshairManager;

		private Renderer m_renderer;

		private MaterialPropertyBlock m_mpb;

		private bool m_inRange;

		private bool m_targeted;

		public bool InRange
		{
			get
			{
				return m_inRange;
			}
			set
			{
				m_inRange = value;
				RefreshCrosshair();
			}
		}

		public bool Targeted
		{
			get
			{
				return m_targeted;
			}
			set
			{
				m_targeted = value;
				RefreshCrosshair();
			}
		}

		protected override void Start()
		{
			base.Start();
			m_crosshair = base.gameObject.GetComponentInChildren<GrabbableCrosshair>();
			m_renderer = base.gameObject.GetComponent<Renderer>();
			m_crosshairManager = UnityEngine.Object.FindObjectOfType<GrabManager>();
			m_mpb = new MaterialPropertyBlock();
			RefreshCrosshair();
			m_mpb.SetColor(m_materialColorField, Color.white);
			m_renderer.SetPropertyBlock(m_mpb);
		}

		private void RefreshCrosshair()
		{
			if ((bool)m_crosshair)
			{
				if (base.isGrabbed)
				{
					m_crosshair.SetState(GrabbableCrosshair.CrosshairState.Disabled);
				}
				else if (!InRange)
				{
					m_crosshair.SetState(GrabbableCrosshair.CrosshairState.Disabled);
				}
				else
				{
					m_crosshair.SetState((!Targeted) ? GrabbableCrosshair.CrosshairState.Enabled : GrabbableCrosshair.CrosshairState.Targeted);
				}
			}
			if (m_materialColorField != null)
			{
				m_renderer.GetPropertyBlock(m_mpb);
				if (base.isGrabbed || !InRange)
				{
					m_mpb.SetColor(m_materialColorField, Color.white);
				}
				else if (Targeted)
				{
					m_mpb.SetColor(m_materialColorField, m_crosshairManager.OutlineColorHighlighted);
				}
				else
				{
					m_mpb.SetColor(m_materialColorField, m_crosshairManager.OutlineColorInRange);
				}
				m_renderer.SetPropertyBlock(m_mpb);
			}
		}

		public void SetColor(Color focusColor)
		{
			m_mpb.SetColor(m_materialColorField, focusColor);
			m_renderer.SetPropertyBlock(m_mpb);
		}

		public void ClearColor()
		{
			m_mpb.SetColor(m_materialColorField, Color.white);
			m_renderer.SetPropertyBlock(m_mpb);
		}
	}
	[RequireComponent(typeof(Rigidbody))]
	public class DistanceGrabber : OVRGrabber
	{
		[SerializeField]
		public Color m_focusColor;

		[SerializeField]
		private float m_spherecastRadius;

		[SerializeField]
		private float m_noSnapThreshhold = 0.05f;

		[SerializeField]
		private bool m_useSpherecast;

		[SerializeField]
		public bool m_preventGrabThroughWalls;

		[SerializeField]
		private float m_objectPullVelocity = 10f;

		private float m_objectPullMaxRotationRate = 360f;

		private bool m_movingObjectToHand;

		[SerializeField]
		private float m_maxGrabDistance;

		[SerializeField]
		private int m_grabObjectsInLayer;

		[SerializeField]
		private int m_obstructionLayer;

		private DistanceGrabber m_otherHand;

		protected DistanceGrabbable m_target;

		protected Collider m_targetCollider;

		public bool UseSpherecast
		{
			get
			{
				return m_useSpherecast;
			}
			set
			{
				m_useSpherecast = value;
				GrabVolumeEnable(!m_useSpherecast);
			}
		}

		protected override void Start()
		{
			base.Start();
			SphereCollider componentInChildren = m_player.GetComponentInChildren<SphereCollider>();
			m_maxGrabDistance = componentInChildren.radius + 3f;
			if (m_parentHeldObject)
			{
				UnityEngine.Debug.LogError("m_parentHeldObject incompatible with DistanceGrabber. Setting to false.");
				m_parentHeldObject = false;
			}
			DistanceGrabber[] array = UnityEngine.Object.FindObjectsOfType<DistanceGrabber>();
			for (int i = 0; i < array.Length; i++)
			{
				if (array[i] != this)
				{
					m_otherHand = array[i];
				}
			}
		}

		private void Update()
		{
			UnityEngine.Debug.DrawRay(base.transform.position, base.transform.forward, Color.red, 0.1f);
			FindTarget(out var dgOut, out var collOut);
			if (dgOut != m_target)
			{
				if (m_target != null)
				{
					m_target.Targeted = m_otherHand.m_target == m_target;
				}
				if (m_target != null)
				{
					m_target.ClearColor();
				}
				if (dgOut != null)
				{
					dgOut.SetColor(m_focusColor);
				}
				m_target = dgOut;
				m_targetCollider = collOut;
				if (m_target != null)
				{
					m_target.Targeted = true;
				}
			}
		}

		protected override void GrabBegin()
		{
			DistanceGrabbable target = m_target;
			Collider targetCollider = m_targetCollider;
			GrabVolumeEnable(enabled: false);
			if (!(target != null))
			{
				return;
			}
			if (target.isGrabbed)
			{
				((DistanceGrabber)target.grabbedBy).OffhandGrabbed(target);
			}
			m_grabbedObj = target;
			m_grabbedObj.GrabBegin(this, targetCollider);
			SetPlayerIgnoreCollision(m_grabbedObj.gameObject, ignore: true);
			m_movingObjectToHand = true;
			m_lastPos = base.transform.position;
			m_lastRot = base.transform.rotation;
			Vector3 vector = targetCollider.ClosestPointOnBounds(m_gripTransform.position);
			if (!m_grabbedObj.snapPosition && !m_grabbedObj.snapOrientation && m_noSnapThreshhold > 0f && (vector - m_gripTransform.position).magnitude < m_noSnapThreshhold)
			{
				Vector3 vector2 = m_grabbedObj.transform.position - base.transform.position;
				m_movingObjectToHand = false;
				vector2 = Quaternion.Inverse(base.transform.rotation) * vector2;
				m_grabbedObjectPosOff = vector2;
				Quaternion grabbedObjectRotOff = Quaternion.Inverse(base.transform.rotation) * m_grabbedObj.transform.rotation;
				m_grabbedObjectRotOff = grabbedObjectRotOff;
				return;
			}
			m_grabbedObjectPosOff = m_gripTransform.localPosition;
			if ((bool)m_grabbedObj.snapOffset)
			{
				Vector3 position = m_grabbedObj.snapOffset.position;
				if (m_controller == OVRInput.Controller.LTouch)
				{
					position.x = 0f - position.x;
				}
				m_grabbedObjectPosOff += position;
			}
			m_grabbedObjectRotOff = m_gripTransform.localRotation;
			if ((bool)m_grabbedObj.snapOffset)
			{
				m_grabbedObjectRotOff = m_grabbedObj.snapOffset.rotation * m_grabbedObjectRotOff;
			}
		}

		protected override void MoveGrabbedObject(Vector3 pos, Quaternion rot, bool forceTeleport = false)
		{
			if (m_grabbedObj == null)
			{
				return;
			}
			Rigidbody grabbedRigidbody = m_grabbedObj.grabbedRigidbody;
			Vector3 vector = pos + rot * m_grabbedObjectPosOff;
			Quaternion quaternion = rot * m_grabbedObjectRotOff;
			if (m_movingObjectToHand)
			{
				float num = m_objectPullVelocity * Time.deltaTime;
				Vector3 vector2 = vector - m_grabbedObj.transform.position;
				if (num * num * 1.1f > vector2.sqrMagnitude)
				{
					m_movingObjectToHand = false;
				}
				else
				{
					vector2.Normalize();
					vector = m_grabbedObj.transform.position + vector2 * num;
					quaternion = Quaternion.RotateTowards(m_grabbedObj.transform.rotation, quaternion, m_objectPullMaxRotationRate * Time.deltaTime);
				}
			}
			grabbedRigidbody.MovePosition(vector);
			grabbedRigidbody.MoveRotation(quaternion);
		}

		private static DistanceGrabbable HitInfoToGrabbable(RaycastHit hitInfo)
		{
			if (hitInfo.collider != null)
			{
				GameObject gameObject = hitInfo.collider.gameObject;
				return gameObject.GetComponent<DistanceGrabbable>() ?? gameObject.GetComponentInParent<DistanceGrabbable>();
			}
			return null;
		}

		protected bool FindTarget(out DistanceGrabbable dgOut, out Collider collOut)
		{
			dgOut = null;
			collOut = null;
			float num = float.MaxValue;
			foreach (OVRGrabbable key in m_grabCandidates.Keys)
			{
				DistanceGrabbable distanceGrabbable = key as DistanceGrabbable;
				if (!(distanceGrabbable != null) || !distanceGrabbable.InRange || (distanceGrabbable.isGrabbed && !distanceGrabbable.allowOffhandGrab))
				{
					continue;
				}
				for (int i = 0; i < distanceGrabbable.grabPoints.Length; i++)
				{
					Collider collider = distanceGrabbable.grabPoints[i];
					Vector3 vector = collider.ClosestPointOnBounds(m_gripTransform.position);
					float sqrMagnitude = (m_gripTransform.position - vector).sqrMagnitude;
					if (!(sqrMagnitude < num))
					{
						continue;
					}
					bool flag = true;
					if (m_preventGrabThroughWalls)
					{
						Ray ray = default(Ray);
						ray.direction = distanceGrabbable.transform.position - m_gripTransform.position;
						ray.origin = m_gripTransform.position;
						UnityEngine.Debug.DrawRay(ray.origin, ray.direction, Color.red, 0.1f);
						if (Physics.Raycast(ray, out var hitInfo, m_maxGrabDistance, 1 << m_obstructionLayer) && (double)(collider.ClosestPointOnBounds(m_gripTransform.position) - m_gripTransform.position).magnitude > (double)hitInfo.distance * 1.1)
						{
							flag = false;
						}
					}
					if (flag)
					{
						num = sqrMagnitude;
						dgOut = distanceGrabbable;
						collOut = collider;
					}
				}
			}
			if (dgOut == null && m_useSpherecast)
			{
				return FindTargetWithSpherecast(out dgOut, out collOut);
			}
			return dgOut != null;
		}

		protected bool FindTargetWithSpherecast(out DistanceGrabbable dgOut, out Collider collOut)
		{
			dgOut = null;
			collOut = null;
			Ray ray = new Ray(m_gripTransform.position, m_gripTransform.forward);
			if (Physics.SphereCast(ray, m_spherecastRadius, out var hitInfo, m_maxGrabDistance, 1 << m_grabObjectsInLayer))
			{
				DistanceGrabbable distanceGrabbable = null;
				Collider collider = null;
				if (hitInfo.collider != null)
				{
					distanceGrabbable = hitInfo.collider.gameObject.GetComponentInParent<DistanceGrabbable>();
					collider = ((distanceGrabbable == null) ? null : hitInfo.collider);
					if ((bool)distanceGrabbable)
					{
						dgOut = distanceGrabbable;
						collOut = collider;
					}
				}
				if (distanceGrabbable != null && m_preventGrabThroughWalls)
				{
					ray.direction = hitInfo.point - m_gripTransform.position;
					dgOut = distanceGrabbable;
					collOut = collider;
					if (Physics.Raycast(ray, out var hitInfo2, 1 << m_obstructionLayer))
					{
						DistanceGrabbable distanceGrabbable2 = null;
						if (hitInfo.collider != null)
						{
							distanceGrabbable2 = hitInfo2.collider.gameObject.GetComponentInParent<DistanceGrabbable>();
						}
						if (distanceGrabbable2 != distanceGrabbable && hitInfo2.distance < hitInfo.distance)
						{
							dgOut = null;
							collOut = null;
						}
					}
				}
			}
			return dgOut != null;
		}

		protected override void GrabVolumeEnable(bool enabled)
		{
			if (m_useSpherecast)
			{
				enabled = false;
			}
			base.GrabVolumeEnable(enabled);
		}

		protected override void OffhandGrabbed(OVRGrabbable grabbable)
		{
			base.OffhandGrabbed(grabbable);
		}
	}
	public class GrabbableCrosshair : MonoBehaviour
	{
		public enum CrosshairState
		{
			Disabled,
			Enabled,
			Targeted
		}

		private CrosshairState m_state;

		private Transform m_centerEyeAnchor;

		[SerializeField]
		private GameObject m_targetedCrosshair;

		[SerializeField]
		private GameObject m_enabledCrosshair;

		private void Start()
		{
			m_centerEyeAnchor = GameObject.Find("CenterEyeAnchor").transform;
		}

		public void SetState(CrosshairState cs)
		{
			m_state = cs;
			switch (cs)
			{
			case CrosshairState.Disabled:
				m_targetedCrosshair.SetActive(value: false);
				m_enabledCrosshair.SetActive(value: false);
				break;
			case CrosshairState.Enabled:
				m_targetedCrosshair.SetActive(value: false);
				m_enabledCrosshair.SetActive(value: true);
				break;
			case CrosshairState.Targeted:
				m_targetedCrosshair.SetActive(value: true);
				m_enabledCrosshair.SetActive(value: false);
				break;
			}
		}

		private void Update()
		{
			if (m_state != 0)
			{
				base.transform.LookAt(m_centerEyeAnchor);
			}
		}
	}
	public class GrabManager : MonoBehaviour
	{
		private Collider m_grabVolume;

		public Color OutlineColorInRange;

		public Color OutlineColorHighlighted;

		private void OnTriggerEnter(Collider otherCollider)
		{
			DistanceGrabbable componentInChildren = otherCollider.GetComponentInChildren<DistanceGrabbable>();
			if ((bool)componentInChildren)
			{
				componentInChildren.InRange = true;
			}
		}

		private void OnTriggerExit(Collider otherCollider)
		{
			DistanceGrabbable componentInChildren = otherCollider.GetComponentInChildren<DistanceGrabbable>();
			if ((bool)componentInChildren)
			{
				componentInChildren.InRange = false;
			}
		}
	}
	public class PauseOnInputLoss : MonoBehaviour
	{
		private void Start()
		{
			OVRManager.InputFocusAcquired += OnInputFocusAcquired;
			OVRManager.InputFocusLost += OnInputFocusLost;
		}

		private void OnInputFocusLost()
		{
			Time.timeScale = 0f;
		}

		private void OnInputFocusAcquired()
		{
			Time.timeScale = 1f;
		}
	}
	public class DistanceGrabberSample : MonoBehaviour
	{
		private bool museSpherecast;

		private bool allowGrabThroughWalls;

		[SerializeField]
		private DistanceGrabber[] m_grabbers;

		public bool UseSpherecast
		{
			get
			{
				return museSpherecast;
			}
			set
			{
				museSpherecast = value;
				for (int i = 0; i < m_grabbers.Length; i++)
				{
					m_grabbers[i].UseSpherecast = museSpherecast;
				}
			}
		}

		public bool AllowGrabThroughWalls
		{
			get
			{
				return allowGrabThroughWalls;
			}
			set
			{
				allowGrabThroughWalls = value;
				for (int i = 0; i < m_grabbers.Length; i++)
				{
					m_grabbers[i].m_preventGrabThroughWalls = !allowGrabThroughWalls;
				}
			}
		}

		private void Start()
		{
			DebugUIBuilder.instance.AddLabel("Distance Grab Sample");
			DebugUIBuilder.instance.AddToggle("Use Spherecasting", ToggleSphereCasting, museSpherecast);
			DebugUIBuilder.instance.AddToggle("Grab Through Walls", ToggleGrabThroughWalls, allowGrabThroughWalls);
			DebugUIBuilder.instance.Show();
		}

		public void ToggleSphereCasting(Toggle t)
		{
			UseSpherecast = !UseSpherecast;
		}

		public void ToggleGrabThroughWalls(Toggle t)
		{
			AllowGrabThroughWalls = !AllowGrabThroughWalls;
		}
	}
	public enum EUiDisplayType
	{
		EUDT_WorldGeoQuad,
		EUDT_OverlayQuad,
		EUDT_None,
		EUDT_MaxDislayTypes
	}
	public class OVROverlaySample : MonoBehaviour
	{
		private bool inMenu;

		private const string ovrOverlayID = "OVROverlayID";

		private const string applicationID = "ApplicationID";

		private const string noneID = "NoneID";

		private Toggle applicationRadioButton;

		private Toggle noneRadioButton;

		[Header("App vs Compositor Comparison Settings")]
		public GameObject mainCamera;

		public GameObject uiCamera;

		public GameObject uiGeoParent;

		public GameObject worldspaceGeoParent;

		public OVROverlay cameraRenderOverlay;

		public OVROverlay renderingLabelOverlay;

		public Texture applicationLabelTexture;

		public Texture compositorLabelTexture;

		[Header("Level Loading Sim Settings")]
		public GameObject prefabForLevelLoadSim;

		public OVROverlay cubemapOverlay;

		public OVROverlay loadingTextQuadOverlay;

		public float distanceFromCamToLoadText;

		public float cubeSpawnRadius;

		public float heightBetweenItems;

		public int numObjectsPerLevel;

		public int numLevels;

		public int numLoopsTrigger = 500000000;

		private List<GameObject> spawnedCubes = new List<GameObject>();

		private void Start()
		{
			DebugUIBuilder.instance.AddLabel("OVROverlay Sample");
			DebugUIBuilder.instance.AddDivider();
			DebugUIBuilder.instance.AddLabel("Level Loading Example");
			DebugUIBuilder.instance.AddButton("Simulate Level Load", TriggerLoad);
			DebugUIBuilder.instance.AddButton("Destroy Cubes", TriggerUnload);
			DebugUIBuilder.instance.AddDivider();
			DebugUIBuilder.instance.AddLabel("OVROverlay vs. Application Render Comparison");
			DebugUIBuilder.instance.AddRadio("OVROverlay", "group", delegate(Toggle t)
			{
				RadioPressed("OVROverlayID", "group", t);
			}).GetComponentInChildren<Toggle>();
			applicationRadioButton = DebugUIBuilder.instance.AddRadio("Application", "group", delegate(Toggle t)
			{
				RadioPressed("ApplicationID", "group", t);
			}).GetComponentInChildren<Toggle>();
			noneRadioButton = DebugUIBuilder.instance.AddRadio("None", "group", delegate(Toggle t)
			{
				RadioPressed("NoneID", "group", t);
			}).GetComponentInChildren<Toggle>();
			DebugUIBuilder.instance.Show();
			CameraAndRenderTargetSetup();
			cameraRenderOverlay.enabled = true;
			cameraRenderOverlay.currentOverlayShape = OVROverlay.OverlayShape.Quad;
			spawnedCubes.Capacity = numObjectsPerLevel * numLevels;
		}

		private void Update()
		{
			if (OVRInput.GetDown(OVRInput.Button.Two) || OVRInput.GetDown(OVRInput.Button.Start))
			{
				if (inMenu)
				{
					DebugUIBuilder.instance.Hide();
				}
				else
				{
					DebugUIBuilder.instance.Show();
				}
				inMenu = !inMenu;
			}
			if (Input.GetKeyDown(KeyCode.A))
			{
				TriggerLoad();
			}
		}

		private void ActivateWorldGeo()
		{
			worldspaceGeoParent.SetActive(value: true);
			uiGeoParent.SetActive(value: false);
			uiCamera.SetActive(value: false);
			cameraRenderOverlay.enabled = false;
			renderingLabelOverlay.enabled = true;
			renderingLabelOverlay.textures[0] = applicationLabelTexture;
			UnityEngine.Debug.Log("Switched to ActivateWorldGeo");
		}

		private void ActivateOVROverlay()
		{
			worldspaceGeoParent.SetActive(value: false);
			uiCamera.SetActive(value: true);
			cameraRenderOverlay.enabled = true;
			uiGeoParent.SetActive(value: true);
			renderingLabelOverlay.enabled = true;
			renderingLabelOverlay.textures[0] = compositorLabelTexture;
			UnityEngine.Debug.Log("Switched to ActivateOVROVerlay");
		}

		private void ActivateNone()
		{
			worldspaceGeoParent.SetActive(value: false);
			uiCamera.SetActive(value: false);
			cameraRenderOverlay.enabled = false;
			uiGeoParent.SetActive(value: false);
			renderingLabelOverlay.enabled = false;
			UnityEngine.Debug.Log("Switched to ActivateNone");
		}

		private void TriggerLoad()
		{
			StartCoroutine(WaitforOVROverlay());
		}

		private IEnumerator WaitforOVROverlay()
		{
			Transform transform = mainCamera.transform;
			Transform obj = loadingTextQuadOverlay.transform;
			Vector3 position = transform.position + transform.forward * distanceFromCamToLoadText;
			position.y = transform.position.y;
			obj.position = position;
			cubemapOverlay.enabled = true;
			loadingTextQuadOverlay.enabled = true;
			noneRadioButton.isOn = true;
			yield return new WaitForSeconds(0.1f);
			ClearObjects();
			SimulateLevelLoad();
			cubemapOverlay.enabled = false;
			loadingTextQuadOverlay.enabled = false;
			yield return null;
		}

		private void TriggerUnload()
		{
			ClearObjects();
			applicationRadioButton.isOn = true;
		}

		private void CameraAndRenderTargetSetup()
		{
			float x = cameraRenderOverlay.transform.localScale.x;
			float y = cameraRenderOverlay.transform.localScale.y;
			float z = cameraRenderOverlay.transform.localScale.z;
			float num = 1440f;
			float num2 = 2560f * 0.5f;
			float num3 = mainCamera.GetComponent<Camera>().fieldOfView / 2f;
			float num4 = 2f * z * Mathf.Tan((float)Math.PI / 180f * num3);
			float num5 = num / num4 * x;
			float num6 = 0f;
			float num7 = num4 * mainCamera.GetComponent<Camera>().aspect;
			num6 = num2 / num7 * x;
			float orthographicSize = y / 2f;
			float aspect = x / y;
			uiCamera.GetComponent<Camera>().orthographicSize = orthographicSize;
			uiCamera.GetComponent<Camera>().aspect = aspect;
			if (uiCamera.GetComponent<Camera>().targetTexture != null)
			{
				uiCamera.GetComponent<Camera>().targetTexture.Release();
			}
			RenderTexture renderTexture = new RenderTexture((int)num6 * 2, (int)num5 * 2, 0, RenderTextureFormat.ARGB32, RenderTextureReadWrite.sRGB);
			UnityEngine.Debug.Log("Created RT of resolution w: " + num6 + " and h: " + num5);
			renderTexture.hideFlags = HideFlags.DontSave;
			renderTexture.useMipMap = true;
			renderTexture.filterMode = FilterMode.Trilinear;
			renderTexture.anisoLevel = 4;
			renderTexture.autoGenerateMips = true;
			uiCamera.GetComponent<Camera>().targetTexture = renderTexture;
			cameraRenderOverlay.textures[0] = renderTexture;
		}

		private void SimulateLevelLoad()
		{
			int num = 0;
			for (int i = 0; i < numLoopsTrigger; i++)
			{
				num++;
			}
			UnityEngine.Debug.Log("Finished " + num + " Loops");
			Vector3 position = mainCamera.transform.position;
			position.y = 0.5f;
			for (int j = 0; j < numLevels; j++)
			{
				for (int k = 0; k < numObjectsPerLevel; k++)
				{
					float f = (float)k * (float)Math.PI * 2f / (float)numObjectsPerLevel;
					float num2 = ((k % 2 == 0) ? 1.5f : 1f);
					Vector3 vector = new Vector3(Mathf.Cos(f), 0f, Mathf.Sin(f)) * cubeSpawnRadius * num2;
					vector.y = (float)j * heightBetweenItems;
					GameObject gameObject = UnityEngine.Object.Instantiate(prefabForLevelLoadSim, vector + position, Quaternion.identity);
					Transform obj = gameObject.transform;
					obj.LookAt(position);
					Vector3 eulerAngles = obj.rotation.eulerAngles;
					eulerAngles.x = 0f;
					obj.rotation = Quaternion.Euler(eulerAngles);
					spawnedCubes.Add(gameObject);
				}
			}
		}

		private void ClearObjects()
		{
			for (int i = 0; i < spawnedCubes.Count; i++)
			{
				UnityEngine.Object.DestroyImmediate(spawnedCubes[i]);
			}
			spawnedCubes.Clear();
			GC.Collect();
		}

		public void RadioPressed(string radioLabel, string group, Toggle t)
		{
			if (string.Compare(radioLabel, "OVROverlayID") == 0)
			{
				ActivateOVROverlay();
			}
			else if (string.Compare(radioLabel, "ApplicationID") == 0)
			{
				ActivateWorldGeo();
			}
			else if (string.Compare(radioLabel, "NoneID") == 0)
			{
				ActivateNone();
			}
		}
	}
}
namespace OVRTouchSample
{
	[RequireComponent(typeof(OVRGrabber))]
	public class Hand : MonoBehaviour
	{
		public const string ANIM_LAYER_NAME_POINT = "Point Layer";

		public const string ANIM_LAYER_NAME_THUMB = "Thumb Layer";

		public const string ANIM_PARAM_NAME_FLEX = "Flex";

		public const string ANIM_PARAM_NAME_POSE = "Pose";

		public const float THRESH_COLLISION_FLEX = 0.9f;

		public const float INPUT_RATE_CHANGE = 20f;

		public const float COLLIDER_SCALE_MIN = 0.01f;

		public const float COLLIDER_SCALE_MAX = 1f;

		public const float COLLIDER_SCALE_PER_SECOND = 1f;

		public const float TRIGGER_DEBOUNCE_TIME = 0.05f;

		public const float THUMB_DEBOUNCE_TIME = 0.15f;

		[SerializeField]
		private OVRInput.Controller m_controller;

		[SerializeField]
		private Animator m_animator;

		[SerializeField]
		private HandPose m_defaultGrabPose;

		private Collider[] m_colliders;

		private bool m_collisionEnabled = true;

		private OVRGrabber m_grabber;

		private List<Renderer> m_showAfterInputFocusAcquired;

		private int m_animLayerIndexThumb = -1;

		private int m_animLayerIndexPoint = -1;

		private int m_animParamIndexFlex = -1;

		private int m_animParamIndexPose = -1;

		private bool m_isPointing;

		private bool m_isGivingThumbsUp;

		private float m_pointBlend;

		private float m_thumbsUpBlend;

		private bool m_restoreOnInputAcquired;

		private float m_collisionScaleCurrent;

		private void Awake()
		{
			m_grabber = GetComponent<OVRGrabber>();
		}

		private void Start()
		{
			m_showAfterInputFocusAcquired = new List<Renderer>();
			m_colliders = (from childCollider in GetComponentsInChildren<Collider>()
				where !childCollider.isTrigger
				select childCollider).ToArray();
			CollisionEnable(enabled: false);
			m_animLayerIndexPoint = m_animator.GetLayerIndex("Point Layer");
			m_animLayerIndexThumb = m_animator.GetLayerIndex("Thumb Layer");
			m_animParamIndexFlex = Animator.StringToHash("Flex");
			m_animParamIndexPose = Animator.StringToHash("Pose");
			OVRManager.InputFocusAcquired += OnInputFocusAcquired;
			OVRManager.InputFocusLost += OnInputFocusLost;
		}

		private void Update()
		{
			UpdateCapTouchStates();
			m_pointBlend = InputValueRateChange(m_isPointing, m_pointBlend);
			m_thumbsUpBlend = InputValueRateChange(m_isGivingThumbsUp, m_thumbsUpBlend);
			float num = OVRInput.Get(OVRInput.Axis1D.PrimaryHandTrigger, m_controller);
			bool flag = m_grabber.grabbedObject == null && num >= 0.9f;
			CollisionEnable(flag);
			UpdateAnimStates();
		}

		private void UpdateCapTouchStates()
		{
			m_isPointing = !OVRInput.Get(OVRInput.NearTouch.PrimaryIndexTrigger, m_controller);
			m_isGivingThumbsUp = !OVRInput.Get(OVRInput.NearTouch.PrimaryThumbButtons, m_controller);
		}

		private void LateUpdate()
		{
			if (m_collisionEnabled && m_collisionScaleCurrent + Mathf.Epsilon < 1f)
			{
				m_collisionScaleCurrent = Mathf.Min(1f, m_collisionScaleCurrent + Time.deltaTime * 1f);
				for (int i = 0; i < m_colliders.Length; i++)
				{
					m_colliders[i].transform.localScale = new Vector3(m_collisionScaleCurrent, m_collisionScaleCurrent, m_collisionScaleCurrent);
				}
			}
		}

		private void OnInputFocusLost()
		{
			if (!base.gameObject.activeInHierarchy)
			{
				return;
			}
			m_showAfterInputFocusAcquired.Clear();
			Renderer[] componentsInChildren = GetComponentsInChildren<Renderer>();
			for (int i = 0; i < componentsInChildren.Length; i++)
			{
				if (componentsInChildren[i].enabled)
				{
					componentsInChildren[i].enabled = false;
					m_showAfterInputFocusAcquired.Add(componentsInChildren[i]);
				}
			}
			CollisionEnable(enabled: false);
			m_restoreOnInputAcquired = true;
		}

		private void OnInputFocusAcquired()
		{
			if (!m_restoreOnInputAcquired)
			{
				return;
			}
			for (int i = 0; i < m_showAfterInputFocusAcquired.Count; i++)
			{
				if ((bool)m_showAfterInputFocusAcquired[i])
				{
					m_showAfterInputFocusAcquired[i].enabled = true;
				}
			}
			m_showAfterInputFocusAcquired.Clear();
			m_restoreOnInputAcquired = false;
		}

		private float InputValueRateChange(bool isDown, float value)
		{
			float num = Time.deltaTime * 20f;
			float num2 = (isDown ? 1f : (-1f));
			return Mathf.Clamp01(value + num * num2);
		}

		private void UpdateAnimStates()
		{
			bool num = m_grabber.grabbedObject != null;
			HandPose handPose = m_defaultGrabPose;
			if (num)
			{
				HandPose component = m_grabber.grabbedObject.GetComponent<HandPose>();
				if (component != null)
				{
					handPose = component;
				}
			}
			HandPoseId poseId = handPose.PoseId;
			m_animator.SetInteger(m_animParamIndexPose, (int)poseId);
			float value = OVRInput.Get(OVRInput.Axis1D.PrimaryHandTrigger, m_controller);
			m_animator.SetFloat(m_animParamIndexFlex, value);
			float weight = ((!num || handPose.AllowPointing) ? m_pointBlend : 0f);
			m_animator.SetLayerWeight(m_animLayerIndexPoint, weight);
			float weight2 = ((!num || handPose.AllowThumbsUp) ? m_thumbsUpBlend : 0f);
			m_animator.SetLayerWeight(m_animLayerIndexThumb, weight2);
			float value2 = OVRInput.Get(OVRInput.Axis1D.PrimaryIndexTrigger, m_controller);
			m_animator.SetFloat("Pinch", value2);
		}

		private void CollisionEnable(bool enabled)
		{
			if (m_collisionEnabled == enabled)
			{
				return;
			}
			m_collisionEnabled = enabled;
			if (enabled)
			{
				m_collisionScaleCurrent = 0.01f;
				for (int i = 0; i < m_colliders.Length; i++)
				{
					Collider obj = m_colliders[i];
					obj.transform.localScale = new Vector3(0.01f, 0.01f, 0.01f);
					obj.enabled = true;
				}
			}
			else
			{
				m_collisionScaleCurrent = 1f;
				for (int j = 0; j < m_colliders.Length; j++)
				{
					Collider obj2 = m_colliders[j];
					obj2.enabled = false;
					obj2.transform.localScale = new Vector3(0.01f, 0.01f, 0.01f);
				}
			}
		}
	}
	public enum HandPoseId
	{
		Default,
		Generic,
		PingPongBall,
		Controller
	}
	public class HandPose : MonoBehaviour
	{
		[SerializeField]
		private bool m_allowPointing;

		[SerializeField]
		private bool m_allowThumbsUp;

		[SerializeField]
		private HandPoseId m_poseId;

		public bool AllowPointing => m_allowPointing;

		public bool AllowThumbsUp => m_allowThumbsUp;

		public HandPoseId PoseId => m_poseId;
	}
	public class TouchController : MonoBehaviour
	{
		[SerializeField]
		private OVRInput.Controller m_controller;

		[SerializeField]
		private Animator m_animator;

		private bool m_restoreOnInputAcquired;

		private void Update()
		{
			m_animator.SetFloat("Button 1", OVRInput.Get(OVRInput.Button.One, m_controller) ? 1f : 0f);
			m_animator.SetFloat("Button 2", OVRInput.Get(OVRInput.Button.Two, m_controller) ? 1f : 0f);
			m_animator.SetFloat("Joy X", OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, m_controller).x);
			m_animator.SetFloat("Joy Y", OVRInput.Get(OVRInput.Axis2D.PrimaryThumbstick, m_controller).y);
			m_animator.SetFloat("Grip", OVRInput.Get(OVRInput.Axis1D.PrimaryHandTrigger, m_controller));
			m_animator.SetFloat("Trigger", OVRInput.Get(OVRInput.Axis1D.PrimaryIndexTrigger, m_controller));
			OVRManager.InputFocusAcquired += OnInputFocusAcquired;
			OVRManager.InputFocusLost += OnInputFocusLost;
		}

		private void OnInputFocusLost()
		{
			if (base.gameObject.activeInHierarchy)
			{
				base.gameObject.SetActive(value: false);
				m_restoreOnInputAcquired = true;
			}
		}

		private void OnInputFocusAcquired()
		{
			if (m_restoreOnInputAcquired)
			{
				base.gameObject.SetActive(value: true);
				m_restoreOnInputAcquired = false;
			}
		}
	}
}
namespace Oculus.Spatializer.Propagation
{
	public enum FaceType : uint
	{
		TRIANGLES,
		QUADS
	}
	public enum MaterialProperty : uint
	{
		ABSORPTION,
		TRANSMISSION,
		SCATTERING
	}
	[StructLayout(LayoutKind.Sequential, Pack = 1)]
	public struct MeshGroup
	{
		public UIntPtr indexOffset;

		public UIntPtr faceCount;

		[MarshalAs(UnmanagedType.U4)]
		public FaceType faceType;

		public IntPtr material;
	}
}
namespace Oculus.Platform
{
	public class AbuseReportOptions
	{
		private IntPtr Handle;

		public AbuseReportOptions()
		{
			Handle = CAPI.ovr_AbuseReportOptions_Create();
		}

		public void SetPreventPeopleChooser(bool value)
		{
			CAPI.ovr_AbuseReportOptions_SetPreventPeopleChooser(Handle, value);
		}

		public void SetReportType(AbuseReportType value)
		{
			CAPI.ovr_AbuseReportOptions_SetReportType(Handle, value);
		}

		public static explicit operator IntPtr(AbuseReportOptions options)
		{
			return options?.Handle ?? IntPtr.Zero;
		}

		~AbuseReportOptions()
		{
			CAPI.ovr_AbuseReportOptions_Destroy(Handle);
		}
	}
	public enum AbuseReportType
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("OBJECT")]
		Object,
		[Description("USER")]
		User
	}
	public enum AchievementType
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("SIMPLE")]
		Simple,
		[Description("BITFIELD")]
		Bitfield,
		[Description("COUNT")]
		Count
	}
	public class AndroidPlatform
	{
		public bool Initialize(string appId)
		{
			if (string.IsNullOrEmpty(appId))
			{
				throw new UnityException("AppID must not be null or empty");
			}
			return CAPI.ovr_UnityInitWrapper(appId);
		}

		public Request<PlatformInitialize> AsyncInitialize(string appId)
		{
			if (string.IsNullOrEmpty(appId))
			{
				throw new UnityException("AppID must not be null or empty");
			}
			return new Request<PlatformInitialize>(CAPI.ovr_UnityInitWrapperAsynchronous(appId));
		}
	}
	public class ApplicationOptions
	{
		private IntPtr Handle;

		public ApplicationOptions()
		{
			Handle = CAPI.ovr_ApplicationOptions_Create();
		}

		public void SetDeeplinkMessage(string value)
		{
			CAPI.ovr_ApplicationOptions_SetDeeplinkMessage(Handle, value);
		}

		public static explicit operator IntPtr(ApplicationOptions options)
		{
			return options?.Handle ?? IntPtr.Zero;
		}

		~ApplicationOptions()
		{
			CAPI.ovr_ApplicationOptions_Destroy(Handle);
		}
	}
	public static class Callback
	{
		private class RequestCallback
		{
			private Message.Callback messageCallback;

			public RequestCallback()
			{
			}

			public RequestCallback(Message.Callback callback)
			{
				messageCallback = callback;
			}

			public virtual void HandleMessage(Message msg)
			{
				if (messageCallback != null)
				{
					messageCallback(msg);
				}
			}
		}

		private sealed class RequestCallback<T> : RequestCallback
		{
			private Message<T>.Callback callback;

			public RequestCallback(Message<T>.Callback callback)
			{
				this.callback = callback;
			}

			public override void HandleMessage(Message msg)
			{
				if (callback != null)
				{
					if (!hasRegisteredRoomInviteNotificationHandler && msg.Type == Message.MessageType.Notification_Room_InviteAccepted)
					{
						pendingRoomInviteNotifications.Add(msg);
					}
					else if (msg is Message<T>)
					{
						callback((Message<T>)msg);
					}
					else
					{
						UnityEngine.Debug.LogError("Unable to handle message: " + msg.GetType());
					}
				}
			}
		}

		private static Dictionary<ulong, Request> requestIDsToRequests = new Dictionary<ulong, Request>();

		private static Dictionary<Message.MessageType, RequestCallback> notificationCallbacks = new Dictionary<Message.MessageType, RequestCallback>();

		private static bool hasRegisteredRoomInviteNotificationHandler = false;

		private static List<Message> pendingRoomInviteNotifications = new List<Message>();

		internal static void SetNotificationCallback<T>(Message.MessageType type, Message<T>.Callback callback)
		{
			if (callback == null)
			{
				throw new Exception("Cannot provide a null notification callback.");
			}
			notificationCallbacks[type] = new RequestCallback<T>(callback);
			if (type == Message.MessageType.Notification_Room_InviteAccepted)
			{
				FlushRoomInviteNotificationQueue();
			}
		}

		internal static void SetNotificationCallback(Message.MessageType type, Message.Callback callback)
		{
			if (callback == null)
			{
				throw new Exception("Cannot provide a null notification callback.");
			}
			notificationCallbacks[type] = new RequestCallback(callback);
		}

		internal static void AddRequest(Request request)
		{
			if (request.RequestID == 0L)
			{
				UnityEngine.Debug.LogError("An unknown error occurred. Request failed.");
			}
			else
			{
				requestIDsToRequests[request.RequestID] = request;
			}
		}

		internal static void RunCallbacks()
		{
			while (true)
			{
				Message message = Message.PopMessage();
				if (message != null)
				{
					HandleMessage(message);
					continue;
				}
				break;
			}
		}

		internal static void RunLimitedCallbacks(uint limit)
		{
			for (int i = 0; i < limit; i++)
			{
				Message message = Message.PopMessage();
				if (message != null)
				{
					HandleMessage(message);
					continue;
				}
				break;
			}
		}

		internal static void OnApplicationQuit()
		{
			requestIDsToRequests.Clear();
			notificationCallbacks.Clear();
		}

		private static void FlushRoomInviteNotificationQueue()
		{
			hasRegisteredRoomInviteNotificationHandler = true;
			foreach (Message pendingRoomInviteNotification in pendingRoomInviteNotifications)
			{
				HandleMessage(pendingRoomInviteNotification);
			}
			pendingRoomInviteNotifications.Clear();
		}

		internal static void HandleMessage(Message msg)
		{
			if (msg.RequestID != 0L && requestIDsToRequests.TryGetValue(msg.RequestID, out var value))
			{
				try
				{
					value.HandleMessage(msg);
					return;
				}
				finally
				{
					requestIDsToRequests.Remove(msg.RequestID);
				}
			}
			if (notificationCallbacks.TryGetValue(msg.Type, out var value2))
			{
				value2.HandleMessage(msg);
			}
		}
	}
	public class CallbackRunner : MonoBehaviour
	{
		public bool IsPersistantBetweenSceneLoads = true;

		[DllImport("ovrplatformloader")]
		private static extern void ovr_UnityResetTestPlatform();

		private void Awake()
		{
			if (UnityEngine.Object.FindObjectOfType<CallbackRunner>() != this)
			{
				UnityEngine.Debug.LogWarning("You only need one instance of CallbackRunner");
			}
			if (IsPersistantBetweenSceneLoads)
			{
				UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
			}
		}

		private void Update()
		{
			Request.RunCallbacks();
		}

		private void OnDestroy()
		{
		}

		private void OnApplicationQuit()
		{
			Callback.OnApplicationQuit();
		}
	}
	public class CAPI
	{
		public struct ovrKeyValuePair
		{
			public string key_;

			private KeyValuePairType valueType_;

			public string stringValue_;

			public int intValue_;

			public double doubleValue_;

			public ovrKeyValuePair(string key, string value)
			{
				key_ = key;
				valueType_ = KeyValuePairType.String;
				stringValue_ = value;
				intValue_ = 0;
				doubleValue_ = 0.0;
			}

			public ovrKeyValuePair(string key, int value)
			{
				key_ = key;
				valueType_ = KeyValuePairType.Int;
				intValue_ = value;
				stringValue_ = null;
				doubleValue_ = 0.0;
			}

			public ovrKeyValuePair(string key, double value)
			{
				key_ = key;
				valueType_ = KeyValuePairType.Double;
				doubleValue_ = value;
				stringValue_ = null;
				intValue_ = 0;
			}
		}

		public struct ovrMatchmakingCriterion
		{
			public string key_;

			public MatchmakingCriterionImportance importance_;

			public IntPtr parameterArray;

			public uint parameterArrayCount;

			public ovrMatchmakingCriterion(string key, MatchmakingCriterionImportance importance)
			{
				key_ = key;
				importance_ = importance;
				parameterArray = IntPtr.Zero;
				parameterArrayCount = 0u;
			}
		}

		public struct ovrMatchmakingCustomQueryData
		{
			public IntPtr dataArray;

			public uint dataArrayCount;

			public IntPtr criterionArray;

			public uint criterionArrayCount;
		}

		public struct OculusInitParams
		{
			public int sType;

			public string email;

			public string password;

			public ulong appId;

			public string uriPrefixOverride;
		}

		[UnmanagedFunctionPointer(CallingConvention.Cdecl)]
		public delegate void FilterCallback([In][Out][MarshalAs(UnmanagedType.LPArray, SizeConst = 480)] short[] pcmData, UIntPtr pcmDataLength, int frequency, int numChannels);

		public const string DLL_NAME = "ovrplatformloader";

		private static UTF8Encoding nativeStringEncoding = new UTF8Encoding(encoderShouldEmitUTF8Identifier: false);

		public const int VoipFilterBufferSize = 480;

		public static IntPtr ArrayOfStructsToIntPtr(Array ar)
		{
			int num = 0;
			for (int i = 0; i < ar.Length; i++)
			{
				num += Marshal.SizeOf(ar.GetValue(i));
			}
			IntPtr intPtr = Marshal.AllocHGlobal(num);
			IntPtr intPtr2 = intPtr;
			for (int j = 0; j < ar.Length; j++)
			{
				Marshal.StructureToPtr(ar.GetValue(j), intPtr2, fDeleteOld: false);
				intPtr2 = (IntPtr)((long)intPtr2 + Marshal.SizeOf(ar.GetValue(j)));
			}
			return intPtr;
		}

		public static ovrKeyValuePair[] DictionaryToOVRKeyValuePairs(Dictionary<string, object> dict)
		{
			if (dict == null || dict.Count == 0)
			{
				return null;
			}
			ovrKeyValuePair[] array = new ovrKeyValuePair[dict.Count];
			int num = 0;
			foreach (KeyValuePair<string, object> item in dict)
			{
				if (item.Value.GetType() == typeof(int))
				{
					array[num] = new ovrKeyValuePair(item.Key, (int)item.Value);
				}
				else if (item.Value.GetType() == typeof(string))
				{
					array[num] = new ovrKeyValuePair(item.Key, (string)item.Value);
				}
				else
				{
					if (!(item.Value.GetType() == typeof(double)))
					{
						throw new Exception("Only int, double or string are allowed types in CustomQuery.data");
					}
					array[num] = new ovrKeyValuePair(item.Key, (double)item.Value);
				}
				num++;
			}
			return array;
		}

		public static byte[] IntPtrToByteArray(IntPtr data, ulong size)
		{
			byte[] array = new byte[size];
			Marshal.Copy(data, array, 0, (int)size);
			return array;
		}

		public static Dictionary<string, string> DataStoreFromNative(IntPtr pointer)
		{
			Dictionary<string, string> dictionary = new Dictionary<string, string>();
			int num = (int)(uint)ovr_DataStore_GetNumKeys(pointer);
			for (int i = 0; i < num; i++)
			{
				string key = ovr_DataStore_GetKey(pointer, i);
				dictionary[key] = ovr_DataStore_GetValue(pointer, key);
			}
			return dictionary;
		}

		public static string StringFromNative(IntPtr pointer)
		{
			if (pointer == IntPtr.Zero)
			{
				return null;
			}
			int nativeStringLengthNotIncludingNullTerminator = GetNativeStringLengthNotIncludingNullTerminator(pointer);
			byte[] array = new byte[nativeStringLengthNotIncludingNullTerminator];
			Marshal.Copy(pointer, array, 0, nativeStringLengthNotIncludingNullTerminator);
			return nativeStringEncoding.GetString(array);
		}

		public static int GetNativeStringLengthNotIncludingNullTerminator(IntPtr pointer)
		{
			int i;
			for (i = 0; Marshal.ReadByte(pointer, i) != 0; i++)
			{
			}
			return i;
		}

		public static DateTime DateTimeFromNative(ulong seconds_since_the_one_true_epoch)
		{
			return new DateTime(1970, 1, 1, 0, 0, 0, 0).AddSeconds(seconds_since_the_one_true_epoch).ToLocalTime();
		}

		public static ulong DateTimeToNative(DateTime dt)
		{
			DateTime obj = ((dt.Kind != DateTimeKind.Utc) ? dt.ToUniversalTime() : dt);
			DateTime dateTime = new DateTime(1970, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc);
			return (ulong)(obj - dateTime).TotalSeconds;
		}

		public static byte[] BlobFromNative(uint size, IntPtr pointer)
		{
			byte[] array = new byte[size];
			for (int i = 0; i < (int)size; i++)
			{
				array[i] = Marshal.ReadByte(pointer, i);
			}
			return array;
		}

		public static byte[] FiledataFromNative(uint size, IntPtr pointer)
		{
			byte[] array = new byte[size];
			Marshal.Copy(pointer, array, 0, (int)size);
			return array;
		}

		public static IntPtr StringToNative(string s)
		{
			if (s == null)
			{
				throw new Exception("StringFromNative: null argument");
			}
			int byteCount = nativeStringEncoding.GetByteCount(s);
			byte[] array = new byte[byteCount + 1];
			nativeStringEncoding.GetBytes(s, 0, s.Length, array, 0);
			IntPtr intPtr = Marshal.AllocCoTaskMem(byteCount + 1);
			Marshal.Copy(array, 0, intPtr, byteCount + 1);
			return intPtr;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_UnityInitWrapper(string appId);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_UnityInitGlobals(IntPtr loggingCB);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_UnityInitWrapperAsynchronous(string appId);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_UnityInitWrapperStandalone(string accessToken, IntPtr loggingCB);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Platform_InitializeStandaloneOculus(ref OculusInitParams init);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_PlatformInitializeWithAccessToken(ulong appId, string accessToken);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_UnityInitWrapperWindows(string appId, IntPtr loggingCB);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_UnityInitWrapperWindowsAsynchronous(string appId, IntPtr loggingCB);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_SetDeveloperAccessToken(string accessToken);

		public static string ovr_GetLoggedInUserLocale()
		{
			return StringFromNative(ovr_GetLoggedInUserLocale_Native());
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_GetLoggedInUserLocale")]
		private static extern IntPtr ovr_GetLoggedInUserLocale_Native();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_PopMessage();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_FreeMessage(IntPtr message);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_NetworkingPeer_GetSendPolicy(IntPtr networkingPeer);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Voip_CreateEncoder();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Voip_DestroyEncoder(IntPtr encoder);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Voip_CreateDecoder();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Voip_DestroyDecoder(IntPtr decoder);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_VoipDecoder_Decode(IntPtr obj, byte[] compressedData, ulong compressedSize);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Microphone_Create();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Microphone_Destroy(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Voip_SetSystemVoipPassthrough(bool passthrough);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Voip_SetSystemVoipMicrophoneMuted(VoipMuteState muted);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_UnityResetTestPlatform();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_HTTP_GetWithMessageType(string url, int messageType);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_CrashApplication();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Voip_SetMicrophoneFilterCallback(FilterCallback cb);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Voip_SetMicrophoneFilterCallbackWithFixedSizeBuffer(FilterCallback cb, UIntPtr bufferSizeElements);

		public static void LogNewEvent(string eventName, Dictionary<string, string> values)
		{
			IntPtr intPtr = StringToNative(eventName);
			int num = values?.Count ?? 0;
			IntPtr[] array = new IntPtr[num * 2];
			if (num > 0)
			{
				int num2 = 0;
				foreach (KeyValuePair<string, string> value in values)
				{
					array[num2 * 2] = StringToNative(value.Key);
					array[num2 * 2 + 1] = StringToNative(value.Value);
					num2++;
				}
			}
			ovr_Log_NewEvent(intPtr, array, (UIntPtr)(ulong)num);
			Marshal.FreeCoTaskMem(intPtr);
			IntPtr[] array2 = array;
			for (int i = 0; i < array2.Length; i++)
			{
				Marshal.FreeCoTaskMem(array2[i]);
			}
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Log_NewEvent(IntPtr eventName, IntPtr[] values, UIntPtr length);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_ApplicationLifecycle_GetLaunchDetails();

		public static ulong ovr_HTTP_StartTransfer(string url, ovrKeyValuePair[] headers)
		{
			IntPtr intPtr = StringToNative(url);
			UIntPtr numItems = (UIntPtr)(ulong)headers.Length;
			ulong result = ovr_HTTP_StartTransfer_Native(intPtr, headers, numItems);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_HTTP_StartTransfer")]
		private static extern ulong ovr_HTTP_StartTransfer_Native(IntPtr url, ovrKeyValuePair[] headers, UIntPtr numItems);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_HTTP_Write(ulong transferId, byte[] bytes, UIntPtr length);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_HTTP_WriteEOM(ulong transferId);

		public static string ovr_Message_GetStringForJavascript(IntPtr message)
		{
			return StringFromNative(ovr_Message_GetStringForJavascript_Native(message));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Message_GetStringForJavascript")]
		private static extern IntPtr ovr_Message_GetStringForJavascript_Native(IntPtr message);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Net_Accept(ulong peerID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_Net_AcceptForCurrentRoom();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Net_Close(ulong peerID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Net_CloseForCurrentRoom();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Net_Connect(ulong peerID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_Net_IsConnected(ulong peerID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Net_Ping(ulong peerID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Net_ReadPacket();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_Net_SendPacket(ulong userID, UIntPtr length, byte[] bytes, SendPolicy policy);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_Net_SendPacketToCurrentRoom(UIntPtr length, byte[] bytes, SendPolicy policy);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern int ovr_Party_PluginGetSharedMemHandle();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern VoipMuteState ovr_Party_PluginGetVoipMicrophoneMuted();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_Party_PluginGetVoipPassthrough();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern SystemVoipStatus ovr_Party_PluginGetVoipStatus();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Voip_Accept(ulong userID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern VoipDtxState ovr_Voip_GetIsConnectionUsingDtx(ulong peerID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern VoipBitrate ovr_Voip_GetLocalBitrate(ulong peerID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_Voip_GetOutputBufferMaxSize();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_Voip_GetPCM(ulong senderID, short[] outputBuffer, UIntPtr outputBufferNumElements);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_Voip_GetPCMFloat(ulong senderID, float[] outputBuffer, UIntPtr outputBufferNumElements);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_Voip_GetPCMSize(ulong senderID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_Voip_GetPCMWithTimestamp(ulong senderID, short[] outputBuffer, UIntPtr outputBufferNumElements, uint[] timestamp);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_Voip_GetPCMWithTimestampFloat(ulong senderID, float[] outputBuffer, UIntPtr outputBufferNumElements, uint[] timestamp);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern VoipBitrate ovr_Voip_GetRemoteBitrate(ulong peerID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_Voip_GetSyncTimestamp(ulong userID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern long ovr_Voip_GetSyncTimestampDifference(uint lhs, uint rhs);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern VoipMuteState ovr_Voip_GetSystemVoipMicrophoneMuted();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern SystemVoipStatus ovr_Voip_GetSystemVoipStatus();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Voip_SetMicrophoneMuted(VoipMuteState state);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Voip_SetNewConnectionOptions(IntPtr voipOptions);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Voip_SetOutputSampleRate(VoipSampleRate rate);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Voip_Start(ulong userID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Voip_Stop(ulong userID);

		public static ulong ovr_Achievements_AddCount(string name, ulong count)
		{
			IntPtr intPtr = StringToNative(name);
			ulong result = ovr_Achievements_AddCount_Native(intPtr, count);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Achievements_AddCount")]
		private static extern ulong ovr_Achievements_AddCount_Native(IntPtr name, ulong count);

		public static ulong ovr_Achievements_AddFields(string name, string fields)
		{
			IntPtr intPtr = StringToNative(name);
			IntPtr intPtr2 = StringToNative(fields);
			ulong result = ovr_Achievements_AddFields_Native(intPtr, intPtr2);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Achievements_AddFields")]
		private static extern ulong ovr_Achievements_AddFields_Native(IntPtr name, IntPtr fields);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Achievements_GetAllDefinitions();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Achievements_GetAllProgress();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Achievements_GetDefinitionsByName(string[] names, int count);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Achievements_GetProgressByName(string[] names, int count);

		public static ulong ovr_Achievements_Unlock(string name)
		{
			IntPtr intPtr = StringToNative(name);
			ulong result = ovr_Achievements_Unlock_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Achievements_Unlock")]
		private static extern ulong ovr_Achievements_Unlock_Native(IntPtr name);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Application_ExecuteCoordinatedLaunch(ulong appID, ulong roomID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Application_GetInstalledApplications();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Application_GetVersion();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Application_LaunchOtherApp(ulong appID, IntPtr deeplink_options);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_ApplicationLifecycle_GetRegisteredPIDs();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_ApplicationLifecycle_GetSessionKey();

		public static ulong ovr_ApplicationLifecycle_RegisterSessionKey(string sessionKey)
		{
			IntPtr intPtr = StringToNative(sessionKey);
			ulong result = ovr_ApplicationLifecycle_RegisterSessionKey_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_ApplicationLifecycle_RegisterSessionKey")]
		private static extern ulong ovr_ApplicationLifecycle_RegisterSessionKey_Native(IntPtr sessionKey);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFile_Delete(ulong assetFileID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFile_DeleteById(ulong assetFileID);

		public static ulong ovr_AssetFile_DeleteByName(string assetFileName)
		{
			IntPtr intPtr = StringToNative(assetFileName);
			ulong result = ovr_AssetFile_DeleteByName_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AssetFile_DeleteByName")]
		private static extern ulong ovr_AssetFile_DeleteByName_Native(IntPtr assetFileName);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFile_Download(ulong assetFileID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFile_DownloadById(ulong assetFileID);

		public static ulong ovr_AssetFile_DownloadByName(string assetFileName)
		{
			IntPtr intPtr = StringToNative(assetFileName);
			ulong result = ovr_AssetFile_DownloadByName_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AssetFile_DownloadByName")]
		private static extern ulong ovr_AssetFile_DownloadByName_Native(IntPtr assetFileName);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFile_DownloadCancel(ulong assetFileID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFile_DownloadCancelById(ulong assetFileID);

		public static ulong ovr_AssetFile_DownloadCancelByName(string assetFileName)
		{
			IntPtr intPtr = StringToNative(assetFileName);
			ulong result = ovr_AssetFile_DownloadCancelByName_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AssetFile_DownloadCancelByName")]
		private static extern ulong ovr_AssetFile_DownloadCancelByName_Native(IntPtr assetFileName);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFile_GetList();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFile_Status(ulong assetFileID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFile_StatusById(ulong assetFileID);

		public static ulong ovr_AssetFile_StatusByName(string assetFileName)
		{
			IntPtr intPtr = StringToNative(assetFileName);
			ulong result = ovr_AssetFile_StatusByName_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AssetFile_StatusByName")]
		private static extern ulong ovr_AssetFile_StatusByName_Native(IntPtr assetFileName);

		public static ulong ovr_Avatar_UpdateMetaData(string avatarMetaData, string imageFilePath)
		{
			IntPtr intPtr = StringToNative(avatarMetaData);
			IntPtr intPtr2 = StringToNative(imageFilePath);
			ulong result = ovr_Avatar_UpdateMetaData_Native(intPtr, intPtr2);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Avatar_UpdateMetaData")]
		private static extern ulong ovr_Avatar_UpdateMetaData_Native(IntPtr avatarMetaData, IntPtr imageFilePath);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Cal_FinalizeApplication(ulong groupingObject, ulong[] userIDs, int numUserIDs, ulong finalized_application_ID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Cal_GetSuggestedApplications(ulong groupingObject, ulong[] userIDs, int numUserIDs);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Cal_ProposeApplication(ulong groupingObject, ulong[] userIDs, int numUserIDs, ulong proposed_application_ID);

		public static ulong ovr_CloudStorage_Delete(string bucket, string key)
		{
			IntPtr intPtr = StringToNative(bucket);
			IntPtr intPtr2 = StringToNative(key);
			ulong result = ovr_CloudStorage_Delete_Native(intPtr, intPtr2);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorage_Delete")]
		private static extern ulong ovr_CloudStorage_Delete_Native(IntPtr bucket, IntPtr key);

		public static ulong ovr_CloudStorage_Load(string bucket, string key)
		{
			IntPtr intPtr = StringToNative(bucket);
			IntPtr intPtr2 = StringToNative(key);
			ulong result = ovr_CloudStorage_Load_Native(intPtr, intPtr2);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorage_Load")]
		private static extern ulong ovr_CloudStorage_Load_Native(IntPtr bucket, IntPtr key);

		public static ulong ovr_CloudStorage_LoadBucketMetadata(string bucket)
		{
			IntPtr intPtr = StringToNative(bucket);
			ulong result = ovr_CloudStorage_LoadBucketMetadata_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorage_LoadBucketMetadata")]
		private static extern ulong ovr_CloudStorage_LoadBucketMetadata_Native(IntPtr bucket);

		public static ulong ovr_CloudStorage_LoadConflictMetadata(string bucket, string key)
		{
			IntPtr intPtr = StringToNative(bucket);
			IntPtr intPtr2 = StringToNative(key);
			ulong result = ovr_CloudStorage_LoadConflictMetadata_Native(intPtr, intPtr2);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorage_LoadConflictMetadata")]
		private static extern ulong ovr_CloudStorage_LoadConflictMetadata_Native(IntPtr bucket, IntPtr key);

		public static ulong ovr_CloudStorage_LoadHandle(string handle)
		{
			IntPtr intPtr = StringToNative(handle);
			ulong result = ovr_CloudStorage_LoadHandle_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorage_LoadHandle")]
		private static extern ulong ovr_CloudStorage_LoadHandle_Native(IntPtr handle);

		public static ulong ovr_CloudStorage_LoadMetadata(string bucket, string key)
		{
			IntPtr intPtr = StringToNative(bucket);
			IntPtr intPtr2 = StringToNative(key);
			ulong result = ovr_CloudStorage_LoadMetadata_Native(intPtr, intPtr2);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorage_LoadMetadata")]
		private static extern ulong ovr_CloudStorage_LoadMetadata_Native(IntPtr bucket, IntPtr key);

		public static ulong ovr_CloudStorage_ResolveKeepLocal(string bucket, string key, string remoteHandle)
		{
			IntPtr intPtr = StringToNative(bucket);
			IntPtr intPtr2 = StringToNative(key);
			IntPtr intPtr3 = StringToNative(remoteHandle);
			ulong result = ovr_CloudStorage_ResolveKeepLocal_Native(intPtr, intPtr2, intPtr3);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
			Marshal.FreeCoTaskMem(intPtr3);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorage_ResolveKeepLocal")]
		private static extern ulong ovr_CloudStorage_ResolveKeepLocal_Native(IntPtr bucket, IntPtr key, IntPtr remoteHandle);

		public static ulong ovr_CloudStorage_ResolveKeepRemote(string bucket, string key, string remoteHandle)
		{
			IntPtr intPtr = StringToNative(bucket);
			IntPtr intPtr2 = StringToNative(key);
			IntPtr intPtr3 = StringToNative(remoteHandle);
			ulong result = ovr_CloudStorage_ResolveKeepRemote_Native(intPtr, intPtr2, intPtr3);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
			Marshal.FreeCoTaskMem(intPtr3);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorage_ResolveKeepRemote")]
		private static extern ulong ovr_CloudStorage_ResolveKeepRemote_Native(IntPtr bucket, IntPtr key, IntPtr remoteHandle);

		public static ulong ovr_CloudStorage_Save(string bucket, string key, byte[] data, uint dataSize, long counter, string extraData)
		{
			IntPtr intPtr = StringToNative(bucket);
			IntPtr intPtr2 = StringToNative(key);
			IntPtr intPtr3 = StringToNative(extraData);
			ulong result = ovr_CloudStorage_Save_Native(intPtr, intPtr2, data, dataSize, counter, intPtr3);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
			Marshal.FreeCoTaskMem(intPtr3);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorage_Save")]
		private static extern ulong ovr_CloudStorage_Save_Native(IntPtr bucket, IntPtr key, byte[] data, uint dataSize, long counter, IntPtr extraData);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_CloudStorage2_GetUserDirectoryPath();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Colocation_GetCurrentMapUuid();

		public static ulong ovr_Colocation_RequestMap(string uuid)
		{
			IntPtr intPtr = StringToNative(uuid);
			ulong result = ovr_Colocation_RequestMap_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Colocation_RequestMap")]
		private static extern ulong ovr_Colocation_RequestMap_Native(IntPtr uuid);

		public static ulong ovr_Colocation_ShareMap(string uuid)
		{
			IntPtr intPtr = StringToNative(uuid);
			ulong result = ovr_Colocation_ShareMap_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Colocation_ShareMap")]
		private static extern ulong ovr_Colocation_ShareMap_Native(IntPtr uuid);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Entitlement_GetIsViewerEntitled();

		public static ulong ovr_GraphAPI_Get(string url)
		{
			IntPtr intPtr = StringToNative(url);
			ulong result = ovr_GraphAPI_Get_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_GraphAPI_Get")]
		private static extern ulong ovr_GraphAPI_Get_Native(IntPtr url);

		public static ulong ovr_GraphAPI_Post(string url)
		{
			IntPtr intPtr = StringToNative(url);
			ulong result = ovr_GraphAPI_Post_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_GraphAPI_Post")]
		private static extern ulong ovr_GraphAPI_Post_Native(IntPtr url);

		public static ulong ovr_HTTP_Get(string url)
		{
			IntPtr intPtr = StringToNative(url);
			ulong result = ovr_HTTP_Get_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_HTTP_Get")]
		private static extern ulong ovr_HTTP_Get_Native(IntPtr url);

		public static ulong ovr_HTTP_GetToFile(string url, string diskFile)
		{
			IntPtr intPtr = StringToNative(url);
			IntPtr intPtr2 = StringToNative(diskFile);
			ulong result = ovr_HTTP_GetToFile_Native(intPtr, intPtr2);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_HTTP_GetToFile")]
		private static extern ulong ovr_HTTP_GetToFile_Native(IntPtr url, IntPtr diskFile);

		public static ulong ovr_HTTP_MultiPartPost(string url, string filepath_param_name, string filepath, string access_token, ovrKeyValuePair[] post_params)
		{
			IntPtr intPtr = StringToNative(url);
			IntPtr intPtr2 = StringToNative(filepath_param_name);
			IntPtr intPtr3 = StringToNative(filepath);
			IntPtr intPtr4 = StringToNative(access_token);
			UIntPtr numItems = (UIntPtr)(ulong)post_params.Length;
			ulong result = ovr_HTTP_MultiPartPost_Native(intPtr, intPtr2, intPtr3, intPtr4, post_params, numItems);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
			Marshal.FreeCoTaskMem(intPtr3);
			Marshal.FreeCoTaskMem(intPtr4);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_HTTP_MultiPartPost")]
		private static extern ulong ovr_HTTP_MultiPartPost_Native(IntPtr url, IntPtr filepath_param_name, IntPtr filepath, IntPtr access_token, ovrKeyValuePair[] post_params, UIntPtr numItems);

		public static ulong ovr_HTTP_Post(string url)
		{
			IntPtr intPtr = StringToNative(url);
			ulong result = ovr_HTTP_Post_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_HTTP_Post")]
		private static extern ulong ovr_HTTP_Post_Native(IntPtr url);

		public static ulong ovr_IAP_ConsumePurchase(string sku)
		{
			IntPtr intPtr = StringToNative(sku);
			ulong result = ovr_IAP_ConsumePurchase_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_IAP_ConsumePurchase")]
		private static extern ulong ovr_IAP_ConsumePurchase_Native(IntPtr sku);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_IAP_GetProductsBySKU(string[] skus, int count);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_IAP_GetViewerPurchases();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_IAP_GetViewerPurchasesDurableCache();

		public static ulong ovr_IAP_LaunchCheckoutFlow(string sku)
		{
			IntPtr intPtr = StringToNative(sku);
			ulong result = ovr_IAP_LaunchCheckoutFlow_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_IAP_LaunchCheckoutFlow")]
		private static extern ulong ovr_IAP_LaunchCheckoutFlow_Native(IntPtr sku);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_LanguagePack_GetCurrent();

		public static ulong ovr_LanguagePack_SetCurrent(string tag)
		{
			IntPtr intPtr = StringToNative(tag);
			ulong result = ovr_LanguagePack_SetCurrent_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_LanguagePack_SetCurrent")]
		private static extern ulong ovr_LanguagePack_SetCurrent_Native(IntPtr tag);

		public static ulong ovr_Leaderboard_GetEntries(string leaderboardName, int limit, LeaderboardFilterType filter, LeaderboardStartAt startAt)
		{
			IntPtr intPtr = StringToNative(leaderboardName);
			ulong result = ovr_Leaderboard_GetEntries_Native(intPtr, limit, filter, startAt);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Leaderboard_GetEntries")]
		private static extern ulong ovr_Leaderboard_GetEntries_Native(IntPtr leaderboardName, int limit, LeaderboardFilterType filter, LeaderboardStartAt startAt);

		public static ulong ovr_Leaderboard_GetEntriesAfterRank(string leaderboardName, int limit, ulong afterRank)
		{
			IntPtr intPtr = StringToNative(leaderboardName);
			ulong result = ovr_Leaderboard_GetEntriesAfterRank_Native(intPtr, limit, afterRank);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Leaderboard_GetEntriesAfterRank")]
		private static extern ulong ovr_Leaderboard_GetEntriesAfterRank_Native(IntPtr leaderboardName, int limit, ulong afterRank);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Leaderboard_GetNextEntries(IntPtr handle);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Leaderboard_GetPreviousEntries(IntPtr handle);

		public static ulong ovr_Leaderboard_WriteEntry(string leaderboardName, long score, byte[] extraData, uint extraDataLength, bool forceUpdate)
		{
			IntPtr intPtr = StringToNative(leaderboardName);
			ulong result = ovr_Leaderboard_WriteEntry_Native(intPtr, score, extraData, extraDataLength, forceUpdate);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Leaderboard_WriteEntry")]
		private static extern ulong ovr_Leaderboard_WriteEntry_Native(IntPtr leaderboardName, long score, byte[] extraData, uint extraDataLength, bool forceUpdate);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Livestreaming_GetStatus();

		public static ulong ovr_Livestreaming_IsAllowedForApplication(string packageName)
		{
			IntPtr intPtr = StringToNative(packageName);
			ulong result = ovr_Livestreaming_IsAllowedForApplication_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Livestreaming_IsAllowedForApplication")]
		private static extern ulong ovr_Livestreaming_IsAllowedForApplication_Native(IntPtr packageName);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Livestreaming_PauseStream();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Livestreaming_ResumeStream();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Livestreaming_StartPartyStream();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Livestreaming_StartStream(LivestreamingAudience audience, LivestreamingMicrophoneStatus micStatus);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Livestreaming_StopPartyStream();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Livestreaming_StopStream();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Livestreaming_UpdateCommentsOverlayVisibility(bool isVisible);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Livestreaming_UpdateMicStatus(LivestreamingMicrophoneStatus micStatus);

		public static ulong ovr_Matchmaking_Browse(string pool, IntPtr customQueryData)
		{
			IntPtr intPtr = StringToNative(pool);
			ulong result = ovr_Matchmaking_Browse_Native(intPtr, customQueryData);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Matchmaking_Browse")]
		private static extern ulong ovr_Matchmaking_Browse_Native(IntPtr pool, IntPtr customQueryData);

		public static ulong ovr_Matchmaking_Browse2(string pool, IntPtr matchmakingOptions)
		{
			IntPtr intPtr = StringToNative(pool);
			ulong result = ovr_Matchmaking_Browse2_Native(intPtr, matchmakingOptions);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Matchmaking_Browse2")]
		private static extern ulong ovr_Matchmaking_Browse2_Native(IntPtr pool, IntPtr matchmakingOptions);

		public static ulong ovr_Matchmaking_Cancel(string pool, string requestHash)
		{
			IntPtr intPtr = StringToNative(pool);
			IntPtr intPtr2 = StringToNative(requestHash);
			ulong result = ovr_Matchmaking_Cancel_Native(intPtr, intPtr2);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Matchmaking_Cancel")]
		private static extern ulong ovr_Matchmaking_Cancel_Native(IntPtr pool, IntPtr requestHash);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Matchmaking_Cancel2();

		public static ulong ovr_Matchmaking_CreateAndEnqueueRoom(string pool, uint maxUsers, bool subscribeToUpdates, IntPtr customQueryData)
		{
			IntPtr intPtr = StringToNative(pool);
			ulong result = ovr_Matchmaking_CreateAndEnqueueRoom_Native(intPtr, maxUsers, subscribeToUpdates, customQueryData);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Matchmaking_CreateAndEnqueueRoom")]
		private static extern ulong ovr_Matchmaking_CreateAndEnqueueRoom_Native(IntPtr pool, uint maxUsers, bool subscribeToUpdates, IntPtr customQueryData);

		public static ulong ovr_Matchmaking_CreateAndEnqueueRoom2(string pool, IntPtr matchmakingOptions)
		{
			IntPtr intPtr = StringToNative(pool);
			ulong result = ovr_Matchmaking_CreateAndEnqueueRoom2_Native(intPtr, matchmakingOptions);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Matchmaking_CreateAndEnqueueRoom2")]
		private static extern ulong ovr_Matchmaking_CreateAndEnqueueRoom2_Native(IntPtr pool, IntPtr matchmakingOptions);

		public static ulong ovr_Matchmaking_CreateRoom(string pool, uint maxUsers, bool subscribeToUpdates)
		{
			IntPtr intPtr = StringToNative(pool);
			ulong result = ovr_Matchmaking_CreateRoom_Native(intPtr, maxUsers, subscribeToUpdates);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Matchmaking_CreateRoom")]
		private static extern ulong ovr_Matchmaking_CreateRoom_Native(IntPtr pool, uint maxUsers, bool subscribeToUpdates);

		public static ulong ovr_Matchmaking_CreateRoom2(string pool, IntPtr matchmakingOptions)
		{
			IntPtr intPtr = StringToNative(pool);
			ulong result = ovr_Matchmaking_CreateRoom2_Native(intPtr, matchmakingOptions);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Matchmaking_CreateRoom2")]
		private static extern ulong ovr_Matchmaking_CreateRoom2_Native(IntPtr pool, IntPtr matchmakingOptions);

		public static ulong ovr_Matchmaking_Enqueue(string pool, IntPtr customQueryData)
		{
			IntPtr intPtr = StringToNative(pool);
			ulong result = ovr_Matchmaking_Enqueue_Native(intPtr, customQueryData);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Matchmaking_Enqueue")]
		private static extern ulong ovr_Matchmaking_Enqueue_Native(IntPtr pool, IntPtr customQueryData);

		public static ulong ovr_Matchmaking_Enqueue2(string pool, IntPtr matchmakingOptions)
		{
			IntPtr intPtr = StringToNative(pool);
			ulong result = ovr_Matchmaking_Enqueue2_Native(intPtr, matchmakingOptions);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Matchmaking_Enqueue2")]
		private static extern ulong ovr_Matchmaking_Enqueue2_Native(IntPtr pool, IntPtr matchmakingOptions);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Matchmaking_EnqueueRoom(ulong roomID, IntPtr customQueryData);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Matchmaking_EnqueueRoom2(ulong roomID, IntPtr matchmakingOptions);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Matchmaking_GetAdminSnapshot();

		public static ulong ovr_Matchmaking_GetStats(string pool, uint maxLevel, MatchmakingStatApproach approach)
		{
			IntPtr intPtr = StringToNative(pool);
			ulong result = ovr_Matchmaking_GetStats_Native(intPtr, maxLevel, approach);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Matchmaking_GetStats")]
		private static extern ulong ovr_Matchmaking_GetStats_Native(IntPtr pool, uint maxLevel, MatchmakingStatApproach approach);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Matchmaking_JoinRoom(ulong roomID, bool subscribeToUpdates);

		public static ulong ovr_Matchmaking_ReportResultInsecure(ulong roomID, ovrKeyValuePair[] data)
		{
			UIntPtr numItems = (UIntPtr)(ulong)data.Length;
			return ovr_Matchmaking_ReportResultInsecure_Native(roomID, data, numItems);
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Matchmaking_ReportResultInsecure")]
		private static extern ulong ovr_Matchmaking_ReportResultInsecure_Native(ulong roomID, ovrKeyValuePair[] data, UIntPtr numItems);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Matchmaking_StartMatch(ulong roomID);

		public static ulong ovr_Media_ShareToFacebook(string postTextSuggestion, string filePath, MediaContentType contentType)
		{
			IntPtr intPtr = StringToNative(postTextSuggestion);
			IntPtr intPtr2 = StringToNative(filePath);
			ulong result = ovr_Media_ShareToFacebook_Native(intPtr, intPtr2, contentType);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Media_ShareToFacebook")]
		private static extern ulong ovr_Media_ShareToFacebook_Native(IntPtr postTextSuggestion, IntPtr filePath, MediaContentType contentType);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Notification_GetRoomInvites();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Notification_MarkAsRead(ulong notificationID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Party_Create();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Party_GatherInApplication(ulong partyID, ulong appID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Party_Get(ulong partyID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Party_GetCurrent();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Party_GetCurrentForUser(ulong userID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Party_Invite(ulong partyID, ulong userID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Party_Join(ulong partyID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Party_Leave(ulong partyID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_RichPresence_Clear();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_RichPresence_GetDestinations();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_RichPresence_Set(IntPtr richPresenceOptions);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_CreateAndJoinPrivate(RoomJoinPolicy joinPolicy, uint maxUsers, bool subscribeToUpdates);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_CreateAndJoinPrivate2(RoomJoinPolicy joinPolicy, uint maxUsers, IntPtr roomOptions);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_Get(ulong roomID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_GetCurrent();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_GetCurrentForUser(ulong userID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_GetInvitableUsers();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_GetInvitableUsers2(IntPtr roomOptions);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_GetModeratedRooms();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_GetSocialRooms(ulong appID);

		public static ulong ovr_Room_InviteUser(ulong roomID, string inviteToken)
		{
			IntPtr intPtr = StringToNative(inviteToken);
			ulong result = ovr_Room_InviteUser_Native(roomID, intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Room_InviteUser")]
		private static extern ulong ovr_Room_InviteUser_Native(ulong roomID, IntPtr inviteToken);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_Join(ulong roomID, bool subscribeToUpdates);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_Join2(ulong roomID, IntPtr roomOptions);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_KickUser(ulong roomID, ulong userID, int kickDurationSeconds);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_LaunchInvitableUserFlow(ulong roomID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_Leave(ulong roomID);

		public static ulong ovr_Room_SetDescription(ulong roomID, string description)
		{
			IntPtr intPtr = StringToNative(description);
			ulong result = ovr_Room_SetDescription_Native(roomID, intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Room_SetDescription")]
		private static extern ulong ovr_Room_SetDescription_Native(ulong roomID, IntPtr description);

		public static ulong ovr_Room_UpdateDataStore(ulong roomID, ovrKeyValuePair[] data)
		{
			UIntPtr numItems = (UIntPtr)(ulong)data.Length;
			return ovr_Room_UpdateDataStore_Native(roomID, data, numItems);
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Room_UpdateDataStore")]
		private static extern ulong ovr_Room_UpdateDataStore_Native(ulong roomID, ovrKeyValuePair[] data, UIntPtr numItems);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_UpdateMembershipLockStatus(ulong roomID, RoomMembershipLockStatus membershipLockStatus);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_UpdateOwner(ulong roomID, ulong userID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_UpdatePrivateRoomJoinPolicy(ulong roomID, RoomJoinPolicy newJoinPolicy);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_SystemPermissions_GetStatus(PermissionType permType);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_SystemPermissions_LaunchDeeplink(PermissionType permType);

		public static ulong ovr_User_CancelRecordingForReportFlow(string recordingUUID)
		{
			IntPtr intPtr = StringToNative(recordingUUID);
			ulong result = ovr_User_CancelRecordingForReportFlow_Native(intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_User_CancelRecordingForReportFlow")]
		private static extern ulong ovr_User_CancelRecordingForReportFlow_Native(IntPtr recordingUUID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_Get(ulong userID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_GetAccessToken();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_GetLinkedAccounts(IntPtr userOptions);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_GetLoggedInUser();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_GetLoggedInUserFriends();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_GetLoggedInUserFriendsAndRooms();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_GetLoggedInUserRecentlyMetUsersAndRooms(IntPtr userOptions);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_GetOrgScopedID(ulong userID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_GetSdkAccounts();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_GetUserProof();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_LaunchBlockFlow(ulong userID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_LaunchFriendRequestFlow(ulong userID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_LaunchProfile(ulong userID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_LaunchReportFlow(ulong userID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_LaunchReportFlow2(ulong optionalUserID, IntPtr abuseReportOptions);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_LaunchUnblockFlow(ulong userID);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_NewEntitledTestUser();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_NewTestUser();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_NewTestUserFriends();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_StartRecordingForReportFlow();

		public static ulong ovr_User_StopRecordingAndLaunchReportFlow(ulong optionalUserID, string optionalRecordingUUID)
		{
			IntPtr intPtr = StringToNative(optionalRecordingUUID);
			ulong result = ovr_User_StopRecordingAndLaunchReportFlow_Native(optionalUserID, intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_User_StopRecordingAndLaunchReportFlow")]
		private static extern ulong ovr_User_StopRecordingAndLaunchReportFlow_Native(ulong optionalUserID, IntPtr optionalRecordingUUID);

		public static ulong ovr_User_StopRecordingAndLaunchReportFlow2(ulong optionalUserID, string optionalRecordingUUID, IntPtr abuseReportOptions)
		{
			IntPtr intPtr = StringToNative(optionalRecordingUUID);
			ulong result = ovr_User_StopRecordingAndLaunchReportFlow2_Native(optionalUserID, intPtr, abuseReportOptions);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_User_StopRecordingAndLaunchReportFlow2")]
		private static extern ulong ovr_User_StopRecordingAndLaunchReportFlow2_Native(ulong optionalUserID, IntPtr optionalRecordingUUID, IntPtr abuseReportOptions);

		public static ulong ovr_User_TestUserCreateDeviceManifest(string deviceID, ulong[] appIDs, int numAppIDs)
		{
			IntPtr intPtr = StringToNative(deviceID);
			ulong result = ovr_User_TestUserCreateDeviceManifest_Native(intPtr, appIDs, numAppIDs);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_User_TestUserCreateDeviceManifest")]
		private static extern ulong ovr_User_TestUserCreateDeviceManifest_Native(IntPtr deviceID, ulong[] appIDs, int numAppIDs);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Voip_SetSystemVoipSuppressed(bool suppressed);

		public static string ovr_AbuseReportRecording_GetRecordingUuid(IntPtr obj)
		{
			return StringFromNative(ovr_AbuseReportRecording_GetRecordingUuid_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AbuseReportRecording_GetRecordingUuid")]
		private static extern IntPtr ovr_AbuseReportRecording_GetRecordingUuid_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_AchievementDefinition_GetBitfieldLength(IntPtr obj);

		public static string ovr_AchievementDefinition_GetName(IntPtr obj)
		{
			return StringFromNative(ovr_AchievementDefinition_GetName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AchievementDefinition_GetName")]
		private static extern IntPtr ovr_AchievementDefinition_GetName_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AchievementDefinition_GetTarget(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern AchievementType ovr_AchievementDefinition_GetType(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_AchievementDefinitionArray_GetElement(IntPtr obj, UIntPtr index);

		public static string ovr_AchievementDefinitionArray_GetNextUrl(IntPtr obj)
		{
			return StringFromNative(ovr_AchievementDefinitionArray_GetNextUrl_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AchievementDefinitionArray_GetNextUrl")]
		private static extern IntPtr ovr_AchievementDefinitionArray_GetNextUrl_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_AchievementDefinitionArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_AchievementDefinitionArray_HasNextPage(IntPtr obj);

		public static string ovr_AchievementProgress_GetBitfield(IntPtr obj)
		{
			return StringFromNative(ovr_AchievementProgress_GetBitfield_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AchievementProgress_GetBitfield")]
		private static extern IntPtr ovr_AchievementProgress_GetBitfield_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AchievementProgress_GetCount(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_AchievementProgress_GetIsUnlocked(IntPtr obj);

		public static string ovr_AchievementProgress_GetName(IntPtr obj)
		{
			return StringFromNative(ovr_AchievementProgress_GetName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AchievementProgress_GetName")]
		private static extern IntPtr ovr_AchievementProgress_GetName_Native(IntPtr obj);

		public static DateTime ovr_AchievementProgress_GetUnlockTime(IntPtr obj)
		{
			return DateTimeFromNative(ovr_AchievementProgress_GetUnlockTime_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AchievementProgress_GetUnlockTime")]
		private static extern ulong ovr_AchievementProgress_GetUnlockTime_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_AchievementProgressArray_GetElement(IntPtr obj, UIntPtr index);

		public static string ovr_AchievementProgressArray_GetNextUrl(IntPtr obj)
		{
			return StringFromNative(ovr_AchievementProgressArray_GetNextUrl_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AchievementProgressArray_GetNextUrl")]
		private static extern IntPtr ovr_AchievementProgressArray_GetNextUrl_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_AchievementProgressArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_AchievementProgressArray_HasNextPage(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_AchievementUpdate_GetJustUnlocked(IntPtr obj);

		public static string ovr_AchievementUpdate_GetName(IntPtr obj)
		{
			return StringFromNative(ovr_AchievementUpdate_GetName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AchievementUpdate_GetName")]
		private static extern IntPtr ovr_AchievementUpdate_GetName_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Application_GetID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern int ovr_ApplicationVersion_GetCurrentCode(IntPtr obj);

		public static string ovr_ApplicationVersion_GetCurrentName(IntPtr obj)
		{
			return StringFromNative(ovr_ApplicationVersion_GetCurrentName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_ApplicationVersion_GetCurrentName")]
		private static extern IntPtr ovr_ApplicationVersion_GetCurrentName_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern int ovr_ApplicationVersion_GetLatestCode(IntPtr obj);

		public static string ovr_ApplicationVersion_GetLatestName(IntPtr obj)
		{
			return StringFromNative(ovr_ApplicationVersion_GetLatestName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_ApplicationVersion_GetLatestName")]
		private static extern IntPtr ovr_ApplicationVersion_GetLatestName_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetDetails_GetAssetId(IntPtr obj);

		public static string ovr_AssetDetails_GetAssetType(IntPtr obj)
		{
			return StringFromNative(ovr_AssetDetails_GetAssetType_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AssetDetails_GetAssetType")]
		private static extern IntPtr ovr_AssetDetails_GetAssetType_Native(IntPtr obj);

		public static string ovr_AssetDetails_GetDownloadStatus(IntPtr obj)
		{
			return StringFromNative(ovr_AssetDetails_GetDownloadStatus_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AssetDetails_GetDownloadStatus")]
		private static extern IntPtr ovr_AssetDetails_GetDownloadStatus_Native(IntPtr obj);

		public static string ovr_AssetDetails_GetFilepath(IntPtr obj)
		{
			return StringFromNative(ovr_AssetDetails_GetFilepath_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AssetDetails_GetFilepath")]
		private static extern IntPtr ovr_AssetDetails_GetFilepath_Native(IntPtr obj);

		public static string ovr_AssetDetails_GetIapStatus(IntPtr obj)
		{
			return StringFromNative(ovr_AssetDetails_GetIapStatus_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AssetDetails_GetIapStatus")]
		private static extern IntPtr ovr_AssetDetails_GetIapStatus_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_AssetDetails_GetLanguage(IntPtr obj);

		public static string ovr_AssetDetails_GetMetadata(IntPtr obj)
		{
			return StringFromNative(ovr_AssetDetails_GetMetadata_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AssetDetails_GetMetadata")]
		private static extern IntPtr ovr_AssetDetails_GetMetadata_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_AssetDetailsArray_GetElement(IntPtr obj, UIntPtr index);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_AssetDetailsArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFileDeleteResult_GetAssetFileId(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFileDeleteResult_GetAssetId(IntPtr obj);

		public static string ovr_AssetFileDeleteResult_GetFilepath(IntPtr obj)
		{
			return StringFromNative(ovr_AssetFileDeleteResult_GetFilepath_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AssetFileDeleteResult_GetFilepath")]
		private static extern IntPtr ovr_AssetFileDeleteResult_GetFilepath_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_AssetFileDeleteResult_GetSuccess(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFileDownloadCancelResult_GetAssetFileId(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFileDownloadCancelResult_GetAssetId(IntPtr obj);

		public static string ovr_AssetFileDownloadCancelResult_GetFilepath(IntPtr obj)
		{
			return StringFromNative(ovr_AssetFileDownloadCancelResult_GetFilepath_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AssetFileDownloadCancelResult_GetFilepath")]
		private static extern IntPtr ovr_AssetFileDownloadCancelResult_GetFilepath_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_AssetFileDownloadCancelResult_GetSuccess(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFileDownloadResult_GetAssetId(IntPtr obj);

		public static string ovr_AssetFileDownloadResult_GetFilepath(IntPtr obj)
		{
			return StringFromNative(ovr_AssetFileDownloadResult_GetFilepath_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_AssetFileDownloadResult_GetFilepath")]
		private static extern IntPtr ovr_AssetFileDownloadResult_GetFilepath_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFileDownloadUpdate_GetAssetFileId(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_AssetFileDownloadUpdate_GetAssetId(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_AssetFileDownloadUpdate_GetBytesTotal(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern int ovr_AssetFileDownloadUpdate_GetBytesTransferred(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_AssetFileDownloadUpdate_GetCompleted(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern int ovr_CalApplicationFinalized_GetCountdownMS(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_CalApplicationFinalized_GetID(IntPtr obj);

		public static string ovr_CalApplicationFinalized_GetLaunchDetails(IntPtr obj)
		{
			return StringFromNative(ovr_CalApplicationFinalized_GetLaunchDetails_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CalApplicationFinalized_GetLaunchDetails")]
		private static extern IntPtr ovr_CalApplicationFinalized_GetLaunchDetails_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_CalApplicationProposed_GetID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_CalApplicationSuggestion_GetID(IntPtr obj);

		public static string ovr_CalApplicationSuggestion_GetSocialContext(IntPtr obj)
		{
			return StringFromNative(ovr_CalApplicationSuggestion_GetSocialContext_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CalApplicationSuggestion_GetSocialContext")]
		private static extern IntPtr ovr_CalApplicationSuggestion_GetSocialContext_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_CalApplicationSuggestionArray_GetElement(IntPtr obj, UIntPtr index);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_CalApplicationSuggestionArray_GetSize(IntPtr obj);

		public static string ovr_CloudStorage2UserDirectoryPathResponse_GetPath(IntPtr obj)
		{
			return StringFromNative(ovr_CloudStorage2UserDirectoryPathResponse_GetPath_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorage2UserDirectoryPathResponse_GetPath")]
		private static extern IntPtr ovr_CloudStorage2UserDirectoryPathResponse_GetPath_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_CloudStorageConflictMetadata_GetLocal(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_CloudStorageConflictMetadata_GetRemote(IntPtr obj);

		public static string ovr_CloudStorageData_GetBucket(IntPtr obj)
		{
			return StringFromNative(ovr_CloudStorageData_GetBucket_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorageData_GetBucket")]
		private static extern IntPtr ovr_CloudStorageData_GetBucket_Native(IntPtr obj);

		public static byte[] ovr_CloudStorageData_GetData(IntPtr obj)
		{
			return FiledataFromNative(ovr_CloudStorageData_GetDataSize(obj), ovr_CloudStorageData_GetData_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorageData_GetData")]
		private static extern IntPtr ovr_CloudStorageData_GetData_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_CloudStorageData_GetDataSize(IntPtr obj);

		public static string ovr_CloudStorageData_GetKey(IntPtr obj)
		{
			return StringFromNative(ovr_CloudStorageData_GetKey_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorageData_GetKey")]
		private static extern IntPtr ovr_CloudStorageData_GetKey_Native(IntPtr obj);

		public static string ovr_CloudStorageMetadata_GetBucket(IntPtr obj)
		{
			return StringFromNative(ovr_CloudStorageMetadata_GetBucket_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorageMetadata_GetBucket")]
		private static extern IntPtr ovr_CloudStorageMetadata_GetBucket_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern long ovr_CloudStorageMetadata_GetCounter(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_CloudStorageMetadata_GetDataSize(IntPtr obj);

		public static string ovr_CloudStorageMetadata_GetExtraData(IntPtr obj)
		{
			return StringFromNative(ovr_CloudStorageMetadata_GetExtraData_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorageMetadata_GetExtraData")]
		private static extern IntPtr ovr_CloudStorageMetadata_GetExtraData_Native(IntPtr obj);

		public static string ovr_CloudStorageMetadata_GetKey(IntPtr obj)
		{
			return StringFromNative(ovr_CloudStorageMetadata_GetKey_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorageMetadata_GetKey")]
		private static extern IntPtr ovr_CloudStorageMetadata_GetKey_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_CloudStorageMetadata_GetSaveTime(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern CloudStorageDataStatus ovr_CloudStorageMetadata_GetStatus(IntPtr obj);

		public static string ovr_CloudStorageMetadata_GetVersionHandle(IntPtr obj)
		{
			return StringFromNative(ovr_CloudStorageMetadata_GetVersionHandle_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorageMetadata_GetVersionHandle")]
		private static extern IntPtr ovr_CloudStorageMetadata_GetVersionHandle_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_CloudStorageMetadataArray_GetElement(IntPtr obj, UIntPtr index);

		public static string ovr_CloudStorageMetadataArray_GetNextUrl(IntPtr obj)
		{
			return StringFromNative(ovr_CloudStorageMetadataArray_GetNextUrl_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorageMetadataArray_GetNextUrl")]
		private static extern IntPtr ovr_CloudStorageMetadataArray_GetNextUrl_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_CloudStorageMetadataArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_CloudStorageMetadataArray_HasNextPage(IntPtr obj);

		public static string ovr_CloudStorageUpdateResponse_GetBucket(IntPtr obj)
		{
			return StringFromNative(ovr_CloudStorageUpdateResponse_GetBucket_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorageUpdateResponse_GetBucket")]
		private static extern IntPtr ovr_CloudStorageUpdateResponse_GetBucket_Native(IntPtr obj);

		public static string ovr_CloudStorageUpdateResponse_GetKey(IntPtr obj)
		{
			return StringFromNative(ovr_CloudStorageUpdateResponse_GetKey_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorageUpdateResponse_GetKey")]
		private static extern IntPtr ovr_CloudStorageUpdateResponse_GetKey_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern CloudStorageUpdateStatus ovr_CloudStorageUpdateResponse_GetStatus(IntPtr obj);

		public static string ovr_CloudStorageUpdateResponse_GetVersionHandle(IntPtr obj)
		{
			return StringFromNative(ovr_CloudStorageUpdateResponse_GetVersionHandle_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_CloudStorageUpdateResponse_GetVersionHandle")]
		private static extern IntPtr ovr_CloudStorageUpdateResponse_GetVersionHandle_Native(IntPtr obj);

		public static uint ovr_DataStore_Contains(IntPtr obj, string key)
		{
			IntPtr intPtr = StringToNative(key);
			uint result = ovr_DataStore_Contains_Native(obj, intPtr);
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_DataStore_Contains")]
		private static extern uint ovr_DataStore_Contains_Native(IntPtr obj, IntPtr key);

		public static string ovr_DataStore_GetKey(IntPtr obj, int index)
		{
			return StringFromNative(ovr_DataStore_GetKey_Native(obj, index));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_DataStore_GetKey")]
		private static extern IntPtr ovr_DataStore_GetKey_Native(IntPtr obj, int index);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_DataStore_GetNumKeys(IntPtr obj);

		public static string ovr_DataStore_GetValue(IntPtr obj, string key)
		{
			IntPtr intPtr = StringToNative(key);
			string result = StringFromNative(ovr_DataStore_GetValue_Native(obj, intPtr));
			Marshal.FreeCoTaskMem(intPtr);
			return result;
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_DataStore_GetValue")]
		private static extern IntPtr ovr_DataStore_GetValue_Native(IntPtr obj, IntPtr key);

		public static string ovr_Destination_GetApiName(IntPtr obj)
		{
			return StringFromNative(ovr_Destination_GetApiName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Destination_GetApiName")]
		private static extern IntPtr ovr_Destination_GetApiName_Native(IntPtr obj);

		public static string ovr_Destination_GetDeeplinkMessage(IntPtr obj)
		{
			return StringFromNative(ovr_Destination_GetDeeplinkMessage_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Destination_GetDeeplinkMessage")]
		private static extern IntPtr ovr_Destination_GetDeeplinkMessage_Native(IntPtr obj);

		public static string ovr_Destination_GetDisplayName(IntPtr obj)
		{
			return StringFromNative(ovr_Destination_GetDisplayName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Destination_GetDisplayName")]
		private static extern IntPtr ovr_Destination_GetDisplayName_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_DestinationArray_GetElement(IntPtr obj, UIntPtr index);

		public static string ovr_DestinationArray_GetNextUrl(IntPtr obj)
		{
			return StringFromNative(ovr_DestinationArray_GetNextUrl_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_DestinationArray_GetNextUrl")]
		private static extern IntPtr ovr_DestinationArray_GetNextUrl_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_DestinationArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_DestinationArray_HasNextPage(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern int ovr_Error_GetCode(IntPtr obj);

		public static string ovr_Error_GetDisplayableMessage(IntPtr obj)
		{
			return StringFromNative(ovr_Error_GetDisplayableMessage_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Error_GetDisplayableMessage")]
		private static extern IntPtr ovr_Error_GetDisplayableMessage_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern int ovr_Error_GetHttpCode(IntPtr obj);

		public static string ovr_Error_GetMessage(IntPtr obj)
		{
			return StringFromNative(ovr_Error_GetMessage_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Error_GetMessage")]
		private static extern IntPtr ovr_Error_GetMessage_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_HttpTransferUpdate_GetBytes(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_HttpTransferUpdate_GetID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_HttpTransferUpdate_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_HttpTransferUpdate_IsCompleted(IntPtr obj);

		public static string ovr_InstalledApplication_GetApplicationId(IntPtr obj)
		{
			return StringFromNative(ovr_InstalledApplication_GetApplicationId_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_InstalledApplication_GetApplicationId")]
		private static extern IntPtr ovr_InstalledApplication_GetApplicationId_Native(IntPtr obj);

		public static string ovr_InstalledApplication_GetPackageName(IntPtr obj)
		{
			return StringFromNative(ovr_InstalledApplication_GetPackageName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_InstalledApplication_GetPackageName")]
		private static extern IntPtr ovr_InstalledApplication_GetPackageName_Native(IntPtr obj);

		public static string ovr_InstalledApplication_GetStatus(IntPtr obj)
		{
			return StringFromNative(ovr_InstalledApplication_GetStatus_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_InstalledApplication_GetStatus")]
		private static extern IntPtr ovr_InstalledApplication_GetStatus_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern int ovr_InstalledApplication_GetVersionCode(IntPtr obj);

		public static string ovr_InstalledApplication_GetVersionName(IntPtr obj)
		{
			return StringFromNative(ovr_InstalledApplication_GetVersionName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_InstalledApplication_GetVersionName")]
		private static extern IntPtr ovr_InstalledApplication_GetVersionName_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_InstalledApplicationArray_GetElement(IntPtr obj, UIntPtr index);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_InstalledApplicationArray_GetSize(IntPtr obj);

		public static string ovr_LanguagePackInfo_GetEnglishName(IntPtr obj)
		{
			return StringFromNative(ovr_LanguagePackInfo_GetEnglishName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_LanguagePackInfo_GetEnglishName")]
		private static extern IntPtr ovr_LanguagePackInfo_GetEnglishName_Native(IntPtr obj);

		public static string ovr_LanguagePackInfo_GetNativeName(IntPtr obj)
		{
			return StringFromNative(ovr_LanguagePackInfo_GetNativeName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_LanguagePackInfo_GetNativeName")]
		private static extern IntPtr ovr_LanguagePackInfo_GetNativeName_Native(IntPtr obj);

		public static string ovr_LanguagePackInfo_GetTag(IntPtr obj)
		{
			return StringFromNative(ovr_LanguagePackInfo_GetTag_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_LanguagePackInfo_GetTag")]
		private static extern IntPtr ovr_LanguagePackInfo_GetTag_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_LaunchBlockFlowResult_GetDidBlock(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_LaunchBlockFlowResult_GetDidCancel(IntPtr obj);

		public static string ovr_LaunchDetails_GetDeeplinkMessage(IntPtr obj)
		{
			return StringFromNative(ovr_LaunchDetails_GetDeeplinkMessage_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_LaunchDetails_GetDeeplinkMessage")]
		private static extern IntPtr ovr_LaunchDetails_GetDeeplinkMessage_Native(IntPtr obj);

		public static string ovr_LaunchDetails_GetDestinationApiName(IntPtr obj)
		{
			return StringFromNative(ovr_LaunchDetails_GetDestinationApiName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_LaunchDetails_GetDestinationApiName")]
		private static extern IntPtr ovr_LaunchDetails_GetDestinationApiName_Native(IntPtr obj);

		public static string ovr_LaunchDetails_GetLaunchSource(IntPtr obj)
		{
			return StringFromNative(ovr_LaunchDetails_GetLaunchSource_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_LaunchDetails_GetLaunchSource")]
		private static extern IntPtr ovr_LaunchDetails_GetLaunchSource_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern LaunchType ovr_LaunchDetails_GetLaunchType(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_LaunchDetails_GetRoomID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_LaunchDetails_GetUsers(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_LaunchFriendRequestFlowResult_GetDidCancel(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_LaunchFriendRequestFlowResult_GetDidSendRequest(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_LaunchReportFlowResult_GetDidCancel(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_LaunchReportFlowResult_GetUserReportId(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_LaunchUnblockFlowResult_GetDidCancel(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_LaunchUnblockFlowResult_GetDidUnblock(IntPtr obj);

		public static byte[] ovr_LeaderboardEntry_GetExtraData(IntPtr obj)
		{
			return BlobFromNative(ovr_LeaderboardEntry_GetExtraDataLength(obj), ovr_LeaderboardEntry_GetExtraData_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_LeaderboardEntry_GetExtraData")]
		private static extern IntPtr ovr_LeaderboardEntry_GetExtraData_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_LeaderboardEntry_GetExtraDataLength(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern int ovr_LeaderboardEntry_GetRank(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern long ovr_LeaderboardEntry_GetScore(IntPtr obj);

		public static DateTime ovr_LeaderboardEntry_GetTimestamp(IntPtr obj)
		{
			return DateTimeFromNative(ovr_LeaderboardEntry_GetTimestamp_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_LeaderboardEntry_GetTimestamp")]
		private static extern ulong ovr_LeaderboardEntry_GetTimestamp_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_LeaderboardEntry_GetUser(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_LeaderboardEntryArray_GetElement(IntPtr obj, UIntPtr index);

		public static string ovr_LeaderboardEntryArray_GetNextUrl(IntPtr obj)
		{
			return StringFromNative(ovr_LeaderboardEntryArray_GetNextUrl_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_LeaderboardEntryArray_GetNextUrl")]
		private static extern IntPtr ovr_LeaderboardEntryArray_GetNextUrl_Native(IntPtr obj);

		public static string ovr_LeaderboardEntryArray_GetPreviousUrl(IntPtr obj)
		{
			return StringFromNative(ovr_LeaderboardEntryArray_GetPreviousUrl_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_LeaderboardEntryArray_GetPreviousUrl")]
		private static extern IntPtr ovr_LeaderboardEntryArray_GetPreviousUrl_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_LeaderboardEntryArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_LeaderboardEntryArray_GetTotalCount(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_LeaderboardEntryArray_HasNextPage(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_LeaderboardEntryArray_HasPreviousPage(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_LeaderboardUpdateStatus_GetDidUpdate(IntPtr obj);

		public static string ovr_LinkedAccount_GetAccessToken(IntPtr obj)
		{
			return StringFromNative(ovr_LinkedAccount_GetAccessToken_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_LinkedAccount_GetAccessToken")]
		private static extern IntPtr ovr_LinkedAccount_GetAccessToken_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ServiceProvider ovr_LinkedAccount_GetServiceProvider(IntPtr obj);

		public static string ovr_LinkedAccount_GetUserId(IntPtr obj)
		{
			return StringFromNative(ovr_LinkedAccount_GetUserId_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_LinkedAccount_GetUserId")]
		private static extern IntPtr ovr_LinkedAccount_GetUserId_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_LinkedAccountArray_GetElement(IntPtr obj, UIntPtr index);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_LinkedAccountArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_LivestreamingApplicationStatus_GetStreamingEnabled(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern LivestreamingStartStatus ovr_LivestreamingStartResult_GetStreamingResult(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_LivestreamingStatus_GetCommentsVisible(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_LivestreamingStatus_GetIsPaused(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_LivestreamingStatus_GetLivestreamingEnabled(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern int ovr_LivestreamingStatus_GetLivestreamingType(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_LivestreamingStatus_GetMicEnabled(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern int ovr_LivestreamingVideoStats_GetCommentCount(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern int ovr_LivestreamingVideoStats_GetReactionCount(IntPtr obj);

		public static string ovr_LivestreamingVideoStats_GetTotalViews(IntPtr obj)
		{
			return StringFromNative(ovr_LivestreamingVideoStats_GetTotalViews_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_LivestreamingVideoStats_GetTotalViews")]
		private static extern IntPtr ovr_LivestreamingVideoStats_GetTotalViews_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_MatchmakingAdminSnapshot_GetCandidates(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern double ovr_MatchmakingAdminSnapshot_GetMyCurrentThreshold(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_MatchmakingAdminSnapshotCandidate_GetCanMatch(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern double ovr_MatchmakingAdminSnapshotCandidate_GetMyTotalScore(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern double ovr_MatchmakingAdminSnapshotCandidate_GetTheirCurrentThreshold(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern double ovr_MatchmakingAdminSnapshotCandidate_GetTheirTotalScore(IntPtr obj);

		public static string ovr_MatchmakingAdminSnapshotCandidate_GetTraceId(IntPtr obj)
		{
			return StringFromNative(ovr_MatchmakingAdminSnapshotCandidate_GetTraceId_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_MatchmakingAdminSnapshotCandidate_GetTraceId")]
		private static extern IntPtr ovr_MatchmakingAdminSnapshotCandidate_GetTraceId_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_MatchmakingAdminSnapshotCandidateArray_GetElement(IntPtr obj, UIntPtr index);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_MatchmakingAdminSnapshotCandidateArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_MatchmakingBrowseResult_GetEnqueueResult(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_MatchmakingBrowseResult_GetRooms(IntPtr obj);

		public static string ovr_MatchmakingCandidate_GetEntryHash(IntPtr obj)
		{
			return StringFromNative(ovr_MatchmakingCandidate_GetEntryHash_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_MatchmakingCandidate_GetEntryHash")]
		private static extern IntPtr ovr_MatchmakingCandidate_GetEntryHash_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_MatchmakingCandidate_GetUserId(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_MatchmakingCandidateArray_GetElement(IntPtr obj, UIntPtr index);

		public static string ovr_MatchmakingCandidateArray_GetNextUrl(IntPtr obj)
		{
			return StringFromNative(ovr_MatchmakingCandidateArray_GetNextUrl_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_MatchmakingCandidateArray_GetNextUrl")]
		private static extern IntPtr ovr_MatchmakingCandidateArray_GetNextUrl_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_MatchmakingCandidateArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_MatchmakingCandidateArray_HasNextPage(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_MatchmakingEnqueueResult_GetAdminSnapshot(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_MatchmakingEnqueueResult_GetAverageWait(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_MatchmakingEnqueueResult_GetMatchesInLastHourCount(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_MatchmakingEnqueueResult_GetMaxExpectedWait(IntPtr obj);

		public static string ovr_MatchmakingEnqueueResult_GetPool(IntPtr obj)
		{
			return StringFromNative(ovr_MatchmakingEnqueueResult_GetPool_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_MatchmakingEnqueueResult_GetPool")]
		private static extern IntPtr ovr_MatchmakingEnqueueResult_GetPool_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_MatchmakingEnqueueResult_GetRecentMatchPercentage(IntPtr obj);

		public static string ovr_MatchmakingEnqueueResult_GetRequestHash(IntPtr obj)
		{
			return StringFromNative(ovr_MatchmakingEnqueueResult_GetRequestHash_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_MatchmakingEnqueueResult_GetRequestHash")]
		private static extern IntPtr ovr_MatchmakingEnqueueResult_GetRequestHash_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_MatchmakingEnqueueResultAndRoom_GetMatchmakingEnqueueResult(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_MatchmakingEnqueueResultAndRoom_GetRoom(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_MatchmakingEnqueuedUser_GetAdditionalUserID(IntPtr obj, uint index);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_MatchmakingEnqueuedUser_GetAdditionalUserIDsSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_MatchmakingEnqueuedUser_GetCustomData(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_MatchmakingEnqueuedUser_GetUser(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_MatchmakingEnqueuedUserArray_GetElement(IntPtr obj, UIntPtr index);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_MatchmakingEnqueuedUserArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_MatchmakingNotification_GetAddedByUserId(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_MatchmakingNotification_GetRoom(IntPtr obj);

		public static string ovr_MatchmakingNotification_GetTraceId(IntPtr obj)
		{
			return StringFromNative(ovr_MatchmakingNotification_GetTraceId_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_MatchmakingNotification_GetTraceId")]
		private static extern IntPtr ovr_MatchmakingNotification_GetTraceId_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_MatchmakingRoom_GetPingTime(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_MatchmakingRoom_GetRoom(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_MatchmakingRoom_HasPingTime(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_MatchmakingRoomArray_GetElement(IntPtr obj, UIntPtr index);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_MatchmakingRoomArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_MatchmakingStats_GetDrawCount(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_MatchmakingStats_GetLossCount(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_MatchmakingStats_GetSkillLevel(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern double ovr_MatchmakingStats_GetSkillMean(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern double ovr_MatchmakingStats_GetSkillStandardDeviation(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_MatchmakingStats_GetWinCount(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetAbuseReportRecording(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetAchievementDefinitionArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetAchievementProgressArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetAchievementUpdate(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetApplicationVersion(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetAssetDetails(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetAssetDetailsArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetAssetFileDeleteResult(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetAssetFileDownloadCancelResult(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetAssetFileDownloadResult(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetAssetFileDownloadUpdate(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetCalApplicationFinalized(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetCalApplicationProposed(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetCalApplicationSuggestionArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetCloudStorageConflictMetadata(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetCloudStorageData(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetCloudStorageMetadata(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetCloudStorageMetadataArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetCloudStorageUpdateResponse(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetDestinationArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetError(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetHttpTransferUpdate(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetInstalledApplicationArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetLaunchBlockFlowResult(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetLaunchFriendRequestFlowResult(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetLaunchReportFlowResult(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetLaunchUnblockFlowResult(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetLeaderboardEntryArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetLeaderboardUpdateStatus(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetLinkedAccountArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetLivestreamingApplicationStatus(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetLivestreamingStartResult(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetLivestreamingStatus(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetLivestreamingVideoStats(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetMatchmakingAdminSnapshot(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetMatchmakingBrowseResult(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetMatchmakingEnqueueResult(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetMatchmakingEnqueueResultAndRoom(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetMatchmakingRoomArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetMatchmakingStats(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetNativeMessage(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetNetworkingPeer(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetOrgScopedID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetParty(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetPartyID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetPartyUpdateNotification(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetPidArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetPingResult(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetPlatformInitialize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetProductArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetPurchase(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetPurchaseArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Message_GetRequestID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetRoom(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetRoomArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetRoomInviteNotification(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetRoomInviteNotificationArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetSdkAccountArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetShareMediaResult(IntPtr obj);

		public static string ovr_Message_GetString(IntPtr obj)
		{
			return StringFromNative(ovr_Message_GetString_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Message_GetString")]
		private static extern IntPtr ovr_Message_GetString_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetSystemPermission(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetSystemVoipState(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern Message.MessageType ovr_Message_GetType(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetUser(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetUserAndRoomArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetUserArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetUserProof(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Message_GetUserReportID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_Message_IsError(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_Microphone_GetNumSamplesAvailable(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_Microphone_GetOutputBufferMaxSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_Microphone_GetPCM(IntPtr obj, short[] outputBuffer, UIntPtr outputBufferNumElements);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_Microphone_GetPCMFloat(IntPtr obj, float[] outputBuffer, UIntPtr outputBufferNumElements);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_Microphone_ReadData(IntPtr obj, float[] outputBuffer, UIntPtr outputBufferSize);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Microphone_SetAcceptableRecordingDelayHint(IntPtr obj, UIntPtr delayMs);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Microphone_Start(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Microphone_Stop(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_NetworkingPeer_GetID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern PeerConnectionState ovr_NetworkingPeer_GetState(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_OrgScopedID_GetID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_Packet_Free(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Packet_GetBytes(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern SendPolicy ovr_Packet_GetSendPolicy(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Packet_GetSenderID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_Packet_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Party_GetID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Party_GetInvitedUsers(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Party_GetLeader(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Party_GetRoom(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Party_GetUsers(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_PartyID_GetID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern PartyUpdateAction ovr_PartyUpdateNotification_GetAction(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_PartyUpdateNotification_GetPartyId(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_PartyUpdateNotification_GetSenderId(IntPtr obj);

		public static string ovr_PartyUpdateNotification_GetUpdateTimestamp(IntPtr obj)
		{
			return StringFromNative(ovr_PartyUpdateNotification_GetUpdateTimestamp_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_PartyUpdateNotification_GetUpdateTimestamp")]
		private static extern IntPtr ovr_PartyUpdateNotification_GetUpdateTimestamp_Native(IntPtr obj);

		public static string ovr_PartyUpdateNotification_GetUserAlias(IntPtr obj)
		{
			return StringFromNative(ovr_PartyUpdateNotification_GetUserAlias_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_PartyUpdateNotification_GetUserAlias")]
		private static extern IntPtr ovr_PartyUpdateNotification_GetUserAlias_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_PartyUpdateNotification_GetUserId(IntPtr obj);

		public static string ovr_PartyUpdateNotification_GetUserName(IntPtr obj)
		{
			return StringFromNative(ovr_PartyUpdateNotification_GetUserName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_PartyUpdateNotification_GetUserName")]
		private static extern IntPtr ovr_PartyUpdateNotification_GetUserName_Native(IntPtr obj);

		public static string ovr_Pid_GetId(IntPtr obj)
		{
			return StringFromNative(ovr_Pid_GetId_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Pid_GetId")]
		private static extern IntPtr ovr_Pid_GetId_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_PidArray_GetElement(IntPtr obj, UIntPtr index);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_PidArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_PingResult_GetID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_PingResult_GetPingTimeUsec(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_PingResult_IsTimeout(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern PlatformInitializeResult ovr_PlatformInitialize_GetResult(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_Price_GetAmountInHundredths(IntPtr obj);

		public static string ovr_Price_GetCurrency(IntPtr obj)
		{
			return StringFromNative(ovr_Price_GetCurrency_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Price_GetCurrency")]
		private static extern IntPtr ovr_Price_GetCurrency_Native(IntPtr obj);

		public static string ovr_Price_GetFormatted(IntPtr obj)
		{
			return StringFromNative(ovr_Price_GetFormatted_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Price_GetFormatted")]
		private static extern IntPtr ovr_Price_GetFormatted_Native(IntPtr obj);

		public static string ovr_Product_GetDescription(IntPtr obj)
		{
			return StringFromNative(ovr_Product_GetDescription_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Product_GetDescription")]
		private static extern IntPtr ovr_Product_GetDescription_Native(IntPtr obj);

		public static string ovr_Product_GetFormattedPrice(IntPtr obj)
		{
			return StringFromNative(ovr_Product_GetFormattedPrice_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Product_GetFormattedPrice")]
		private static extern IntPtr ovr_Product_GetFormattedPrice_Native(IntPtr obj);

		public static string ovr_Product_GetName(IntPtr obj)
		{
			return StringFromNative(ovr_Product_GetName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Product_GetName")]
		private static extern IntPtr ovr_Product_GetName_Native(IntPtr obj);

		public static string ovr_Product_GetSKU(IntPtr obj)
		{
			return StringFromNative(ovr_Product_GetSKU_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Product_GetSKU")]
		private static extern IntPtr ovr_Product_GetSKU_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_ProductArray_GetElement(IntPtr obj, UIntPtr index);

		public static string ovr_ProductArray_GetNextUrl(IntPtr obj)
		{
			return StringFromNative(ovr_ProductArray_GetNextUrl_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_ProductArray_GetNextUrl")]
		private static extern IntPtr ovr_ProductArray_GetNextUrl_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_ProductArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_ProductArray_HasNextPage(IntPtr obj);

		public static DateTime ovr_Purchase_GetExpirationTime(IntPtr obj)
		{
			return DateTimeFromNative(ovr_Purchase_GetExpirationTime_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Purchase_GetExpirationTime")]
		private static extern ulong ovr_Purchase_GetExpirationTime_Native(IntPtr obj);

		public static DateTime ovr_Purchase_GetGrantTime(IntPtr obj)
		{
			return DateTimeFromNative(ovr_Purchase_GetGrantTime_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Purchase_GetGrantTime")]
		private static extern ulong ovr_Purchase_GetGrantTime_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Purchase_GetPurchaseID(IntPtr obj);

		public static string ovr_Purchase_GetSKU(IntPtr obj)
		{
			return StringFromNative(ovr_Purchase_GetSKU_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Purchase_GetSKU")]
		private static extern IntPtr ovr_Purchase_GetSKU_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_PurchaseArray_GetElement(IntPtr obj, UIntPtr index);

		public static string ovr_PurchaseArray_GetNextUrl(IntPtr obj)
		{
			return StringFromNative(ovr_PurchaseArray_GetNextUrl_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_PurchaseArray_GetNextUrl")]
		private static extern IntPtr ovr_PurchaseArray_GetNextUrl_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_PurchaseArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_PurchaseArray_HasNextPage(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_GetApplicationID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Room_GetDataStore(IntPtr obj);

		public static string ovr_Room_GetDescription(IntPtr obj)
		{
			return StringFromNative(ovr_Room_GetDescription_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Room_GetDescription")]
		private static extern IntPtr ovr_Room_GetDescription_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_Room_GetID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Room_GetInvitedUsers(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_Room_GetIsMembershipLocked(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern RoomJoinPolicy ovr_Room_GetJoinPolicy(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern RoomJoinability ovr_Room_GetJoinability(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Room_GetMatchedUsers(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_Room_GetMaxUsers(IntPtr obj);

		public static string ovr_Room_GetName(IntPtr obj)
		{
			return StringFromNative(ovr_Room_GetName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Room_GetName")]
		private static extern IntPtr ovr_Room_GetName_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Room_GetOwner(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Room_GetTeams(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern RoomType ovr_Room_GetType(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Room_GetUsers(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovr_Room_GetVersion(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_RoomArray_GetElement(IntPtr obj, UIntPtr index);

		public static string ovr_RoomArray_GetNextUrl(IntPtr obj)
		{
			return StringFromNative(ovr_RoomArray_GetNextUrl_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_RoomArray_GetNextUrl")]
		private static extern IntPtr ovr_RoomArray_GetNextUrl_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_RoomArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_RoomArray_HasNextPage(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_RoomInviteNotification_GetID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_RoomInviteNotification_GetRoomID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_RoomInviteNotification_GetSenderID(IntPtr obj);

		public static DateTime ovr_RoomInviteNotification_GetSentTime(IntPtr obj)
		{
			return DateTimeFromNative(ovr_RoomInviteNotification_GetSentTime_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_RoomInviteNotification_GetSentTime")]
		private static extern ulong ovr_RoomInviteNotification_GetSentTime_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_RoomInviteNotificationArray_GetElement(IntPtr obj, UIntPtr index);

		public static string ovr_RoomInviteNotificationArray_GetNextUrl(IntPtr obj)
		{
			return StringFromNative(ovr_RoomInviteNotificationArray_GetNextUrl_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_RoomInviteNotificationArray_GetNextUrl")]
		private static extern IntPtr ovr_RoomInviteNotificationArray_GetNextUrl_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_RoomInviteNotificationArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_RoomInviteNotificationArray_HasNextPage(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern SdkAccountType ovr_SdkAccount_GetAccountType(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_SdkAccount_GetUserId(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_SdkAccountArray_GetElement(IntPtr obj, UIntPtr index);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_SdkAccountArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ShareMediaStatus ovr_ShareMediaResult_GetStatus(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_SystemPermission_GetHasPermission(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern PermissionGrantStatus ovr_SystemPermission_GetPermissionGrantStatus(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern VoipMuteState ovr_SystemVoipState_GetMicrophoneMuted(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern SystemVoipStatus ovr_SystemVoipState_GetStatus(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_Team_GetAssignedUsers(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern int ovr_Team_GetMaxUsers(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern int ovr_Team_GetMinUsers(IntPtr obj);

		public static string ovr_Team_GetName(IntPtr obj)
		{
			return StringFromNative(ovr_Team_GetName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_Team_GetName")]
		private static extern IntPtr ovr_Team_GetName_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_TeamArray_GetElement(IntPtr obj, UIntPtr index);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_TeamArray_GetSize(IntPtr obj);

		public static string ovr_TestUser_GetAccessToken(IntPtr obj)
		{
			return StringFromNative(ovr_TestUser_GetAccessToken_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_TestUser_GetAccessToken")]
		private static extern IntPtr ovr_TestUser_GetAccessToken_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_TestUser_GetAppAccessArray(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_TestUser_GetFbAppAccessArray(IntPtr obj);

		public static string ovr_TestUser_GetFriendAccessToken(IntPtr obj)
		{
			return StringFromNative(ovr_TestUser_GetFriendAccessToken_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_TestUser_GetFriendAccessToken")]
		private static extern IntPtr ovr_TestUser_GetFriendAccessToken_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_TestUser_GetFriendAppAccessArray(IntPtr obj);

		public static string ovr_TestUser_GetUserAlias(IntPtr obj)
		{
			return StringFromNative(ovr_TestUser_GetUserAlias_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_TestUser_GetUserAlias")]
		private static extern IntPtr ovr_TestUser_GetUserAlias_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_TestUser_GetUserFbid(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_TestUser_GetUserId(IntPtr obj);

		public static string ovr_TestUserAppAccess_GetAccessToken(IntPtr obj)
		{
			return StringFromNative(ovr_TestUserAppAccess_GetAccessToken_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_TestUserAppAccess_GetAccessToken")]
		private static extern IntPtr ovr_TestUserAppAccess_GetAccessToken_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_TestUserAppAccess_GetAppId(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_TestUserAppAccess_GetUserId(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_TestUserAppAccessArray_GetElement(IntPtr obj, UIntPtr index);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_TestUserAppAccessArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_User_GetID(IntPtr obj);

		public static string ovr_User_GetImageUrl(IntPtr obj)
		{
			return StringFromNative(ovr_User_GetImageUrl_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_User_GetImageUrl")]
		private static extern IntPtr ovr_User_GetImageUrl_Native(IntPtr obj);

		public static string ovr_User_GetInviteToken(IntPtr obj)
		{
			return StringFromNative(ovr_User_GetInviteToken_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_User_GetInviteToken")]
		private static extern IntPtr ovr_User_GetInviteToken_Native(IntPtr obj);

		public static string ovr_User_GetOculusID(IntPtr obj)
		{
			return StringFromNative(ovr_User_GetOculusID_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_User_GetOculusID")]
		private static extern IntPtr ovr_User_GetOculusID_Native(IntPtr obj);

		public static string ovr_User_GetPresence(IntPtr obj)
		{
			return StringFromNative(ovr_User_GetPresence_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_User_GetPresence")]
		private static extern IntPtr ovr_User_GetPresence_Native(IntPtr obj);

		public static string ovr_User_GetPresenceDeeplinkMessage(IntPtr obj)
		{
			return StringFromNative(ovr_User_GetPresenceDeeplinkMessage_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_User_GetPresenceDeeplinkMessage")]
		private static extern IntPtr ovr_User_GetPresenceDeeplinkMessage_Native(IntPtr obj);

		public static string ovr_User_GetPresenceDestinationApiName(IntPtr obj)
		{
			return StringFromNative(ovr_User_GetPresenceDestinationApiName_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_User_GetPresenceDestinationApiName")]
		private static extern IntPtr ovr_User_GetPresenceDestinationApiName_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UserPresenceStatus ovr_User_GetPresenceStatus(IntPtr obj);

		public static string ovr_User_GetSmallImageUrl(IntPtr obj)
		{
			return StringFromNative(ovr_User_GetSmallImageUrl_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_User_GetSmallImageUrl")]
		private static extern IntPtr ovr_User_GetSmallImageUrl_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_UserAndRoom_GetRoom(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_UserAndRoom_GetUser(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_UserAndRoomArray_GetElement(IntPtr obj, UIntPtr index);

		public static string ovr_UserAndRoomArray_GetNextUrl(IntPtr obj)
		{
			return StringFromNative(ovr_UserAndRoomArray_GetNextUrl_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_UserAndRoomArray_GetNextUrl")]
		private static extern IntPtr ovr_UserAndRoomArray_GetNextUrl_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_UserAndRoomArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_UserAndRoomArray_HasNextPage(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_UserArray_GetElement(IntPtr obj, UIntPtr index);

		public static string ovr_UserArray_GetNextUrl(IntPtr obj)
		{
			return StringFromNative(ovr_UserArray_GetNextUrl_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_UserArray_GetNextUrl")]
		private static extern IntPtr ovr_UserArray_GetNextUrl_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_UserArray_GetSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_UserArray_HasNextPage(IntPtr obj);

		public static string ovr_UserProof_GetNonce(IntPtr obj)
		{
			return StringFromNative(ovr_UserProof_GetNonce_Native(obj));
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_UserProof_GetNonce")]
		private static extern IntPtr ovr_UserProof_GetNonce_Native(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovr_UserReportID_GetDidCancel(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovr_UserReportID_GetID(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_VoipDecoder_Decode(IntPtr obj, byte[] compressedData, UIntPtr compressedSize);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_VoipDecoder_GetDecodedPCM(IntPtr obj, float[] outputBuffer, UIntPtr outputBufferSize);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_VoipEncoder_AddPCM(IntPtr obj, float[] inputData, uint inputSize);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_VoipEncoder_GetCompressedData(IntPtr obj, byte[] outputBuffer, UIntPtr intputSize);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern UIntPtr ovr_VoipEncoder_GetCompressedDataSize(IntPtr obj);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_AbuseReportOptions_Create();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_AbuseReportOptions_Destroy(IntPtr handle);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_AbuseReportOptions_SetPreventPeopleChooser(IntPtr handle, bool value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_AbuseReportOptions_SetReportType(IntPtr handle, AbuseReportType value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_ApplicationOptions_Create();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_ApplicationOptions_Destroy(IntPtr handle);

		public static void ovr_ApplicationOptions_SetDeeplinkMessage(IntPtr handle, string value)
		{
			IntPtr intPtr = StringToNative(value);
			ovr_ApplicationOptions_SetDeeplinkMessage_Native(handle, intPtr);
			Marshal.FreeCoTaskMem(intPtr);
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_ApplicationOptions_SetDeeplinkMessage")]
		private static extern void ovr_ApplicationOptions_SetDeeplinkMessage_Native(IntPtr handle, IntPtr value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_MatchmakingOptions_Create();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_MatchmakingOptions_Destroy(IntPtr handle);

		public static void ovr_MatchmakingOptions_SetCreateRoomDataStoreString(IntPtr handle, string key, string value)
		{
			IntPtr intPtr = StringToNative(key);
			IntPtr intPtr2 = StringToNative(value);
			ovr_MatchmakingOptions_SetCreateRoomDataStoreString_Native(handle, intPtr, intPtr2);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_MatchmakingOptions_SetCreateRoomDataStoreString")]
		private static extern void ovr_MatchmakingOptions_SetCreateRoomDataStoreString_Native(IntPtr handle, IntPtr key, IntPtr value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_MatchmakingOptions_ClearCreateRoomDataStore(IntPtr handle);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_MatchmakingOptions_SetCreateRoomJoinPolicy(IntPtr handle, RoomJoinPolicy value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_MatchmakingOptions_SetCreateRoomMaxUsers(IntPtr handle, uint value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_MatchmakingOptions_AddEnqueueAdditionalUser(IntPtr handle, ulong value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_MatchmakingOptions_ClearEnqueueAdditionalUsers(IntPtr handle);

		public static void ovr_MatchmakingOptions_SetEnqueueDataSettingsInt(IntPtr handle, string key, int value)
		{
			IntPtr intPtr = StringToNative(key);
			ovr_MatchmakingOptions_SetEnqueueDataSettingsInt_Native(handle, intPtr, value);
			Marshal.FreeCoTaskMem(intPtr);
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_MatchmakingOptions_SetEnqueueDataSettingsInt")]
		private static extern void ovr_MatchmakingOptions_SetEnqueueDataSettingsInt_Native(IntPtr handle, IntPtr key, int value);

		public static void ovr_MatchmakingOptions_SetEnqueueDataSettingsDouble(IntPtr handle, string key, double value)
		{
			IntPtr intPtr = StringToNative(key);
			ovr_MatchmakingOptions_SetEnqueueDataSettingsDouble_Native(handle, intPtr, value);
			Marshal.FreeCoTaskMem(intPtr);
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_MatchmakingOptions_SetEnqueueDataSettingsDouble")]
		private static extern void ovr_MatchmakingOptions_SetEnqueueDataSettingsDouble_Native(IntPtr handle, IntPtr key, double value);

		public static void ovr_MatchmakingOptions_SetEnqueueDataSettingsString(IntPtr handle, string key, string value)
		{
			IntPtr intPtr = StringToNative(key);
			IntPtr intPtr2 = StringToNative(value);
			ovr_MatchmakingOptions_SetEnqueueDataSettingsString_Native(handle, intPtr, intPtr2);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_MatchmakingOptions_SetEnqueueDataSettingsString")]
		private static extern void ovr_MatchmakingOptions_SetEnqueueDataSettingsString_Native(IntPtr handle, IntPtr key, IntPtr value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_MatchmakingOptions_ClearEnqueueDataSettings(IntPtr handle);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_MatchmakingOptions_SetEnqueueIsDebug(IntPtr handle, bool value);

		public static void ovr_MatchmakingOptions_SetEnqueueQueryKey(IntPtr handle, string value)
		{
			IntPtr intPtr = StringToNative(value);
			ovr_MatchmakingOptions_SetEnqueueQueryKey_Native(handle, intPtr);
			Marshal.FreeCoTaskMem(intPtr);
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_MatchmakingOptions_SetEnqueueQueryKey")]
		private static extern void ovr_MatchmakingOptions_SetEnqueueQueryKey_Native(IntPtr handle, IntPtr value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_RichPresenceOptions_Create();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_RichPresenceOptions_Destroy(IntPtr handle);

		public static void ovr_RichPresenceOptions_SetApiName(IntPtr handle, string value)
		{
			IntPtr intPtr = StringToNative(value);
			ovr_RichPresenceOptions_SetApiName_Native(handle, intPtr);
			Marshal.FreeCoTaskMem(intPtr);
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_RichPresenceOptions_SetApiName")]
		private static extern void ovr_RichPresenceOptions_SetApiName_Native(IntPtr handle, IntPtr value);

		public static void ovr_RichPresenceOptions_SetArgsString(IntPtr handle, string key, string value)
		{
			IntPtr intPtr = StringToNative(key);
			IntPtr intPtr2 = StringToNative(value);
			ovr_RichPresenceOptions_SetArgsString_Native(handle, intPtr, intPtr2);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_RichPresenceOptions_SetArgsString")]
		private static extern void ovr_RichPresenceOptions_SetArgsString_Native(IntPtr handle, IntPtr key, IntPtr value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_RichPresenceOptions_ClearArgs(IntPtr handle);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_RichPresenceOptions_SetCurrentCapacity(IntPtr handle, uint value);

		public static void ovr_RichPresenceOptions_SetDeeplinkMessageOverride(IntPtr handle, string value)
		{
			IntPtr intPtr = StringToNative(value);
			ovr_RichPresenceOptions_SetDeeplinkMessageOverride_Native(handle, intPtr);
			Marshal.FreeCoTaskMem(intPtr);
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_RichPresenceOptions_SetDeeplinkMessageOverride")]
		private static extern void ovr_RichPresenceOptions_SetDeeplinkMessageOverride_Native(IntPtr handle, IntPtr value);

		public static void ovr_RichPresenceOptions_SetEndTime(IntPtr handle, DateTime value)
		{
			ulong value2 = DateTimeToNative(value);
			ovr_RichPresenceOptions_SetEndTime_Native(handle, value2);
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_RichPresenceOptions_SetEndTime")]
		private static extern void ovr_RichPresenceOptions_SetEndTime_Native(IntPtr handle, ulong value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_RichPresenceOptions_SetExtraContext(IntPtr handle, RichPresenceExtraContext value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_RichPresenceOptions_SetIsIdle(IntPtr handle, bool value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_RichPresenceOptions_SetIsJoinable(IntPtr handle, bool value);

		public static void ovr_RichPresenceOptions_SetJoinableId(IntPtr handle, string value)
		{
			IntPtr intPtr = StringToNative(value);
			ovr_RichPresenceOptions_SetJoinableId_Native(handle, intPtr);
			Marshal.FreeCoTaskMem(intPtr);
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_RichPresenceOptions_SetJoinableId")]
		private static extern void ovr_RichPresenceOptions_SetJoinableId_Native(IntPtr handle, IntPtr value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_RichPresenceOptions_SetMaxCapacity(IntPtr handle, uint value);

		public static void ovr_RichPresenceOptions_SetStartTime(IntPtr handle, DateTime value)
		{
			ulong value2 = DateTimeToNative(value);
			ovr_RichPresenceOptions_SetStartTime_Native(handle, value2);
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_RichPresenceOptions_SetStartTime")]
		private static extern void ovr_RichPresenceOptions_SetStartTime_Native(IntPtr handle, ulong value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_RoomOptions_Create();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_RoomOptions_Destroy(IntPtr handle);

		public static void ovr_RoomOptions_SetDataStoreString(IntPtr handle, string key, string value)
		{
			IntPtr intPtr = StringToNative(key);
			IntPtr intPtr2 = StringToNative(value);
			ovr_RoomOptions_SetDataStoreString_Native(handle, intPtr, intPtr2);
			Marshal.FreeCoTaskMem(intPtr);
			Marshal.FreeCoTaskMem(intPtr2);
		}

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovr_RoomOptions_SetDataStoreString")]
		private static extern void ovr_RoomOptions_SetDataStoreString_Native(IntPtr handle, IntPtr key, IntPtr value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_RoomOptions_ClearDataStore(IntPtr handle);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_RoomOptions_SetExcludeRecentlyMet(IntPtr handle, bool value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_RoomOptions_SetMaxUserResults(IntPtr handle, uint value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_RoomOptions_SetOrdering(IntPtr handle, UserOrdering value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_RoomOptions_SetRecentlyMetTimeWindow(IntPtr handle, TimeWindow value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_RoomOptions_SetRoomId(IntPtr handle, ulong value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_RoomOptions_SetTurnOffUpdates(IntPtr handle, bool value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_UserOptions_Create();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_UserOptions_Destroy(IntPtr handle);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_UserOptions_SetMaxUsers(IntPtr handle, uint value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_UserOptions_AddServiceProvider(IntPtr handle, ServiceProvider value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_UserOptions_ClearServiceProviders(IntPtr handle);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_UserOptions_SetTimeWindow(IntPtr handle, TimeWindow value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovr_VoipOptions_Create();

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_VoipOptions_Destroy(IntPtr handle);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_VoipOptions_SetBitrateForNewConnections(IntPtr handle, VoipBitrate value);

		[DllImport("ovrplatformloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovr_VoipOptions_SetCreateNewConnectionUseDtx(IntPtr handle, VoipDtxState value);
	}
	public enum CloudStorageDataStatus
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("IN_SYNC")]
		InSync,
		[Description("NEEDS_DOWNLOAD")]
		NeedsDownload,
		[Description("REMOTE_DOWNLOADING")]
		RemoteDownloading,
		[Description("NEEDS_UPLOAD")]
		NeedsUpload,
		[Description("LOCAL_UPLOADING")]
		LocalUploading,
		[Description("IN_CONFLICT")]
		InConflict
	}
	public enum CloudStorageUpdateStatus
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("OK")]
		Ok,
		[Description("BETTER_VERSION_STORED")]
		BetterVersionStored,
		[Description("MANUAL_MERGE_REQUIRED")]
		ManualMergeRequired
	}
	public interface IMicrophone
	{
		void Start();

		void Stop();

		float[] Update();
	}
	public interface IVoipPCMSource
	{
		int GetPCM(float[] dest, int length);

		void SetSenderID(ulong senderID);

		void Update();

		int PeekSizeElements();
	}
	public enum KeyValuePairType
	{
		[Description("STRING")]
		String,
		[Description("INTEGER")]
		Int,
		[Description("DOUBLE")]
		Double,
		[Description("UNKNOWN")]
		Unknown
	}
	public enum LaunchType
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("NORMAL")]
		Normal,
		[Description("INVITE")]
		Invite,
		[Description("COORDINATED")]
		Coordinated,
		[Description("DEEPLINK")]
		Deeplink
	}
	public enum LeaderboardFilterType
	{
		[Description("NONE")]
		None,
		[Description("FRIENDS")]
		Friends,
		[Description("UNKNOWN")]
		Unknown
	}
	public enum LeaderboardStartAt
	{
		[Description("TOP")]
		Top,
		[Description("CENTERED_ON_VIEWER")]
		CenteredOnViewer,
		[Description("CENTERED_ON_VIEWER_OR_TOP")]
		CenteredOnViewerOrTop,
		[Description("UNKNOWN")]
		Unknown
	}
	public enum LivestreamingAudience
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("PUBLIC")]
		Public,
		[Description("FRIENDS")]
		Friends,
		[Description("ONLY_ME")]
		OnlyMe
	}
	public enum LivestreamingMicrophoneStatus
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("MICROPHONE_ON")]
		MicrophoneOn,
		[Description("MICROPHONE_OFF")]
		MicrophoneOff
	}
	public enum LivestreamingStartStatus
	{
		[Description("SUCCESS")]
		Success = 1,
		[Description("UNKNOWN")]
		Unknown = 0,
		[Description("NO_PACKAGE_SET")]
		NoPackageSet = -1,
		[Description("NO_FB_CONNECT")]
		NoFbConnect = -2,
		[Description("NO_SESSION_ID")]
		NoSessionId = -3,
		[Description("MISSING_PARAMETERS")]
		MissingParameters = -4
	}
	public enum MatchmakingCriterionImportance
	{
		[Description("REQUIRED")]
		Required,
		[Description("HIGH")]
		High,
		[Description("MEDIUM")]
		Medium,
		[Description("LOW")]
		Low,
		[Description("UNKNOWN")]
		Unknown
	}
	public class MatchmakingOptions
	{
		private IntPtr Handle;

		public MatchmakingOptions()
		{
			Handle = CAPI.ovr_MatchmakingOptions_Create();
		}

		public void SetCreateRoomDataStore(string key, string value)
		{
			CAPI.ovr_MatchmakingOptions_SetCreateRoomDataStoreString(Handle, key, value);
		}

		public void ClearCreateRoomDataStore()
		{
			CAPI.ovr_MatchmakingOptions_ClearCreateRoomDataStore(Handle);
		}

		public void SetCreateRoomJoinPolicy(RoomJoinPolicy value)
		{
			CAPI.ovr_MatchmakingOptions_SetCreateRoomJoinPolicy(Handle, value);
		}

		public void SetCreateRoomMaxUsers(uint value)
		{
			CAPI.ovr_MatchmakingOptions_SetCreateRoomMaxUsers(Handle, value);
		}

		public void AddEnqueueAdditionalUser(ulong userID)
		{
			CAPI.ovr_MatchmakingOptions_AddEnqueueAdditionalUser(Handle, userID);
		}

		public void ClearEnqueueAdditionalUsers()
		{
			CAPI.ovr_MatchmakingOptions_ClearEnqueueAdditionalUsers(Handle);
		}

		public void SetEnqueueDataSettings(string key, int value)
		{
			CAPI.ovr_MatchmakingOptions_SetEnqueueDataSettingsInt(Handle, key, value);
		}

		public void SetEnqueueDataSettings(string key, double value)
		{
			CAPI.ovr_MatchmakingOptions_SetEnqueueDataSettingsDouble(Handle, key, value);
		}

		public void SetEnqueueDataSettings(string key, string value)
		{
			CAPI.ovr_MatchmakingOptions_SetEnqueueDataSettingsString(Handle, key, value);
		}

		public void ClearEnqueueDataSettings()
		{
			CAPI.ovr_MatchmakingOptions_ClearEnqueueDataSettings(Handle);
		}

		public void SetEnqueueIsDebug(bool value)
		{
			CAPI.ovr_MatchmakingOptions_SetEnqueueIsDebug(Handle, value);
		}

		public void SetEnqueueQueryKey(string value)
		{
			CAPI.ovr_MatchmakingOptions_SetEnqueueQueryKey(Handle, value);
		}

		public static explicit operator IntPtr(MatchmakingOptions options)
		{
			return options?.Handle ?? IntPtr.Zero;
		}

		~MatchmakingOptions()
		{
			CAPI.ovr_MatchmakingOptions_Destroy(Handle);
		}
	}
	public enum MatchmakingStatApproach
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("TRAILING")]
		Trailing,
		[Description("SWINGY")]
		Swingy
	}
	public enum MediaContentType
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("PHOTO")]
		Photo
	}
	public abstract class Message<T> : Message
	{
		public new delegate void Callback(Message<T> message);

		private T data;

		public T Data => data;

		public Message(IntPtr c_message)
			: base(c_message)
		{
			if (!base.IsError)
			{
				data = GetDataFromMessage(c_message);
			}
		}

		protected abstract T GetDataFromMessage(IntPtr c_message);
	}
	public class Message
	{
		public delegate void Callback(Message message);

		public enum MessageType : uint
		{
			Unknown = 0u,
			Achievements_AddCount = 65495601u,
			Achievements_AddFields = 346693929u,
			Achievements_GetAllDefinitions = 64177549u,
			Achievements_GetAllProgress = 1335877149u,
			Achievements_GetDefinitionsByName = 1653670332u,
			Achievements_GetNextAchievementDefinitionArrayPage = 712888917u,
			Achievements_GetNextAchievementProgressArrayPage = 792913703u,
			Achievements_GetProgressByName = 354837425u,
			Achievements_Unlock = 1497156573u,
			ApplicationLifecycle_GetRegisteredPIDs = 82169698u,
			ApplicationLifecycle_GetSessionKey = 984570141u,
			ApplicationLifecycle_RegisterSessionKey = 1303818232u,
			Application_GetVersion = 1751583246u,
			Application_LaunchOtherApp = 1424151032u,
			AssetFile_Delete = 1834842246u,
			AssetFile_DeleteById = 1525206354u,
			AssetFile_DeleteByName = 1108001231u,
			AssetFile_Download = 289710021u,
			AssetFile_DownloadById = 755009938u,
			AssetFile_DownloadByName = 1664536314u,
			AssetFile_DownloadCancel = 134927303u,
			AssetFile_DownloadCancelById = 1365611796u,
			AssetFile_DownloadCancelByName = 1147858170u,
			AssetFile_GetList = 1258057588u,
			AssetFile_Status = 47394656u,
			AssetFile_StatusById = 1570069816u,
			AssetFile_StatusByName = 1104140880u,
			CloudStorage2_GetUserDirectoryPath = 1990471406u,
			CloudStorage_Delete = 685393261u,
			CloudStorage_GetNextCloudStorageMetadataArrayPage = 1544004335u,
			CloudStorage_Load = 1082420033u,
			CloudStorage_LoadBucketMetadata = 1931977997u,
			CloudStorage_LoadConflictMetadata = 1146770162u,
			CloudStorage_LoadHandle = 845863478u,
			CloudStorage_LoadMetadata = 65446546u,
			CloudStorage_ResolveKeepLocal = 811109637u,
			CloudStorage_ResolveKeepRemote = 1965400838u,
			CloudStorage_Save = 1270570030u,
			Entitlement_GetIsViewerEntitled = 409688241u,
			IAP_ConsumePurchase = 532378329u,
			IAP_GetNextProductArrayPage = 467225263u,
			IAP_GetNextPurchaseArrayPage = 1196886677u,
			IAP_GetProductsBySKU = 2124073717u,
			IAP_GetViewerPurchases = 974095385u,
			IAP_GetViewerPurchasesDurableCache = 1666817579u,
			IAP_LaunchCheckoutFlow = 1067126029u,
			LanguagePack_GetCurrent = 529592533u,
			LanguagePack_SetCurrent = 1531952096u,
			Leaderboard_GetEntries = 1572030284u,
			Leaderboard_GetEntriesAfterRank = 406293487u,
			Leaderboard_GetNextEntries = 1310751961u,
			Leaderboard_GetPreviousEntries = 1224858304u,
			Leaderboard_WriteEntry = 293587198u,
			Livestreaming_GetStatus = 1218079125u,
			Livestreaming_PauseStream = 916223619u,
			Livestreaming_ResumeStream = 575827343u,
			Matchmaking_Browse = 509948616u,
			Matchmaking_Browse2 = 1715641947u,
			Matchmaking_Cancel = 543705519u,
			Matchmaking_Cancel2 = 285117908u,
			Matchmaking_CreateAndEnqueueRoom = 1615617480u,
			Matchmaking_CreateAndEnqueueRoom2 = 693889755u,
			Matchmaking_CreateRoom = 54203178u,
			Matchmaking_CreateRoom2 = 1231922052u,
			Matchmaking_Enqueue = 1086418033u,
			Matchmaking_Enqueue2 = 303174325u,
			Matchmaking_EnqueueRoom = 1888108644u,
			Matchmaking_EnqueueRoom2 = 1428741028u,
			Matchmaking_GetAdminSnapshot = 1008820116u,
			Matchmaking_GetStats = 1123849272u,
			Matchmaking_JoinRoom = 1295177725u,
			Matchmaking_ReportResultInsecure = 439800205u,
			Matchmaking_StartMatch = 1154746693u,
			Media_ShareToFacebook = 14912239u,
			Notification_GetNextRoomInviteNotificationArrayPage = 102890359u,
			Notification_GetRoomInvites = 1871801234u,
			Notification_MarkAsRead = 1903319523u,
			Party_GetCurrent = 1200830304u,
			RichPresence_Clear = 1471632051u,
			RichPresence_GetDestinations = 1483681044u,
			RichPresence_GetNextDestinationArrayPage = 1731624773u,
			RichPresence_Set = 1007973641u,
			Room_CreateAndJoinPrivate = 1977017207u,
			Room_CreateAndJoinPrivate2 = 1513775683u,
			Room_Get = 1704628152u,
			Room_GetCurrent = 161916164u,
			Room_GetCurrentForUser = 234887141u,
			Room_GetInvitableUsers = 506615698u,
			Room_GetInvitableUsers2 = 1330899120u,
			Room_GetModeratedRooms = 159645047u,
			Room_GetNextRoomArrayPage = 1317239238u,
			Room_InviteUser = 1093266451u,
			Room_Join = 382373641u,
			Room_Join2 = 1303059522u,
			Room_KickUser = 1233344310u,
			Room_LaunchInvitableUserFlow = 843047539u,
			Room_Leave = 1916281973u,
			Room_SetDescription = 809796911u,
			Room_UpdateDataStore = 40779816u,
			Room_UpdateMembershipLockStatus = 923514796u,
			Room_UpdateOwner = 850803997u,
			Room_UpdatePrivateRoomJoinPolicy = 289473179u,
			User_Get = 1808768583u,
			User_GetAccessToken = 111696574u,
			User_GetLoggedInUser = 1131361373u,
			User_GetLoggedInUserFriends = 1484532365u,
			User_GetLoggedInUserFriendsAndRooms = 1585908615u,
			User_GetLoggedInUserRecentlyMetUsersAndRooms = 694139440u,
			User_GetNextUserAndRoomArrayPage = 2143146719u,
			User_GetNextUserArrayPage = 645723971u,
			User_GetOrgScopedID = 418426907u,
			User_GetSdkAccounts = 1733454467u,
			User_GetUserProof = 578880643u,
			User_LaunchFriendRequestFlow = 151303576u,
			User_LaunchProfile = 171537047u,
			Voip_SetSystemVoipSuppressed = 1161808298u,
			Notification_ApplicationLifecycle_LaunchIntentChanged = 78859427u,
			Notification_AssetFile_DownloadUpdate = 803015885u,
			Notification_Cal_FinalizeApplication = 1963741337u,
			Notification_Cal_ProposeApplication = 779375093u,
			Notification_HTTP_Transfer = 2111073839u,
			Notification_Livestreaming_StatusChange = 575101294u,
			Notification_Matchmaking_MatchFound = 197393623u,
			Notification_Networking_ConnectionStateChange = 1577243802u,
			Notification_Networking_PeerConnectRequest = 1295114959u,
			Notification_Networking_PingResult = 1360343058u,
			Notification_Party_PartyUpdate = 487688882u,
			Notification_Room_InviteAccepted = 1829794225u,
			Notification_Room_InviteReceived = 1783209300u,
			Notification_Room_RoomUpdate = 1626094639u,
			Notification_Voip_ConnectRequest = 908343318u,
			Notification_Voip_StateChange = 888120928u,
			Notification_Voip_SystemVoipState = 1490179237u,
			Platform_InitializeWithAccessToken = 896085803u,
			Platform_InitializeStandaloneOculus = 1375260172u,
			Platform_InitializeAndroidAsynchronous = 450037684u,
			Platform_InitializeWindowsAsynchronous = 1839708815u
		}

		internal delegate Message ExtraMessageTypesHandler(IntPtr messageHandle, MessageType message_type);

		private MessageType type;

		private ulong requestID;

		private Error error;

		public MessageType Type => type;

		public bool IsError => error != null;

		public ulong RequestID => requestID;

		internal static ExtraMessageTypesHandler HandleExtraMessageTypes { private get; set; }

		public Message(IntPtr c_message)
		{
			type = CAPI.ovr_Message_GetType(c_message);
			bool num = CAPI.ovr_Message_IsError(c_message);
			requestID = CAPI.ovr_Message_GetRequestID(c_message);
			if (num)
			{
				IntPtr obj = CAPI.ovr_Message_GetError(c_message);
				error = new Error(CAPI.ovr_Error_GetCode(obj), CAPI.ovr_Error_GetMessage(obj), CAPI.ovr_Error_GetHttpCode(obj));
			}
			else if (Core.LogMessages)
			{
				string text = CAPI.ovr_Message_GetString(c_message);
				if (text != null)
				{
					UnityEngine.Debug.Log(text);
				}
				else
				{
					UnityEngine.Debug.Log($"null message string {c_message}");
				}
			}
		}

		~Message()
		{
		}

		public virtual Error GetError()
		{
			return error;
		}

		public virtual PingResult GetPingResult()
		{
			return null;
		}

		public virtual NetworkingPeer GetNetworkingPeer()
		{
			return null;
		}

		public virtual HttpTransferUpdate GetHttpTransferUpdate()
		{
			return null;
		}

		public virtual PlatformInitialize GetPlatformInitialize()
		{
			return null;
		}

		public virtual AbuseReportRecording GetAbuseReportRecording()
		{
			return null;
		}

		public virtual AchievementDefinitionList GetAchievementDefinitions()
		{
			return null;
		}

		public virtual AchievementProgressList GetAchievementProgressList()
		{
			return null;
		}

		public virtual AchievementUpdate GetAchievementUpdate()
		{
			return null;
		}

		public virtual ApplicationVersion GetApplicationVersion()
		{
			return null;
		}

		public virtual AssetDetails GetAssetDetails()
		{
			return null;
		}

		public virtual AssetDetailsList GetAssetDetailsList()
		{
			return null;
		}

		public virtual AssetFileDeleteResult GetAssetFileDeleteResult()
		{
			return null;
		}

		public virtual AssetFileDownloadCancelResult GetAssetFileDownloadCancelResult()
		{
			return null;
		}

		public virtual AssetFileDownloadResult GetAssetFileDownloadResult()
		{
			return null;
		}

		public virtual AssetFileDownloadUpdate GetAssetFileDownloadUpdate()
		{
			return null;
		}

		public virtual CalApplicationFinalized GetCalApplicationFinalized()
		{
			return null;
		}

		public virtual CalApplicationProposed GetCalApplicationProposed()
		{
			return null;
		}

		public virtual CalApplicationSuggestionList GetCalApplicationSuggestionList()
		{
			return null;
		}

		public virtual CloudStorageConflictMetadata GetCloudStorageConflictMetadata()
		{
			return null;
		}

		public virtual CloudStorageData GetCloudStorageData()
		{
			return null;
		}

		public virtual CloudStorageMetadata GetCloudStorageMetadata()
		{
			return null;
		}

		public virtual CloudStorageMetadataList GetCloudStorageMetadataList()
		{
			return null;
		}

		public virtual CloudStorageUpdateResponse GetCloudStorageUpdateResponse()
		{
			return null;
		}

		public virtual DestinationList GetDestinationList()
		{
			return null;
		}

		public virtual InstalledApplicationList GetInstalledApplicationList()
		{
			return null;
		}

		public virtual LaunchBlockFlowResult GetLaunchBlockFlowResult()
		{
			return null;
		}

		public virtual LaunchFriendRequestFlowResult GetLaunchFriendRequestFlowResult()
		{
			return null;
		}

		public virtual LaunchReportFlowResult GetLaunchReportFlowResult()
		{
			return null;
		}

		public virtual LaunchUnblockFlowResult GetLaunchUnblockFlowResult()
		{
			return null;
		}

		public virtual bool GetLeaderboardDidUpdate()
		{
			return false;
		}

		public virtual LeaderboardEntryList GetLeaderboardEntryList()
		{
			return null;
		}

		public virtual LinkedAccountList GetLinkedAccountList()
		{
			return null;
		}

		public virtual LivestreamingApplicationStatus GetLivestreamingApplicationStatus()
		{
			return null;
		}

		public virtual LivestreamingStartResult GetLivestreamingStartResult()
		{
			return null;
		}

		public virtual LivestreamingStatus GetLivestreamingStatus()
		{
			return null;
		}

		public virtual LivestreamingVideoStats GetLivestreamingVideoStats()
		{
			return null;
		}

		public virtual MatchmakingAdminSnapshot GetMatchmakingAdminSnapshot()
		{
			return null;
		}

		public virtual MatchmakingBrowseResult GetMatchmakingBrowseResult()
		{
			return null;
		}

		public virtual MatchmakingEnqueueResult GetMatchmakingEnqueueResult()
		{
			return null;
		}

		public virtual MatchmakingEnqueueResultAndRoom GetMatchmakingEnqueueResultAndRoom()
		{
			return null;
		}

		public virtual MatchmakingStats GetMatchmakingStats()
		{
			return null;
		}

		public virtual OrgScopedID GetOrgScopedID()
		{
			return null;
		}

		public virtual Party GetParty()
		{
			return null;
		}

		public virtual PartyID GetPartyID()
		{
			return null;
		}

		public virtual PartyUpdateNotification GetPartyUpdateNotification()
		{
			return null;
		}

		public virtual PidList GetPidList()
		{
			return null;
		}

		public virtual ProductList GetProductList()
		{
			return null;
		}

		public virtual Purchase GetPurchase()
		{
			return null;
		}

		public virtual PurchaseList GetPurchaseList()
		{
			return null;
		}

		public virtual Oculus.Platform.Models.Room GetRoom()
		{
			return null;
		}

		public virtual RoomInviteNotification GetRoomInviteNotification()
		{
			return null;
		}

		public virtual RoomInviteNotificationList GetRoomInviteNotificationList()
		{
			return null;
		}

		public virtual Oculus.Platform.Models.RoomList GetRoomList()
		{
			return null;
		}

		public virtual SdkAccountList GetSdkAccountList()
		{
			return null;
		}

		public virtual ShareMediaResult GetShareMediaResult()
		{
			return null;
		}

		public virtual string GetString()
		{
			return null;
		}

		public virtual SystemPermission GetSystemPermission()
		{
			return null;
		}

		public virtual SystemVoipState GetSystemVoipState()
		{
			return null;
		}

		public virtual User GetUser()
		{
			return null;
		}

		public virtual UserAndRoomList GetUserAndRoomList()
		{
			return null;
		}

		public virtual UserList GetUserList()
		{
			return null;
		}

		public virtual UserProof GetUserProof()
		{
			return null;
		}

		public virtual UserReportID GetUserReportID()
		{
			return null;
		}

		internal static Message ParseMessageHandle(IntPtr messageHandle)
		{
			if (messageHandle.ToInt64() == 0L)
			{
				return null;
			}
			Message message = null;
			MessageType messageType = CAPI.ovr_Message_GetType(messageHandle);
			switch (messageType)
			{
			case MessageType.Achievements_GetAllDefinitions:
			case MessageType.Achievements_GetNextAchievementDefinitionArrayPage:
			case MessageType.Achievements_GetDefinitionsByName:
				message = new MessageWithAchievementDefinitions(messageHandle);
				break;
			case MessageType.Achievements_GetProgressByName:
			case MessageType.Achievements_GetNextAchievementProgressArrayPage:
			case MessageType.Achievements_GetAllProgress:
				message = new MessageWithAchievementProgressList(messageHandle);
				break;
			case MessageType.Achievements_AddCount:
			case MessageType.Achievements_AddFields:
			case MessageType.Achievements_Unlock:
				message = new MessageWithAchievementUpdate(messageHandle);
				break;
			case MessageType.Application_GetVersion:
				message = new MessageWithApplicationVersion(messageHandle);
				break;
			case MessageType.AssetFile_Status:
			case MessageType.LanguagePack_GetCurrent:
			case MessageType.AssetFile_StatusByName:
			case MessageType.AssetFile_StatusById:
				message = new MessageWithAssetDetails(messageHandle);
				break;
			case MessageType.AssetFile_GetList:
				message = new MessageWithAssetDetailsList(messageHandle);
				break;
			case MessageType.AssetFile_DeleteByName:
			case MessageType.AssetFile_DeleteById:
			case MessageType.AssetFile_Delete:
				message = new MessageWithAssetFileDeleteResult(messageHandle);
				break;
			case MessageType.AssetFile_DownloadCancel:
			case MessageType.AssetFile_DownloadCancelByName:
			case MessageType.AssetFile_DownloadCancelById:
				message = new MessageWithAssetFileDownloadCancelResult(messageHandle);
				break;
			case MessageType.AssetFile_Download:
			case MessageType.AssetFile_DownloadById:
			case MessageType.LanguagePack_SetCurrent:
			case MessageType.AssetFile_DownloadByName:
				message = new MessageWithAssetFileDownloadResult(messageHandle);
				break;
			case MessageType.Notification_AssetFile_DownloadUpdate:
				message = new MessageWithAssetFileDownloadUpdate(messageHandle);
				break;
			case MessageType.Notification_Cal_FinalizeApplication:
				message = new MessageWithCalApplicationFinalized(messageHandle);
				break;
			case MessageType.Notification_Cal_ProposeApplication:
				message = new MessageWithCalApplicationProposed(messageHandle);
				break;
			case MessageType.CloudStorage_LoadConflictMetadata:
				message = new MessageWithCloudStorageConflictMetadata(messageHandle);
				break;
			case MessageType.CloudStorage_LoadHandle:
			case MessageType.CloudStorage_Load:
				message = new MessageWithCloudStorageData(messageHandle);
				break;
			case MessageType.CloudStorage_LoadMetadata:
				message = new MessageWithCloudStorageMetadataUnderLocal(messageHandle);
				break;
			case MessageType.CloudStorage_GetNextCloudStorageMetadataArrayPage:
			case MessageType.CloudStorage_LoadBucketMetadata:
				message = new MessageWithCloudStorageMetadataList(messageHandle);
				break;
			case MessageType.CloudStorage_Delete:
			case MessageType.CloudStorage_ResolveKeepLocal:
			case MessageType.CloudStorage_Save:
			case MessageType.CloudStorage_ResolveKeepRemote:
				message = new MessageWithCloudStorageUpdateResponse(messageHandle);
				break;
			case MessageType.RichPresence_GetDestinations:
			case MessageType.RichPresence_GetNextDestinationArrayPage:
				message = new MessageWithDestinationList(messageHandle);
				break;
			case MessageType.User_LaunchProfile:
			case MessageType.Matchmaking_Cancel2:
			case MessageType.Entitlement_GetIsViewerEntitled:
			case MessageType.Matchmaking_ReportResultInsecure:
			case MessageType.IAP_ConsumePurchase:
			case MessageType.Matchmaking_Cancel:
			case MessageType.Room_LaunchInvitableUserFlow:
			case MessageType.Room_UpdateOwner:
			case MessageType.RichPresence_Set:
			case MessageType.Matchmaking_StartMatch:
			case MessageType.ApplicationLifecycle_RegisterSessionKey:
			case MessageType.RichPresence_Clear:
			case MessageType.Notification_MarkAsRead:
				message = new Message(messageHandle);
				break;
			case MessageType.User_LaunchFriendRequestFlow:
				message = new MessageWithLaunchFriendRequestFlowResult(messageHandle);
				break;
			case MessageType.Leaderboard_GetEntriesAfterRank:
			case MessageType.Leaderboard_GetPreviousEntries:
			case MessageType.Leaderboard_GetNextEntries:
			case MessageType.Leaderboard_GetEntries:
				message = new MessageWithLeaderboardEntryList(messageHandle);
				break;
			case MessageType.Leaderboard_WriteEntry:
				message = new MessageWithLeaderboardDidUpdate(messageHandle);
				break;
			case MessageType.Notification_Livestreaming_StatusChange:
			case MessageType.Livestreaming_ResumeStream:
			case MessageType.Livestreaming_PauseStream:
			case MessageType.Livestreaming_GetStatus:
				message = new MessageWithLivestreamingStatus(messageHandle);
				break;
			case MessageType.Matchmaking_GetAdminSnapshot:
				message = new MessageWithMatchmakingAdminSnapshot(messageHandle);
				break;
			case MessageType.Matchmaking_Browse:
			case MessageType.Matchmaking_Browse2:
				message = new MessageWithMatchmakingBrowseResult(messageHandle);
				break;
			case MessageType.Matchmaking_Enqueue2:
			case MessageType.Matchmaking_Enqueue:
			case MessageType.Matchmaking_EnqueueRoom2:
			case MessageType.Matchmaking_EnqueueRoom:
				message = new MessageWithMatchmakingEnqueueResult(messageHandle);
				break;
			case MessageType.Matchmaking_CreateAndEnqueueRoom2:
			case MessageType.Matchmaking_CreateAndEnqueueRoom:
				message = new MessageWithMatchmakingEnqueueResultAndRoom(messageHandle);
				break;
			case MessageType.Matchmaking_GetStats:
				message = new MessageWithMatchmakingStatsUnderMatchmakingStats(messageHandle);
				break;
			case MessageType.User_GetOrgScopedID:
				message = new MessageWithOrgScopedID(messageHandle);
				break;
			case MessageType.Party_GetCurrent:
				message = new MessageWithPartyUnderCurrentParty(messageHandle);
				break;
			case MessageType.Notification_Party_PartyUpdate:
				message = new MessageWithPartyUpdateNotification(messageHandle);
				break;
			case MessageType.ApplicationLifecycle_GetRegisteredPIDs:
				message = new MessageWithPidList(messageHandle);
				break;
			case MessageType.IAP_GetNextProductArrayPage:
			case MessageType.IAP_GetProductsBySKU:
				message = new MessageWithProductList(messageHandle);
				break;
			case MessageType.IAP_LaunchCheckoutFlow:
				message = new MessageWithPurchase(messageHandle);
				break;
			case MessageType.IAP_GetViewerPurchases:
			case MessageType.IAP_GetNextPurchaseArrayPage:
			case MessageType.IAP_GetViewerPurchasesDurableCache:
				message = new MessageWithPurchaseList(messageHandle);
				break;
			case MessageType.Room_Get:
				message = new MessageWithRoom(messageHandle);
				break;
			case MessageType.Room_GetCurrent:
			case MessageType.Room_GetCurrentForUser:
				message = new MessageWithRoomUnderCurrentRoom(messageHandle);
				break;
			case MessageType.Room_UpdateDataStore:
			case MessageType.Matchmaking_CreateRoom:
			case MessageType.Room_UpdatePrivateRoomJoinPolicy:
			case MessageType.Room_Join:
			case MessageType.Room_SetDescription:
			case MessageType.Room_UpdateMembershipLockStatus:
			case MessageType.Room_InviteUser:
			case MessageType.Matchmaking_CreateRoom2:
			case MessageType.Room_KickUser:
			case MessageType.Matchmaking_JoinRoom:
			case MessageType.Room_Join2:
			case MessageType.Room_CreateAndJoinPrivate2:
			case MessageType.Notification_Room_RoomUpdate:
			case MessageType.Room_Leave:
			case MessageType.Room_CreateAndJoinPrivate:
				message = new MessageWithRoomUnderViewerRoom(messageHandle);
				break;
			case MessageType.Room_GetModeratedRooms:
			case MessageType.Room_GetNextRoomArrayPage:
				message = new MessageWithRoomList(messageHandle);
				break;
			case MessageType.Notification_Room_InviteReceived:
				message = new MessageWithRoomInviteNotification(messageHandle);
				break;
			case MessageType.Notification_GetNextRoomInviteNotificationArrayPage:
			case MessageType.Notification_GetRoomInvites:
				message = new MessageWithRoomInviteNotificationList(messageHandle);
				break;
			case MessageType.User_GetSdkAccounts:
				message = new MessageWithSdkAccountList(messageHandle);
				break;
			case MessageType.Media_ShareToFacebook:
				message = new MessageWithShareMediaResult(messageHandle);
				break;
			case MessageType.Notification_ApplicationLifecycle_LaunchIntentChanged:
			case MessageType.User_GetAccessToken:
			case MessageType.ApplicationLifecycle_GetSessionKey:
			case MessageType.Application_LaunchOtherApp:
			case MessageType.Notification_Room_InviteAccepted:
			case MessageType.CloudStorage2_GetUserDirectoryPath:
				message = new MessageWithString(messageHandle);
				break;
			case MessageType.Voip_SetSystemVoipSuppressed:
				message = new MessageWithSystemVoipState(messageHandle);
				break;
			case MessageType.User_GetLoggedInUser:
			case MessageType.User_Get:
				message = new MessageWithUser(messageHandle);
				break;
			case MessageType.User_GetLoggedInUserRecentlyMetUsersAndRooms:
			case MessageType.User_GetLoggedInUserFriendsAndRooms:
			case MessageType.User_GetNextUserAndRoomArrayPage:
				message = new MessageWithUserAndRoomList(messageHandle);
				break;
			case MessageType.Room_GetInvitableUsers:
			case MessageType.User_GetNextUserArrayPage:
			case MessageType.Room_GetInvitableUsers2:
			case MessageType.User_GetLoggedInUserFriends:
				message = new MessageWithUserList(messageHandle);
				break;
			case MessageType.User_GetUserProof:
				message = new MessageWithUserProof(messageHandle);
				break;
			case MessageType.Notification_Networking_PeerConnectRequest:
			case MessageType.Notification_Networking_ConnectionStateChange:
				message = new MessageWithNetworkingPeer(messageHandle);
				break;
			case MessageType.Notification_Networking_PingResult:
				message = new MessageWithPingResult(messageHandle);
				break;
			case MessageType.Notification_Matchmaking_MatchFound:
				message = new MessageWithMatchmakingNotification(messageHandle);
				break;
			case MessageType.Notification_Voip_StateChange:
			case MessageType.Notification_Voip_ConnectRequest:
				message = new MessageWithNetworkingPeer(messageHandle);
				break;
			case MessageType.Notification_Voip_SystemVoipState:
				message = new MessageWithSystemVoipState(messageHandle);
				break;
			case MessageType.Notification_HTTP_Transfer:
				message = new MessageWithHttpTransferUpdate(messageHandle);
				break;
			case MessageType.Platform_InitializeAndroidAsynchronous:
			case MessageType.Platform_InitializeWithAccessToken:
			case MessageType.Platform_InitializeStandaloneOculus:
			case MessageType.Platform_InitializeWindowsAsynchronous:
				message = new MessageWithPlatformInitialize(messageHandle);
				break;
			default:
				message = PlatformInternal.ParseMessageHandle(messageHandle, messageType);
				if (message == null)
				{
					UnityEngine.Debug.LogError($"Unrecognized message type {messageType}\n");
				}
				break;
			}
			return message;
		}

		public static Message PopMessage()
		{
			if (!Core.IsInitialized())
			{
				return null;
			}
			IntPtr intPtr = CAPI.ovr_PopMessage();
			Message result = ParseMessageHandle(intPtr);
			CAPI.ovr_FreeMessage(intPtr);
			return result;
		}
	}
	public class MessageWithAbuseReportRecording : Message<AbuseReportRecording>
	{
		public MessageWithAbuseReportRecording(IntPtr c_message)
			: base(c_message)
		{
		}

		public override AbuseReportRecording GetAbuseReportRecording()
		{
			return base.Data;
		}

		protected override AbuseReportRecording GetDataFromMessage(IntPtr c_message)
		{
			return new AbuseReportRecording(CAPI.ovr_Message_GetAbuseReportRecording(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithAchievementDefinitions : Message<AchievementDefinitionList>
	{
		public MessageWithAchievementDefinitions(IntPtr c_message)
			: base(c_message)
		{
		}

		public override AchievementDefinitionList GetAchievementDefinitions()
		{
			return base.Data;
		}

		protected override AchievementDefinitionList GetDataFromMessage(IntPtr c_message)
		{
			return new AchievementDefinitionList(CAPI.ovr_Message_GetAchievementDefinitionArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithAchievementProgressList : Message<AchievementProgressList>
	{
		public MessageWithAchievementProgressList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override AchievementProgressList GetAchievementProgressList()
		{
			return base.Data;
		}

		protected override AchievementProgressList GetDataFromMessage(IntPtr c_message)
		{
			return new AchievementProgressList(CAPI.ovr_Message_GetAchievementProgressArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithAchievementUpdate : Message<AchievementUpdate>
	{
		public MessageWithAchievementUpdate(IntPtr c_message)
			: base(c_message)
		{
		}

		public override AchievementUpdate GetAchievementUpdate()
		{
			return base.Data;
		}

		protected override AchievementUpdate GetDataFromMessage(IntPtr c_message)
		{
			return new AchievementUpdate(CAPI.ovr_Message_GetAchievementUpdate(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithApplicationVersion : Message<ApplicationVersion>
	{
		public MessageWithApplicationVersion(IntPtr c_message)
			: base(c_message)
		{
		}

		public override ApplicationVersion GetApplicationVersion()
		{
			return base.Data;
		}

		protected override ApplicationVersion GetDataFromMessage(IntPtr c_message)
		{
			return new ApplicationVersion(CAPI.ovr_Message_GetApplicationVersion(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithAssetDetails : Message<AssetDetails>
	{
		public MessageWithAssetDetails(IntPtr c_message)
			: base(c_message)
		{
		}

		public override AssetDetails GetAssetDetails()
		{
			return base.Data;
		}

		protected override AssetDetails GetDataFromMessage(IntPtr c_message)
		{
			return new AssetDetails(CAPI.ovr_Message_GetAssetDetails(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithAssetDetailsList : Message<AssetDetailsList>
	{
		public MessageWithAssetDetailsList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override AssetDetailsList GetAssetDetailsList()
		{
			return base.Data;
		}

		protected override AssetDetailsList GetDataFromMessage(IntPtr c_message)
		{
			return new AssetDetailsList(CAPI.ovr_Message_GetAssetDetailsArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithAssetFileDeleteResult : Message<AssetFileDeleteResult>
	{
		public MessageWithAssetFileDeleteResult(IntPtr c_message)
			: base(c_message)
		{
		}

		public override AssetFileDeleteResult GetAssetFileDeleteResult()
		{
			return base.Data;
		}

		protected override AssetFileDeleteResult GetDataFromMessage(IntPtr c_message)
		{
			return new AssetFileDeleteResult(CAPI.ovr_Message_GetAssetFileDeleteResult(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithAssetFileDownloadCancelResult : Message<AssetFileDownloadCancelResult>
	{
		public MessageWithAssetFileDownloadCancelResult(IntPtr c_message)
			: base(c_message)
		{
		}

		public override AssetFileDownloadCancelResult GetAssetFileDownloadCancelResult()
		{
			return base.Data;
		}

		protected override AssetFileDownloadCancelResult GetDataFromMessage(IntPtr c_message)
		{
			return new AssetFileDownloadCancelResult(CAPI.ovr_Message_GetAssetFileDownloadCancelResult(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithAssetFileDownloadResult : Message<AssetFileDownloadResult>
	{
		public MessageWithAssetFileDownloadResult(IntPtr c_message)
			: base(c_message)
		{
		}

		public override AssetFileDownloadResult GetAssetFileDownloadResult()
		{
			return base.Data;
		}

		protected override AssetFileDownloadResult GetDataFromMessage(IntPtr c_message)
		{
			return new AssetFileDownloadResult(CAPI.ovr_Message_GetAssetFileDownloadResult(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithAssetFileDownloadUpdate : Message<AssetFileDownloadUpdate>
	{
		public MessageWithAssetFileDownloadUpdate(IntPtr c_message)
			: base(c_message)
		{
		}

		public override AssetFileDownloadUpdate GetAssetFileDownloadUpdate()
		{
			return base.Data;
		}

		protected override AssetFileDownloadUpdate GetDataFromMessage(IntPtr c_message)
		{
			return new AssetFileDownloadUpdate(CAPI.ovr_Message_GetAssetFileDownloadUpdate(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithCalApplicationFinalized : Message<CalApplicationFinalized>
	{
		public MessageWithCalApplicationFinalized(IntPtr c_message)
			: base(c_message)
		{
		}

		public override CalApplicationFinalized GetCalApplicationFinalized()
		{
			return base.Data;
		}

		protected override CalApplicationFinalized GetDataFromMessage(IntPtr c_message)
		{
			return new CalApplicationFinalized(CAPI.ovr_Message_GetCalApplicationFinalized(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithCalApplicationProposed : Message<CalApplicationProposed>
	{
		public MessageWithCalApplicationProposed(IntPtr c_message)
			: base(c_message)
		{
		}

		public override CalApplicationProposed GetCalApplicationProposed()
		{
			return base.Data;
		}

		protected override CalApplicationProposed GetDataFromMessage(IntPtr c_message)
		{
			return new CalApplicationProposed(CAPI.ovr_Message_GetCalApplicationProposed(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithCalApplicationSuggestionList : Message<CalApplicationSuggestionList>
	{
		public MessageWithCalApplicationSuggestionList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override CalApplicationSuggestionList GetCalApplicationSuggestionList()
		{
			return base.Data;
		}

		protected override CalApplicationSuggestionList GetDataFromMessage(IntPtr c_message)
		{
			return new CalApplicationSuggestionList(CAPI.ovr_Message_GetCalApplicationSuggestionArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithCloudStorageConflictMetadata : Message<CloudStorageConflictMetadata>
	{
		public MessageWithCloudStorageConflictMetadata(IntPtr c_message)
			: base(c_message)
		{
		}

		public override CloudStorageConflictMetadata GetCloudStorageConflictMetadata()
		{
			return base.Data;
		}

		protected override CloudStorageConflictMetadata GetDataFromMessage(IntPtr c_message)
		{
			return new CloudStorageConflictMetadata(CAPI.ovr_Message_GetCloudStorageConflictMetadata(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithCloudStorageData : Message<CloudStorageData>
	{
		public MessageWithCloudStorageData(IntPtr c_message)
			: base(c_message)
		{
		}

		public override CloudStorageData GetCloudStorageData()
		{
			return base.Data;
		}

		protected override CloudStorageData GetDataFromMessage(IntPtr c_message)
		{
			return new CloudStorageData(CAPI.ovr_Message_GetCloudStorageData(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithCloudStorageMetadataUnderLocal : Message<CloudStorageMetadata>
	{
		public MessageWithCloudStorageMetadataUnderLocal(IntPtr c_message)
			: base(c_message)
		{
		}

		public override CloudStorageMetadata GetCloudStorageMetadata()
		{
			return base.Data;
		}

		protected override CloudStorageMetadata GetDataFromMessage(IntPtr c_message)
		{
			return new CloudStorageMetadata(CAPI.ovr_Message_GetCloudStorageMetadata(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithCloudStorageMetadataList : Message<CloudStorageMetadataList>
	{
		public MessageWithCloudStorageMetadataList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override CloudStorageMetadataList GetCloudStorageMetadataList()
		{
			return base.Data;
		}

		protected override CloudStorageMetadataList GetDataFromMessage(IntPtr c_message)
		{
			return new CloudStorageMetadataList(CAPI.ovr_Message_GetCloudStorageMetadataArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithCloudStorageUpdateResponse : Message<CloudStorageUpdateResponse>
	{
		public MessageWithCloudStorageUpdateResponse(IntPtr c_message)
			: base(c_message)
		{
		}

		public override CloudStorageUpdateResponse GetCloudStorageUpdateResponse()
		{
			return base.Data;
		}

		protected override CloudStorageUpdateResponse GetDataFromMessage(IntPtr c_message)
		{
			return new CloudStorageUpdateResponse(CAPI.ovr_Message_GetCloudStorageUpdateResponse(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithDestinationList : Message<DestinationList>
	{
		public MessageWithDestinationList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override DestinationList GetDestinationList()
		{
			return base.Data;
		}

		protected override DestinationList GetDataFromMessage(IntPtr c_message)
		{
			return new DestinationList(CAPI.ovr_Message_GetDestinationArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithInstalledApplicationList : Message<InstalledApplicationList>
	{
		public MessageWithInstalledApplicationList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override InstalledApplicationList GetInstalledApplicationList()
		{
			return base.Data;
		}

		protected override InstalledApplicationList GetDataFromMessage(IntPtr c_message)
		{
			return new InstalledApplicationList(CAPI.ovr_Message_GetInstalledApplicationArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithLaunchBlockFlowResult : Message<LaunchBlockFlowResult>
	{
		public MessageWithLaunchBlockFlowResult(IntPtr c_message)
			: base(c_message)
		{
		}

		public override LaunchBlockFlowResult GetLaunchBlockFlowResult()
		{
			return base.Data;
		}

		protected override LaunchBlockFlowResult GetDataFromMessage(IntPtr c_message)
		{
			return new LaunchBlockFlowResult(CAPI.ovr_Message_GetLaunchBlockFlowResult(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithLaunchFriendRequestFlowResult : Message<LaunchFriendRequestFlowResult>
	{
		public MessageWithLaunchFriendRequestFlowResult(IntPtr c_message)
			: base(c_message)
		{
		}

		public override LaunchFriendRequestFlowResult GetLaunchFriendRequestFlowResult()
		{
			return base.Data;
		}

		protected override LaunchFriendRequestFlowResult GetDataFromMessage(IntPtr c_message)
		{
			return new LaunchFriendRequestFlowResult(CAPI.ovr_Message_GetLaunchFriendRequestFlowResult(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithLaunchReportFlowResult : Message<LaunchReportFlowResult>
	{
		public MessageWithLaunchReportFlowResult(IntPtr c_message)
			: base(c_message)
		{
		}

		public override LaunchReportFlowResult GetLaunchReportFlowResult()
		{
			return base.Data;
		}

		protected override LaunchReportFlowResult GetDataFromMessage(IntPtr c_message)
		{
			return new LaunchReportFlowResult(CAPI.ovr_Message_GetLaunchReportFlowResult(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithLaunchUnblockFlowResult : Message<LaunchUnblockFlowResult>
	{
		public MessageWithLaunchUnblockFlowResult(IntPtr c_message)
			: base(c_message)
		{
		}

		public override LaunchUnblockFlowResult GetLaunchUnblockFlowResult()
		{
			return base.Data;
		}

		protected override LaunchUnblockFlowResult GetDataFromMessage(IntPtr c_message)
		{
			return new LaunchUnblockFlowResult(CAPI.ovr_Message_GetLaunchUnblockFlowResult(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithLeaderboardEntryList : Message<LeaderboardEntryList>
	{
		public MessageWithLeaderboardEntryList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override LeaderboardEntryList GetLeaderboardEntryList()
		{
			return base.Data;
		}

		protected override LeaderboardEntryList GetDataFromMessage(IntPtr c_message)
		{
			return new LeaderboardEntryList(CAPI.ovr_Message_GetLeaderboardEntryArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithLinkedAccountList : Message<LinkedAccountList>
	{
		public MessageWithLinkedAccountList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override LinkedAccountList GetLinkedAccountList()
		{
			return base.Data;
		}

		protected override LinkedAccountList GetDataFromMessage(IntPtr c_message)
		{
			return new LinkedAccountList(CAPI.ovr_Message_GetLinkedAccountArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithLivestreamingApplicationStatus : Message<LivestreamingApplicationStatus>
	{
		public MessageWithLivestreamingApplicationStatus(IntPtr c_message)
			: base(c_message)
		{
		}

		public override LivestreamingApplicationStatus GetLivestreamingApplicationStatus()
		{
			return base.Data;
		}

		protected override LivestreamingApplicationStatus GetDataFromMessage(IntPtr c_message)
		{
			return new LivestreamingApplicationStatus(CAPI.ovr_Message_GetLivestreamingApplicationStatus(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithLivestreamingStartResult : Message<LivestreamingStartResult>
	{
		public MessageWithLivestreamingStartResult(IntPtr c_message)
			: base(c_message)
		{
		}

		public override LivestreamingStartResult GetLivestreamingStartResult()
		{
			return base.Data;
		}

		protected override LivestreamingStartResult GetDataFromMessage(IntPtr c_message)
		{
			return new LivestreamingStartResult(CAPI.ovr_Message_GetLivestreamingStartResult(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithLivestreamingStatus : Message<LivestreamingStatus>
	{
		public MessageWithLivestreamingStatus(IntPtr c_message)
			: base(c_message)
		{
		}

		public override LivestreamingStatus GetLivestreamingStatus()
		{
			return base.Data;
		}

		protected override LivestreamingStatus GetDataFromMessage(IntPtr c_message)
		{
			return new LivestreamingStatus(CAPI.ovr_Message_GetLivestreamingStatus(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithLivestreamingVideoStats : Message<LivestreamingVideoStats>
	{
		public MessageWithLivestreamingVideoStats(IntPtr c_message)
			: base(c_message)
		{
		}

		public override LivestreamingVideoStats GetLivestreamingVideoStats()
		{
			return base.Data;
		}

		protected override LivestreamingVideoStats GetDataFromMessage(IntPtr c_message)
		{
			return new LivestreamingVideoStats(CAPI.ovr_Message_GetLivestreamingVideoStats(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithMatchmakingAdminSnapshot : Message<MatchmakingAdminSnapshot>
	{
		public MessageWithMatchmakingAdminSnapshot(IntPtr c_message)
			: base(c_message)
		{
		}

		public override MatchmakingAdminSnapshot GetMatchmakingAdminSnapshot()
		{
			return base.Data;
		}

		protected override MatchmakingAdminSnapshot GetDataFromMessage(IntPtr c_message)
		{
			return new MatchmakingAdminSnapshot(CAPI.ovr_Message_GetMatchmakingAdminSnapshot(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithMatchmakingEnqueueResult : Message<MatchmakingEnqueueResult>
	{
		public MessageWithMatchmakingEnqueueResult(IntPtr c_message)
			: base(c_message)
		{
		}

		public override MatchmakingEnqueueResult GetMatchmakingEnqueueResult()
		{
			return base.Data;
		}

		protected override MatchmakingEnqueueResult GetDataFromMessage(IntPtr c_message)
		{
			return new MatchmakingEnqueueResult(CAPI.ovr_Message_GetMatchmakingEnqueueResult(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithMatchmakingEnqueueResultAndRoom : Message<MatchmakingEnqueueResultAndRoom>
	{
		public MessageWithMatchmakingEnqueueResultAndRoom(IntPtr c_message)
			: base(c_message)
		{
		}

		public override MatchmakingEnqueueResultAndRoom GetMatchmakingEnqueueResultAndRoom()
		{
			return base.Data;
		}

		protected override MatchmakingEnqueueResultAndRoom GetDataFromMessage(IntPtr c_message)
		{
			return new MatchmakingEnqueueResultAndRoom(CAPI.ovr_Message_GetMatchmakingEnqueueResultAndRoom(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithMatchmakingStatsUnderMatchmakingStats : Message<MatchmakingStats>
	{
		public MessageWithMatchmakingStatsUnderMatchmakingStats(IntPtr c_message)
			: base(c_message)
		{
		}

		public override MatchmakingStats GetMatchmakingStats()
		{
			return base.Data;
		}

		protected override MatchmakingStats GetDataFromMessage(IntPtr c_message)
		{
			return new MatchmakingStats(CAPI.ovr_Message_GetMatchmakingStats(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithOrgScopedID : Message<OrgScopedID>
	{
		public MessageWithOrgScopedID(IntPtr c_message)
			: base(c_message)
		{
		}

		public override OrgScopedID GetOrgScopedID()
		{
			return base.Data;
		}

		protected override OrgScopedID GetDataFromMessage(IntPtr c_message)
		{
			return new OrgScopedID(CAPI.ovr_Message_GetOrgScopedID(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithParty : Message<Party>
	{
		public MessageWithParty(IntPtr c_message)
			: base(c_message)
		{
		}

		public override Party GetParty()
		{
			return base.Data;
		}

		protected override Party GetDataFromMessage(IntPtr c_message)
		{
			return new Party(CAPI.ovr_Message_GetParty(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithPartyUnderCurrentParty : Message<Party>
	{
		public MessageWithPartyUnderCurrentParty(IntPtr c_message)
			: base(c_message)
		{
		}

		public override Party GetParty()
		{
			return base.Data;
		}

		protected override Party GetDataFromMessage(IntPtr c_message)
		{
			return new Party(CAPI.ovr_Message_GetParty(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithPartyID : Message<PartyID>
	{
		public MessageWithPartyID(IntPtr c_message)
			: base(c_message)
		{
		}

		public override PartyID GetPartyID()
		{
			return base.Data;
		}

		protected override PartyID GetDataFromMessage(IntPtr c_message)
		{
			return new PartyID(CAPI.ovr_Message_GetPartyID(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithPartyUpdateNotification : Message<PartyUpdateNotification>
	{
		public MessageWithPartyUpdateNotification(IntPtr c_message)
			: base(c_message)
		{
		}

		public override PartyUpdateNotification GetPartyUpdateNotification()
		{
			return base.Data;
		}

		protected override PartyUpdateNotification GetDataFromMessage(IntPtr c_message)
		{
			return new PartyUpdateNotification(CAPI.ovr_Message_GetPartyUpdateNotification(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithPidList : Message<PidList>
	{
		public MessageWithPidList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override PidList GetPidList()
		{
			return base.Data;
		}

		protected override PidList GetDataFromMessage(IntPtr c_message)
		{
			return new PidList(CAPI.ovr_Message_GetPidArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithProductList : Message<ProductList>
	{
		public MessageWithProductList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override ProductList GetProductList()
		{
			return base.Data;
		}

		protected override ProductList GetDataFromMessage(IntPtr c_message)
		{
			return new ProductList(CAPI.ovr_Message_GetProductArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithPurchase : Message<Purchase>
	{
		public MessageWithPurchase(IntPtr c_message)
			: base(c_message)
		{
		}

		public override Purchase GetPurchase()
		{
			return base.Data;
		}

		protected override Purchase GetDataFromMessage(IntPtr c_message)
		{
			return new Purchase(CAPI.ovr_Message_GetPurchase(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithPurchaseList : Message<PurchaseList>
	{
		public MessageWithPurchaseList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override PurchaseList GetPurchaseList()
		{
			return base.Data;
		}

		protected override PurchaseList GetDataFromMessage(IntPtr c_message)
		{
			return new PurchaseList(CAPI.ovr_Message_GetPurchaseArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithRoom : Message<Oculus.Platform.Models.Room>
	{
		public MessageWithRoom(IntPtr c_message)
			: base(c_message)
		{
		}

		public override Oculus.Platform.Models.Room GetRoom()
		{
			return base.Data;
		}

		protected override Oculus.Platform.Models.Room GetDataFromMessage(IntPtr c_message)
		{
			return new Oculus.Platform.Models.Room(CAPI.ovr_Message_GetRoom(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithRoomUnderCurrentRoom : Message<Oculus.Platform.Models.Room>
	{
		public MessageWithRoomUnderCurrentRoom(IntPtr c_message)
			: base(c_message)
		{
		}

		public override Oculus.Platform.Models.Room GetRoom()
		{
			return base.Data;
		}

		protected override Oculus.Platform.Models.Room GetDataFromMessage(IntPtr c_message)
		{
			return new Oculus.Platform.Models.Room(CAPI.ovr_Message_GetRoom(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithRoomUnderViewerRoom : Message<Oculus.Platform.Models.Room>
	{
		public MessageWithRoomUnderViewerRoom(IntPtr c_message)
			: base(c_message)
		{
		}

		public override Oculus.Platform.Models.Room GetRoom()
		{
			return base.Data;
		}

		protected override Oculus.Platform.Models.Room GetDataFromMessage(IntPtr c_message)
		{
			return new Oculus.Platform.Models.Room(CAPI.ovr_Message_GetRoom(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithRoomList : Message<Oculus.Platform.Models.RoomList>
	{
		public MessageWithRoomList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override Oculus.Platform.Models.RoomList GetRoomList()
		{
			return base.Data;
		}

		protected override Oculus.Platform.Models.RoomList GetDataFromMessage(IntPtr c_message)
		{
			return new Oculus.Platform.Models.RoomList(CAPI.ovr_Message_GetRoomArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithRoomInviteNotification : Message<RoomInviteNotification>
	{
		public MessageWithRoomInviteNotification(IntPtr c_message)
			: base(c_message)
		{
		}

		public override RoomInviteNotification GetRoomInviteNotification()
		{
			return base.Data;
		}

		protected override RoomInviteNotification GetDataFromMessage(IntPtr c_message)
		{
			return new RoomInviteNotification(CAPI.ovr_Message_GetRoomInviteNotification(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithRoomInviteNotificationList : Message<RoomInviteNotificationList>
	{
		public MessageWithRoomInviteNotificationList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override RoomInviteNotificationList GetRoomInviteNotificationList()
		{
			return base.Data;
		}

		protected override RoomInviteNotificationList GetDataFromMessage(IntPtr c_message)
		{
			return new RoomInviteNotificationList(CAPI.ovr_Message_GetRoomInviteNotificationArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithSdkAccountList : Message<SdkAccountList>
	{
		public MessageWithSdkAccountList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override SdkAccountList GetSdkAccountList()
		{
			return base.Data;
		}

		protected override SdkAccountList GetDataFromMessage(IntPtr c_message)
		{
			return new SdkAccountList(CAPI.ovr_Message_GetSdkAccountArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithShareMediaResult : Message<ShareMediaResult>
	{
		public MessageWithShareMediaResult(IntPtr c_message)
			: base(c_message)
		{
		}

		public override ShareMediaResult GetShareMediaResult()
		{
			return base.Data;
		}

		protected override ShareMediaResult GetDataFromMessage(IntPtr c_message)
		{
			return new ShareMediaResult(CAPI.ovr_Message_GetShareMediaResult(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithString : Message<string>
	{
		public MessageWithString(IntPtr c_message)
			: base(c_message)
		{
		}

		public override string GetString()
		{
			return base.Data;
		}

		protected override string GetDataFromMessage(IntPtr c_message)
		{
			return CAPI.ovr_Message_GetString(c_message);
		}
	}
	public class MessageWithSystemPermission : Message<SystemPermission>
	{
		public MessageWithSystemPermission(IntPtr c_message)
			: base(c_message)
		{
		}

		public override SystemPermission GetSystemPermission()
		{
			return base.Data;
		}

		protected override SystemPermission GetDataFromMessage(IntPtr c_message)
		{
			return new SystemPermission(CAPI.ovr_Message_GetSystemPermission(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithSystemVoipState : Message<SystemVoipState>
	{
		public MessageWithSystemVoipState(IntPtr c_message)
			: base(c_message)
		{
		}

		public override SystemVoipState GetSystemVoipState()
		{
			return base.Data;
		}

		protected override SystemVoipState GetDataFromMessage(IntPtr c_message)
		{
			return new SystemVoipState(CAPI.ovr_Message_GetSystemVoipState(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithUser : Message<User>
	{
		public MessageWithUser(IntPtr c_message)
			: base(c_message)
		{
		}

		public override User GetUser()
		{
			return base.Data;
		}

		protected override User GetDataFromMessage(IntPtr c_message)
		{
			return new User(CAPI.ovr_Message_GetUser(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithUserAndRoomList : Message<UserAndRoomList>
	{
		public MessageWithUserAndRoomList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override UserAndRoomList GetUserAndRoomList()
		{
			return base.Data;
		}

		protected override UserAndRoomList GetDataFromMessage(IntPtr c_message)
		{
			return new UserAndRoomList(CAPI.ovr_Message_GetUserAndRoomArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithUserList : Message<UserList>
	{
		public MessageWithUserList(IntPtr c_message)
			: base(c_message)
		{
		}

		public override UserList GetUserList()
		{
			return base.Data;
		}

		protected override UserList GetDataFromMessage(IntPtr c_message)
		{
			return new UserList(CAPI.ovr_Message_GetUserArray(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithUserProof : Message<UserProof>
	{
		public MessageWithUserProof(IntPtr c_message)
			: base(c_message)
		{
		}

		public override UserProof GetUserProof()
		{
			return base.Data;
		}

		protected override UserProof GetDataFromMessage(IntPtr c_message)
		{
			return new UserProof(CAPI.ovr_Message_GetUserProof(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithUserReportID : Message<UserReportID>
	{
		public MessageWithUserReportID(IntPtr c_message)
			: base(c_message)
		{
		}

		public override UserReportID GetUserReportID()
		{
			return base.Data;
		}

		protected override UserReportID GetDataFromMessage(IntPtr c_message)
		{
			return new UserReportID(CAPI.ovr_Message_GetUserReportID(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithNetworkingPeer : Message<NetworkingPeer>
	{
		public MessageWithNetworkingPeer(IntPtr c_message)
			: base(c_message)
		{
		}

		public override NetworkingPeer GetNetworkingPeer()
		{
			return base.Data;
		}

		protected override NetworkingPeer GetDataFromMessage(IntPtr c_message)
		{
			IntPtr obj = CAPI.ovr_Message_GetNetworkingPeer(c_message);
			return new NetworkingPeer(CAPI.ovr_NetworkingPeer_GetID(obj), CAPI.ovr_NetworkingPeer_GetState(obj));
		}
	}
	public class MessageWithPingResult : Message<PingResult>
	{
		public MessageWithPingResult(IntPtr c_message)
			: base(c_message)
		{
		}

		public override PingResult GetPingResult()
		{
			return base.Data;
		}

		protected override PingResult GetDataFromMessage(IntPtr c_message)
		{
			IntPtr obj = CAPI.ovr_Message_GetPingResult(c_message);
			bool flag = CAPI.ovr_PingResult_IsTimeout(obj);
			return new PingResult(CAPI.ovr_PingResult_GetID(obj), flag ? null : new ulong?(CAPI.ovr_PingResult_GetPingTimeUsec(obj)));
		}
	}
	public class MessageWithLeaderboardDidUpdate : Message<bool>
	{
		public MessageWithLeaderboardDidUpdate(IntPtr c_message)
			: base(c_message)
		{
		}

		public override bool GetLeaderboardDidUpdate()
		{
			return base.Data;
		}

		protected override bool GetDataFromMessage(IntPtr c_message)
		{
			return CAPI.ovr_LeaderboardUpdateStatus_GetDidUpdate(CAPI.ovr_Message_GetLeaderboardUpdateStatus(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithMatchmakingNotification : Message<Oculus.Platform.Models.Room>
	{
		public MessageWithMatchmakingNotification(IntPtr c_message)
			: base(c_message)
		{
		}

		public override Oculus.Platform.Models.Room GetRoom()
		{
			return base.Data;
		}

		protected override Oculus.Platform.Models.Room GetDataFromMessage(IntPtr c_message)
		{
			return new Oculus.Platform.Models.Room(CAPI.ovr_Message_GetRoom(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithMatchmakingBrowseResult : Message<MatchmakingBrowseResult>
	{
		public MessageWithMatchmakingBrowseResult(IntPtr c_message)
			: base(c_message)
		{
		}

		public override MatchmakingEnqueueResult GetMatchmakingEnqueueResult()
		{
			return base.Data.EnqueueResult;
		}

		public override Oculus.Platform.Models.RoomList GetRoomList()
		{
			return base.Data.Rooms;
		}

		protected override MatchmakingBrowseResult GetDataFromMessage(IntPtr c_message)
		{
			return new MatchmakingBrowseResult(CAPI.ovr_Message_GetMatchmakingBrowseResult(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithHttpTransferUpdate : Message<HttpTransferUpdate>
	{
		public MessageWithHttpTransferUpdate(IntPtr c_message)
			: base(c_message)
		{
		}

		public override HttpTransferUpdate GetHttpTransferUpdate()
		{
			return base.Data;
		}

		protected override HttpTransferUpdate GetDataFromMessage(IntPtr c_message)
		{
			return new HttpTransferUpdate(CAPI.ovr_Message_GetHttpTransferUpdate(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public class MessageWithPlatformInitialize : Message<PlatformInitialize>
	{
		public MessageWithPlatformInitialize(IntPtr c_message)
			: base(c_message)
		{
		}

		public override PlatformInitialize GetPlatformInitialize()
		{
			return base.Data;
		}

		protected override PlatformInitialize GetDataFromMessage(IntPtr c_message)
		{
			return new PlatformInitialize(CAPI.ovr_Message_GetPlatformInitialize(CAPI.ovr_Message_GetNativeMessage(c_message)));
		}
	}
	public sealed class Packet : IDisposable
	{
		private readonly ulong size;

		private readonly IntPtr packetHandle;

		public ulong SenderID => CAPI.ovr_Packet_GetSenderID(packetHandle);

		public ulong Size => size;

		public SendPolicy Policy => CAPI.ovr_Packet_GetSendPolicy(packetHandle);

		public Packet(IntPtr packetHandle)
		{
			this.packetHandle = packetHandle;
			size = (ulong)CAPI.ovr_Packet_GetSize(packetHandle);
		}

		public ulong ReadBytes(byte[] destination)
		{
			if ((ulong)destination.LongLength < size)
			{
				throw new ArgumentException($"Destination array was not big enough to hold {size} bytes");
			}
			Marshal.Copy(CAPI.ovr_Packet_GetBytes(packetHandle), destination, 0, (int)size);
			return size;
		}

		~Packet()
		{
			Dispose();
		}

		public void Dispose()
		{
			CAPI.ovr_Packet_Free(packetHandle);
			GC.SuppressFinalize(this);
		}
	}
	public enum PartyUpdateAction
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("Join")]
		Join,
		[Description("Leave")]
		Leave,
		[Description("Invite")]
		Invite,
		[Description("Uninvite")]
		Uninvite
	}
	public enum PeerConnectionState
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("CONNECTED")]
		Connected,
		[Description("TIMEOUT")]
		Timeout,
		[Description("CLOSED")]
		Closed
	}
	public enum PermissionGrantStatus
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("GRANTED")]
		Granted,
		[Description("DENIED")]
		Denied,
		[Description("BLOCKED")]
		Blocked
	}
	public enum PermissionType
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("MICROPHONE")]
		Microphone,
		[Description("WRITE_EXTERNAL_STORAGE")]
		WriteExternalStorage
	}
	public sealed class Core
	{
		private static bool IsPlatformInitialized;

		public static bool LogMessages;

		public static bool IsInitialized()
		{
			return IsPlatformInitialized;
		}

		internal static void ForceInitialized()
		{
			IsPlatformInitialized = true;
		}

		private static string getAppID(string appId = null)
		{
			string appIDFromConfig = GetAppIDFromConfig();
			if (string.IsNullOrEmpty(appId))
			{
				if (string.IsNullOrEmpty(appIDFromConfig))
				{
					throw new UnityException("Update your app id by selecting 'Oculus Platform' -> 'Edit Settings'");
				}
				appId = appIDFromConfig;
			}
			else if (!string.IsNullOrEmpty(appIDFromConfig))
			{
				UnityEngine.Debug.LogWarningFormat("The 'Oculus App Id ({0})' field in 'Oculus Platform/Edit Settings' is being overridden by the App Id ({1}) that you passed in to Platform.Core.Initialize.  You should only specify this in one place.  We recommend the menu location.", appIDFromConfig, appId);
			}
			return appId;
		}

		public static Request<PlatformInitialize> AsyncInitialize(string appId = null)
		{
			appId = getAppID(appId);
			Request<PlatformInitialize> request;
			if (UnityEngine.Application.isEditor && PlatformSettings.UseStandalonePlatform)
			{
				request = new StandalonePlatform().InitializeInEditor();
			}
			else if (UnityEngine.Application.platform == RuntimePlatform.WindowsEditor || UnityEngine.Application.platform == RuntimePlatform.WindowsPlayer)
			{
				request = new WindowsPlatform().AsyncInitialize(appId);
			}
			else
			{
				if (UnityEngine.Application.platform != RuntimePlatform.Android)
				{
					throw new NotImplementedException("Oculus platform is not implemented on this platform yet.");
				}
				request = new AndroidPlatform().AsyncInitialize(appId);
			}
			IsPlatformInitialized = request != null;
			if (!IsPlatformInitialized)
			{
				throw new UnityException("Oculus Platform failed to initialize.");
			}
			if (LogMessages)
			{
				UnityEngine.Debug.LogWarning("Oculus.Platform.Core.LogMessages is set to true. This will cause extra heap allocations, and should not be used outside of testing and debugging.");
			}
			new GameObject("Oculus.Platform.CallbackRunner").AddComponent<CallbackRunner>();
			return request;
		}

		public static void Initialize(string appId = null)
		{
			appId = getAppID(appId);
			if (UnityEngine.Application.isEditor && PlatformSettings.UseStandalonePlatform)
			{
				IsPlatformInitialized = new StandalonePlatform().InitializeInEditor() != null;
			}
			else if (UnityEngine.Application.platform == RuntimePlatform.WindowsEditor || UnityEngine.Application.platform == RuntimePlatform.WindowsPlayer)
			{
				IsPlatformInitialized = new WindowsPlatform().Initialize(appId);
			}
			else
			{
				if (UnityEngine.Application.platform != RuntimePlatform.Android)
				{
					throw new NotImplementedException("Oculus platform is not implemented on this platform yet.");
				}
				IsPlatformInitialized = new AndroidPlatform().Initialize(appId);
			}
			if (!IsPlatformInitialized)
			{
				throw new UnityException("Oculus Platform failed to initialize.");
			}
			if (LogMessages)
			{
				UnityEngine.Debug.LogWarning("Oculus.Platform.Core.LogMessages is set to true. This will cause extra heap allocations, and should not be used outside of testing and debugging.");
			}
			new GameObject("Oculus.Platform.CallbackRunner").AddComponent<CallbackRunner>();
		}

		private static string GetAppIDFromConfig()
		{
			if (UnityEngine.Application.platform == RuntimePlatform.Android)
			{
				return PlatformSettings.MobileAppID;
			}
			return PlatformSettings.AppID;
		}
	}
	public static class ApplicationLifecycle
	{
		public static LaunchDetails GetLaunchDetails()
		{
			return new LaunchDetails(CAPI.ovr_ApplicationLifecycle_GetLaunchDetails());
		}

		public static void SetLaunchIntentChangedNotificationCallback(Message<string>.Callback callback)
		{
			Callback.SetNotificationCallback(Message.MessageType.Notification_ApplicationLifecycle_LaunchIntentChanged, callback);
		}
	}
	public static class Rooms
	{
		public static Request<Oculus.Platform.Models.Room> UpdateDataStore(ulong roomID, Dictionary<string, string> data)
		{
			if (Core.IsInitialized())
			{
				CAPI.ovrKeyValuePair[] array = new CAPI.ovrKeyValuePair[data.Count];
				int num = 0;
				foreach (KeyValuePair<string, string> datum in data)
				{
					array[num++] = new CAPI.ovrKeyValuePair(datum.Key, datum.Value);
				}
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Room_UpdateDataStore(roomID, array));
			}
			return null;
		}

		[Obsolete("Deprecated in favor of SetRoomInviteAcceptedNotificationCallback")]
		public static void SetRoomInviteNotificationCallback(Message<string>.Callback callback)
		{
			SetRoomInviteAcceptedNotificationCallback(callback);
		}

		public static Request<Oculus.Platform.Models.Room> CreateAndJoinPrivate(RoomJoinPolicy joinPolicy, uint maxUsers, bool subscribeToUpdates = false)
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Room_CreateAndJoinPrivate(joinPolicy, maxUsers, subscribeToUpdates));
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.Room> CreateAndJoinPrivate2(RoomJoinPolicy joinPolicy, uint maxUsers, RoomOptions roomOptions)
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Room_CreateAndJoinPrivate2(joinPolicy, maxUsers, (IntPtr)roomOptions));
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.Room> Get(ulong roomID)
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Room_Get(roomID));
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.Room> GetCurrent()
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Room_GetCurrent());
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.Room> GetCurrentForUser(ulong userID)
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Room_GetCurrentForUser(userID));
			}
			return null;
		}

		public static Request<UserList> GetInvitableUsers()
		{
			if (Core.IsInitialized())
			{
				return new Request<UserList>(CAPI.ovr_Room_GetInvitableUsers());
			}
			return null;
		}

		public static Request<UserList> GetInvitableUsers2(RoomOptions roomOptions = null)
		{
			if (Core.IsInitialized())
			{
				return new Request<UserList>(CAPI.ovr_Room_GetInvitableUsers2((IntPtr)roomOptions));
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.RoomList> GetModeratedRooms()
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.RoomList>(CAPI.ovr_Room_GetModeratedRooms());
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.Room> InviteUser(ulong roomID, string inviteToken)
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Room_InviteUser(roomID, inviteToken));
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.Room> Join(ulong roomID, bool subscribeToUpdates = false)
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Room_Join(roomID, subscribeToUpdates));
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.Room> Join2(ulong roomID, RoomOptions roomOptions)
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Room_Join2(roomID, (IntPtr)roomOptions));
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.Room> KickUser(ulong roomID, ulong userID, int kickDurationSeconds)
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Room_KickUser(roomID, userID, kickDurationSeconds));
			}
			return null;
		}

		public static Request LaunchInvitableUserFlow(ulong roomID)
		{
			if (Core.IsInitialized())
			{
				return new Request(CAPI.ovr_Room_LaunchInvitableUserFlow(roomID));
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.Room> Leave(ulong roomID)
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Room_Leave(roomID));
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.Room> SetDescription(ulong roomID, string description)
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Room_SetDescription(roomID, description));
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.Room> UpdateMembershipLockStatus(ulong roomID, RoomMembershipLockStatus membershipLockStatus)
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Room_UpdateMembershipLockStatus(roomID, membershipLockStatus));
			}
			return null;
		}

		public static Request UpdateOwner(ulong roomID, ulong userID)
		{
			if (Core.IsInitialized())
			{
				return new Request(CAPI.ovr_Room_UpdateOwner(roomID, userID));
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.Room> UpdatePrivateRoomJoinPolicy(ulong roomID, RoomJoinPolicy newJoinPolicy)
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Room_UpdatePrivateRoomJoinPolicy(roomID, newJoinPolicy));
			}
			return null;
		}

		public static void SetRoomInviteAcceptedNotificationCallback(Message<string>.Callback callback)
		{
			Callback.SetNotificationCallback(Message.MessageType.Notification_Room_InviteAccepted, callback);
		}

		public static void SetRoomInviteReceivedNotificationCallback(Message<RoomInviteNotification>.Callback callback)
		{
			Callback.SetNotificationCallback(Message.MessageType.Notification_Room_InviteReceived, callback);
		}

		public static void SetUpdateNotificationCallback(Message<Oculus.Platform.Models.Room>.Callback callback)
		{
			Callback.SetNotificationCallback(Message.MessageType.Notification_Room_RoomUpdate, callback);
		}

		public static Request<Oculus.Platform.Models.RoomList> GetNextRoomListPage(Oculus.Platform.Models.RoomList list)
		{
			if (!list.HasNextPage)
			{
				UnityEngine.Debug.LogWarning("Oculus.Platform.GetNextRoomListPage: List has no next page");
				return null;
			}
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.RoomList>(CAPI.ovr_HTTP_GetWithMessageType(list.NextUrl, 1317239238));
			}
			return null;
		}
	}
	public static class Matchmaking
	{
		public class CustomQuery
		{
			public struct Criterion
			{
				public string key;

				public MatchmakingCriterionImportance importance;

				public Dictionary<string, object> parameters;

				public Criterion(string key_, MatchmakingCriterionImportance importance_)
				{
					key = key_;
					importance = importance_;
					parameters = null;
				}
			}

			public Dictionary<string, object> data;

			public Criterion[] criteria;

			public IntPtr ToUnmanaged()
			{
				CAPI.ovrMatchmakingCustomQueryData structure = default(CAPI.ovrMatchmakingCustomQueryData);
				if (criteria != null && criteria.Length != 0)
				{
					structure.criterionArrayCount = (uint)criteria.Length;
					CAPI.ovrMatchmakingCriterion[] array = new CAPI.ovrMatchmakingCriterion[criteria.Length];
					for (int i = 0; i < criteria.Length; i++)
					{
						array[i].importance_ = criteria[i].importance;
						array[i].key_ = criteria[i].key;
						if (criteria[i].parameters != null && criteria[i].parameters.Count > 0)
						{
							array[i].parameterArrayCount = (uint)criteria[i].parameters.Count;
							array[i].parameterArray = CAPI.ArrayOfStructsToIntPtr(CAPI.DictionaryToOVRKeyValuePairs(criteria[i].parameters));
						}
						else
						{
							array[i].parameterArrayCount = 0u;
							array[i].parameterArray = IntPtr.Zero;
						}
					}
					structure.criterionArray = CAPI.ArrayOfStructsToIntPtr(array);
				}
				else
				{
					structure.criterionArrayCount = 0u;
					structure.criterionArray = IntPtr.Zero;
				}
				if (data != null && data.Count > 0)
				{
					structure.dataArrayCount = (uint)data.Count;
					structure.dataArray = CAPI.ArrayOfStructsToIntPtr(CAPI.DictionaryToOVRKeyValuePairs(data));
				}
				else
				{
					structure.dataArrayCount = 0u;
					structure.dataArray = IntPtr.Zero;
				}
				IntPtr intPtr = Marshal.AllocHGlobal(Marshal.SizeOf(structure));
				Marshal.StructureToPtr(structure, intPtr, fDeleteOld: true);
				return intPtr;
			}
		}

		public static Request ReportResultsInsecure(ulong roomID, Dictionary<string, int> data)
		{
			if (Core.IsInitialized())
			{
				CAPI.ovrKeyValuePair[] array = new CAPI.ovrKeyValuePair[data.Count];
				int num = 0;
				foreach (KeyValuePair<string, int> datum in data)
				{
					array[num++] = new CAPI.ovrKeyValuePair(datum.Key, datum.Value);
				}
				return new Request(CAPI.ovr_Matchmaking_ReportResultInsecure(roomID, array));
			}
			return null;
		}

		public static Request<MatchmakingStats> GetStats(string pool, uint maxLevel, MatchmakingStatApproach approach = MatchmakingStatApproach.Trailing)
		{
			if (Core.IsInitialized())
			{
				return new Request<MatchmakingStats>(CAPI.ovr_Matchmaking_GetStats(pool, maxLevel, approach));
			}
			return null;
		}

		public static Request<MatchmakingBrowseResult> Browse(string pool, CustomQuery customQueryData = null)
		{
			if (Core.IsInitialized())
			{
				return new Request<MatchmakingBrowseResult>(CAPI.ovr_Matchmaking_Browse(pool, customQueryData?.ToUnmanaged() ?? IntPtr.Zero));
			}
			return null;
		}

		public static Request<MatchmakingBrowseResult> Browse2(string pool, MatchmakingOptions matchmakingOptions = null)
		{
			if (Core.IsInitialized())
			{
				return new Request<MatchmakingBrowseResult>(CAPI.ovr_Matchmaking_Browse2(pool, (IntPtr)matchmakingOptions));
			}
			return null;
		}

		public static Request Cancel(string pool, string requestHash)
		{
			if (Core.IsInitialized())
			{
				return new Request(CAPI.ovr_Matchmaking_Cancel(pool, requestHash));
			}
			return null;
		}

		public static Request Cancel()
		{
			if (Core.IsInitialized())
			{
				return new Request(CAPI.ovr_Matchmaking_Cancel2());
			}
			return null;
		}

		public static Request<MatchmakingEnqueueResultAndRoom> CreateAndEnqueueRoom(string pool, uint maxUsers, bool subscribeToUpdates = false, CustomQuery customQueryData = null)
		{
			if (Core.IsInitialized())
			{
				return new Request<MatchmakingEnqueueResultAndRoom>(CAPI.ovr_Matchmaking_CreateAndEnqueueRoom(pool, maxUsers, subscribeToUpdates, customQueryData?.ToUnmanaged() ?? IntPtr.Zero));
			}
			return null;
		}

		public static Request<MatchmakingEnqueueResultAndRoom> CreateAndEnqueueRoom2(string pool, MatchmakingOptions matchmakingOptions = null)
		{
			if (Core.IsInitialized())
			{
				return new Request<MatchmakingEnqueueResultAndRoom>(CAPI.ovr_Matchmaking_CreateAndEnqueueRoom2(pool, (IntPtr)matchmakingOptions));
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.Room> CreateRoom(string pool, uint maxUsers, bool subscribeToUpdates = false)
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Matchmaking_CreateRoom(pool, maxUsers, subscribeToUpdates));
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.Room> CreateRoom2(string pool, MatchmakingOptions matchmakingOptions = null)
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Matchmaking_CreateRoom2(pool, (IntPtr)matchmakingOptions));
			}
			return null;
		}

		public static Request<MatchmakingEnqueueResult> Enqueue(string pool, CustomQuery customQueryData = null)
		{
			if (Core.IsInitialized())
			{
				return new Request<MatchmakingEnqueueResult>(CAPI.ovr_Matchmaking_Enqueue(pool, customQueryData?.ToUnmanaged() ?? IntPtr.Zero));
			}
			return null;
		}

		public static Request<MatchmakingEnqueueResult> Enqueue2(string pool, MatchmakingOptions matchmakingOptions = null)
		{
			if (Core.IsInitialized())
			{
				return new Request<MatchmakingEnqueueResult>(CAPI.ovr_Matchmaking_Enqueue2(pool, (IntPtr)matchmakingOptions));
			}
			return null;
		}

		public static Request<MatchmakingEnqueueResult> EnqueueRoom(ulong roomID, CustomQuery customQueryData = null)
		{
			if (Core.IsInitialized())
			{
				return new Request<MatchmakingEnqueueResult>(CAPI.ovr_Matchmaking_EnqueueRoom(roomID, customQueryData?.ToUnmanaged() ?? IntPtr.Zero));
			}
			return null;
		}

		public static Request<MatchmakingEnqueueResult> EnqueueRoom2(ulong roomID, MatchmakingOptions matchmakingOptions = null)
		{
			if (Core.IsInitialized())
			{
				return new Request<MatchmakingEnqueueResult>(CAPI.ovr_Matchmaking_EnqueueRoom2(roomID, (IntPtr)matchmakingOptions));
			}
			return null;
		}

		public static Request<MatchmakingAdminSnapshot> GetAdminSnapshot()
		{
			if (Core.IsInitialized())
			{
				return new Request<MatchmakingAdminSnapshot>(CAPI.ovr_Matchmaking_GetAdminSnapshot());
			}
			return null;
		}

		public static Request<Oculus.Platform.Models.Room> JoinRoom(ulong roomID, bool subscribeToUpdates = false)
		{
			if (Core.IsInitialized())
			{
				return new Request<Oculus.Platform.Models.Room>(CAPI.ovr_Matchmaking_JoinRoom(roomID, subscribeToUpdates));
			}
			return null;
		}

		public static Request StartMatch(ulong roomID)
		{
			if (Core.IsInitialized())
			{
				return new Request(CAPI.ovr_Matchmaking_StartMatch(roomID));
			}
			return null;
		}

		public static void SetMatchFoundNotificationCallback(Message<Oculus.Platform.Models.Room>.Callback callback)
		{
			Callback.SetNotificationCallback(Message.MessageType.Notification_Matchmaking_MatchFound, callback);
		}
	}
	public static class Net
	{
		public static Packet ReadPacket()
		{
			if (!Core.IsInitialized())
			{
				return null;
			}
			IntPtr intPtr = CAPI.ovr_Net_ReadPacket();
			if (intPtr == IntPtr.Zero)
			{
				return null;
			}
			return new Packet(intPtr);
		}

		public static bool SendPacket(ulong userID, byte[] bytes, SendPolicy policy)
		{
			if (Core.IsInitialized())
			{
				return CAPI.ovr_Net_SendPacket(userID, (UIntPtr)(ulong)bytes.Length, bytes, policy);
			}
			return false;
		}

		public static void Connect(ulong userID)
		{
			if (Core.IsInitialized())
			{
				CAPI.ovr_Net_Connect(userID);
			}
		}

		public static void Accept(ulong userID)
		{
			if (Core.IsInitialized())
			{
				CAPI.ovr_Net_Accept(userID);
			}
		}

		public static void Close(ulong userID)
		{
			if (Core.IsInitialized())
			{
				CAPI.ovr_Net_Close(userID);
			}
		}

		public static bool IsConnected(ulong userID)
		{
			if (Core.IsInitialized())
			{
				return CAPI.ovr_Net_IsConnected(userID);
			}
			return false;
		}

		public static bool SendPacketToCurrentRoom(byte[] bytes, SendPolicy policy)
		{
			if (Core.IsInitialized())
			{
				return CAPI.ovr_Net_SendPacketToCurrentRoom((UIntPtr)(ulong)bytes.Length, bytes, policy);
			}
			return false;
		}

		public static bool AcceptForCurrentRoom()
		{
			if (Core.IsInitialized())
			{
				return CAPI.ovr_Net_AcceptForCurrentRoom();
			}
			return false;
		}

		public static void CloseForCurrentRoom()
		{
			if (Core.IsInitialized())
			{
				CAPI.ovr_Net_CloseForCurrentRoom();
			}
		}

		public static Request<PingResult> Ping(ulong userID)
		{
			if (Core.IsInitialized())
			{
				return new Request<PingResult>(CAPI.ovr_Net_Ping(userID));
			}
			return null;
		}

		public static void SetConnectionStateChangedCallback(Message<NetworkingPeer>.Callback callback)
		{
			Callback.SetNotificationCallback(Message.MessageType.Notification_Networking_ConnectionStateChange, callback);
		}

		public static void SetPeerConnectRequestCallback(Message<NetworkingPeer>.Callback callback)
		{
			Callback.SetNotificationCallback(Message.MessageType.Notification_Networking_PeerConnectRequest, callback);
		}

		public static void SetPingResultNotificationCallback(Message<PingResult>.Callback callback)
		{
			Callback.SetNotificationCallback(Message.MessageType.Notification_Networking_PingResult, callback);
		}
	}
	public static class Leaderboards
	{
		public static Request<LeaderboardEntryList> GetNextEntries(LeaderboardEntryList list)
		{
			if (Core.IsInitialized())
			{
				return new Request<LeaderboardEntryList>(CAPI.ovr_HTTP_GetWithMessageType(list.NextUrl, 1310751961));
			}
			return null;
		}

		public static Request<LeaderboardEntryList> GetPreviousEntries(LeaderboardEntryList list)
		{
			if (Core.IsInitialized())
			{
				return new Request<LeaderboardEntryList>(CAPI.ovr_HTTP_GetWithMessageType(list.PreviousUrl, 1224858304));
			}
			return null;
		}

		public static Request<LeaderboardEntryList> GetEntries(string leaderboardName, int limit, LeaderboardFilterType filter, LeaderboardStartAt startAt)
		{
			if (Core.IsInitialized())
			{
				return new Request<LeaderboardEntryList>(CAPI.ovr_Leaderboard_GetEntries(leaderboardName, limit, filter, startAt));
			}
			return null;
		}

		public static Request<LeaderboardEntryList> GetEntriesAfterRank(string leaderboardName, int limit, ulong afterRank)
		{
			if (Core.IsInitialized())
			{
				return new Request<LeaderboardEntryList>(CAPI.ovr_Leaderboard_GetEntriesAfterRank(leaderboardName, limit, afterRank));
			}
			return null;
		}

		public static Request<bool> WriteEntry(string leaderboardName, long score, byte[] extraData = null, bool forceUpdate = false)
		{
			if (Core.IsInitialized())
			{
				return new Request<bool>(CAPI.ovr_Leaderboard_WriteEntry(leaderboardName, score, extraData, (extraData != null) ? ((uint)extraData.Length) : 0u, forceUpdate));
			}
			return null;
		}
	}
	public static class Voip
	{
		public static void Start(ulong userID)
		{
			if (Core.IsInitialized())
			{
				CAPI.ovr_Voip_Start(userID);
			}
		}

		public static void Accept(ulong userID)
		{
			if (Core.IsInitialized())
			{
				CAPI.ovr_Voip_Accept(userID);
			}
		}

		public static void Stop(ulong userID)
		{
			if (Core.IsInitialized())
			{
				CAPI.ovr_Voip_Stop(userID);
			}
		}

		public static void SetMicrophoneFilterCallback(CAPI.FilterCallback callback)
		{
			if (Core.IsInitialized())
			{
				CAPI.ovr_Voip_SetMicrophoneFilterCallbackWithFixedSizeBuffer(callback, (UIntPtr)480uL);
			}
		}

		public static void SetMicrophoneMuted(VoipMuteState state)
		{
			if (Core.IsInitialized())
			{
				CAPI.ovr_Voip_SetMicrophoneMuted(state);
			}
		}

		public static VoipMuteState GetSystemVoipMicrophoneMuted()
		{
			if (Core.IsInitialized())
			{
				return CAPI.ovr_Voip_GetSystemVoipMicrophoneMuted();
			}
			return VoipMuteState.Unknown;
		}

		public static SystemVoipStatus GetSystemVoipStatus()
		{
			if (Core.IsInitialized())
			{
				return CAPI.ovr_Voip_GetSystemVoipStatus();
			}
			return SystemVoipStatus.Unknown;
		}

		public static VoipDtxState GetIsConnectionUsingDtx(ulong peerID)
		{
			if (Core.IsInitialized())
			{
				return CAPI.ovr_Voip_GetIsConnectionUsingDtx(peerID);
			}
			return VoipDtxState.Unknown;
		}

		public static VoipBitrate GetLocalBitrate(ulong peerID)
		{
			if (Core.IsInitialized())
			{
				return CAPI.ovr_Voip_GetLocalBitrate(peerID);
			}
			return VoipBitrate.Unknown;
		}

		public static VoipBitrate GetRemoteBitrate(ulong peerID)
		{
			if (Core.IsInitialized())
			{
				return CAPI.ovr_Voip_GetRemoteBitrate(peerID);
			}
			return VoipBitrate.Unknown;
		}

		public static void SetNewConnectionOptions(VoipOptions voipOptions)
		{
			if (Core.IsInitialized())
			{
				CAPI.ovr_Voip_SetNewConnectionOptions((IntPtr)voipOptions);
			}
		}

		public static Request<SystemVoipState> SetSystemVoipSuppressed(bool suppressed)
		{
			if (Core.IsInitialized())
			{
				return new Request<SystemVoipState>(CAPI.ovr_Voip_SetSystemVoipSuppressed(suppressed));
			}
			return null;
		}

		public static void SetVoipConnectRequestCallback(Message<NetworkingPeer>.Callback callback)
		{
			Callback.SetNotificationCallback(Message.MessageType.Notification_Voip_ConnectRequest, callback);
		}

		public static void SetVoipStateChangeCallback(Message<NetworkingPeer>.Callback callback)
		{
			Callback.SetNotificationCallback(Message.MessageType.Notification_Voip_StateChange, callback);
		}

		public static void SetSystemVoipStateNotificationCallback(Message<SystemVoipState>.Callback callback)
		{
			Callback.SetNotificationCallback(Message.MessageType.Notification_Voip_SystemVoipState, callback);
		}
	}
	public static class Achievements
	{
		public static Request<AchievementUpdate> AddCount(string name, ulong count)
		{
			if (Core.IsInitialized())
			{
				return new Request<AchievementUpdate>(CAPI.ovr_Achievements_AddCount(name, count));
			}
			return null;
		}

		public static Request<AchievementUpdate> AddFields(string name, string fields)
		{
			if (Core.IsInitialized())
			{
				return new Request<AchievementUpdate>(CAPI.ovr_Achievements_AddFields(name, fields));
			}
			return null;
		}

		public static Request<AchievementDefinitionList> GetAllDefinitions()
		{
			if (Core.IsInitialized())
			{
				return new Request<AchievementDefinitionList>(CAPI.ovr_Achievements_GetAllDefinitions());
			}
			return null;
		}

		public static Request<AchievementProgressList> GetAllProgress()
		{
			if (Core.IsInitialized())
			{
				return new Request<AchievementProgressList>(CAPI.ovr_Achievements_GetAllProgress());
			}
			return null;
		}

		public static Request<AchievementDefinitionList> GetDefinitionsByName(string[] names)
		{
			if (Core.IsInitialized())
			{
				return new Request<AchievementDefinitionList>(CAPI.ovr_Achievements_GetDefinitionsByName(names, (names != null) ? names.Length : 0));
			}
			return null;
		}

		public static Request<AchievementProgressList> GetProgressByName(string[] names)
		{
			if (Core.IsInitialized())
			{
				return new Request<AchievementProgressList>(CAPI.ovr_Achievements_GetProgressByName(names, (names != null) ? names.Length : 0));
			}
			return null;
		}

		public static Request<AchievementUpdate> Unlock(string name)
		{
			if (Core.IsInitialized())
			{
				return new Request<AchievementUpdate>(CAPI.ovr_Achievements_Unlock(name));
			}
			return null;
		}

		public static Request<AchievementDefinitionList> GetNextAchievementDefinitionListPage(AchievementDefinitionList list)
		{
			if (!list.HasNextPage)
			{
				UnityEngine.Debug.LogWarning("Oculus.Platform.GetNextAchievementDefinitionListPage: List has no next page");
				return null;
			}
			if (Core.IsInitialized())
			{
				return new Request<AchievementDefinitionList>(CAPI.ovr_HTTP_GetWithMessageType(list.NextUrl, 712888917));
			}
			return null;
		}

		public static Request<AchievementProgressList> GetNextAchievementProgressListPage(AchievementProgressList list)
		{
			if (!list.HasNextPage)
			{
				UnityEngine.Debug.LogWarning("Oculus.Platform.GetNextAchievementProgressListPage: List has no next page");
				return null;
			}
			if (Core.IsInitialized())
			{
				return new Request<AchievementProgressList>(CAPI.ovr_HTTP_GetWithMessageType(list.NextUrl, 792913703));
			}
			return null;
		}
	}
	public static class Application
	{
		public static Request<ApplicationVersion> GetVersion()
		{
			if (Core.IsInitialized())
			{
				return new Request<ApplicationVersion>(CAPI.ovr_Application_GetVersion());
			}
			return null;
		}

		public static Request<string> LaunchOtherApp(ulong appID, ApplicationOptions deeplink_options = null)
		{
			if (Core.IsInitialized())
			{
				return new Request<string>(CAPI.ovr_Application_LaunchOtherApp(appID, (IntPtr)deeplink_options));
			}
			return null;
		}
	}
	public static class AssetFile
	{
		public static Request<AssetFileDeleteResult> Delete(ulong assetFileID)
		{
			if (Core.IsInitialized())
			{
				return new Request<AssetFileDeleteResult>(CAPI.ovr_AssetFile_Delete(assetFileID));
			}
			return null;
		}

		public static Request<AssetFileDeleteResult> DeleteById(ulong assetFileID)
		{
			if (Core.IsInitialized())
			{
				return new Request<AssetFileDeleteResult>(CAPI.ovr_AssetFile_DeleteById(assetFileID));
			}
			return null;
		}

		public static Request<AssetFileDeleteResult> DeleteByName(string assetFileName)
		{
			if (Core.IsInitialized())
			{
				return new Request<AssetFileDeleteResult>(CAPI.ovr_AssetFile_DeleteByName(assetFileName));
			}
			return null;
		}

		public static Request<AssetFileDownloadResult> Download(ulong assetFileID)
		{
			if (Core.IsInitialized())
			{
				return new Request<AssetFileDownloadResult>(CAPI.ovr_AssetFile_Download(assetFileID));
			}
			return null;
		}

		public static Request<AssetFileDownloadResult> DownloadById(ulong assetFileID)
		{
			if (Core.IsInitialized())
			{
				return new Request<AssetFileDownloadResult>(CAPI.ovr_AssetFile_DownloadById(assetFileID));
			}
			return null;
		}

		public static Request<AssetFileDownloadResult> DownloadByName(string assetFileName)
		{
			if (Core.IsInitialized())
			{
				return new Request<AssetFileDownloadResult>(CAPI.ovr_AssetFile_DownloadByName(assetFileName));
			}
			return null;
		}

		public static Request<AssetFileDownloadCancelResult> DownloadCancel(ulong assetFileID)
		{
			if (Core.IsInitialized())
			{
				return new Request<AssetFileDownloadCancelResult>(CAPI.ovr_AssetFile_DownloadCancel(assetFileID));
			}
			return null;
		}

		public static Request<AssetFileDownloadCancelResult> DownloadCancelById(ulong assetFileID)
		{
			if (Core.IsInitialized())
			{
				return new Request<AssetFileDownloadCancelResult>(CAPI.ovr_AssetFile_DownloadCancelById(assetFileID));
			}
			return null;
		}

		public static Request<AssetFileDownloadCancelResult> DownloadCancelByName(string assetFileName)
		{
			if (Core.IsInitialized())
			{
				return new Request<AssetFileDownloadCancelResult>(CAPI.ovr_AssetFile_DownloadCancelByName(assetFileName));
			}
			return null;
		}

		public static Request<AssetDetailsList> GetList()
		{
			if (Core.IsInitialized())
			{
				return new Request<AssetDetailsList>(CAPI.ovr_AssetFile_GetList());
			}
			return null;
		}

		public static Request<AssetDetails> Status(ulong assetFileID)
		{
			if (Core.IsInitialized())
			{
				return new Request<AssetDetails>(CAPI.ovr_AssetFile_Status(assetFileID));
			}
			return null;
		}

		public static Request<AssetDetails> StatusById(ulong assetFileID)
		{
			if (Core.IsInitialized())
			{
				return new Request<AssetDetails>(CAPI.ovr_AssetFile_StatusById(assetFileID));
			}
			return null;
		}

		public static Request<AssetDetails> StatusByName(string assetFileName)
		{
			if (Core.IsInitialized())
			{
				return new Request<AssetDetails>(CAPI.ovr_AssetFile_StatusByName(assetFileName));
			}
			return null;
		}

		public static void SetDownloadUpdateNotificationCallback(Message<AssetFileDownloadUpdate>.Callback callback)
		{
			Callback.SetNotificationCallback(Message.MessageType.Notification_AssetFile_DownloadUpdate, callback);
		}
	}
	public static class Avatar
	{
	}
	public static class Cal
	{
	}
	public static class CloudStorage
	{
		public static Request<CloudStorageUpdateResponse> Delete(string bucket, string key)
		{
			if (Core.IsInitialized())
			{
				return new Request<CloudStorageUpdateResponse>(CAPI.ovr_CloudStorage_Delete(bucket, key));
			}
			return null;
		}

		public static Request<CloudStorageData> Load(string bucket, string key)
		{
			if (Core.IsInitialized())
			{
				return new Request<CloudStorageData>(CAPI.ovr_CloudStorage_Load(bucket, key));
			}
			return null;
		}

		public static Request<CloudStorageMetadataList> LoadBucketMetadata(string bucket)
		{
			if (Core.IsInitialized())
			{
				return new Request<CloudStorageMetadataList>(CAPI.ovr_CloudStorage_LoadBucketMetadata(bucket));
			}
			return null;
		}

		public static Request<CloudStorageConflictMetadata> LoadConflictMetadata(string bucket, string key)
		{
			if (Core.IsInitialized())
			{
				return new Request<CloudStorageConflictMetadata>(CAPI.ovr_CloudStorage_LoadConflictMetadata(bucket, key));
			}
			return null;
		}

		public static Request<CloudStorageData> LoadHandle(string handle)
		{
			if (Core.IsInitialized())
			{
				return new Request<CloudStorageData>(CAPI.ovr_CloudStorage_LoadHandle(handle));
			}
			return null;
		}

		public static Request<CloudStorageMetadata> LoadMetadata(string bucket, string key)
		{
			if (Core.IsInitialized())
			{
				return new Request<CloudStorageMetadata>(CAPI.ovr_CloudStorage_LoadMetadata(bucket, key));
			}
			return null;
		}

		public static Request<CloudStorageUpdateResponse> ResolveKeepLocal(string bucket, string key, string remoteHandle)
		{
			if (Core.IsInitialized())
			{
				return new Request<CloudStorageUpdateResponse>(CAPI.ovr_CloudStorage_ResolveKeepLocal(bucket, key, remoteHandle));
			}
			return null;
		}

		public static Request<CloudStorageUpdateResponse> ResolveKeepRemote(string bucket, string key, string remoteHandle)
		{
			if (Core.IsInitialized())
			{
				return new Request<CloudStorageUpdateResponse>(CAPI.ovr_CloudStorage_ResolveKeepRemote(bucket, key, remoteHandle));
			}
			return null;
		}

		public static Request<CloudStorageUpdateResponse> Save(string bucket, string key, byte[] data, long counter, string extraData)
		{
			if (Core.IsInitialized())
			{
				return new Request<CloudStorageUpdateResponse>(CAPI.ovr_CloudStorage_Save(bucket, key, data, (data != null) ? ((uint)data.Length) : 0u, counter, extraData));
			}
			return null;
		}

		public static Request<CloudStorageMetadataList> GetNextCloudStorageMetadataListPage(CloudStorageMetadataList list)
		{
			if (!list.HasNextPage)
			{
				UnityEngine.Debug.LogWarning("Oculus.Platform.GetNextCloudStorageMetadataListPage: List has no next page");
				return null;
			}
			if (Core.IsInitialized())
			{
				return new Request<CloudStorageMetadataList>(CAPI.ovr_HTTP_GetWithMessageType(list.NextUrl, 1544004335));
			}
			return null;
		}
	}
	public static class CloudStorage2
	{
		public static Request<string> GetUserDirectoryPath()
		{
			if (Core.IsInitialized())
			{
				return new Request<string>(CAPI.ovr_CloudStorage2_GetUserDirectoryPath());
			}
			return null;
		}
	}
	public static class Colocation
	{
	}
	public static class Entitlements
	{
		public static Request IsUserEntitledToApplication()
		{
			if (Core.IsInitialized())
			{
				return new Request(CAPI.ovr_Entitlement_GetIsViewerEntitled());
			}
			return null;
		}
	}
	public static class GraphAPI
	{
	}
	public static class HTTP
	{
	}
	public static class IAP
	{
		public static Request ConsumePurchase(string sku)
		{
			if (Core.IsInitialized())
			{
				return new Request(CAPI.ovr_IAP_ConsumePurchase(sku));
			}
			return null;
		}

		public static Request<ProductList> GetProductsBySKU(string[] skus)
		{
			if (Core.IsInitialized())
			{
				return new Request<ProductList>(CAPI.ovr_IAP_GetProductsBySKU(skus, (skus != null) ? skus.Length : 0));
			}
			return null;
		}

		public static Request<PurchaseList> GetViewerPurchases()
		{
			if (Core.IsInitialized())
			{
				return new Request<PurchaseList>(CAPI.ovr_IAP_GetViewerPurchases());
			}
			return null;
		}

		public static Request<PurchaseList> GetViewerPurchasesDurableCache()
		{
			if (Core.IsInitialized())
			{
				return new Request<PurchaseList>(CAPI.ovr_IAP_GetViewerPurchasesDurableCache());
			}
			return null;
		}

		public static Request<Purchase> LaunchCheckoutFlow(string sku)
		{
			if (Core.IsInitialized())
			{
				if (UnityEngine.Application.isEditor)
				{
					throw new NotImplementedException("LaunchCheckoutFlow() is not implemented in the editor yet.");
				}
				return new Request<Purchase>(CAPI.ovr_IAP_LaunchCheckoutFlow(sku));
			}
			return null;
		}

		public static Request<ProductList> GetNextProductListPage(ProductList list)
		{
			if (!list.HasNextPage)
			{
				UnityEngine.Debug.LogWarning("Oculus.Platform.GetNextProductListPage: List has no next page");
				return null;
			}
			if (Core.IsInitialized())
			{
				return new Request<ProductList>(CAPI.ovr_HTTP_GetWithMessageType(list.NextUrl, 467225263));
			}
			return null;
		}

		public static Request<PurchaseList> GetNextPurchaseListPage(PurchaseList list)
		{
			if (!list.HasNextPage)
			{
				UnityEngine.Debug.LogWarning("Oculus.Platform.GetNextPurchaseListPage: List has no next page");
				return null;
			}
			if (Core.IsInitialized())
			{
				return new Request<PurchaseList>(CAPI.ovr_HTTP_GetWithMessageType(list.NextUrl, 1196886677));
			}
			return null;
		}
	}
	public static class LanguagePack
	{
		public static Request<AssetDetails> GetCurrent()
		{
			if (Core.IsInitialized())
			{
				return new Request<AssetDetails>(CAPI.ovr_LanguagePack_GetCurrent());
			}
			return null;
		}

		public static Request<AssetFileDownloadResult> SetCurrent(string tag)
		{
			if (Core.IsInitialized())
			{
				return new Request<AssetFileDownloadResult>(CAPI.ovr_LanguagePack_SetCurrent(tag));
			}
			return null;
		}
	}
	public static class Livestreaming
	{
		public static Request<LivestreamingStatus> GetStatus()
		{
			if (Core.IsInitialized())
			{
				return new Request<LivestreamingStatus>(CAPI.ovr_Livestreaming_GetStatus());
			}
			return null;
		}

		public static Request<LivestreamingStatus> PauseStream()
		{
			if (Core.IsInitialized())
			{
				return new Request<LivestreamingStatus>(CAPI.ovr_Livestreaming_PauseStream());
			}
			return null;
		}

		public static Request<LivestreamingStatus> ResumeStream()
		{
			if (Core.IsInitialized())
			{
				return new Request<LivestreamingStatus>(CAPI.ovr_Livestreaming_ResumeStream());
			}
			return null;
		}

		public static void SetStatusUpdateNotificationCallback(Message<LivestreamingStatus>.Callback callback)
		{
			Callback.SetNotificationCallback(Message.MessageType.Notification_Livestreaming_StatusChange, callback);
		}
	}
	public static class Media
	{
		public static Request<ShareMediaResult> ShareToFacebook(string postTextSuggestion, string filePath, MediaContentType contentType)
		{
			if (Core.IsInitialized())
			{
				return new Request<ShareMediaResult>(CAPI.ovr_Media_ShareToFacebook(postTextSuggestion, filePath, contentType));
			}
			return null;
		}
	}
	public static class Notifications
	{
		public static Request<RoomInviteNotificationList> GetRoomInviteNotifications()
		{
			if (Core.IsInitialized())
			{
				return new Request<RoomInviteNotificationList>(CAPI.ovr_Notification_GetRoomInvites());
			}
			return null;
		}

		public static Request MarkAsRead(ulong notificationID)
		{
			if (Core.IsInitialized())
			{
				return new Request(CAPI.ovr_Notification_MarkAsRead(notificationID));
			}
			return null;
		}

		public static Request<RoomInviteNotificationList> GetNextRoomInviteNotificationListPage(RoomInviteNotificationList list)
		{
			if (!list.HasNextPage)
			{
				UnityEngine.Debug.LogWarning("Oculus.Platform.GetNextRoomInviteNotificationListPage: List has no next page");
				return null;
			}
			if (Core.IsInitialized())
			{
				return new Request<RoomInviteNotificationList>(CAPI.ovr_HTTP_GetWithMessageType(list.NextUrl, 102890359));
			}
			return null;
		}
	}
	public static class Parties
	{
		public static Request<Party> GetCurrent()
		{
			if (Core.IsInitialized())
			{
				return new Request<Party>(CAPI.ovr_Party_GetCurrent());
			}
			return null;
		}

		public static void SetPartyUpdateNotificationCallback(Message<PartyUpdateNotification>.Callback callback)
		{
			Callback.SetNotificationCallback(Message.MessageType.Notification_Party_PartyUpdate, callback);
		}
	}
	public static class RichPresence
	{
		public static Request Clear()
		{
			if (Core.IsInitialized())
			{
				return new Request(CAPI.ovr_RichPresence_Clear());
			}
			return null;
		}

		public static Request<DestinationList> GetDestinations()
		{
			if (Core.IsInitialized())
			{
				return new Request<DestinationList>(CAPI.ovr_RichPresence_GetDestinations());
			}
			return null;
		}

		public static Request Set(RichPresenceOptions richPresenceOptions)
		{
			if (Core.IsInitialized())
			{
				return new Request(CAPI.ovr_RichPresence_Set((IntPtr)richPresenceOptions));
			}
			return null;
		}

		public static Request<DestinationList> GetNextDestinationListPage(DestinationList list)
		{
			if (!list.HasNextPage)
			{
				UnityEngine.Debug.LogWarning("Oculus.Platform.GetNextDestinationListPage: List has no next page");
				return null;
			}
			if (Core.IsInitialized())
			{
				return new Request<DestinationList>(CAPI.ovr_HTTP_GetWithMessageType(list.NextUrl, 1731624773));
			}
			return null;
		}
	}
	public static class Users
	{
		public static Request<User> Get(ulong userID)
		{
			if (Core.IsInitialized())
			{
				return new Request<User>(CAPI.ovr_User_Get(userID));
			}
			return null;
		}

		public static Request<string> GetAccessToken()
		{
			if (Core.IsInitialized())
			{
				return new Request<string>(CAPI.ovr_User_GetAccessToken());
			}
			return null;
		}

		public static Request<User> GetLoggedInUser()
		{
			if (Core.IsInitialized())
			{
				return new Request<User>(CAPI.ovr_User_GetLoggedInUser());
			}
			return null;
		}

		public static Request<UserList> GetLoggedInUserFriends()
		{
			if (Core.IsInitialized())
			{
				return new Request<UserList>(CAPI.ovr_User_GetLoggedInUserFriends());
			}
			return null;
		}

		public static Request<UserAndRoomList> GetLoggedInUserFriendsAndRooms()
		{
			if (Core.IsInitialized())
			{
				return new Request<UserAndRoomList>(CAPI.ovr_User_GetLoggedInUserFriendsAndRooms());
			}
			return null;
		}

		public static Request<UserAndRoomList> GetLoggedInUserRecentlyMetUsersAndRooms(UserOptions userOptions = null)
		{
			if (Core.IsInitialized())
			{
				return new Request<UserAndRoomList>(CAPI.ovr_User_GetLoggedInUserRecentlyMetUsersAndRooms((IntPtr)userOptions));
			}
			return null;
		}

		public static Request<OrgScopedID> GetOrgScopedID(ulong userID)
		{
			if (Core.IsInitialized())
			{
				return new Request<OrgScopedID>(CAPI.ovr_User_GetOrgScopedID(userID));
			}
			return null;
		}

		public static Request<SdkAccountList> GetSdkAccounts()
		{
			if (Core.IsInitialized())
			{
				return new Request<SdkAccountList>(CAPI.ovr_User_GetSdkAccounts());
			}
			return null;
		}

		public static Request<UserProof> GetUserProof()
		{
			if (Core.IsInitialized())
			{
				return new Request<UserProof>(CAPI.ovr_User_GetUserProof());
			}
			return null;
		}

		public static Request<LaunchFriendRequestFlowResult> LaunchFriendRequestFlow(ulong userID)
		{
			if (Core.IsInitialized())
			{
				return new Request<LaunchFriendRequestFlowResult>(CAPI.ovr_User_LaunchFriendRequestFlow(userID));
			}
			return null;
		}

		public static Request LaunchProfile(ulong userID)
		{
			if (Core.IsInitialized())
			{
				return new Request(CAPI.ovr_User_LaunchProfile(userID));
			}
			return null;
		}

		public static Request<UserAndRoomList> GetNextUserAndRoomListPage(UserAndRoomList list)
		{
			if (!list.HasNextPage)
			{
				UnityEngine.Debug.LogWarning("Oculus.Platform.GetNextUserAndRoomListPage: List has no next page");
				return null;
			}
			if (Core.IsInitialized())
			{
				return new Request<UserAndRoomList>(CAPI.ovr_HTTP_GetWithMessageType(list.NextUrl, 2143146719));
			}
			return null;
		}

		public static Request<UserList> GetNextUserListPage(UserList list)
		{
			if (!list.HasNextPage)
			{
				UnityEngine.Debug.LogWarning("Oculus.Platform.GetNextUserListPage: List has no next page");
				return null;
			}
			if (Core.IsInitialized())
			{
				return new Request<UserList>(CAPI.ovr_HTTP_GetWithMessageType(list.NextUrl, 645723971));
			}
			return null;
		}
	}
	public enum PlatformInitializeResult
	{
		[Description("SUCCESS")]
		Success = 0,
		[Description("UNINITIALIZED")]
		Uninitialized = -1,
		[Description("PRE_LOADED")]
		PreLoaded = -2,
		[Description("FILE_INVALID")]
		FileInvalid = -3,
		[Description("SIGNATURE_INVALID")]
		SignatureInvalid = -4,
		[Description("UNABLE_TO_VERIFY")]
		UnableToVerify = -5,
		[Description("VERSION_MISMATCH")]
		VersionMismatch = -6,
		[Description("UNKNOWN")]
		Unknown = -7,
		[Description("INVALID_CREDENTIALS")]
		InvalidCredentials = -8,
		[Description("NOT_ENTITLED")]
		NotEntitled = -9
	}
	public static class PlatformInternal
	{
		public enum MessageTypeInternal : uint
		{
			Application_ExecuteCoordinatedLaunch = 645772532u,
			Application_GetInstalledApplications = 1376744524u,
			Avatar_UpdateMetaData = 2077219214u,
			Cal_FinalizeApplication = 497667029u,
			Cal_GetSuggestedApplications = 1450209301u,
			Cal_ProposeApplication = 1317270237u,
			Colocation_GetCurrentMapUuid = 878018226u,
			Colocation_RequestMap = 840263277u,
			Colocation_ShareMap = 409847005u,
			GraphAPI_Get = 822018158u,
			GraphAPI_Post = 1990567876u,
			HTTP_Get = 1874211363u,
			HTTP_GetToFile = 1317133401u,
			HTTP_MultiPartPost = 1480774160u,
			HTTP_Post = 1798743375u,
			Livestreaming_IsAllowedForApplication = 191729014u,
			Livestreaming_StartPartyStream = 2066701532u,
			Livestreaming_StartStream = 1343932350u,
			Livestreaming_StopPartyStream = 661065560u,
			Livestreaming_StopStream = 1155796426u,
			Livestreaming_UpdateCommentsOverlayVisibility = 528318516u,
			Livestreaming_UpdateMicStatus = 475495815u,
			Party_Create = 450042703u,
			Party_GatherInApplication = 1921499523u,
			Party_Get = 1586058173u,
			Party_GetCurrentForUser = 1489764138u,
			Party_Invite = 901104867u,
			Party_Join = 1744993395u,
			Party_Leave = 848430801u,
			Room_CreateOrUpdateAndJoinNamed = 2089683601u,
			Room_GetNamedRooms = 125660812u,
			Room_GetSocialRooms = 1636310390u,
			SystemPermissions_GetStatus = 493497353u,
			SystemPermissions_LaunchDeeplink = 442139697u,
			User_CancelRecordingForReportFlow = 65065289u,
			User_GetLinkedAccounts = 1469314134u,
			User_LaunchBlockFlow = 1876305192u,
			User_LaunchReportFlow = 1449304081u,
			User_LaunchReportFlow2 = 2139314275u,
			User_LaunchUnblockFlow = 346172055u,
			User_NewEntitledTestUser = 292822787u,
			User_NewTestUser = 921194380u,
			User_NewTestUserFriends = 517416647u,
			User_StartRecordingForReportFlow = 1819161571u,
			User_StopRecordingAndLaunchReportFlow = 1618513035u,
			User_StopRecordingAndLaunchReportFlow2 = 432190251u,
			User_TestUserCreateDeviceManifest = 1701884605u
		}

		public static class HTTP
		{
			public static void SetHttpTransferUpdateCallback(Message<HttpTransferUpdate>.Callback callback)
			{
				Callback.SetNotificationCallback(Message.MessageType.Notification_HTTP_Transfer, callback);
			}
		}

		public static class Users
		{
			public static Request<LinkedAccountList> GetLinkedAccounts(ServiceProvider[] providers)
			{
				if (Core.IsInitialized())
				{
					UserOptions userOptions = new UserOptions();
					foreach (ServiceProvider value in providers)
					{
						userOptions.AddServiceProvider(value);
					}
					return new Request<LinkedAccountList>(CAPI.ovr_User_GetLinkedAccounts((IntPtr)userOptions));
				}
				return null;
			}
		}

		public static void CrashApplication()
		{
			CAPI.ovr_CrashApplication();
		}

		internal static Message ParseMessageHandle(IntPtr messageHandle, Message.MessageType messageType)
		{
			Message result = null;
			switch ((MessageTypeInternal)messageType)
			{
			case MessageTypeInternal.User_StartRecordingForReportFlow:
				result = new MessageWithAbuseReportRecording(messageHandle);
				break;
			case MessageTypeInternal.Cal_FinalizeApplication:
				result = new MessageWithCalApplicationFinalized(messageHandle);
				break;
			case MessageTypeInternal.Cal_GetSuggestedApplications:
				result = new MessageWithCalApplicationSuggestionList(messageHandle);
				break;
			case MessageTypeInternal.User_CancelRecordingForReportFlow:
			case MessageTypeInternal.Colocation_ShareMap:
			case MessageTypeInternal.Livestreaming_UpdateMicStatus:
			case MessageTypeInternal.Application_ExecuteCoordinatedLaunch:
			case MessageTypeInternal.Livestreaming_StopPartyStream:
			case MessageTypeInternal.Colocation_RequestMap:
			case MessageTypeInternal.Party_Leave:
			case MessageTypeInternal.Cal_ProposeApplication:
			case MessageTypeInternal.User_TestUserCreateDeviceManifest:
				result = new Message(messageHandle);
				break;
			case MessageTypeInternal.Application_GetInstalledApplications:
				result = new MessageWithInstalledApplicationList(messageHandle);
				break;
			case MessageTypeInternal.User_LaunchBlockFlow:
				result = new MessageWithLaunchBlockFlowResult(messageHandle);
				break;
			case MessageTypeInternal.User_LaunchReportFlow2:
				result = new MessageWithLaunchReportFlowResult(messageHandle);
				break;
			case MessageTypeInternal.User_LaunchUnblockFlow:
				result = new MessageWithLaunchUnblockFlowResult(messageHandle);
				break;
			case MessageTypeInternal.User_GetLinkedAccounts:
				result = new MessageWithLinkedAccountList(messageHandle);
				break;
			case MessageTypeInternal.Livestreaming_IsAllowedForApplication:
				result = new MessageWithLivestreamingApplicationStatus(messageHandle);
				break;
			case MessageTypeInternal.Livestreaming_StartStream:
			case MessageTypeInternal.Livestreaming_StartPartyStream:
				result = new MessageWithLivestreamingStartResult(messageHandle);
				break;
			case MessageTypeInternal.Livestreaming_UpdateCommentsOverlayVisibility:
				result = new MessageWithLivestreamingStatus(messageHandle);
				break;
			case MessageTypeInternal.Livestreaming_StopStream:
				result = new MessageWithLivestreamingVideoStats(messageHandle);
				break;
			case MessageTypeInternal.Party_Get:
				result = new MessageWithParty(messageHandle);
				break;
			case MessageTypeInternal.Party_GetCurrentForUser:
				result = new MessageWithPartyUnderCurrentParty(messageHandle);
				break;
			case MessageTypeInternal.Party_Create:
			case MessageTypeInternal.Party_Invite:
			case MessageTypeInternal.Party_Join:
			case MessageTypeInternal.Party_GatherInApplication:
				result = new MessageWithPartyID(messageHandle);
				break;
			case MessageTypeInternal.Room_CreateOrUpdateAndJoinNamed:
				result = new MessageWithRoomUnderViewerRoom(messageHandle);
				break;
			case MessageTypeInternal.Room_GetNamedRooms:
			case MessageTypeInternal.Room_GetSocialRooms:
				result = new MessageWithRoomList(messageHandle);
				break;
			case MessageTypeInternal.User_NewEntitledTestUser:
			case MessageTypeInternal.User_NewTestUserFriends:
			case MessageTypeInternal.GraphAPI_Get:
			case MessageTypeInternal.Colocation_GetCurrentMapUuid:
			case MessageTypeInternal.User_NewTestUser:
			case MessageTypeInternal.HTTP_GetToFile:
			case MessageTypeInternal.HTTP_MultiPartPost:
			case MessageTypeInternal.HTTP_Post:
			case MessageTypeInternal.HTTP_Get:
			case MessageTypeInternal.GraphAPI_Post:
			case MessageTypeInternal.Avatar_UpdateMetaData:
				result = new MessageWithString(messageHandle);
				break;
			case MessageTypeInternal.SystemPermissions_LaunchDeeplink:
			case MessageTypeInternal.SystemPermissions_GetStatus:
				result = new MessageWithSystemPermission(messageHandle);
				break;
			case MessageTypeInternal.User_StopRecordingAndLaunchReportFlow2:
			case MessageTypeInternal.User_LaunchReportFlow:
			case MessageTypeInternal.User_StopRecordingAndLaunchReportFlow:
				result = new MessageWithUserReportID(messageHandle);
				break;
			}
			return result;
		}

		public static Request<PlatformInitialize> InitializeStandaloneAsync(ulong appID, string accessToken)
		{
			Request<PlatformInitialize> result = new StandalonePlatform().AsyncInitialize(appID, accessToken) ?? throw new UnityException("Oculus Platform failed to initialize.");
			Core.ForceInitialized();
			new GameObject("Oculus.Platform.CallbackRunner").AddComponent<CallbackRunner>();
			return result;
		}
	}
	public sealed class PlatformSettings : ScriptableObject
	{
		[SerializeField]
		private string ovrAppID = "";

		[SerializeField]
		private string ovrMobileAppID = "";

		[SerializeField]
		private bool ovrUseStandalonePlatform = true;

		[SerializeField]
		private bool ovrEnableARM64Support;

		private static PlatformSettings instance;

		public static string AppID
		{
			get
			{
				return Instance.ovrAppID;
			}
			set
			{
				Instance.ovrAppID = value;
			}
		}

		public static string MobileAppID
		{
			get
			{
				return Instance.ovrMobileAppID;
			}
			set
			{
				Instance.ovrMobileAppID = value;
			}
		}

		public static bool UseStandalonePlatform
		{
			get
			{
				return Instance.ovrUseStandalonePlatform;
			}
			set
			{
				Instance.ovrUseStandalonePlatform = value;
			}
		}

		public static bool EnableARM64Support
		{
			get
			{
				return Instance.ovrEnableARM64Support;
			}
			set
			{
				Instance.ovrEnableARM64Support = value;
			}
		}

		public static PlatformSettings Instance
		{
			get
			{
				if (instance == null)
				{
					instance = Resources.Load<PlatformSettings>("OculusPlatformSettings");
					if (instance == null)
					{
						instance = ScriptableObject.CreateInstance<PlatformSettings>();
					}
				}
				return instance;
			}
			set
			{
				instance = value;
			}
		}
	}
	public sealed class Request<T> : Request
	{
		private Message<T>.Callback callback_;

		public Request(ulong requestID)
			: base(requestID)
		{
		}

		public Request<T> OnComplete(Message<T>.Callback callback)
		{
			if (callback_ != null)
			{
				throw new UnityException("Attempted to attach multiple handlers to a Request.  This is not allowed.");
			}
			callback_ = callback;
			Callback.AddRequest(this);
			return this;
		}

		public override void HandleMessage(Message msg)
		{
			if (!(msg is Message<T>))
			{
				UnityEngine.Debug.LogError("Unable to handle message: " + msg.GetType());
				return;
			}
			if (callback_ != null)
			{
				callback_((Message<T>)msg);
				return;
			}
			throw new UnityException("Request with no handler.  This should never happen.");
		}
	}
	public class Request
	{
		private Message.Callback callback_;

		public ulong RequestID { get; set; }

		public Request(ulong requestID)
		{
			RequestID = requestID;
		}

		public Request OnComplete(Message.Callback callback)
		{
			callback_ = callback;
			Callback.AddRequest(this);
			return this;
		}

		public virtual void HandleMessage(Message msg)
		{
			if (callback_ != null)
			{
				callback_(msg);
				return;
			}
			throw new UnityException("Request with no handler.  This should never happen.");
		}

		public static void RunCallbacks(uint limit = 0u)
		{
			if (limit == 0)
			{
				Callback.RunCallbacks();
			}
			else
			{
				Callback.RunLimitedCallbacks(limit);
			}
		}
	}
	public enum RichPresenceExtraContext
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("NONE")]
		None,
		[Description("CURRENT_CAPACITY")]
		CurrentCapacity,
		[Description("STARTED_AGO")]
		StartedAgo,
		[Description("ENDING_IN")]
		EndingIn,
		[Description("LOOKING_FOR_A_MATCH")]
		LookingForAMatch
	}
	public class RichPresenceOptions
	{
		private IntPtr Handle;

		public RichPresenceOptions()
		{
			Handle = CAPI.ovr_RichPresenceOptions_Create();
		}

		public void SetApiName(string value)
		{
			CAPI.ovr_RichPresenceOptions_SetApiName(Handle, value);
		}

		public void SetArgs(string key, string value)
		{
			CAPI.ovr_RichPresenceOptions_SetArgsString(Handle, key, value);
		}

		public void ClearArgs()
		{
			CAPI.ovr_RichPresenceOptions_ClearArgs(Handle);
		}

		public void SetCurrentCapacity(uint value)
		{
			CAPI.ovr_RichPresenceOptions_SetCurrentCapacity(Handle, value);
		}

		public void SetDeeplinkMessageOverride(string value)
		{
			CAPI.ovr_RichPresenceOptions_SetDeeplinkMessageOverride(Handle, value);
		}

		public void SetEndTime(DateTime value)
		{
			CAPI.ovr_RichPresenceOptions_SetEndTime(Handle, value);
		}

		public void SetExtraContext(RichPresenceExtraContext value)
		{
			CAPI.ovr_RichPresenceOptions_SetExtraContext(Handle, value);
		}

		public void SetIsIdle(bool value)
		{
			CAPI.ovr_RichPresenceOptions_SetIsIdle(Handle, value);
		}

		public void SetIsJoinable(bool value)
		{
			CAPI.ovr_RichPresenceOptions_SetIsJoinable(Handle, value);
		}

		public void SetJoinableId(string value)
		{
			CAPI.ovr_RichPresenceOptions_SetJoinableId(Handle, value);
		}

		public void SetMaxCapacity(uint value)
		{
			CAPI.ovr_RichPresenceOptions_SetMaxCapacity(Handle, value);
		}

		public void SetStartTime(DateTime value)
		{
			CAPI.ovr_RichPresenceOptions_SetStartTime(Handle, value);
		}

		public static explicit operator IntPtr(RichPresenceOptions options)
		{
			return options?.Handle ?? IntPtr.Zero;
		}

		~RichPresenceOptions()
		{
			CAPI.ovr_RichPresenceOptions_Destroy(Handle);
		}
	}
	public enum RoomJoinability
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("ARE_IN")]
		AreIn,
		[Description("ARE_KICKED")]
		AreKicked,
		[Description("CAN_JOIN")]
		CanJoin,
		[Description("IS_FULL")]
		IsFull,
		[Description("NO_VIEWER")]
		NoViewer,
		[Description("POLICY_PREVENTS")]
		PolicyPrevents
	}
	public enum RoomJoinPolicy
	{
		[Description("NONE")]
		None,
		[Description("EVERYONE")]
		Everyone,
		[Description("FRIENDS_OF_MEMBERS")]
		FriendsOfMembers,
		[Description("FRIENDS_OF_OWNER")]
		FriendsOfOwner,
		[Description("INVITED_USERS")]
		InvitedUsers,
		[Description("UNKNOWN")]
		Unknown
	}
	public enum RoomMembershipLockStatus
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("LOCK")]
		Lock,
		[Description("UNLOCK")]
		Unlock
	}
	public class RoomOptions
	{
		private IntPtr Handle;

		public RoomOptions()
		{
			Handle = CAPI.ovr_RoomOptions_Create();
		}

		public void SetDataStore(string key, string value)
		{
			CAPI.ovr_RoomOptions_SetDataStoreString(Handle, key, value);
		}

		public void ClearDataStore()
		{
			CAPI.ovr_RoomOptions_ClearDataStore(Handle);
		}

		public void SetExcludeRecentlyMet(bool value)
		{
			CAPI.ovr_RoomOptions_SetExcludeRecentlyMet(Handle, value);
		}

		public void SetMaxUserResults(uint value)
		{
			CAPI.ovr_RoomOptions_SetMaxUserResults(Handle, value);
		}

		public void SetOrdering(UserOrdering value)
		{
			CAPI.ovr_RoomOptions_SetOrdering(Handle, value);
		}

		public void SetRecentlyMetTimeWindow(TimeWindow value)
		{
			CAPI.ovr_RoomOptions_SetRecentlyMetTimeWindow(Handle, value);
		}

		public void SetRoomId(ulong value)
		{
			CAPI.ovr_RoomOptions_SetRoomId(Handle, value);
		}

		public void SetTurnOffUpdates(bool value)
		{
			CAPI.ovr_RoomOptions_SetTurnOffUpdates(Handle, value);
		}

		public static explicit operator IntPtr(RoomOptions options)
		{
			return options?.Handle ?? IntPtr.Zero;
		}

		~RoomOptions()
		{
			CAPI.ovr_RoomOptions_Destroy(Handle);
		}
	}
	public enum RoomType
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("MATCHMAKING")]
		Matchmaking,
		[Description("MODERATED")]
		Moderated,
		[Description("PRIVATE")]
		Private,
		[Description("SOLO")]
		Solo
	}
	public enum SdkAccountType
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("OCULUS")]
		Oculus,
		[Description("FACEBOOK_GAMEROOM")]
		FacebookGameroom
	}
	public enum SendPolicy
	{
		[Description("UNRELIABLE")]
		Unreliable,
		[Description("RELIABLE")]
		Reliable,
		[Description("UNKNOWN")]
		Unknown
	}
	public enum ServiceProvider
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("DROPBOX")]
		Dropbox,
		[Description("FACEBOOK")]
		Facebook,
		[Description("GOOGLE")]
		Google,
		[Description("INSTAGRAM")]
		Instagram,
		[Description("REMOTE_MEDIA")]
		RemoteMedia
	}
	public enum ShareMediaStatus
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("SHARED")]
		Shared,
		[Description("CANCELED")]
		Canceled
	}
	public sealed class StandalonePlatform
	{
		[UnmanagedFunctionPointer(CallingConvention.Cdecl)]
		public delegate void UnityLogDelegate(IntPtr tag, IntPtr msg);

		public Request<PlatformInitialize> InitializeInEditor()
		{
			if (string.IsNullOrEmpty(PlatformSettings.MobileAppID))
			{
				throw new UnityException("Update your App ID by selecting 'Oculus Platform' -> 'Edit Settings'");
			}
			string mobileAppID = PlatformSettings.MobileAppID;
			if (string.IsNullOrEmpty(StandalonePlatformSettings.OculusPlatformTestUserAccessToken))
			{
				throw new UnityException("Update your standalone credentials by selecting 'Oculus Platform' -> 'Edit Settings'");
			}
			string oculusPlatformTestUserAccessToken = StandalonePlatformSettings.OculusPlatformTestUserAccessToken;
			return AsyncInitialize(ulong.Parse(mobileAppID), oculusPlatformTestUserAccessToken);
		}

		public Request<PlatformInitialize> AsyncInitialize(ulong appID, string accessToken)
		{
			CAPI.ovr_UnityResetTestPlatform();
			CAPI.ovr_UnityInitGlobals(IntPtr.Zero);
			return new Request<PlatformInitialize>(CAPI.ovr_PlatformInitializeWithAccessToken(appID, accessToken));
		}
	}
	public sealed class StandalonePlatformSettings
	{
		public static string OculusPlatformTestUserEmail
		{
			get
			{
				return string.Empty;
			}
			set
			{
			}
		}

		public static string OculusPlatformTestUserPassword
		{
			get
			{
				return string.Empty;
			}
			set
			{
			}
		}

		public static string OculusPlatformTestUserAccessToken
		{
			get
			{
				return string.Empty;
			}
			set
			{
			}
		}
	}
	public enum SystemVoipStatus
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("UNAVAILABLE")]
		Unavailable,
		[Description("SUPPRESSED")]
		Suppressed,
		[Description("ACTIVE")]
		Active
	}
	public enum TimeWindow
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("ONE_HOUR")]
		OneHour,
		[Description("ONE_DAY")]
		OneDay,
		[Description("ONE_WEEK")]
		OneWeek,
		[Description("THIRTY_DAYS")]
		ThirtyDays,
		[Description("NINETY_DAYS")]
		NinetyDays
	}
	public class UserOptions
	{
		private IntPtr Handle;

		public UserOptions()
		{
			Handle = CAPI.ovr_UserOptions_Create();
		}

		public void SetMaxUsers(uint value)
		{
			CAPI.ovr_UserOptions_SetMaxUsers(Handle, value);
		}

		public void AddServiceProvider(ServiceProvider value)
		{
			CAPI.ovr_UserOptions_AddServiceProvider(Handle, value);
		}

		public void ClearServiceProviders()
		{
			CAPI.ovr_UserOptions_ClearServiceProviders(Handle);
		}

		public void SetTimeWindow(TimeWindow value)
		{
			CAPI.ovr_UserOptions_SetTimeWindow(Handle, value);
		}

		public static explicit operator IntPtr(UserOptions options)
		{
			return options?.Handle ?? IntPtr.Zero;
		}

		~UserOptions()
		{
			CAPI.ovr_UserOptions_Destroy(Handle);
		}
	}
	public enum UserOrdering
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("NONE")]
		None,
		[Description("PRESENCE_ALPHABETICAL")]
		PresenceAlphabetical
	}
	public enum UserPresenceStatus
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("ONLINE")]
		Online,
		[Description("OFFLINE")]
		Offline
	}
	public class VoipAudioSourceHiLevel : MonoBehaviour
	{
		public class FilterReadDelegate : MonoBehaviour
		{
			public VoipAudioSourceHiLevel parent;

			private float[] scratchBuffer;

			private void Awake()
			{
				int num = (int)(uint)CAPI.ovr_Voip_GetOutputBufferMaxSize();
				scratchBuffer = new float[num];
			}

			private void OnAudioFilterRead(float[] data, int channels)
			{
				int num = data.Length / channels;
				int num2 = num;
				if (num2 > scratchBuffer.Length)
				{
					Array.Clear(data, 0, data.Length);
					throw new Exception($"Audio system tried to pull {num} bytes, max voip internal ring buffer size {scratchBuffer.Length}");
				}
				int num3 = parent.pcmSource.PeekSizeElements();
				if (num3 < num2)
				{
					if (verboseLogging)
					{
						UnityEngine.Debug.LogFormat("Voip starved! Want {0}, but only have {1} available", num2, num3);
					}
					return;
				}
				int pCM = parent.pcmSource.GetPCM(scratchBuffer, num2);
				if (pCM < num2)
				{
					UnityEngine.Debug.LogWarningFormat("GetPCM() returned {0} samples, expected {1}", pCM, num2);
					return;
				}
				int num4 = 0;
				float num5 = -1f;
				for (int i = 0; i < num; i++)
				{
					float num6 = scratchBuffer[i];
					for (int j = 0; j < channels; j++)
					{
						data[num4++] = num6;
						if (num6 > num5)
						{
							num5 = num6;
						}
					}
				}
				parent.peakAmplitude = num5;
			}
		}

		private int initialPlaybackDelayMS;

		public AudioSource audioSource;

		public float peakAmplitude;

		protected IVoipPCMSource pcmSource;

		private static int audioSystemPlaybackFrequency;

		private static bool verboseLogging;

		public ulong senderID
		{
			set
			{
				pcmSource.SetSenderID(value);
			}
		}

		protected void Stop()
		{
		}

		private VoipSampleRate SampleRateToEnum(int rate)
		{
			return rate switch
			{
				48000 => VoipSampleRate.HZ48000, 
				44100 => VoipSampleRate.HZ44100, 
				24000 => VoipSampleRate.HZ24000, 
				_ => VoipSampleRate.Unknown, 
			};
		}

		protected void Awake()
		{
			CreatePCMSource();
			if (audioSource == null)
			{
				audioSource = base.gameObject.AddComponent<AudioSource>();
			}
			audioSource.gameObject.AddComponent<FilterReadDelegate>();
			audioSource.gameObject.GetComponent<FilterReadDelegate>().parent = this;
			initialPlaybackDelayMS = 40;
			audioSystemPlaybackFrequency = AudioSettings.outputSampleRate;
			CAPI.ovr_Voip_SetOutputSampleRate(SampleRateToEnum(audioSystemPlaybackFrequency));
			if (verboseLogging)
			{
				UnityEngine.Debug.LogFormat("freq {0}", audioSystemPlaybackFrequency);
			}
		}

		private void Start()
		{
			audioSource.Stop();
		}

		protected virtual void CreatePCMSource()
		{
			pcmSource = new VoipPCMSourceNative();
		}

		protected static int MSToElements(int ms)
		{
			return ms * audioSystemPlaybackFrequency / 1000;
		}

		private void Update()
		{
			pcmSource.Update();
			if (!audioSource.isPlaying && pcmSource.PeekSizeElements() >= MSToElements(initialPlaybackDelayMS))
			{
				if (verboseLogging)
				{
					UnityEngine.Debug.LogFormat("buffered {0} elements, starting playback", pcmSource.PeekSizeElements());
				}
				audioSource.Play();
			}
		}
	}
	public enum VoipBitrate
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("B16000")]
		B16000,
		[Description("B24000")]
		B24000,
		[Description("B32000")]
		B32000,
		[Description("B64000")]
		B64000,
		[Description("B96000")]
		B96000,
		[Description("B128000")]
		B128000
	}
	public enum VoipDtxState
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("ENABLED")]
		Enabled,
		[Description("DISABLED")]
		Disabled
	}
	public enum VoipMuteState
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("MUTED")]
		Muted,
		[Description("UNMUTED")]
		Unmuted
	}
	public class VoipOptions
	{
		private IntPtr Handle;

		public VoipOptions()
		{
			Handle = CAPI.ovr_VoipOptions_Create();
		}

		public void SetBitrateForNewConnections(VoipBitrate value)
		{
			CAPI.ovr_VoipOptions_SetBitrateForNewConnections(Handle, value);
		}

		public void SetCreateNewConnectionUseDtx(VoipDtxState value)
		{
			CAPI.ovr_VoipOptions_SetCreateNewConnectionUseDtx(Handle, value);
		}

		public static explicit operator IntPtr(VoipOptions options)
		{
			return options?.Handle ?? IntPtr.Zero;
		}

		~VoipOptions()
		{
			CAPI.ovr_VoipOptions_Destroy(Handle);
		}
	}
	public class VoipPCMSourceNative : IVoipPCMSource
	{
		private ulong senderID;

		public int GetPCM(float[] dest, int length)
		{
			return (int)(uint)CAPI.ovr_Voip_GetPCMFloat(senderID, dest, (UIntPtr)(ulong)length);
		}

		public void SetSenderID(ulong senderID)
		{
			this.senderID = senderID;
		}

		public int PeekSizeElements()
		{
			return (int)(uint)CAPI.ovr_Voip_GetPCMSize(senderID);
		}

		public void Update()
		{
		}
	}
	public enum VoipSampleRate
	{
		[Description("UNKNOWN")]
		Unknown,
		[Description("HZ24000")]
		HZ24000,
		[Description("HZ44100")]
		HZ44100,
		[Description("HZ48000")]
		HZ48000
	}
	public class WindowsPlatform
	{
		[UnmanagedFunctionPointer(CallingConvention.Cdecl)]
		public delegate void UnityLogDelegate(IntPtr tag, IntPtr msg);

		private void CPPLogCallback(IntPtr tag, IntPtr message)
		{
			UnityEngine.Debug.Log($"{Marshal.PtrToStringAnsi(tag)}: {Marshal.PtrToStringAnsi(message)}");
		}

		private IntPtr getCallbackPointer()
		{
			return IntPtr.Zero;
		}

		public bool Initialize(string appId)
		{
			if (string.IsNullOrEmpty(appId))
			{
				throw new UnityException("AppID must not be null or empty");
			}
			CAPI.ovr_UnityInitWrapperWindows(appId, getCallbackPointer());
			return true;
		}

		public Request<PlatformInitialize> AsyncInitialize(string appId)
		{
			if (string.IsNullOrEmpty(appId))
			{
				throw new UnityException("AppID must not be null or empty");
			}
			return new Request<PlatformInitialize>(CAPI.ovr_UnityInitWrapperWindowsAsynchronous(appId, getCallbackPointer()));
		}
	}
}
namespace Oculus.Platform.Models
{
	public class AbuseReportRecording
	{
		public readonly string RecordingUuid;

		public AbuseReportRecording(IntPtr o)
		{
			RecordingUuid = CAPI.ovr_AbuseReportRecording_GetRecordingUuid(o);
		}
	}
	public class AchievementDefinition
	{
		public readonly AchievementType Type;

		public readonly string Name;

		public readonly uint BitfieldLength;

		public readonly ulong Target;

		public AchievementDefinition(IntPtr o)
		{
			Type = CAPI.ovr_AchievementDefinition_GetType(o);
			Name = CAPI.ovr_AchievementDefinition_GetName(o);
			BitfieldLength = CAPI.ovr_AchievementDefinition_GetBitfieldLength(o);
			Target = CAPI.ovr_AchievementDefinition_GetTarget(o);
		}
	}
	public class AchievementDefinitionList : DeserializableList<AchievementDefinition>
	{
		public AchievementDefinitionList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_AchievementDefinitionArray_GetSize(a);
			_Data = new List<AchievementDefinition>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new AchievementDefinition(CAPI.ovr_AchievementDefinitionArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
			_NextUrl = CAPI.ovr_AchievementDefinitionArray_GetNextUrl(a);
		}
	}
	public class AchievementProgress
	{
		public readonly string Bitfield;

		public readonly ulong Count;

		public readonly bool IsUnlocked;

		public readonly string Name;

		public readonly DateTime UnlockTime;

		public AchievementProgress(IntPtr o)
		{
			Bitfield = CAPI.ovr_AchievementProgress_GetBitfield(o);
			Count = CAPI.ovr_AchievementProgress_GetCount(o);
			IsUnlocked = CAPI.ovr_AchievementProgress_GetIsUnlocked(o);
			Name = CAPI.ovr_AchievementProgress_GetName(o);
			UnlockTime = CAPI.ovr_AchievementProgress_GetUnlockTime(o);
		}
	}
	public class AchievementProgressList : DeserializableList<AchievementProgress>
	{
		public AchievementProgressList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_AchievementProgressArray_GetSize(a);
			_Data = new List<AchievementProgress>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new AchievementProgress(CAPI.ovr_AchievementProgressArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
			_NextUrl = CAPI.ovr_AchievementProgressArray_GetNextUrl(a);
		}
	}
	public class AchievementUpdate
	{
		public readonly bool JustUnlocked;

		public readonly string Name;

		public AchievementUpdate(IntPtr o)
		{
			JustUnlocked = CAPI.ovr_AchievementUpdate_GetJustUnlocked(o);
			Name = CAPI.ovr_AchievementUpdate_GetName(o);
		}
	}
	public class ApplicationVersion
	{
		public readonly int CurrentCode;

		public readonly string CurrentName;

		public readonly int LatestCode;

		public readonly string LatestName;

		public ApplicationVersion(IntPtr o)
		{
			CurrentCode = CAPI.ovr_ApplicationVersion_GetCurrentCode(o);
			CurrentName = CAPI.ovr_ApplicationVersion_GetCurrentName(o);
			LatestCode = CAPI.ovr_ApplicationVersion_GetLatestCode(o);
			LatestName = CAPI.ovr_ApplicationVersion_GetLatestName(o);
		}
	}
	public class AssetDetails
	{
		public readonly ulong AssetId;

		public readonly string AssetType;

		public readonly string DownloadStatus;

		public readonly string Filepath;

		public readonly string IapStatus;

		public readonly LanguagePackInfo LanguageOptional;

		[Obsolete("Deprecated in favor of LanguageOptional")]
		public readonly LanguagePackInfo Language;

		public readonly string Metadata;

		public AssetDetails(IntPtr o)
		{
			AssetId = CAPI.ovr_AssetDetails_GetAssetId(o);
			AssetType = CAPI.ovr_AssetDetails_GetAssetType(o);
			DownloadStatus = CAPI.ovr_AssetDetails_GetDownloadStatus(o);
			Filepath = CAPI.ovr_AssetDetails_GetFilepath(o);
			IapStatus = CAPI.ovr_AssetDetails_GetIapStatus(o);
			IntPtr intPtr = CAPI.ovr_AssetDetails_GetLanguage(o);
			Language = new LanguagePackInfo(intPtr);
			if (intPtr == IntPtr.Zero)
			{
				LanguageOptional = null;
			}
			else
			{
				LanguageOptional = Language;
			}
			Metadata = CAPI.ovr_AssetDetails_GetMetadata(o);
		}
	}
	public class AssetDetailsList : DeserializableList<AssetDetails>
	{
		public AssetDetailsList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_AssetDetailsArray_GetSize(a);
			_Data = new List<AssetDetails>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new AssetDetails(CAPI.ovr_AssetDetailsArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
		}
	}
	public class AssetFileDeleteResult
	{
		public readonly ulong AssetFileId;

		public readonly ulong AssetId;

		public readonly string Filepath;

		public readonly bool Success;

		public AssetFileDeleteResult(IntPtr o)
		{
			AssetFileId = CAPI.ovr_AssetFileDeleteResult_GetAssetFileId(o);
			AssetId = CAPI.ovr_AssetFileDeleteResult_GetAssetId(o);
			Filepath = CAPI.ovr_AssetFileDeleteResult_GetFilepath(o);
			Success = CAPI.ovr_AssetFileDeleteResult_GetSuccess(o);
		}
	}
	public class AssetFileDownloadCancelResult
	{
		public readonly ulong AssetFileId;

		public readonly ulong AssetId;

		public readonly string Filepath;

		public readonly bool Success;

		public AssetFileDownloadCancelResult(IntPtr o)
		{
			AssetFileId = CAPI.ovr_AssetFileDownloadCancelResult_GetAssetFileId(o);
			AssetId = CAPI.ovr_AssetFileDownloadCancelResult_GetAssetId(o);
			Filepath = CAPI.ovr_AssetFileDownloadCancelResult_GetFilepath(o);
			Success = CAPI.ovr_AssetFileDownloadCancelResult_GetSuccess(o);
		}
	}
	public class AssetFileDownloadResult
	{
		public readonly ulong AssetId;

		public readonly string Filepath;

		public AssetFileDownloadResult(IntPtr o)
		{
			AssetId = CAPI.ovr_AssetFileDownloadResult_GetAssetId(o);
			Filepath = CAPI.ovr_AssetFileDownloadResult_GetFilepath(o);
		}
	}
	public class AssetFileDownloadUpdate
	{
		public readonly ulong AssetFileId;

		public readonly ulong AssetId;

		public readonly uint BytesTotal;

		public readonly int BytesTransferred;

		public readonly bool Completed;

		public AssetFileDownloadUpdate(IntPtr o)
		{
			AssetFileId = CAPI.ovr_AssetFileDownloadUpdate_GetAssetFileId(o);
			AssetId = CAPI.ovr_AssetFileDownloadUpdate_GetAssetId(o);
			BytesTotal = CAPI.ovr_AssetFileDownloadUpdate_GetBytesTotal(o);
			BytesTransferred = CAPI.ovr_AssetFileDownloadUpdate_GetBytesTransferred(o);
			Completed = CAPI.ovr_AssetFileDownloadUpdate_GetCompleted(o);
		}
	}
	public class CalApplicationFinalized
	{
		public readonly int CountdownMS;

		public readonly ulong ID;

		public readonly string LaunchDetails;

		public CalApplicationFinalized(IntPtr o)
		{
			CountdownMS = CAPI.ovr_CalApplicationFinalized_GetCountdownMS(o);
			ID = CAPI.ovr_CalApplicationFinalized_GetID(o);
			LaunchDetails = CAPI.ovr_CalApplicationFinalized_GetLaunchDetails(o);
		}
	}
	public class CalApplicationProposed
	{
		public readonly ulong ID;

		public CalApplicationProposed(IntPtr o)
		{
			ID = CAPI.ovr_CalApplicationProposed_GetID(o);
		}
	}
	public class CalApplicationSuggestion
	{
		public readonly ulong ID;

		public readonly string SocialContext;

		public CalApplicationSuggestion(IntPtr o)
		{
			ID = CAPI.ovr_CalApplicationSuggestion_GetID(o);
			SocialContext = CAPI.ovr_CalApplicationSuggestion_GetSocialContext(o);
		}
	}
	public class CalApplicationSuggestionList : DeserializableList<CalApplicationSuggestion>
	{
		public CalApplicationSuggestionList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_CalApplicationSuggestionArray_GetSize(a);
			_Data = new List<CalApplicationSuggestion>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new CalApplicationSuggestion(CAPI.ovr_CalApplicationSuggestionArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
		}
	}
	public class CloudStorageConflictMetadata
	{
		public readonly CloudStorageMetadata Local;

		public readonly CloudStorageMetadata Remote;

		public CloudStorageConflictMetadata(IntPtr o)
		{
			Local = new CloudStorageMetadata(CAPI.ovr_CloudStorageConflictMetadata_GetLocal(o));
			Remote = new CloudStorageMetadata(CAPI.ovr_CloudStorageConflictMetadata_GetRemote(o));
		}
	}
	public class CloudStorageData
	{
		public readonly string Bucket;

		public readonly byte[] Data;

		public readonly uint DataSize;

		public readonly string Key;

		public CloudStorageData(IntPtr o)
		{
			Bucket = CAPI.ovr_CloudStorageData_GetBucket(o);
			Data = CAPI.ovr_CloudStorageData_GetData(o);
			DataSize = CAPI.ovr_CloudStorageData_GetDataSize(o);
			Key = CAPI.ovr_CloudStorageData_GetKey(o);
		}
	}
	public class CloudStorageMetadata
	{
		public readonly string Bucket;

		public readonly long Counter;

		public readonly uint DataSize;

		public readonly string ExtraData;

		public readonly string Key;

		public readonly ulong SaveTime;

		public readonly CloudStorageDataStatus Status;

		public readonly string VersionHandle;

		public CloudStorageMetadata(IntPtr o)
		{
			Bucket = CAPI.ovr_CloudStorageMetadata_GetBucket(o);
			Counter = CAPI.ovr_CloudStorageMetadata_GetCounter(o);
			DataSize = CAPI.ovr_CloudStorageMetadata_GetDataSize(o);
			ExtraData = CAPI.ovr_CloudStorageMetadata_GetExtraData(o);
			Key = CAPI.ovr_CloudStorageMetadata_GetKey(o);
			SaveTime = CAPI.ovr_CloudStorageMetadata_GetSaveTime(o);
			Status = CAPI.ovr_CloudStorageMetadata_GetStatus(o);
			VersionHandle = CAPI.ovr_CloudStorageMetadata_GetVersionHandle(o);
		}
	}
	public class CloudStorageMetadataList : DeserializableList<CloudStorageMetadata>
	{
		public CloudStorageMetadataList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_CloudStorageMetadataArray_GetSize(a);
			_Data = new List<CloudStorageMetadata>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new CloudStorageMetadata(CAPI.ovr_CloudStorageMetadataArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
			_NextUrl = CAPI.ovr_CloudStorageMetadataArray_GetNextUrl(a);
		}
	}
	public class CloudStorageUpdateResponse
	{
		public readonly string Bucket;

		public readonly string Key;

		public readonly CloudStorageUpdateStatus Status;

		public readonly string VersionHandle;

		public CloudStorageUpdateResponse(IntPtr o)
		{
			Bucket = CAPI.ovr_CloudStorageUpdateResponse_GetBucket(o);
			Key = CAPI.ovr_CloudStorageUpdateResponse_GetKey(o);
			Status = CAPI.ovr_CloudStorageUpdateResponse_GetStatus(o);
			VersionHandle = CAPI.ovr_CloudStorageUpdateResponse_GetVersionHandle(o);
		}
	}
	public class DeserializableList<T> : IList<T>, ICollection<T>, IEnumerable<T>, IEnumerable
	{
		protected List<T> _Data;

		protected string _NextUrl;

		protected string _PreviousUrl;

		public int Count => _Data.Count;

		bool ICollection<T>.IsReadOnly => ((ICollection<T>)_Data).IsReadOnly;

		public T this[int index]
		{
			get
			{
				return _Data[index];
			}
			set
			{
				_Data[index] = value;
			}
		}

		[Obsolete("Use IList interface on the DeserializableList object instead.", false)]
		public List<T> Data => _Data;

		public bool HasNextPage => !string.IsNullOrEmpty(NextUrl);

		public bool HasPreviousPage => !string.IsNullOrEmpty(PreviousUrl);

		public string NextUrl => _NextUrl;

		public string PreviousUrl => _PreviousUrl;

		public int IndexOf(T obj)
		{
			return _Data.IndexOf(obj);
		}

		public void Add(T item)
		{
			_Data.Add(item);
		}

		public void Clear()
		{
			_Data.Clear();
		}

		public bool Contains(T item)
		{
			return _Data.Contains(item);
		}

		public void CopyTo(T[] array, int arrayIndex)
		{
			_Data.CopyTo(array, arrayIndex);
		}

		public IEnumerator<T> GetEnumerator()
		{
			return _Data.GetEnumerator();
		}

		public void Insert(int index, T item)
		{
			_Data.Insert(index, item);
		}

		public bool Remove(T item)
		{
			return _Data.Remove(item);
		}

		public void RemoveAt(int index)
		{
			_Data.RemoveAt(index);
		}

		private IEnumerator GetEnumerator1()
		{
			return GetEnumerator();
		}

		IEnumerator IEnumerable.GetEnumerator()
		{
			return GetEnumerator1();
		}
	}
	public class Destination
	{
		public readonly string ApiName;

		public readonly string DeeplinkMessage;

		public readonly string DisplayName;

		public Destination(IntPtr o)
		{
			ApiName = CAPI.ovr_Destination_GetApiName(o);
			DeeplinkMessage = CAPI.ovr_Destination_GetDeeplinkMessage(o);
			DisplayName = CAPI.ovr_Destination_GetDisplayName(o);
		}
	}
	public class DestinationList : DeserializableList<Destination>
	{
		public DestinationList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_DestinationArray_GetSize(a);
			_Data = new List<Destination>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new Destination(CAPI.ovr_DestinationArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
			_NextUrl = CAPI.ovr_DestinationArray_GetNextUrl(a);
		}
	}
	public class Error
	{
		public readonly int Code;

		public readonly int HttpCode;

		public readonly string Message;

		public Error(int code, string message, int httpCode)
		{
			Message = message;
			Code = code;
			HttpCode = httpCode;
		}
	}
	public class HttpTransferUpdate
	{
		public readonly ulong ID;

		public readonly byte[] Payload;

		public readonly bool IsCompleted;

		public HttpTransferUpdate(IntPtr o)
		{
			ID = CAPI.ovr_HttpTransferUpdate_GetID(o);
			IsCompleted = CAPI.ovr_HttpTransferUpdate_IsCompleted(o);
			long num = (long)(ulong)CAPI.ovr_HttpTransferUpdate_GetSize(o);
			Payload = new byte[num];
			Marshal.Copy(CAPI.ovr_Packet_GetBytes(o), Payload, 0, (int)num);
		}
	}
	public class InstalledApplication
	{
		public readonly string ApplicationId;

		public readonly string PackageName;

		public readonly string Status;

		public readonly int VersionCode;

		public readonly string VersionName;

		public InstalledApplication(IntPtr o)
		{
			ApplicationId = CAPI.ovr_InstalledApplication_GetApplicationId(o);
			PackageName = CAPI.ovr_InstalledApplication_GetPackageName(o);
			Status = CAPI.ovr_InstalledApplication_GetStatus(o);
			VersionCode = CAPI.ovr_InstalledApplication_GetVersionCode(o);
			VersionName = CAPI.ovr_InstalledApplication_GetVersionName(o);
		}
	}
	public class InstalledApplicationList : DeserializableList<InstalledApplication>
	{
		public InstalledApplicationList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_InstalledApplicationArray_GetSize(a);
			_Data = new List<InstalledApplication>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new InstalledApplication(CAPI.ovr_InstalledApplicationArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
		}
	}
	public class LanguagePackInfo
	{
		public readonly string EnglishName;

		public readonly string NativeName;

		public readonly string Tag;

		public LanguagePackInfo(IntPtr o)
		{
			EnglishName = CAPI.ovr_LanguagePackInfo_GetEnglishName(o);
			NativeName = CAPI.ovr_LanguagePackInfo_GetNativeName(o);
			Tag = CAPI.ovr_LanguagePackInfo_GetTag(o);
		}
	}
	public class LaunchBlockFlowResult
	{
		public readonly bool DidBlock;

		public readonly bool DidCancel;

		public LaunchBlockFlowResult(IntPtr o)
		{
			DidBlock = CAPI.ovr_LaunchBlockFlowResult_GetDidBlock(o);
			DidCancel = CAPI.ovr_LaunchBlockFlowResult_GetDidCancel(o);
		}
	}
	public class LaunchDetails
	{
		public readonly string DeeplinkMessage;

		public readonly string DestinationApiName;

		public readonly string LaunchSource;

		public readonly LaunchType LaunchType;

		public readonly ulong RoomID;

		public readonly UserList UsersOptional;

		[Obsolete("Deprecated in favor of UsersOptional")]
		public readonly UserList Users;

		public LaunchDetails(IntPtr o)
		{
			DeeplinkMessage = CAPI.ovr_LaunchDetails_GetDeeplinkMessage(o);
			DestinationApiName = CAPI.ovr_LaunchDetails_GetDestinationApiName(o);
			LaunchSource = CAPI.ovr_LaunchDetails_GetLaunchSource(o);
			LaunchType = CAPI.ovr_LaunchDetails_GetLaunchType(o);
			RoomID = CAPI.ovr_LaunchDetails_GetRoomID(o);
			IntPtr intPtr = CAPI.ovr_LaunchDetails_GetUsers(o);
			Users = new UserList(intPtr);
			if (intPtr == IntPtr.Zero)
			{
				UsersOptional = null;
			}
			else
			{
				UsersOptional = Users;
			}
		}
	}
	public class LaunchFriendRequestFlowResult
	{
		public readonly bool DidCancel;

		public readonly bool DidSendRequest;

		public LaunchFriendRequestFlowResult(IntPtr o)
		{
			DidCancel = CAPI.ovr_LaunchFriendRequestFlowResult_GetDidCancel(o);
			DidSendRequest = CAPI.ovr_LaunchFriendRequestFlowResult_GetDidSendRequest(o);
		}
	}
	public class LaunchReportFlowResult
	{
		public readonly bool DidCancel;

		public readonly ulong UserReportId;

		public LaunchReportFlowResult(IntPtr o)
		{
			DidCancel = CAPI.ovr_LaunchReportFlowResult_GetDidCancel(o);
			UserReportId = CAPI.ovr_LaunchReportFlowResult_GetUserReportId(o);
		}
	}
	public class LaunchUnblockFlowResult
	{
		public readonly bool DidCancel;

		public readonly bool DidUnblock;

		public LaunchUnblockFlowResult(IntPtr o)
		{
			DidCancel = CAPI.ovr_LaunchUnblockFlowResult_GetDidCancel(o);
			DidUnblock = CAPI.ovr_LaunchUnblockFlowResult_GetDidUnblock(o);
		}
	}
	public class LeaderboardEntry
	{
		public readonly byte[] ExtraData;

		public readonly int Rank;

		public readonly long Score;

		public readonly DateTime Timestamp;

		public readonly User User;

		public LeaderboardEntry(IntPtr o)
		{
			ExtraData = CAPI.ovr_LeaderboardEntry_GetExtraData(o);
			Rank = CAPI.ovr_LeaderboardEntry_GetRank(o);
			Score = CAPI.ovr_LeaderboardEntry_GetScore(o);
			Timestamp = CAPI.ovr_LeaderboardEntry_GetTimestamp(o);
			User = new User(CAPI.ovr_LeaderboardEntry_GetUser(o));
		}
	}
	public class LeaderboardEntryList : DeserializableList<LeaderboardEntry>
	{
		public readonly ulong TotalCount;

		public LeaderboardEntryList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_LeaderboardEntryArray_GetSize(a);
			_Data = new List<LeaderboardEntry>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new LeaderboardEntry(CAPI.ovr_LeaderboardEntryArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
			TotalCount = CAPI.ovr_LeaderboardEntryArray_GetTotalCount(a);
			_PreviousUrl = CAPI.ovr_LeaderboardEntryArray_GetPreviousUrl(a);
			_NextUrl = CAPI.ovr_LeaderboardEntryArray_GetNextUrl(a);
		}
	}
	public class LinkedAccount
	{
		public readonly string AccessToken;

		public readonly ServiceProvider ServiceProvider;

		public readonly string UserId;

		public LinkedAccount(IntPtr o)
		{
			AccessToken = CAPI.ovr_LinkedAccount_GetAccessToken(o);
			ServiceProvider = CAPI.ovr_LinkedAccount_GetServiceProvider(o);
			UserId = CAPI.ovr_LinkedAccount_GetUserId(o);
		}
	}
	public class LinkedAccountList : DeserializableList<LinkedAccount>
	{
		public LinkedAccountList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_LinkedAccountArray_GetSize(a);
			_Data = new List<LinkedAccount>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new LinkedAccount(CAPI.ovr_LinkedAccountArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
		}
	}
	public class LivestreamingApplicationStatus
	{
		public readonly bool StreamingEnabled;

		public LivestreamingApplicationStatus(IntPtr o)
		{
			StreamingEnabled = CAPI.ovr_LivestreamingApplicationStatus_GetStreamingEnabled(o);
		}
	}
	public class LivestreamingStartResult
	{
		public readonly LivestreamingStartStatus StreamingResult;

		public LivestreamingStartResult(IntPtr o)
		{
			StreamingResult = CAPI.ovr_LivestreamingStartResult_GetStreamingResult(o);
		}
	}
	public class LivestreamingStatus
	{
		public readonly bool CommentsVisible;

		public readonly bool IsPaused;

		public readonly bool LivestreamingEnabled;

		public readonly int LivestreamingType;

		public readonly bool MicEnabled;

		public LivestreamingStatus(IntPtr o)
		{
			CommentsVisible = CAPI.ovr_LivestreamingStatus_GetCommentsVisible(o);
			IsPaused = CAPI.ovr_LivestreamingStatus_GetIsPaused(o);
			LivestreamingEnabled = CAPI.ovr_LivestreamingStatus_GetLivestreamingEnabled(o);
			LivestreamingType = CAPI.ovr_LivestreamingStatus_GetLivestreamingType(o);
			MicEnabled = CAPI.ovr_LivestreamingStatus_GetMicEnabled(o);
		}
	}
	public class LivestreamingVideoStats
	{
		public readonly int CommentCount;

		public readonly int ReactionCount;

		public readonly string TotalViews;

		public LivestreamingVideoStats(IntPtr o)
		{
			CommentCount = CAPI.ovr_LivestreamingVideoStats_GetCommentCount(o);
			ReactionCount = CAPI.ovr_LivestreamingVideoStats_GetReactionCount(o);
			TotalViews = CAPI.ovr_LivestreamingVideoStats_GetTotalViews(o);
		}
	}
	public class MatchmakingAdminSnapshot
	{
		public readonly MatchmakingAdminSnapshotCandidateList Candidates;

		public readonly double MyCurrentThreshold;

		public MatchmakingAdminSnapshot(IntPtr o)
		{
			Candidates = new MatchmakingAdminSnapshotCandidateList(CAPI.ovr_MatchmakingAdminSnapshot_GetCandidates(o));
			MyCurrentThreshold = CAPI.ovr_MatchmakingAdminSnapshot_GetMyCurrentThreshold(o);
		}
	}
	public class MatchmakingAdminSnapshotCandidate
	{
		public readonly bool CanMatch;

		public readonly double MyTotalScore;

		public readonly double TheirCurrentThreshold;

		public readonly double TheirTotalScore;

		public readonly string TraceId;

		public MatchmakingAdminSnapshotCandidate(IntPtr o)
		{
			CanMatch = CAPI.ovr_MatchmakingAdminSnapshotCandidate_GetCanMatch(o);
			MyTotalScore = CAPI.ovr_MatchmakingAdminSnapshotCandidate_GetMyTotalScore(o);
			TheirCurrentThreshold = CAPI.ovr_MatchmakingAdminSnapshotCandidate_GetTheirCurrentThreshold(o);
			TheirTotalScore = CAPI.ovr_MatchmakingAdminSnapshotCandidate_GetTheirTotalScore(o);
			TraceId = CAPI.ovr_MatchmakingAdminSnapshotCandidate_GetTraceId(o);
		}
	}
	public class MatchmakingAdminSnapshotCandidateList : DeserializableList<MatchmakingAdminSnapshotCandidate>
	{
		public MatchmakingAdminSnapshotCandidateList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_MatchmakingAdminSnapshotCandidateArray_GetSize(a);
			_Data = new List<MatchmakingAdminSnapshotCandidate>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new MatchmakingAdminSnapshotCandidate(CAPI.ovr_MatchmakingAdminSnapshotCandidateArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
		}
	}
	public class MatchmakingBrowseResult
	{
		public readonly MatchmakingEnqueueResult EnqueueResult;

		public readonly RoomList Rooms;

		public MatchmakingBrowseResult(IntPtr o)
		{
			EnqueueResult = new MatchmakingEnqueueResult(CAPI.ovr_MatchmakingBrowseResult_GetEnqueueResult(o));
			Rooms = new RoomList(CAPI.ovr_MatchmakingBrowseResult_GetRooms(o));
		}
	}
	public class MatchmakingEnqueuedUser
	{
		public readonly Dictionary<string, string> CustomData;

		public readonly User UserOptional;

		[Obsolete("Deprecated in favor of UserOptional")]
		public readonly User User;

		public MatchmakingEnqueuedUser(IntPtr o)
		{
			CustomData = CAPI.DataStoreFromNative(CAPI.ovr_MatchmakingEnqueuedUser_GetCustomData(o));
			IntPtr intPtr = CAPI.ovr_MatchmakingEnqueuedUser_GetUser(o);
			User = new User(intPtr);
			if (intPtr == IntPtr.Zero)
			{
				UserOptional = null;
			}
			else
			{
				UserOptional = User;
			}
		}
	}
	public class MatchmakingEnqueuedUserList : DeserializableList<MatchmakingEnqueuedUser>
	{
		public MatchmakingEnqueuedUserList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_MatchmakingEnqueuedUserArray_GetSize(a);
			_Data = new List<MatchmakingEnqueuedUser>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new MatchmakingEnqueuedUser(CAPI.ovr_MatchmakingEnqueuedUserArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
		}
	}
	public class MatchmakingEnqueueResult
	{
		public readonly MatchmakingAdminSnapshot AdminSnapshotOptional;

		[Obsolete("Deprecated in favor of AdminSnapshotOptional")]
		public readonly MatchmakingAdminSnapshot AdminSnapshot;

		public readonly uint AverageWait;

		public readonly uint MatchesInLastHourCount;

		public readonly uint MaxExpectedWait;

		public readonly string Pool;

		public readonly uint RecentMatchPercentage;

		public readonly string RequestHash;

		public MatchmakingEnqueueResult(IntPtr o)
		{
			IntPtr intPtr = CAPI.ovr_MatchmakingEnqueueResult_GetAdminSnapshot(o);
			AdminSnapshot = new MatchmakingAdminSnapshot(intPtr);
			if (intPtr == IntPtr.Zero)
			{
				AdminSnapshotOptional = null;
			}
			else
			{
				AdminSnapshotOptional = AdminSnapshot;
			}
			AverageWait = CAPI.ovr_MatchmakingEnqueueResult_GetAverageWait(o);
			MatchesInLastHourCount = CAPI.ovr_MatchmakingEnqueueResult_GetMatchesInLastHourCount(o);
			MaxExpectedWait = CAPI.ovr_MatchmakingEnqueueResult_GetMaxExpectedWait(o);
			Pool = CAPI.ovr_MatchmakingEnqueueResult_GetPool(o);
			RecentMatchPercentage = CAPI.ovr_MatchmakingEnqueueResult_GetRecentMatchPercentage(o);
			RequestHash = CAPI.ovr_MatchmakingEnqueueResult_GetRequestHash(o);
		}
	}
	public class MatchmakingEnqueueResultAndRoom
	{
		public readonly MatchmakingEnqueueResult MatchmakingEnqueueResult;

		public readonly Room Room;

		public MatchmakingEnqueueResultAndRoom(IntPtr o)
		{
			MatchmakingEnqueueResult = new MatchmakingEnqueueResult(CAPI.ovr_MatchmakingEnqueueResultAndRoom_GetMatchmakingEnqueueResult(o));
			Room = new Room(CAPI.ovr_MatchmakingEnqueueResultAndRoom_GetRoom(o));
		}
	}
	public class MatchmakingStats
	{
		public readonly uint DrawCount;

		public readonly uint LossCount;

		public readonly uint SkillLevel;

		public readonly double SkillMean;

		public readonly double SkillStandardDeviation;

		public readonly uint WinCount;

		public MatchmakingStats(IntPtr o)
		{
			DrawCount = CAPI.ovr_MatchmakingStats_GetDrawCount(o);
			LossCount = CAPI.ovr_MatchmakingStats_GetLossCount(o);
			SkillLevel = CAPI.ovr_MatchmakingStats_GetSkillLevel(o);
			SkillMean = CAPI.ovr_MatchmakingStats_GetSkillMean(o);
			SkillStandardDeviation = CAPI.ovr_MatchmakingStats_GetSkillStandardDeviation(o);
			WinCount = CAPI.ovr_MatchmakingStats_GetWinCount(o);
		}
	}
	public class NetworkingPeer
	{
		public ulong ID { get; private set; }

		public PeerConnectionState State { get; private set; }

		public NetworkingPeer(ulong id, PeerConnectionState state)
		{
			ID = id;
			State = state;
		}
	}
	public class OrgScopedID
	{
		public readonly ulong ID;

		public OrgScopedID(IntPtr o)
		{
			ID = CAPI.ovr_OrgScopedID_GetID(o);
		}
	}
	public class Party
	{
		public readonly ulong ID;

		public readonly UserList InvitedUsersOptional;

		[Obsolete("Deprecated in favor of InvitedUsersOptional")]
		public readonly UserList InvitedUsers;

		public readonly User LeaderOptional;

		[Obsolete("Deprecated in favor of LeaderOptional")]
		public readonly User Leader;

		public readonly Room RoomOptional;

		[Obsolete("Deprecated in favor of RoomOptional")]
		public readonly Room Room;

		public readonly UserList UsersOptional;

		[Obsolete("Deprecated in favor of UsersOptional")]
		public readonly UserList Users;

		public Party(IntPtr o)
		{
			ID = CAPI.ovr_Party_GetID(o);
			IntPtr intPtr = CAPI.ovr_Party_GetInvitedUsers(o);
			InvitedUsers = new UserList(intPtr);
			if (intPtr == IntPtr.Zero)
			{
				InvitedUsersOptional = null;
			}
			else
			{
				InvitedUsersOptional = InvitedUsers;
			}
			IntPtr intPtr2 = CAPI.ovr_Party_GetLeader(o);
			Leader = new User(intPtr2);
			if (intPtr2 == IntPtr.Zero)
			{
				LeaderOptional = null;
			}
			else
			{
				LeaderOptional = Leader;
			}
			IntPtr intPtr3 = CAPI.ovr_Party_GetRoom(o);
			Room = new Room(intPtr3);
			if (intPtr3 == IntPtr.Zero)
			{
				RoomOptional = null;
			}
			else
			{
				RoomOptional = Room;
			}
			IntPtr intPtr4 = CAPI.ovr_Party_GetUsers(o);
			Users = new UserList(intPtr4);
			if (intPtr4 == IntPtr.Zero)
			{
				UsersOptional = null;
			}
			else
			{
				UsersOptional = Users;
			}
		}
	}
	public class PartyID
	{
		public readonly ulong ID;

		public PartyID(IntPtr o)
		{
			ID = CAPI.ovr_PartyID_GetID(o);
		}
	}
	public class PartyUpdateNotification
	{
		public readonly PartyUpdateAction Action;

		public readonly ulong PartyId;

		public readonly ulong SenderId;

		public readonly string UpdateTimestamp;

		public readonly string UserAlias;

		public readonly ulong UserId;

		public readonly string UserName;

		public PartyUpdateNotification(IntPtr o)
		{
			Action = CAPI.ovr_PartyUpdateNotification_GetAction(o);
			PartyId = CAPI.ovr_PartyUpdateNotification_GetPartyId(o);
			SenderId = CAPI.ovr_PartyUpdateNotification_GetSenderId(o);
			UpdateTimestamp = CAPI.ovr_PartyUpdateNotification_GetUpdateTimestamp(o);
			UserAlias = CAPI.ovr_PartyUpdateNotification_GetUserAlias(o);
			UserId = CAPI.ovr_PartyUpdateNotification_GetUserId(o);
			UserName = CAPI.ovr_PartyUpdateNotification_GetUserName(o);
		}
	}
	public class Pid
	{
		public readonly string Id;

		public Pid(IntPtr o)
		{
			Id = CAPI.ovr_Pid_GetId(o);
		}
	}
	public class PidList : DeserializableList<Pid>
	{
		public PidList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_PidArray_GetSize(a);
			_Data = new List<Pid>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new Pid(CAPI.ovr_PidArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
		}
	}
	public class PingResult
	{
		private ulong? pingTimeUsec;

		public ulong ID { get; private set; }

		public ulong PingTimeUsec
		{
			get
			{
				if (!pingTimeUsec.HasValue)
				{
					return 0uL;
				}
				return pingTimeUsec.Value;
			}
		}

		public bool IsTimeout => !pingTimeUsec.HasValue;

		public PingResult(ulong id, ulong? pingTimeUsec)
		{
			ID = id;
			this.pingTimeUsec = pingTimeUsec;
		}
	}
	public class PlatformInitialize
	{
		public readonly PlatformInitializeResult Result;

		public PlatformInitialize(IntPtr o)
		{
			Result = CAPI.ovr_PlatformInitialize_GetResult(o);
		}
	}
	public class Product
	{
		public readonly string Description;

		public readonly string FormattedPrice;

		public readonly string Name;

		public readonly string Sku;

		public Product(IntPtr o)
		{
			Description = CAPI.ovr_Product_GetDescription(o);
			FormattedPrice = CAPI.ovr_Product_GetFormattedPrice(o);
			Name = CAPI.ovr_Product_GetName(o);
			Sku = CAPI.ovr_Product_GetSKU(o);
		}
	}
	public class ProductList : DeserializableList<Product>
	{
		public ProductList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_ProductArray_GetSize(a);
			_Data = new List<Product>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new Product(CAPI.ovr_ProductArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
			_NextUrl = CAPI.ovr_ProductArray_GetNextUrl(a);
		}
	}
	public class Purchase
	{
		public readonly DateTime ExpirationTime;

		public readonly DateTime GrantTime;

		public readonly ulong ID;

		public readonly string Sku;

		public Purchase(IntPtr o)
		{
			ExpirationTime = CAPI.ovr_Purchase_GetExpirationTime(o);
			GrantTime = CAPI.ovr_Purchase_GetGrantTime(o);
			ID = CAPI.ovr_Purchase_GetPurchaseID(o);
			Sku = CAPI.ovr_Purchase_GetSKU(o);
		}
	}
	public class PurchaseList : DeserializableList<Purchase>
	{
		public PurchaseList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_PurchaseArray_GetSize(a);
			_Data = new List<Purchase>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new Purchase(CAPI.ovr_PurchaseArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
			_NextUrl = CAPI.ovr_PurchaseArray_GetNextUrl(a);
		}
	}
	public class Room
	{
		public readonly ulong ApplicationID;

		public readonly Dictionary<string, string> DataStore;

		public readonly string Description;

		public readonly ulong ID;

		public readonly UserList InvitedUsersOptional;

		[Obsolete("Deprecated in favor of InvitedUsersOptional")]
		public readonly UserList InvitedUsers;

		public readonly bool IsMembershipLocked;

		public readonly RoomJoinPolicy JoinPolicy;

		public readonly RoomJoinability Joinability;

		public readonly MatchmakingEnqueuedUserList MatchedUsersOptional;

		[Obsolete("Deprecated in favor of MatchedUsersOptional")]
		public readonly MatchmakingEnqueuedUserList MatchedUsers;

		public readonly uint MaxUsers;

		public readonly string Name;

		public readonly User OwnerOptional;

		[Obsolete("Deprecated in favor of OwnerOptional")]
		public readonly User Owner;

		public readonly TeamList TeamsOptional;

		[Obsolete("Deprecated in favor of TeamsOptional")]
		public readonly TeamList Teams;

		public readonly RoomType Type;

		public readonly UserList UsersOptional;

		[Obsolete("Deprecated in favor of UsersOptional")]
		public readonly UserList Users;

		public readonly uint Version;

		public Room(IntPtr o)
		{
			ApplicationID = CAPI.ovr_Room_GetApplicationID(o);
			DataStore = CAPI.DataStoreFromNative(CAPI.ovr_Room_GetDataStore(o));
			Description = CAPI.ovr_Room_GetDescription(o);
			ID = CAPI.ovr_Room_GetID(o);
			IntPtr intPtr = CAPI.ovr_Room_GetInvitedUsers(o);
			InvitedUsers = new UserList(intPtr);
			if (intPtr == IntPtr.Zero)
			{
				InvitedUsersOptional = null;
			}
			else
			{
				InvitedUsersOptional = InvitedUsers;
			}
			IsMembershipLocked = CAPI.ovr_Room_GetIsMembershipLocked(o);
			JoinPolicy = CAPI.ovr_Room_GetJoinPolicy(o);
			Joinability = CAPI.ovr_Room_GetJoinability(o);
			IntPtr intPtr2 = CAPI.ovr_Room_GetMatchedUsers(o);
			MatchedUsers = new MatchmakingEnqueuedUserList(intPtr2);
			if (intPtr2 == IntPtr.Zero)
			{
				MatchedUsersOptional = null;
			}
			else
			{
				MatchedUsersOptional = MatchedUsers;
			}
			MaxUsers = CAPI.ovr_Room_GetMaxUsers(o);
			Name = CAPI.ovr_Room_GetName(o);
			IntPtr intPtr3 = CAPI.ovr_Room_GetOwner(o);
			Owner = new User(intPtr3);
			if (intPtr3 == IntPtr.Zero)
			{
				OwnerOptional = null;
			}
			else
			{
				OwnerOptional = Owner;
			}
			IntPtr intPtr4 = CAPI.ovr_Room_GetTeams(o);
			Teams = new TeamList(intPtr4);
			if (intPtr4 == IntPtr.Zero)
			{
				TeamsOptional = null;
			}
			else
			{
				TeamsOptional = Teams;
			}
			Type = CAPI.ovr_Room_GetType(o);
			IntPtr intPtr5 = CAPI.ovr_Room_GetUsers(o);
			Users = new UserList(intPtr5);
			if (intPtr5 == IntPtr.Zero)
			{
				UsersOptional = null;
			}
			else
			{
				UsersOptional = Users;
			}
			Version = CAPI.ovr_Room_GetVersion(o);
		}
	}
	public class RoomList : DeserializableList<Room>
	{
		public RoomList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_RoomArray_GetSize(a);
			_Data = new List<Room>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new Room(CAPI.ovr_RoomArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
			_NextUrl = CAPI.ovr_RoomArray_GetNextUrl(a);
		}
	}
	public class RoomInviteNotification
	{
		public readonly ulong ID;

		public readonly ulong RoomID;

		public readonly ulong SenderID;

		public readonly DateTime SentTime;

		public RoomInviteNotification(IntPtr o)
		{
			ID = CAPI.ovr_RoomInviteNotification_GetID(o);
			RoomID = CAPI.ovr_RoomInviteNotification_GetRoomID(o);
			SenderID = CAPI.ovr_RoomInviteNotification_GetSenderID(o);
			SentTime = CAPI.ovr_RoomInviteNotification_GetSentTime(o);
		}
	}
	public class RoomInviteNotificationList : DeserializableList<RoomInviteNotification>
	{
		public RoomInviteNotificationList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_RoomInviteNotificationArray_GetSize(a);
			_Data = new List<RoomInviteNotification>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new RoomInviteNotification(CAPI.ovr_RoomInviteNotificationArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
			_NextUrl = CAPI.ovr_RoomInviteNotificationArray_GetNextUrl(a);
		}
	}
	public class SdkAccount
	{
		public readonly SdkAccountType AccountType;

		public readonly ulong UserId;

		public SdkAccount(IntPtr o)
		{
			AccountType = CAPI.ovr_SdkAccount_GetAccountType(o);
			UserId = CAPI.ovr_SdkAccount_GetUserId(o);
		}
	}
	public class SdkAccountList : DeserializableList<SdkAccount>
	{
		public SdkAccountList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_SdkAccountArray_GetSize(a);
			_Data = new List<SdkAccount>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new SdkAccount(CAPI.ovr_SdkAccountArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
		}
	}
	public class ShareMediaResult
	{
		public readonly ShareMediaStatus Status;

		public ShareMediaResult(IntPtr o)
		{
			Status = CAPI.ovr_ShareMediaResult_GetStatus(o);
		}
	}
	public class SystemPermission
	{
		public readonly bool HasPermission;

		public readonly PermissionGrantStatus PermissionGrantStatus;

		public SystemPermission(IntPtr o)
		{
			HasPermission = CAPI.ovr_SystemPermission_GetHasPermission(o);
			PermissionGrantStatus = CAPI.ovr_SystemPermission_GetPermissionGrantStatus(o);
		}
	}
	public class SystemVoipState
	{
		public readonly VoipMuteState MicrophoneMuted;

		public readonly SystemVoipStatus Status;

		public SystemVoipState(IntPtr o)
		{
			MicrophoneMuted = CAPI.ovr_SystemVoipState_GetMicrophoneMuted(o);
			Status = CAPI.ovr_SystemVoipState_GetStatus(o);
		}
	}
	public class Team
	{
		public readonly UserList AssignedUsers;

		public readonly int MaxUsers;

		public readonly int MinUsers;

		public readonly string Name;

		public Team(IntPtr o)
		{
			AssignedUsers = new UserList(CAPI.ovr_Team_GetAssignedUsers(o));
			MaxUsers = CAPI.ovr_Team_GetMaxUsers(o);
			MinUsers = CAPI.ovr_Team_GetMinUsers(o);
			Name = CAPI.ovr_Team_GetName(o);
		}
	}
	public class TeamList : DeserializableList<Team>
	{
		public TeamList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_TeamArray_GetSize(a);
			_Data = new List<Team>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new Team(CAPI.ovr_TeamArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
		}
	}
	public class User
	{
		public readonly ulong ID;

		public readonly string ImageURL;

		public readonly string InviteToken;

		public readonly string OculusID;

		public readonly string Presence;

		public readonly string PresenceDeeplinkMessage;

		public readonly string PresenceDestinationApiName;

		public readonly UserPresenceStatus PresenceStatus;

		public readonly string SmallImageUrl;

		public User(IntPtr o)
		{
			ID = CAPI.ovr_User_GetID(o);
			ImageURL = CAPI.ovr_User_GetImageUrl(o);
			InviteToken = CAPI.ovr_User_GetInviteToken(o);
			OculusID = CAPI.ovr_User_GetOculusID(o);
			Presence = CAPI.ovr_User_GetPresence(o);
			PresenceDeeplinkMessage = CAPI.ovr_User_GetPresenceDeeplinkMessage(o);
			PresenceDestinationApiName = CAPI.ovr_User_GetPresenceDestinationApiName(o);
			PresenceStatus = CAPI.ovr_User_GetPresenceStatus(o);
			SmallImageUrl = CAPI.ovr_User_GetSmallImageUrl(o);
		}
	}
	public class UserList : DeserializableList<User>
	{
		public UserList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_UserArray_GetSize(a);
			_Data = new List<User>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new User(CAPI.ovr_UserArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
			_NextUrl = CAPI.ovr_UserArray_GetNextUrl(a);
		}
	}
	public class UserAndRoom
	{
		public readonly Room RoomOptional;

		[Obsolete("Deprecated in favor of RoomOptional")]
		public readonly Room Room;

		public readonly User User;

		public UserAndRoom(IntPtr o)
		{
			IntPtr intPtr = CAPI.ovr_UserAndRoom_GetRoom(o);
			Room = new Room(intPtr);
			if (intPtr == IntPtr.Zero)
			{
				RoomOptional = null;
			}
			else
			{
				RoomOptional = Room;
			}
			User = new User(CAPI.ovr_UserAndRoom_GetUser(o));
		}
	}
	public class UserAndRoomList : DeserializableList<UserAndRoom>
	{
		public UserAndRoomList(IntPtr a)
		{
			int num = (int)(uint)CAPI.ovr_UserAndRoomArray_GetSize(a);
			_Data = new List<UserAndRoom>(num);
			for (int i = 0; i < num; i++)
			{
				_Data.Add(new UserAndRoom(CAPI.ovr_UserAndRoomArray_GetElement(a, (UIntPtr)(ulong)i)));
			}
			_NextUrl = CAPI.ovr_UserAndRoomArray_GetNextUrl(a);
		}
	}
	public class UserProof
	{
		public readonly string Value;

		public UserProof(IntPtr o)
		{
			Value = CAPI.ovr_UserProof_GetNonce(o);
		}
	}
	public class UserReportID
	{
		public readonly bool DidCancel;

		public readonly ulong ID;

		public UserReportID(IntPtr o)
		{
			DidCancel = CAPI.ovr_UserReportID_GetDidCancel(o);
			ID = CAPI.ovr_UserReportID_GetID(o);
		}
	}
}
namespace Oculus.Platform.Samples.VrVoiceChat
{
	public class P2PManager
	{
		private static readonly float UPDATE_DELAY = 0.1f;

		private ulong m_remoteID;

		private PeerConnectionState m_state;

		private float m_timeForNextUpdate;

		private static readonly byte PACKET_SIZE = 29;

		private static readonly byte PACKET_FORMAT = 0;

		private readonly byte[] sendTransformBuffer = new byte[PACKET_SIZE];

		private readonly byte[] receiveTransformBuffer = new byte[PACKET_SIZE];

		private Vector3 receivedPosition;

		private Vector3 receivedPositionPrior;

		private Quaternion receivedRotation;

		private Quaternion receivedRotationPrior;

		private float receivedTime;

		public bool Connected => m_state == PeerConnectionState.Connected;

		public bool ShouldSendHeadUpdate
		{
			get
			{
				if (Time.time >= m_timeForNextUpdate)
				{
					return m_state == PeerConnectionState.Connected;
				}
				return false;
			}
		}

		public P2PManager(Transform initialHeadTransform)
		{
			receivedPositionPrior = (receivedPosition = initialHeadTransform.localPosition);
			receivedRotationPrior = (receivedRotation = initialHeadTransform.localRotation);
			Net.SetPeerConnectRequestCallback(PeerConnectRequestCallback);
			Net.SetConnectionStateChangedCallback(ConnectionStateChangedCallback);
		}

		public void ConnectTo(ulong userID)
		{
			m_remoteID = userID;
			if (PlatformManager.MyID < userID)
			{
				Net.Connect(userID);
			}
		}

		public void Disconnect()
		{
			if (m_remoteID != 0L)
			{
				Net.Close(m_remoteID);
				m_remoteID = 0uL;
				m_state = PeerConnectionState.Unknown;
			}
		}

		private void PeerConnectRequestCallback(Message<NetworkingPeer> msg)
		{
			UnityEngine.Debug.LogFormat("Connection request from {0}, authorized is {1}", msg.Data.ID, m_remoteID);
			if (msg.Data.ID == m_remoteID)
			{
				Net.Accept(msg.Data.ID);
			}
		}

		private void ConnectionStateChangedCallback(Message<NetworkingPeer> msg)
		{
			UnityEngine.Debug.LogFormat("Connection state to {0} changed to {1}", msg.Data.ID, msg.Data.State);
			if (msg.Data.ID == m_remoteID)
			{
				m_state = msg.Data.State;
				if (m_state == PeerConnectionState.Timeout && PlatformManager.MyID < m_remoteID)
				{
					Net.Connect(m_remoteID);
				}
			}
			PlatformManager.SetBackgroundColorForState();
		}

		public void SendHeadTransform(Transform headTransform)
		{
			m_timeForNextUpdate = Time.time + UPDATE_DELAY;
			sendTransformBuffer[0] = PACKET_FORMAT;
			int offset = 1;
			PackFloat(headTransform.localPosition.x, sendTransformBuffer, ref offset);
			PackFloat(headTransform.localPosition.y, sendTransformBuffer, ref offset);
			PackFloat(headTransform.localPosition.z, sendTransformBuffer, ref offset);
			PackFloat(headTransform.localRotation.x, sendTransformBuffer, ref offset);
			PackFloat(headTransform.localRotation.y, sendTransformBuffer, ref offset);
			PackFloat(headTransform.localRotation.z, sendTransformBuffer, ref offset);
			PackFloat(headTransform.localRotation.w, sendTransformBuffer, ref offset);
			Net.SendPacket(m_remoteID, sendTransformBuffer, SendPolicy.Unreliable);
		}

		private void PackFloat(float f, byte[] buf, ref int offset)
		{
			Buffer.BlockCopy(BitConverter.GetBytes(f), 0, buf, offset, 4);
			offset += 4;
		}

		public void GetRemoteHeadTransform(Transform headTransform)
		{
			bool flag = false;
			Packet packet;
			while ((packet = Net.ReadPacket()) != null)
			{
				if (packet.Size != PACKET_SIZE)
				{
					UnityEngine.Debug.Log("Invalid packet size: " + packet.Size);
					continue;
				}
				packet.ReadBytes(receiveTransformBuffer);
				if (receiveTransformBuffer[0] != PACKET_FORMAT)
				{
					UnityEngine.Debug.Log("Invalid packet type: " + packet.Size);
				}
				else
				{
					flag = true;
				}
			}
			if (flag)
			{
				receivedPositionPrior = receivedPosition;
				receivedPosition.x = BitConverter.ToSingle(receiveTransformBuffer, 1);
				receivedPosition.y = BitConverter.ToSingle(receiveTransformBuffer, 5);
				receivedPosition.z = BitConverter.ToSingle(receiveTransformBuffer, 9);
				receivedRotationPrior = receivedRotation;
				receivedRotation.x = BitConverter.ToSingle(receiveTransformBuffer, 13);
				receivedRotation.y = BitConverter.ToSingle(receiveTransformBuffer, 17) * -1f;
				receivedRotation.z = BitConverter.ToSingle(receiveTransformBuffer, 21);
				receivedRotation.w = BitConverter.ToSingle(receiveTransformBuffer, 25) * -1f;
				receivedTime = Time.time;
			}
			float t = Math.Min(Time.time - receivedTime, UPDATE_DELAY) / UPDATE_DELAY;
			headTransform.localPosition = Vector3.Lerp(receivedPositionPrior, receivedPosition, t);
			headTransform.localRotation = Quaternion.Slerp(receivedRotationPrior, receivedRotation, t);
		}
	}
	public class PlatformManager : MonoBehaviour
	{
		public enum State
		{
			INITIALIZING,
			WAITING_TO_CALL_OR_ANSWER,
			WAITING_FOR_ANSWER,
			CONNECTED_IN_A_ROOM,
			HANGUP
		}

		[SerializeField]
		private GameObject m_invitesList;

		[SerializeField]
		private GameObject m_invitePrefab;

		[SerializeField]
		private Camera m_camera;

		[SerializeField]
		private GameObject m_remoteHead;

		private State m_currentState;

		private static PlatformManager s_instance;

		private RoomManager m_roomManager;

		private P2PManager m_p2pManager;

		private VoipManager m_voipManager;

		private ulong m_myID;

		private string m_myOculusID;

		public static State CurrentState => s_instance.m_currentState;

		public static ulong MyID
		{
			get
			{
				if (s_instance != null)
				{
					return s_instance.m_myID;
				}
				return 0uL;
			}
		}

		public static string MyOculusID
		{
			get
			{
				if (s_instance != null && s_instance.m_myOculusID != null)
				{
					return s_instance.m_myOculusID;
				}
				return string.Empty;
			}
		}

		private void Update()
		{
			if (m_roomManager.ShouldPollInviteList)
			{
				m_roomManager.UpdateActiveInvitesList();
			}
			if (m_p2pManager.ShouldSendHeadUpdate)
			{
				m_p2pManager.SendHeadTransform(m_camera.transform);
			}
			m_p2pManager.GetRemoteHeadTransform(m_remoteHead.transform);
		}

		private void Awake()
		{
			if (s_instance != null)
			{
				UnityEngine.Object.Destroy(base.gameObject);
				return;
			}
			s_instance = this;
			UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
			TransitionToState(State.INITIALIZING);
			Core.Initialize();
			m_roomManager = new RoomManager();
			m_p2pManager = new P2PManager(m_remoteHead.transform);
			m_voipManager = new VoipManager(m_remoteHead);
		}

		private void Start()
		{
			Entitlements.IsUserEntitledToApplication().OnComplete(IsEntitledCallback);
		}

		private void IsEntitledCallback(Message msg)
		{
			if (msg.IsError)
			{
				TerminateWithError(msg);
			}
			else
			{
				Users.GetLoggedInUser().OnComplete(GetLoggedInUserCallback);
			}
		}

		private void GetLoggedInUserCallback(Message<User> msg)
		{
			if (msg.IsError)
			{
				TerminateWithError(msg);
				return;
			}
			m_myID = msg.Data.ID;
			m_myOculusID = msg.Data.OculusID;
			TransitionToState(State.WAITING_TO_CALL_OR_ANSWER);
			m_roomManager.CheckForLaunchInvite();
		}

		private void OnApplicationQuit()
		{
			m_roomManager.LeaveCurrentRoom();
			m_p2pManager.Disconnect();
			m_voipManager.Disconnect();
		}

		public static void TerminateWithError(Message msg)
		{
			UnityEngine.Debug.Log("Error: " + msg.GetError().Message);
			UnityEngine.Application.Quit();
		}

		public void CallFriendOnClick()
		{
			if (CurrentState == State.WAITING_TO_CALL_OR_ANSWER)
			{
				m_roomManager.CreateRoomAndLaunchInviteMenu();
			}
		}

		public void HangupOnClick()
		{
			m_roomManager.LeaveCurrentRoom();
		}

		public void QuitOnClick()
		{
			UnityEngine.Application.Quit();
		}

		public static void AnswerCallOnClick(ulong roomID)
		{
			if ((bool)s_instance)
			{
				s_instance.m_roomManager.JoinExistingRoom(roomID);
			}
		}

		public static void TransitionToState(State newState)
		{
			UnityEngine.Debug.LogFormat("State {0} -> {1}", s_instance.m_currentState, newState);
			if ((bool)s_instance && s_instance.m_currentState != newState)
			{
				s_instance.m_currentState = newState;
				switch (newState)
				{
				case State.HANGUP:
					s_instance.m_roomManager.LeaveCurrentRoom();
					s_instance.m_p2pManager.Disconnect();
					s_instance.m_voipManager.Disconnect();
					break;
				case State.CONNECTED_IN_A_ROOM:
					s_instance.m_p2pManager.ConnectTo(s_instance.m_roomManager.RemoteUserID);
					s_instance.m_voipManager.ConnectTo(s_instance.m_roomManager.RemoteUserID);
					break;
				}
			}
			SetBackgroundColorForState();
		}

		public static void SetBackgroundColorForState()
		{
			switch (s_instance.m_currentState)
			{
			case State.INITIALIZING:
			case State.HANGUP:
				s_instance.m_camera.backgroundColor = Color.black;
				break;
			case State.WAITING_TO_CALL_OR_ANSWER:
				s_instance.m_camera.backgroundColor = new Color(0f, 0f, 0.3f);
				break;
			case State.WAITING_FOR_ANSWER:
				s_instance.m_camera.backgroundColor = new Color(0f, 0f, 0.6f);
				break;
			case State.CONNECTED_IN_A_ROOM:
			{
				float r = (s_instance.m_p2pManager.Connected ? 1f : 0f);
				float g = (s_instance.m_voipManager.Connected ? 1f : 0f);
				s_instance.m_camera.backgroundColor = new Color(r, g, 1f);
				break;
			}
			}
		}

		public static void SetActiveInvites(List<RoomManager.Invite> invites)
		{
			if (!s_instance || !s_instance.m_invitesList || !s_instance.m_invitePrefab)
			{
				return;
			}
			foreach (Transform item in s_instance.m_invitesList.transform)
			{
				UnityEngine.Object.Destroy(item.gameObject);
			}
			foreach (RoomManager.Invite invite in invites)
			{
				GameObject obj = UnityEngine.Object.Instantiate(s_instance.m_invitePrefab);
				obj.GetComponentInChildren<Text>().text = invite.OwnerID;
				obj.name = invite.RoomID.ToString();
				obj.GetComponent<Button>().onClick.AddListener(delegate
				{
					AnswerCallOnClick(invite.RoomID);
				});
				obj.transform.SetParent(s_instance.m_invitesList.transform, worldPositionStays: false);
			}
		}
	}
	public class RoomManager
	{
		public struct Invite
		{
			public readonly ulong RoomID;

			public readonly string OwnerID;

			public Invite(ulong roomID, string owner)
			{
				RoomID = roomID;
				OwnerID = owner;
			}
		}

		private ulong m_roomID;

		private User m_remoteUser;

		private static readonly float INVITE_POLL_FREQ_SECONDS = 5f;

		private float m_nextPollTime;

		private HashSet<ulong> m_pendingRoomRequests;

		private List<Invite> m_invites;

		public ulong RemoteUserID
		{
			get
			{
				if (m_remoteUser == null)
				{
					return 0uL;
				}
				return m_remoteUser.ID;
			}
		}

		public string RemoteOculusID
		{
			get
			{
				if (m_remoteUser == null)
				{
					return string.Empty;
				}
				return m_remoteUser.OculusID;
			}
		}

		public bool ShouldPollInviteList
		{
			get
			{
				if (m_pendingRoomRequests == null)
				{
					return Time.time >= m_nextPollTime;
				}
				return false;
			}
		}

		public RoomManager()
		{
			Rooms.SetRoomInviteAcceptedNotificationCallback(LaunchedFromAcceptingInviteCallback);
			Rooms.SetUpdateNotificationCallback(RoomUpdateCallback);
		}

		private void LaunchedFromAcceptingInviteCallback(Message<string> msg)
		{
			if (msg.IsError)
			{
				PlatformManager.TerminateWithError(msg);
				return;
			}
			UnityEngine.Debug.Log("Launched Invite to join Room: " + msg.Data);
			m_roomID = Convert.ToUInt64(msg.GetString());
		}

		public bool CheckForLaunchInvite()
		{
			if (m_roomID != 0L)
			{
				JoinExistingRoom(m_roomID);
				return true;
			}
			return false;
		}

		public void CreateRoomAndLaunchInviteMenu()
		{
			Rooms.CreateAndJoinPrivate(RoomJoinPolicy.InvitedUsers, 2u, subscribeToUpdates: true).OnComplete(CreateAndJoinPrivateRoomCallback);
		}

		private void CreateAndJoinPrivateRoomCallback(Message<Oculus.Platform.Models.Room> msg)
		{
			if (msg.IsError)
			{
				PlatformManager.TerminateWithError(msg);
				return;
			}
			m_roomID = msg.Data.ID;
			m_remoteUser = null;
			PlatformManager.TransitionToState(PlatformManager.State.WAITING_FOR_ANSWER);
			Rooms.LaunchInvitableUserFlow(m_roomID).OnComplete(OnLaunchInviteWorkflowComplete);
		}

		private void OnLaunchInviteWorkflowComplete(Message msg)
		{
			if (msg.IsError)
			{
				PlatformManager.TerminateWithError(msg);
			}
		}

		public void UpdateActiveInvitesList()
		{
			m_nextPollTime = Time.time + INVITE_POLL_FREQ_SECONDS;
			m_pendingRoomRequests = new HashSet<ulong>();
			m_invites = new List<Invite>();
			Notifications.GetRoomInviteNotifications().OnComplete(GetRoomInviteNotificationsCallback);
		}

		private void GetRoomInviteNotificationsCallback(Message msg_untyped)
		{
			Message<RoomInviteNotificationList> message = (Message<RoomInviteNotificationList>)msg_untyped;
			if (message.IsError)
			{
				PlatformManager.TerminateWithError(message);
				return;
			}
			foreach (RoomInviteNotification datum in message.Data)
			{
				m_pendingRoomRequests.Add(datum.RoomID);
				Rooms.Get(datum.RoomID).OnComplete(GetRoomInfoCallback);
			}
			if (message.Data.Count == 0)
			{
				m_pendingRoomRequests = null;
				PlatformManager.SetActiveInvites(m_invites);
			}
		}

		private void GetRoomInfoCallback(Message<Oculus.Platform.Models.Room> msg)
		{
			if (msg.IsError)
			{
				PlatformManager.TerminateWithError(msg);
				return;
			}
			if (msg.Data.OwnerOptional != null)
			{
				Invite item = new Invite(msg.Data.ID, msg.Data.OwnerOptional.OculusID);
				m_pendingRoomRequests.Remove(item.RoomID);
				if (msg.Data.UsersOptional != null && msg.Data.UsersOptional.Count == 1)
				{
					m_invites.Add(item);
				}
			}
			if (m_pendingRoomRequests.Count == 0)
			{
				m_pendingRoomRequests = null;
				PlatformManager.SetActiveInvites(m_invites);
			}
		}

		public void JoinExistingRoom(ulong roomID)
		{
			Rooms.Join(roomID, subscribeToUpdates: true).OnComplete(JoinRoomCallback);
		}

		private void JoinRoomCallback(Message<Oculus.Platform.Models.Room> msg)
		{
			if (msg.IsError)
			{
				return;
			}
			string text = ((msg.Data.OwnerOptional != null) ? msg.Data.OwnerOptional.OculusID : "");
			int num = ((msg.Data.UsersOptional != null) ? msg.Data.UsersOptional.Count : 0);
			UnityEngine.Debug.LogFormat("Joined room: {0} owner: {1} count: ", msg.Data.ID, text, num);
			m_roomID = msg.Data.ID;
			if (msg.Data.UsersOptional == null || msg.Data.UsersOptional.Count != 2)
			{
				PlatformManager.TransitionToState(PlatformManager.State.HANGUP);
			}
			else
			{
				foreach (User item in msg.Data.UsersOptional)
				{
					if (item.ID != PlatformManager.MyID)
					{
						m_remoteUser = item;
					}
				}
				PlatformManager.TransitionToState(PlatformManager.State.CONNECTED_IN_A_ROOM);
			}
			m_nextPollTime = Time.time;
		}

		private void RoomUpdateCallback(Message<Oculus.Platform.Models.Room> msg)
		{
			if (msg.IsError)
			{
				PlatformManager.TerminateWithError(msg);
				return;
			}
			string text = ((msg.Data.OwnerOptional != null) ? msg.Data.OwnerOptional.OculusID : "");
			int num = ((msg.Data.UsersOptional != null) ? msg.Data.UsersOptional.Count : 0);
			UnityEngine.Debug.LogFormat("Room {0} Update: {1} owner: {2} count: ", msg.Data.ID, text, num);
			if (msg.Data.UsersOptional == null || msg.Data.UsersOptional.Count != 2)
			{
				PlatformManager.TransitionToState(PlatformManager.State.HANGUP);
				return;
			}
			foreach (User item in msg.Data.UsersOptional)
			{
				if (item.ID != PlatformManager.MyID)
				{
					m_remoteUser = item;
				}
			}
			PlatformManager.TransitionToState(PlatformManager.State.CONNECTED_IN_A_ROOM);
		}

		public void LeaveCurrentRoom()
		{
			if (m_roomID != 0L)
			{
				Rooms.Leave(m_roomID);
				m_roomID = 0uL;
				m_remoteUser = null;
			}
			PlatformManager.TransitionToState(PlatformManager.State.WAITING_TO_CALL_OR_ANSWER);
		}
	}
	public class VoipManager
	{
		private ulong m_remoteID;

		private PeerConnectionState m_state;

		private readonly GameObject m_remoteHead;

		public bool Connected => m_state == PeerConnectionState.Connected;

		public VoipManager(GameObject remoteHead)
		{
			m_remoteHead = remoteHead;
			Voip.SetVoipConnectRequestCallback(VoipConnectRequestCallback);
			Voip.SetVoipStateChangeCallback(VoipStateChangedCallback);
		}

		public void ConnectTo(ulong userID)
		{
			m_remoteID = userID;
			m_remoteHead.AddComponent<VoipAudioSourceHiLevel>().senderID = userID;
			if (PlatformManager.MyID < m_remoteID)
			{
				Voip.Start(userID);
			}
		}

		public void Disconnect()
		{
			if (m_remoteID != 0L)
			{
				Voip.Stop(m_remoteID);
				UnityEngine.Object.Destroy(m_remoteHead.GetComponent<VoipAudioSourceHiLevel>(), 0f);
				m_remoteID = 0uL;
				m_state = PeerConnectionState.Unknown;
			}
		}

		private void VoipConnectRequestCallback(Message<NetworkingPeer> msg)
		{
			UnityEngine.Debug.LogFormat("Voip request from {0}, authorized is {1}", msg.Data.ID, m_remoteID);
			if (msg.Data.ID == m_remoteID)
			{
				Voip.Accept(msg.Data.ID);
			}
		}

		private void VoipStateChangedCallback(Message<NetworkingPeer> msg)
		{
			UnityEngine.Debug.LogFormat("Voip state to {0} changed to {1}", msg.Data.ID, msg.Data.State);
			if (msg.Data.ID == m_remoteID)
			{
				m_state = msg.Data.State;
				if (m_state == PeerConnectionState.Timeout && PlatformManager.MyID < m_remoteID)
				{
					Voip.Start(m_remoteID);
				}
			}
			PlatformManager.SetBackgroundColorForState();
		}
	}
	public class VREyeRaycaster : MonoBehaviour
	{
		[SerializeField]
		private EventSystem m_eventSystem;

		private Button m_currentButton;

		private void Update()
		{
			Button button = null;
			if (Physics.Raycast(base.transform.position, base.transform.forward, out var hitInfo, 50f))
			{
				button = hitInfo.collider.GetComponent<Button>();
			}
			if (button != null)
			{
				if (m_currentButton != button)
				{
					m_currentButton = button;
					m_currentButton.Select();
				}
			}
			else if (m_currentButton != null)
			{
				m_currentButton = null;
				if (m_eventSystem != null)
				{
					m_eventSystem.SetSelectedGameObject(null);
				}
			}
		}
	}
}
namespace Oculus.Platform.Samples.VrHoops
{
	public class AchievementsManager
	{
		private const string LIKES_TO_WIN = "LIKES_TO_WIN";

		private bool m_likesToWinUnlocked;

		public bool LikesToWin => m_likesToWinUnlocked;

		public void CheckForAchievmentUpdates()
		{
			Achievements.GetProgressByName(new string[1] { "LIKES_TO_WIN" }).OnComplete(delegate(Message<AchievementProgressList> msg)
			{
				foreach (AchievementProgress datum in msg.Data)
				{
					if (datum.Name == "LIKES_TO_WIN")
					{
						m_likesToWinUnlocked = datum.IsUnlocked;
					}
				}
			});
		}

		public void RecordWinForLocalUser()
		{
			Achievements.AddCount("LIKES_TO_WIN", 1uL);
			CheckForAchievmentUpdates();
		}
	}
	public class AIPlayer : Player
	{
		private void FixedUpdate()
		{
			if (base.HasBall)
			{
				if (UnityEngine.Random.Range(0f, 1f) < 0.03f)
				{
					ShootBall();
				}
			}
			else
			{
				CheckSpawnBall();
			}
		}
	}
	public class BallEjector : MonoBehaviour
	{
	}
	public class Camera2DController : MonoBehaviour
	{
		private void Update()
		{
			if (Input.GetButton("Fire2"))
			{
				float axis = Input.GetAxis("Mouse Y");
				float axis2 = Input.GetAxis("Mouse X");
				base.transform.rotation *= Quaternion.AngleAxis(axis2, Vector3.up);
				base.transform.rotation *= Quaternion.AngleAxis(0f - axis, Vector3.right);
				Vector3 eulerAngles = base.transform.eulerAngles;
				eulerAngles.z = 0f;
				base.transform.eulerAngles = eulerAngles;
			}
		}
	}
	public class DetectBasket : MonoBehaviour
	{
		private enum BasketPhase
		{
			NONE,
			TOP,
			BOTH,
			BOTTOM
		}

		private BasketPhase m_phase;

		private Player m_owningPlayer;

		public Player Player
		{
			set
			{
				m_owningPlayer = value;
			}
		}

		private void OnTriggerEnter(Collider other)
		{
			if (other.gameObject.name == "Basket Top" && m_phase == BasketPhase.NONE)
			{
				m_phase = BasketPhase.TOP;
			}
			else if (other.gameObject.name == "Basket Bottom" && m_phase == BasketPhase.TOP)
			{
				m_phase = BasketPhase.BOTH;
			}
			else
			{
				m_phase = BasketPhase.NONE;
			}
		}

		private void OnTriggerExit(Collider other)
		{
			if (other.gameObject.name == "Basket Top" && m_phase == BasketPhase.BOTH)
			{
				m_phase = BasketPhase.BOTTOM;
			}
			else if (other.gameObject.name == "Basket Bottom" && m_phase == BasketPhase.BOTTOM)
			{
				m_phase = BasketPhase.NONE;
				PlatformManager.State currentState = PlatformManager.CurrentState;
				if ((uint)(currentState - 3) <= 1u && (bool)m_owningPlayer)
				{
					m_owningPlayer.Score += 2u;
				}
			}
			else
			{
				m_phase = BasketPhase.NONE;
			}
		}
	}
	public class FlyText : MonoBehaviour
	{
		private const float LIFESPAN = 3f;

		private readonly Vector3 m_movePerFrame = 0.5f * Vector3.up;

		private float m_eol;

		private void Start()
		{
			m_eol = Time.time + 3f;
			GetComponent<Text>().CrossFadeColor(Color.black, 5.1000004f, ignoreTimeScale: false, useAlpha: true);
		}

		private void Update()
		{
			if (Time.time < m_eol)
			{
				base.transform.localPosition += m_movePerFrame;
			}
			else
			{
				UnityEngine.Object.Destroy(base.gameObject);
			}
		}
	}
	public class GoalMover : MonoBehaviour
	{
		[SerializeField]
		private float MAX_OFFSET = 2f;

		[SerializeField]
		private float m_speed = 0.005f;

		private const float MOVE_TOLERANCE = 0.1f;

		private Vector3 m_expectedPosition;

		private Vector3 m_moveDirection;

		private Vector3 m_nextMoveDirection;

		public Vector3 ExpectedPosition
		{
			get
			{
				return m_expectedPosition;
			}
			set
			{
				m_expectedPosition = value;
			}
		}

		public Vector3 MoveDirection
		{
			get
			{
				return m_moveDirection;
			}
			set
			{
				m_moveDirection = value;
			}
		}

		public Vector3 NextMoveDirection
		{
			get
			{
				return m_nextMoveDirection;
			}
			set
			{
				m_nextMoveDirection = value;
			}
		}

		private void Start()
		{
			ExpectedPosition = base.transform.localPosition;
			m_moveDirection.x = UnityEngine.Random.Range(-1f, 1f);
			m_moveDirection.y = UnityEngine.Random.Range(-1f, 1f);
			m_moveDirection = Vector3.ClampMagnitude(m_moveDirection, m_speed);
			m_nextMoveDirection.x = (0f - Mathf.Sign(m_moveDirection.x)) * UnityEngine.Random.Range(0f, 1f);
			m_nextMoveDirection.y = (0f - Mathf.Sign(m_moveDirection.y)) * UnityEngine.Random.Range(0f, 1f);
			m_nextMoveDirection = Vector3.ClampMagnitude(m_nextMoveDirection, m_speed);
		}

		private void FixedUpdate()
		{
			base.transform.localPosition += MoveDirection;
			ExpectedPosition += MoveDirection;
			Vector3 vector = ExpectedPosition - base.transform.localPosition;
			vector = Vector3.ClampMagnitude(vector, 0.1f);
			base.transform.localPosition += vector;
			if (base.transform.localPosition.sqrMagnitude > MAX_OFFSET * MAX_OFFSET)
			{
				base.transform.localPosition = Vector3.ClampMagnitude(base.transform.localPosition, MAX_OFFSET);
				ExpectedPosition = base.transform.localPosition;
				MoveDirection = NextMoveDirection;
				m_nextMoveDirection.x = (0f - Mathf.Sign(m_moveDirection.x)) * UnityEngine.Random.Range(0f, 1f);
				m_nextMoveDirection.y = (0f - Mathf.Sign(m_moveDirection.y)) * UnityEngine.Random.Range(0f, 1f);
				m_nextMoveDirection = Vector3.ClampMagnitude(m_nextMoveDirection, m_speed);
			}
		}
	}
	public class LeaderboardManager
	{
		public delegate void OnMostWinsLeaderboardUpdated(SortedDictionary<int, LeaderboardEntry> entries);

		public delegate void OnHighScoreLeaderboardUpdated(SortedDictionary<int, LeaderboardEntry> entries);

		private const string MOST_MATCHES_WON = "MOST_MATCHES_WON";

		private const string HIGHEST_MATCH_SCORE = "HIGHEST_MATCH_SCORE";

		private const int TOP_N_COUNT = 5;

		private const float LEADERBOARD_POLL_FREQ = 30f;

		private float m_nextCheckTime;

		private volatile SortedDictionary<int, LeaderboardEntry> m_mostWins;

		private bool m_foundLocalUserMostWinsEntry;

		private long m_numWins;

		private OnMostWinsLeaderboardUpdated m_mostWinsCallback;

		private volatile SortedDictionary<int, LeaderboardEntry> m_highScores;

		private bool m_foundLocalUserHighScore;

		private OnHighScoreLeaderboardUpdated m_highScoreCallback;

		public OnMostWinsLeaderboardUpdated MostWinsLeaderboardUpdatedCallback
		{
			set
			{
				m_mostWinsCallback = value;
			}
		}

		public OnHighScoreLeaderboardUpdated HighScoreLeaderboardUpdatedCallback
		{
			set
			{
				m_highScoreCallback = value;
			}
		}

		public void CheckForUpdates()
		{
			if (Time.time >= m_nextCheckTime && PlatformManager.CurrentState == PlatformManager.State.WAITING_TO_PRACTICE_OR_MATCHMAKE)
			{
				m_nextCheckTime = Time.time + 30f;
				QueryMostWinsLeaderboard();
				QueryHighScoreLeaderboard();
			}
		}

		private void QueryMostWinsLeaderboard()
		{
			if (m_mostWins == null)
			{
				m_mostWins = new SortedDictionary<int, LeaderboardEntry>();
				m_foundLocalUserMostWinsEntry = false;
				Leaderboards.GetEntries("MOST_MATCHES_WON", 5, LeaderboardFilterType.None, LeaderboardStartAt.Top).OnComplete(MostWinsGetEntriesCallback);
			}
		}

		private void MostWinsGetEntriesCallback(Message<LeaderboardEntryList> msg)
		{
			if (!msg.IsError)
			{
				foreach (LeaderboardEntry datum in msg.Data)
				{
					m_mostWins[datum.Rank] = datum;
					if (datum.User.ID == PlatformManager.MyID)
					{
						m_foundLocalUserMostWinsEntry = true;
						m_numWins = datum.Score;
					}
				}
				if (msg.Data.HasNextPage)
				{
					Leaderboards.GetNextEntries(msg.Data).OnComplete(MostWinsGetEntriesCallback);
					return;
				}
				if (!m_foundLocalUserMostWinsEntry)
				{
					Leaderboards.GetEntries("MOST_MATCHES_WON", 1, LeaderboardFilterType.None, LeaderboardStartAt.CenteredOnViewer).OnComplete(MostWinsGetEntriesCallback);
					return;
				}
			}
			if (m_mostWinsCallback != null)
			{
				m_mostWinsCallback(m_mostWins);
			}
			m_mostWins = null;
		}

		private void QueryHighScoreLeaderboard()
		{
			if (m_highScores == null)
			{
				m_highScores = new SortedDictionary<int, LeaderboardEntry>();
				m_foundLocalUserHighScore = false;
				Leaderboards.GetEntries("HIGHEST_MATCH_SCORE", 5, LeaderboardFilterType.None, LeaderboardStartAt.Top).OnComplete(HighestScoreGetEntriesCallback);
			}
		}

		private void HighestScoreGetEntriesCallback(Message<LeaderboardEntryList> msg)
		{
			if (!msg.IsError)
			{
				foreach (LeaderboardEntry datum in msg.Data)
				{
					m_highScores[datum.Rank] = datum;
					if (datum.User.ID == PlatformManager.MyID)
					{
						m_foundLocalUserHighScore = true;
					}
				}
				if (msg.Data.HasNextPage)
				{
					Leaderboards.GetNextEntries(msg.Data).OnComplete(HighestScoreGetEntriesCallback);
					return;
				}
				if (!m_foundLocalUserHighScore)
				{
					Leaderboards.GetEntries("HIGHEST_MATCH_SCORE", 1, LeaderboardFilterType.None, LeaderboardStartAt.CenteredOnViewer).OnComplete(HighestScoreGetEntriesCallback);
					return;
				}
			}
			if (m_highScoreCallback != null)
			{
				m_highScoreCallback(m_highScores);
			}
			m_highScores = null;
		}

		public void SubmitMatchScores(bool wonMatch, uint score)
		{
			if (wonMatch)
			{
				m_numWins++;
				Leaderboards.WriteEntry("MOST_MATCHES_WON", m_numWins);
			}
			if (score != 0)
			{
				Leaderboards.WriteEntry("HIGHEST_MATCH_SCORE", score);
			}
		}
	}
	public class LocalPlayer : Player
	{
		public override uint Score
		{
			set
			{
				base.Score = value;
				if (PlatformManager.CurrentState == PlatformManager.State.PLAYING_A_NETWORKED_MATCH)
				{
					PlatformManager.P2P.SendScoreUpdate(base.Score);
				}
			}
		}

		private void Update()
		{
			GameObject gameObject = null;
			if (base.HasBall)
			{
				if (Input.GetButton("Fire1") || Input.GetKey(KeyCode.Space))
				{
					gameObject = ShootBall();
				}
			}
			else
			{
				gameObject = CheckSpawnBall();
			}
			if ((bool)gameObject && PlatformManager.CurrentState == PlatformManager.State.PLAYING_A_NETWORKED_MATCH)
			{
				PlatformManager.P2P.AddNetworkBall(gameObject);
			}
		}
	}
	public class MatchController : MonoBehaviour
	{
		private enum State
		{
			UNKNOWN,
			NONE,
			WAITING_TO_START_PRACTICE,
			PRACTICING,
			VIEWING_RESULTS_PRACTICE,
			WAITING_FOR_MATCH,
			WAITING_TO_SETUP_MATCH,
			PLAYING_MATCH,
			VIEWING_MATCH_RESULTS
		}

		[SerializeField]
		private Text m_timerText;

		[SerializeField]
		private Camera m_camera;

		[SerializeField]
		private Transform m_idleCameraTransform;

		[SerializeField]
		private Text m_matchmakeButtonText;

		[SerializeField]
		private PlayerArea[] m_playerAreas = new PlayerArea[3];

		[SerializeField]
		private uint PRACTICE_WARMUP_TIME = 5u;

		[SerializeField]
		private uint MATCH_WARMUP_TIME = 30u;

		[SerializeField]
		private uint MATCH_TIME = 20u;

		[SerializeField]
		private uint MATCH_COOLDOWN_TIME = 10u;

		[SerializeField]
		private GameObject m_mostWinsLeaderboard;

		[SerializeField]
		private GameObject m_highestScoresLeaderboard;

		[SerializeField]
		private GameObject m_leaderboardEntryPrefab;

		[SerializeField]
		private GameObject m_flytext;

		private State m_currentState;

		private float m_nextStateTransitionTime;

		private int m_localSlot;

		public float MatchStartTime
		{
			get
			{
				State currentState = m_currentState;
				if (currentState == State.WAITING_TO_START_PRACTICE || currentState == State.WAITING_TO_SETUP_MATCH)
				{
					return m_nextStateTransitionTime;
				}
				return 0f;
			}
			private set
			{
				m_nextStateTransitionTime = value;
			}
		}

		private void Start()
		{
			PlatformManager.Matchmaking.EnqueueResultCallback = OnMatchFoundCallback;
			PlatformManager.Matchmaking.MatchPlayerAddedCallback = MatchPlayerAddedCallback;
			PlatformManager.P2P.StartTimeOfferCallback = StartTimeOfferCallback;
			PlatformManager.Leaderboards.MostWinsLeaderboardUpdatedCallback = MostWinsLeaderboardCallback;
			PlatformManager.Leaderboards.HighScoreLeaderboardUpdatedCallback = HighestScoreLeaderboardCallback;
			TransitionToState(State.NONE);
		}

		private void Update()
		{
			UpdateCheckForNextTimedTransition();
			UpdateMatchTimer();
		}

		private void TransitionToState(State newState)
		{
			UnityEngine.Debug.LogFormat("MatchController State {0} -> {1}", m_currentState, newState);
			if (m_currentState != newState)
			{
				_ = m_currentState;
				m_currentState = newState;
				switch (newState)
				{
				case State.NONE:
					SetupForIdle();
					MoveCameraToIdlePosition();
					PlatformManager.TransitionToState(PlatformManager.State.WAITING_TO_PRACTICE_OR_MATCHMAKE);
					m_matchmakeButtonText.text = "Play Online";
					break;
				case State.WAITING_TO_START_PRACTICE:
					SetupForPractice();
					MoveCameraToMatchPosition();
					PlatformManager.TransitionToState(PlatformManager.State.MATCH_TRANSITION);
					m_nextStateTransitionTime = Time.time + (float)PRACTICE_WARMUP_TIME;
					break;
				case State.PRACTICING:
					PlatformManager.TransitionToState(PlatformManager.State.PLAYING_A_LOCAL_MATCH);
					m_nextStateTransitionTime = Time.time + (float)MATCH_TIME;
					break;
				case State.VIEWING_RESULTS_PRACTICE:
					PlatformManager.TransitionToState(PlatformManager.State.MATCH_TRANSITION);
					m_nextStateTransitionTime = Time.time + (float)MATCH_COOLDOWN_TIME;
					m_timerText.text = "0:00.00";
					break;
				case State.WAITING_FOR_MATCH:
					PlatformManager.TransitionToState(PlatformManager.State.MATCH_TRANSITION);
					m_matchmakeButtonText.text = "Cancel";
					break;
				case State.WAITING_TO_SETUP_MATCH:
					m_nextStateTransitionTime = Time.time + (float)MATCH_WARMUP_TIME;
					break;
				case State.PLAYING_MATCH:
					PlatformManager.TransitionToState(PlatformManager.State.PLAYING_A_NETWORKED_MATCH);
					m_nextStateTransitionTime = Time.time + (float)MATCH_TIME;
					break;
				case State.VIEWING_MATCH_RESULTS:
					PlatformManager.TransitionToState(PlatformManager.State.MATCH_TRANSITION);
					m_nextStateTransitionTime = Time.time + (float)MATCH_COOLDOWN_TIME;
					m_timerText.text = "0:00.00";
					CalculateMatchResults();
					break;
				}
			}
		}

		private void UpdateCheckForNextTimedTransition()
		{
			if (m_currentState != State.NONE && Time.time >= m_nextStateTransitionTime)
			{
				switch (m_currentState)
				{
				case State.WAITING_TO_START_PRACTICE:
					TransitionToState(State.PRACTICING);
					break;
				case State.PRACTICING:
					TransitionToState(State.VIEWING_RESULTS_PRACTICE);
					break;
				case State.VIEWING_RESULTS_PRACTICE:
					TransitionToState(State.NONE);
					break;
				case State.WAITING_TO_SETUP_MATCH:
					TransitionToState(State.PLAYING_MATCH);
					break;
				case State.PLAYING_MATCH:
					TransitionToState(State.VIEWING_MATCH_RESULTS);
					break;
				case State.VIEWING_MATCH_RESULTS:
					PlatformManager.Matchmaking.EndMatch();
					TransitionToState(State.NONE);
					break;
				case State.WAITING_FOR_MATCH:
					break;
				}
			}
		}

		private void UpdateMatchTimer()
		{
			if (Time.time <= m_nextStateTransitionTime)
			{
				switch (m_currentState)
				{
				case State.WAITING_TO_START_PRACTICE:
				case State.WAITING_TO_SETUP_MATCH:
					m_timerText.text = $"{Mathf.Ceil(Time.time - MatchStartTime):0}";
					break;
				case State.PRACTICING:
				case State.PLAYING_MATCH:
				{
					float num = m_nextStateTransitionTime - Time.time;
					m_timerText.text = $"{Mathf.Floor(num / 60f):#0}:{Mathf.Floor(num) % 60f:#00}.{Mathf.Floor(num * 100f) % 100f:00}";
					break;
				}
				case State.VIEWING_RESULTS_PRACTICE:
				case State.WAITING_FOR_MATCH:
					break;
				}
			}
		}

		private void SetupForIdle()
		{
			for (int i = 0; i < m_playerAreas.Length; i++)
			{
				m_playerAreas[i].SetupForPlayer<AIPlayer>("* AI *");
			}
		}

		private void SetupForPractice()
		{
			m_localSlot = UnityEngine.Random.Range(0, m_playerAreas.Length - 1);
			for (int i = 0; i < m_playerAreas.Length; i++)
			{
				if (i == m_localSlot)
				{
					m_playerAreas[i].SetupForPlayer<LocalPlayer>(PlatformManager.MyOculusID);
				}
				else
				{
					m_playerAreas[i].SetupForPlayer<AIPlayer>("* AI *");
				}
			}
		}

		private Player MatchPlayerAddedCallback(int slot, User user)
		{
			Player result = null;
			if (m_currentState == State.WAITING_TO_SETUP_MATCH && slot < m_playerAreas.Length)
			{
				if (user.ID == PlatformManager.MyID)
				{
					LocalPlayer localPlayer = m_playerAreas[slot].SetupForPlayer<LocalPlayer>(user.OculusID);
					MoveCameraToMatchPosition();
					result = localPlayer;
					m_localSlot = slot;
				}
				else
				{
					RemotePlayer remotePlayer = m_playerAreas[slot].SetupForPlayer<RemotePlayer>(user.OculusID);
					remotePlayer.User = user;
					result = remotePlayer;
				}
			}
			return result;
		}

		private void MoveCameraToIdlePosition()
		{
			BallEjector componentInChildren = m_camera.gameObject.GetComponentInChildren<BallEjector>();
			if ((bool)componentInChildren)
			{
				componentInChildren.transform.SetParent(m_camera.transform.parent, worldPositionStays: false);
				m_camera.transform.SetParent(m_idleCameraTransform, worldPositionStays: false);
			}
		}

		private void MoveCameraToMatchPosition()
		{
			PlayerArea[] playerAreas = m_playerAreas;
			for (int i = 0; i < playerAreas.Length; i++)
			{
				LocalPlayer componentInChildren = playerAreas[i].GetComponentInChildren<LocalPlayer>();
				if ((bool)componentInChildren)
				{
					BallEjector componentInChildren2 = componentInChildren.GetComponentInChildren<BallEjector>();
					m_camera.transform.SetParent(componentInChildren.transform, worldPositionStays: false);
					componentInChildren2.transform.SetParent(m_camera.transform, worldPositionStays: false);
					break;
				}
			}
			DisplayAchievementFlytext();
		}

		public void StartPracticeMatch()
		{
			if (m_currentState == State.NONE)
			{
				TransitionToState(State.WAITING_TO_START_PRACTICE);
			}
		}

		public void PlayOnlineOrCancel()
		{
			UnityEngine.Debug.Log("Play online or Cancel");
			if (m_currentState == State.NONE)
			{
				PlatformManager.Matchmaking.QueueForMatch();
				TransitionToState(State.WAITING_FOR_MATCH);
			}
			else if (m_currentState == State.WAITING_FOR_MATCH)
			{
				PlatformManager.Matchmaking.LeaveQueue();
				TransitionToState(State.NONE);
			}
		}

		private void OnMatchFoundCallback(bool success)
		{
			if (success)
			{
				TransitionToState(State.WAITING_TO_SETUP_MATCH);
			}
			else
			{
				TransitionToState(State.NONE);
			}
		}

		private float StartTimeOfferCallback(float remoteTime)
		{
			if (m_currentState == State.WAITING_TO_SETUP_MATCH && remoteTime > MatchStartTime && remoteTime - 60f < MatchStartTime)
			{
				UnityEngine.Debug.Log("Moving Start time by " + (remoteTime - MatchStartTime));
				MatchStartTime = remoteTime;
			}
			return MatchStartTime;
		}

		private void MostWinsLeaderboardCallback(SortedDictionary<int, LeaderboardEntry> entries)
		{
			foreach (Transform item in m_mostWinsLeaderboard.transform)
			{
				UnityEngine.Object.Destroy(item.gameObject);
			}
			foreach (LeaderboardEntry value in entries.Values)
			{
				GameObject obj = UnityEngine.Object.Instantiate(m_leaderboardEntryPrefab);
				obj.transform.SetParent(m_mostWinsLeaderboard.transform, worldPositionStays: false);
				obj.GetComponent<Text>().text = $"{value.Rank} - {value.User.OculusID} - {value.Score}";
			}
		}

		private void HighestScoreLeaderboardCallback(SortedDictionary<int, LeaderboardEntry> entries)
		{
			foreach (Transform item in m_highestScoresLeaderboard.transform)
			{
				UnityEngine.Object.Destroy(item.gameObject);
			}
			foreach (LeaderboardEntry value in entries.Values)
			{
				GameObject obj = UnityEngine.Object.Instantiate(m_leaderboardEntryPrefab);
				obj.transform.SetParent(m_highestScoresLeaderboard.transform, worldPositionStays: false);
				obj.GetComponent<Text>().text = $"{value.Rank} - {value.User.OculusID} - {value.Score}";
			}
		}

		private void CalculateMatchResults()
		{
			LocalPlayer localPlayer = null;
			RemotePlayer remotePlayer = null;
			PlayerArea[] playerAreas = m_playerAreas;
			foreach (PlayerArea playerArea in playerAreas)
			{
				if (playerArea.Player is LocalPlayer)
				{
					localPlayer = playerArea.Player as LocalPlayer;
				}
				else if (playerArea.Player is RemotePlayer && (remotePlayer == null || playerArea.Player.Score > remotePlayer.Score))
				{
					remotePlayer = playerArea.Player as RemotePlayer;
				}
			}
			if ((bool)localPlayer && (bool)remotePlayer)
			{
				bool flag = localPlayer.Score > remotePlayer.Score;
				PlatformManager.Leaderboards.SubmitMatchScores(flag, localPlayer.Score);
				if (flag)
				{
					PlatformManager.Achievements.RecordWinForLocalUser();
				}
			}
		}

		private void DisplayAchievementFlytext()
		{
			if (PlatformManager.Achievements.LikesToWin)
			{
				GameObject obj = UnityEngine.Object.Instantiate(m_flytext);
				obj.GetComponent<Text>().text = "Likes to Win!";
				obj.transform.position = Vector3.up * 40f;
				obj.transform.SetParent(m_playerAreas[m_localSlot].NameText.transform, worldPositionStays: false);
			}
		}
	}
	public class MatchmakingManager
	{
		public delegate void OnEnqueueResult(bool successful);

		public delegate Player OnMatchPlayerAdded(int slot, User user);

		private const string NORMAL_POOL = "NORMAL_QUICKMATCH";

		private ulong m_matchRoom;

		private readonly Dictionary<ulong, User> m_remotePlayers;

		private OnEnqueueResult m_enqueueCallback;

		private OnMatchPlayerAdded m_playerCallback;

		public OnEnqueueResult EnqueueResultCallback
		{
			private get
			{
				return m_enqueueCallback;
			}
			set
			{
				m_enqueueCallback = value;
			}
		}

		public OnMatchPlayerAdded MatchPlayerAddedCallback
		{
			private get
			{
				return m_playerCallback;
			}
			set
			{
				m_playerCallback = value;
			}
		}

		public MatchmakingManager()
		{
			m_remotePlayers = new Dictionary<ulong, User>();
			Matchmaking.SetMatchFoundNotificationCallback(MatchFoundCallback);
			Rooms.SetUpdateNotificationCallback(MatchmakingRoomUpdateCallback);
		}

		public void QueueForMatch()
		{
			Matchmaking.Enqueue("NORMAL_QUICKMATCH").OnComplete(MatchmakingEnqueueCallback);
		}

		private void MatchmakingEnqueueCallback(Message msg)
		{
			if (msg.IsError)
			{
				UnityEngine.Debug.Log(msg.GetError().Message);
				EnqueueResultCallback(successful: false);
			}
		}

		private void MatchFoundCallback(Message<Oculus.Platform.Models.Room> msg)
		{
			m_matchRoom = msg.Data.ID;
			Matchmaking.JoinRoom(msg.Data.ID, subscribeToUpdates: true).OnComplete(MatchmakingJoinRoomCallback);
		}

		private void MatchmakingJoinRoomCallback(Message<Oculus.Platform.Models.Room> msg)
		{
			if (msg.IsError)
			{
				UnityEngine.Debug.Log(msg.GetError().Message);
				EnqueueResultCallback(successful: false);
				return;
			}
			UnityEngine.Debug.Log("Match found and room joined " + m_matchRoom);
			EnqueueResultCallback(successful: true);
			int num = 0;
			if (msg.Data.UsersOptional == null)
			{
				return;
			}
			foreach (User item in msg.Data.UsersOptional)
			{
				Player player = MatchPlayerAddedCallback(num++, item);
				if (PlatformManager.MyID != item.ID)
				{
					m_remotePlayers[item.ID] = item;
					PlatformManager.P2P.AddRemotePlayer(player as RemotePlayer);
				}
			}
		}

		private void MatchmakingRoomUpdateCallback(Message<Oculus.Platform.Models.Room> msg)
		{
			if (msg.IsError)
			{
				PlatformManager.TerminateWithError(msg);
			}
			else
			{
				if (msg.Data.ID != m_matchRoom || msg.Data.UsersOptional == null)
				{
					return;
				}
				foreach (User item in msg.Data.UsersOptional)
				{
					if (PlatformManager.MyID != item.ID && !m_remotePlayers.ContainsKey(item.ID))
					{
						m_remotePlayers[item.ID] = item;
						Player player = MatchPlayerAddedCallback(m_remotePlayers.Count, item);
						PlatformManager.P2P.AddRemotePlayer(player as RemotePlayer);
					}
				}
			}
		}

		public void EndMatch()
		{
			if (m_matchRoom != 0L)
			{
				Rooms.Leave(m_matchRoom);
				m_remotePlayers.Clear();
				PlatformManager.P2P.DisconnectAll();
				m_matchRoom = 0uL;
			}
		}

		public void LeaveQueue()
		{
			Matchmaking.Cancel();
			EndMatch();
		}
	}
	public class P2PManager
	{
		private class RemotePlayerData
		{
			public PeerConnectionState state;

			public RemotePlayer player;

			public float remoteTimeOffset;

			public float lastReceivedBallsTime;

			public readonly Dictionary<int, P2PNetworkBall> activeBalls = new Dictionary<int, P2PNetworkBall>();
		}

		public delegate float StartTimeOffer(float remoteTime);

		private readonly Dictionary<ulong, RemotePlayerData> m_remotePlayers = new Dictionary<ulong, RemotePlayerData>();

		private float m_timeForNextBallUpdate;

		private const byte TIME_SYNC_MESSAGE = 1;

		private const uint TIME_SYNC_MESSAGE_SIZE = 5u;

		private const int TIME_SYNC_MESSAGE_COUNT = 7;

		private const byte START_TIME_MESSAGE = 2;

		private const uint START_TIME_MESSAGE_SIZE = 5u;

		private const byte BACKBOARD_UPDATE_MESSAGE = 3;

		private const uint BACKBOARD_UPDATE_MESSAGE_SIZE = 41u;

		private const byte LOCAL_BALLS_UPDATE_MESSAGE = 4;

		private const uint LOCAL_BALLS_UPDATE_MESSATE_SIZE_MAX = 353u;

		private const float LOCAL_BALLS_UPDATE_DELAY = 0.1f;

		private const byte SCORE_UPDATE_MESSAGE = 5;

		private const uint SCORE_UPDATE_MESSAGE_SIZE = 5u;

		private readonly Dictionary<int, P2PNetworkBall> m_localBalls = new Dictionary<int, P2PNetworkBall>();

		private readonly byte[] readBuffer = new byte[353];

		private readonly Dictionary<ulong, List<float>> m_remoteSyncTimeCache = new Dictionary<ulong, List<float>>();

		private readonly Dictionary<ulong, float> m_remoteSentTimeCache = new Dictionary<ulong, float>();

		private StartTimeOffer m_startTimeOfferCallback;

		public StartTimeOffer StartTimeOfferCallback
		{
			private get
			{
				return m_startTimeOfferCallback;
			}
			set
			{
				m_startTimeOfferCallback = value;
			}
		}

		public P2PManager()
		{
			Net.SetPeerConnectRequestCallback(PeerConnectRequestCallback);
			Net.SetConnectionStateChangedCallback(ConnectionStateChangedCallback);
		}

		public void UpdateNetwork()
		{
			if (m_remotePlayers.Count == 0)
			{
				return;
			}
			Packet packet;
			while ((packet = Net.ReadPacket()) != null)
			{
				if (m_remotePlayers.ContainsKey(packet.SenderID))
				{
					packet.ReadBytes(readBuffer);
					switch (readBuffer[0])
					{
					case 1:
						ReadTimeSyncMessage(packet.SenderID, readBuffer);
						break;
					case 2:
						ReceiveMatchStartTimeOffer(packet.SenderID, readBuffer);
						break;
					case 3:
						ReceiveBackboardUpdate(packet.SenderID, readBuffer);
						break;
					case 4:
						ReceiveBallTransforms(packet.SenderID, readBuffer, packet.Size);
						break;
					case 5:
						ReceiveScoredUpdate(packet.SenderID, readBuffer);
						break;
					}
				}
			}
			if (Time.time >= m_timeForNextBallUpdate && m_localBalls.Count > 0)
			{
				SendLocalBallTransforms();
			}
		}

		public void AddRemotePlayer(RemotePlayer player)
		{
			if (!m_remotePlayers.ContainsKey(player.ID))
			{
				m_remotePlayers[player.ID] = new RemotePlayerData();
				m_remotePlayers[player.ID].state = PeerConnectionState.Unknown;
				m_remotePlayers[player.ID].player = player;
				if (PlatformManager.MyID < player.ID)
				{
					UnityEngine.Debug.Log("P2P Try Connect to: " + player.ID);
					Net.Connect(player.ID);
				}
			}
		}

		public void DisconnectAll()
		{
			foreach (ulong key in m_remotePlayers.Keys)
			{
				Net.Close(key);
			}
			m_remotePlayers.Clear();
		}

		private void PeerConnectRequestCallback(Message<NetworkingPeer> msg)
		{
			if (m_remotePlayers.ContainsKey(msg.Data.ID))
			{
				UnityEngine.Debug.LogFormat("P2P Accepting Connection request from {0}", msg.Data.ID);
				Net.Accept(msg.Data.ID);
			}
			else
			{
				UnityEngine.Debug.LogFormat("P2P Ignoring unauthorized Connection request from {0}", msg.Data.ID);
			}
		}

		private void ConnectionStateChangedCallback(Message<NetworkingPeer> msg)
		{
			UnityEngine.Debug.LogFormat("P2P {0} Connection state changed to {1}", msg.Data.ID, msg.Data.State);
			if (!m_remotePlayers.ContainsKey(msg.Data.ID))
			{
				return;
			}
			m_remotePlayers[msg.Data.ID].state = msg.Data.State;
			switch (msg.Data.State)
			{
			case PeerConnectionState.Connected:
				if (PlatformManager.MyID < msg.Data.ID)
				{
					SendTimeSyncMessage(msg.Data.ID);
				}
				break;
			case PeerConnectionState.Timeout:
				if (PlatformManager.MyID < msg.Data.ID)
				{
					Net.Connect(msg.Data.ID);
				}
				break;
			case PeerConnectionState.Closed:
				m_remotePlayers.Remove(msg.Data.ID);
				break;
			}
		}

		private void SendTimeSyncMessage(ulong remoteID)
		{
			if (!m_remoteSyncTimeCache.ContainsKey(remoteID))
			{
				m_remoteSyncTimeCache[remoteID] = new List<float>();
			}
			float realtimeSinceStartup = Time.realtimeSinceStartup;
			m_remoteSentTimeCache[remoteID] = realtimeSinceStartup;
			byte[] array = new byte[5] { 1, 0, 0, 0, 0 };
			int offset = 1;
			PackFloat(realtimeSinceStartup, array, ref offset);
			Net.SendPacket(remoteID, array, SendPolicy.Reliable);
		}

		private void ReadTimeSyncMessage(ulong remoteID, byte[] msg)
		{
			if (!m_remoteSentTimeCache.ContainsKey(remoteID))
			{
				SendTimeSyncMessage(remoteID);
				return;
			}
			int offset = 1;
			float num = UnpackFloat(msg, ref offset);
			float realtimeSinceStartup = Time.realtimeSinceStartup;
			float num2 = (realtimeSinceStartup - m_remoteSentTimeCache[remoteID]) / 2f;
			float item = realtimeSinceStartup - (num + num2);
			m_remoteSyncTimeCache[remoteID].Add(item);
			if (m_remoteSyncTimeCache[remoteID].Count < 7)
			{
				SendTimeSyncMessage(remoteID);
				return;
			}
			if (PlatformManager.MyID < remoteID)
			{
				SendTimeSyncMessage(remoteID);
			}
			m_remoteSyncTimeCache[remoteID].Sort();
			float num3 = m_remoteSyncTimeCache[remoteID][3];
			double num4 = 0.0;
			foreach (float item2 in m_remoteSyncTimeCache[remoteID])
			{
				num4 += (double)item2;
			}
			num4 /= 7.0;
			double num5 = 0.0;
			foreach (float item3 in m_remoteSyncTimeCache[remoteID])
			{
				num5 += (num4 - (double)item3) * (num4 - (double)item3);
			}
			num5 = Math.Sqrt(num5) / 7.0;
			num4 = 0.0;
			int num6 = 0;
			foreach (float item4 in m_remoteSyncTimeCache[remoteID])
			{
				if ((double)Math.Abs(item4 - num3) < num5)
				{
					num4 += (double)item4;
					num6++;
				}
			}
			num4 /= (double)num6;
			UnityEngine.Debug.LogFormat("Time offset to {0} is {1}", remoteID, num4);
			m_remoteSyncTimeCache.Remove(remoteID);
			m_remoteSentTimeCache.Remove(remoteID);
			m_remotePlayers[remoteID].remoteTimeOffset = (float)num4;
			OfferMatchStartTime();
		}

		private float ShiftRemoteTime(ulong remoteID, float remoteTime)
		{
			if (m_remotePlayers.ContainsKey(remoteID))
			{
				return remoteTime + m_remotePlayers[remoteID].remoteTimeOffset;
			}
			return remoteTime;
		}

		private void OfferMatchStartTime()
		{
			byte[] array = new byte[5] { 2, 0, 0, 0, 0 };
			int offset = 1;
			PackFloat(StartTimeOfferCallback(0f), array, ref offset);
			foreach (ulong key in m_remotePlayers.Keys)
			{
				if (m_remotePlayers[key].state == PeerConnectionState.Connected)
				{
					Net.SendPacket(key, array, SendPolicy.Reliable);
				}
			}
		}

		private void ReceiveMatchStartTimeOffer(ulong remoteID, byte[] msg)
		{
			int offset = 1;
			float remoteTime = UnpackTime(remoteID, msg, ref offset);
			StartTimeOfferCallback(remoteTime);
		}

		public void SendBackboardUpdate(float time, Vector3 pos, Vector3 moveDir, Vector3 nextMoveDir)
		{
			byte[] array = new byte[41];
			array[0] = 3;
			int offset = 1;
			PackFloat(time, array, ref offset);
			PackVector3(pos, array, ref offset);
			PackVector3(moveDir, array, ref offset);
			PackVector3(nextMoveDir, array, ref offset);
			foreach (KeyValuePair<ulong, RemotePlayerData> remotePlayer in m_remotePlayers)
			{
				if (remotePlayer.Value.state == PeerConnectionState.Connected)
				{
					Net.SendPacket(remotePlayer.Key, array, SendPolicy.Reliable);
				}
			}
		}

		private void ReceiveBackboardUpdate(ulong remoteID, byte[] msg)
		{
			int offset = 1;
			float remoteTime = UnpackTime(remoteID, msg, ref offset);
			Vector3 pos = UnpackVector3(msg, ref offset);
			Vector3 moveDir = UnpackVector3(msg, ref offset);
			Vector3 nextMoveDir = UnpackVector3(msg, ref offset);
			m_remotePlayers[remoteID].player.Goal.RemoteBackboardUpdate(remoteTime, pos, moveDir, nextMoveDir);
		}

		public void AddNetworkBall(GameObject ball)
		{
			m_localBalls[ball.GetInstanceID()] = ball.AddComponent<P2PNetworkBall>();
		}

		public void RemoveNetworkBall(GameObject ball)
		{
			m_localBalls.Remove(ball.GetInstanceID());
		}

		private void SendLocalBallTransforms()
		{
			m_timeForNextBallUpdate = Time.time + 0.1f;
			byte[] array = new byte[5 + m_localBalls.Count * 29];
			array[0] = 4;
			int offset = 1;
			PackFloat(Time.realtimeSinceStartup, array, ref offset);
			foreach (P2PNetworkBall value in m_localBalls.Values)
			{
				PackBool(value.IsHeld(), array, ref offset);
				PackInt32(value.gameObject.GetInstanceID(), array, ref offset);
				PackVector3(value.transform.localPosition, array, ref offset);
				PackVector3(value.velocity, array, ref offset);
			}
			foreach (KeyValuePair<ulong, RemotePlayerData> remotePlayer in m_remotePlayers)
			{
				if (remotePlayer.Value.state == PeerConnectionState.Connected)
				{
					Net.SendPacket(remotePlayer.Key, array, SendPolicy.Unreliable);
				}
			}
		}

		private void ReceiveBallTransforms(ulong remoteID, byte[] msg, ulong msgLength)
		{
			int offset = 1;
			float num = UnpackTime(remoteID, msg, ref offset);
			if (num < m_remotePlayers[remoteID].lastReceivedBallsTime)
			{
				return;
			}
			m_remotePlayers[remoteID].lastReceivedBallsTime = num;
			while (offset != (int)msgLength)
			{
				bool isHeld = UnpackBool(msg, ref offset);
				int key = UnpackInt32(msg, ref offset);
				Vector3 pos = UnpackVector3(msg, ref offset);
				Vector3 vel = UnpackVector3(msg, ref offset);
				if (!m_remotePlayers[remoteID].activeBalls.ContainsKey(key))
				{
					P2PNetworkBall p2PNetworkBall = m_remotePlayers[remoteID].player.CreateBall().AddComponent<P2PNetworkBall>();
					p2PNetworkBall.transform.SetParent(m_remotePlayers[remoteID].player.transform.parent);
					m_remotePlayers[remoteID].activeBalls[key] = p2PNetworkBall;
				}
				P2PNetworkBall p2PNetworkBall2 = m_remotePlayers[remoteID].activeBalls[key];
				if ((bool)p2PNetworkBall2)
				{
					p2PNetworkBall2.ProcessRemoteUpdate(num, isHeld, pos, vel);
				}
			}
		}

		public void SendScoreUpdate(uint score)
		{
			byte[] array = new byte[5] { 5, 0, 0, 0, 0 };
			int offset = 1;
			PackUint32(score, array, ref offset);
			foreach (KeyValuePair<ulong, RemotePlayerData> remotePlayer in m_remotePlayers)
			{
				if (remotePlayer.Value.state == PeerConnectionState.Connected)
				{
					Net.SendPacket(remotePlayer.Key, array, SendPolicy.Reliable);
				}
			}
		}

		private void ReceiveScoredUpdate(ulong remoteID, byte[] msg)
		{
			int offset = 1;
			uint score = UnpackUint32(msg, ref offset);
			m_remotePlayers[remoteID].player.ReceiveRemoteScore(score);
		}

		private void PackVector3(Vector3 vec, byte[] buf, ref int offset)
		{
			PackFloat(vec.x, buf, ref offset);
			PackFloat(vec.y, buf, ref offset);
			PackFloat(vec.z, buf, ref offset);
		}

		private Vector3 UnpackVector3(byte[] buf, ref int offset)
		{
			Vector3 result = default(Vector3);
			result.x = UnpackFloat(buf, ref offset);
			result.y = UnpackFloat(buf, ref offset);
			result.z = UnpackFloat(buf, ref offset);
			return result;
		}

		private void PackQuaternion(Quaternion quat, byte[] buf, ref int offset)
		{
			PackFloat(quat.x, buf, ref offset);
			PackFloat(quat.y, buf, ref offset);
			PackFloat(quat.z, buf, ref offset);
			PackFloat(quat.w, buf, ref offset);
		}

		private void PackFloat(float value, byte[] buf, ref int offset)
		{
			Buffer.BlockCopy(BitConverter.GetBytes(value), 0, buf, offset, 4);
			offset += 4;
		}

		private float UnpackFloat(byte[] buf, ref int offset)
		{
			float result = BitConverter.ToSingle(buf, offset);
			offset += 4;
			return result;
		}

		private float UnpackTime(ulong remoteID, byte[] buf, ref int offset)
		{
			return ShiftRemoteTime(remoteID, UnpackFloat(buf, ref offset));
		}

		private void PackInt32(int value, byte[] buf, ref int offset)
		{
			Buffer.BlockCopy(BitConverter.GetBytes(value), 0, buf, offset, 4);
			offset += 4;
		}

		private int UnpackInt32(byte[] buf, ref int offset)
		{
			int result = BitConverter.ToInt32(buf, offset);
			offset += 4;
			return result;
		}

		private void PackUint32(uint value, byte[] buf, ref int offset)
		{
			Buffer.BlockCopy(BitConverter.GetBytes(value), 0, buf, offset, 4);
			offset += 4;
		}

		private uint UnpackUint32(byte[] buf, ref int offset)
		{
			uint result = BitConverter.ToUInt32(buf, offset);
			offset += 4;
			return result;
		}

		private void PackBool(bool value, byte[] buf, ref int offset)
		{
			buf[offset++] = (byte)(value ? 1u : 0u);
		}

		private bool UnpackBool(byte[] buf, ref int offset)
		{
			return buf[offset++] != 0;
		}
	}
	public class P2PNetworkBall : MonoBehaviour
	{
		private float lastCollisionTime;

		private Rigidbody rigidBody;

		public Vector3 velocity => rigidBody.velocity;

		private void Awake()
		{
			rigidBody = base.gameObject.GetComponent<Rigidbody>();
		}

		public bool IsHeld()
		{
			return !rigidBody.useGravity;
		}

		public void ProcessRemoteUpdate(float remoteTime, bool isHeld, Vector3 pos, Vector3 vel)
		{
			if (isHeld)
			{
				base.transform.localPosition = pos;
			}
			else if (lastCollisionTime < remoteTime)
			{
				float time = Time.realtimeSinceStartup - remoteTime;
				base.transform.localPosition = estimatePosition(pos, vel, time);
				rigidBody.velocity = estimateVelocity(vel, time);
				if (IsHeld())
				{
					rigidBody.useGravity = true;
					rigidBody.detectCollisions = true;
				}
			}
		}

		private Vector3 estimatePosition(Vector3 startPosition, Vector3 startVelocty, float time)
		{
			return startPosition + startVelocty * time + 0.5f * Physics.gravity * time * time;
		}

		private Vector3 estimateVelocity(Vector3 startVelocity, float time)
		{
			return startVelocity + Physics.gravity * time * Mathf.Clamp01(1f - rigidBody.drag * time);
		}

		private void OnCollisionEnter(Collision collision)
		{
			lastCollisionTime = Time.realtimeSinceStartup;
		}

		private void OnDestroy()
		{
			PlatformManager.P2P.RemoveNetworkBall(base.gameObject);
		}
	}
	public class P2PNetworkGoal : MonoBehaviour
	{
		private GoalMover m_goal;

		private Vector3 m_lastSentMoveDirection;

		private bool m_sendUpdates;

		public bool SendUpdates
		{
			set
			{
				m_sendUpdates = value;
			}
		}

		private void Awake()
		{
			m_goal = base.gameObject.GetComponent<GoalMover>();
		}

		private void FixedUpdate()
		{
			if (m_sendUpdates && m_goal.MoveDirection != m_lastSentMoveDirection)
			{
				SendBackboardUpdate();
			}
		}

		public void SendBackboardUpdate()
		{
			m_lastSentMoveDirection = m_goal.MoveDirection;
			float realtimeSinceStartup = Time.realtimeSinceStartup;
			PlatformManager.P2P.SendBackboardUpdate(realtimeSinceStartup, base.transform.localPosition, m_goal.MoveDirection, m_goal.NextMoveDirection);
		}

		public void RemoteBackboardUpdate(float remoteTime, Vector3 pos, Vector3 moveDir, Vector3 nextMoveDir)
		{
			float f = (Time.realtimeSinceStartup - remoteTime) / Time.fixedDeltaTime;
			m_goal.ExpectedPosition = pos + Mathf.Round(f) * moveDir;
			m_goal.MoveDirection = moveDir;
			m_goal.NextMoveDirection = nextMoveDir;
		}
	}
	public class PlatformManager : MonoBehaviour
	{
		public enum State
		{
			INITIALIZING,
			WAITING_TO_PRACTICE_OR_MATCHMAKE,
			MATCH_TRANSITION,
			PLAYING_A_LOCAL_MATCH,
			PLAYING_A_NETWORKED_MATCH
		}

		private static PlatformManager s_instance;

		private MatchmakingManager m_matchmaking;

		private P2PManager m_p2p;

		private LeaderboardManager m_leaderboards;

		private AchievementsManager m_achievements;

		private State m_currentState;

		private ulong m_myID;

		private string m_myOculusID;

		public static MatchmakingManager Matchmaking => s_instance.m_matchmaking;

		public static P2PManager P2P => s_instance.m_p2p;

		public static LeaderboardManager Leaderboards => s_instance.m_leaderboards;

		public static AchievementsManager Achievements => s_instance.m_achievements;

		public static State CurrentState => s_instance.m_currentState;

		public static ulong MyID
		{
			get
			{
				if (s_instance != null)
				{
					return s_instance.m_myID;
				}
				return 0uL;
			}
		}

		public static string MyOculusID
		{
			get
			{
				if (s_instance != null && s_instance.m_myOculusID != null)
				{
					return s_instance.m_myOculusID;
				}
				return string.Empty;
			}
		}

		private void Update()
		{
			m_p2p.UpdateNetwork();
			m_leaderboards.CheckForUpdates();
		}

		private void Awake()
		{
			if (s_instance != null)
			{
				UnityEngine.Object.Destroy(base.gameObject);
				return;
			}
			s_instance = this;
			UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
			Core.Initialize();
			m_matchmaking = new MatchmakingManager();
			m_p2p = new P2PManager();
			m_leaderboards = new LeaderboardManager();
			m_achievements = new AchievementsManager();
		}

		private void Start()
		{
			Entitlements.IsUserEntitledToApplication().OnComplete(IsEntitledCallback);
		}

		private void IsEntitledCallback(Message msg)
		{
			if (msg.IsError)
			{
				TerminateWithError(msg);
			}
			else
			{
				Users.GetLoggedInUser().OnComplete(GetLoggedInUserCallback);
			}
		}

		private void GetLoggedInUserCallback(Message<User> msg)
		{
			if (msg.IsError)
			{
				TerminateWithError(msg);
				return;
			}
			m_myID = msg.Data.ID;
			m_myOculusID = msg.Data.OculusID;
			TransitionToState(State.WAITING_TO_PRACTICE_OR_MATCHMAKE);
			Achievements.CheckForAchievmentUpdates();
		}

		public static void TerminateWithError(Message msg)
		{
			UnityEngine.Debug.Log("Error: " + msg.GetError().Message);
			UnityEngine.Application.Quit();
		}

		public void QuitButtonPressed()
		{
			UnityEngine.Application.Quit();
		}

		private void OnApplicationQuit()
		{
			Matchmaking.LeaveQueue();
		}

		public static void TransitionToState(State newState)
		{
			if ((bool)s_instance && s_instance.m_currentState != newState)
			{
				s_instance.m_currentState = newState;
			}
		}
	}
	public abstract class Player : MonoBehaviour
	{
		public const uint MAX_BALLS = 6u;

		private const float INITIAL_FORCE = 870f;

		private const float RESPAWN_SECONDS = 2f;

		private uint m_score;

		private Text m_scoreUI;

		private GameObject m_ballPrefab;

		private BallEjector m_ballEjector;

		private Queue<GameObject> m_balls = new Queue<GameObject>();

		private GameObject m_heldBall;

		private float m_nextSpawnTime;

		public virtual uint Score
		{
			get
			{
				return m_score;
			}
			set
			{
				m_score = value;
				if ((bool)m_scoreUI)
				{
					m_scoreUI.text = m_score.ToString();
				}
			}
		}

		public GameObject BallPrefab
		{
			set
			{
				m_ballPrefab = value;
			}
		}

		protected bool HasBall => m_heldBall != null;

		private void Start()
		{
			m_ballEjector = base.transform.GetComponentInChildren<BallEjector>();
			m_scoreUI = base.transform.parent.GetComponentInChildren<Text>();
			m_scoreUI.text = "0";
		}

		public GameObject CreateBall()
		{
			if ((long)m_balls.Count >= 6L)
			{
				UnityEngine.Object.Destroy(m_balls.Dequeue());
			}
			GameObject gameObject = UnityEngine.Object.Instantiate(m_ballPrefab);
			m_balls.Enqueue(gameObject);
			gameObject.transform.position = m_ballEjector.transform.position;
			gameObject.transform.SetParent(m_ballEjector.transform, worldPositionStays: true);
			gameObject.GetComponent<Rigidbody>().useGravity = false;
			gameObject.GetComponent<Rigidbody>().detectCollisions = false;
			gameObject.GetComponent<DetectBasket>().Player = this;
			return gameObject;
		}

		protected GameObject CheckSpawnBall()
		{
			PlatformManager.State currentState = PlatformManager.CurrentState;
			if ((currentState == PlatformManager.State.WAITING_TO_PRACTICE_OR_MATCHMAKE || (uint)(currentState - 3) <= 1u) && Time.time >= m_nextSpawnTime && !HasBall)
			{
				m_heldBall = CreateBall();
				return m_heldBall;
			}
			return null;
		}

		protected GameObject ShootBall()
		{
			GameObject heldBall = m_heldBall;
			m_heldBall = null;
			heldBall.GetComponent<Rigidbody>().useGravity = true;
			heldBall.GetComponent<Rigidbody>().detectCollisions = true;
			heldBall.GetComponent<Rigidbody>().AddForce(m_ballEjector.transform.forward * 870f, ForceMode.Acceleration);
			heldBall.transform.SetParent(base.transform.parent, worldPositionStays: true);
			m_nextSpawnTime = Time.time + 2f;
			return heldBall;
		}

		private void OnDestroy()
		{
			foreach (GameObject ball in m_balls)
			{
				UnityEngine.Object.Destroy(ball);
			}
		}
	}
	public class PlayerArea : MonoBehaviour
	{
		[SerializeField]
		private GameObject m_ballPrefab;

		private GameObject m_playerHead;

		private Text m_nameText;

		private P2PNetworkGoal m_p2pGoal;

		public Player Player => m_playerHead.GetComponent<Player>();

		public Text NameText => m_nameText;

		private void Awake()
		{
			m_playerHead = base.gameObject.transform.Find("Player Head").gameObject;
			m_nameText = base.gameObject.GetComponentsInChildren<Text>()[1];
			m_p2pGoal = base.gameObject.GetComponentInChildren<P2PNetworkGoal>();
		}

		public T SetupForPlayer<T>(string name) where T : Player
		{
			Player component = m_playerHead.GetComponent<Player>();
			if ((bool)component)
			{
				UnityEngine.Object.Destroy(component);
			}
			T val = m_playerHead.AddComponent<T>();
			val.BallPrefab = m_ballPrefab;
			m_nameText.text = name;
			if (val is RemotePlayer)
			{
				(val as RemotePlayer).Goal = m_p2pGoal;
				m_p2pGoal.SendUpdates = false;
			}
			else if (val is LocalPlayer)
			{
				m_p2pGoal.SendUpdates = true;
			}
			else
			{
				m_p2pGoal.SendUpdates = false;
			}
			return val;
		}
	}
	public class RemotePlayer : Player
	{
		private User m_user;

		private P2PNetworkGoal m_goal;

		public User User
		{
			set
			{
				m_user = value;
			}
		}

		public ulong ID => m_user.ID;

		public P2PNetworkGoal Goal
		{
			get
			{
				return m_goal;
			}
			set
			{
				m_goal = value;
			}
		}

		public override uint Score
		{
			set
			{
			}
		}

		public void ReceiveRemoteScore(uint score)
		{
			base.Score = score;
		}
	}
	public class VREyeRaycaster : MonoBehaviour
	{
		[SerializeField]
		private EventSystem m_eventSystem;

		private Button m_currentButton;

		private void Update()
		{
			Button button = null;
			if (Physics.Raycast(base.transform.position, base.transform.forward, out var hitInfo, 50f))
			{
				button = hitInfo.collider.GetComponent<Button>();
			}
			if (button != null)
			{
				if (m_currentButton != button)
				{
					m_currentButton = button;
					m_currentButton.Select();
				}
			}
			else if (m_currentButton != null)
			{
				m_currentButton = null;
				if (m_eventSystem != null)
				{
					m_eventSystem.SetSelectedGameObject(null);
				}
			}
		}
	}
}
namespace Oculus.Platform.Samples.VrBoardGame
{
	public class BoardPosition : MonoBehaviour
	{
		[SerializeField]
		[Range(0f, 2f)]
		public int x;

		[SerializeField]
		[Range(0f, 2f)]
		public int y;
	}
	public class EyeCamera : MonoBehaviour
	{
		[SerializeField]
		private EventSystem m_eventSystem;

		[SerializeField]
		private GameController m_gameController;

		[SerializeField]
		private SphereCollider m_gazeTracker;

		private Button m_currentButton;

		private GamePiece m_currentPiece;

		private BoardPosition m_boardPosition;

		private void Update()
		{
			Button button = null;
			GamePiece gamePiece = null;
			BoardPosition boardPosition = null;
			if (Physics.Raycast(base.transform.position, base.transform.forward, out var hitInfo, 50f))
			{
				button = hitInfo.collider.GetComponent<Button>();
				gamePiece = hitInfo.collider.GetComponent<GamePiece>();
				boardPosition = hitInfo.collider.GetComponent<BoardPosition>();
			}
			if (m_currentButton != button)
			{
				if (m_eventSystem != null)
				{
					m_eventSystem.SetSelectedGameObject(null);
				}
				m_currentButton = button;
				if (m_currentButton != null)
				{
					m_currentButton.Select();
				}
			}
			if (m_currentPiece != gamePiece)
			{
				if (m_currentPiece != null)
				{
					m_gameController.StoppedLookingAtPiece();
				}
				m_currentPiece = gamePiece;
				if (m_currentPiece != null)
				{
					m_gameController.StartedLookingAtPiece(m_currentPiece);
				}
			}
			if (m_boardPosition != boardPosition)
			{
				m_boardPosition = boardPosition;
				if (m_boardPosition != null)
				{
					m_gameController.StartedLookingAtPosition(m_boardPosition);
				}
			}
			if (hitInfo.collider == m_gazeTracker)
			{
				m_gameController.ClearProposedMove();
			}
			if (Input.GetButton("Fire2"))
			{
				float axis = Input.GetAxis("Mouse Y");
				float axis2 = Input.GetAxis("Mouse X");
				base.transform.rotation *= Quaternion.AngleAxis(axis2, Vector3.up);
				base.transform.rotation *= Quaternion.AngleAxis(0f - axis, Vector3.right);
				Vector3 eulerAngles = base.transform.eulerAngles;
				eulerAngles.z = 0f;
				base.transform.eulerAngles = eulerAngles;
			}
		}
	}
	public class GameBoard : MonoBehaviour
	{
		private struct PositionInfo
		{
			public GameObject piece;

			public int pieceOwner;

			public int powerPieceOwner;
		}

		public const int LENGTH_X = 3;

		public const int LENGTH_Y = 3;

		public const int MAX_PLAYERS = 2;

		[SerializeField]
		private Color[] m_playerColors = new Color[2];

		[SerializeField]
		private Color m_proposedMoveColor = Color.white;

		private int[] m_scores = new int[2];

		[SerializeField]
		private BoardPosition[] m_positions = new BoardPosition[9];

		private readonly PositionInfo[,] m_pieces = new PositionInfo[3, 3];

		public void Reset()
		{
			for (int i = 0; i < 3; i++)
			{
				for (int j = 0; j < 3; j++)
				{
					if (m_pieces[i, j].piece != null)
					{
						UnityEngine.Object.Destroy(m_pieces[i, j].piece);
						m_pieces[i, j].piece = null;
						m_pieces[i, j].pieceOwner = -1;
						m_pieces[i, j].powerPieceOwner = -1;
					}
				}
			}
		}

		public bool IsFull()
		{
			for (int i = 0; i < 3; i++)
			{
				for (int j = 0; j < 3; j++)
				{
					if (m_pieces[i, j].piece == null)
					{
						return false;
					}
				}
			}
			return true;
		}

		public bool CanPlayerMoveToPostion(int x, int y)
		{
			return m_pieces[x, y].piece == null;
		}

		public bool CanPlayerPowerUpPosition(int x, int y)
		{
			return m_pieces[x, y].piece != null;
		}

		public void AddPiece(int player, GameObject prefab, int x, int y)
		{
			BoardPosition boardPosition = m_positions[x * 3 + y];
			GamePiece gamePiece = Create(prefab, boardPosition.gameObject, boardPosition, Vector3.zero);
			gamePiece.GetComponent<Renderer>().material.color = m_playerColors[player];
			m_pieces[x, y].piece = gamePiece.gameObject;
			m_pieces[x, y].pieceOwner = player;
			m_pieces[x, y].powerPieceOwner = -1;
			UpdateScores();
		}

		public GamePiece AddProposedPiece(GameObject prefab, BoardPosition pos)
		{
			GamePiece gamePiece = Create(prefab, pos.gameObject, pos, Vector3.zero);
			gamePiece.GetComponent<Renderer>().material.color = m_proposedMoveColor;
			return gamePiece;
		}

		public void AddPowerPiece(int player, GameObject prefab, int x, int y)
		{
			Create(prefab, m_pieces[x, y].piece, m_positions[x * 3 + y], 0.2f * Vector3.up).GetComponent<Renderer>().material.color = m_playerColors[player];
			m_pieces[x, y].powerPieceOwner = player;
			UpdateScores();
		}

		public GamePiece AddProposedPowerPiece(GameObject prefab, BoardPosition pos)
		{
			GamePiece gamePiece = Create(prefab, m_pieces[pos.x, pos.y].piece, pos, 0.2f * Vector3.up);
			gamePiece.GetComponent<Renderer>().material.color = m_proposedMoveColor;
			return gamePiece;
		}

		private GamePiece Create(GameObject prefab, GameObject parent, BoardPosition pos, Vector3 off)
		{
			GameObject obj = UnityEngine.Object.Instantiate(prefab, parent.transform);
			obj.transform.position = parent.transform.position + off;
			obj.GetComponent<GamePiece>().Position = pos;
			return obj.GetComponent<GamePiece>();
		}

		public int GetPlayerScore(int player)
		{
			return m_scores[player];
		}

		private void UpdateScores()
		{
			for (int i = 0; i < 2; i++)
			{
				m_scores[i] = 0;
			}
			for (int j = 0; j < 3; j++)
			{
				for (int k = 0; k < 3; k++)
				{
					if (!(m_pieces[j, k].piece != null))
					{
						continue;
					}
					m_scores[m_pieces[j, k].pieceOwner] += 10;
					if (m_pieces[j, k].powerPieceOwner < 0)
					{
						continue;
					}
					for (int l = j - 1; l <= j + 1; l++)
					{
						for (int m = k - 1; m <= k + 1; m++)
						{
							if (l >= 0 && m >= 0 && l < 3 && m < 3)
							{
								int num = ((m_pieces[j, k].pieceOwner == m_pieces[j, k].powerPieceOwner) ? 10 : (-10));
								m_scores[m_pieces[j, k].powerPieceOwner] += num;
							}
						}
					}
				}
			}
		}
	}
	public class GameController : MonoBehaviour
	{
		private enum GameState
		{
			None,
			PracticingMyTurn,
			PracticingAiTurn,
			OnlineMatchMyTurn,
			OnlineMatchRemoteTurn
		}

		[SerializeField]
		private MatchmakingManager m_matchmaking;

		[SerializeField]
		private GameBoard m_board;

		[SerializeField]
		private GamePiece m_pieceA;

		[SerializeField]
		private GamePiece m_pieceB;

		[SerializeField]
		private GamePiece m_powerPiece;

		[SerializeField]
		private Color m_unusableColor = Color.white;

		[SerializeField]
		private Color m_unselectedColor = Color.white;

		[SerializeField]
		private Color m_selectedColor = Color.white;

		[SerializeField]
		private Color m_highlightedColor = Color.white;

		[SerializeField]
		private Text m_ballCountText;

		[SerializeField]
		private Text m_player0Text;

		[SerializeField]
		private Text m_player1Text;

		private GameState m_state;

		private GamePiece m_interestedPiece;

		private GamePiece m_selectedPiece;

		private GamePiece m_proposedPiece;

		private uint m_powerBallcount;

		private string m_opponentName;

		private void Start()
		{
			TransitionToState(GameState.None);
			UpdateScores();
		}

		private void Update()
		{
			PerFrameStateUpdate();
		}

		private void TransitionToState(GameState state)
		{
			m_state = state;
			UpdateGamePieceColors();
		}

		private void TransitionToNextState()
		{
			if (!m_board.IsFull())
			{
				switch (m_state)
				{
				case GameState.PracticingAiTurn:
					TransitionToState(GameState.PracticingMyTurn);
					break;
				case GameState.PracticingMyTurn:
					TransitionToState(GameState.PracticingAiTurn);
					break;
				case GameState.OnlineMatchRemoteTurn:
					TransitionToState(GameState.OnlineMatchMyTurn);
					break;
				case GameState.OnlineMatchMyTurn:
					TransitionToState(GameState.OnlineMatchRemoteTurn);
					break;
				}
			}
			else
			{
				GameState state = m_state;
				if ((uint)(state - 3) <= 1u)
				{
					m_matchmaking.EndMatch(m_board.GetPlayerScore(0), m_board.GetPlayerScore(1));
				}
				TransitionToState(GameState.None);
			}
		}

		private void PerFrameStateUpdate()
		{
			switch (m_state)
			{
			case GameState.PracticingAiTurn:
				if (UnityEngine.Random.Range(1, 100) < 3)
				{
					MakeAIMove(1);
				}
				break;
			case GameState.PracticingMyTurn:
			case GameState.OnlineMatchMyTurn:
				if (Input.GetButton("Fire1"))
				{
					TrySelectPiece();
					TryPlacePiece();
				}
				break;
			}
		}

		public void PracticeButtonPressed()
		{
			m_opponentName = "* AI *";
			GameState state = m_state;
			if ((uint)(state - 3) <= 1u)
			{
				m_matchmaking.EndMatch(m_board.GetPlayerScore(0), m_board.GetPlayerScore(1));
			}
			m_board.Reset();
			if (UnityEngine.Random.Range(0, 2) == 1)
			{
				TransitionToState(GameState.PracticingMyTurn);
			}
			else
			{
				TransitionToState(GameState.PracticingAiTurn);
			}
			UpdateScores();
		}

		private void MakeAIMove(int player)
		{
			bool flag = false;
			int num = UnityEngine.Random.Range(0, 2);
			int num2 = UnityEngine.Random.Range(0, 2);
			for (int i = 0; i < 3; i++)
			{
				if (flag)
				{
					break;
				}
				for (int j = 0; j < 3; j++)
				{
					if (flag)
					{
						break;
					}
					int x = (num + i) % 3;
					int y = (num2 + j) % 3;
					if (m_board.CanPlayerMoveToPostion(x, y))
					{
						GamePiece gamePiece = ((UnityEngine.Random.Range(0, 2) == 0) ? m_pieceA : m_pieceB);
						m_board.AddPiece(player, gamePiece.Prefab, x, y);
						flag = true;
					}
					else if (m_board.CanPlayerPowerUpPosition(x, y) && UnityEngine.Random.Range(0, 8) < 2)
					{
						m_board.AddPowerPiece(player, m_powerPiece.Prefab, x, y);
						flag = true;
					}
				}
			}
			if (flag)
			{
				UpdateScores();
				TransitionToNextState();
			}
		}

		public void StartOnlineMatch(string opponentName, bool localUserGoesFirst)
		{
			m_board.Reset();
			m_opponentName = opponentName;
			if (localUserGoesFirst)
			{
				TransitionToState(GameState.OnlineMatchMyTurn);
			}
			else
			{
				TransitionToState(GameState.OnlineMatchRemoteTurn);
			}
			UpdateScores();
		}

		public void MakeRemoteMove(GamePiece.Piece piece, int x, int y)
		{
			GameObject prefab = m_pieceA.PrefabFor(piece);
			if (piece == GamePiece.Piece.PowerBall)
			{
				m_board.AddPowerPiece(1, prefab, x, y);
			}
			else
			{
				m_board.AddPiece(1, prefab, x, y);
			}
			UpdateScores();
		}

		public void MarkRemoteTurnComplete()
		{
			if (m_state == GameState.OnlineMatchRemoteTurn)
			{
				TransitionToNextState();
			}
		}

		public void RemoteMatchEnded()
		{
			m_matchmaking.EndMatch(m_board.GetPlayerScore(0), m_board.GetPlayerScore(1));
		}

		public void StartedLookingAtPiece(GamePiece piece)
		{
			m_interestedPiece = piece;
			UpdateGamePieceColors();
		}

		public void StoppedLookingAtPiece()
		{
			m_interestedPiece = null;
			UpdateGamePieceColors();
		}

		public void StartedLookingAtPosition(BoardPosition position)
		{
			if (m_state != GameState.OnlineMatchMyTurn && m_state != GameState.PracticingMyTurn)
			{
				return;
			}
			GamePiece gamePiece = null;
			if ((m_selectedPiece == m_pieceA || m_selectedPiece == m_pieceB) && m_board.CanPlayerMoveToPostion(position.x, position.y))
			{
				gamePiece = m_board.AddProposedPiece(m_selectedPiece.Prefab, position);
			}
			else if (m_selectedPiece == m_powerPiece && m_board.CanPlayerPowerUpPosition(position.x, position.y))
			{
				gamePiece = m_board.AddProposedPowerPiece(m_selectedPiece.Prefab, position);
			}
			if (gamePiece != null)
			{
				if (m_proposedPiece != null)
				{
					UnityEngine.Object.Destroy(m_proposedPiece.gameObject);
				}
				m_proposedPiece = gamePiece;
			}
		}

		public void ClearProposedMove()
		{
			if (m_proposedPiece != null)
			{
				UnityEngine.Object.Destroy(m_proposedPiece.gameObject);
			}
		}

		public void TrySelectPiece()
		{
			if (m_interestedPiece == m_pieceA || m_interestedPiece == m_pieceB)
			{
				m_selectedPiece = m_interestedPiece;
			}
			else if (m_interestedPiece == m_powerPiece && (m_powerBallcount != 0 || m_state == GameState.PracticingMyTurn))
			{
				m_selectedPiece = m_interestedPiece;
			}
			UpdateGamePieceColors();
		}

		public void TryPlacePiece()
		{
			if (!(m_proposedPiece == null))
			{
				BoardPosition position = m_proposedPiece.Position;
				switch (m_proposedPiece.Type)
				{
				case GamePiece.Piece.A:
				case GamePiece.Piece.B:
					m_board.AddPiece(0, m_proposedPiece.Prefab, position.x, position.y);
					break;
				case GamePiece.Piece.PowerBall:
					m_board.AddPowerPiece(0, m_proposedPiece.Prefab, position.x, position.y);
					break;
				}
				UnityEngine.Object.Destroy(m_proposedPiece.gameObject);
				if (m_state == GameState.OnlineMatchMyTurn)
				{
					m_matchmaking.SendLocalMove(m_proposedPiece.Type, position.x, position.y);
				}
				UpdateScores();
				TransitionToNextState();
			}
		}

		public void QuitButtonPressed()
		{
			UnityEngine.Application.Quit();
		}

		public void AddPowerballs(uint count)
		{
			m_powerBallcount += count;
			m_ballCountText.text = "x" + m_powerBallcount;
		}

		private void UpdateScores()
		{
			m_player0Text.text = $"{PlatformManager.MyOculusID}\n\n{m_board.GetPlayerScore(0)}";
			m_player1Text.text = $"{m_opponentName}\n\n{m_board.GetPlayerScore(1)}";
		}

		private void UpdateGamePieceColors()
		{
			switch (m_state)
			{
			case GameState.None:
			case GameState.PracticingAiTurn:
			case GameState.OnlineMatchRemoteTurn:
				m_pieceA.GetComponent<Renderer>().material.color = m_unusableColor;
				m_pieceB.GetComponent<Renderer>().material.color = m_unusableColor;
				m_powerPiece.GetComponent<Renderer>().material.color = m_unusableColor;
				if (m_proposedPiece != null)
				{
					UnityEngine.Object.Destroy(m_proposedPiece.gameObject);
				}
				break;
			case GameState.PracticingMyTurn:
			case GameState.OnlineMatchMyTurn:
				m_pieceA.GetComponent<Renderer>().material.color = m_unselectedColor;
				m_pieceB.GetComponent<Renderer>().material.color = m_unselectedColor;
				m_powerPiece.GetComponent<Renderer>().material.color = m_unselectedColor;
				if (m_interestedPiece == m_pieceA || m_interestedPiece == m_pieceB || m_interestedPiece == m_powerPiece)
				{
					m_interestedPiece.GetComponent<Renderer>().material.color = m_highlightedColor;
				}
				if (m_selectedPiece != null)
				{
					m_selectedPiece.GetComponent<Renderer>().material.color = m_selectedColor;
				}
				break;
			}
		}
	}
	public class GamePiece : MonoBehaviour
	{
		public enum Piece
		{
			A,
			B,
			PowerBall
		}

		[SerializeField]
		private Piece m_type;

		[SerializeField]
		private GameObject m_prefabA;

		[SerializeField]
		private GameObject m_prefabB;

		[SerializeField]
		private GameObject m_prefabPower;

		private BoardPosition m_position;

		public Piece Type => m_type;

		public BoardPosition Position
		{
			get
			{
				return m_position;
			}
			set
			{
				m_position = value;
			}
		}

		public GameObject Prefab => m_type switch
		{
			Piece.A => m_prefabA, 
			Piece.B => m_prefabB, 
			_ => m_prefabPower, 
		};

		public GameObject PrefabFor(Piece p)
		{
			return p switch
			{
				Piece.A => m_prefabA, 
				Piece.B => m_prefabB, 
				_ => m_prefabPower, 
			};
		}
	}
	public class IAPManager : MonoBehaviour
	{
		[SerializeField]
		private GameController m_gameController;

		[SerializeField]
		private Text m_priceText;

		private const string CONSUMABLE_1 = "PowerballPack1";

		private void Start()
		{
			FetchProductPrices();
			FetchPurchasedProducts();
		}

		public void FetchProductPrices()
		{
			IAP.GetProductsBySKU(new string[1] { "PowerballPack1" }).OnComplete(GetProductsBySKUCallback);
		}

		private void GetProductsBySKUCallback(Message<ProductList> msg)
		{
			if (msg.IsError)
			{
				PlatformManager.TerminateWithError(msg);
				return;
			}
			foreach (Product product in msg.GetProductList())
			{
				UnityEngine.Debug.LogFormat("Product: sku:{0} name:{1} price:{2}", product.Sku, product.Name, product.FormattedPrice);
				if (product.Sku == "PowerballPack1")
				{
					m_priceText.text = product.FormattedPrice;
				}
			}
		}

		public void FetchPurchasedProducts()
		{
			IAP.GetViewerPurchases().OnComplete(GetViewerPurchasesCallback);
		}

		private void GetViewerPurchasesCallback(Message<PurchaseList> msg)
		{
			if (msg.IsError)
			{
				PlatformManager.TerminateWithError(msg);
				return;
			}
			foreach (Purchase purchase in msg.GetPurchaseList())
			{
				UnityEngine.Debug.LogFormat("Purchased: sku:{0} granttime:{1} id:{2}", purchase.Sku, purchase.GrantTime, purchase.ID);
			}
		}

		public void BuyPowerBallsPressed()
		{
			IAP.LaunchCheckoutFlow("PowerballPack1").OnComplete(LaunchCheckoutFlowCallback);
		}

		private void LaunchCheckoutFlowCallback(Message<Purchase> msg)
		{
			if (msg.IsError)
			{
				PlatformManager.TerminateWithError(msg);
				return;
			}
			Purchase purchase = msg.GetPurchase();
			UnityEngine.Debug.Log("purchased " + purchase.Sku);
			m_gameController.AddPowerballs(3u);
		}
	}
	public class MatchmakingManager : MonoBehaviour
	{
		private enum MatchRoomState
		{
			None,
			Queued,
			Configuring,
			MyTurn,
			RemoteTurn
		}

		[SerializeField]
		private GameController m_gameController;

		[SerializeField]
		private Text m_matchButtonText;

		[SerializeField]
		private Text m_infoText;

		private const string POOL = "VR_BOARD_GAME_POOL";

		private ulong m_matchRoom;

		private User m_remotePlayer;

		private float m_lastUpdateTime;

		private const float POLL_FREQUENCY = 30f;

		private MatchRoomState m_state;

		private void Start()
		{
			Matchmaking.SetMatchFoundNotificationCallback(MatchFoundCallback);
			Rooms.SetUpdateNotificationCallback(MatchmakingRoomUpdateCallback);
			TransitionToState(MatchRoomState.None);
		}

		private void Update()
		{
			MatchRoomState state = m_state;
			if ((uint)(state - 2) <= 2u && 30f < Time.time - m_lastUpdateTime)
			{
				UnityEngine.Debug.Log("Polling Room");
				m_lastUpdateTime = Time.time;
				Rooms.Get(m_matchRoom).OnComplete(MatchmakingRoomUpdateCallback);
			}
		}

		public void MatchButtonPressed()
		{
			if (m_state == MatchRoomState.None)
			{
				TransitionToState(MatchRoomState.Queued);
			}
			else
			{
				TransitionToState(MatchRoomState.None);
			}
		}

		public void EndMatch(int localScore, int remoteScore)
		{
			MatchRoomState state = m_state;
			if ((uint)(state - 3) <= 1u)
			{
				string key = PlatformManager.MyID.ToString();
				string key2 = m_remotePlayer.ID.ToString();
				Dictionary<string, int> dictionary = new Dictionary<string, int>();
				if (localScore > remoteScore)
				{
					dictionary[key] = 1;
					dictionary[key2] = 2;
				}
				else if (localScore < remoteScore)
				{
					dictionary[key] = 2;
					dictionary[key2] = 1;
				}
				else
				{
					dictionary[key] = 1;
					dictionary[key2] = 1;
				}
				Matchmaking.ReportResultsInsecure(m_matchRoom, dictionary).OnComplete(GenericErrorCheckCallback);
			}
			TransitionToState(MatchRoomState.None);
		}

		private void OnApplicationQuit()
		{
			Matchmaking.Cancel();
			if (m_matchRoom != 0L)
			{
				Rooms.Leave(m_matchRoom);
			}
		}

		private void TransitionToState(MatchRoomState state)
		{
			_ = m_state;
			m_state = state;
			switch (m_state)
			{
			case MatchRoomState.None:
				m_matchButtonText.text = "Find Match";
				m_remotePlayer = null;
				Matchmaking.Cancel();
				if (m_matchRoom != 0L)
				{
					Rooms.Leave(m_matchRoom);
					m_matchRoom = 0uL;
				}
				break;
			case MatchRoomState.Queued:
				m_matchButtonText.text = "Leave Queue";
				Matchmaking.Enqueue2("VR_BOARD_GAME_POOL").OnComplete(MatchmakingEnqueueCallback);
				break;
			case MatchRoomState.Configuring:
				m_matchButtonText.text = "Cancel Match";
				break;
			case MatchRoomState.MyTurn:
			case MatchRoomState.RemoteTurn:
				m_matchButtonText.text = "Cancel Match";
				break;
			}
		}

		private void MatchmakingEnqueueCallback(Message untyped_msg)
		{
			if (untyped_msg.IsError)
			{
				UnityEngine.Debug.Log(untyped_msg.GetError().Message);
				TransitionToState(MatchRoomState.None);
				return;
			}
			MatchmakingEnqueueResult data = ((Message<MatchmakingEnqueueResult>)untyped_msg).Data;
			m_infoText.text = $"Avg Wait Time: {data.AverageWait}s\nMax Expected Wait: {data.MaxExpectedWait}s\nIn Last Hour: {data.MatchesInLastHourCount}\nRecent Percentage: {data.RecentMatchPercentage}%";
		}

		private void MatchFoundCallback(Message<Oculus.Platform.Models.Room> msg)
		{
			if (msg.IsError)
			{
				UnityEngine.Debug.Log(msg.GetError().Message);
				TransitionToState(MatchRoomState.None);
			}
			else if (m_state == MatchRoomState.Queued)
			{
				Matchmaking.JoinRoom(msg.Data.ID, subscribeToUpdates: true).OnComplete(MatchmakingJoinRoomCallback);
				m_matchRoom = msg.Data.ID;
			}
		}

		private void MatchmakingJoinRoomCallback(Message<Oculus.Platform.Models.Room> msg)
		{
			if (msg.IsError)
			{
				UnityEngine.Debug.Log(msg.GetError().Message);
				TransitionToState(MatchRoomState.None);
			}
			else if (m_state == MatchRoomState.Queued)
			{
				int num = ((msg.Data.UsersOptional != null) ? msg.Data.UsersOptional.Count : 0);
				UnityEngine.Debug.Log("Match room joined: " + m_matchRoom + " count: " + num);
				TransitionToState(MatchRoomState.Configuring);
				if (msg.Data.UsersOptional != null && msg.Data.UsersOptional.Count == 2)
				{
					ProcessRoomData(msg.Data);
				}
			}
		}

		private void MatchmakingRoomUpdateCallback(Message<Oculus.Platform.Models.Room> msg)
		{
			if (msg.IsError)
			{
				UnityEngine.Debug.Log(msg.GetError().Message);
				TransitionToState(MatchRoomState.None);
				return;
			}
			string text = ((msg.Data.OwnerOptional != null) ? msg.Data.OwnerOptional.OculusID : "");
			int num = ((msg.Data.UsersOptional != null) ? msg.Data.UsersOptional.Count : 0);
			UnityEngine.Debug.LogFormat("Room Update {0}\n  Owner {1}\n  User Count {2}\n  Datastore Count {3}\n", msg.Data.ID, text, num, msg.Data.DataStore.Count);
			if (msg.Data.ID != m_matchRoom)
			{
				UnityEngine.Debug.Log("Unexpected room update from: " + msg.Data.ID);
			}
			else
			{
				ProcessRoomData(msg.Data);
			}
		}

		private void ProcessRoomData(Oculus.Platform.Models.Room room)
		{
			m_lastUpdateTime = Time.time;
			if (m_state == MatchRoomState.Configuring)
			{
				if (room.UsersOptional != null)
				{
					foreach (User item in room.UsersOptional)
					{
						if (PlatformManager.MyID != item.ID)
						{
							UnityEngine.Debug.Log("Found remote user: " + item.OculusID);
							m_remotePlayer = item;
							break;
						}
					}
				}
				if (m_remotePlayer == null)
				{
					return;
				}
				bool flag = DoesLocalUserGoFirst();
				TransitionToState(flag ? MatchRoomState.MyTurn : MatchRoomState.RemoteTurn);
				Matchmaking.StartMatch(m_matchRoom).OnComplete(GenericErrorCheckCallback);
				m_gameController.StartOnlineMatch(m_remotePlayer.OculusID, flag);
			}
			if (m_state == MatchRoomState.RemoteTurn && room.DataStore.ContainsKey(m_remotePlayer.OculusID) && room.DataStore[m_remotePlayer.OculusID] != "")
			{
				ProcessRemoteMove(room.DataStore[m_remotePlayer.OculusID]);
				TransitionToState(MatchRoomState.MyTurn);
			}
			if (m_state == MatchRoomState.MyTurn && room.OwnerOptional != null && room.OwnerOptional.ID == PlatformManager.MyID)
			{
				m_gameController.MarkRemoteTurnComplete();
			}
			if (room.UsersOptional == null || (room.UsersOptional != null && room.UsersOptional.Count != 2))
			{
				UnityEngine.Debug.Log("Other user quit the room");
				m_gameController.RemoteMatchEnded();
			}
		}

		private void ProcessRemoteMove(string moveString)
		{
			UnityEngine.Debug.Log("Processing remote move string: " + moveString);
			string[] array = moveString.Split(':');
			GamePiece.Piece piece = (GamePiece.Piece)Enum.Parse(typeof(GamePiece.Piece), array[0]);
			int num = int.Parse(array[1]);
			int num2 = int.Parse(array[2]);
			num = 2 - num;
			num2 = 2 - num2;
			m_gameController.MakeRemoteMove(piece, num, num2);
		}

		public void SendLocalMove(GamePiece.Piece piece, int boardX, int boardY)
		{
			string text = $"{piece.ToString()}:{boardX}:{boardY}";
			UnityEngine.Debug.Log("Sending move: " + text);
			Dictionary<string, string> dictionary = new Dictionary<string, string>();
			dictionary[PlatformManager.MyOculusID] = text;
			dictionary[m_remotePlayer.OculusID] = "";
			Rooms.UpdateDataStore(m_matchRoom, dictionary).OnComplete(UpdateDataStoreCallback);
			TransitionToState(MatchRoomState.RemoteTurn);
		}

		private void UpdateDataStoreCallback(Message<Oculus.Platform.Models.Room> msg)
		{
			if (m_state == MatchRoomState.RemoteTurn)
			{
				Rooms.UpdateOwner(m_matchRoom, m_remotePlayer.ID);
			}
		}

		private bool DoesLocalUserGoFirst()
		{
			if (m_matchRoom % 2 == 0L)
			{
				return PlatformManager.MyID < m_remotePlayer.ID;
			}
			return PlatformManager.MyID > m_remotePlayer.ID;
		}

		private void GenericErrorCheckCallback(Message msg)
		{
			if (msg.IsError)
			{
				UnityEngine.Debug.Log(msg.GetError().Message);
				TransitionToState(MatchRoomState.None);
			}
		}
	}
	public class PlatformManager : MonoBehaviour
	{
		private static PlatformManager s_instance;

		private ulong m_myID;

		private string m_myOculusID;

		public static ulong MyID
		{
			get
			{
				if (s_instance != null)
				{
					return s_instance.m_myID;
				}
				return 0uL;
			}
		}

		public static string MyOculusID
		{
			get
			{
				if (s_instance != null && s_instance.m_myOculusID != null)
				{
					return s_instance.m_myOculusID;
				}
				return string.Empty;
			}
		}

		private void Awake()
		{
			if (s_instance != null)
			{
				UnityEngine.Object.Destroy(base.gameObject);
				return;
			}
			s_instance = this;
			UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
			Core.Initialize();
		}

		private void Start()
		{
			Entitlements.IsUserEntitledToApplication().OnComplete(IsEntitledCallback);
		}

		private void IsEntitledCallback(Message msg)
		{
			if (msg.IsError)
			{
				TerminateWithError(msg);
			}
			else
			{
				Users.GetLoggedInUser().OnComplete(GetLoggedInUserCallback);
			}
		}

		private void GetLoggedInUserCallback(Message<User> msg)
		{
			if (msg.IsError)
			{
				TerminateWithError(msg);
				return;
			}
			m_myID = msg.Data.ID;
			m_myOculusID = msg.Data.OculusID;
			UnityEngine.Debug.Log(" I am " + m_myOculusID);
		}

		public static void TerminateWithError(Message msg)
		{
			UnityEngine.Debug.Log("Error: " + msg.GetError().Message);
			UnityEngine.Application.Quit();
		}
	}
}
namespace Oculus.Platform.Samples.SimplePlatformSample
{
	public class DataEntry : MonoBehaviour
	{
		public Text dataOutput;

		private void Start()
		{
			Core.Initialize();
			checkEntitlement();
		}

		private void Update()
		{
			string text = GetComponent<InputField>().text;
			if (Input.GetKey(KeyCode.Return))
			{
				if (text != "")
				{
					SubmitCommand(text);
				}
				GetComponent<InputField>().text = "";
			}
			Request.RunCallbacks();
		}

		private void SubmitCommand(string command)
		{
			string[] array = command.Split(' ');
			if (array.Length == 0)
			{
				return;
			}
			switch (array[0])
			{
			case "p":
				if (array.Length > 2)
				{
					createAndJoinPrivateRoom(array[1], array[2]);
				}
				break;
			case "c":
				getCurrentRoom();
				break;
			case "g":
				if (array.Length > 1)
				{
					getRoom(array[1]);
				}
				break;
			case "j":
				if (array.Length > 1)
				{
					joinRoom(array[1]);
				}
				break;
			case "l":
				if (array.Length > 1)
				{
					leaveRoom(array[1]);
				}
				break;
			case "k":
				if (array.Length > 2)
				{
					kickUser(array[1], array[2]);
				}
				break;
			case "m":
				getLoggedInUser();
				break;
			case "u":
				if (array.Length > 1)
				{
					getUser(array[1]);
				}
				break;
			case "d":
				getLoggedInFriends();
				break;
			case "i":
				getInvitableUsers();
				break;
			case "o":
				if (array.Length > 2)
				{
					inviteUser(array[1], array[2]);
				}
				break;
			case "s":
				if (array.Length > 2)
				{
					setRoomDescription(array[1], array[2]);
				}
				break;
			case "w":
				if (array.Length > 3)
				{
					updateRoomDataStore(array[1], array[2], array[3]);
				}
				break;
			case "n":
				getUserNonce();
				break;
			case "e":
				checkEntitlement();
				break;
			case "a":
				if (array.Length > 1)
				{
					getAchievementDefinition(array[1]);
				}
				break;
			case "b":
				if (array.Length > 1)
				{
					getAchievementProgress(array[1]);
				}
				break;
			case "3":
				if (array.Length > 1)
				{
					unlockAchievement(array[1]);
				}
				break;
			case "4":
				if (array.Length > 2)
				{
					addCountAchievement(array[1], array[2]);
				}
				break;
			case "5":
				if (array.Length > 2)
				{
					addFieldsAchievement(array[1], array[2]);
				}
				break;
			case "1":
				if (array.Length > 2)
				{
					writeLeaderboardEntry(array[1], array[2]);
				}
				break;
			case "2":
				if (array.Length > 1)
				{
					getLeaderboardEntries(array[1]);
				}
				break;
			default:
				printOutputLine("Invalid Command");
				break;
			}
		}

		private void getLeaderboardEntries(string leaderboardName)
		{
			Leaderboards.GetEntries(leaderboardName, 10, LeaderboardFilterType.None, LeaderboardStartAt.Top).OnComplete(leaderboardGetCallback);
		}

		private void writeLeaderboardEntry(string leaderboardName, string value)
		{
			byte[] extraData = new byte[4] { 84, 101, 115, 116 };
			Leaderboards.WriteEntry(leaderboardName, Convert.ToInt32(value), extraData).OnComplete(leaderboardWriteCallback);
		}

		private void addFieldsAchievement(string achievementName, string fields)
		{
			Achievements.AddFields(achievementName, fields).OnComplete(achievementFieldsCallback);
		}

		private void addCountAchievement(string achievementName, string count)
		{
			Achievements.AddCount(achievementName, Convert.ToUInt64(count)).OnComplete(achievementCountCallback);
		}

		private void unlockAchievement(string achievementName)
		{
			Achievements.Unlock(achievementName).OnComplete(achievementUnlockCallback);
		}

		private void getAchievementProgress(string achievementName)
		{
			Achievements.GetProgressByName(new string[1] { achievementName }).OnComplete(achievementProgressCallback);
		}

		private void getAchievementDefinition(string achievementName)
		{
			Achievements.GetDefinitionsByName(new string[1] { achievementName }).OnComplete(achievementDefinitionCallback);
		}

		private void checkEntitlement()
		{
			Entitlements.IsUserEntitledToApplication().OnComplete(getEntitlementCallback);
		}

		private void getUserNonce()
		{
			printOutputLine("Trying to get user nonce");
			Users.GetUserProof().OnComplete(userProofCallback);
		}

		private void createAndJoinPrivateRoom(string joinPolicy, string maxUsers)
		{
			printOutputLine("Trying to create and join private room");
			Rooms.CreateAndJoinPrivate((RoomJoinPolicy)Convert.ToUInt32(joinPolicy), Convert.ToUInt32(maxUsers)).OnComplete(createAndJoinPrivateRoomCallback);
		}

		private void getCurrentRoom()
		{
			printOutputLine("Trying to get current room");
			Rooms.GetCurrent().OnComplete(getCurrentRoomCallback);
		}

		private void getRoom(string roomID)
		{
			printOutputLine("Trying to get room " + roomID);
			Rooms.Get(Convert.ToUInt64(roomID)).OnComplete(getCurrentRoomCallback);
		}

		private void joinRoom(string roomID)
		{
			printOutputLine("Trying to join room " + roomID);
			Rooms.Join(Convert.ToUInt64(roomID), subscribeToUpdates: true).OnComplete(joinRoomCallback);
		}

		private void leaveRoom(string roomID)
		{
			printOutputLine("Trying to leave room " + roomID);
			Rooms.Leave(Convert.ToUInt64(roomID)).OnComplete(leaveRoomCallback);
		}

		private void kickUser(string roomID, string userID)
		{
			printOutputLine("Trying to kick user " + userID + " from room " + roomID);
			Rooms.KickUser(Convert.ToUInt64(roomID), Convert.ToUInt64(userID), 10).OnComplete(getCurrentRoomCallback);
		}

		private void getLoggedInUser()
		{
			printOutputLine("Trying to get currently logged in user");
			Users.GetLoggedInUser().OnComplete(getUserCallback);
		}

		private void getUser(string userID)
		{
			printOutputLine("Trying to get user " + userID);
			Users.Get(Convert.ToUInt64(userID)).OnComplete(getUserCallback);
		}

		private void getLoggedInFriends()
		{
			printOutputLine("Trying to get friends of logged in user");
			Users.GetLoggedInUserFriends().OnComplete(getFriendsCallback);
		}

		private void getInvitableUsers()
		{
			printOutputLine("Trying to get invitable users");
			Rooms.GetInvitableUsers().OnComplete(getInvitableUsersCallback);
		}

		private void inviteUser(string roomID, string inviteToken)
		{
			printOutputLine("Trying to invite token " + inviteToken + " to room " + roomID);
			Rooms.InviteUser(Convert.ToUInt64(roomID), inviteToken).OnComplete(inviteUserCallback);
		}

		private void setRoomDescription(string roomID, string description)
		{
			printOutputLine("Trying to set description " + description + " to room " + roomID);
			Rooms.SetDescription(Convert.ToUInt64(roomID), description).OnComplete(getCurrentRoomCallback);
		}

		private void updateRoomDataStore(string roomID, string key, string value)
		{
			Dictionary<string, string> dictionary = new Dictionary<string, string>();
			dictionary.Add(key, value);
			printOutputLine("Trying to set k=" + key + " v=" + value + " for room " + roomID);
			Rooms.UpdateDataStore(Convert.ToUInt64(roomID), dictionary).OnComplete(getCurrentRoomCallback);
		}

		private void printOutputLine(string newLine)
		{
			dataOutput.text = "> " + newLine + Environment.NewLine + dataOutput.text;
		}

		private void outputRoomDetails(Oculus.Platform.Models.Room room)
		{
			printOutputLine("Room ID: " + room.ID + ", AppID: " + room.ApplicationID + ", Description: " + room.Description);
			int num = ((room.UsersOptional != null) ? room.UsersOptional.Count : 0);
			printOutputLine("MaxUsers: " + room.MaxUsers.ToString() + " Users in room: " + num);
			if (room.OwnerOptional != null)
			{
				printOutputLine("Room owner: " + room.OwnerOptional.ID + " " + room.OwnerOptional.OculusID);
			}
			printOutputLine("Join Policy: " + room.JoinPolicy);
			printOutputLine("Room Type: " + room.Type);
			Message.MessageType.Matchmaking_Enqueue.GetHashCode();
		}

		private void outputUserArray(UserList users)
		{
			foreach (User user in users)
			{
				printOutputLine("User: " + user.ID + " " + user.OculusID + " " + user.Presence + " " + user.InviteToken);
			}
		}

		private void userProofCallback(Message<UserProof> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Received user nonce generation success");
				UserProof data = msg.Data;
				printOutputLine("Nonce: " + data.Value);
			}
			else
			{
				printOutputLine("Received user nonce generation error");
				Error error = msg.GetError();
				printOutputLine("Error: " + error.Message);
			}
		}

		private void getEntitlementCallback(Message msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("You are entitled to use this app.");
			}
			else
			{
				printOutputLine("You are NOT entitled to use this app.");
			}
		}

		private void leaderboardGetCallback(Message<LeaderboardEntryList> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Leaderboard entry get success.");
				{
					foreach (LeaderboardEntry datum in msg.Data)
					{
						printOutputLine(datum.Rank + ". " + datum.User.OculusID + " " + datum.Score + " " + datum.Timestamp);
					}
					return;
				}
			}
			printOutputLine("Received leaderboard get error");
			Error error = msg.GetError();
			printOutputLine("Error: " + error.Message);
		}

		private void leaderboardWriteCallback(Message msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Leaderboard entry write success.");
				if (((Message<bool>)msg).Data)
				{
					printOutputLine("Score updated.");
				}
				else
				{
					printOutputLine("Score NOT updated.");
				}
			}
			else
			{
				printOutputLine("Received leaderboard write error");
				Error error = msg.GetError();
				printOutputLine("Error: " + error.Message);
			}
		}

		private void achievementFieldsCallback(Message msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Achievement fields added.");
				return;
			}
			printOutputLine("Received achievement fields add error");
			Error error = msg.GetError();
			printOutputLine("Error: " + error.Message);
		}

		private void achievementCountCallback(Message msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Achievement count added.");
				return;
			}
			printOutputLine("Received achievement count add error");
			Error error = msg.GetError();
			printOutputLine("Error: " + error.Message);
		}

		private void achievementUnlockCallback(Message msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Achievement unlocked");
				return;
			}
			printOutputLine("Received achievement unlock error");
			Error error = msg.GetError();
			printOutputLine("Error: " + error.Message);
		}

		private void achievementProgressCallback(Message<AchievementProgressList> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Received achievement progress success");
				{
					foreach (AchievementProgress achievementProgress in msg.GetAchievementProgressList())
					{
						if (achievementProgress.IsUnlocked)
						{
							printOutputLine("Achievement Unlocked");
						}
						else
						{
							printOutputLine("Achievement Locked");
						}
						printOutputLine("Current Bitfield: " + achievementProgress.Bitfield.ToString());
						printOutputLine("Current Count: " + achievementProgress.Count);
					}
					return;
				}
			}
			printOutputLine("Received achievement progress error");
			Error error = msg.GetError();
			printOutputLine("Error: " + error.Message);
		}

		private void achievementDefinitionCallback(Message<AchievementDefinitionList> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Received achievement definitions success");
				{
					foreach (AchievementDefinition achievementDefinition in msg.GetAchievementDefinitions())
					{
						switch (achievementDefinition.Type)
						{
						case AchievementType.Simple:
							printOutputLine("Achievement Type: Simple");
							break;
						case AchievementType.Bitfield:
							printOutputLine("Achievement Type: Bitfield");
							printOutputLine("Bitfield Length: " + achievementDefinition.BitfieldLength);
							printOutputLine("Target: " + achievementDefinition.Target);
							break;
						case AchievementType.Count:
							printOutputLine("Achievement Type: Count");
							printOutputLine("Target: " + achievementDefinition.Target);
							break;
						default:
							printOutputLine("Achievement Type: Unknown");
							break;
						}
					}
					return;
				}
			}
			printOutputLine("Received achievement definitions error");
			Error error = msg.GetError();
			printOutputLine("Error: " + error.Message);
		}

		private void createAndJoinPrivateRoomCallback(Message<Oculus.Platform.Models.Room> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Received create and join room success");
				outputRoomDetails(msg.Data);
			}
			else
			{
				printOutputLine("Received create and join room error");
				Error error = msg.GetError();
				printOutputLine("Error: " + error.Message);
			}
		}

		private void getCurrentRoomCallback(Message<Oculus.Platform.Models.Room> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Received get room success");
				outputRoomDetails(msg.Data);
			}
			else
			{
				printOutputLine("Received get room error");
				Error error = msg.GetError();
				printOutputLine("Error: " + error.Message);
			}
		}

		private void joinRoomCallback(Message<Oculus.Platform.Models.Room> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Received join room success");
				outputRoomDetails(msg.Data);
			}
			else
			{
				printOutputLine("Received join room error");
				Error error = msg.GetError();
				printOutputLine("Error: " + error.Message);
			}
		}

		private void leaveRoomCallback(Message<Oculus.Platform.Models.Room> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Received leave room success");
				outputRoomDetails(msg.Data);
			}
			else
			{
				printOutputLine("Received leave room error");
				Error error = msg.GetError();
				printOutputLine("Error: " + error.Message);
			}
		}

		private void getUserCallback(Message<User> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Received get user success");
				User data = msg.Data;
				printOutputLine("User: " + data.ID + " " + data.OculusID + " " + data.Presence + " " + data.InviteToken);
			}
			else
			{
				printOutputLine("Received get user error");
				Error error = msg.GetError();
				printOutputLine("Error: " + error.Message);
			}
		}

		private void getFriendsCallback(Message<UserList> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Received get friends success");
				UserList data = msg.Data;
				outputUserArray(data);
			}
			else
			{
				printOutputLine("Received get friends error");
				Error error = msg.GetError();
				printOutputLine("Error: " + error.Message);
			}
		}

		private void getInvitableUsersCallback(Message<UserList> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Received get invitable users success");
				UserList data = msg.Data;
				outputUserArray(data);
			}
			else
			{
				printOutputLine("Received get invitable users error");
				Error error = msg.GetError();
				printOutputLine("Error: " + error.Message);
			}
		}

		private void inviteUserCallback(Message msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Received invite user success");
				return;
			}
			printOutputLine("Received invite user error");
			Error error = msg.GetError();
			printOutputLine("Error: " + error.Message);
		}
	}
}
namespace Oculus.Platform.Samples.NetChat
{
	internal enum states
	{
		NOT_INIT,
		IDLE,
		REQUEST_FIND,
		FINDING_ROOM,
		REQUEST_CREATE,
		REQUEST_JOIN,
		REQUEST_LEAVE,
		IN_EMPTY_ROOM,
		IN_FULL_ROOM
	}
	public static class Constants
	{
		public const int BUFFER_SIZE = 512;

		public const string BOUT_POOL = "bout_pool";

		public const string FILTER_POOL = "filter_pool";
	}
	public class chatPacket
	{
		public int packetID { get; set; }

		public string textString { get; set; }

		public byte[] Serialize()
		{
			using MemoryStream memoryStream = new MemoryStream();
			using (BinaryWriter binaryWriter = new BinaryWriter(memoryStream))
			{
				if (textString.Length > 512)
				{
					textString = textString.Substring(0, 511);
				}
				binaryWriter.Write(packetID);
				binaryWriter.Write(textString.ToCharArray());
				binaryWriter.Write('\0');
			}
			return memoryStream.ToArray();
		}

		public static chatPacket Deserialize(byte[] data)
		{
			chatPacket chatPacket2 = new chatPacket();
			using MemoryStream input = new MemoryStream(data);
			using BinaryReader binaryReader = new BinaryReader(input);
			chatPacket2.packetID = binaryReader.ReadInt32();
			chatPacket2.textString = Encoding.Default.GetString(binaryReader.ReadBytes(512));
			return chatPacket2;
		}
	}
	public class DataEntry : MonoBehaviour
	{
		public Text dataOutput;

		private states currentState;

		private User localUser;

		private User remoteUser;

		private Oculus.Platform.Models.Room currentRoom;

		private int lastPacketID;

		private bool ratedMatchStarted;

		private void Start()
		{
			currentState = states.NOT_INIT;
			localUser = null;
			remoteUser = null;
			currentRoom = null;
			lastPacketID = 0;
			ratedMatchStarted = false;
			Core.Initialize();
			Rooms.SetUpdateNotificationCallback(updateRoom);
			Matchmaking.SetMatchFoundNotificationCallback(foundMatch);
			checkEntitlement();
		}

		private void Update()
		{
			string text = GetComponent<InputField>().text;
			if (Input.GetKey(KeyCode.Return))
			{
				if (text != "")
				{
					SubmitCommand(text);
				}
				GetComponent<InputField>().text = "";
			}
			processNetPackets();
			Request.RunCallbacks();
		}

		private void SubmitCommand(string command)
		{
			string[] array = command.Split('!');
			if (array.Length == 0)
			{
				return;
			}
			switch (array[0])
			{
			case "c":
				requestCreateRoom();
				break;
			case "d":
				requestCreateFilterRoom();
				break;
			case "f":
				requestFindMatch();
				break;
			case "g":
				requestFindRoom();
				break;
			case "i":
				requestFindFilteredRoom();
				break;
			case "s":
				if (array.Length > 1)
				{
					sendChat(array[1]);
				}
				break;
			case "l":
				requestLeaveRoom();
				break;
			case "1":
				requestStartRatedMatch();
				break;
			case "2":
				requestReportResults();
				break;
			default:
				printOutputLine("Invalid Command");
				break;
			}
		}

		private void printOutputLine(string newLine)
		{
			dataOutput.text = "> " + newLine + Environment.NewLine + dataOutput.text;
		}

		private void checkEntitlement()
		{
			Entitlements.IsUserEntitledToApplication().OnComplete(getEntitlementCallback);
		}

		private void getEntitlementCallback(Message msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("You are entitled to use this app.");
				Users.GetLoggedInUser().OnComplete(init);
			}
			else
			{
				printOutputLine("You are NOT entitled to use this app.");
			}
		}

		private void init(Message<User> msg)
		{
			if (!msg.IsError)
			{
				User data = msg.Data;
				localUser = data;
				currentState = states.IDLE;
			}
			else
			{
				printOutputLine("Received get current user error");
				Error error = msg.GetError();
				printOutputLine("Error: " + error.Message);
				Users.GetLoggedInUser().OnComplete(init);
				currentState = states.NOT_INIT;
			}
		}

		private void requestCreateRoom()
		{
			switch (currentState)
			{
			case states.NOT_INIT:
				printOutputLine("The app has not initialized properly and we don't know your userID.");
				break;
			case states.IDLE:
				printOutputLine("Trying to create a matchmaking room");
				Matchmaking.CreateAndEnqueueRoom("filter_pool", 8u, subscribeToUpdates: true).OnComplete(createRoomResponse);
				currentState = states.REQUEST_CREATE;
				break;
			case states.REQUEST_FIND:
				printOutputLine("You have already made a request to find a room.  Please wait for that request to complete.");
				break;
			case states.FINDING_ROOM:
				printOutputLine("You have already currently looking for a room.  Please wait for the match to be made.");
				break;
			case states.REQUEST_JOIN:
				printOutputLine("We are currently trying to join a room.  Please wait to see if we can join it.");
				break;
			case states.REQUEST_LEAVE:
				printOutputLine("We are currently trying to leave a room.  Please wait to see if we can leave it.");
				break;
			case states.REQUEST_CREATE:
				printOutputLine("You have already requested a matchmaking room to be created.  Please wait for the room to be made.");
				break;
			case states.IN_EMPTY_ROOM:
				printOutputLine("You have already in a matchmaking room.  Please wait for an opponent to join.");
				break;
			case states.IN_FULL_ROOM:
				printOutputLine("You have already in a match.");
				break;
			default:
				printOutputLine("You have hit an unknown state.");
				break;
			}
		}

		private void createRoomResponse(Message<MatchmakingEnqueueResultAndRoom> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Received create matchmaking room success");
				printOutputLine("RoomID: " + (currentRoom = msg.Data.Room).ID);
				currentState = states.IN_EMPTY_ROOM;
			}
			else
			{
				printOutputLine("Received create matchmaking room Error");
				Error error = msg.GetError();
				printOutputLine("Error: " + error.Message);
				printOutputLine("You can only create a matchmaking room for pools of mode Room.  Make sure you have an appropriate pool setup on the Developer portal.\n");
				currentState = states.IDLE;
			}
		}

		private void requestCreateFilterRoom()
		{
			switch (currentState)
			{
			case states.NOT_INIT:
				printOutputLine("The app has not initialized properly and we don't know your userID.\n");
				break;
			case states.IDLE:
			{
				printOutputLine("Trying to create a matchmaking room");
				Matchmaking.CustomQuery customQuery = new Matchmaking.CustomQuery();
				customQuery.criteria = null;
				customQuery.data = new Dictionary<string, object>();
				customQuery.data.Add("game_type_name", "CTF");
				customQuery.data.Add("map_name", "Really_Big_Map");
				Matchmaking.CreateAndEnqueueRoom("filter_pool", 8u, subscribeToUpdates: true, customQuery).OnComplete(createRoomResponse);
				currentState = states.REQUEST_CREATE;
				break;
			}
			case states.REQUEST_FIND:
				printOutputLine("You have already made a request to find a room.  Please wait for that request to complete.\n");
				break;
			case states.FINDING_ROOM:
				printOutputLine("You have already currently looking for a room.  Please wait for the match to be made.\n");
				break;
			case states.REQUEST_JOIN:
				printOutputLine("We are currently trying to join a room.  Please wait to see if we can join it.\n");
				break;
			case states.REQUEST_LEAVE:
				printOutputLine("We are currently trying to leave a room.  Please wait to see if we can leave it.\n");
				break;
			case states.REQUEST_CREATE:
				printOutputLine("You have already requested a matchmaking room to be created.  Please wait for the room to be made.\n");
				break;
			case states.IN_EMPTY_ROOM:
				printOutputLine("You have already in a matchmaking room.  Please wait for an opponent to join.\n");
				break;
			case states.IN_FULL_ROOM:
				printOutputLine("You have already in a match.\n");
				break;
			default:
				printOutputLine("You have hit an unknown state.\n");
				break;
			}
		}

		private void requestFindRoom()
		{
			switch (currentState)
			{
			case states.NOT_INIT:
				printOutputLine("The app has not initialized properly and we don't know your userID.");
				break;
			case states.IDLE:
				printOutputLine("\nTrying to find a matchmaking room\n");
				Matchmaking.Enqueue("filter_pool").OnComplete(searchingStarted);
				currentState = states.REQUEST_FIND;
				break;
			case states.REQUEST_FIND:
				printOutputLine("You have already made a request to find a room.  Please wait for that request to complete.");
				break;
			case states.FINDING_ROOM:
				printOutputLine("You have already currently looking for a room.  Please wait for the match to be made.");
				break;
			case states.REQUEST_JOIN:
				printOutputLine("We are currently trying to join a room.  Please wait to see if we can join it.");
				break;
			case states.REQUEST_LEAVE:
				printOutputLine("We are currently trying to leave a room.  Please wait to see if we can leave it.");
				break;
			case states.REQUEST_CREATE:
				printOutputLine("You have already requested a matchmaking room to be created.  Please wait for the room to be made.");
				break;
			case states.IN_EMPTY_ROOM:
				printOutputLine("You have already in a matchmaking room.  Please wait for an opponent to join.");
				break;
			case states.IN_FULL_ROOM:
				printOutputLine("You have already in a match.");
				break;
			default:
				printOutputLine("You have hit an unknown state.");
				break;
			}
		}

		private void requestFindFilteredRoom()
		{
			switch (currentState)
			{
			case states.NOT_INIT:
				printOutputLine("The app has not initialized properly and we don't know your userID.");
				break;
			case states.IDLE:
			{
				printOutputLine("Trying to find a matchmaking room");
				Matchmaking.CustomQuery customQuery = new Matchmaking.CustomQuery();
				Matchmaking.CustomQuery.Criterion[] array = new Matchmaking.CustomQuery.Criterion[2];
				array[0].key = "map";
				array[0].importance = MatchmakingCriterionImportance.Required;
				array[0].parameters = new Dictionary<string, object>();
				array[0].parameters.Add("map_param_1", "Really_Big_Map");
				array[0].parameters.Add("map_param_2", "Big_Map");
				array[1].key = "game_type";
				array[1].importance = MatchmakingCriterionImportance.Required;
				array[1].parameters = new Dictionary<string, object>();
				array[1].parameters.Add("game_type_param", "CTF");
				customQuery.criteria = array;
				customQuery.data = null;
				Matchmaking.Enqueue("filter_pool", customQuery);
				currentState = states.REQUEST_FIND;
				break;
			}
			case states.REQUEST_FIND:
				printOutputLine("You have already made a request to find a room.  Please wait for that request to complete.");
				break;
			case states.FINDING_ROOM:
				printOutputLine("You have already currently looking for a room.  Please wait for the match to be made.");
				break;
			case states.REQUEST_JOIN:
				printOutputLine("We are currently trying to join a room.  Please wait to see if we can join it.");
				break;
			case states.REQUEST_LEAVE:
				printOutputLine("We are currently trying to leave a room.  Please wait to see if we can leave it.");
				break;
			case states.REQUEST_CREATE:
				printOutputLine("You have already requested a matchmaking room to be created.  Please wait for the room to be made.");
				break;
			case states.IN_EMPTY_ROOM:
				printOutputLine("You have already in a matchmaking room.  Please wait for an opponent to join.");
				break;
			case states.IN_FULL_ROOM:
				printOutputLine("You have already in a match.");
				break;
			default:
				printOutputLine("You have hit an unknown state.");
				break;
			}
		}

		private void foundMatch(Message<Oculus.Platform.Models.Room> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Received find match success. We are now going to request to join the room.");
				Rooms.Join(msg.Data.ID, subscribeToUpdates: true).OnComplete(joinRoomResponse);
				currentState = states.REQUEST_JOIN;
			}
			else
			{
				printOutputLine("Received find match error");
				Error error = msg.GetError();
				printOutputLine("Error: " + error.Message);
				currentState = states.IDLE;
			}
		}

		private void joinRoomResponse(Message<Oculus.Platform.Models.Room> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Received join room success.");
				currentRoom = msg.Data;
				currentState = states.IN_EMPTY_ROOM;
				if (currentRoom.UsersOptional == null)
				{
					return;
				}
				{
					foreach (User item in currentRoom.UsersOptional)
					{
						if (item.ID != localUser.ID)
						{
							remoteUser = item;
							currentState = states.IN_FULL_ROOM;
						}
					}
					return;
				}
			}
			printOutputLine("Received join room error");
			printOutputLine("It's possible the room filled up before you could join it.");
			Error error = msg.GetError();
			printOutputLine("Error: " + error.Message);
			currentState = states.IDLE;
		}

		private void requestFindMatch()
		{
			switch (currentState)
			{
			case states.NOT_INIT:
				printOutputLine("The app has not initialized properly and we don't know your userID.");
				break;
			case states.IDLE:
				printOutputLine("Trying to find a matchmaking room");
				Matchmaking.Enqueue("bout_pool").OnComplete(searchingStarted);
				currentState = states.REQUEST_FIND;
				break;
			case states.REQUEST_FIND:
				printOutputLine("You have already made a request to find a room.  Please wait for that request to complete.");
				break;
			case states.FINDING_ROOM:
				printOutputLine("You have already currently looking for a room.  Please wait for the match to be made.");
				break;
			case states.REQUEST_JOIN:
				printOutputLine("We are currently trying to join a room.  Please wait to see if we can join it.");
				break;
			case states.REQUEST_LEAVE:
				printOutputLine("We are currently trying to leave a room.  Please wait to see if we can leave it.");
				break;
			case states.REQUEST_CREATE:
				printOutputLine("You have already requested a matchmaking room to be created.  Please wait for the room to be made.");
				break;
			case states.IN_EMPTY_ROOM:
				printOutputLine("You have already in a matchmaking room.  Please wait for an opponent to join.");
				break;
			case states.IN_FULL_ROOM:
				printOutputLine("You have already in a match.");
				break;
			default:
				printOutputLine("You have hit an unknown state.");
				break;
			}
		}

		private void searchingStarted(Message msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Searching for a match successfully started");
				currentState = states.REQUEST_FIND;
			}
			else
			{
				printOutputLine("Searching for a match error");
				Error error = msg.GetError();
				printOutputLine("Error: " + error.Message);
			}
		}

		private void updateRoom(Message<Oculus.Platform.Models.Room> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Received room update notification");
				Oculus.Platform.Models.Room data = msg.Data;
				if (currentState == states.IN_EMPTY_ROOM)
				{
					if (data.UsersOptional == null)
					{
						return;
					}
					{
						foreach (User item in data.UsersOptional)
						{
							if (item.ID != localUser.ID)
							{
								remoteUser = item;
								currentState = states.IN_FULL_ROOM;
							}
						}
						return;
					}
				}
				if (data.UsersOptional != null && data.UsersOptional.Count == 1)
				{
					printOutputLine("User ID: " + remoteUser.ID + "has left");
					remoteUser = null;
					currentState = states.IN_EMPTY_ROOM;
				}
			}
			else
			{
				printOutputLine("Received room update error");
				Error error = msg.GetError();
				printOutputLine("Error: " + error.Message);
			}
		}

		private void sendChat(string chatMessage)
		{
			switch (currentState)
			{
			case states.NOT_INIT:
				printOutputLine("The app has not initialized properly and we don't know your userID.");
				break;
			case states.IDLE:
			case states.REQUEST_FIND:
			case states.FINDING_ROOM:
			case states.REQUEST_CREATE:
			case states.REQUEST_JOIN:
			case states.REQUEST_LEAVE:
			case states.IN_EMPTY_ROOM:
				printOutputLine("You need to be in a room with another player to send a message.");
				break;
			case states.IN_FULL_ROOM:
			{
				chatPacket chatPacket2 = new chatPacket();
				lastPacketID++;
				chatPacket2.packetID = lastPacketID;
				chatPacket2.textString = chatMessage;
				Net.SendPacket(remoteUser.ID, chatPacket2.Serialize(), SendPolicy.Reliable);
				break;
			}
			default:
				printOutputLine("You have hit an unknown state.");
				break;
			}
		}

		private void processNetPackets()
		{
			for (Packet packet = Net.ReadPacket(); packet != null; packet = Net.ReadPacket())
			{
				byte[] array = new byte[packet.Size];
				packet.ReadBytes(array);
				chatPacket chatPacket2 = chatPacket.Deserialize(array);
				printOutputLine("Chat Text: " + chatPacket2.textString.ToString());
				printOutputLine("Received Packet from UserID: " + packet.SenderID);
				printOutputLine("Received Packet ID: " + chatPacket2.packetID);
			}
		}

		private void requestLeaveRoom()
		{
			switch (currentState)
			{
			case states.NOT_INIT:
				printOutputLine("The app has not initialized properly and we don't know your userID.");
				break;
			case states.IDLE:
			case states.REQUEST_FIND:
			case states.FINDING_ROOM:
			case states.REQUEST_CREATE:
			case states.REQUEST_JOIN:
				printOutputLine("You are currently not in a room to leave.");
				break;
			case states.REQUEST_LEAVE:
				printOutputLine("We are currently trying to leave a room.  Please wait to see if we can leave it.");
				break;
			case states.IN_EMPTY_ROOM:
			case states.IN_FULL_ROOM:
				printOutputLine("Trying to leave room.");
				Rooms.Leave(currentRoom.ID).OnComplete(leaveRoomResponse);
				break;
			default:
				printOutputLine("You have hit an unknown state.");
				break;
			}
		}

		private void leaveRoomResponse(Message<Oculus.Platform.Models.Room> msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("We were able to leave the room");
				currentRoom = null;
				remoteUser = null;
				currentState = states.IDLE;
			}
			else
			{
				printOutputLine("Leave room error");
				Error error = msg.GetError();
				printOutputLine("Error: " + error.Message);
			}
		}

		private void requestStartRatedMatch()
		{
			switch (currentState)
			{
			case states.NOT_INIT:
				printOutputLine("The app has not initialized properly and we don't know your userID.");
				break;
			case states.IDLE:
			case states.REQUEST_FIND:
			case states.FINDING_ROOM:
			case states.REQUEST_CREATE:
			case states.REQUEST_JOIN:
			case states.REQUEST_LEAVE:
			case states.IN_EMPTY_ROOM:
				printOutputLine("You need to be in a room with another player to start a rated match.");
				break;
			case states.IN_FULL_ROOM:
				printOutputLine("Trying to start a rated match.  This call should be made once a rated match begins so we will be able to submit results after the game is done.");
				Matchmaking.StartMatch(currentRoom.ID).OnComplete(startRatedMatchResponse);
				break;
			default:
				printOutputLine("You have hit an unknown state.");
				break;
			}
		}

		private void startRatedMatchResponse(Message msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Started a rated match");
				ratedMatchStarted = true;
			}
			else
			{
				Error error = msg.GetError();
				printOutputLine("Received starting rated match failure: " + error.Message);
				printOutputLine("Your matchmaking pool needs to have a skill pool associated with it to play rated matches");
			}
		}

		private void requestReportResults()
		{
			switch (currentState)
			{
			case states.NOT_INIT:
				printOutputLine("The app has not initialized properly and we don't know your userID.");
				break;
			case states.IDLE:
			case states.REQUEST_FIND:
			case states.FINDING_ROOM:
			case states.REQUEST_CREATE:
			case states.REQUEST_JOIN:
			case states.REQUEST_LEAVE:
				printOutputLine("You need to be in a room with another player to report results on a rated match.");
				break;
			case states.IN_EMPTY_ROOM:
			case states.IN_FULL_ROOM:
				if (ratedMatchStarted)
				{
					printOutputLine("Submitting rated match results.");
					Dictionary<string, int> dictionary = new Dictionary<string, int>();
					dictionary.Add(localUser.ID.ToString(), 1);
					dictionary.Add(remoteUser.ID.ToString(), 2);
					Matchmaking.ReportResultsInsecure(currentRoom.ID, dictionary).OnComplete(reportResultsResponse);
				}
				else
				{
					printOutputLine("You can't report results unless you've already started a rated match");
				}
				break;
			default:
				printOutputLine("You have hit an unknown state.");
				break;
			}
		}

		private void reportResultsResponse(Message msg)
		{
			if (!msg.IsError)
			{
				printOutputLine("Rated match results reported. Now attempting to leave room.");
				ratedMatchStarted = false;
				requestLeaveRoom();
			}
			else
			{
				Error error = msg.GetError();
				printOutputLine("Received reporting rated match failure: " + error.Message);
			}
		}
	}
}
namespace Oculus.Platform.Samples.EntitlementCheck
{
	public class EntitlementCheck : MonoBehaviour
	{
		public bool exitAppOnFailure = true;

		public static event Action UserFailedEntitlementCheck;

		public static event Action UserPassedEntitlementCheck;

		private void Start()
		{
			try
			{
				if (!Core.IsInitialized())
				{
					Core.Initialize();
				}
				Entitlements.IsUserEntitledToApplication().OnComplete(EntitlementCheckCallback);
			}
			catch
			{
				HandleEntitlementCheckResult(result: false);
			}
		}

		private void EntitlementCheckCallback(Message msg)
		{
			HandleEntitlementCheckResult(!msg.IsError);
		}

		private void HandleEntitlementCheckResult(bool result)
		{
			if (result)
			{
				UnityEngine.Debug.Log("Oculus user entitlement check successful.");
				try
				{
					if (EntitlementCheck.UserPassedEntitlementCheck != null)
					{
						EntitlementCheck.UserPassedEntitlementCheck();
					}
					return;
				}
				catch
				{
					UnityEngine.Debug.LogError("Suppressed exception in app-provided UserPassedEntitlementCheck() event handler.");
					return;
				}
			}
			try
			{
				if (EntitlementCheck.UserFailedEntitlementCheck != null)
				{
					EntitlementCheck.UserFailedEntitlementCheck();
				}
			}
			catch
			{
				UnityEngine.Debug.LogError("Suppressed exception in app-provided UserFailedEntitlementCheck() event handler.");
			}
			if (exitAppOnFailure)
			{
				UnityEngine.Debug.LogError("Oculus user entitlement check failed. Exiting now.");
				UnityEngine.Application.Quit();
			}
			else
			{
				UnityEngine.Debug.LogError("Oculus user entitlement check failed.");
			}
		}
	}
}
namespace Oculus.Avatar
{
	public static class AvatarLogger
	{
		public const string LogAvatar = "[Avatars] - ";

		public const string Tab = "    ";

		[Conditional("ENABLE_AVATAR_LOGS")]
		[Conditional("ENABLE_AVATAR_LOG_BASIC")]
		public static void Log(string logMsg)
		{
			UnityEngine.Debug.Log("[Avatars] - " + logMsg);
		}

		[Conditional("ENABLE_AVATAR_LOGS")]
		[Conditional("ENABLE_AVATAR_LOG_BASIC")]
		public static void Log(string logMsg, UnityEngine.Object context)
		{
			UnityEngine.Debug.Log("[Avatars] - " + logMsg, context);
		}

		[Conditional("ENABLE_AVATAR_LOGS")]
		[Conditional("ENABLE_AVATAR_LOG_WARNING")]
		public static void LogWarning(string logMsg)
		{
			UnityEngine.Debug.LogWarning("[Avatars] - " + logMsg);
		}

		[Conditional("ENABLE_AVATAR_LOGS")]
		[Conditional("ENABLE_AVATAR_LOG_ERROR")]
		public static void LogError(string logMsg)
		{
			UnityEngine.Debug.LogError("[Avatars] - " + logMsg);
		}

		[Conditional("ENABLE_AVATAR_LOGS")]
		[Conditional("ENABLE_AVATAR_LOG_ERROR")]
		public static void LogError(string logMsg, UnityEngine.Object context)
		{
			UnityEngine.Debug.LogError("[Avatars] - " + logMsg, context);
		}
	}
	public class CAPI
	{
		public delegate void LoggingDelegate(IntPtr str);

		public enum Result
		{
			Success = 0,
			Failure = -1000,
			Failure_InvalidParameter = -1001,
			Failure_NotInitialized = -1002,
			Failure_InvalidOperation = -1003,
			Failure_Unsupported = -1004,
			Failure_NotYetImplemented = -1005,
			Failure_OperationFailed = -1006,
			Failure_InsufficientSize = -1007
		}

		private static class OVRP_1_30_0
		{
			public static readonly Version version = new Version(1, 30, 0);

			[DllImport("OVRPlugin", CallingConvention = CallingConvention.Cdecl)]
			public static extern Result ovrp_SendEvent2(string name, string param, string source);
		}

		private const string LibFile = "ovravatarloader";

		private static IntPtr nativeVisemeData = IntPtr.Zero;

		private static IntPtr nativeGazeTargetsData = IntPtr.Zero;

		private static IntPtr nativeAvatarLightsData = IntPtr.Zero;

		private static IntPtr DebugLineCountData = IntPtr.Zero;

		private static float[] scratchBufferFloat = new float[16];

		private static GameObject debugLineGo;

		private static string SDKRuntimePrefix = "[RUNTIME] - ";

		private const string ovrPluginDLL = "OVRPlugin";

		private static Version ovrPluginVersion;

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_InitializeAndroidUnity(string appID);

		public static void Initialize()
		{
			nativeVisemeData = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(ovrAvatarVisemes)));
			nativeGazeTargetsData = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(ovrAvatarGazeTargets)));
			nativeAvatarLightsData = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(ovrAvatarLights)));
			DebugLineCountData = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(uint)));
			debugLineGo = new GameObject();
			debugLineGo.name = "AvatarSDKDebugDrawHelper";
		}

		public static void Shutdown()
		{
			Marshal.FreeHGlobal(nativeVisemeData);
			Marshal.FreeHGlobal(nativeGazeTargetsData);
			Marshal.FreeHGlobal(nativeAvatarLightsData);
			Marshal.FreeHGlobal(DebugLineCountData);
			debugLineGo = null;
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_Shutdown();

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovrAvatarMessage_Pop();

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ovrAvatarMessageType ovrAvatarMessage_GetType(IntPtr msg);

		public static ovrAvatarMessage_AvatarSpecification ovrAvatarMessage_GetAvatarSpecification(IntPtr msg)
		{
			return (ovrAvatarMessage_AvatarSpecification)Marshal.PtrToStructure(ovrAvatarMessage_GetAvatarSpecification_Native(msg), typeof(ovrAvatarMessage_AvatarSpecification));
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarMessage_GetAvatarSpecification")]
		private static extern IntPtr ovrAvatarMessage_GetAvatarSpecification_Native(IntPtr msg);

		public static ovrAvatarMessage_AssetLoaded ovrAvatarMessage_GetAssetLoaded(IntPtr msg)
		{
			return (ovrAvatarMessage_AssetLoaded)Marshal.PtrToStructure(ovrAvatarMessage_GetAssetLoaded_Native(msg), typeof(ovrAvatarMessage_AssetLoaded));
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarMessage_GetAssetLoaded")]
		private static extern IntPtr ovrAvatarMessage_GetAssetLoaded_Native(IntPtr msg);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatarMessage_Free(IntPtr msg);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovrAvatarSpecificationRequest_Create(ulong userID);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatarSpecificationRequest_Destroy(IntPtr specificationRequest);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatarSpecificationRequest_SetCombineMeshes(IntPtr specificationRequest, bool useCombinedMesh);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatarSpecificationRequest_SetLookAndFeelVersion(IntPtr specificationRequest, ovrAvatarLookAndFeelVersion version);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatarSpecificationRequest_SetLevelOfDetail(IntPtr specificationRequest, ovrAvatarAssetLevelOfDetail lod);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_RequestAvatarSpecification(ulong userID);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_RequestAvatarSpecificationFromSpecRequest(IntPtr specificationRequest);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatarSpecificationRequest_SetFallbackLookAndFeelVersion(IntPtr specificationRequest, ovrAvatarLookAndFeelVersion version);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatarSpecificationRequest_SetExpressiveFlag(IntPtr specificationRequest, bool enable);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovrAvatar_Create(IntPtr avatarSpecification, ovrAvatarCapabilities capabilities);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_Destroy(IntPtr avatar);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatarPose_UpdateBody(IntPtr avatar, ovrAvatarTransform headPose);

		public static void ovrAvatarPose_UpdateVoiceVisualization(IntPtr avatar, float[] pcmData)
		{
			ovrAvatarPose_UpdateVoiceVisualization_Native(avatar, (uint)pcmData.Length, pcmData);
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarPose_UpdateVoiceVisualization")]
		private static extern void ovrAvatarPose_UpdateVoiceVisualization_Native(IntPtr avatar, uint pcmDataSize, [In] float[] pcmData);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatarPose_UpdateHands(IntPtr avatar, ovrAvatarHandInputState inputStateLeft, ovrAvatarHandInputState inputStateRight);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatarPose_UpdateHandsWithType(IntPtr avatar, ovrAvatarHandInputState inputStateLeft, ovrAvatarHandInputState inputStateRight, ovrAvatarControllerType type);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatarPose_Finalize(IntPtr avatar, float elapsedSeconds);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_SetLeftControllerVisibility(IntPtr avatar, bool show);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_SetRightControllerVisibility(IntPtr avatar, bool show);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_SetLeftHandVisibility(IntPtr avatar, bool show);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_SetRightHandVisibility(IntPtr avatar, bool show);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovrAvatarComponent_Count(IntPtr avatar);

		public static void ovrAvatarComponent_Get(IntPtr avatar, uint index, bool includeName, ref ovrAvatarComponent component)
		{
			ovrAvatarComponent_Get(ovrAvatarComponent_Get_Native(avatar, index), includeName, ref component);
		}

		public static void ovrAvatarComponent_Get(IntPtr componentPtr, bool includeName, ref ovrAvatarComponent component)
		{
			Marshal.Copy(new IntPtr(componentPtr.ToInt64() + ovrAvatarComponent_Offsets.transform), scratchBufferFloat, 0, 10);
			OvrAvatar.ConvertTransform(scratchBufferFloat, ref component.transform);
			component.renderPartCount = (uint)Marshal.ReadInt32(componentPtr, ovrAvatarComponent_Offsets.renderPartCount);
			component.renderParts = Marshal.ReadIntPtr(componentPtr, ovrAvatarComponent_Offsets.renderParts);
			if (includeName)
			{
				IntPtr ptr = Marshal.ReadIntPtr(componentPtr, ovrAvatarComponent_Offsets.name);
				component.name = Marshal.PtrToStringAnsi(ptr);
			}
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarComponent_Get")]
		public static extern IntPtr ovrAvatarComponent_Get_Native(IntPtr avatar, uint index);

		public static bool ovrAvatarPose_GetBaseComponent(IntPtr avatar, ref ovrAvatarBaseComponent component)
		{
			IntPtr intPtr = ovrAvatarPose_GetBaseComponent_Native(avatar);
			if (intPtr == IntPtr.Zero)
			{
				return false;
			}
			int ofs = Marshal.SizeOf(typeof(ovrAvatarBaseComponent)) - Marshal.SizeOf(typeof(IntPtr));
			component.renderComponent = Marshal.ReadIntPtr(intPtr, ofs);
			return true;
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarPose_GetBaseComponent")]
		private static extern IntPtr ovrAvatarPose_GetBaseComponent_Native(IntPtr avatar);

		public static IntPtr MarshalRenderComponent<T>(IntPtr ptr) where T : struct
		{
			return Marshal.ReadIntPtr(new IntPtr(ptr.ToInt64() + Marshal.OffsetOf(typeof(T), "renderComponent").ToInt64()));
		}

		public static bool ovrAvatarPose_GetBodyComponent(IntPtr avatar, ref ovrAvatarBodyComponent component)
		{
			IntPtr intPtr = ovrAvatarPose_GetBodyComponent_Native(avatar);
			if (intPtr == IntPtr.Zero)
			{
				return false;
			}
			Marshal.Copy(new IntPtr(intPtr.ToInt64() + ovrAvatarBodyComponent_Offsets.leftEyeTransform), scratchBufferFloat, 0, 10);
			OvrAvatar.ConvertTransform(scratchBufferFloat, ref component.leftEyeTransform);
			Marshal.Copy(new IntPtr(intPtr.ToInt64() + ovrAvatarBodyComponent_Offsets.rightEyeTransform), scratchBufferFloat, 0, 10);
			OvrAvatar.ConvertTransform(scratchBufferFloat, ref component.rightEyeTransform);
			Marshal.Copy(new IntPtr(intPtr.ToInt64() + ovrAvatarBodyComponent_Offsets.centerEyeTransform), scratchBufferFloat, 0, 10);
			OvrAvatar.ConvertTransform(scratchBufferFloat, ref component.centerEyeTransform);
			component.renderComponent = MarshalRenderComponent<ovrAvatarBodyComponent>(intPtr);
			return true;
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarPose_GetBodyComponent")]
		private static extern IntPtr ovrAvatarPose_GetBodyComponent_Native(IntPtr avatar);

		public static bool ovrAvatarPose_GetLeftControllerComponent(IntPtr avatar, ref ovrAvatarControllerComponent component)
		{
			IntPtr intPtr = ovrAvatarPose_GetLeftControllerComponent_Native(avatar);
			if (intPtr == IntPtr.Zero)
			{
				return false;
			}
			int ofs = Marshal.SizeOf(typeof(ovrAvatarControllerComponent)) - Marshal.SizeOf(typeof(IntPtr));
			component.renderComponent = Marshal.ReadIntPtr(intPtr, ofs);
			return true;
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarPose_GetLeftControllerComponent")]
		private static extern IntPtr ovrAvatarPose_GetLeftControllerComponent_Native(IntPtr avatar);

		public static bool ovrAvatarPose_GetRightControllerComponent(IntPtr avatar, ref ovrAvatarControllerComponent component)
		{
			IntPtr intPtr = ovrAvatarPose_GetRightControllerComponent_Native(avatar);
			if (intPtr == IntPtr.Zero)
			{
				return false;
			}
			int ofs = Marshal.SizeOf(typeof(ovrAvatarControllerComponent)) - Marshal.SizeOf(typeof(IntPtr));
			component.renderComponent = Marshal.ReadIntPtr(intPtr, ofs);
			return true;
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarPose_GetRightControllerComponent")]
		private static extern IntPtr ovrAvatarPose_GetRightControllerComponent_Native(IntPtr avatar);

		public static bool ovrAvatarPose_GetLeftHandComponent(IntPtr avatar, ref ovrAvatarHandComponent component)
		{
			IntPtr intPtr = ovrAvatarPose_GetLeftHandComponent_Native(avatar);
			if (intPtr == IntPtr.Zero)
			{
				return false;
			}
			int ofs = Marshal.SizeOf(typeof(ovrAvatarHandComponent)) - Marshal.SizeOf(typeof(IntPtr));
			component.renderComponent = Marshal.ReadIntPtr(intPtr, ofs);
			return true;
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarPose_GetLeftHandComponent")]
		private static extern IntPtr ovrAvatarPose_GetLeftHandComponent_Native(IntPtr avatar);

		public static bool ovrAvatarPose_GetRightHandComponent(IntPtr avatar, ref ovrAvatarHandComponent component)
		{
			IntPtr intPtr = ovrAvatarPose_GetRightHandComponent_Native(avatar);
			if (intPtr == IntPtr.Zero)
			{
				return false;
			}
			int ofs = Marshal.SizeOf(typeof(ovrAvatarHandComponent)) - Marshal.SizeOf(typeof(IntPtr));
			component.renderComponent = Marshal.ReadIntPtr(intPtr, ofs);
			return true;
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarPose_GetRightHandComponent")]
		private static extern IntPtr ovrAvatarPose_GetRightHandComponent_Native(IntPtr avatar);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatarAsset_BeginLoading(ulong assetID);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovrAvatarAsset_BeginLoadingLOD(ulong assetId, ovrAvatarAssetLevelOfDetail lod);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ovrAvatarAssetType ovrAvatarAsset_GetType(IntPtr assetHandle);

		public static ovrAvatarMeshAssetData ovrAvatarAsset_GetMeshData(IntPtr assetPtr)
		{
			return (ovrAvatarMeshAssetData)Marshal.PtrToStructure(ovrAvatarAsset_GetMeshData_Native(assetPtr), typeof(ovrAvatarMeshAssetData));
		}

		public static ovrAvatarMeshAssetDataV2 ovrAvatarAsset_GetCombinedMeshData(IntPtr assetPtr)
		{
			return (ovrAvatarMeshAssetDataV2)Marshal.PtrToStructure(ovrAvatarAsset_GetCombinedMeshData_Native(assetPtr), typeof(ovrAvatarMeshAssetDataV2));
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarAsset_GetCombinedMeshData")]
		private static extern IntPtr ovrAvatarAsset_GetCombinedMeshData_Native(IntPtr assetPtr);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarAsset_GetMeshData")]
		private static extern IntPtr ovrAvatarAsset_GetMeshData_Native(IntPtr assetPtr);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovrAvatarAsset_GetMeshBlendShapeCount(IntPtr assetPtr);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovrAvatarAsset_GetMeshBlendShapeName(IntPtr assetPtr, uint index);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovrAvatarAsset_GetSubmeshCount(IntPtr assetPtr);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovrAvatarAsset_GetSubmeshLastIndex(IntPtr assetPtr, uint index);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovrAvatarAsset_GetMeshBlendShapeVertices(IntPtr assetPtr);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovrAvatarAsset_GetAvatar(IntPtr assetHandle);

		public static ulong[] ovrAvatarAsset_GetCombinedMeshIDs(IntPtr assetHandle)
		{
			uint structure = 0u;
			IntPtr intPtr = Marshal.AllocHGlobal(Marshal.SizeOf(structure));
			IntPtr ptr = ovrAvatarAsset_GetCombinedMeshIDs_Native(assetHandle, intPtr);
			structure = (uint)Marshal.PtrToStructure(intPtr, typeof(uint));
			ulong[] array = new ulong[structure];
			for (int i = 0; i < structure; i++)
			{
				array[i] = (ulong)Marshal.ReadInt64(ptr, i * Marshal.SizeOf(typeof(ulong)));
			}
			Marshal.FreeHGlobal(intPtr);
			return array;
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarAsset_GetCombinedMeshIDs")]
		public static extern IntPtr ovrAvatarAsset_GetCombinedMeshIDs_Native(IntPtr assetHandle, IntPtr count);

		public static void ovrAvatar_GetCombinedMeshAlphaData(IntPtr avatar, ref ulong textureID, ref Vector4 offset)
		{
			IntPtr intPtr = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(ulong)));
			IntPtr intPtr2 = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(Vector4)));
			ovrAvatar_GetCombinedMeshAlphaData_Native(avatar, intPtr, intPtr2);
			textureID = (ulong)Marshal.PtrToStructure(intPtr, typeof(ulong));
			offset = (Vector4)Marshal.PtrToStructure(intPtr2, typeof(Vector4));
			Marshal.FreeHGlobal(intPtr);
			Marshal.FreeHGlobal(intPtr2);
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatar_GetCombinedMeshAlphaData")]
		public static extern IntPtr ovrAvatar_GetCombinedMeshAlphaData_Native(IntPtr avatar, IntPtr textureIDPtr, IntPtr offsetPtr);

		public static ovrAvatarTextureAssetData ovrAvatarAsset_GetTextureData(IntPtr assetPtr)
		{
			return (ovrAvatarTextureAssetData)Marshal.PtrToStructure(ovrAvatarAsset_GetTextureData_Native(assetPtr), typeof(ovrAvatarTextureAssetData));
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarAsset_GetTextureData")]
		private static extern IntPtr ovrAvatarAsset_GetTextureData_Native(IntPtr assetPtr);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarAsset_GetMaterialData")]
		private static extern IntPtr ovrAvatarAsset_GetMaterialData_Native(IntPtr assetPtr);

		public static ovrAvatarMaterialState ovrAvatarAsset_GetMaterialState(IntPtr assetPtr)
		{
			return (ovrAvatarMaterialState)Marshal.PtrToStructure(ovrAvatarAsset_GetMaterialData_Native(assetPtr), typeof(ovrAvatarMaterialState));
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ovrAvatarRenderPartType ovrAvatarRenderPart_GetType(IntPtr renderPart);

		public static ovrAvatarRenderPart_SkinnedMeshRender ovrAvatarRenderPart_GetSkinnedMeshRender(IntPtr renderPart)
		{
			return (ovrAvatarRenderPart_SkinnedMeshRender)Marshal.PtrToStructure(ovrAvatarRenderPart_GetSkinnedMeshRender_Native(renderPart), typeof(ovrAvatarRenderPart_SkinnedMeshRender));
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarRenderPart_GetSkinnedMeshRender")]
		private static extern IntPtr ovrAvatarRenderPart_GetSkinnedMeshRender_Native(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ovrAvatarTransform ovrAvatarSkinnedMeshRender_GetTransform(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ovrAvatarTransform ovrAvatarSkinnedMeshRenderPBS_GetTransform(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ovrAvatarTransform ovrAvatarSkinnedMeshRenderPBSV2_GetTransform(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ovrAvatarVisibilityFlags ovrAvatarSkinnedMeshRender_GetVisibilityMask(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovrAvatarSkinnedMeshRender_MaterialStateChanged(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovrAvatarSkinnedMeshRenderPBSV2_MaterialStateChanged(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ovrAvatarVisibilityFlags ovrAvatarSkinnedMeshRenderPBS_GetVisibilityMask(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ovrAvatarVisibilityFlags ovrAvatarSkinnedMeshRenderPBSV2_GetVisibilityMask(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ovrAvatarMaterialState ovrAvatarSkinnedMeshRender_GetMaterialState(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ovrAvatarPBSMaterialState ovrAvatarSkinnedMeshRenderPBSV2_GetPBSMaterialState(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ovrAvatarExpressiveParameters ovrAvatar_GetExpressiveParameters(IntPtr avatar);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovrAvatarSkinnedMeshRender_GetDirtyJoints(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovrAvatarSkinnedMeshRenderPBS_GetDirtyJoints(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovrAvatarSkinnedMeshRenderPBSV2_GetDirtyJoints(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ovrAvatarTransform ovrAvatarSkinnedMeshRender_GetJointTransform(IntPtr renderPart, uint jointIndex);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_SetActionUnitOnsetSpeed(IntPtr avatar, float onsetSpeed);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_SetActionUnitFalloffSpeed(IntPtr avatar, float falloffSpeed);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_SetVisemeMultiplier(IntPtr avatar, float visemeMultiplier);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ovrAvatarTransform ovrAvatarSkinnedMeshRenderPBS_GetJointTransform(IntPtr renderPart, uint jointIndex);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ovrAvatarTransform ovrAvatarSkinnedMeshRenderPBSV2_GetJointTransform(IntPtr renderPart, uint jointIndex);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovrAvatarSkinnedMeshRenderPBS_GetAlbedoTextureAssetID(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovrAvatarSkinnedMeshRenderPBS_GetSurfaceTextureAssetID(IntPtr renderPart);

		public static ovrAvatarRenderPart_SkinnedMeshRenderPBS ovrAvatarRenderPart_GetSkinnedMeshRenderPBS(IntPtr renderPart)
		{
			return (ovrAvatarRenderPart_SkinnedMeshRenderPBS)Marshal.PtrToStructure(ovrAvatarRenderPart_GetSkinnedMeshRenderPBS_Native(renderPart), typeof(ovrAvatarRenderPart_SkinnedMeshRenderPBS));
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarRenderPart_GetSkinnedMeshRenderPBS")]
		private static extern IntPtr ovrAvatarRenderPart_GetSkinnedMeshRenderPBS_Native(IntPtr renderPart);

		public static ovrAvatarRenderPart_SkinnedMeshRenderPBS_V2 ovrAvatarRenderPart_GetSkinnedMeshRenderPBSV2(IntPtr renderPart)
		{
			return (ovrAvatarRenderPart_SkinnedMeshRenderPBS_V2)Marshal.PtrToStructure(ovrAvatarRenderPart_GetSkinnedMeshRenderPBSV2_Native(renderPart), typeof(ovrAvatarRenderPart_SkinnedMeshRenderPBS_V2));
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarRenderPart_GetSkinnedMeshRenderPBSV2")]
		private static extern IntPtr ovrAvatarRenderPart_GetSkinnedMeshRenderPBSV2_Native(IntPtr renderPart);

		public static void ovrAvatarSkinnedMeshRender_GetBlendShapeParams(IntPtr renderPart, ref ovrAvatarBlendShapeParams blendParams)
		{
			IntPtr ptr = ovrAvatarSkinnedMeshRender_GetBlendShapeParams_Native(renderPart);
			blendParams.blendShapeParamCount = (uint)Marshal.ReadInt32(ptr);
			Marshal.Copy(new IntPtr(ptr.ToInt64() + ovrAvatarBlendShapeParams_Offsets.blendShapeParams), blendParams.blendShapeParams, 0, (int)blendParams.blendShapeParamCount);
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarSkinnedMeshRender_GetBlendShapeParams")]
		private static extern IntPtr ovrAvatarSkinnedMeshRender_GetBlendShapeParams_Native(IntPtr renderPart);

		public static ovrAvatarRenderPart_ProjectorRender ovrAvatarRenderPart_GetProjectorRender(IntPtr renderPart)
		{
			return (ovrAvatarRenderPart_ProjectorRender)Marshal.PtrToStructure(ovrAvatarRenderPart_GetProjectorRender_Native(renderPart), typeof(ovrAvatarRenderPart_ProjectorRender));
		}

		public static ovrAvatarPBSMaterialState[] ovrAvatar_GetBodyPBSMaterialStates(IntPtr renderPart)
		{
			IntPtr intPtr = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(uint)));
			IntPtr intPtr2 = ovrAvatar_GetBodyPBSMaterialStates_Native(renderPart, intPtr);
			ovrAvatarPBSMaterialState[] array = new ovrAvatarPBSMaterialState[Marshal.ReadInt32(intPtr)];
			for (int i = 0; i < array.Length; i++)
			{
				IntPtr ptr = new IntPtr(intPtr2.ToInt64() + i * Marshal.SizeOf(typeof(ovrAvatarPBSMaterialState)));
				array[i] = (ovrAvatarPBSMaterialState)Marshal.PtrToStructure(ptr, typeof(ovrAvatarPBSMaterialState));
			}
			Marshal.FreeHGlobal(intPtr);
			return array;
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatar_GetBodyPBSMaterialStates")]
		private static extern IntPtr ovrAvatar_GetBodyPBSMaterialStates_Native(IntPtr avatar, IntPtr count);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatarRenderPart_GetProjectorRender")]
		private static extern IntPtr ovrAvatarRenderPart_GetProjectorRender_Native(IntPtr renderPart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovrAvatar_GetReferencedAssetCount(IntPtr avatar);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern ulong ovrAvatar_GetReferencedAsset(IntPtr avatar, uint index);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_SetLeftHandGesture(IntPtr avatar, ovrAvatarHandGesture gesture);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_SetRightHandGesture(IntPtr avatar, ovrAvatarHandGesture gesture);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_SetLeftHandCustomGesture(IntPtr avatar, uint jointCount, [In] ovrAvatarTransform[] customJointTransforms);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_SetRightHandCustomGesture(IntPtr avatar, uint jointCount, [In] ovrAvatarTransform[] customJointTransforms);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_UpdatePoseFromPacket(IntPtr avatar, IntPtr packet, float secondsFromStart);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatarPacket_BeginRecording(IntPtr avatar);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovrAvatarPacket_EndRecording(IntPtr avatar);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern uint ovrAvatarPacket_GetSize(IntPtr packet);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern float ovrAvatarPacket_GetDurationSeconds(IntPtr packet);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatarPacket_Free(IntPtr packet);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern bool ovrAvatarPacket_Write(IntPtr packet, uint bufferSize, [Out] byte[] buffer);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern IntPtr ovrAvatarPacket_Read(uint bufferSize, [In] byte[] buffer);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		private static extern void ovrAvatar_SetInternalForceASTCTextures(bool value);

		public static void ovrAvatar_SetForceASTCTextures(bool value)
		{
			ovrAvatar_SetInternalForceASTCTextures(value);
		}

		public static void ovrAvatar_OverrideExpressiveLogic(IntPtr avatar, ovrAvatarBlendShapeParams blendParams)
		{
			IntPtr intPtr = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(ovrAvatarBlendShapeParams)));
			Marshal.StructureToPtr(blendParams, intPtr, fDeleteOld: false);
			ovrAvatar_OverrideExpressiveLogic_Native(avatar, intPtr);
			Marshal.FreeHGlobal(intPtr);
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatar_OverrideExpressiveLogic")]
		private static extern void ovrAvatar_OverrideExpressiveLogic_Native(IntPtr avatar, IntPtr state);

		public static void ovrAvatar_SetVisemes(IntPtr avatar, ovrAvatarVisemes visemes)
		{
			Marshal.WriteInt32(nativeVisemeData, (int)visemes.visemeParamCount);
			Marshal.Copy(visemes.visemeParams, 0, new IntPtr(nativeVisemeData.ToInt64() + ovrAvatarVisemes_Offsets.visemeParams), (int)visemes.visemeParamCount);
			ovrAvatar_SetVisemes_Native(avatar, nativeVisemeData);
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatar_SetVisemes")]
		private static extern void ovrAvatar_SetVisemes_Native(IntPtr avatar, IntPtr visemes);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_UpdateWorldTransform(IntPtr avatar, ovrAvatarTransform transform);

		public static void ovrAvatar_UpdateGazeTargets(ovrAvatarGazeTargets targets)
		{
			Marshal.WriteInt32(nativeGazeTargetsData, (int)targets.targetCount);
			long targets2 = ovrAvatarGazeTargets_Offsets.targets;
			for (uint num = 0u; num < targets.targetCount; num++)
			{
				long num2 = targets2 + num * Marshal.SizeOf(typeof(ovrAvatarGazeTarget));
				Marshal.WriteInt32(new IntPtr(nativeGazeTargetsData.ToInt64() + num2 + ovrAvatarGazeTarget_Offsets.id), (int)targets.targets[num].id);
				scratchBufferFloat[0] = targets.targets[num].worldPosition.x;
				scratchBufferFloat[1] = targets.targets[num].worldPosition.y;
				scratchBufferFloat[2] = targets.targets[num].worldPosition.z;
				Marshal.Copy(scratchBufferFloat, 0, new IntPtr(nativeGazeTargetsData.ToInt64() + num2 + ovrAvatarGazeTarget_Offsets.worldPosition), 3);
				Marshal.WriteInt32(new IntPtr(nativeGazeTargetsData.ToInt64() + num2 + ovrAvatarGazeTarget_Offsets.type), (int)targets.targets[num].type);
			}
			ovrAvatar_UpdateGazeTargets_Native(nativeGazeTargetsData);
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatar_UpdateGazeTargets")]
		private static extern void ovrAvatar_UpdateGazeTargets_Native(IntPtr targets);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_RemoveGazeTargets(uint targetCount, uint[] ids);

		public static void ovrAvatar_UpdateLights(ovrAvatarLights lights)
		{
			scratchBufferFloat[0] = lights.ambientIntensity;
			Marshal.Copy(scratchBufferFloat, 0, nativeAvatarLightsData, 1);
			Marshal.WriteInt32(new IntPtr(nativeAvatarLightsData.ToInt64() + Marshal.OffsetOf(typeof(ovrAvatarLights), "lightCount").ToInt64()), (int)lights.lightCount);
			long num = Marshal.OffsetOf(typeof(ovrAvatarLights), "lights").ToInt64();
			for (uint num2 = 0u; num2 < lights.lightCount; num2++)
			{
				long num3 = num + num2 * Marshal.SizeOf(typeof(ovrAvatarLight));
				Marshal.WriteInt32(new IntPtr(nativeAvatarLightsData.ToInt64() + num3 + Marshal.OffsetOf(typeof(ovrAvatarLight), "id").ToInt64()), (int)lights.lights[num2].id);
				Marshal.WriteInt32(new IntPtr(nativeAvatarLightsData.ToInt64() + num3 + Marshal.OffsetOf(typeof(ovrAvatarLight), "type").ToInt64()), (int)lights.lights[num2].type);
				scratchBufferFloat[0] = lights.lights[num2].intensity;
				Marshal.Copy(scratchBufferFloat, 0, new IntPtr(nativeAvatarLightsData.ToInt64() + num3 + Marshal.OffsetOf(typeof(ovrAvatarLight), "intensity").ToInt64()), 1);
				scratchBufferFloat[0] = lights.lights[num2].worldDirection.x;
				scratchBufferFloat[1] = lights.lights[num2].worldDirection.y;
				scratchBufferFloat[2] = lights.lights[num2].worldDirection.z;
				Marshal.Copy(scratchBufferFloat, 0, new IntPtr(nativeAvatarLightsData.ToInt64() + num3 + Marshal.OffsetOf(typeof(ovrAvatarLight), "worldDirection").ToInt64()), 3);
				scratchBufferFloat[0] = lights.lights[num2].worldPosition.x;
				scratchBufferFloat[1] = lights.lights[num2].worldPosition.y;
				scratchBufferFloat[2] = lights.lights[num2].worldPosition.z;
				Marshal.Copy(scratchBufferFloat, 0, new IntPtr(nativeAvatarLightsData.ToInt64() + num3 + Marshal.OffsetOf(typeof(ovrAvatarLight), "worldPosition").ToInt64()), 3);
				scratchBufferFloat[0] = lights.lights[num2].range;
				Marshal.Copy(scratchBufferFloat, 0, new IntPtr(nativeAvatarLightsData.ToInt64() + num3 + Marshal.OffsetOf(typeof(ovrAvatarLight), "range").ToInt64()), 1);
				scratchBufferFloat[0] = lights.lights[num2].spotAngleDeg;
				Marshal.Copy(scratchBufferFloat, 0, new IntPtr(nativeAvatarLightsData.ToInt64() + num3 + Marshal.OffsetOf(typeof(ovrAvatarLight), "spotAngleDeg").ToInt64()), 1);
			}
			ovrAvatar_UpdateLights_Native(nativeAvatarLightsData);
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatar_UpdateLights")]
		private static extern void ovrAvatar_UpdateLights_Native(IntPtr lights);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_RemoveLights(uint lightCount, uint[] ids);

		[MonoPInvokeCallback(typeof(LoggingDelegate))]
		public static void LoggingCallback(IntPtr str)
		{
			Marshal.PtrToStringAnsi(str);
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_RegisterLoggingCallback(LoggingDelegate callback);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_SetLoggingLevel(ovrAvatarLogLevel level);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatar_GetDebugTransforms")]
		public static extern IntPtr ovrAvatar_GetDebugTransforms_Native(IntPtr count);

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrAvatar_GetDebugLines")]
		public static extern IntPtr ovrAvatar_GetDebugLines_Native(IntPtr count);

		public static void ovrAvatar_DrawDebugLines()
		{
			IntPtr intPtr = ovrAvatar_GetDebugLines_Native(DebugLineCountData);
			int num = Marshal.ReadInt32(DebugLineCountData);
			ovrAvatarDebugLine ovrAvatarDebugLine = default(ovrAvatarDebugLine);
			for (int i = 0; i < num; i++)
			{
				int num2 = i * Marshal.SizeOf(typeof(ovrAvatarDebugLine));
				Marshal.Copy(new IntPtr(intPtr.ToInt64() + num2), scratchBufferFloat, 0, 9);
				ovrAvatarDebugLine.startPoint.x = scratchBufferFloat[0];
				ovrAvatarDebugLine.startPoint.y = scratchBufferFloat[1];
				ovrAvatarDebugLine.startPoint.z = 0f - scratchBufferFloat[2];
				ovrAvatarDebugLine.endPoint.x = scratchBufferFloat[3];
				ovrAvatarDebugLine.endPoint.y = scratchBufferFloat[4];
				ovrAvatarDebugLine.endPoint.z = 0f - scratchBufferFloat[5];
				ovrAvatarDebugLine.color.x = scratchBufferFloat[6];
				ovrAvatarDebugLine.color.y = scratchBufferFloat[7];
				ovrAvatarDebugLine.color.z = scratchBufferFloat[8];
				ovrAvatarDebugLine.context = (ovrAvatarDebugContext)Marshal.ReadInt32(new IntPtr(intPtr.ToInt64() + num2 + Marshal.OffsetOf(typeof(ovrAvatarDebugLine), "context").ToInt64()));
				ovrAvatarDebugLine.text = Marshal.ReadIntPtr(new IntPtr(intPtr.ToInt64() + num2 + Marshal.OffsetOf(typeof(ovrAvatarDebugLine), "text").ToInt64()));
				UnityEngine.Debug.DrawLine(ovrAvatarDebugLine.startPoint, ovrAvatarDebugLine.endPoint, new Color(ovrAvatarDebugLine.color.x, ovrAvatarDebugLine.color.y, ovrAvatarDebugLine.color.z));
			}
			intPtr = ovrAvatar_GetDebugTransforms_Native(DebugLineCountData);
			num = Marshal.ReadInt32(DebugLineCountData);
			ovrAvatarDebugTransform ovrAvatarDebugTransform = default(ovrAvatarDebugTransform);
			for (int j = 0; j < num; j++)
			{
				int num3 = j * Marshal.SizeOf(typeof(ovrAvatarDebugTransform));
				Marshal.Copy(new IntPtr(intPtr.ToInt64() + num3), scratchBufferFloat, 0, 10);
				OvrAvatar.ConvertTransform(scratchBufferFloat, ref ovrAvatarDebugTransform.transform);
				OvrAvatar.ConvertTransform(ovrAvatarDebugTransform.transform, debugLineGo.transform);
				ovrAvatarDebugTransform.context = (ovrAvatarDebugContext)Marshal.ReadInt32(new IntPtr(intPtr.ToInt64() + num3 + Marshal.OffsetOf(typeof(ovrAvatarDebugTransform), "context").ToInt64()));
				ovrAvatarDebugTransform.text = Marshal.ReadIntPtr(new IntPtr(intPtr.ToInt64() + num3 + Marshal.OffsetOf(typeof(ovrAvatarDebugTransform), "text").ToInt64()));
				Vector3 vector = 0.1f * debugLineGo.transform.TransformVector(Vector3.up);
				Vector3 vector2 = 0.1f * debugLineGo.transform.TransformVector(Vector3.right);
				Vector3 vector3 = 0.1f * debugLineGo.transform.TransformVector(Vector3.forward);
				UnityEngine.Debug.DrawLine(debugLineGo.transform.position, debugLineGo.transform.position + vector, Color.green);
				UnityEngine.Debug.DrawLine(debugLineGo.transform.position, debugLineGo.transform.position + vector2, Color.red);
				UnityEngine.Debug.DrawLine(debugLineGo.transform.position, debugLineGo.transform.position + vector3, Color.blue);
			}
		}

		[DllImport("ovravatarloader", CallingConvention = CallingConvention.Cdecl)]
		public static extern void ovrAvatar_SetDebugDrawContext(uint context);

		public static bool SendEvent(string name, string param = "", string source = "")
		{
			try
			{
				if (ovrPluginVersion == null)
				{
					string text = ovrp_GetVersion();
					if (!string.IsNullOrEmpty(text))
					{
						ovrPluginVersion = new Version(text.Split('-')[0]);
					}
					else
					{
						ovrPluginVersion = new Version(0, 0, 0);
					}
				}
				if (ovrPluginVersion >= OVRP_1_30_0.version)
				{
					return OVRP_1_30_0.ovrp_SendEvent2(name, param, (source.Length == 0) ? "avatar_sdk" : source) == Result.Success;
				}
				return false;
			}
			catch (Exception)
			{
				return false;
			}
		}

		[DllImport("OVRPlugin", CallingConvention = CallingConvention.Cdecl, EntryPoint = "ovrp_GetVersion")]
		private static extern IntPtr _ovrp_GetVersion();

		public static string ovrp_GetVersion()
		{
			return Marshal.PtrToStringAnsi(_ovrp_GetVersion());
		}
	}
}
namespace OVR
{
	public class TestScript : MonoBehaviour
	{
		[InspectorNote("Sound Setup", "Press '1' to play testSound1 and '2' to play testSound2")]
		public SoundFXRef testSound1;

		public SoundFXRef testSound2;

		private void Start()
		{
		}

		private void Update()
		{
			if (Input.GetKeyDown(KeyCode.Alpha1))
			{
				testSound1.PlaySoundAt(base.transform.position);
			}
			if (Input.GetKeyDown(KeyCode.Alpha2))
			{
				testSound2.PlaySoundAt(new Vector3(5f, 0f, 0f));
			}
		}
	}
	public class AmbienceEmitter : MonoBehaviour
	{
		public SoundFXRef[] ambientSounds = new SoundFXRef[0];

		public bool autoActivate = true;

		[Tooltip("Automatically play the sound randomly again when checked.  Should be OFF for looping sounds")]
		public bool autoRetrigger = true;

		[MinMax(2f, 4f, 0.1f, 10f)]
		public Vector2 randomRetriggerDelaySecs = new Vector2(2f, 4f);

		[Tooltip("If defined, the sounds will randomly play from these transform positions, otherwise the sound will play from this transform")]
		public Transform[] playPositions = new Transform[0];

		private bool activated;

		private int playingIdx = -1;

		private float nextPlayTime;

		private float fadeTime = 0.25f;

		private int lastPosIdx = -1;

		private void Awake()
		{
			if (autoActivate)
			{
				activated = true;
				nextPlayTime = Time.time + UnityEngine.Random.Range(randomRetriggerDelaySecs.x, randomRetriggerDelaySecs.y);
			}
			Transform[] array = playPositions;
			for (int i = 0; i < array.Length; i++)
			{
				if (array[i] == null)
				{
					UnityEngine.Debug.LogWarning("[AmbienceEmitter] Invalid play positions in " + base.name);
					playPositions = new Transform[0];
					break;
				}
			}
		}

		private void Update()
		{
			if (activated && (playingIdx == -1 || autoRetrigger) && Time.time >= nextPlayTime)
			{
				Play();
				if (!autoRetrigger)
				{
					activated = false;
				}
			}
		}

		public void OnTriggerEnter(Collider col)
		{
			activated = !activated;
		}

		public void Play()
		{
			Transform transform = base.transform;
			if (playPositions.Length != 0)
			{
				int num = UnityEngine.Random.Range(0, playPositions.Length);
				while (playPositions.Length > 1 && num == lastPosIdx)
				{
					num = UnityEngine.Random.Range(0, playPositions.Length);
				}
				transform = playPositions[num];
				lastPosIdx = num;
			}
			playingIdx = ambientSounds[UnityEngine.Random.Range(0, ambientSounds.Length)].PlaySoundAt(transform.position);
			if (playingIdx != -1)
			{
				AudioManager.FadeInSound(playingIdx, fadeTime);
				nextPlayTime = Time.time + UnityEngine.Random.Range(randomRetriggerDelaySecs.x, randomRetriggerDelaySecs.y);
			}
		}

		public void EnableEmitter(bool enable)
		{
			activated = enable;
			if (enable)
			{
				Play();
			}
			else if (playingIdx != -1)
			{
				AudioManager.FadeOutSound(playingIdx, fadeTime);
			}
		}
	}
	public enum PreloadSounds
	{
		Default,
		Preload,
		ManualPreload
	}
	public enum Fade
	{
		In,
		Out
	}
	[Serializable]
	public class SoundGroup
	{
		public string name = string.Empty;

		public SoundFX[] soundList = new SoundFX[0];

		public AudioMixerGroup mixerGroup;

		[Range(0f, 64f)]
		public int maxPlayingSounds;

		public PreloadSounds preloadAudio;

		public float volumeOverride = 1f;

		[HideInInspector]
		public int playingSoundCount;

		public SoundGroup(string name)
		{
			this.name = name;
		}

		public SoundGroup()
		{
			mixerGroup = null;
			maxPlayingSounds = 0;
			preloadAudio = PreloadSounds.Default;
			volumeOverride = 1f;
		}

		public void IncrementPlayCount()
		{
			playingSoundCount = Mathf.Clamp(++playingSoundCount, 0, maxPlayingSounds);
		}

		public void DecrementPlayCount()
		{
			playingSoundCount = Mathf.Clamp(--playingSoundCount, 0, maxPlayingSounds);
		}

		public bool CanPlaySound()
		{
			if (maxPlayingSounds != 0)
			{
				return playingSoundCount < maxPlayingSounds;
			}
			return true;
		}
	}
	public class AudioManager : MonoBehaviour
	{
		public enum Fade
		{
			In,
			Out
		}

		[Tooltip("Make the audio manager persistent across all scene loads")]
		public bool makePersistent = true;

		[Tooltip("Enable the OSP audio plugin features")]
		public bool enableSpatializedAudio = true;

		[Tooltip("Always play spatialized sounds with no reflections (Default)")]
		public bool enableSpatializedFastOverride;

		[Tooltip("The audio mixer asset used for snapshot blends, etc.")]
		public AudioMixer audioMixer;

		[Tooltip("The audio mixer group used for the pooled emitters")]
		public AudioMixerGroup defaultMixerGroup;

		[Tooltip("The audio mixer group used for the reserved pool emitter")]
		public AudioMixerGroup reservedMixerGroup;

		[Tooltip("The audio mixer group used for voice chat")]
		public AudioMixerGroup voiceChatMixerGroup;

		[Tooltip("Log all PlaySound calls to the Unity console")]
		public bool verboseLogging;

		[Tooltip("Maximum sound emitters")]
		public int maxSoundEmitters = 32;

		[Tooltip("Default volume for all sounds modulated by individual sound FX volumes")]
		public float volumeSoundFX = 1f;

		[Tooltip("Sound FX fade time")]
		public float soundFxFadeSecs = 1f;

		public float audioMinFallOffDistance = 1f;

		public float audioMaxFallOffDistance = 25f;

		public SoundGroup[] soundGroupings = new SoundGroup[0];

		private Dictionary<string, SoundFX> soundFXCache;

		private static AudioManager theAudioManager = null;

		private static FastList<string> names = new FastList<string>();

		private static string[] defaultSound = new string[1] { "Default Sound" };

		private static SoundFX nullSound = new SoundFX();

		private static bool hideWarnings = false;

		private float audioMaxFallOffDistanceSqr = 625f;

		private SoundEmitter[] soundEmitters;

		private FastList<SoundEmitter> playingEmitters = new FastList<SoundEmitter>();

		private FastList<SoundEmitter> nextFreeEmitters = new FastList<SoundEmitter>();

		private MixerSnapshot currentSnapshot;

		private static GameObject soundEmitterParent = null;

		private static Transform staticListenerPosition = null;

		private static bool showPlayingEmitterCount = false;

		private static bool forceShowEmitterCount = false;

		private static bool soundEnabled = true;

		private static readonly AnimationCurve defaultReverbZoneMix = new AnimationCurve(new Keyframe(0f, 1f), new Keyframe(1f, 1f));

		public static bool enableSpatialization
		{
			get
			{
				if (!(theAudioManager != null))
				{
					return false;
				}
				return theAudioManager.enableSpatializedAudio;
			}
		}

		public static AudioManager Instance => theAudioManager;

		public static float NearFallOff => theAudioManager.audioMinFallOffDistance;

		public static float FarFallOff => theAudioManager.audioMaxFallOffDistance;

		public static AudioMixerGroup EmitterGroup => theAudioManager.defaultMixerGroup;

		public static AudioMixerGroup ReservedGroup => theAudioManager.reservedMixerGroup;

		public static AudioMixerGroup VoipGroup => theAudioManager.voiceChatMixerGroup;

		public static bool SoundEnabled => soundEnabled;

		private void Awake()
		{
			Init();
		}

		private void OnDestroy()
		{
			if (theAudioManager == this && soundEmitterParent != null)
			{
				UnityEngine.Object.Destroy(soundEmitterParent);
			}
		}

		private void Init()
		{
			if (theAudioManager != null)
			{
				if (UnityEngine.Application.isPlaying && theAudioManager != this)
				{
					base.enabled = false;
				}
				return;
			}
			theAudioManager = this;
			nullSound.name = "Default Sound";
			RebuildSoundFXCache();
			if (UnityEngine.Application.isPlaying)
			{
				InitializeSoundSystem();
				if (makePersistent && base.transform.parent == null)
				{
					UnityEngine.Object.DontDestroyOnLoad(base.gameObject);
				}
			}
		}

		private void Update()
		{
			UpdateFreeEmitters();
		}

		private void RebuildSoundFXCache()
		{
			int num = 0;
			for (int i = 0; i < soundGroupings.Length; i++)
			{
				num += soundGroupings[i].soundList.Length;
			}
			soundFXCache = new Dictionary<string, SoundFX>(num + 1);
			soundFXCache.Add(nullSound.name, nullSound);
			for (int j = 0; j < soundGroupings.Length; j++)
			{
				for (int k = 0; k < soundGroupings[j].soundList.Length; k++)
				{
					if (soundFXCache.ContainsKey(soundGroupings[j].soundList[k].name))
					{
						UnityEngine.Debug.LogError("ERROR: Duplicate Sound FX name in the audio manager: '" + soundGroupings[j].name + "' > '" + soundGroupings[j].soundList[k].name + "'");
					}
					else
					{
						soundGroupings[j].soundList[k].Group = soundGroupings[j];
						soundFXCache.Add(soundGroupings[j].soundList[k].name, soundGroupings[j].soundList[k]);
					}
				}
				soundGroupings[j].playingSoundCount = 0;
			}
		}

		public static SoundFX FindSoundFX(string name, bool rebuildCache = false)
		{
			if (string.IsNullOrEmpty(name))
			{
				return nullSound;
			}
			if (rebuildCache)
			{
				theAudioManager.RebuildSoundFXCache();
			}
			if (!theAudioManager.soundFXCache.ContainsKey(name))
			{
				return nullSound;
			}
			return theAudioManager.soundFXCache[name];
		}

		private static bool FindAudioManager()
		{
			GameObject gameObject = GameObject.Find("AudioManager");
			if (gameObject == null || gameObject.GetComponent<AudioManager>() == null)
			{
				if (!hideWarnings)
				{
					UnityEngine.Debug.LogError("[ERROR] AudioManager object missing from hierarchy!");
					hideWarnings = true;
				}
				return false;
			}
			gameObject.GetComponent<AudioManager>().Init();
			return true;
		}

		public static GameObject GetGameObject()
		{
			if (theAudioManager == null && !FindAudioManager())
			{
				return null;
			}
			return theAudioManager.gameObject;
		}

		public static string NameMinusGroup(string name)
		{
			if (name.IndexOf("/") > -1)
			{
				return name.Substring(name.IndexOf("/") + 1);
			}
			return name;
		}

		public static string[] GetSoundFXNames(string currentValue, out int currentIdx)
		{
			currentIdx = 0;
			names.Clear();
			if (theAudioManager == null && !FindAudioManager())
			{
				return defaultSound;
			}
			names.Add(nullSound.name);
			for (int i = 0; i < theAudioManager.soundGroupings.Length; i++)
			{
				for (int j = 0; j < theAudioManager.soundGroupings[i].soundList.Length; j++)
				{
					if (string.Compare(currentValue, theAudioManager.soundGroupings[i].soundList[j].name, ignoreCase: true) == 0)
					{
						currentIdx = names.Count;
					}
					names.Add(theAudioManager.soundGroupings[i].name + "/" + theAudioManager.soundGroupings[i].soundList[j].name);
				}
			}
			return names.ToArray();
		}

		private void InitializeSoundSystem()
		{
			int bufferLength = 960;
			int numBuffers = 4;
			AudioSettings.GetDSPBufferSize(out bufferLength, out numBuffers);
			if (UnityEngine.Application.isPlaying)
			{
				UnityEngine.Debug.Log("[AudioManager] Audio Sample Rate: " + AudioSettings.outputSampleRate);
				UnityEngine.Debug.Log("[AudioManager] Audio Buffer Length: " + bufferLength + " Size: " + numBuffers);
			}
			AudioListener audioListener = UnityEngine.Object.FindObjectOfType<AudioListener>();
			if (audioListener == null)
			{
				UnityEngine.Debug.LogError("[AudioManager] Missing AudioListener object!  Add one to the scene.");
			}
			else
			{
				staticListenerPosition = audioListener.transform;
			}
			soundEmitters = new SoundEmitter[maxSoundEmitters + 1];
			soundEmitterParent = GameObject.Find("__SoundEmitters__");
			if (soundEmitterParent != null)
			{
				UnityEngine.Object.Destroy(soundEmitterParent);
			}
			soundEmitterParent = new GameObject("__SoundEmitters__");
			for (int i = 0; i < maxSoundEmitters + 1; i++)
			{
				GameObject gameObject = new GameObject("SoundEmitter_" + i);
				gameObject.transform.parent = soundEmitterParent.transform;
				gameObject.transform.position = Vector3.zero;
				gameObject.hideFlags = HideFlags.DontSaveInEditor;
				soundEmitters[i] = gameObject.AddComponent<SoundEmitter>();
				soundEmitters[i].SetDefaultParent(soundEmitterParent.transform);
				soundEmitters[i].SetChannel(i);
				soundEmitters[i].Stop();
				soundEmitters[i].originalIdx = i;
			}
			ResetFreeEmitters();
			soundEmitterParent.hideFlags = HideFlags.DontSaveInEditor;
			audioMaxFallOffDistanceSqr = audioMaxFallOffDistance * audioMaxFallOffDistance;
		}

		private void UpdateFreeEmitters()
		{
			if (verboseLogging)
			{
				if (Input.GetKeyDown(KeyCode.A))
				{
					forceShowEmitterCount = !forceShowEmitterCount;
				}
				if (forceShowEmitterCount)
				{
					showPlayingEmitterCount = true;
				}
			}
			int num = 0;
			int num2 = 0;
			int num3 = 0;
			int num4 = 0;
			int num5 = 0;
			int num6 = 0;
			int num7 = 0;
			while (num7 < playingEmitters.size)
			{
				if (playingEmitters[num7] == null)
				{
					UnityEngine.Debug.LogError("[AudioManager] ERROR: playingEmitters list had a null emitter! Something nuked a sound emitter!!!");
					playingEmitters.RemoveAtFast(num7);
					return;
				}
				if (!playingEmitters[num7].IsPlaying())
				{
					if (verboseLogging && nextFreeEmitters.Contains(playingEmitters[num7]))
					{
						UnityEngine.Debug.LogError("[AudioManager] ERROR: playing sound emitter already in the free emitters list!");
					}
					playingEmitters[num7].Stop();
					nextFreeEmitters.Add(playingEmitters[num7]);
					playingEmitters.RemoveAtFast(num7);
					continue;
				}
				if (verboseLogging && showPlayingEmitterCount)
				{
					num++;
					switch (playingEmitters[num7].priority)
					{
					case SoundPriority.VeryLow:
						num2++;
						break;
					case SoundPriority.Low:
						num3++;
						break;
					case SoundPriority.Default:
						num4++;
						break;
					case SoundPriority.High:
						num5++;
						break;
					case SoundPriority.VeryHigh:
						num6++;
						break;
					}
				}
				num7++;
			}
			if (verboseLogging && showPlayingEmitterCount)
			{
				UnityEngine.Debug.LogWarning($"[AudioManager] Playing sounds: Total {Fmt(num)} | VeryLow {Fmt(num2)} | Low {Fmt(num3)} | Default {Fmt(num4)} | High {Fmt(num5)} | VeryHigh {Fmt(num6)} | Free {FmtFree(nextFreeEmitters.Count)}");
				showPlayingEmitterCount = false;
			}
		}

		private string Fmt(int count)
		{
			float num = (float)count / (float)theAudioManager.maxSoundEmitters;
			if (num < 0.5f)
			{
				return "<color=green>" + count + "</color>";
			}
			if ((double)num < 0.7)
			{
				return "<color=yellow>" + count + "</color>";
			}
			return "<color=red>" + count + "</color>";
		}

		private string FmtFree(int count)
		{
			float num = (float)count / (float)theAudioManager.maxSoundEmitters;
			if (num < 0.2f)
			{
				return "<color=red>" + count + "</color>";
			}
			if ((double)num < 0.3)
			{
				return "<color=yellow>" + count + "</color>";
			}
			return "<color=green>" + count + "</color>";
		}

		private void OnPreSceneLoad()
		{
			UnityEngine.Debug.Log("[AudioManager] OnPreSceneLoad cleanup");
			for (int i = 0; i < soundEmitters.Length; i++)
			{
				soundEmitters[i].Stop();
				soundEmitters[i].ResetParent(soundEmitterParent.transform);
			}
			ResetFreeEmitters();
		}

		private void ResetFreeEmitters()
		{
			nextFreeEmitters.Clear();
			playingEmitters.Clear();
			for (int i = 1; i < soundEmitters.Length; i++)
			{
				nextFreeEmitters.Add(soundEmitters[i]);
			}
		}

		public static void FadeOutSoundChannel(int channel, float delaySecs, float fadeTime)
		{
			theAudioManager.soundEmitters[channel].FadeOutDelayed(delaySecs, fadeTime);
		}

		public static bool StopSound(int idx, bool fadeOut = true, bool stopReserved = false)
		{
			if (!stopReserved && idx == 0)
			{
				return false;
			}
			if (!fadeOut)
			{
				theAudioManager.soundEmitters[idx].Stop();
			}
			else
			{
				theAudioManager.soundEmitters[idx].FadeOut(theAudioManager.soundFxFadeSecs);
			}
			return true;
		}

		public static void FadeInSound(int idx, float fadeTime, float volume)
		{
			theAudioManager.soundEmitters[idx].FadeIn(fadeTime, volume);
		}

		public static void FadeInSound(int idx, float fadeTime)
		{
			theAudioManager.soundEmitters[idx].FadeIn(fadeTime);
		}

		public static void FadeOutSound(int idx, float fadeTime)
		{
			theAudioManager.soundEmitters[idx].FadeOut(fadeTime);
		}

		public static void StopAllSounds(bool fadeOut, bool stopReserved = false)
		{
			for (int i = 0; i < theAudioManager.soundEmitters.Length; i++)
			{
				StopSound(i, fadeOut, stopReserved);
			}
		}

		public void MuteAllSounds(bool mute, bool muteReserved = false)
		{
			for (int i = 0; i < soundEmitters.Length; i++)
			{
				if (muteReserved || i != 0)
				{
					soundEmitters[i].audioSource.mute = true;
				}
			}
		}

		public void UnMuteAllSounds(bool unmute, bool unmuteReserved = false)
		{
			for (int i = 0; i < soundEmitters.Length; i++)
			{
				if ((unmuteReserved || i != 0) && soundEmitters[i].audioSource.isPlaying)
				{
					soundEmitters[i].audioSource.mute = false;
				}
			}
		}

		public static float GetEmitterEndTime(int idx)
		{
			return theAudioManager.soundEmitters[idx].endPlayTime;
		}

		public static float SetEmitterTime(int idx, float time)
		{
			return theAudioManager.soundEmitters[idx].time = time;
		}

		public static int PlaySound(AudioClip clip, float volume, EmitterChannel src = EmitterChannel.Any, float delay = 0f, float pitchVariance = 1f, bool loop = false)
		{
			if (!SoundEnabled)
			{
				return -1;
			}
			return PlaySoundAt((staticListenerPosition != null) ? staticListenerPosition.position : Vector3.zero, clip, volume, src, delay, pitchVariance, loop);
		}

		private static int FindFreeEmitter(EmitterChannel src, SoundPriority priority)
		{
			SoundEmitter soundEmitter = theAudioManager.soundEmitters[0];
			if (src == EmitterChannel.Any)
			{
				if (theAudioManager.nextFreeEmitters.size > 0)
				{
					soundEmitter = theAudioManager.nextFreeEmitters[0];
					theAudioManager.nextFreeEmitters.RemoveAtFast(0);
				}
				else
				{
					if (priority == SoundPriority.VeryLow)
					{
						return -1;
					}
					soundEmitter = theAudioManager.playingEmitters.Find((SoundEmitter item) => item != null && item.priority < priority);
					if (soundEmitter == null)
					{
						if (priority < SoundPriority.Default)
						{
							if (theAudioManager.verboseLogging)
							{
								UnityEngine.Debug.LogWarning("[AudioManager] skipping sound " + priority);
							}
							return -1;
						}
						soundEmitter = theAudioManager.playingEmitters.Find((SoundEmitter item) => item != null && item.priority <= SoundPriority.Default);
					}
					if (soundEmitter != null)
					{
						if (theAudioManager.verboseLogging)
						{
							UnityEngine.Debug.LogWarning("[AudioManager] cannabalizing " + soundEmitter.originalIdx + " Time: " + Time.time);
						}
						soundEmitter.Stop();
						theAudioManager.playingEmitters.RemoveFast(soundEmitter);
					}
				}
			}
			if (soundEmitter == null)
			{
				UnityEngine.Debug.LogError(string.Concat("[AudioManager] ERROR - absolutely couldn't find a free emitter! Priority = ", priority, " TOO MANY PlaySound* calls!"));
				showPlayingEmitterCount = true;
				return -1;
			}
			return soundEmitter.originalIdx;
		}

		public static int PlaySound(SoundFX soundFX, EmitterChannel src = EmitterChannel.Any, float delay = 0f)
		{
			if (!SoundEnabled)
			{
				return -1;
			}
			return PlaySoundAt((staticListenerPosition != null) ? staticListenerPosition.position : Vector3.zero, soundFX, src, delay);
		}

		public static int PlaySoundAt(Vector3 position, SoundFX soundFX, EmitterChannel src = EmitterChannel.Any, float delay = 0f, float volumeOverride = 1f, float pitchMultiplier = 1f)
		{
			if (!SoundEnabled)
			{
				return -1;
			}
			AudioClip clip = soundFX.GetClip();
			if (clip == null)
			{
				return -1;
			}
			if (staticListenerPosition != null)
			{
				float sqrMagnitude = (staticListenerPosition.position - position).sqrMagnitude;
				if (sqrMagnitude > theAudioManager.audioMaxFallOffDistanceSqr)
				{
					return -1;
				}
				if (sqrMagnitude > soundFX.MaxFalloffDistSquared)
				{
					return -1;
				}
			}
			if (soundFX.ReachedGroupPlayLimit())
			{
				if (theAudioManager.verboseLogging)
				{
					UnityEngine.Debug.Log("[AudioManager] PlaySoundAt() with " + soundFX.name + " skipped due to group play limit");
				}
				return -1;
			}
			int num = FindFreeEmitter(src, soundFX.priority);
			if (num == -1)
			{
				return -1;
			}
			SoundEmitter soundEmitter = theAudioManager.soundEmitters[num];
			soundEmitter.ResetParent(soundEmitterParent.transform);
			soundEmitter.gameObject.SetActive(value: true);
			AudioSource source = soundEmitter.audioSource;
			ONSPAudioSource osp = soundEmitter.osp;
			source.enabled = true;
			source.volume = Mathf.Clamp01(Mathf.Clamp01(theAudioManager.volumeSoundFX * soundFX.volume) * volumeOverride * soundFX.GroupVolumeOverride);
			source.pitch = soundFX.GetPitch() * pitchMultiplier;
			source.time = 0f;
			source.spatialBlend = 1f;
			source.rolloffMode = soundFX.falloffCurve;
			if (soundFX.falloffCurve == AudioRolloffMode.Custom)
			{
				source.SetCustomCurve(AudioSourceCurveType.CustomRolloff, soundFX.volumeFalloffCurve);
			}
			source.SetCustomCurve(AudioSourceCurveType.ReverbZoneMix, soundFX.reverbZoneMix);
			source.dopplerLevel = 0f;
			source.clip = clip;
			source.spread = soundFX.spread;
			source.loop = soundFX.looping;
			source.mute = false;
			source.minDistance = soundFX.falloffDistance.x;
			source.maxDistance = soundFX.falloffDistance.y;
			source.outputAudioMixerGroup = soundFX.GetMixerGroup(EmitterGroup);
			soundEmitter.endPlayTime = Time.time + clip.length + delay;
			soundEmitter.defaultVolume = source.volume;
			soundEmitter.priority = soundFX.priority;
			soundEmitter.onFinished = null;
			soundEmitter.SetPlayingSoundGroup(soundFX.Group);
			if (src == EmitterChannel.Any)
			{
				theAudioManager.playingEmitters.AddUnique(soundEmitter);
			}
			if (osp != null)
			{
				osp.EnableSpatialization = soundFX.ospProps.enableSpatialization;
				osp.EnableRfl = ((theAudioManager.enableSpatializedFastOverride || soundFX.ospProps.useFastOverride) ? true : false);
				osp.Gain = soundFX.ospProps.gain;
				osp.UseInvSqr = soundFX.ospProps.enableInvSquare;
				osp.Near = soundFX.ospProps.invSquareFalloff.x;
				osp.Far = soundFX.ospProps.invSquareFalloff.y;
				source.spatialBlend = (soundFX.ospProps.enableSpatialization ? 1f : 0.8f);
				osp.SetParameters(ref source);
			}
			source.transform.position = position;
			if (theAudioManager.verboseLogging)
			{
				UnityEngine.Debug.Log("[AudioManager] PlaySoundAt() channel = " + num + " soundFX = " + soundFX.name + " volume = " + soundEmitter.volume + " Delay = " + delay + " time = " + Time.time + "\n");
			}
			if (delay > 0f)
			{
				source.PlayDelayed(delay);
			}
			else
			{
				source.Play();
			}
			return num;
		}

		public static int PlayRandomSoundAt(Vector3 position, AudioClip[] clips, float volume, EmitterChannel src = EmitterChannel.Any, float delay = 0f, float pitch = 1f, bool loop = false)
		{
			if (clips == null || clips.Length == 0)
			{
				return -1;
			}
			int num = UnityEngine.Random.Range(0, clips.Length);
			return PlaySoundAt(position, clips[num], volume, src, delay, pitch, loop);
		}

		public static int PlaySoundAt(Vector3 position, AudioClip clip, float volume = 1f, EmitterChannel src = EmitterChannel.Any, float delay = 0f, float pitch = 1f, bool loop = false)
		{
			if (!SoundEnabled)
			{
				return -1;
			}
			if (clip == null)
			{
				return -1;
			}
			if (staticListenerPosition != null && (staticListenerPosition.position - position).sqrMagnitude > theAudioManager.audioMaxFallOffDistanceSqr)
			{
				return -1;
			}
			int num = FindFreeEmitter(src, SoundPriority.Default);
			if (num == -1)
			{
				return -1;
			}
			SoundEmitter soundEmitter = theAudioManager.soundEmitters[num];
			soundEmitter.ResetParent(soundEmitterParent.transform);
			soundEmitter.gameObject.SetActive(value: true);
			AudioSource audioSource = soundEmitter.audioSource;
			ONSPAudioSource osp = soundEmitter.osp;
			audioSource.enabled = true;
			audioSource.volume = Mathf.Clamp01(theAudioManager.volumeSoundFX * volume);
			audioSource.pitch = pitch;
			audioSource.spatialBlend = 0.8f;
			audioSource.rolloffMode = AudioRolloffMode.Linear;
			audioSource.SetCustomCurve(AudioSourceCurveType.ReverbZoneMix, defaultReverbZoneMix);
			audioSource.dopplerLevel = 0f;
			audioSource.clip = clip;
			audioSource.spread = 0f;
			audioSource.loop = loop;
			audioSource.mute = false;
			audioSource.minDistance = theAudioManager.audioMinFallOffDistance;
			audioSource.maxDistance = theAudioManager.audioMaxFallOffDistance;
			audioSource.outputAudioMixerGroup = EmitterGroup;
			soundEmitter.endPlayTime = Time.time + clip.length + delay;
			soundEmitter.defaultVolume = audioSource.volume;
			soundEmitter.priority = SoundPriority.Default;
			soundEmitter.onFinished = null;
			soundEmitter.SetPlayingSoundGroup(null);
			if (src == EmitterChannel.Any)
			{
				theAudioManager.playingEmitters.AddUnique(soundEmitter);
			}
			if (osp != null)
			{
				osp.EnableSpatialization = false;
			}
			audioSource.transform.position = position;
			if (theAudioManager.verboseLogging)
			{
				UnityEngine.Debug.Log("[AudioManager] PlaySoundAt() channel = " + num + " clip = " + clip.name + " volume = " + soundEmitter.volume + " Delay = " + delay + " time = " + Time.time + "\n");
			}
			if (delay > 0f)
			{
				audioSource.PlayDelayed(delay);
			}
			else
			{
				audioSource.Play();
			}
			return num;
		}

		public static void SetOnFinished(int emitterIdx, Action onFinished)
		{
			if (emitterIdx >= 0 && emitterIdx < theAudioManager.maxSoundEmitters)
			{
				theAudioManager.soundEmitters[emitterIdx].SetOnFinished(onFinished);
			}
		}

		public static void SetOnFinished(int emitterIdx, Action<object> onFinished, object obj)
		{
			if (emitterIdx >= 0 && emitterIdx < theAudioManager.maxSoundEmitters)
			{
				theAudioManager.soundEmitters[emitterIdx].SetOnFinished(onFinished, obj);
			}
		}

		public static void AttachSoundToParent(int idx, Transform parent)
		{
			if (theAudioManager.verboseLogging)
			{
				string text = parent.name;
				if (parent.parent != null)
				{
					text = parent.parent.name + "/" + text;
				}
				UnityEngine.Debug.Log("[AudioManager] ATTACHING INDEX " + idx + " to " + text);
			}
			theAudioManager.soundEmitters[idx].ParentTo(parent);
		}

		public static void DetachSoundFromParent(int idx)
		{
			if (theAudioManager.verboseLogging)
			{
				UnityEngine.Debug.Log("[AudioManager] DETACHING INDEX " + idx);
			}
			theAudioManager.soundEmitters[idx].DetachFromParent();
		}

		public static void DetachSoundsFromParent(SoundEmitter[] emitters, bool stopSounds = true)
		{
			if (emitters == null)
			{
				return;
			}
			foreach (SoundEmitter soundEmitter in emitters)
			{
				if (soundEmitter.defaultParent != null)
				{
					if (stopSounds)
					{
						soundEmitter.Stop();
					}
					soundEmitter.DetachFromParent();
					soundEmitter.gameObject.SetActive(value: true);
				}
				else if (stopSounds)
				{
					soundEmitter.Stop();
				}
			}
		}

		public static void SetEmitterMixerGroup(int idx, AudioMixerGroup mixerGroup)
		{
			if (theAudioManager != null && idx > -1)
			{
				theAudioManager.soundEmitters[idx].SetAudioMixer(mixerGroup);
			}
		}

		public static MixerSnapshot GetActiveSnapshot()
		{
			if (!(theAudioManager != null))
			{
				return null;
			}
			return theAudioManager.currentSnapshot;
		}

		public static void SetCurrentSnapshot(MixerSnapshot mixerSnapshot)
		{
			if (theAudioManager != null)
			{
				if (mixerSnapshot != null && mixerSnapshot.snapshot != null)
				{
					mixerSnapshot.snapshot.TransitionTo(mixerSnapshot.transitionTime);
				}
				else
				{
					mixerSnapshot = null;
				}
				theAudioManager.currentSnapshot = mixerSnapshot;
			}
		}

		public static void BlendWithCurrentSnapshot(MixerSnapshot blendSnapshot, float weight, float blendTime = 0f)
		{
			if (!(theAudioManager != null))
			{
				return;
			}
			if (theAudioManager.audioMixer == null)
			{
				UnityEngine.Debug.LogWarning("[AudioManager] can't call BlendWithCurrentSnapshot if the audio mixer is not set!");
				return;
			}
			if (blendTime == 0f)
			{
				blendTime = Time.deltaTime;
			}
			if (theAudioManager.currentSnapshot != null && theAudioManager.currentSnapshot.snapshot != null && blendSnapshot != null && blendSnapshot.snapshot != null)
			{
				weight = Mathf.Clamp01(weight);
				if (weight == 0f)
				{
					theAudioManager.currentSnapshot.snapshot.TransitionTo(blendTime);
					return;
				}
				AudioMixerSnapshot[] snapshots = new AudioMixerSnapshot[2]
				{
					theAudioManager.currentSnapshot.snapshot,
					blendSnapshot.snapshot
				};
				float[] weights = new float[2]
				{
					1f - weight,
					weight
				};
				theAudioManager.audioMixer.TransitionToSnapshots(snapshots, weights, blendTime);
			}
		}
	}
	public enum EmitterChannel
	{
		None = -1,
		Reserved,
		Any
	}
	[Serializable]
	public class MixerSnapshot
	{
		public AudioMixerSnapshot snapshot;

		public float transitionTime = 0.25f;
	}
	public class MinMaxAttribute : PropertyAttribute
	{
		public float minDefaultVal = 1f;

		public float maxDefaultVal = 1f;

		public float min;

		public float max = 1f;

		public MinMaxAttribute(float minDefaultVal, float maxDefaultVal, float min, float max)
		{
			this.minDefaultVal = minDefaultVal;
			this.maxDefaultVal = maxDefaultVal;
			this.min = min;
			this.max = max;
		}
	}
	public class SoundEmitter : MonoBehaviour
	{
		public enum FadeState
		{
			Null,
			FadingIn,
			FadingOut,
			Ducking
		}

		public EmitterChannel channel;

		public bool disableSpatialization;

		private FadeState state;

		[NonSerialized]
		[HideInInspector]
		public AudioSource audioSource;

		[NonSerialized]
		[HideInInspector]
		public SoundPriority priority;

		[NonSerialized]
		[HideInInspector]
		public ONSPAudioSource osp;

		[NonSerialized]
		[HideInInspector]
		public float endPlayTime;

		private Transform lastParentTransform;

		[NonSerialized]
		[HideInInspector]
		public float defaultVolume = 1f;

		[NonSerialized]
		[HideInInspector]
		public Transform defaultParent;

		[NonSerialized]
		[HideInInspector]
		public int originalIdx = -1;

		[NonSerialized]
		[HideInInspector]
		public Action onFinished;

		[NonSerialized]
		[HideInInspector]
		public Action<object> onFinishedObject;

		[NonSerialized]
		[HideInInspector]
		public object onFinishedParam;

		[NonSerialized]
		[HideInInspector]
		public SoundGroup playingSoundGroup;

		public float volume
		{
			get
			{
				return audioSource.volume;
			}
			set
			{
				audioSource.volume = value;
			}
		}

		public float pitch
		{
			get
			{
				return audioSource.pitch;
			}
			set
			{
				audioSource.pitch = value;
			}
		}

		public AudioClip clip
		{
			get
			{
				return audioSource.clip;
			}
			set
			{
				audioSource.clip = value;
			}
		}

		public float time
		{
			get
			{
				return audioSource.time;
			}
			set
			{
				audioSource.time = value;
			}
		}

		public float length
		{
			get
			{
				if (!(audioSource.clip != null))
				{
					return 0f;
				}
				return audioSource.clip.length;
			}
		}

		public bool loop
		{
			get
			{
				return audioSource.loop;
			}
			set
			{
				audioSource.loop = value;
			}
		}

		public bool mute
		{
			get
			{
				return audioSource.mute;
			}
			set
			{
				audioSource.mute = value;
			}
		}

		public AudioVelocityUpdateMode velocityUpdateMode
		{
			get
			{
				return audioSource.velocityUpdateMode;
			}
			set
			{
				audioSource.velocityUpdateMode = value;
			}
		}

		public bool isPlaying => audioSource.isPlaying;

		private void Awake()
		{
			audioSource = GetComponent<AudioSource>();
			if (audioSource == null)
			{
				audioSource = base.gameObject.AddComponent<AudioSource>();
			}
			if (AudioManager.enableSpatialization && !disableSpatialization)
			{
				osp = GetComponent<ONSPAudioSource>();
				if (osp == null)
				{
					osp = base.gameObject.AddComponent<ONSPAudioSource>();
				}
			}
			audioSource.playOnAwake = false;
			audioSource.Stop();
		}

		public void SetPlayingSoundGroup(SoundGroup soundGroup)
		{
			playingSoundGroup = soundGroup;
			soundGroup?.IncrementPlayCount();
		}

		public void SetOnFinished(Action onFinished)
		{
			this.onFinished = onFinished;
		}

		public void SetOnFinished(Action<object> onFinished, object obj)
		{
			onFinishedObject = onFinished;
			onFinishedParam = obj;
		}

		public void SetChannel(int _channel)
		{
			channel = (EmitterChannel)_channel;
		}

		public void SetDefaultParent(Transform parent)
		{
			defaultParent = parent;
		}

		public void SetAudioMixer(AudioMixerGroup _mixer)
		{
			if (audioSource != null)
			{
				audioSource.outputAudioMixerGroup = _mixer;
			}
		}

		public bool IsPlaying()
		{
			if (loop && audioSource.isPlaying)
			{
				return true;
			}
			return endPlayTime > Time.time;
		}

		public void Play()
		{
			state = FadeState.Null;
			endPlayTime = Time.time + length;
			StopAllCoroutines();
			audioSource.Play();
		}

		public void Pause()
		{
			state = FadeState.Null;
			StopAllCoroutines();
			audioSource.Pause();
		}

		public void Stop()
		{
			state = FadeState.Null;
			StopAllCoroutines();
			if (audioSource != null)
			{
				audioSource.Stop();
			}
			if (onFinished != null)
			{
				onFinished();
				onFinished = null;
			}
			if (onFinishedObject != null)
			{
				onFinishedObject(onFinishedParam);
				onFinishedObject = null;
			}
			if (playingSoundGroup != null)
			{
				playingSoundGroup.DecrementPlayCount();
				playingSoundGroup = null;
			}
		}

		private int GetSampleTime()
		{
			return audioSource.clip.samples - audioSource.timeSamples;
		}

		public void ParentTo(Transform parent)
		{
			if (lastParentTransform != null)
			{
				UnityEngine.Debug.LogError("[SoundEmitter] You must detach the sound emitter before parenting to another object!");
				return;
			}
			lastParentTransform = base.transform.parent;
			base.transform.parent = parent;
		}

		public void DetachFromParent()
		{
			if (lastParentTransform == null)
			{
				base.transform.parent = defaultParent;
				return;
			}
			base.transform.parent = lastParentTransform;
			lastParentTransform = null;
		}

		public void ResetParent(Transform parent)
		{
			base.transform.parent = parent;
			lastParentTransform = null;
		}

		public void SyncTo(SoundEmitter other, float fadeTime, float toVolume)
		{
			StartCoroutine(DelayedSyncTo(other, fadeTime, toVolume));
		}

		private IEnumerator DelayedSyncTo(SoundEmitter other, float fadeTime, float toVolume)
		{
			yield return new WaitForEndOfFrame();
			audioSource.time = other.time;
			audioSource.Play();
			FadeTo(fadeTime, toVolume);
		}

		public void FadeTo(float fadeTime, float toVolume)
		{
			if (state != FadeState.FadingOut)
			{
				state = FadeState.Ducking;
				StopAllCoroutines();
				StartCoroutine(FadeSoundChannelTo(fadeTime, toVolume));
			}
		}

		public void FadeIn(float fadeTime, float defaultVolume)
		{
			audioSource.volume = 0f;
			state = FadeState.FadingIn;
			StopAllCoroutines();
			StartCoroutine(FadeSoundChannel(0f, fadeTime, Fade.In, defaultVolume));
		}

		public void FadeIn(float fadeTime)
		{
			audioSource.volume = 0f;
			state = FadeState.FadingIn;
			StopAllCoroutines();
			StartCoroutine(FadeSoundChannel(0f, fadeTime, Fade.In, defaultVolume));
		}

		public void FadeOut(float fadeTime)
		{
			if (audioSource.isPlaying)
			{
				state = FadeState.FadingOut;
				StopAllCoroutines();
				StartCoroutine(FadeSoundChannel(0f, fadeTime, Fade.Out, audioSource.volume));
			}
		}

		public void FadeOutDelayed(float delayedSecs, float fadeTime)
		{
			if (audioSource.isPlaying)
			{
				state = FadeState.FadingOut;
				StopAllCoroutines();
				StartCoroutine(FadeSoundChannel(delayedSecs, fadeTime, Fade.Out, audioSource.volume));
			}
		}

		private IEnumerator FadeSoundChannelTo(float fadeTime, float toVolume)
		{
			float start = audioSource.volume;
			float startTime = Time.realtimeSinceStartup;
			float elapsedTime = 0f;
			while (elapsedTime < fadeTime)
			{
				elapsedTime = Time.realtimeSinceStartup - startTime;
				float t = elapsedTime / fadeTime;
				audioSource.volume = Mathf.Lerp(start, toVolume, t);
				yield return 0;
			}
			state = FadeState.Null;
		}

		private IEnumerator FadeSoundChannel(float delaySecs, float fadeTime, Fade fadeType, float defaultVolume)
		{
			if (delaySecs > 0f)
			{
				yield return new WaitForSeconds(delaySecs);
			}
			float start = ((fadeType == Fade.In) ? 0f : defaultVolume);
			float end = ((fadeType == Fade.In) ? defaultVolume : 0f);
			bool restartPlay = false;
			if (fadeType == Fade.In)
			{
				if (Time.time == 0f)
				{
					restartPlay = true;
				}
				audioSource.volume = 0f;
				audioSource.Play();
			}
			float startTime = Time.realtimeSinceStartup;
			float elapsedTime = 0f;
			while (elapsedTime < fadeTime)
			{
				elapsedTime = Time.realtimeSinceStartup - startTime;
				float t = elapsedTime / fadeTime;
				audioSource.volume = Mathf.Lerp(start, end, t);
				yield return 0;
				if (restartPlay && Time.time > 0f)
				{
					audioSource.Play();
					restartPlay = false;
				}
				if (!audioSource.isPlaying)
				{
					break;
				}
			}
			if (fadeType == Fade.Out)
			{
				Stop();
			}
			state = FadeState.Null;
		}
	}
	public enum SoundFXNext
	{
		Random,
		Sequential
	}
	public enum FreqHint
	{
		None,
		Wide,
		Narrow
	}
	public enum SoundPriority
	{
		VeryLow = -2,
		Low,
		Default,
		High,
		VeryHigh
	}
	[Serializable]
	public class OSPProps
	{
		[Tooltip("Set to true to play the sound FX spatialized with binaural HRTF, default = false")]
		public bool enableSpatialization;

		[Tooltip("Play the sound FX with reflections, default = false")]
		public bool useFastOverride;

		[Tooltip("Boost the gain on the spatialized sound FX, default = 0.0")]
		[Range(0f, 24f)]
		public float gain;

		[Tooltip("Enable Inverse Square attenuation curve, default = false")]
		public bool enableInvSquare;

		[Tooltip("Change the sound from point source (0.0f) to a spherical volume, default = 0.0")]
		[Range(0f, 1000f)]
		public float volumetric;

		[Tooltip("Set the near and far falloff value for the OSP attenuation curve, default = 1.0")]
		[MinMax(1f, 25f, 0f, 250f)]
		public Vector2 invSquareFalloff = new Vector2(1f, 25f);

		public OSPProps()
		{
			enableSpatialization = false;
			useFastOverride = false;
			gain = 0f;
			enableInvSquare = false;
			volumetric = 0f;
			invSquareFalloff = new Vector2(1f, 25f);
		}
	}
	[Serializable]
	public class SoundFX
	{
		[Tooltip("Each sound FX should have a unique name")]
		public string name = string.Empty;

		[Tooltip("Sound diversity playback option when multiple audio clips are defined, default = Random")]
		public SoundFXNext playback;

		[Tooltip("Default volume for this sound FX, default = 1.0")]
		[Range(0f, 1f)]
		public float volume = 1f;

		[Tooltip("Random pitch variance each time a sound FX is played, default = 1.0 (none)")]
		[MinMax(1f, 1f, 0f, 2f)]
		public Vector2 pitchVariance = Vector2.one;

		[Tooltip("Falloff distance for the sound FX, default = 1m min to 25m max")]
		[MinMax(1f, 25f, 0f, 250f)]
		public Vector2 falloffDistance = new Vector2(1f, 25f);

		[Tooltip("Volume falloff curve - sets how the sound FX attenuates over distance, default = Linear")]
		public AudioRolloffMode falloffCurve = AudioRolloffMode.Linear;

		[Tooltip("Defines the custom volume falloff curve")]
		public AnimationCurve volumeFalloffCurve = new AnimationCurve(new Keyframe(0f, 1f), new Keyframe(1f, 1f));

		[Tooltip("The amount by which the signal from the AudioSource will be mixed into the global reverb associated with the Reverb Zones | Valid range is 0.0 - 1.1, default = 1.0")]
		public AnimationCurve reverbZoneMix = new AnimationCurve(new Keyframe(0f, 1f), new Keyframe(1f, 1f));

		[Tooltip("Sets the spread angle (in degrees) of a 3d stereo or multichannel sound in speaker space, default = 0")]
		[Range(0f, 360f)]
		public float spread;

		[Tooltip("The percentage chance that this sound FX will play | 0.0 = none, 1.0 = 100%, default = 1.0")]
		[Range(0f, 1f)]
		public float pctChanceToPlay = 1f;

		[Tooltip("Sets the priority for this sound to play and/or to override a currently playing sound FX, default = Default")]
		public SoundPriority priority;

		[Tooltip("Specifies the default delay when this sound FX is played, default = 0.0 secs")]
		[MinMax(0f, 0f, 0f, 2f)]
		public Vector2 delay = Vector2.zero;

		[Tooltip("Set to true for the sound to loop continuously, default = false")]
		public bool looping;

		public OSPProps ospProps = new OSPProps();

		[Tooltip("List of the audio clips assigned to this sound FX")]
		public AudioClip[] soundClips = new AudioClip[1];

		public bool visibilityToggle;

		[NonSerialized]
		private SoundGroup soundGroup;

		private int lastIdx = -1;

		private int playingIdx = -1;

		public int Length => soundClips.Length;

		public bool IsValid
		{
			get
			{
				if (soundClips.Length != 0)
				{
					return soundClips[0] != null;
				}
				return false;
			}
		}

		public SoundGroup Group
		{
			get
			{
				return soundGroup;
			}
			set
			{
				soundGroup = value;
			}
		}

		public float MaxFalloffDistSquared => falloffDistance.y * falloffDistance.y;

		public float GroupVolumeOverride
		{
			get
			{
				if (soundGroup == null)
				{
					return 1f;
				}
				return soundGroup.volumeOverride;
			}
		}

		public SoundFX()
		{
			playback = SoundFXNext.Random;
			volume = 1f;
			pitchVariance = Vector2.one;
			falloffDistance = new Vector2(1f, 25f);
			falloffCurve = AudioRolloffMode.Linear;
			volumeFalloffCurve = new AnimationCurve(new Keyframe(0f, 1f), new Keyframe(1f, 1f));
			reverbZoneMix = new AnimationCurve(new Keyframe(0f, 1f), new Keyframe(1f, 1f));
			spread = 0f;
			pctChanceToPlay = 1f;
			priority = SoundPriority.Default;
			delay = Vector2.zero;
			looping = false;
			ospProps = new OSPProps();
		}

		public AudioClip GetClip()
		{
			if (soundClips.Length == 0)
			{
				return null;
			}
			if (soundClips.Length == 1)
			{
				return soundClips[0];
			}
			if (playback == SoundFXNext.Random)
			{
				int num;
				for (num = UnityEngine.Random.Range(0, soundClips.Length); num == lastIdx; num = UnityEngine.Random.Range(0, soundClips.Length))
				{
				}
				lastIdx = num;
				return soundClips[num];
			}
			if (++lastIdx >= soundClips.Length)
			{
				lastIdx = 0;
			}
			return soundClips[lastIdx];
		}

		public AudioMixerGroup GetMixerGroup(AudioMixerGroup defaultMixerGroup)
		{
			if (soundGroup != null)
			{
				if (!(soundGroup.mixerGroup != null))
				{
					return defaultMixerGroup;
				}
				return soundGroup.mixerGroup;
			}
			return defaultMixerGroup;
		}

		public bool ReachedGroupPlayLimit()
		{
			if (soundGroup != null)
			{
				return !soundGroup.CanPlaySound();
			}
			return false;
		}

		public float GetClipLength(int idx)
		{
			if (idx == -1 || soundClips.Length == 0 || idx >= soundClips.Length || soundClips[idx] == null)
			{
				return 0f;
			}
			return soundClips[idx].length;
		}

		public float GetPitch()
		{
			return UnityEngine.Random.Range(pitchVariance.x, pitchVariance.y);
		}

		public int PlaySound(float delaySecs = 0f)
		{
			playingIdx = -1;
			if (!IsValid)
			{
				return playingIdx;
			}
			if (pctChanceToPlay > 0.99f || UnityEngine.Random.value < pctChanceToPlay)
			{
				if (delay.y > 0f)
				{
					delaySecs = UnityEngine.Random.Range(delay.x, delay.y);
				}
				playingIdx = AudioManager.PlaySound(this, EmitterChannel.Any, delaySecs);
			}
			return playingIdx;
		}

		public int PlaySoundAt(Vector3 pos, float delaySecs = 0f, float volumeOverride = 1f, float pitchMultiplier = 1f)
		{
			playingIdx = -1;
			if (!IsValid)
			{
				return playingIdx;
			}
			if (pctChanceToPlay > 0.99f || UnityEngine.Random.value < pctChanceToPlay)
			{
				if (delay.y > 0f)
				{
					delaySecs = UnityEngine.Random.Range(delay.x, delay.y);
				}
				playingIdx = AudioManager.PlaySoundAt(pos, this, EmitterChannel.Any, delaySecs, volumeOverride, pitchMultiplier);
			}
			return playingIdx;
		}

		public void SetOnFinished(Action onFinished)
		{
			if (playingIdx > -1)
			{
				AudioManager.SetOnFinished(playingIdx, onFinished);
			}
		}

		public void SetOnFinished(Action<object> onFinished, object obj)
		{
			if (playingIdx > -1)
			{
				AudioManager.SetOnFinished(playingIdx, onFinished, obj);
			}
		}

		public bool StopSound()
		{
			bool result = false;
			if (playingIdx > -1)
			{
				result = AudioManager.StopSound(playingIdx);
				playingIdx = -1;
			}
			return result;
		}

		public void AttachToParent(Transform parent)
		{
			if (playingIdx > -1)
			{
				AudioManager.AttachSoundToParent(playingIdx, parent);
			}
		}

		public void DetachFromParent()
		{
			if (playingIdx > -1)
			{
				AudioManager.DetachSoundFromParent(playingIdx);
			}
		}
	}
	[Serializable]
	public class SoundFXRef
	{
		public string soundFXName = string.Empty;

		private bool initialized;

		private SoundFX soundFXCached;

		public SoundFX soundFX
		{
			get
			{
				if (!initialized)
				{
					Init();
				}
				return soundFXCached;
			}
		}

		public string name
		{
			get
			{
				return soundFXName;
			}
			set
			{
				soundFXName = value;
				Init();
			}
		}

		public int Length => soundFX.Length;

		public bool IsValid => soundFX.IsValid;

		private void Init()
		{
			soundFXCached = AudioManager.FindSoundFX(soundFXName);
			if (soundFXCached == null)
			{
				soundFXCached = AudioManager.FindSoundFX(string.Empty);
			}
			initialized = true;
		}

		public AudioClip GetClip()
		{
			return soundFX.GetClip();
		}

		public float GetClipLength(int idx)
		{
			return soundFX.GetClipLength(idx);
		}

		public int PlaySound(float delaySecs = 0f)
		{
			return soundFX.PlaySound(delaySecs);
		}

		public int PlaySoundAt(Vector3 pos, float delaySecs = 0f, float volume = 1f, float pitchMultiplier = 1f)
		{
			return soundFX.PlaySoundAt(pos, delaySecs, volume, pitchMultiplier);
		}

		public void SetOnFinished(Action onFinished)
		{
			soundFX.SetOnFinished(onFinished);
		}

		public void SetOnFinished(Action<object> onFinished, object obj)
		{
			soundFX.SetOnFinished(onFinished, obj);
		}

		public bool StopSound()
		{
			return soundFX.StopSound();
		}

		public void AttachToParent(Transform parent)
		{
			soundFX.AttachToParent(parent);
		}

		public void DetachFromParent()
		{
			soundFX.DetachFromParent();
		}
	}
}
namespace DG.Tweening
{
	public static class DOTweenModuleAudio
	{
		public static TweenerCore<float, float, FloatOptions> DOFade(this AudioSource target, float endValue, float duration)
		{
			if (endValue < 0f)
			{
				endValue = 0f;
			}
			else if (endValue > 1f)
			{
				endValue = 1f;
			}
			TweenerCore<float, float, FloatOptions> tweenerCore = DOTween.To(() => target.volume, delegate(float x)
			{
				target.volume = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<float, float, FloatOptions> DOPitch(this AudioSource target, float endValue, float duration)
		{
			TweenerCore<float, float, FloatOptions> tweenerCore = DOTween.To(() => target.pitch, delegate(float x)
			{
				target.pitch = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<float, float, FloatOptions> DOSetFloat(this AudioMixer target, string floatName, float endValue, float duration)
		{
			TweenerCore<float, float, FloatOptions> tweenerCore = DOTween.To(delegate
			{
				target.GetFloat(floatName, out var value);
				return value;
			}, delegate(float x)
			{
				target.SetFloat(floatName, x);
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static int DOComplete(this AudioMixer target, bool withCallbacks = false)
		{
			return DOTween.Complete(target, withCallbacks);
		}

		public static int DOKill(this AudioMixer target, bool complete = false)
		{
			return DOTween.Kill(target, complete);
		}

		public static int DOFlip(this AudioMixer target)
		{
			return DOTween.Flip(target);
		}

		public static int DOGoto(this AudioMixer target, float to, bool andPlay = false)
		{
			return DOTween.Goto(target, to, andPlay);
		}

		public static int DOPause(this AudioMixer target)
		{
			return DOTween.Pause(target);
		}

		public static int DOPlay(this AudioMixer target)
		{
			return DOTween.Play(target);
		}

		public static int DOPlayBackwards(this AudioMixer target)
		{
			return DOTween.PlayBackwards(target);
		}

		public static int DOPlayForward(this AudioMixer target)
		{
			return DOTween.PlayForward(target);
		}

		public static int DORestart(this AudioMixer target)
		{
			return DOTween.Restart(target);
		}

		public static int DORewind(this AudioMixer target)
		{
			return DOTween.Rewind(target);
		}

		public static int DOSmoothRewind(this AudioMixer target)
		{
			return DOTween.SmoothRewind(target);
		}

		public static int DOTogglePause(this AudioMixer target)
		{
			return DOTween.TogglePause(target);
		}
	}
	public static class DOTweenModulePhysics
	{
		public static TweenerCore<Vector3, Vector3, VectorOptions> DOMove(this Rigidbody target, Vector3 endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector3, Vector3, VectorOptions> tweenerCore = DOTween.To(() => target.position, target.MovePosition, endValue, duration);
			tweenerCore.SetOptions(snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector3, Vector3, VectorOptions> DOMoveX(this Rigidbody target, float endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector3, Vector3, VectorOptions> tweenerCore = DOTween.To(() => target.position, target.MovePosition, new Vector3(endValue, 0f, 0f), duration);
			tweenerCore.SetOptions(AxisConstraint.X, snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector3, Vector3, VectorOptions> DOMoveY(this Rigidbody target, float endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector3, Vector3, VectorOptions> tweenerCore = DOTween.To(() => target.position, target.MovePosition, new Vector3(0f, endValue, 0f), duration);
			tweenerCore.SetOptions(AxisConstraint.Y, snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector3, Vector3, VectorOptions> DOMoveZ(this Rigidbody target, float endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector3, Vector3, VectorOptions> tweenerCore = DOTween.To(() => target.position, target.MovePosition, new Vector3(0f, 0f, endValue), duration);
			tweenerCore.SetOptions(AxisConstraint.Z, snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Quaternion, Vector3, QuaternionOptions> DORotate(this Rigidbody target, Vector3 endValue, float duration, RotateMode mode = RotateMode.Fast)
		{
			TweenerCore<Quaternion, Vector3, QuaternionOptions> tweenerCore = DOTween.To(() => target.rotation, target.MoveRotation, endValue, duration);
			tweenerCore.SetTarget(target);
			tweenerCore.plugOptions.rotateMode = mode;
			return tweenerCore;
		}

		public static TweenerCore<Quaternion, Vector3, QuaternionOptions> DOLookAt(this Rigidbody target, Vector3 towards, float duration, AxisConstraint axisConstraint = AxisConstraint.None, Vector3? up = null)
		{
			TweenerCore<Quaternion, Vector3, QuaternionOptions> tweenerCore = DOTween.To(() => target.rotation, target.MoveRotation, towards, duration).SetTarget(target).SetSpecialStartupMode(SpecialStartupMode.SetLookAt);
			tweenerCore.plugOptions.axisConstraint = axisConstraint;
			tweenerCore.plugOptions.up = ((!up.HasValue) ? Vector3.up : up.Value);
			return tweenerCore;
		}

		public static Sequence DOJump(this Rigidbody target, Vector3 endValue, float jumpPower, int numJumps, float duration, bool snapping = false)
		{
			if (numJumps < 1)
			{
				numJumps = 1;
			}
			float startPosY = 0f;
			float offsetY = -1f;
			bool offsetYSet = false;
			Sequence s = DOTween.Sequence();
			Tween yTween = DOTween.To(() => target.position, target.MovePosition, new Vector3(0f, jumpPower, 0f), duration / (float)(numJumps * 2)).SetOptions(AxisConstraint.Y, snapping).SetEase(Ease.OutQuad)
				.SetRelative()
				.SetLoops(numJumps * 2, LoopType.Yoyo)
				.OnStart(delegate
				{
					startPosY = target.position.y;
				});
			s.Append(DOTween.To(() => target.position, target.MovePosition, new Vector3(endValue.x, 0f, 0f), duration).SetOptions(AxisConstraint.X, snapping).SetEase(Ease.Linear)).Join(DOTween.To(() => target.position, target.MovePosition, new Vector3(0f, 0f, endValue.z), duration).SetOptions(AxisConstraint.Z, snapping).SetEase(Ease.Linear)).Join(yTween)
				.SetTarget(target)
				.SetEase(DOTween.defaultEaseType);
			yTween.OnUpdate(delegate
			{
				if (!offsetYSet)
				{
					offsetYSet = true;
					offsetY = (s.isRelative ? endValue.y : (endValue.y - startPosY));
				}
				Vector3 position = target.position;
				position.y += DOVirtual.EasedValue(0f, offsetY, yTween.ElapsedPercentage(), Ease.OutQuad);
				target.MovePosition(position);
			});
			return s;
		}

		public static TweenerCore<Vector3, DG.Tweening.Plugins.Core.PathCore.Path, PathOptions> DOPath(this Rigidbody target, Vector3[] path, float duration, PathType pathType = PathType.Linear, PathMode pathMode = PathMode.Full3D, int resolution = 10, Color? gizmoColor = null)
		{
			if (resolution < 1)
			{
				resolution = 1;
			}
			TweenerCore<Vector3, DG.Tweening.Plugins.Core.PathCore.Path, PathOptions> tweenerCore = DOTween.To(PathPlugin.Get(), () => target.position, target.MovePosition, new DG.Tweening.Plugins.Core.PathCore.Path(pathType, path, resolution, gizmoColor), duration).SetTarget(target).SetUpdate(UpdateType.Fixed);
			tweenerCore.plugOptions.isRigidbody = true;
			tweenerCore.plugOptions.mode = pathMode;
			return tweenerCore;
		}

		public static TweenerCore<Vector3, DG.Tweening.Plugins.Core.PathCore.Path, PathOptions> DOLocalPath(this Rigidbody target, Vector3[] path, float duration, PathType pathType = PathType.Linear, PathMode pathMode = PathMode.Full3D, int resolution = 10, Color? gizmoColor = null)
		{
			if (resolution < 1)
			{
				resolution = 1;
			}
			Transform trans = target.transform;
			TweenerCore<Vector3, DG.Tweening.Plugins.Core.PathCore.Path, PathOptions> tweenerCore = DOTween.To(PathPlugin.Get(), () => trans.localPosition, delegate(Vector3 x)
			{
				target.MovePosition((trans.parent == null) ? x : trans.parent.TransformPoint(x));
			}, new DG.Tweening.Plugins.Core.PathCore.Path(pathType, path, resolution, gizmoColor), duration).SetTarget(target).SetUpdate(UpdateType.Fixed);
			tweenerCore.plugOptions.isRigidbody = true;
			tweenerCore.plugOptions.mode = pathMode;
			tweenerCore.plugOptions.useLocalPosition = true;
			return tweenerCore;
		}

		internal static TweenerCore<Vector3, DG.Tweening.Plugins.Core.PathCore.Path, PathOptions> DOPath(this Rigidbody target, DG.Tweening.Plugins.Core.PathCore.Path path, float duration, PathMode pathMode = PathMode.Full3D)
		{
			TweenerCore<Vector3, DG.Tweening.Plugins.Core.PathCore.Path, PathOptions> tweenerCore = DOTween.To(PathPlugin.Get(), () => target.position, target.MovePosition, path, duration).SetTarget(target);
			tweenerCore.plugOptions.isRigidbody = true;
			tweenerCore.plugOptions.mode = pathMode;
			return tweenerCore;
		}

		internal static TweenerCore<Vector3, DG.Tweening.Plugins.Core.PathCore.Path, PathOptions> DOLocalPath(this Rigidbody target, DG.Tweening.Plugins.Core.PathCore.Path path, float duration, PathMode pathMode = PathMode.Full3D)
		{
			Transform trans = target.transform;
			TweenerCore<Vector3, DG.Tweening.Plugins.Core.PathCore.Path, PathOptions> tweenerCore = DOTween.To(PathPlugin.Get(), () => trans.localPosition, delegate(Vector3 x)
			{
				target.MovePosition((trans.parent == null) ? x : trans.parent.TransformPoint(x));
			}, path, duration).SetTarget(target);
			tweenerCore.plugOptions.isRigidbody = true;
			tweenerCore.plugOptions.mode = pathMode;
			tweenerCore.plugOptions.useLocalPosition = true;
			return tweenerCore;
		}
	}
	public static class DOTweenModulePhysics2D
	{
		public static TweenerCore<Vector2, Vector2, VectorOptions> DOMove(this Rigidbody2D target, Vector2 endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => target.position, target.MovePosition, endValue, duration);
			tweenerCore.SetOptions(snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOMoveX(this Rigidbody2D target, float endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => target.position, target.MovePosition, new Vector2(endValue, 0f), duration);
			tweenerCore.SetOptions(AxisConstraint.X, snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOMoveY(this Rigidbody2D target, float endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => target.position, target.MovePosition, new Vector2(0f, endValue), duration);
			tweenerCore.SetOptions(AxisConstraint.Y, snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<float, float, FloatOptions> DORotate(this Rigidbody2D target, float endValue, float duration)
		{
			TweenerCore<float, float, FloatOptions> tweenerCore = DOTween.To(() => target.rotation, target.MoveRotation, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static Sequence DOJump(this Rigidbody2D target, Vector2 endValue, float jumpPower, int numJumps, float duration, bool snapping = false)
		{
			if (numJumps < 1)
			{
				numJumps = 1;
			}
			float startPosY = 0f;
			float offsetY = -1f;
			bool offsetYSet = false;
			Sequence s = DOTween.Sequence();
			Tween yTween = DOTween.To(() => target.position, delegate(Vector2 x)
			{
				target.position = x;
			}, new Vector2(0f, jumpPower), duration / (float)(numJumps * 2)).SetOptions(AxisConstraint.Y, snapping).SetEase(Ease.OutQuad)
				.SetRelative()
				.SetLoops(numJumps * 2, LoopType.Yoyo)
				.OnStart(delegate
				{
					startPosY = target.position.y;
				});
			s.Append(DOTween.To(() => target.position, delegate(Vector2 x)
			{
				target.position = x;
			}, new Vector2(endValue.x, 0f), duration).SetOptions(AxisConstraint.X, snapping).SetEase(Ease.Linear)).Join(yTween).SetTarget(target)
				.SetEase(DOTween.defaultEaseType);
			yTween.OnUpdate(delegate
			{
				if (!offsetYSet)
				{
					offsetYSet = true;
					offsetY = (s.isRelative ? endValue.y : (endValue.y - startPosY));
				}
				Vector3 vector = target.position;
				vector.y += DOVirtual.EasedValue(0f, offsetY, yTween.ElapsedPercentage(), Ease.OutQuad);
				target.MovePosition(vector);
			});
			return s;
		}
	}
	public static class DOTweenModuleSprite
	{
		public static TweenerCore<Color, Color, ColorOptions> DOColor(this SpriteRenderer target, Color endValue, float duration)
		{
			TweenerCore<Color, Color, ColorOptions> tweenerCore = DOTween.To(() => target.color, delegate(Color x)
			{
				target.color = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Color, Color, ColorOptions> DOFade(this SpriteRenderer target, float endValue, float duration)
		{
			TweenerCore<Color, Color, ColorOptions> tweenerCore = DOTween.ToAlpha(() => target.color, delegate(Color x)
			{
				target.color = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static Sequence DOGradientColor(this SpriteRenderer target, Gradient gradient, float duration)
		{
			Sequence sequence = DOTween.Sequence();
			GradientColorKey[] colorKeys = gradient.colorKeys;
			int num = colorKeys.Length;
			for (int i = 0; i < num; i++)
			{
				GradientColorKey gradientColorKey = colorKeys[i];
				if (i == 0 && gradientColorKey.time <= 0f)
				{
					target.color = gradientColorKey.color;
					continue;
				}
				float duration2 = ((i == num - 1) ? (duration - sequence.Duration(includeLoops: false)) : (duration * ((i == 0) ? gradientColorKey.time : (gradientColorKey.time - colorKeys[i - 1].time))));
				sequence.Append(target.DOColor(gradientColorKey.color, duration2).SetEase(Ease.Linear));
			}
			sequence.SetTarget(target);
			return sequence;
		}

		public static Tweener DOBlendableColor(this SpriteRenderer target, Color endValue, float duration)
		{
			endValue -= target.color;
			Color to = new Color(0f, 0f, 0f, 0f);
			return DOTween.To(() => to, delegate(Color x)
			{
				Color color = x - to;
				to = x;
				target.color += color;
			}, endValue, duration).Blendable().SetTarget(target);
		}
	}
	public static class DOTweenModuleUI
	{
		public static class Utils
		{
			public static Vector2 SwitchToRectTransform(RectTransform from, RectTransform to)
			{
				Vector2 vector = new Vector2(from.rect.width * 0.5f + from.rect.xMin, from.rect.height * 0.5f + from.rect.yMin);
				Vector2 screenPoint = RectTransformUtility.WorldToScreenPoint(null, from.position);
				screenPoint += vector;
				RectTransformUtility.ScreenPointToLocalPointInRectangle(to, screenPoint, null, out var localPoint);
				Vector2 vector2 = new Vector2(to.rect.width * 0.5f + to.rect.xMin, to.rect.height * 0.5f + to.rect.yMin);
				return to.anchoredPosition + localPoint - vector2;
			}
		}

		public static TweenerCore<float, float, FloatOptions> DOFade(this CanvasGroup target, float endValue, float duration)
		{
			TweenerCore<float, float, FloatOptions> tweenerCore = DOTween.To(() => target.alpha, delegate(float x)
			{
				target.alpha = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Color, Color, ColorOptions> DOColor(this Graphic target, Color endValue, float duration)
		{
			TweenerCore<Color, Color, ColorOptions> tweenerCore = DOTween.To(() => target.color, delegate(Color x)
			{
				target.color = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Color, Color, ColorOptions> DOFade(this Graphic target, float endValue, float duration)
		{
			TweenerCore<Color, Color, ColorOptions> tweenerCore = DOTween.ToAlpha(() => target.color, delegate(Color x)
			{
				target.color = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Color, Color, ColorOptions> DOColor(this Image target, Color endValue, float duration)
		{
			TweenerCore<Color, Color, ColorOptions> tweenerCore = DOTween.To(() => target.color, delegate(Color x)
			{
				target.color = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Color, Color, ColorOptions> DOFade(this Image target, float endValue, float duration)
		{
			TweenerCore<Color, Color, ColorOptions> tweenerCore = DOTween.ToAlpha(() => target.color, delegate(Color x)
			{
				target.color = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<float, float, FloatOptions> DOFillAmount(this Image target, float endValue, float duration)
		{
			if (endValue > 1f)
			{
				endValue = 1f;
			}
			else if (endValue < 0f)
			{
				endValue = 0f;
			}
			TweenerCore<float, float, FloatOptions> tweenerCore = DOTween.To(() => target.fillAmount, delegate(float x)
			{
				target.fillAmount = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static Sequence DOGradientColor(this Image target, Gradient gradient, float duration)
		{
			Sequence sequence = DOTween.Sequence();
			GradientColorKey[] colorKeys = gradient.colorKeys;
			int num = colorKeys.Length;
			for (int i = 0; i < num; i++)
			{
				GradientColorKey gradientColorKey = colorKeys[i];
				if (i == 0 && gradientColorKey.time <= 0f)
				{
					target.color = gradientColorKey.color;
					continue;
				}
				float duration2 = ((i == num - 1) ? (duration - sequence.Duration(includeLoops: false)) : (duration * ((i == 0) ? gradientColorKey.time : (gradientColorKey.time - colorKeys[i - 1].time))));
				sequence.Append(target.DOColor(gradientColorKey.color, duration2).SetEase(Ease.Linear));
			}
			sequence.SetTarget(target);
			return sequence;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOFlexibleSize(this LayoutElement target, Vector2 endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => new Vector2(target.flexibleWidth, target.flexibleHeight), delegate(Vector2 x)
			{
				target.flexibleWidth = x.x;
				target.flexibleHeight = x.y;
			}, endValue, duration);
			tweenerCore.SetOptions(snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOMinSize(this LayoutElement target, Vector2 endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => new Vector2(target.minWidth, target.minHeight), delegate(Vector2 x)
			{
				target.minWidth = x.x;
				target.minHeight = x.y;
			}, endValue, duration);
			tweenerCore.SetOptions(snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOPreferredSize(this LayoutElement target, Vector2 endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => new Vector2(target.preferredWidth, target.preferredHeight), delegate(Vector2 x)
			{
				target.preferredWidth = x.x;
				target.preferredHeight = x.y;
			}, endValue, duration);
			tweenerCore.SetOptions(snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Color, Color, ColorOptions> DOColor(this Outline target, Color endValue, float duration)
		{
			TweenerCore<Color, Color, ColorOptions> tweenerCore = DOTween.To(() => target.effectColor, delegate(Color x)
			{
				target.effectColor = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Color, Color, ColorOptions> DOFade(this Outline target, float endValue, float duration)
		{
			TweenerCore<Color, Color, ColorOptions> tweenerCore = DOTween.ToAlpha(() => target.effectColor, delegate(Color x)
			{
				target.effectColor = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOScale(this Outline target, Vector2 endValue, float duration)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => target.effectDistance, delegate(Vector2 x)
			{
				target.effectDistance = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOAnchorPos(this RectTransform target, Vector2 endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => target.anchoredPosition, delegate(Vector2 x)
			{
				target.anchoredPosition = x;
			}, endValue, duration);
			tweenerCore.SetOptions(snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOAnchorPosX(this RectTransform target, float endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => target.anchoredPosition, delegate(Vector2 x)
			{
				target.anchoredPosition = x;
			}, new Vector2(endValue, 0f), duration);
			tweenerCore.SetOptions(AxisConstraint.X, snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOAnchorPosY(this RectTransform target, float endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => target.anchoredPosition, delegate(Vector2 x)
			{
				target.anchoredPosition = x;
			}, new Vector2(0f, endValue), duration);
			tweenerCore.SetOptions(AxisConstraint.Y, snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector3, Vector3, VectorOptions> DOAnchorPos3D(this RectTransform target, Vector3 endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector3, Vector3, VectorOptions> tweenerCore = DOTween.To(() => target.anchoredPosition3D, delegate(Vector3 x)
			{
				target.anchoredPosition3D = x;
			}, endValue, duration);
			tweenerCore.SetOptions(snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector3, Vector3, VectorOptions> DOAnchorPos3DX(this RectTransform target, float endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector3, Vector3, VectorOptions> tweenerCore = DOTween.To(() => target.anchoredPosition3D, delegate(Vector3 x)
			{
				target.anchoredPosition3D = x;
			}, new Vector3(endValue, 0f, 0f), duration);
			tweenerCore.SetOptions(AxisConstraint.X, snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector3, Vector3, VectorOptions> DOAnchorPos3DY(this RectTransform target, float endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector3, Vector3, VectorOptions> tweenerCore = DOTween.To(() => target.anchoredPosition3D, delegate(Vector3 x)
			{
				target.anchoredPosition3D = x;
			}, new Vector3(0f, endValue, 0f), duration);
			tweenerCore.SetOptions(AxisConstraint.Y, snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector3, Vector3, VectorOptions> DOAnchorPos3DZ(this RectTransform target, float endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector3, Vector3, VectorOptions> tweenerCore = DOTween.To(() => target.anchoredPosition3D, delegate(Vector3 x)
			{
				target.anchoredPosition3D = x;
			}, new Vector3(0f, 0f, endValue), duration);
			tweenerCore.SetOptions(AxisConstraint.Z, snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOAnchorMax(this RectTransform target, Vector2 endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => target.anchorMax, delegate(Vector2 x)
			{
				target.anchorMax = x;
			}, endValue, duration);
			tweenerCore.SetOptions(snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOAnchorMin(this RectTransform target, Vector2 endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => target.anchorMin, delegate(Vector2 x)
			{
				target.anchorMin = x;
			}, endValue, duration);
			tweenerCore.SetOptions(snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOPivot(this RectTransform target, Vector2 endValue, float duration)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => target.pivot, delegate(Vector2 x)
			{
				target.pivot = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOPivotX(this RectTransform target, float endValue, float duration)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => target.pivot, delegate(Vector2 x)
			{
				target.pivot = x;
			}, new Vector2(endValue, 0f), duration);
			tweenerCore.SetOptions(AxisConstraint.X).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOPivotY(this RectTransform target, float endValue, float duration)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => target.pivot, delegate(Vector2 x)
			{
				target.pivot = x;
			}, new Vector2(0f, endValue), duration);
			tweenerCore.SetOptions(AxisConstraint.Y).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOSizeDelta(this RectTransform target, Vector2 endValue, float duration, bool snapping = false)
		{
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => target.sizeDelta, delegate(Vector2 x)
			{
				target.sizeDelta = x;
			}, endValue, duration);
			tweenerCore.SetOptions(snapping).SetTarget(target);
			return tweenerCore;
		}

		public static Tweener DOPunchAnchorPos(this RectTransform target, Vector2 punch, float duration, int vibrato = 10, float elasticity = 1f, bool snapping = false)
		{
			return DOTween.Punch(() => target.anchoredPosition, delegate(Vector3 x)
			{
				target.anchoredPosition = x;
			}, punch, duration, vibrato, elasticity).SetTarget(target).SetOptions(snapping);
		}

		public static Tweener DOShakeAnchorPos(this RectTransform target, float duration, float strength = 100f, int vibrato = 10, float randomness = 90f, bool snapping = false, bool fadeOut = true)
		{
			return DOTween.Shake(() => target.anchoredPosition, delegate(Vector3 x)
			{
				target.anchoredPosition = x;
			}, duration, strength, vibrato, randomness, ignoreZAxis: true, fadeOut).SetTarget(target).SetSpecialStartupMode(SpecialStartupMode.SetShake)
				.SetOptions(snapping);
		}

		public static Tweener DOShakeAnchorPos(this RectTransform target, float duration, Vector2 strength, int vibrato = 10, float randomness = 90f, bool snapping = false, bool fadeOut = true)
		{
			return DOTween.Shake(() => target.anchoredPosition, delegate(Vector3 x)
			{
				target.anchoredPosition = x;
			}, duration, strength, vibrato, randomness, fadeOut).SetTarget(target).SetSpecialStartupMode(SpecialStartupMode.SetShake)
				.SetOptions(snapping);
		}

		public static Sequence DOJumpAnchorPos(this RectTransform target, Vector2 endValue, float jumpPower, int numJumps, float duration, bool snapping = false)
		{
			if (numJumps < 1)
			{
				numJumps = 1;
			}
			float startPosY = 0f;
			float offsetY = -1f;
			bool offsetYSet = false;
			Sequence s = DOTween.Sequence();
			Tween t = DOTween.To(() => target.anchoredPosition, delegate(Vector2 x)
			{
				target.anchoredPosition = x;
			}, new Vector2(0f, jumpPower), duration / (float)(numJumps * 2)).SetOptions(AxisConstraint.Y, snapping).SetEase(Ease.OutQuad)
				.SetRelative()
				.SetLoops(numJumps * 2, LoopType.Yoyo)
				.OnStart(delegate
				{
					startPosY = target.anchoredPosition.y;
				});
			s.Append(DOTween.To(() => target.anchoredPosition, delegate(Vector2 x)
			{
				target.anchoredPosition = x;
			}, new Vector2(endValue.x, 0f), duration).SetOptions(AxisConstraint.X, snapping).SetEase(Ease.Linear)).Join(t).SetTarget(target)
				.SetEase(DOTween.defaultEaseType);
			s.OnUpdate(delegate
			{
				if (!offsetYSet)
				{
					offsetYSet = true;
					offsetY = (s.isRelative ? endValue.y : (endValue.y - startPosY));
				}
				Vector2 anchoredPosition = target.anchoredPosition;
				anchoredPosition.y += DOVirtual.EasedValue(0f, offsetY, s.ElapsedDirectionalPercentage(), Ease.OutQuad);
				target.anchoredPosition = anchoredPosition;
			});
			return s;
		}

		public static Tweener DONormalizedPos(this ScrollRect target, Vector2 endValue, float duration, bool snapping = false)
		{
			return DOTween.To(() => new Vector2(target.horizontalNormalizedPosition, target.verticalNormalizedPosition), delegate(Vector2 x)
			{
				target.horizontalNormalizedPosition = x.x;
				target.verticalNormalizedPosition = x.y;
			}, endValue, duration).SetOptions(snapping).SetTarget(target);
		}

		public static Tweener DOHorizontalNormalizedPos(this ScrollRect target, float endValue, float duration, bool snapping = false)
		{
			return DOTween.To(() => target.horizontalNormalizedPosition, delegate(float x)
			{
				target.horizontalNormalizedPosition = x;
			}, endValue, duration).SetOptions(snapping).SetTarget(target);
		}

		public static Tweener DOVerticalNormalizedPos(this ScrollRect target, float endValue, float duration, bool snapping = false)
		{
			return DOTween.To(() => target.verticalNormalizedPosition, delegate(float x)
			{
				target.verticalNormalizedPosition = x;
			}, endValue, duration).SetOptions(snapping).SetTarget(target);
		}

		public static TweenerCore<float, float, FloatOptions> DOValue(this Slider target, float endValue, float duration, bool snapping = false)
		{
			TweenerCore<float, float, FloatOptions> tweenerCore = DOTween.To(() => target.value, delegate(float x)
			{
				target.value = x;
			}, endValue, duration);
			tweenerCore.SetOptions(snapping).SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Color, Color, ColorOptions> DOColor(this Text target, Color endValue, float duration)
		{
			TweenerCore<Color, Color, ColorOptions> tweenerCore = DOTween.To(() => target.color, delegate(Color x)
			{
				target.color = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Color, Color, ColorOptions> DOFade(this Text target, float endValue, float duration)
		{
			TweenerCore<Color, Color, ColorOptions> tweenerCore = DOTween.ToAlpha(() => target.color, delegate(Color x)
			{
				target.color = x;
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<string, string, StringOptions> DOText(this Text target, string endValue, float duration, bool richTextEnabled = true, ScrambleMode scrambleMode = ScrambleMode.None, string scrambleChars = null)
		{
			if (endValue == null)
			{
				if (DG.Tweening.Core.Debugger.logPriority > 0)
				{
					DG.Tweening.Core.Debugger.LogWarning("You can't pass a NULL string to DOText: an empty string will be used instead to avoid errors");
				}
				endValue = "";
			}
			TweenerCore<string, string, StringOptions> tweenerCore = DOTween.To(() => target.text, delegate(string x)
			{
				target.text = x;
			}, endValue, duration);
			tweenerCore.SetOptions(richTextEnabled, scrambleMode, scrambleChars).SetTarget(target);
			return tweenerCore;
		}

		public static Tweener DOBlendableColor(this Graphic target, Color endValue, float duration)
		{
			endValue -= target.color;
			Color to = new Color(0f, 0f, 0f, 0f);
			return DOTween.To(() => to, delegate(Color x)
			{
				Color color = x - to;
				to = x;
				target.color += color;
			}, endValue, duration).Blendable().SetTarget(target);
		}

		public static Tweener DOBlendableColor(this Image target, Color endValue, float duration)
		{
			endValue -= target.color;
			Color to = new Color(0f, 0f, 0f, 0f);
			return DOTween.To(() => to, delegate(Color x)
			{
				Color color = x - to;
				to = x;
				target.color += color;
			}, endValue, duration).Blendable().SetTarget(target);
		}

		public static Tweener DOBlendableColor(this Text target, Color endValue, float duration)
		{
			endValue -= target.color;
			Color to = new Color(0f, 0f, 0f, 0f);
			return DOTween.To(() => to, delegate(Color x)
			{
				Color color = x - to;
				to = x;
				target.color += color;
			}, endValue, duration).Blendable().SetTarget(target);
		}
	}
	public static class DOTweenModuleUnityVersion
	{
		public static Sequence DOGradientColor(this Material target, Gradient gradient, float duration)
		{
			Sequence sequence = DOTween.Sequence();
			GradientColorKey[] colorKeys = gradient.colorKeys;
			int num = colorKeys.Length;
			for (int i = 0; i < num; i++)
			{
				GradientColorKey gradientColorKey = colorKeys[i];
				if (i == 0 && gradientColorKey.time <= 0f)
				{
					target.color = gradientColorKey.color;
					continue;
				}
				float duration2 = ((i == num - 1) ? (duration - sequence.Duration(includeLoops: false)) : (duration * ((i == 0) ? gradientColorKey.time : (gradientColorKey.time - colorKeys[i - 1].time))));
				sequence.Append(target.DOColor(gradientColorKey.color, duration2).SetEase(Ease.Linear));
			}
			sequence.SetTarget(target);
			return sequence;
		}

		public static Sequence DOGradientColor(this Material target, Gradient gradient, string property, float duration)
		{
			Sequence sequence = DOTween.Sequence();
			GradientColorKey[] colorKeys = gradient.colorKeys;
			int num = colorKeys.Length;
			for (int i = 0; i < num; i++)
			{
				GradientColorKey gradientColorKey = colorKeys[i];
				if (i == 0 && gradientColorKey.time <= 0f)
				{
					target.SetColor(property, gradientColorKey.color);
					continue;
				}
				float duration2 = ((i == num - 1) ? (duration - sequence.Duration(includeLoops: false)) : (duration * ((i == 0) ? gradientColorKey.time : (gradientColorKey.time - colorKeys[i - 1].time))));
				sequence.Append(target.DOColor(gradientColorKey.color, property, duration2).SetEase(Ease.Linear));
			}
			sequence.SetTarget(target);
			return sequence;
		}

		public static CustomYieldInstruction WaitForCompletion(this Tween t, bool returnCustomYieldInstruction)
		{
			if (!t.active)
			{
				if (DG.Tweening.Core.Debugger.logPriority > 0)
				{
					DG.Tweening.Core.Debugger.LogInvalidTween(t);
				}
				return null;
			}
			return new DOTweenCYInstruction.WaitForCompletion(t);
		}

		public static CustomYieldInstruction WaitForRewind(this Tween t, bool returnCustomYieldInstruction)
		{
			if (!t.active)
			{
				if (DG.Tweening.Core.Debugger.logPriority > 0)
				{
					DG.Tweening.Core.Debugger.LogInvalidTween(t);
				}
				return null;
			}
			return new DOTweenCYInstruction.WaitForRewind(t);
		}

		public static CustomYieldInstruction WaitForKill(this Tween t, bool returnCustomYieldInstruction)
		{
			if (!t.active)
			{
				if (DG.Tweening.Core.Debugger.logPriority > 0)
				{
					DG.Tweening.Core.Debugger.LogInvalidTween(t);
				}
				return null;
			}
			return new DOTweenCYInstruction.WaitForKill(t);
		}

		public static CustomYieldInstruction WaitForElapsedLoops(this Tween t, int elapsedLoops, bool returnCustomYieldInstruction)
		{
			if (!t.active)
			{
				if (DG.Tweening.Core.Debugger.logPriority > 0)
				{
					DG.Tweening.Core.Debugger.LogInvalidTween(t);
				}
				return null;
			}
			return new DOTweenCYInstruction.WaitForElapsedLoops(t, elapsedLoops);
		}

		public static CustomYieldInstruction WaitForPosition(this Tween t, float position, bool returnCustomYieldInstruction)
		{
			if (!t.active)
			{
				if (DG.Tweening.Core.Debugger.logPriority > 0)
				{
					DG.Tweening.Core.Debugger.LogInvalidTween(t);
				}
				return null;
			}
			return new DOTweenCYInstruction.WaitForPosition(t, position);
		}

		public static CustomYieldInstruction WaitForStart(this Tween t, bool returnCustomYieldInstruction)
		{
			if (!t.active)
			{
				if (DG.Tweening.Core.Debugger.logPriority > 0)
				{
					DG.Tweening.Core.Debugger.LogInvalidTween(t);
				}
				return null;
			}
			return new DOTweenCYInstruction.WaitForStart(t);
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOOffset(this Material target, Vector2 endValue, int propertyID, float duration)
		{
			if (!target.HasProperty(propertyID))
			{
				if (DG.Tweening.Core.Debugger.logPriority > 0)
				{
					DG.Tweening.Core.Debugger.LogMissingMaterialProperty(propertyID);
				}
				return null;
			}
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => target.GetTextureOffset(propertyID), delegate(Vector2 x)
			{
				target.SetTextureOffset(propertyID, x);
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}

		public static TweenerCore<Vector2, Vector2, VectorOptions> DOTiling(this Material target, Vector2 endValue, int propertyID, float duration)
		{
			if (!target.HasProperty(propertyID))
			{
				if (DG.Tweening.Core.Debugger.logPriority > 0)
				{
					DG.Tweening.Core.Debugger.LogMissingMaterialProperty(propertyID);
				}
				return null;
			}
			TweenerCore<Vector2, Vector2, VectorOptions> tweenerCore = DOTween.To(() => target.GetTextureScale(propertyID), delegate(Vector2 x)
			{
				target.SetTextureScale(propertyID, x);
			}, endValue, duration);
			tweenerCore.SetTarget(target);
			return tweenerCore;
		}
	}
	public static class DOTweenCYInstruction
	{
		public class WaitForCompletion : CustomYieldInstruction
		{
			private readonly Tween t;

			public override bool keepWaiting
			{
				get
				{
					if (t.active)
					{
						return !t.IsComplete();
					}
					return false;
				}
			}

			public WaitForCompletion(Tween tween)
			{
				t = tween;
			}
		}

		public class WaitForRewind : CustomYieldInstruction
		{
			private readonly Tween t;

			public override bool keepWaiting
			{
				get
				{
					if (t.active)
					{
						if (t.playedOnce)
						{
							return t.position * (float)(t.CompletedLoops() + 1) > 0f;
						}
						return true;
					}
					return false;
				}
			}

			public WaitForRewind(Tween tween)
			{
				t = tween;
			}
		}

		public class WaitForKill : CustomYieldInstruction
		{
			private readonly Tween t;

			public override bool keepWaiting => t.active;

			public WaitForKill(Tween tween)
			{
				t = tween;
			}
		}

		public class WaitForElapsedLoops : CustomYieldInstruction
		{
			private readonly Tween t;

			private readonly int elapsedLoops;

			public override bool keepWaiting
			{
				get
				{
					if (t.active)
					{
						return t.CompletedLoops() < elapsedLoops;
					}
					return false;
				}
			}

			public WaitForElapsedLoops(Tween tween, int elapsedLoops)
			{
				t = tween;
				this.elapsedLoops = elapsedLoops;
			}
		}

		public class WaitForPosition : CustomYieldInstruction
		{
			private readonly Tween t;

			private readonly float position;

			public override bool keepWaiting
			{
				get
				{
					if (t.active)
					{
						return t.position * (float)(t.CompletedLoops() + 1) < position;
					}
					return false;
				}
			}

			public WaitForPosition(Tween tween, float position)
			{
				t = tween;
				this.position = position;
			}
		}

		public class WaitForStart : CustomYieldInstruction
		{
			private readonly Tween t;

			public override bool keepWaiting
			{
				get
				{
					if (t.active)
					{
						return !t.playedOnce;
					}
					return false;
				}
			}

			public WaitForStart(Tween tween)
			{
				t = tween;
			}
		}
	}
	public static class DOTweenModuleUtils
	{
		public static class Physics
		{
			public static void SetOrientationOnPath(PathOptions options, Tween t, Quaternion newRot, Transform trans)
			{
				if (options.isRigidbody)
				{
					((Rigidbody)t.target).rotation = newRot;
				}
				else
				{
					trans.rotation = newRot;
				}
			}

			public static bool HasRigidbody2D(UnityEngine.Component target)
			{
				return target.GetComponent<Rigidbody2D>() != null;
			}

			[Preserve]
			public static bool HasRigidbody(UnityEngine.Component target)
			{
				return target.GetComponent<Rigidbody>() != null;
			}

			[Preserve]
			public static TweenerCore<Vector3, DG.Tweening.Plugins.Core.PathCore.Path, PathOptions> CreateDOTweenPathTween(MonoBehaviour target, bool tweenRigidbody, bool isLocal, DG.Tweening.Plugins.Core.PathCore.Path path, float duration, PathMode pathMode)
			{
				Rigidbody rigidbody = (tweenRigidbody ? target.GetComponent<Rigidbody>() : null);
				if (tweenRigidbody && rigidbody != null)
				{
					return isLocal ? rigidbody.DOLocalPath(path, duration, pathMode) : rigidbody.DOPath(path, duration, pathMode);
				}
				return isLocal ? target.transform.DOLocalPath(path, duration, pathMode) : target.transform.DOPath(path, duration, pathMode);
			}
		}

		private static bool _initialized;

		[Preserve]
		public static void Init()
		{
			if (!_initialized)
			{
				_initialized = true;
				DOTweenExternalCommand.SetOrientationOnPath += Physics.SetOrientationOnPath;
			}
		}

		[Preserve]
		private static void Preserver()
		{
			AppDomain.CurrentDomain.GetAssemblies();
			typeof(MonoBehaviour).GetMethod("Stub");
		}
	}
}
